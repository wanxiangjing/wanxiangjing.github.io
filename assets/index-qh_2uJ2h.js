import{j as a,v as E,w as Y,x as V,y as H,E as G}from"./index-C7R3IaCj.js";import{a as h,u as I,f as q}from"./core-vendor-BY2yH0eA.js";import{r as J}from"./rtc-BarK11XP.js";import{_ as P,m as k,n as C,o as y,B as K,R as Q}from"./ui-vendor-B_BG4PkP.js";import{l as X}from"./logo-CiLQncpc.js";import{a as Z}from"./index-DQn4vhZc.js";import{f as tt}from"./store-vendor-BtW7VYLY.js";import"./rtc-vendor-Co3qY2HD.js";import"./utils-vendor-NIGUFBhG.js";var b=(r=>(r.Init="init",r.Ading="ading",r.Loading="loading",r.End="end",r))(b||{});const et=r=>{const{adData:e,setPageStatus:t}=r,[n,o]=h.useState(6),i=I();h.useEffect(()=>{if(n===0&&e){u();return}const m=setTimeout(()=>{o(n-1)},1e3);return()=>clearTimeout(m)},[n,e]);const s=()=>{t(b.Loading)},c=()=>{s()},u=()=>{s()},f=()=>{e&&e.link&&(s(),i(e.link))};return a.jsxs("div",{className:"ad-page",children:[a.jsxs("div",{className:"ad-content",onClick:f,children:[a.jsx("h2",{children:e.title}),a.jsx("p",{children:e.description}),a.jsx("div",{className:"ad-image",children:a.jsx("img",{src:e.image,alt:e.title})})]}),a.jsxs("button",{className:"skip-btn",onClick:c,children:["跳过 ",n,"s"]})]})};function d(r){return typeof r=="function"}function $(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var w=$(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function O(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var x=(function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=P(s),u=c.next();!u.done;u=c.next()){var f=u.value;f.remove(this)}}catch(l){e={error:l}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else s.remove(this);var m=this.initialTeardown;if(d(m))try{m()}catch(l){i=l instanceof w?l.errors:[l]}var T=this._finalizers;if(T){this._finalizers=null;try{for(var g=P(T),v=g.next();!v.done;v=g.next()){var W=v.value;try{z(W)}catch(l){i=i??[],l instanceof w?i=k(k([],C(i)),C(l.errors)):i.push(l)}}}catch(l){n={error:l}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(n)throw n.error}}}if(i)throw new w(i)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)z(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&O(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&O(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=(function(){var e=new r;return e.closed=!0,e})(),r})(),F=x.EMPTY;function L(r){return r instanceof x||r&&"closed"in r&&d(r.remove)&&d(r.add)&&d(r.unsubscribe)}function z(r){d(r)?r():r.unsubscribe()}var rt={Promise:void 0},nt={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];return setTimeout.apply(void 0,k([r,e],C(t)))},clearTimeout:function(r){return clearTimeout(r)},delegate:void 0};function ot(r){nt.setTimeout(function(){throw r})}function R(){}function S(r){r()}var M=(function(r){y(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,L(t)&&t.add(n)):n.destination=at,n}return e.create=function(t,n,o){return new A(t,n,o)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(x),it=(function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){_(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){_(n)}else _(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){_(t)}},r})(),A=(function(r){y(e,r);function e(t,n,o){var i=r.call(this)||this,s;return d(t)||!t?s={next:t??void 0,error:n??void 0,complete:o??void 0}:s=t,i.destination=new it(s),i}return e})(M);function _(r){ot(r)}function st(r){throw r}var at={closed:!0,next:R,error:st,complete:R},ct=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function ut(r){return r}function lt(r){return r.length===0?ut:r.length===1?r[0]:function(t){return r.reduce(function(n,o){return o(n)},t)}}var B=(function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var o=this,i=dt(e)?e:new A(e,t,n);return S(function(){var s=o,c=s.operator,u=s.source;i.add(c?c.call(i,u):u?o._subscribe(i):o._trySubscribe(i))}),i},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=N(t),new t(function(o,i){var s=new A({next:function(c){try{e(c)}catch(u){i(u),s.unsubscribe()}},error:i,complete:o});n.subscribe(s)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[ct]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return lt(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=N(e),new e(function(n,o){var i;t.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},r.create=function(e){return new r(e)},r})();function N(r){var e;return(e=r??rt.Promise)!==null&&e!==void 0?e:Promise}function pt(r){return r&&d(r.next)&&d(r.error)&&d(r.complete)}function dt(r){return r&&r instanceof M||pt(r)&&L(r)}var ht=$(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),D=(function(r){y(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new U(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new ht},e.prototype.next=function(t){var n=this;S(function(){var o,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=P(n.currentObservers),c=s.next();!c.done;c=s.next()){var u=c.value;u.next(t)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},e.prototype.error=function(t){var n=this;S(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var o=n.observers;o.length;)o.shift().error(t)}})},e.prototype.complete=function(){var t=this;S(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,o=this,i=o.hasError,s=o.isStopped,c=o.observers;return i||s?F:(this.currentObservers=null,c.push(t),new x(function(){n.currentObservers=null,O(c,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,o=n.hasError,i=n.thrownError,s=n.isStopped;o?t.error(i):s&&t.complete()},e.prototype.asObservable=function(){var t=new B;return t.source=this,t},e.create=function(t,n){return new U(t,n)},e})(B),U=(function(r){y(e,r);function e(t,n){var o=r.call(this)||this;return o.destination=t,o.source=n,o}return e.prototype.next=function(t){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,t)},e.prototype.error=function(t){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&o!==void 0?o:F},e})(D),ft=(function(r){y(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,o=t.thrownError,i=t._value;if(n)throw o;return this._throwIfClosed(),i},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e})(D);const j=[{key:"rtcConfig",type:"api",api:J.getGuideScene,callback:r=>{E.dispatch(Y(r.scene.id)),E.dispatch(V([r].reduce((e,t)=>(e[t.scene.id]=t.scene,e),{}))),E.dispatch(H([r].reduce((e,t)=>(e[t.scene.id]=t.rtc,e),{})))}}];class vt{progressSubject=new ft({total:j.length,loaded:0,percentage:0,status:"idle"});loadProgress$=this.progressSubject.asObservable();getProgressObservable(){return this.loadProgress$}async load(){const e=j.length;let t=0;this.updateProgress(e,t,"loading");try{const n=j.map(o=>this.loadItem(o).then(()=>{t++,this.updateProgress(e,t,"loading")}));await Promise.all(n),this.updateProgress(e,t,"completed")}catch(n){throw console.error("预加载失败:",n),this.updateProgress(e,t,"error",n),n}}async loadItem(e){return new Promise((t,n)=>{switch(e.type){case"api":e.api?e.api().then(o=>{e.callback?.(o),t()}).catch(o=>{console.error(`API资源加载失败: ${e.key}`,o),n(o)}):t();break;case"image":case"script":case"style":case"font":case"media":case"other":if(e.link){const o=this.createResourceElement(e);o.onload=()=>{e.callback?.(o),t()},o.onerror=i=>{console.error(`资源加载失败: ${e.link}`,i),n(i)},document.head.appendChild(o)}else t();break}})}createResourceElement(e){if(e.type==="script"){const t=document.createElement("script");return t.src=e.link,t}else{const t=document.createElement("link");return t.href=e.link,t.rel=e.type==="style"?"stylesheet":e.type,t}}updateProgress(e,t,n,o){const i=e>0?Math.round(t/e*100):0;this.progressSubject.next({total:e,loaded:t,percentage:i,status:n,error:o})}}const bt="_startPageContainer_iz927_1",yt="_mainContent_iz927_9",mt="_logo_iz927_16",gt="_title_iz927_22",_t="_desc_iz927_28",St="_enterButtonWrap_iz927_41",xt="_rightIcon_iz927_53",Et="_id11ske_iz927_64",wt="_idEkm31_iz927_75",jt="_idTgbz2_iz927_86",p={startPageContainer:bt,mainContent:yt,logo:mt,title:gt,desc:_t,enterButtonWrap:St,rightIcon:xt,id11ske:Et,idEkm31:wt,idTgbz2:jt},Pt=()=>{const r=I(),e=tt(),t=q().search.split("redirect=")[1],n=()=>{e(G(!0)),Z.getIsLogin()?r(t||"/"):r(`/#/login?redirect=${t||"/"}`)};return a.jsxs("div",{className:p.startPageContainer,children:[a.jsxs("div",{className:p.mainContent,children:[a.jsx("img",{className:p.logo,src:X,alt:"logo"}),a.jsx("div",{className:p.title,children:"万象镜"}),a.jsx("div",{className:p.desc,children:"AI讲解·随问随答"}),a.jsx("div",{className:p.desc,children:"看见故事·不只风景"})]}),a.jsx("div",{className:p.enterButtonWrap,children:a.jsxs(K,{block:!0,shape:"rounded",color:"primary",onClick:n,children:["立即体验 ",a.jsx(Q,{className:p.rightIcon})]})}),a.jsx("div",{className:p.id11ske}),a.jsx("div",{className:p.idEkm31}),a.jsx("div",{className:p.idTgbz2})]})},Nt=()=>{const[r,e]=h.useState(b.Init),[t,n]=h.useState({}),[o,i]=h.useState({});return h.useRef(new vt),I(),a.jsxs("div",{children:[r===b.Init&&a.jsx(Pt,{}),r===b.Ading&&a.jsx(et,{adData:t,setPageStatus:e})]})};export{Nt as default};
