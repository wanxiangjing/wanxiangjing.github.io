import{u as I,j as a,M as P,N as k,H as C,P as y,C as x,D as Y,E as H,F as V,a as G,Q}from"./index-DQ5goTQg.js";import{a as d,h as X}from"./store-vendor-C5eEuSGF.js";import{r as Z}from"./rtc-DHiMLrT-.js";import{l as q}from"./logo-CiLQncpc.js";import{b as J}from"./index-DsxKIGXk.js";import{B as K}from"./button-tWTWPxgW.js";import"./rtc-vendor-Co3qY2HD.js";import"./utils-vendor-NIGUFBhG.js";import"./validate-D6cW8onK.js";function tt(r){return d.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},r,{style:Object.assign({verticalAlign:"-0.125em"},r.style),className:["antd-mobile-icon",r.className].filter(Boolean).join(" ")}),d.createElement("g",{id:"RightOutline-RightOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},d.createElement("g",{id:"RightOutline-RightOutlined"},d.createElement("rect",{id:"RightOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),d.createElement("path",{d:"M17.3947957,5.11219264 L35.5767382,22.6612572 L35.5767382,22.6612572 C36.1304785,23.2125856 36.1630514,24.0863155 35.6744571,24.6755735 L35.5767382,24.7825775 L17.3956061,42.8834676 C17.320643,42.9580998 17.2191697,43 17.1133896,43 L13.9866673,43 C13.7657534,43 13.5866673,42.8209139 13.5866673,42.6 C13.5866673,42.4936115 13.6290496,42.391606 13.7044413,42.316542 L32.3201933,23.7816937 L32.3201933,23.7816937 L13.7237117,5.6866816 C13.5653818,5.53262122 13.5619207,5.27937888 13.7159811,5.121049 C13.7912854,5.04365775 13.8946805,5 14.0026627,5 L17.1170064,5 C17.2206403,5 17.3202292,5.04022164 17.3947957,5.11219264 Z",id:"RightOutline-right",fill:"currentColor",fillRule:"nonzero"}))))}var b=(r=>(r.Init="init",r.Ading="ading",r.Loading="loading",r.End="end",r))(b||{});const et=r=>{const{adData:e,setPageStatus:t}=r,[n,i]=d.useState(6),o=I();d.useEffect(()=>{if(n===0&&e){u();return}const m=setTimeout(()=>{i(n-1)},1e3);return()=>clearTimeout(m)},[n,e]);const s=()=>{t(b.Loading)},c=()=>{s()},u=()=>{s()},f=()=>{e&&e.link&&(s(),o(e.link))};return a.jsxs("div",{className:"ad-page",children:[a.jsxs("div",{className:"ad-content",onClick:f,children:[a.jsx("h2",{children:e.title}),a.jsx("p",{children:e.description}),a.jsx("div",{className:"ad-image",children:a.jsx("img",{src:e.image,alt:e.title})})]}),a.jsxs("button",{className:"skip-btn",onClick:c,children:["跳过 ",n,"s"]})]})};function p(r){return typeof r=="function"}function B(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var w=B(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function O(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var E=(function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=P(s),u=c.next();!u.done;u=c.next()){var f=u.value;f.remove(this)}}catch(l){e={error:l}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else s.remove(this);var m=this.initialTeardown;if(p(m))try{m()}catch(l){o=l instanceof w?l.errors:[l]}var T=this._finalizers;if(T){this._finalizers=null;try{for(var g=P(T),v=g.next();!v.done;v=g.next()){var W=v.value;try{R(W)}catch(l){o=o??[],l instanceof w?o=k(k([],C(o)),C(l.errors)):o.push(l)}}}catch(l){n={error:l}}finally{try{v&&!v.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}}if(o)throw new w(o)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)R(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&O(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&O(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=(function(){var e=new r;return e.closed=!0,e})(),r})(),U=E.EMPTY;function M(r){return r instanceof E||r&&"closed"in r&&p(r.remove)&&p(r.add)&&p(r.unsubscribe)}function R(r){p(r)?r():r.unsubscribe()}var rt={Promise:void 0},nt={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];return setTimeout.apply(void 0,k([r,e],C(t)))},clearTimeout:function(r){return clearTimeout(r)},delegate:void 0};function it(r){nt.setTimeout(function(){throw r})}function z(){}function S(r){r()}var $=(function(r){y(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,M(t)&&t.add(n)):n.destination=at,n}return e.create=function(t,n,i){return new A(t,n,i)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(E),ot=(function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){_(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){_(n)}else _(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){_(t)}},r})(),A=(function(r){y(e,r);function e(t,n,i){var o=r.call(this)||this,s;return p(t)||!t?s={next:t??void 0,error:n??void 0,complete:i??void 0}:s=t,o.destination=new ot(s),o}return e})($);function _(r){it(r)}function st(r){throw r}var at={closed:!0,next:z,error:st,complete:z},ct=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function ut(r){return r}function lt(r){return r.length===0?ut:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var L=(function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,o=dt(e)?e:new A(e,t,n);return S(function(){var s=i,c=s.operator,u=s.source;o.add(c?c.call(o,u):u?i._subscribe(o):i._trySubscribe(o))}),o},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=F(t),new t(function(i,o){var s=new A({next:function(c){try{e(c)}catch(u){o(u),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[ct]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return lt(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=F(e),new e(function(n,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},r.create=function(e){return new r(e)},r})();function F(r){var e;return(e=r??rt.Promise)!==null&&e!==void 0?e:Promise}function ht(r){return r&&p(r.next)&&p(r.error)&&p(r.complete)}function dt(r){return r&&r instanceof $||ht(r)&&M(r)}var pt=B(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),D=(function(r){y(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new N(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new pt},e.prototype.next=function(t){var n=this;S(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=P(n.currentObservers),c=s.next();!c.done;c=s.next()){var u=c.value;u.next(t)}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;S(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;S(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,o=i.hasError,s=i.isStopped,c=i.observers;return o||s?U:(this.currentObservers=null,c.push(t),new E(function(){n.currentObservers=null,O(c,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new L;return t.source=this,t},e.create=function(t,n){return new N(t,n)},e})(L),N=(function(r){y(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:U},e})(D),ft=(function(r){y(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,o=t._value;if(n)throw i;return this._throwIfClosed(),o},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e})(D);const j=[{key:"rtcConfig",type:"api",api:Z.getGuideScene,callback:r=>{x.dispatch(Y(r.scene.id)),x.dispatch(H([r].reduce((e,t)=>(e[t.scene.id]=t.scene,e),{}))),x.dispatch(V([r].reduce((e,t)=>(e[t.scene.id]=t.rtc,e),{})))}}];class vt{progressSubject=new ft({total:j.length,loaded:0,percentage:0,status:"idle"});loadProgress$=this.progressSubject.asObservable();getProgressObservable(){return this.loadProgress$}async load(){const e=j.length;let t=0;this.updateProgress(e,t,"loading");try{const n=j.map(i=>this.loadItem(i).then(()=>{t++,this.updateProgress(e,t,"loading")}));await Promise.all(n),this.updateProgress(e,t,"completed")}catch(n){throw console.error("预加载失败:",n),this.updateProgress(e,t,"error",n),n}}async loadItem(e){return new Promise((t,n)=>{switch(e.type){case"api":e.api?e.api().then(i=>{e.callback?.(i),t()}).catch(i=>{console.error(`API资源加载失败: ${e.key}`,i),n(i)}):t();break;case"image":case"script":case"style":case"font":case"media":case"other":if(e.link){const i=this.createResourceElement(e);i.onload=()=>{e.callback?.(i),t()},i.onerror=o=>{console.error(`资源加载失败: ${e.link}`,o),n(o)},document.head.appendChild(i)}else t();break}})}createResourceElement(e){if(e.type==="script"){const t=document.createElement("script");return t.src=e.link,t}else{const t=document.createElement("link");return t.href=e.link,t.rel=e.type==="style"?"stylesheet":e.type,t}}updateProgress(e,t,n,i){const o=e>0?Math.round(t/e*100):0;this.progressSubject.next({total:e,loaded:t,percentage:o,status:n,error:i})}}const bt="_startPageContainer_iz927_1",yt="_mainContent_iz927_9",mt="_logo_iz927_16",gt="_title_iz927_22",_t="_desc_iz927_28",St="_enterButtonWrap_iz927_41",Et="_rightIcon_iz927_53",xt="_id11ske_iz927_64",wt="_idEkm31_iz927_75",jt="_idTgbz2_iz927_86",h={startPageContainer:bt,mainContent:yt,logo:mt,title:gt,desc:_t,enterButtonWrap:St,rightIcon:Et,id11ske:xt,idEkm31:wt,idTgbz2:jt},Pt=()=>{const r=I(),e=X(),t=G().search.split("redirect=")[1],n=()=>{e(Q(!0)),J.getIsLogin()?r(t||"/"):r(`/#/login?redirect=${t||"/"}`)};return a.jsxs("div",{className:h.startPageContainer,children:[a.jsxs("div",{className:h.mainContent,children:[a.jsx("img",{className:h.logo,src:q,alt:"logo"}),a.jsx("div",{className:h.title,children:"万象镜"}),a.jsx("div",{className:h.desc,children:"AI讲解·随问随答"}),a.jsx("div",{className:h.desc,children:"看见故事·不只风景"})]}),a.jsx("div",{className:h.enterButtonWrap,children:a.jsxs(K,{block:!0,shape:"rounded",color:"primary",onClick:n,children:["立即体验 ",a.jsx(tt,{className:h.rightIcon})]})}),a.jsx("div",{className:h.id11ske}),a.jsx("div",{className:h.idEkm31}),a.jsx("div",{className:h.idTgbz2})]})},Ft=()=>{const[r,e]=d.useState(b.Init),[t,n]=d.useState({}),[i,o]=d.useState({});return d.useRef(new vt),I(),a.jsxs("div",{children:[r===b.Init&&a.jsx(Pt,{}),r===b.Ading&&a.jsx(et,{adData:t,setPageStatus:e})]})};export{Ft as default};
