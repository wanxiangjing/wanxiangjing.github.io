function QI(t,e){return e.forEach((function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach((function(s){if(s!=="default"&&!(s in t)){var o=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:function(){return i[s]}})}}))})),Object.freeze(t)}var Wo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ie(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function jI(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var i=function s(){if(this instanceof s){var o=[null];return o.push.apply(o,arguments),new(Function.bind.apply(e,o))}return e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach((function(s){var o=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(i,s,o.get?o:{enumerable:!0,get:function(){return t[s]}})})),i}var mv={exports:{}},Gn=function(t){return t&&t.Math===Math&&t},Ee=Gn(typeof globalThis=="object"&&globalThis)||Gn(typeof window=="object"&&window)||Gn(typeof self=="object"&&self)||Gn(typeof Wo=="object"&&Wo)||Gn(typeof Wo=="object"&&Wo)||(function(){return this})()||Function("return this")(),Ge=function(t){try{return!!t()}catch{return!0}},BI=Ge,Gc=!BI((function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")})),$I=Gc,hv=Function.prototype,Qp=hv.apply,jp=hv.call,Vc=typeof Reflect=="object"&&Reflect.apply||($I?jp.bind(Qp):function(){return jp.apply(Qp,arguments)}),pv=Gc,bv=Function.prototype,km=bv.call,qI=pv&&bv.bind.bind(km,km),Re=pv?qI:function(t){return function(){return km.apply(t,arguments)}},yv=Re,eR=yv({}.toString),tR=yv("".slice),uo=function(t){return tR(eR(t),8,-1)},iR=uo,sR=Re,xm=function(t){if(iR(t)==="Function")return sR(t)},rl=typeof document=="object"&&document.all,ze=rl===void 0&&rl!==void 0?function(t){return typeof t=="function"||t===rl}:function(t){return typeof t=="function"},mn={},oR=Ge,et=!oR((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),rR=Gc,ja=Function.prototype.call,tt=rR?ja.bind(ja):function(){return ja.apply(ja,arguments)},Ec={},_v={}.propertyIsEnumerable,Sv=Object.getOwnPropertyDescriptor,nR=Sv&&!_v.call({1:2},1);Ec.f=nR?function(t){var e=Sv(this,t);return!!e&&e.enumerable}:_v;var Es,Ld,mo=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},aR=Re,dR=Ge,cR=uo,nl=Object,lR=aR("".split),Fh=dR((function(){return!nl("z").propertyIsEnumerable(0)}))?function(t){return cR(t)==="String"?lR(t,""):nl(t)}:nl,Va=function(t){return t==null},uR=Va,mR=TypeError,Ao=function(t){if(uR(t))throw new mR("Can't call method on "+t);return t},hR=Fh,pR=Ao,Is=function(t){return hR(pR(t))},bR=ze,Gt=function(t){return typeof t=="object"?t!==null:bR(t)},zt={},al=zt,dl=Ee,yR=ze,Bp=function(t){return yR(t)?t:void 0},pt=function(t,e){return arguments.length<2?Bp(al[t])||Bp(dl[t]):al[t]&&al[t][e]||dl[t]&&dl[t][e]},_R=Re,St=_R({}.isPrototypeOf),SR=Ee,$p=SR.navigator,qp=$p&&$p.userAgent,ho=qp?String(qp):"",vv=Ee,cl=ho,e0=vv.process,t0=vv.Deno,i0=e0&&e0.versions||t0&&t0.version,s0=i0&&i0.v8;s0&&(Ld=(Es=s0.split("."))[0]>0&&Es[0]<4?1:+(Es[0]+Es[1])),!Ld&&cl&&(!(Es=cl.match(/Edge\/(\d+)/))||Es[1]>=74)&&(Es=cl.match(/Chrome\/(\d+)/))&&(Ld=+Es[1]);var Ea=Ld,o0=Ea,vR=Ge,gR=Ee,fR=gR.String,hn=!!Object.getOwnPropertySymbols&&!vR((function(){var t=Symbol("symbol detection");return!fR(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&o0&&o0<41})),ZR=hn,gv=ZR&&!Symbol.sham&&typeof Symbol.iterator=="symbol",TR=pt,IR=ze,RR=St,XR=gv,CR=Object,Pa=XR?function(t){return typeof t=="symbol"}:function(t){var e=TR("Symbol");return IR(e)&&RR(e.prototype,CR(t))},LR=String,pn=function(t){try{return LR(t)}catch{return"Object"}},WR=ze,GR=pn,VR=TypeError,Xi=function(t){if(WR(t))return t;throw new VR(GR(t)+" is not a function")},ER=Xi,PR=Va,Pc=function(t,e){var i=t[e];return PR(i)?void 0:ER(i)},ll=tt,ul=ze,ml=Gt,NR=TypeError,kR=function(t,e){var i,s;if(e==="string"&&ul(i=t.toString)&&!ml(s=ll(i,t))||ul(i=t.valueOf)&&!ml(s=ll(i,t))||e!=="string"&&ul(i=t.toString)&&!ml(s=ll(i,t)))return s;throw new NR("Can't convert object to primitive value")},fv={exports:{}},Zv=!0,r0=Ee,xR=Object.defineProperty,MR=function(t,e){try{xR(r0,t,{value:e,configurable:!0,writable:!0})}catch{r0[t]=e}return e},wR=Ee,KR=MR,n0="__core-js_shared__",a0=fv.exports=wR[n0]||KR(n0,{});(a0.versions||(a0.versions=[])).push({version:"3.39.0",mode:"pure",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Oh=fv.exports,d0=Oh,bn=function(t,e){return d0[t]||(d0[t]=e||{})},YR=Ao,HR=Object,Ci=function(t){return HR(YR(t))},FR=Re,OR=Ci,JR=FR({}.hasOwnProperty),nt=Object.hasOwn||function(t,e){return JR(OR(t),e)},UR=Re,AR=0,DR=Math.random(),zR=UR(1 .toString),Jh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+zR(++AR+DR,36)},QR=Ee,jR=bn,c0=nt,BR=Jh,$R=hn,qR=gv,Nr=QR.Symbol,hl=jR("wks"),eX=qR?Nr.for||Nr:Nr&&Nr.withoutSetter||BR,Me=function(t){return c0(hl,t)||(hl[t]=$R&&c0(Nr,t)?Nr[t]:eX("Symbol."+t)),hl[t]},tX=tt,l0=Gt,u0=Pa,iX=Pc,sX=kR,oX=Me,rX=TypeError,nX=oX("toPrimitive"),aX=function(t,e){if(!l0(t)||u0(t))return t;var i,s=iX(t,nX);if(s){if(e===void 0&&(e="default"),i=tX(s,t,e),!l0(i)||u0(i))return i;throw new rX("Can't convert object to primitive value")}return e===void 0&&(e="number"),sX(t,e)},dX=aX,cX=Pa,Uh=function(t){var e=dX(t,"string");return cX(e)?e:e+""},lX=Ee,m0=Gt,Mm=lX.document,uX=m0(Mm)&&m0(Mm.createElement),Ah=function(t){return uX?Mm.createElement(t):{}},mX=et,hX=Ge,pX=Ah,Tv=!mX&&!hX((function(){return Object.defineProperty(pX("div"),"a",{get:function(){return 7}}).a!==7})),bX=et,yX=tt,_X=Ec,SX=mo,vX=Is,gX=Uh,fX=nt,ZX=Tv,h0=Object.getOwnPropertyDescriptor;mn.f=bX?h0:function(t,e){if(t=vX(t),e=gX(e),ZX)try{return h0(t,e)}catch{}if(fX(t,e))return SX(!yX(_X.f,t,e),t[e])};var TX=Ge,IX=ze,RX=/#|\.prototype\./,Na=function(t,e){var i=CX[XX(t)];return i===WX||i!==LX&&(IX(e)?TX(e):!!e)},XX=Na.normalize=function(t){return String(t).replace(RX,".").toLowerCase()},CX=Na.data={},LX=Na.NATIVE="N",WX=Na.POLYFILL="P",Iv=Na,GX=Xi,VX=Gc,EX=xm(xm.bind),Rs=function(t,e){return GX(t),e===void 0?t:VX?EX(t,e):function(){return t.apply(e,arguments)}},Li={},PX=et,NX=Ge,Rv=PX&&NX((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),kX=Gt,xX=String,MX=TypeError,ri=function(t){if(kX(t))return t;throw new MX(xX(t)+" is not an object")},wX=et,KX=Tv,YX=Rv,Ba=ri,p0=Uh,HX=TypeError,pl=Object.defineProperty,FX=Object.getOwnPropertyDescriptor,bl="enumerable",yl="configurable",_l="writable";Li.f=wX?YX?function(t,e,i){if(Ba(t),e=p0(e),Ba(i),typeof t=="function"&&e==="prototype"&&"value"in i&&_l in i&&!i[_l]){var s=FX(t,e);s&&s[_l]&&(t[e]=i.value,i={configurable:yl in i?i[yl]:s[yl],enumerable:bl in i?i[bl]:s[bl],writable:!1})}return pl(t,e,i)}:pl:function(t,e,i){if(Ba(t),e=p0(e),Ba(i),KX)try{return pl(t,e,i)}catch{}if("get"in i||"set"in i)throw new HX("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var OX=et,JX=Li,UX=mo,Do=OX?function(t,e,i){return JX.f(t,e,UX(1,i))}:function(t,e,i){return t[e]=i,t},Vn=Ee,AX=Vc,DX=xm,zX=ze,QX=mn.f,jX=Iv,sr=zt,BX=Rs,or=Do,b0=nt,$X=function(t){var e=function(i,s,o){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(i);case 2:return new t(i,s)}return new t(i,s,o)}return AX(t,this,arguments)};return e.prototype=t.prototype,e},he=function(t,e){var i,s,o,r,n,a,c,d,l,u=t.target,p=t.global,h=t.stat,_=t.proto,y=p?Vn:h?Vn[u]:Vn[u]&&Vn[u].prototype,b=p?sr:sr[u]||or(sr,u,{})[u],S=b.prototype;for(r in e)s=!(i=jX(p?r:u+(h?".":"#")+r,t.forced))&&y&&b0(y,r),a=b[r],s&&(c=t.dontCallGetSet?(l=QX(y,r))&&l.value:y[r]),n=s&&c?c:e[r],(i||_||typeof a!=typeof n)&&(d=t.bind&&s?BX(n,Vn):t.wrap&&s?$X(n):_&&zX(n)?DX(n):n,(t.sham||n&&n.sham||a&&a.sham)&&or(d,"sham",!0),or(b,r,d),_&&(b0(sr,o=u+"Prototype")||or(sr,o,{}),or(sr[o],r,n),t.real&&S&&(i||!S[r])&&or(S,r,n)))},qX=he,eC=et,y0=Li.f;qX({target:"Object",stat:!0,forced:Object.defineProperty!==y0,sham:!eC},{defineProperty:y0});var tC=zt,Xv=tC.Object,iC=mv.exports=function(t,e,i){return Xv.defineProperty(t,e,i)};Xv.defineProperty.sham&&(iC.sham=!0);var sC=mv.exports,oC=sC,rC=oC,nC=rC,aC=nC,dC=aC,cC=dC,lC=cC,Cv=Ie(lC),uC=uo,yn=Array.isArray||function(t){return uC(t)==="Array"},mC=Math.ceil,hC=Math.floor,pC=Math.trunc||function(t){var e=+t;return(e>0?hC:mC)(e)},bC=pC,Nc=function(t){var e=+t;return e!=e||e===0?0:bC(e)},yC=Nc,_C=Math.min,SC=function(t){var e=yC(t);return e>0?_C(e,9007199254740991):0},vC=SC,Xs=function(t){return vC(t.length)},gC=TypeError,fC=9007199254740991,Dh=function(t){if(t>fC)throw gC("Maximum allowed index exceeded");return t},ZC=et,TC=Li,IC=mo,kc=function(t,e,i){ZC?TC.f(t,e,IC(0,i)):t[e]=i},RC=Me,XC=RC("toStringTag"),Lv={};Lv[XC]="z";var zh=String(Lv)==="[object z]",CC=zh,LC=ze,Wd=uo,WC=Me,GC=WC("toStringTag"),VC=Object,EC=Wd((function(){return arguments})())==="Arguments",PC=function(t,e){try{return t[e]}catch{}},_n=CC?Wd:function(t){var e,i,s;return t===void 0?"Undefined":t===null?"Null":typeof(i=PC(e=VC(t),GC))=="string"?i:EC?Wd(e):(s=Wd(e))==="Object"&&LC(e.callee)?"Arguments":s},NC=Re,kC=ze,wm=Oh,xC=NC(Function.toString);kC(wm.inspectSource)||(wm.inspectSource=function(t){return xC(t)});var Wv=wm.inspectSource,MC=Re,wC=Ge,Gv=ze,KC=_n,YC=pt,HC=Wv,Vv=function(){},Ev=YC("Reflect","construct"),Qh=/^\s*(?:class|function)\b/,FC=MC(Qh.exec),OC=!Qh.test(Vv),En=function(t){if(!Gv(t))return!1;try{return Ev(Vv,[],t),!0}catch{return!1}},Pv=function(t){if(!Gv(t))return!1;switch(KC(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return OC||!!FC(Qh,HC(t))}catch{return!0}};Pv.sham=!0;var jh=!Ev||wC((function(){var t;return En(En.call)||!En(Object)||!En((function(){t=!0}))||t}))?Pv:En,_0=yn,JC=jh,UC=Gt,AC=Me,DC=AC("species"),S0=Array,zC=function(t){var e;return _0(t)&&(e=t.constructor,(JC(e)&&(e===S0||_0(e.prototype))||UC(e)&&(e=e[DC])===null)&&(e=void 0)),e===void 0?S0:e},QC=zC,Bh=function(t,e){return new(QC(t))(e===0?0:e)},jC=Ge,BC=Me,$C=Ea,qC=BC("species"),Nv=function(t){return $C>=51||!jC((function(){var e=[];return(e.constructor={})[qC]=function(){return{foo:1}},e[t](Boolean).foo!==1}))},eL=he,tL=Ge,iL=yn,sL=Gt,oL=Ci,rL=Xs,v0=Dh,g0=kc,nL=Bh,aL=Nv,dL=Me,cL=Ea,kv=dL("isConcatSpreadable"),lL=cL>=51||!tL((function(){var t=[];return t[kv]=!1,t.concat()[0]!==t})),uL=function(t){if(!sL(t))return!1;var e=t[kv];return e!==void 0?!!e:iL(t)},mL=!lL||!aL("concat");eL({target:"Array",proto:!0,forced:mL},{concat:function(t){var e,i,s,o,r,n=oL(this),a=nL(n,0),c=0;for(e=-1,s=arguments.length;e<s;e++)if(uL(r=e===-1?n:arguments[e]))for(o=rL(r),v0(c+o),i=0;i<o;i++,c++)i in r&&g0(a,c,r[i]);else v0(c+1),g0(a,c++,r);return a.length=c,a}});var hL=_n,pL=String,Qt=function(t){if(hL(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return pL(t)},xc={},bL=Nc,yL=Math.max,_L=Math.min,xv=function(t,e){var i=bL(t);return i<0?yL(i+e,0):_L(i,e)},SL=Is,vL=xv,gL=Xs,f0=function(t){return function(e,i,s){var o=SL(e),r=gL(o);if(r===0)return!t&&-1;var n,a=vL(s,r);if(t&&i!=i){for(;r>a;)if((n=o[a++])!=n)return!0}else for(;r>a;a++)if((t||a in o)&&o[a]===i)return t||a||0;return!t&&-1}},Mv={includes:f0(!0),indexOf:f0(!1)},Mc={},fL=Re,Sl=nt,ZL=Is,TL=Mv.indexOf,IL=Mc,Z0=fL([].push),wv=function(t,e){var i,s=ZL(t),o=0,r=[];for(i in s)!Sl(IL,i)&&Sl(s,i)&&Z0(r,i);for(;e.length>o;)Sl(s,i=e[o++])&&(~TL(r,i)||Z0(r,i));return r},$h=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],RL=wv,XL=$h,wc=Object.keys||function(t){return RL(t,XL)},CL=et,LL=Rv,WL=Li,GL=ri,VL=Is,EL=wc;xc.f=CL&&!LL?Object.defineProperties:function(t,e){GL(t);for(var i,s=VL(e),o=EL(e),r=o.length,n=0;r>n;)WL.f(t,i=o[n++],s[i]);return t};var $a,PL=pt,Kv=PL("document","documentElement"),NL=bn,kL=Jh,T0=NL("keys"),Kc=function(t){return T0[t]||(T0[t]=kL(t))},xL=ri,ML=xc,I0=$h,wL=Mc,KL=Kv,YL=Ah,HL=Kc,R0=">",X0="<",Km="prototype",Ym="script",Yv=HL("IE_PROTO"),vl=function(){},Hv=function(t){return X0+Ym+R0+t+X0+"/"+Ym+R0},C0=function(t){t.write(Hv("")),t.close();var e=t.parentWindow.Object;return t=null,e},FL=function(){var t,e=YL("iframe"),i="java"+Ym+":";return e.style.display="none",KL.appendChild(e),e.src=String(i),(t=e.contentWindow.document).open(),t.write(Hv("document.F=Object")),t.close(),t.F},Gd=function(){try{$a=new ActiveXObject("htmlfile")}catch{}Gd=typeof document<"u"?document.domain&&$a?C0($a):FL():C0($a);for(var t=I0.length;t--;)delete Gd[Km][I0[t]];return Gd()};wL[Yv]=!0;var ka=Object.create||function(t,e){var i;return t!==null?(vl[Km]=xL(t),i=new vl,vl[Km]=null,i[Yv]=t):i=Gd(),e===void 0?i:ML.f(i,e)},Yc={},OL=wv,JL=$h,UL=JL.concat("length","prototype");Yc.f=Object.getOwnPropertyNames||function(t){return OL(t,UL)};var Fv={},AL=Re,Sn=AL([].slice),DL=uo,zL=Is,Ov=Yc.f,QL=Sn,Jv=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],jL=function(t){try{return Ov(t)}catch{return QL(Jv)}};Fv.f=function(t){return Jv&&DL(t)==="Window"?jL(t):Ov(zL(t))};var xa={};xa.f=Object.getOwnPropertySymbols;var BL=Do,po=function(t,e,i,s){return s&&s.enumerable?t[e]=i:BL(t,e,i),t},$L=Li,Hc=function(t,e,i){return $L.f(t,e,i)},vn={},qL=Me;vn.f=qL;var ic,fa,sc,L0=zt,eW=nt,tW=vn,iW=Li.f,Oe=function(t){var e=L0.Symbol||(L0.Symbol={});eW(e,t)||iW(e,t,{value:tW.f(t)})},sW=tt,oW=pt,rW=Me,nW=po,Uv=function(){var t=oW("Symbol"),e=t&&t.prototype,i=e&&e.valueOf,s=rW("toPrimitive");e&&!e[s]&&nW(e,s,(function(o){return sW(i,this)}),{})},aW=zh,dW=_n,cW=aW?{}.toString:function(){return"[object "+dW(this)+"]"},lW=zh,uW=Li.f,mW=Do,hW=nt,pW=cW,bW=Me,W0=bW("toStringTag"),Cs=function(t,e,i,s){var o=i?t:t&&t.prototype;o&&(hW(o,W0)||uW(o,W0,{configurable:!0,value:e}),s&&!lW&&mW(o,"toString",pW))},yW=Ee,_W=ze,G0=yW.WeakMap,SW=_W(G0)&&/native code/.test(String(G0)),vW=SW,Av=Ee,gW=Gt,fW=Do,gl=nt,fl=Oh,ZW=Kc,TW=Mc,V0="Object already initialized",Hm=Av.TypeError,IW=Av.WeakMap,RW=function(t){return sc(t)?fa(t):ic(t,{})},XW=function(t){return function(e){var i;if(!gW(e)||(i=fa(e)).type!==t)throw new Hm("Incompatible receiver, "+t+" required");return i}};if(vW||fl.state){var zi=fl.state||(fl.state=new IW);zi.get=zi.get,zi.has=zi.has,zi.set=zi.set,ic=function(t,e){if(zi.has(t))throw new Hm(V0);return e.facade=t,zi.set(t,e),e},fa=function(t){return zi.get(t)||{}},sc=function(t){return zi.has(t)}}else{var rr=ZW("state");TW[rr]=!0,ic=function(t,e){if(gl(t,rr))throw new Hm(V0);return e.facade=t,fW(t,rr,e),e},fa=function(t){return gl(t,rr)?t[rr]:{}},sc=function(t){return gl(t,rr)}}var gn={set:ic,get:fa,has:sc,enforce:RW,getterFor:XW},CW=Rs,LW=Re,WW=Fh,GW=Ci,VW=Xs,EW=Bh,E0=LW([].push),P0=function(t){var e=t===1,i=t===2,s=t===3,o=t===4,r=t===6,n=t===7,a=t===5||r;return function(c,d,l,u){for(var p,h,_=GW(c),y=WW(_),b=VW(y),S=CW(d,l),v=0,f=u||EW,g=e?f(c,b):i||n?f(c,0):void 0;b>v;v++)if((a||v in y)&&(h=S(p=y[v],v,_),t))if(e)g[v]=h;else if(h)switch(t){case 3:return!0;case 5:return p;case 6:return v;case 2:E0(g,p)}else switch(t){case 4:return!1;case 7:E0(g,p)}return r?-1:s||o?o:g}},qh={forEach:P0(0),filter:P0(2)},qa=he,Ma=Ee,ep=tt,PW=Re,Hr=et,nr=hn,NW=Ge,ot=nt,kW=St,Fm=ri,Fc=Is,tp=Uh,xW=Qt,Om=mo,jr=ka,Dv=wc,MW=Yc,zv=Fv,wW=xa,Qv=mn,jv=Li,KW=xc,Bv=Ec,N0=po,YW=Hc,ip=bn,HW=Kc,$v=Mc,k0=Jh,FW=Me,OW=vn,JW=Oe,UW=Uv,AW=Cs,qv=gn,Oc=qh.forEach,Jt=HW("hidden"),oc="Symbol",Za="prototype",DW=qv.set,x0=qv.getterFor(oc),wi=Object[Za],kr=Ma.Symbol,Vd=kr&&kr[Za],zW=Ma.RangeError,QW=Ma.TypeError,Zl=Ma.QObject,eg=Qv.f,xo=jv.f,tg=zv.f,jW=Bv.f,ig=PW([].push),fs=ip("symbols"),wa=ip("op-symbols"),BW=ip("wks"),Tl=!Zl||!Zl[Za]||!Zl[Za].findChild,sg=function(t,e,i){var s=eg(wi,e);s&&delete wi[e],xo(t,e,i),s&&t!==wi&&xo(wi,e,s)},Jm=Hr&&NW((function(){return jr(xo({},"a",{get:function(){return xo(this,"a",{value:7}).a}})).a!==7}))?sg:xo,Il=function(t,e){var i=fs[t]=jr(Vd);return DW(i,{type:oc,tag:t,description:e}),Hr||(i.description=e),i},rc=function(t,e,i){t===wi&&rc(wa,e,i),Fm(t);var s=tp(e);return Fm(i),ot(fs,s)?(i.enumerable?(ot(t,Jt)&&t[Jt][s]&&(t[Jt][s]=!1),i=jr(i,{enumerable:Om(0,!1)})):(ot(t,Jt)||xo(t,Jt,Om(1,jr(null))),t[Jt][s]=!0),Jm(t,s,i)):xo(t,s,i)},Um=function(t,e){Fm(t);var i=Fc(e),s=Dv(i).concat(rg(i));return Oc(s,(function(o){Hr&&!ep(og,i,o)||rc(t,o,i[o])})),t},$W=function(t,e){return e===void 0?jr(t):Um(jr(t),e)},og=function(t){var e=tp(t),i=ep(jW,this,e);return!(this===wi&&ot(fs,e)&&!ot(wa,e))&&(!(i||!ot(this,e)||!ot(fs,e)||ot(this,Jt)&&this[Jt][e])||i)},M0=function(t,e){var i=Fc(t),s=tp(e);if(i!==wi||!ot(fs,s)||ot(wa,s)){var o=eg(i,s);return!o||!ot(fs,s)||ot(i,Jt)&&i[Jt][s]||(o.enumerable=!0),o}},w0=function(t){var e=tg(Fc(t)),i=[];return Oc(e,(function(s){ot(fs,s)||ot($v,s)||ig(i,s)})),i},rg=function(t){var e=t===wi,i=tg(e?wa:Fc(t)),s=[];return Oc(i,(function(o){!ot(fs,o)||e&&!ot(wi,o)||ig(s,fs[o])})),s};nr||(N0(Vd=(kr=function(){if(kW(Vd,this))throw new QW("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?xW(arguments[0]):void 0,e=k0(t),i=function(s){var o=this===void 0?Ma:this;o===wi&&ep(i,wa,s),ot(o,Jt)&&ot(o[Jt],e)&&(o[Jt][e]=!1);var r=Om(1,s);try{Jm(o,e,r)}catch(n){if(!(n instanceof zW))throw n;sg(o,e,r)}};return Hr&&Tl&&Jm(wi,e,{configurable:!0,set:i}),Il(e,t)})[Za],"toString",(function(){return x0(this).tag})),N0(kr,"withoutSetter",(function(t){return Il(k0(t),t)})),Bv.f=og,jv.f=rc,KW.f=Um,Qv.f=M0,MW.f=zv.f=w0,wW.f=rg,OW.f=function(t){return Il(FW(t),t)},Hr&&YW(Vd,"description",{configurable:!0,get:function(){return x0(this).description}})),qa({global:!0,wrap:!0,forced:!nr,sham:!nr},{Symbol:kr}),Oc(Dv(BW),(function(t){JW(t)})),qa({target:oc,stat:!0,forced:!nr},{useSetter:function(){Tl=!0},useSimple:function(){Tl=!1}}),qa({target:"Object",stat:!0,forced:!nr,sham:!Hr},{create:$W,defineProperty:rc,defineProperties:Um,getOwnPropertyDescriptor:M0}),qa({target:"Object",stat:!0,forced:!nr},{getOwnPropertyNames:w0}),UW(),AW(kr,oc),$v[Jt]=!0;var qW=hn,ng=qW&&!!Symbol.for&&!!Symbol.keyFor,eG=he,tG=pt,iG=nt,sG=Qt,ag=bn,oG=ng,Rl=ag("string-to-symbol-registry"),rG=ag("symbol-to-string-registry");eG({target:"Symbol",stat:!0,forced:!oG},{for:function(t){var e=sG(t);if(iG(Rl,e))return Rl[e];var i=tG("Symbol")(e);return Rl[e]=i,rG[i]=e,i}});var nG=he,aG=nt,dG=Pa,cG=pn,lG=bn,uG=ng,K0=lG("symbol-to-string-registry");nG({target:"Symbol",stat:!0,forced:!uG},{keyFor:function(t){if(!dG(t))throw new TypeError(cG(t)+" is not a symbol");if(aG(K0,t))return K0[t]}});var mG=Re,Y0=yn,hG=ze,H0=uo,pG=Qt,F0=mG([].push),bG=function(t){if(hG(t))return t;if(Y0(t)){for(var e=t.length,i=[],s=0;s<e;s++){var o=t[s];typeof o=="string"?F0(i,o):typeof o!="number"&&H0(o)!=="Number"&&H0(o)!=="String"||F0(i,pG(o))}var r=i.length,n=!0;return function(a,c){if(n)return n=!1,c;if(Y0(this))return c;for(var d=0;d<r;d++)if(i[d]===a)return c}}},yG=he,dg=pt,cg=Vc,_G=tt,Ka=Re,lg=Ge,O0=ze,J0=Pa,ug=Sn,SG=bG,vG=hn,gG=String,io=dg("JSON","stringify"),ed=Ka(/./.exec),U0=Ka("".charAt),fG=Ka("".charCodeAt),ZG=Ka("".replace),TG=Ka(1 .toString),IG=/[\uD800-\uDFFF]/g,A0=/^[\uD800-\uDBFF]$/,D0=/^[\uDC00-\uDFFF]$/,z0=!vG||lg((function(){var t=dg("Symbol")("stringify detection");return io([t])!=="[null]"||io({a:t})!=="{}"||io(Object(t))!=="{}"})),Q0=lg((function(){return io("\uDF06\uD834")!=='"\\udf06\\ud834"'||io("\uDEAD")!=='"\\udead"'})),RG=function(t,e){var i=ug(arguments),s=SG(e);if(O0(s)||t!==void 0&&!J0(t))return i[1]=function(o,r){if(O0(s)&&(r=_G(s,this,gG(o),r)),!J0(r))return r},cg(io,null,i)},XG=function(t,e,i){var s=U0(i,e-1),o=U0(i,e+1);return ed(A0,t)&&!ed(D0,o)||ed(D0,t)&&!ed(A0,s)?"\\u"+TG(fG(t,0),16):t};io&&yG({target:"JSON",stat:!0,forced:z0||Q0},{stringify:function(t,e,i){var s=ug(arguments),o=cg(z0?RG:io,null,s);return Q0&&typeof o=="string"?ZG(o,IG,XG):o}});var CG=he,LG=hn,WG=Ge,mg=xa,GG=Ci,VG=!LG||WG((function(){mg.f(1)}));CG({target:"Object",stat:!0,forced:VG},{getOwnPropertySymbols:function(t){var e=mg.f;return e?e(GG(t)):[]}});var EG=Oe;EG("asyncIterator");var PG=Oe;PG("hasInstance");var NG=Oe;NG("isConcatSpreadable");var kG=Oe;kG("iterator");var xG=Oe;xG("match");var MG=Oe;MG("matchAll");var wG=Oe;wG("replace");var KG=Oe;KG("search");var YG=Oe;YG("species");var HG=Oe;HG("split");var FG=Oe,OG=Uv;FG("toPrimitive"),OG();var JG=pt,UG=Oe,AG=Cs;UG("toStringTag"),AG(JG("Symbol"),"Symbol");var DG=Oe;DG("unscopables");var zG=Ee,QG=Cs;QG(zG.JSON,"JSON",!0);var Mo,j0,B0,jG=zt,BG=jG.Symbol,fn={},Am=et,$G=nt,hg=Function.prototype,qG=Am&&Object.getOwnPropertyDescriptor,pg=$G(hg,"name"),e1=pg&&(function(){}).name==="something";pg&&(!Am||Am&&qG(hg,"name").configurable);var bg={PROPER:e1},t1=Ge,i1=!t1((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),s1=nt,o1=ze,r1=Ci,n1=Kc,a1=i1,$0=n1("IE_PROTO"),Dm=Object,d1=Dm.prototype,sp=a1?Dm.getPrototypeOf:function(t){var e=r1(t);if(s1(e,$0))return e[$0];var i=e.constructor;return o1(i)&&e instanceof i?i.prototype:e instanceof Dm?d1:null},c1=Ge,l1=ze,u1=Gt,m1=ka,q0=sp,h1=po,p1=Me,zm=p1("iterator"),yg=!1;[].keys&&("next"in(B0=[].keys())?(j0=q0(q0(B0)))!==Object.prototype&&(Mo=j0):yg=!0);var b1=!u1(Mo)||c1((function(){var t={};return Mo[zm].call(t)!==t}));l1((Mo=b1?{}:m1(Mo))[zm])||h1(Mo,zm,(function(){return this}));var _g={IteratorPrototype:Mo,BUGGY_SAFARI_ITERATORS:yg},y1=_g.IteratorPrototype,_1=ka,S1=mo,v1=Cs,g1=fn,f1=function(){return this},Sg=function(t,e,i,s){var o=e+" Iterator";return t.prototype=_1(y1,{next:S1(+!s,i)}),v1(t,o,!1,!0),g1[o]=f1,t},Z1=Re,T1=Xi,I1=function(t,e,i){try{return Z1(T1(Object.getOwnPropertyDescriptor(t,e)[i]))}catch{}},R1=Gt,X1=function(t){return R1(t)||t===null},C1=X1,L1=String,W1=TypeError,G1=function(t){if(C1(t))return t;throw new W1("Can't set "+L1(t)+" as a prototype")},V1=I1,E1=Gt,P1=Ao,N1=G1,k1=Object.setPrototypeOf||("__proto__"in{}?(function(){var t,e=!1,i={};try{(t=V1(Object.prototype,"__proto__","set"))(i,[]),e=i instanceof Array}catch{}return function(s,o){return P1(s),N1(o),E1(s)&&(e?t(s,o):s.__proto__=o),s}})():void 0),x1=he,M1=tt,w1=bg,K1=Sg,Y1=sp,H1=Cs,eb=po,F1=Me,tb=fn,O1=_g,J1=w1.PROPER,td=O1.BUGGY_SAFARI_ITERATORS,Xl=F1("iterator"),ib="keys",id="values",sb="entries",U1=function(){return this},vg=function(t,e,i,s,o,r,n){K1(i,e,s);var a,c,d,l=function(S){if(S===o&&y)return y;if(!td&&S&&S in h)return h[S];switch(S){case ib:case id:case sb:return function(){return new i(this,S)}}return function(){return new i(this)}},u=e+" Iterator",p=!1,h=t.prototype,_=h[Xl]||h["@@iterator"]||o&&h[o],y=!td&&_||l(o),b=e==="Array"&&h.entries||_;if(b&&(a=Y1(b.call(new t)))!==Object.prototype&&a.next&&(H1(a,u,!0,!0),tb[u]=U1),J1&&o===id&&_&&_.name!==id&&(p=!0,y=function(){return M1(_,this)}),o)if(c={values:l(id),keys:r?y:l(ib),entries:l(sb)},n)for(d in c)(td||p||!(d in h))&&eb(h,d,c[d]);else x1({target:e,proto:!0,forced:td||p},c);return n&&h[Xl]!==y&&eb(h,Xl,y,{}),tb[e]=y,c},op=function(t,e){return{value:t,done:e}},A1=Is,ob=fn,gg=gn;Li.f;var D1=vg,sd=op,fg="Array Iterator",z1=gg.set,Q1=gg.getterFor(fg);D1(Array,"Array",(function(t,e){z1(this,{type:fg,target:A1(t),index:0,kind:e})}),(function(){var t=Q1(this),e=t.target,i=t.index++;if(!e||i>=e.length)return t.target=null,sd(void 0,!0);switch(t.kind){case"keys":return sd(i,!1);case"values":return sd(e[i],!1)}return sd([i,e[i]],!1)}),"values"),ob.Arguments=ob.Array;var j1={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},B1=j1,$1=Ee,q1=Cs,rb=fn;for(var Cl in B1)q1($1[Cl],Cl),rb[Cl]=rb.Array;var eV=BG,tV=eV,iV=Me,sV=Li.f,nb=iV("metadata"),ab=Function.prototype;ab[nb]===void 0&&sV(ab,nb,{value:null});var oV=Oe;oV("asyncDispose");var rV=Oe;rV("dispose");var nV=Oe;nV("metadata");var aV=tV,dV=aV,cV=pt,lV=Re,rp=cV("Symbol"),uV=rp.keyFor,mV=lV(rp.prototype.valueOf),Zg=rp.isRegisteredSymbol||function(t){try{return uV(mV(t))!==void 0}catch{return!1}},hV=he,pV=Zg;hV({target:"Symbol",stat:!0},{isRegisteredSymbol:pV});for(var bV=bn,db=pt,yV=Re,_V=Pa,SV=Me,od=db("Symbol"),cb=od.isWellKnownSymbol,Tg=db("Object","getOwnPropertyNames"),vV=yV(od.prototype.valueOf),lb=bV("wks"),Ll=0,ub=Tg(od),gV=ub.length;Ll<gV;Ll++)try{var mb=ub[Ll];_V(od[mb])&&SV(mb)}catch{}var Ig=function(t){if(cb&&cb(t))return!0;try{for(var e=vV(t),i=0,s=Tg(lb),o=s.length;i<o;i++)if(lb[s[i]]==e)return!0}catch{}return!1},fV=he,ZV=Ig;fV({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:ZV});var TV=Oe;TV("customMatcher");var IV=Oe;IV("observable");var RV=he,XV=Zg;RV({target:"Symbol",stat:!0},{isRegistered:XV});var CV=he,LV=Ig;CV({target:"Symbol",stat:!0,forced:!0},{isWellKnown:LV});var WV=Oe;WV("matcher");var GV=Oe;GV("metadataKey");var VV=Oe;VV("patternMatch");var EV=Oe;EV("replaceAll");var PV=dV,NV=PV,kV=NV,Dn=Ie(kV),np=Re,xV=Nc,MV=Qt,wV=Ao,KV=np("".charAt),hb=np("".charCodeAt),YV=np("".slice),pb=function(t){return function(e,i){var s,o,r=MV(wV(e)),n=xV(i),a=r.length;return n<0||n>=a?t?"":void 0:(s=hb(r,n))<55296||s>56319||n+1===a||(o=hb(r,n+1))<56320||o>57343?t?KV(r,n):s:t?YV(r,n,n+2):o-56320+(s-55296<<10)+65536}},Rg={codeAt:pb(!1),charAt:pb(!0)},HV=Rg.charAt,FV=Qt,Xg=gn,OV=vg,bb=op,Cg="String Iterator",JV=Xg.set,UV=Xg.getterFor(Cg);OV(String,"String",(function(t){JV(this,{type:Cg,string:FV(t),index:0})}),(function(){var t,e=UV(this),i=e.string,s=e.index;return s>=i.length?bb(void 0,!0):(t=HV(i,s),e.index+=t.length,bb(t,!1))}));var AV=vn,DV=AV.f("iterator"),zV=DV,QV=zV,jV=QV,BV=jV,$V=BV,qV=$V,eE=qV,Lg=Ie(eE);function nc(t){return(nc=typeof Dn=="function"&&typeof Lg=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Dn=="function"&&e.constructor===Dn&&e!==Dn.prototype?"symbol":typeof e})(t)}var tE=vn,iE=tE.f("toPrimitive"),sE=iE,oE=sE,rE=oE,nE=rE,aE=nE,dE=aE,cE=dE,lE=Ie(cE);function uE(t,e){if(nc(t)!="object"||!t)return t;var i=t[lE];if(i!==void 0){var s=i.call(t,e);if(nc(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mE(t){var e=uE(t,"string");return nc(e)=="symbol"?e:e+""}function m(t,e,i){return(e=mE(e))in t?Cv(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var hE=he,pE=Re,bE=yn,yE=pE([].reverse),yb=[1,2];hE({target:"Array",proto:!0,forced:String(yb)===String(yb.reverse())},{reverse:function(){return bE(this)&&(this.length=this.length),yE(this)}});var _E=Ee,SE=zt,ls=function(t,e){var i=SE[t+"Prototype"],s=i&&i[e];if(s)return s;var o=_E[t],r=o&&o.prototype;return r&&r[e]},vE=ls,gE=vE("Array","reverse"),fE=St,ZE=gE,Wl=Array.prototype,TE=function(t){var e=t.reverse;return t===Wl||fE(Wl,t)&&e===Wl.reverse?ZE:e},IE=TE,RE=IE,XE=RE,CE=XE,LE=CE,WE=LE,GE=WE,VE=GE,Wg=Ie(VE),Gg=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,EE=Re,PE=Ao,NE=Qt,Qm=Gg,_b=EE("".replace),kE=RegExp("^["+Qm+"]+"),xE=RegExp("(^|[^"+Qm+"])["+Qm+"]+$"),ME=function(t){return function(e){var i=NE(PE(e));return 1&t&&(i=_b(i,kE,"")),2&t&&(i=_b(i,xE,"$1")),i}},wE={trim:ME(3)},KE=bg.PROPER,YE=Ge,Sb=Gg,vb="âÂá ",HE=function(t){return YE((function(){return!!Sb[t]()||vb[t]()!==vb||KE&&Sb[t].name!==t}))},FE=he,OE=wE.trim,JE=HE;FE({target:"String",proto:!0,forced:JE("trim")},{trim:function(){return OE(this)}});var UE=ls,AE=UE("String","trim"),DE=St,zE=AE,Gl=String.prototype,QE=function(t){var e=t.trim;return typeof t=="string"||t===Gl||DE(Gl,t)&&e===Gl.trim?zE:e},jE=QE,BE=jE,$E=BE,qE=$E,e9=qE,t9=e9,i9=t9,s9=i9,Js=Ie(s9),o9=Gt,r9=uo,n9=Me,a9=n9("match"),Vg=function(t){var e;return o9(t)&&((e=t[a9])!==void 0?!!e:r9(t)==="RegExp")},d9=ri,c9=function(){var t=d9(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},l9=tt,u9=nt,m9=St,h9=c9,gb=RegExp.prototype,Eg=function(t){var e=t.flags;return e!==void 0||"flags"in gb||u9(t,"flags")||!m9(gb,t)?e:l9(h9,t)},ap=Re,p9=Ci,b9=Math.floor,Vl=ap("".charAt),y9=ap("".replace),El=ap("".slice),_9=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,S9=/\$([$&'`]|\d{1,2})/g,v9=function(t,e,i,s,o,r){var n=i+t.length,a=s.length,c=S9;return o!==void 0&&(o=p9(o),c=_9),y9(r,c,(function(d,l){var u;switch(Vl(l,0)){case"$":return"$";case"&":return t;case"`":return El(e,0,i);case"'":return El(e,n);case"<":u=o[El(l,1,-1)];break;default:var p=+l;if(p===0)return d;if(p>a){var h=b9(p/10);return h===0?d:h<=a?s[h-1]===void 0?Vl(l,1):s[h-1]+Vl(l,1):d}u=s[p-1]}return u===void 0?"":u}))},g9=he,f9=tt,dp=Re,fb=Ao,Z9=ze,T9=Va,I9=Vg,ar=Qt,R9=Pc,X9=Eg,C9=v9,L9=Me,W9=L9("replace"),G9=TypeError,Pl=dp("".indexOf),V9=dp("".replace),Zb=dp("".slice),E9=Math.max;g9({target:"String",proto:!0},{replaceAll:function(t,e){var i,s,o,r,n,a,c,d,l,u,p=fb(this),h=0,_="";if(!T9(t)){if((i=I9(t))&&(s=ar(fb(X9(t))),!~Pl(s,"g")))throw new G9("`.replaceAll` does not allow non-global regexes");if(o=R9(t,W9))return f9(o,t,p,e);if(i)return V9(ar(p),t,e)}for(r=ar(p),n=ar(t),(a=Z9(e))||(e=ar(e)),c=n.length,d=E9(1,c),l=Pl(r,n);l!==-1;)u=a?ar(e(n,l,r)):C9(n,r,l,[],void 0,e),_+=Zb(r,h,l)+u,h=l+c,l=l+d>r.length?-1:Pl(r,n,l+d);return h<r.length&&(_+=Zb(r,h)),_}});var Nl,P9=ls,N9=P9("String","replaceAll"),k9=St,x9=N9,kl=String.prototype,M9=function(t){var e=t.replaceAll;return typeof t=="string"||t===kl||k9(kl,t)&&e===kl.replaceAll?x9:e},w9=M9,K9=w9,Y9=K9,H9=Y9,F9=H9,O9=F9,J9=O9,U9=J9,A9=Ie(U9),Pt=(t=>(t[t.VIDEO_SOURCE_TYPE_EXTERNAL=0]="VIDEO_SOURCE_TYPE_EXTERNAL",t[t.VIDEO_SOURCE_TYPE_INTERNAL=1]="VIDEO_SOURCE_TYPE_INTERNAL",t))(Pt||{}),Bt=(t=>(t[t.AUDIO_SOURCE_TYPE_EXTERNAL=0]="AUDIO_SOURCE_TYPE_EXTERNAL",t[t.AUDIO_SOURCE_TYPE_INTERNAL=1]="AUDIO_SOURCE_TYPE_INTERNAL",t))(Bt||{}),zn=(t=>(t[t.QUIT=0]="QUIT",t[t.DROPPED=1]="DROPPED",t[t.SWITCH_TO_INVISIBLE=2]="SWITCH_TO_INVISIBLE",t[t.KICKED_BY_ADMIN=3]="KICKED_BY_ADMIN",t))(zn||{}),D9=(t=>(t.userLeave="userLeave",t.connectionLost="connectionLost",t.userDuplicateLogin="userDuplicateLogin",t.kickedByAdmin="kickedByAdmin",t.roleChanged="roleChanged",t.onUserTokenDidExpire="onUserTokenDidExpire",t))(D9||{}),z9=(t=>(t[t.CHANNEL_PROFILE_COMMUNICATION=0]="CHANNEL_PROFILE_COMMUNICATION",t[t.CHANNEL_PROFILE_LIVE_BROADCASTING=1]="CHANNEL_PROFILE_LIVE_BROADCASTING",t))(z9||{}),Q9=(t=>(t[t.AUTO_SUBSCRIBE_MODE=0]="AUTO_SUBSCRIBE_MODE",t[t.MANUAL_SUBSCRIBE_MODE=1]="MANUAL_SUBSCRIBE_MODE",t))(Q9||{}),Fr=(t=>(t[t.SUBSCRIBE_SUCC=0]="SUBSCRIBE_SUCC",t[t.SUBSCRIBE_FAIL=1]="SUBSCRIBE_FAIL",t))(Fr||{}),es=(t=>(t[t.PUBLISH_SUCC=0]="PUBLISH_SUCC",t[t.PUBLISH_FAIL=1]="PUBLISH_FAIL",t))(es||{}),j9=(t=>(t[t.MIRROR_MODE_OFF=0]="MIRROR_MODE_OFF",t[t.MIRROR_MODE_ON=1]="MIRROR_MODE_ON",t))(j9||{}),Zo=(t=>(t[t.RENDER_MODE_HIDDEN=0]="RENDER_MODE_HIDDEN",t[t.RENDER_MODE_FIT=1]="RENDER_MODE_FIT",t[t.RENDER_MODE_FILL=2]="RENDER_MODE_FILL",t))(Zo||{}),V=(t=>(t[t.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",t[t.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",t))(V||{}),Q=(t=>(t[t.AUDIO=1]="AUDIO",t[t.VIDEO=2]="VIDEO",t[t.AUDIO_AND_VIDEO=3]="AUDIO_AND_VIDEO",t))(Q||{}),ts=(t=>(t[t.STREAM_REMOVE_REASON_UNPUBLISH=0]="STREAM_REMOVE_REASON_UNPUBLISH",t[t.STREAM_REMOVE_REASON_PUBLISH_FAILED=1]="STREAM_REMOVE_REASON_PUBLISH_FAILED",t[t.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED=2]="STREAM_REMOVE_REASON_KEEP_LIVE_FAILED",t[t.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED=3]="STREAM_REMOVE_REASON_CLIENT_DISCONNECTED",t[t.STREAM_REMOVE_REASON_REPUBLISH=4]="STREAM_REMOVE_REASON_REPUBLISH",t[t.STREAM_REMOVE_REASON_OTHER=5]="STREAM_REMOVE_REASON_OTHER",t[t.STREAM_REMOVE_REASON_TOKEN_PRIVILEGE_EXPIRED=6]="STREAM_REMOVE_REASON_TOKEN_PRIVILEGE_EXPIRED",t))(ts||{}),fe=(t=>(t[t.CONNECTION_START=0]="CONNECTION_START",t[t.CONNECTION_STATE_DISCONNECTED=1]="CONNECTION_STATE_DISCONNECTED",t[t.CONNECTION_STATE_CONNECTING=2]="CONNECTION_STATE_CONNECTING",t[t.CONNECTION_STATE_CONNECTED=3]="CONNECTION_STATE_CONNECTED",t[t.CONNECTION_STATE_RECONNECTING=4]="CONNECTION_STATE_RECONNECTING",t[t.CONNECTION_STATE_RECONNECTED=5]="CONNECTION_STATE_RECONNECTED",t[t.CONNECTION_STATE_LOST=6]="CONNECTION_STATE_LOST",t))(fe||{}),Os=(t=>(t.ICE_FAILED="iceFailed",t.NODE_CHANGE="nodeChange",t.JOIN_TIMEOUT="joinTimeout",t.NOTIFY_RECONNECT="notifyReconnect",t))(Os||{}),Tr=(t=>(t.AUTO="auto",t.H264="h264",t.VP8="vp8",t.H265="h265",t))(Tr||{}),yi=(t=>(t[t.MIRROR_TYPE_NONE=0]="MIRROR_TYPE_NONE",t[t.MIRROR_TYPE_RENDER=1]="MIRROR_TYPE_RENDER",t))(yi||{}),Qn=(t=>(t[t.NORMAL=0]="NORMAL",t[t.DISCONNECT=1]="DISCONNECT",t[t.RESET=2]="RESET",t))(Qn||{}),ac=(t=>(t[t.MICROPHONE=0]="MICROPHONE",t[t.AUDIOMIXING=1]="AUDIOMIXING",t))(ac||{}),jm=(t=>(t[t.domestic=0]="domestic",t[t.overseas=1]="overseas",t))(jm||{}),B9=(t=>(t[t.OFFLINE=0]="OFFLINE",t[t.ONLINE=1]="ONLINE",t[t.UNREACHABLE=2]="UNREACHABLE",t))(B9||{}),$9=(t=>(t[t.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",t[t.AUDIO_ONLY=1]="AUDIO_ONLY",t[t.VIDEO_ONLY=2]="VIDEO_ONLY",t))($9||{}),Pg=(t=>(t[t.PREV_FRAME=0]="PREV_FRAME",t[t.OTHER_FRAME=1]="OTHER_FRAME",t))(Pg||{}),Ed=(t=>(t[t.DISABLE=0]="DISABLE",t[t.VIDEO_STREAM_LOW=1]="VIDEO_STREAM_LOW",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t))(Ed||{}),Pd=(t=>(t[t.LOW=0]="LOW",t[t.MEDIUM=100]="MEDIUM",t[t.HIGH=200]="HIGH",t))(Pd||{}),To=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.EXCELLENT=1]="EXCELLENT",t[t.GOOD=2]="GOOD",t[t.POOR=3]="POOR",t[t.BAD=4]="BAD",t[t.VBAD=5]="VBAD",t[t.DOWN=6]="DOWN",t))(To||{}),q9=(t=>(t[t.Unknown=-1]="Unknown",t[t.SubscribeFallbackByBandwidth=0]="SubscribeFallbackByBandwidth",t[t.SubscribeRecoverByBandwidth=2]="SubscribeRecoverByBandwidth",t))(q9||{}),Xt=(t=>(t[t.communication=0]="communication",t[t.chat=5]="chat",t[t.chatRoom=6]="chatRoom",t[t.coHost=9]="coHost",t[t.meeting=16]="meeting",t[t.classRoom=18]="classRoom",t))(Xt||{}),Ir=(t=>(t[t.default=0]="default",t[t.fluent=1]="fluent",t[t.standard=2]="standard",t[t.hd=3]="hd",t[t.standardStereo=4]="standardStereo",t[t.hdMono=5]="hdMono",t))(Ir||{}),oo=(t=>(t[t.AUTO_PLAY=0]="AUTO_PLAY",t[t.VIDEO_ONLY=1]="VIDEO_ONLY",t[t.PLAY_MANUALLY=2]="PLAY_MANUALLY",t))(oo||{}),aa=(t=>(t.LC="LC",t.HEv1="HEv1",t.HEv2="HEv2",t))(aa||{}),Ng=(t=>(t.H264="H264",t.H265="H265",t))(Ng||{}),Ms=(t=>(t[t.ASR_ONLY=0]="ASR_ONLY",t[t.ASR_AND_TRANSLATION=1]="ASR_AND_TRANSLATION",t))(Ms||{}),Rr=(t=>(t[t.STARTED=0]="STARTED",t[t.STOPPED=1]="STOPPED",t[t.ERROR=2]="ERROR",t[t.UPDATED=3]="UPDATED",t))(Rr||{}),Io=(t=>(t[t.FORWARD_STREAM_STATE_SUCCESS=0]="FORWARD_STREAM_STATE_SUCCESS",t[t.FORWARD_STREAM_STATE_FAILURE=1]="FORWARD_STREAM_STATE_FAILURE",t))(Io||{}),Xr=(t=>(t[t.FORWARD_STREAM_ERROR_OK=0]="FORWARD_STREAM_ERROR_OK",t[t.FORWARD_STREAM_ERROR_INVALID_TOKEN=1202]="FORWARD_STREAM_ERROR_INVALID_TOKEN",t[t.FORWARD_STREAM_ERROR_RESPONSE=1203]="FORWARD_STREAM_ERROR_RESPONSE",t[t.FORWARD_STREAM_ERROR_REMOTE_KICKED=1204]="FORWARD_STREAM_ERROR_REMOTE_KICKED",t[t.FORWARD_STREAM_ERROR_NOT_SUPPORT=1205]="FORWARD_STREAM_ERROR_NOT_SUPPORT",t))(Xr||{}),Nd=(t=>(t[t.DEFAULT=0]="DEFAULT",t[t.HIGH=1]="HIGH",t))(Nd||{}),Qs=(t=>(t[t.VIDEO_ONLY_ONE=0]="VIDEO_ONLY_ONE",t[t.VIDEO_ON_DEMAND=1]="VIDEO_ON_DEMAND",t[t.VIDEO_ALWAYS_SIMULCAST=2]="VIDEO_ALWAYS_SIMULCAST",t))(Qs||{}),js=(t=>(t.VIDEO_STREAM_HIGH="high",t.VIDEO_STREAM_MID="mid",t.VIDEO_STREAM_LOW="low",t))(js||{}),It=(t=>(t[t.NONE=0]="NONE",t[t.AFTER_CAPTURE=1]="AFTER_CAPTURE",t[t.AFTER_PROCESS=2]="AFTER_PROCESS",t))(It||{}),kg=(t=>(t[t.ROOM_MODE_RTC=0]="ROOM_MODE_RTC",t[t.ROOM_MODE_RTS_ONLY=1]="ROOM_MODE_RTS_ONLY",t))(kg||{}),Ro=(t=>(t.PLAYER_VISIBLE="visible",t.PLAYER_INVISIBLE_BY_UNMOUNT="unmount",t.PLAYER_INVISIBLE_BY_SIZE="size",t.PLAYER_INVISIBLE_BY_STYLE="style",t.PLAYER_INVISIBLE_BY_POSITION="position",t.PLAYER_INVISIBLE_BY_COVERED="covered",t))(Ro||{}),eP=new Uint8Array(16);function tP(){if(!Nl&&!(Nl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nl(eP)}var iP=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function sP(t){return typeof t=="string"&&iP.test(t)}for(var at=[],xl=0;xl<256;++xl)at.push((xl+256).toString(16).substr(1));function oP(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(at[t[e+0]]+at[t[e+1]]+at[t[e+2]]+at[t[e+3]]+"-"+at[t[e+4]]+at[t[e+5]]+"-"+at[t[e+6]]+at[t[e+7]]+"-"+at[t[e+8]]+at[t[e+9]]+"-"+at[t[e+10]]+at[t[e+11]]+at[t[e+12]]+at[t[e+13]]+at[t[e+14]]+at[t[e+15]]).toLowerCase();if(!sP(i))throw TypeError("Stringified UUID is invalid");return i}function rP(t,e,i){var s=(t=t||{}).random||(t.rng||tP)();return s[6]=15&s[6]|64,s[8]=63&s[8]|128,oP(s)}const ro=()=>typeof window>"u",Wt=()=>rP(),Zn=t=>typeof t=="number",nP=t=>Function.prototype.toString.call(t).includes("[native code]");function Zi(t){return t==null?"undefined | null":typeof t=="string"?t:JSON.stringify({contentHint:t.contentHint,enabled:t.enabled,id:t.id,kind:t.kind,label:t.label,muted:t.muted,readyState:t.readyState})}function xg(t){return t==null?"undefined | null":typeof t=="string"?t:JSON.stringify({id:t.id,active:t.active})}function Mg(t){return t==null?"undefined | null":typeof t=="string"?t:JSON.stringify({track:Zi(t.track)})}function wg(t){return t==null?"undefined | null":typeof t=="string"?t:JSON.stringify({track:Zi(t.track)})}function Kg(t){return t==null?"undefined | null":typeof t=="string"?t:JSON.stringify({currentDirection:t.currentDirection,direction:t.direction,mid:t.mid,stopped:t.stopped,receiver:wg(t.receiver),sender:Mg(t.sender)})}const aP="@byted/ve-rtc",Ml="@byted/ve-rtc",wl="@byted/ve-rtc-cache-size";class dP{constructor(){m(this,"storeKey",void 0),m(this,"logLevel",void 0),m(this,"LogfileSize",void 0),m(this,"db",void 0),m(this,"logId",void 0),m(this,"cacheLog",void 0),m(this,"cachedSize",void 0),m(this,"preCacheTime",void 0),m(this,"timer",void 0),m(this,"_getSize",(e=>new Blob(e).size/1048576)),this.storeKey="",this.logId=1,this.cacheLog="",this.logLevel="none",this.LogfileSize=100,this._createStore()}_createStore(){if(ro()||!window.indexedDB)return;const e=indexedDB.open(aP);e.onupgradeneeded=()=>{e.result.createObjectStore(Ml);try{localStorage.removeItem(wl)}catch{}},e.onerror=i=>{},e.onsuccess=()=>{this.db=e.result,this._getCachedSize()}}_getCachedSize(){try{const e=localStorage.getItem(wl);e?this.cachedSize=Number(e):this.values().then((i=>{this.cachedSize=this._getSize(i),this._setCachedSize()}))}catch{}}_setCachedSize(){try{localStorage.setItem(wl,"".concat(this.cachedSize))}catch{}}_getStore(e){if(this.db)return this.db.transaction(Ml,e).objectStore(Ml)}set(e){return new Promise(((i,s)=>{if(this.logLevel==="none")return i();if(e&&this.preCacheTime&&this.preCacheTime-Date.now()<1e3)return this.cacheLog+=`

`.concat(this.logId,": ").concat(e),this.logId++,this.timer||(this.timer=setTimeout((()=>{this.set("")}),1e3-(this.preCacheTime-Date.now()))),i();clearTimeout(this.timer),this.timer=null;const o=this._getStore("readwrite");if(!o)return s("get store fail");this.cachedSize&&this.cachedSize>this.LogfileSize&&this.keyEarliest().then((n=>{this.get(n).then((a=>{this.del(n).then((()=>{this.cachedSize=this.cachedSize-this._getSize(["".concat(a)]),this._setCachedSize()}))}))}));const r=o.get(this.storeKey);r.onsuccess=()=>{try{const n="".concat(r.result||"").concat(this.cacheLog),a=e?"".concat(n?`

`:"").concat(this.logId,": ").concat(e):"";o.put("".concat(n).concat(a),this.storeKey),e&&this.logId++,this.cacheLog="",this.cachedSize=(this.cachedSize||0)+this._getSize(["".concat(this.cacheLog).concat(a)]),this._setCachedSize(),this.preCacheTime=Date.now(),i()}catch(n){if(!e)return s(n);this.cacheLog+=`

`.concat(this.logId,": ").concat(e),this.logId++,s(n)}},r.onerror=n=>{if(!e)return s(n);this.cacheLog+=`

`.concat(this.logId,": ").concat(e),this.logId++,s(n)}}))}get(e){return new Promise(((i,s)=>{const o=this._getStore("readonly");if(!o)return s();const r=o.get(e);r.onsuccess=()=>{i(r.result)},r.onerror=n=>{s(n)}}))}del(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.storeKey;return new Promise(((i,s)=>{const o=this._getStore("readwrite");if(!o)return s();const r=o.delete(e);r.onsuccess=()=>i(r.result),r.onerror=n=>s(n)}))}keyEarliest(){return this.keys().then((e=>{let i,s=Date.now();return e.forEach((o=>{if(!o||!o.length)return;const r=o.split("-")[0];Number(r)<s&&(s=Number(r),i=o)})),i}))}keys(){return new Promise(((e,i)=>{const s=this._getStore("readonly");if(!s)return i();if(s.getAllKeys){const r=s.getAllKeys();return r.onsuccess=()=>{e(r.result)},void(r.onerror=()=>{i()})}const o=[];s.openCursor().onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())},s.transaction.oncomplete=()=>e(o)}))}values(){return new Promise(((e,i)=>{const s=this._getStore("readonly");if(!s)return i();if(s.getAll){const r=s.getAll();return r.onsuccess=()=>{e(r.result)},void(r.onerror=()=>{i()})}const o=[];s.openCursor().onsuccess=function(){this.result&&(o.push(this.result.value),this.result.continue())},s.transaction.oncomplete=()=>e(o)}))}download(e){e=e||this.storeKey,this.get(e).then((i=>{const s=document.createElement("a");s.download="".concat(e,".txt"),s.href="data:text/paint;utf-8,".concat(i||""),s.click()}))}}var Br=new dP;let cP=class{constructor(){m(this,"_all",{})}on(t,e){const i=this._all[t];i?i.push(e):this._all[t]=[e]}once(t,e){var i=this;const s=function(){e(...arguments),i.off(t,s)};this.on(t,s)}off(t,e){const i=this._all[t];i?.splice(i.indexOf(e)>>>0,1)}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];const o=this._all[t];o?.slice().forEach((r=>r(...i)))}safeEmit(t){try{for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];return this.emit(t,...i)}catch(o){console.error(o)}}destroy(){this._all={}}};const lP=["UPLOAD_CONSOLE_LENGTH_CUT","UPLOAD_REPORT_LIMIT"];function uP(t){return lP.includes(t)}let mP=class extends cP{constructor(){super(...arguments),m(this,"config",{UPLOAD_CONSOLE_ON:!1,UPLOAD_CONSOLE_LENGTH_CUT:200,UPLOAD_REPORT_LIMIT:45e4,ENABLE_REPORT_IDB_BUFFER:!1})}setParameter(t,e){if(uP(t))try{const i=Number(e);if(Number.isNaN(i))return;this.config[t]=i}catch{return void console.warn("Cannot convert core lib parameter ".concat(t,":").concat(e," into number"))}else this.config[t]=e;this.emit(t,this.config[t])}getParameter(t){return this.config[t]}getKeys(){return Object.keys(this.config)}};const Ki=new mP;var hP=he,pP=Ci,Yg=wc,bP=Ge,yP=bP((function(){Yg(1)}));hP({target:"Object",stat:!0,forced:yP},{keys:function(t){return Yg(pP(t))}});var _P=zt,SP=_P.Object.keys,vP=SP,gP=vP,fP=gP,ZP=fP,TP=ZP,IP=TP,RP=IP,XP=Ie(RP),CP=zt,LP=CP.Object.getOwnPropertySymbols,WP=LP,GP=WP,VP=GP,EP=VP,PP=EP,NP=PP,kP=NP,dc=Ie(kP),xP=he,MP=qh.filter,wP=Nv,KP=wP("filter");xP({target:"Array",proto:!0,forced:!KP},{filter:function(t){return MP(this,t,arguments.length>1?arguments[1]:void 0)}});var YP=ls,HP=YP("Array","filter"),FP=St,OP=HP,Kl=Array.prototype,JP=function(t){var e=t.filter;return t===Kl||FP(Kl,t)&&e===Kl.filter?OP:e},UP=JP,AP=UP,DP=AP,zP=DP,QP=zP,jP=QP,BP=jP,$P=Ie(BP),Hg={exports:{}},qP=he,e2=Ge,t2=Is,Fg=mn.f,Og=et,i2=!Og||e2((function(){Fg(1)}));qP({target:"Object",stat:!0,forced:i2,sham:!Og},{getOwnPropertyDescriptor:function(t,e){return Fg(t2(t),e)}});var s2=zt,Jg=s2.Object,o2=Hg.exports=function(t,e){return Jg.getOwnPropertyDescriptor(t,e)};Jg.getOwnPropertyDescriptor.sham&&(o2.sham=!0);var r2=Hg.exports,n2=r2,a2=n2,d2=a2,c2=d2,l2=c2,u2=l2,m2=u2,Ug=Ie(m2),h2=et,p2=yn,b2=TypeError,y2=Object.getOwnPropertyDescriptor,_2=h2&&!(function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}})(),S2=_2?function(t,e){if(p2(t)&&!y2(t,"length").writable)throw new b2("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},v2=he,g2=Ci,f2=Xs,Z2=S2,T2=Dh,I2=Ge,R2=I2((function(){return[].push.call({length:4294967296},1)!==4294967297})),X2=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},C2=R2||!X2();v2({target:"Array",proto:!0,forced:C2},{push:function(t){var e=g2(this),i=f2(e),s=arguments.length;T2(i+s);for(var o=0;o<s;o++)e[i]=arguments[o],i++;return Z2(e,i),i}});var L2=ls,W2=L2("Array","push"),G2=St,V2=W2,Yl=Array.prototype,E2=function(t){var e=t.push;return t===Yl||G2(Yl,t)&&e===Yl.push?V2:e},P2=E2,N2=P2,k2=N2,x2=k2,M2=x2,w2=M2,K2=w2,Y2=Ie(K2),H2=Ge,Ag=function(t,e){var i=[][t];return!!i&&H2((function(){i.call(null,e||function(){return 1},1)}))},F2=qh.forEach,O2=Ag,J2=O2("forEach"),Tb=J2?[].forEach:function(t){return F2(this,t,arguments.length>1?arguments[1]:void 0)},U2=he;U2({target:"Array",proto:!0,forced:[].forEach!==Tb},{forEach:Tb});var A2=ls,D2=A2("Array","forEach"),z2=D2,Q2=z2,j2=_n,B2=nt,$2=St,q2=Q2,Hl=Array.prototype,eN={DOMTokenList:!0,NodeList:!0},tN=function(t){var e=t.forEach;return t===Hl||$2(Hl,t)&&e===Hl.forEach||B2(eN,j2(t))?q2:e},iN=tN,sN=iN,oN=sN,rN=oN,nN=rN,Ib=Ie(nN),aN=pt,dN=Re,cN=Yc,lN=xa,uN=ri,mN=dN([].concat),Dg=aN("Reflect","ownKeys")||function(t){var e=cN.f(uN(t)),i=lN.f;return i?mN(e,i(t)):e},hN=he,pN=et,bN=Dg,yN=Is,_N=mn,SN=kc;hN({target:"Object",stat:!0,sham:!pN},{getOwnPropertyDescriptors:function(t){for(var e,i,s=yN(t),o=_N.f,r=bN(s),n={},a=0;r.length>a;)(i=o(s,e=r[a++]))!==void 0&&SN(n,e,i);return n}});var vN=zt,gN=vN.Object.getOwnPropertyDescriptors,fN=gN,ZN=fN,TN=ZN,IN=TN,RN=IN,XN=RN,CN=XN,Rb=Ie(CN),zg={exports:{}},LN=he,WN=et,Xb=xc.f;LN({target:"Object",stat:!0,forced:Object.defineProperties!==Xb,sham:!WN},{defineProperties:Xb});var GN=zt,Qg=GN.Object,VN=zg.exports=function(t,e){return Qg.defineProperties(t,e)};Qg.defineProperties.sham&&(VN.sham=!0);var EN=zg.exports,PN=EN,NN=PN,kN=NN,xN=kN,MN=xN,wN=MN,KN=wN,YN=Ie(KN);function Cb(t,e){var i=XP(t);if(dc){var s=dc(t);e&&(s=$P(s).call(s,(function(o){return Ug(t,o).enumerable}))),Y2(i).apply(i,s)}return i}function I(t){for(var e=1;e<arguments.length;e++){var i,s,o=arguments[e]!=null?arguments[e]:{};e%2?Ib(i=Cb(Object(o),!0)).call(i,(function(r){m(t,r,o[r])})):Rb?YN(t,Rb(o)):Ib(s=Cb(Object(o))).call(s,(function(r){Cv(t,r,Ug(o,r))}))}return t}var HN=yn,FN=Xs,ON=Dh,JN=Rs,jg=function(t,e,i,s,o,r,n,a){for(var c,d,l=o,u=0,p=!!n&&JN(n,a);u<s;)u in i&&(c=p?p(i[u],u,e):i[u],r>0&&HN(c)?(d=FN(c),l=jg(t,e,c,d,l,r-1)-1):(ON(l+1),t[l]=c),l++),u++;return l},UN=jg,AN=he,DN=UN,zN=Ci,QN=Xs,jN=Nc,BN=Bh;AN({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=zN(this),i=QN(e),s=BN(e,0);return s.length=DN(s,e,e,i,0,t===void 0?1:jN(t)),s}});var $N=ls,qN=$N("Array","flat"),ek=St,tk=qN,Fl=Array.prototype,ik=function(t){var e=t.flat;return t===Fl||ek(Fl,t)&&e===Fl.flat?tk:e},sk=ik,ok=sk,rk=ok,nk=rk,ak=nk,dk=ak,ck=dk,lk=ck,Bg=Ie(lk),Ls={};(function(t){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function i(r,n){return Object.prototype.hasOwnProperty.call(r,n)}t.assign=function(r){for(var n=Array.prototype.slice.call(arguments,1);n.length;){var a=n.shift();if(a){if(typeof a!="object")throw new TypeError(a+"must be non-object");for(var c in a)i(a,c)&&(r[c]=a[c])}}return r},t.shrinkBuf=function(r,n){return r.length===n?r:r.subarray?r.subarray(0,n):(r.length=n,r)};var s={arraySet:function(r,n,a,c,d){if(n.subarray&&r.subarray)r.set(n.subarray(a,a+c),d);else for(var l=0;l<c;l++)r[d+l]=n[a+l]},flattenChunks:function(r){var n,a,c,d,l,u;for(c=0,n=0,a=r.length;n<a;n++)c+=r[n].length;for(u=new Uint8Array(c),d=0,n=0,a=r.length;n<a;n++)l=r[n],u.set(l,d),d+=l.length;return u}},o={arraySet:function(r,n,a,c,d){for(var l=0;l<c;l++)r[d+l]=n[a+l]},flattenChunks:function(r){return[].concat.apply([],r)}};t.setTyped=function(r){r?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(e)})(Ls);var jn={},$i={},Cr={},uk=Ls,mk=4,Lb=0,Wb=1,hk=2;function Tn(t){for(var e=t.length;--e>=0;)t[e]=0}var pk=0,$g=1,bk=2,yk=3,_k=258,cp=29,Ya=256,Ta=Ya+1+cp,Or=30,lp=19,qg=2*Ta+1,Go=15,Ol=16,Sk=7,up=256,ef=16,tf=17,sf=18,Bm=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],kd=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],vk=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],of=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],gk=512,vs=new Array(2*(Ta+2));Tn(vs);var da=new Array(2*Or);Tn(da);var Ia=new Array(gk);Tn(Ia);var Ra=new Array(_k-yk+1);Tn(Ra);var mp=new Array(cp);Tn(mp);var rf,nf,af,cc=new Array(Or);function Jl(t,e,i,s,o){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=s,this.max_length=o,this.has_stree=t&&t.length}function Ul(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function df(t){return t<256?Ia[t]:Ia[256+(t>>>7)]}function Xa(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function Ut(t,e,i){t.bi_valid>Ol-i?(t.bi_buf|=e<<t.bi_valid&65535,Xa(t,t.bi_buf),t.bi_buf=e>>Ol-t.bi_valid,t.bi_valid+=i-Ol):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function ss(t,e,i){Ut(t,i[2*e],i[2*e+1])}function cf(t,e){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--e>0);return i>>>1}function fk(t){t.bi_valid===16?(Xa(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function Zk(t,e){var i,s,o,r,n,a,c=e.dyn_tree,d=e.max_code,l=e.stat_desc.static_tree,u=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,_=e.stat_desc.max_length,y=0;for(r=0;r<=Go;r++)t.bl_count[r]=0;for(c[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<qg;i++)(r=c[2*c[2*(s=t.heap[i])+1]+1]+1)>_&&(r=_,y++),c[2*s+1]=r,s>d||(t.bl_count[r]++,n=0,s>=h&&(n=p[s-h]),a=c[2*s],t.opt_len+=a*(r+n),u&&(t.static_len+=a*(l[2*s+1]+n)));if(y!==0){do{for(r=_-1;t.bl_count[r]===0;)r--;t.bl_count[r]--,t.bl_count[r+1]+=2,t.bl_count[_]--,y-=2}while(y>0);for(r=_;r!==0;r--)for(s=t.bl_count[r];s!==0;)(o=t.heap[--i])>d||(c[2*o+1]!==r&&(t.opt_len+=(r-c[2*o+1])*c[2*o],c[2*o+1]=r),s--)}}function lf(t,e,i){var s,o,r=new Array(Go+1),n=0;for(s=1;s<=Go;s++)r[s]=n=n+i[s-1]<<1;for(o=0;o<=e;o++){var a=t[2*o+1];a!==0&&(t[2*o]=cf(r[a]++,a))}}function Tk(){var t,e,i,s,o,r=new Array(Go+1);for(i=0,s=0;s<cp-1;s++)for(mp[s]=i,t=0;t<1<<Bm[s];t++)Ra[i++]=s;for(Ra[i-1]=s,o=0,s=0;s<16;s++)for(cc[s]=o,t=0;t<1<<kd[s];t++)Ia[o++]=s;for(o>>=7;s<Or;s++)for(cc[s]=o<<7,t=0;t<1<<kd[s]-7;t++)Ia[256+o++]=s;for(e=0;e<=Go;e++)r[e]=0;for(t=0;t<=143;)vs[2*t+1]=8,t++,r[8]++;for(;t<=255;)vs[2*t+1]=9,t++,r[9]++;for(;t<=279;)vs[2*t+1]=7,t++,r[7]++;for(;t<=287;)vs[2*t+1]=8,t++,r[8]++;for(lf(vs,Ta+1,r),t=0;t<Or;t++)da[2*t+1]=5,da[2*t]=cf(t,5);rf=new Jl(vs,Bm,Ya+1,Ta,Go),nf=new Jl(da,kd,0,Or,Go),af=new Jl(new Array(0),vk,0,lp,Sk)}function uf(t){var e;for(e=0;e<Ta;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Or;e++)t.dyn_dtree[2*e]=0;for(e=0;e<lp;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*up]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function mf(t){t.bi_valid>8?Xa(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function Ik(t,e,i,s){mf(t),Xa(t,i),Xa(t,~i),uk.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}function Gb(t,e,i,s){var o=2*e,r=2*i;return t[o]<t[r]||t[o]===t[r]&&s[e]<=s[i]}function Al(t,e,i){for(var s=t.heap[i],o=i<<1;o<=t.heap_len&&(o<t.heap_len&&Gb(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!Gb(e,s,t.heap[o],t.depth));)t.heap[i]=t.heap[o],i=o,o<<=1;t.heap[i]=s}function Vb(t,e,i){var s,o,r,n,a=0;if(t.last_lit!==0)do s=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],o=t.pending_buf[t.l_buf+a],a++,s===0?ss(t,o,e):(ss(t,(r=Ra[o])+Ya+1,e),(n=Bm[r])!==0&&Ut(t,o-=mp[r],n),ss(t,r=df(--s),i),(n=kd[r])!==0&&Ut(t,s-=cc[r],n));while(a<t.last_lit);ss(t,up,e)}function $m(t,e){var i,s,o,r=e.dyn_tree,n=e.stat_desc.static_tree,a=e.stat_desc.has_stree,c=e.stat_desc.elems,d=-1;for(t.heap_len=0,t.heap_max=qg,i=0;i<c;i++)r[2*i]!==0?(t.heap[++t.heap_len]=d=i,t.depth[i]=0):r[2*i+1]=0;for(;t.heap_len<2;)r[2*(o=t.heap[++t.heap_len]=d<2?++d:0)]=1,t.depth[o]=0,t.opt_len--,a&&(t.static_len-=n[2*o+1]);for(e.max_code=d,i=t.heap_len>>1;i>=1;i--)Al(t,r,i);o=c;do i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Al(t,r,1),s=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=s,r[2*o]=r[2*i]+r[2*s],t.depth[o]=(t.depth[i]>=t.depth[s]?t.depth[i]:t.depth[s])+1,r[2*i+1]=r[2*s+1]=o,t.heap[1]=o++,Al(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Zk(t,e),lf(r,d,t.bl_count)}function Eb(t,e,i){var s,o,r=-1,n=e[1],a=0,c=7,d=4;for(n===0&&(c=138,d=3),e[2*(i+1)+1]=65535,s=0;s<=i;s++)o=n,n=e[2*(s+1)+1],++a<c&&o===n||(a<d?t.bl_tree[2*o]+=a:o!==0?(o!==r&&t.bl_tree[2*o]++,t.bl_tree[2*ef]++):a<=10?t.bl_tree[2*tf]++:t.bl_tree[2*sf]++,a=0,r=o,n===0?(c=138,d=3):o===n?(c=6,d=3):(c=7,d=4))}function Pb(t,e,i){var s,o,r=-1,n=e[1],a=0,c=7,d=4;for(n===0&&(c=138,d=3),s=0;s<=i;s++)if(o=n,n=e[2*(s+1)+1],!(++a<c&&o===n)){if(a<d)do ss(t,o,t.bl_tree);while(--a!=0);else o!==0?(o!==r&&(ss(t,o,t.bl_tree),a--),ss(t,ef,t.bl_tree),Ut(t,a-3,2)):a<=10?(ss(t,tf,t.bl_tree),Ut(t,a-3,3)):(ss(t,sf,t.bl_tree),Ut(t,a-11,7));a=0,r=o,n===0?(c=138,d=3):o===n?(c=6,d=3):(c=7,d=4)}}function Rk(t){var e;for(Eb(t,t.dyn_ltree,t.l_desc.max_code),Eb(t,t.dyn_dtree,t.d_desc.max_code),$m(t,t.bl_desc),e=lp-1;e>=3&&t.bl_tree[2*of[e]+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e}function Xk(t,e,i,s){var o;for(Ut(t,e-257,5),Ut(t,i-1,5),Ut(t,s-4,4),o=0;o<s;o++)Ut(t,t.bl_tree[2*of[o]+1],3);Pb(t,t.dyn_ltree,e-1),Pb(t,t.dyn_dtree,i-1)}function Ck(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&t.dyn_ltree[2*e]!==0)return Lb;if(t.dyn_ltree[18]!==0||t.dyn_ltree[20]!==0||t.dyn_ltree[26]!==0)return Wb;for(e=32;e<Ya;e++)if(t.dyn_ltree[2*e]!==0)return Wb;return Lb}Tn(cc);var Nb=!1;function Lk(t){Nb||(Tk(),Nb=!0),t.l_desc=new Ul(t.dyn_ltree,rf),t.d_desc=new Ul(t.dyn_dtree,nf),t.bl_desc=new Ul(t.bl_tree,af),t.bi_buf=0,t.bi_valid=0,uf(t)}function hf(t,e,i,s){Ut(t,(pk<<1)+(s?1:0),3),Ik(t,e,i)}function Wk(t){Ut(t,$g<<1,3),ss(t,up,vs),fk(t)}function Gk(t,e,i,s){var o,r,n=0;t.level>0?(t.strm.data_type===hk&&(t.strm.data_type=Ck(t)),$m(t,t.l_desc),$m(t,t.d_desc),n=Rk(t),o=t.opt_len+3+7>>>3,(r=t.static_len+3+7>>>3)<=o&&(o=r)):o=r=i+5,i+4<=o&&e!==-1?hf(t,e,i,s):t.strategy===mk||r===o?(Ut(t,($g<<1)+(s?1:0),3),Vb(t,vs,da)):(Ut(t,(bk<<1)+(s?1:0),3),Xk(t,t.l_desc.max_code+1,t.d_desc.max_code+1,n+1),Vb(t,t.dyn_ltree,t.dyn_dtree)),uf(t),s&&mf(t)}function Vk(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,e===0?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(Ra[i]+Ya+1)]++,t.dyn_dtree[2*df(e)]++),t.last_lit===t.lit_bufsize-1}function Ek(t,e,i,s){for(var o=65535&t,r=t>>>16&65535,n=0;i!==0;){i-=n=i>2e3?2e3:i;do r=r+(o=o+e[s++]|0)|0;while(--n);o%=65521,r%=65521}return o|r<<16}Cr._tr_init=Lk,Cr._tr_stored_block=hf,Cr._tr_flush_block=Gk,Cr._tr_tally=Vk,Cr._tr_align=Wk;var pf=Ek;function Pk(){for(var t,e=[],i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}var Nk=Pk();function kk(t,e,i,s){var o=Nk,r=s+i;t^=-1;for(var n=s;n<r;n++)t=t>>>8^o[255&(t^e[n])];return~t}var xr,bf=kk,hp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ct=Ls,Ii=Cr,yf=pf,ws=bf,xk=hp,zo=0,Mk=1,wk=3,so=4,kb=5,os=0,xb=1,Ri=-2,Kk=-3,Dl=-5,Yk=-1,Hk=1,rd=2,Fk=3,Ok=4,Jk=0,Uk=2,Jc=8,Ak=9,Dk=15,zk=8,Qk=29,jk=256,qm=jk+1+Qk,Bk=30,$k=19,qk=2*qm+1,ex=15,be=3,Bs=258,Fi=Bs+be+1,tx=32,Uc=42,eh=69,xd=73,Md=91,wd=103,Vo=113,Bn=666,rt=1,Ha=2,Yo=3,In=4,ix=3;function $s(t,e){return t.msg=xk[e],e}function Mb(t){return(t<<1)-(t>4?9:0)}function Us(t){for(var e=t.length;--e>=0;)t[e]=0}function Ks(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),i!==0&&(Ct.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,e.pending===0&&(e.pending_out=0))}function mt(t,e){Ii._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Ks(t.strm)}function ve(t,e){t.pending_buf[t.pending++]=e}function Pn(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function sx(t,e,i,s){var o=t.avail_in;return o>s&&(o=s),o===0?0:(t.avail_in-=o,Ct.arraySet(e,t.input,t.next_in,o,i),t.state.wrap===1?t.adler=yf(t.adler,e,o,i):t.state.wrap===2&&(t.adler=ws(t.adler,e,o,i)),t.next_in+=o,t.total_in+=o,o)}function _f(t,e){var i,s,o=t.max_chain_length,r=t.strstart,n=t.prev_length,a=t.nice_match,c=t.strstart>t.w_size-Fi?t.strstart-(t.w_size-Fi):0,d=t.window,l=t.w_mask,u=t.prev,p=t.strstart+Bs,h=d[r+n-1],_=d[r+n];t.prev_length>=t.good_match&&(o>>=2),a>t.lookahead&&(a=t.lookahead);do if(d[(i=e)+n]===_&&d[i+n-1]===h&&d[i]===d[r]&&d[++i]===d[r+1]){r+=2,i++;do;while(d[++r]===d[++i]&&d[++r]===d[++i]&&d[++r]===d[++i]&&d[++r]===d[++i]&&d[++r]===d[++i]&&d[++r]===d[++i]&&d[++r]===d[++i]&&d[++r]===d[++i]&&r<p);if(s=Bs-(p-r),r=p-Bs,s>n){if(t.match_start=e,n=s,s>=a)break;h=d[r+n-1],_=d[r+n]}}while((e=u[e&l])>c&&--o!=0);return n<=t.lookahead?n:t.lookahead}function Ho(t){var e,i,s,o,r,n=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=n+(n-Fi)){Ct.arraySet(t.window,t.window,n,n,0),t.match_start-=n,t.strstart-=n,t.block_start-=n,e=i=t.hash_size;do s=t.head[--e],t.head[e]=s>=n?s-n:0;while(--i);e=i=n;do s=t.prev[--e],t.prev[e]=s>=n?s-n:0;while(--i);o+=n}if(t.strm.avail_in===0)break;if(i=sx(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=i,t.lookahead+t.insert>=be)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+be-1])&t.hash_mask,t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<be)););}while(t.lookahead<Fi&&t.strm.avail_in!==0)}function ox(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Ho(t),t.lookahead===0&&e===zo)return rt;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;var s=t.block_start+i;if((t.strstart===0||t.strstart>=s)&&(t.lookahead=t.strstart-s,t.strstart=s,mt(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-Fi&&(mt(t,!1),t.strm.avail_out===0))return rt}return t.insert=0,e===so?(mt(t,!0),t.strm.avail_out===0?Yo:In):(t.strstart>t.block_start&&(mt(t,!1),t.strm.avail_out),rt)}function zl(t,e){for(var i,s;;){if(t.lookahead<Fi){if(Ho(t),t.lookahead<Fi&&e===zo)return rt;if(t.lookahead===0)break}if(i=0,t.lookahead>=be&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+be-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),i!==0&&t.strstart-i<=t.w_size-Fi&&(t.match_length=_f(t,i)),t.match_length>=be)if(s=Ii._tr_tally(t,t.strstart-t.match_start,t.match_length-be),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=be){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+be-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else s=Ii._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(mt(t,!1),t.strm.avail_out===0))return rt}return t.insert=t.strstart<be-1?t.strstart:be-1,e===so?(mt(t,!0),t.strm.avail_out===0?Yo:In):t.last_lit&&(mt(t,!1),t.strm.avail_out===0)?rt:Ha}function dr(t,e){for(var i,s,o;;){if(t.lookahead<Fi){if(Ho(t),t.lookahead<Fi&&e===zo)return rt;if(t.lookahead===0)break}if(i=0,t.lookahead>=be&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+be-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=be-1,i!==0&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-Fi&&(t.match_length=_f(t,i),t.match_length<=5&&(t.strategy===Hk||t.match_length===be&&t.strstart-t.match_start>4096)&&(t.match_length=be-1)),t.prev_length>=be&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-be,s=Ii._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-be),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=o&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+be-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=be-1,t.strstart++,s&&(mt(t,!1),t.strm.avail_out===0))return rt}else if(t.match_available){if((s=Ii._tr_tally(t,0,t.window[t.strstart-1]))&&mt(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return rt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=Ii._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<be-1?t.strstart:be-1,e===so?(mt(t,!0),t.strm.avail_out===0?Yo:In):t.last_lit&&(mt(t,!1),t.strm.avail_out===0)?rt:Ha}function rx(t,e){for(var i,s,o,r,n=t.window;;){if(t.lookahead<=Bs){if(Ho(t),t.lookahead<=Bs&&e===zo)return rt;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=be&&t.strstart>0&&(s=n[o=t.strstart-1])===n[++o]&&s===n[++o]&&s===n[++o]){r=t.strstart+Bs;do;while(s===n[++o]&&s===n[++o]&&s===n[++o]&&s===n[++o]&&s===n[++o]&&s===n[++o]&&s===n[++o]&&s===n[++o]&&o<r);t.match_length=Bs-(r-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=be?(i=Ii._tr_tally(t,1,t.match_length-be),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=Ii._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(mt(t,!1),t.strm.avail_out===0))return rt}return t.insert=0,e===so?(mt(t,!0),t.strm.avail_out===0?Yo:In):t.last_lit&&(mt(t,!1),t.strm.avail_out===0)?rt:Ha}function nx(t,e){for(var i;;){if(t.lookahead===0&&(Ho(t),t.lookahead===0)){if(e===zo)return rt;break}if(t.match_length=0,i=Ii._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(mt(t,!1),t.strm.avail_out===0))return rt}return t.insert=0,e===so?(mt(t,!0),t.strm.avail_out===0?Yo:In):t.last_lit&&(mt(t,!1),t.strm.avail_out===0)?rt:Ha}function Qi(t,e,i,s,o){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=s,this.func=o}function ax(t){t.window_size=2*t.w_size,Us(t.head),t.max_lazy_match=xr[t.level].max_lazy,t.good_match=xr[t.level].good_length,t.nice_match=xr[t.level].nice_length,t.max_chain_length=xr[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=be-1,t.match_available=0,t.ins_h=0}function dx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Jc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Ct.Buf16(2*qk),this.dyn_dtree=new Ct.Buf16(2*(2*Bk+1)),this.bl_tree=new Ct.Buf16(2*(2*$k+1)),Us(this.dyn_ltree),Us(this.dyn_dtree),Us(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Ct.Buf16(ex+1),this.heap=new Ct.Buf16(2*qm+1),Us(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Ct.Buf16(2*qm+1),Us(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Sf(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Uk,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Uc:Vo,t.adler=e.wrap===2?0:1,e.last_flush=zo,Ii._tr_init(e),os):$s(t,Ri)}function vf(t){var e=Sf(t);return e===os&&ax(t.state),e}function cx(t,e){return t&&t.state?t.state.wrap!==2?Ri:(t.state.gzhead=e,os):Ri}function gf(t,e,i,s,o,r){if(!t)return Ri;var n=1;if(e===Yk&&(e=6),s<0?(n=0,s=-s):s>15&&(n=2,s-=16),o<1||o>Ak||i!==Jc||s<8||s>15||e<0||e>9||r<0||r>Ok)return $s(t,Ri);s===8&&(s=9);var a=new dx;return t.state=a,a.strm=t,a.wrap=n,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=o+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+be-1)/be),a.window=new Ct.Buf8(2*a.w_size),a.head=new Ct.Buf16(a.hash_size),a.prev=new Ct.Buf16(a.w_size),a.lit_bufsize=1<<o+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Ct.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=e,a.strategy=r,a.method=i,vf(t)}function lx(t,e){return gf(t,e,Jc,Dk,zk,Jk)}function ux(t,e){var i,s,o,r;if(!t||!t.state||e>kb||e<0)return t?$s(t,Ri):Ri;if(s=t.state,!t.output||!t.input&&t.avail_in!==0||s.status===Bn&&e!==so)return $s(t,t.avail_out===0?Dl:Ri);if(s.strm=t,i=s.last_flush,s.last_flush=e,s.status===Uc)if(s.wrap===2)t.adler=0,ve(s,31),ve(s,139),ve(s,8),s.gzhead?(ve(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ve(s,255&s.gzhead.time),ve(s,s.gzhead.time>>8&255),ve(s,s.gzhead.time>>16&255),ve(s,s.gzhead.time>>24&255),ve(s,s.level===9?2:s.strategy>=rd||s.level<2?4:0),ve(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ve(s,255&s.gzhead.extra.length),ve(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ws(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=eh):(ve(s,0),ve(s,0),ve(s,0),ve(s,0),ve(s,0),ve(s,s.level===9?2:s.strategy>=rd||s.level<2?4:0),ve(s,ix),s.status=Vo);else{var n=Jc+(s.w_bits-8<<4)<<8;n|=(s.strategy>=rd||s.level<2?0:s.level<6?1:s.level===6?2:3)<<6,s.strstart!==0&&(n|=tx),n+=31-n%31,s.status=Vo,Pn(s,n),s.strstart!==0&&(Pn(s,t.adler>>>16),Pn(s,65535&t.adler)),t.adler=1}if(s.status===eh)if(s.gzhead.extra){for(o=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>o&&(t.adler=ws(t.adler,s.pending_buf,s.pending-o,o)),Ks(t),o=s.pending,s.pending!==s.pending_buf_size));)ve(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>o&&(t.adler=ws(t.adler,s.pending_buf,s.pending-o,o)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=xd)}else s.status=xd;if(s.status===xd)if(s.gzhead.name){o=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>o&&(t.adler=ws(t.adler,s.pending_buf,s.pending-o,o)),Ks(t),o=s.pending,s.pending===s.pending_buf_size)){r=1;break}r=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ve(s,r)}while(r!==0);s.gzhead.hcrc&&s.pending>o&&(t.adler=ws(t.adler,s.pending_buf,s.pending-o,o)),r===0&&(s.gzindex=0,s.status=Md)}else s.status=Md;if(s.status===Md)if(s.gzhead.comment){o=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>o&&(t.adler=ws(t.adler,s.pending_buf,s.pending-o,o)),Ks(t),o=s.pending,s.pending===s.pending_buf_size)){r=1;break}r=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ve(s,r)}while(r!==0);s.gzhead.hcrc&&s.pending>o&&(t.adler=ws(t.adler,s.pending_buf,s.pending-o,o)),r===0&&(s.status=wd)}else s.status=wd;if(s.status===wd&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&Ks(t),s.pending+2<=s.pending_buf_size&&(ve(s,255&t.adler),ve(s,t.adler>>8&255),t.adler=0,s.status=Vo)):s.status=Vo),s.pending!==0){if(Ks(t),t.avail_out===0)return s.last_flush=-1,os}else if(t.avail_in===0&&Mb(e)<=Mb(i)&&e!==so)return $s(t,Dl);if(s.status===Bn&&t.avail_in!==0)return $s(t,Dl);if(t.avail_in!==0||s.lookahead!==0||e!==zo&&s.status!==Bn){var a=s.strategy===rd?nx(s,e):s.strategy===Fk?rx(s,e):xr[s.level].func(s,e);if(a!==Yo&&a!==In||(s.status=Bn),a===rt||a===Yo)return t.avail_out===0&&(s.last_flush=-1),os;if(a===Ha&&(e===Mk?Ii._tr_align(s):e!==kb&&(Ii._tr_stored_block(s,0,0,!1),e===wk&&(Us(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Ks(t),t.avail_out===0))return s.last_flush=-1,os}return e!==so?os:s.wrap<=0?xb:(s.wrap===2?(ve(s,255&t.adler),ve(s,t.adler>>8&255),ve(s,t.adler>>16&255),ve(s,t.adler>>24&255),ve(s,255&t.total_in),ve(s,t.total_in>>8&255),ve(s,t.total_in>>16&255),ve(s,t.total_in>>24&255)):(Pn(s,t.adler>>>16),Pn(s,65535&t.adler)),Ks(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?os:xb)}function mx(t){var e;return t&&t.state?(e=t.state.status)!==Uc&&e!==eh&&e!==xd&&e!==Md&&e!==wd&&e!==Vo&&e!==Bn?$s(t,Ri):(t.state=null,e===Vo?$s(t,Kk):os):Ri}function hx(t,e){var i,s,o,r,n,a,c,d,l=e.length;if(!t||!t.state||(r=(i=t.state).wrap)===2||r===1&&i.status!==Uc||i.lookahead)return Ri;for(r===1&&(t.adler=yf(t.adler,e,l,0)),i.wrap=0,l>=i.w_size&&(r===0&&(Us(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new Ct.Buf8(i.w_size),Ct.arraySet(d,e,l-i.w_size,i.w_size,0),e=d,l=i.w_size),n=t.avail_in,a=t.next_in,c=t.input,t.avail_in=l,t.next_in=0,t.input=e,Ho(i);i.lookahead>=be;){s=i.strstart,o=i.lookahead-(be-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+be-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++;while(--o);i.strstart=s,i.lookahead=be-1,Ho(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=be-1,i.match_available=0,t.next_in=a,t.input=c,t.avail_in=n,i.wrap=r,os}xr=[new Qi(0,0,0,0,ox),new Qi(4,4,8,4,zl),new Qi(4,5,16,8,zl),new Qi(4,6,32,32,zl),new Qi(4,4,16,16,dr),new Qi(8,16,32,32,dr),new Qi(8,16,128,128,dr),new Qi(8,32,128,256,dr),new Qi(32,128,258,1024,dr),new Qi(32,258,258,4096,dr)],$i.deflateInit=lx,$i.deflateInit2=gf,$i.deflateReset=vf,$i.deflateResetKeep=Sf,$i.deflateSetHeader=cx,$i.deflate=ux,$i.deflateEnd=mx,$i.deflateSetDictionary=hx,$i.deflateInfo="pako deflate (from Nodeca project)";var Co={},lc=Ls,ff=!0,Zf=!0;try{String.fromCharCode.apply(null,[0])}catch{ff=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Zf=!1}for(var $n=new lc.Buf8(256),Ps=0;Ps<256;Ps++)$n[Ps]=Ps>=252?6:Ps>=248?5:Ps>=240?4:Ps>=224?3:Ps>=192?2:1;function wb(t,e){if(e<65534&&(t.subarray&&Zf||!t.subarray&&ff))return String.fromCharCode.apply(null,lc.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}function px(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}$n[254]=$n[254]=1,Co.string2buf=function(t){var e,i,s,o,r,n=t.length,a=0;for(o=0;o<n;o++)(64512&(i=t.charCodeAt(o)))==55296&&o+1<n&&(64512&(s=t.charCodeAt(o+1)))==56320&&(i=65536+(i-55296<<10)+(s-56320),o++),a+=i<128?1:i<2048?2:i<65536?3:4;for(e=new lc.Buf8(a),r=0,o=0;r<a;o++)(64512&(i=t.charCodeAt(o)))==55296&&o+1<n&&(64512&(s=t.charCodeAt(o+1)))==56320&&(i=65536+(i-55296<<10)+(s-56320),o++),i<128?e[r++]=i:i<2048?(e[r++]=192|i>>>6,e[r++]=128|63&i):i<65536?(e[r++]=224|i>>>12,e[r++]=128|i>>>6&63,e[r++]=128|63&i):(e[r++]=240|i>>>18,e[r++]=128|i>>>12&63,e[r++]=128|i>>>6&63,e[r++]=128|63&i);return e},Co.buf2binstring=function(t){return wb(t,t.length)},Co.binstring2buf=function(t){for(var e=new lc.Buf8(t.length),i=0,s=e.length;i<s;i++)e[i]=t.charCodeAt(i);return e},Co.buf2string=function(t,e){var i,s,o,r,n=e||t.length,a=new Array(2*n);for(s=0,i=0;i<n;)if((o=t[i++])<128)a[s++]=o;else if((r=$n[o])>4)a[s++]=65533,i+=r-1;else{for(o&=r===2?31:r===3?15:7;r>1&&i<n;)o=o<<6|63&t[i++],r--;r>1?a[s++]=65533:o<65536?a[s++]=o:(o-=65536,a[s++]=55296|o>>10&1023,a[s++]=56320|1023&o)}return wb(a,s)},Co.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&(192&t[i])==128;)i--;return i<0||i===0?e:i+$n[t[i]]>e?i:e};var Tf=px,ca=$i,qn=Ls,th=Co,ih=hp,bx=Tf,If=Object.prototype.toString,yx=0,Ql=4,Mr=0,Kb=1,Yb=2,_x=-1,Sx=0,vx=8;function Eo(t){if(!(this instanceof Eo))return new Eo(t);this.options=qn.assign({level:_x,method:vx,chunkSize:16384,windowBits:15,memLevel:8,strategy:Sx,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new bx,this.strm.avail_out=0;var i=ca.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==Mr)throw new Error(ih[i]);if(e.header&&ca.deflateSetHeader(this.strm,e.header),e.dictionary){var s;if(s=typeof e.dictionary=="string"?th.string2buf(e.dictionary):If.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,(i=ca.deflateSetDictionary(this.strm,s))!==Mr)throw new Error(ih[i]);this._dict_set=!0}}function pp(t,e){var i=new Eo(e);if(i.push(t,!0),i.err)throw i.msg||ih[i.err];return i.result}function gx(t,e){return(e=e||{}).raw=!0,pp(t,e)}function fx(t,e){return(e=e||{}).gzip=!0,pp(t,e)}Eo.prototype.push=function(t,e){var i,s,o=this.strm,r=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:e===!0?Ql:yx,typeof t=="string"?o.input=th.string2buf(t):If.call(t)==="[object ArrayBuffer]"?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(o.avail_out===0&&(o.output=new qn.Buf8(r),o.next_out=0,o.avail_out=r),(i=ca.deflate(o,s))!==Kb&&i!==Mr)return this.onEnd(i),this.ended=!0,!1;o.avail_out!==0&&(o.avail_in!==0||s!==Ql&&s!==Yb)||(this.options.to==="string"?this.onData(th.buf2binstring(qn.shrinkBuf(o.output,o.next_out))):this.onData(qn.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||o.avail_out===0)&&i!==Kb);return s===Ql?(i=ca.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Mr):s!==Yb||(this.onEnd(Mr),o.avail_out=0,!0)},Eo.prototype.onData=function(t){this.chunks.push(t)},Eo.prototype.onEnd=function(t){t===Mr&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=qn.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},jn.Deflate=Eo,jn.deflate=pp,jn.deflateRaw=gx,jn.gzip=fx;var ea={},Zx=Eg,Tx=Zx,Ix=St,Rx=Tx,Hb=RegExp.prototype,Xx=function(t){return t===Hb||Ix(Hb,t)?Rx(t):t.flags},Cx=Xx,Lx=Cx,Wx=Lx,Gx=Wx,Vx=Gx,Ex=Vx,Px=Ex,Nx=Px,it=Ie(Nx),Pi={},nd=30,kx=12,xx=function(t,e){var i,s,o,r,n,a,c,d,l,u,p,h,_,y,b,S,v,f,g,Z,R,T,X,L,W;i=t.state,s=t.next_in,L=t.input,o=s+(t.avail_in-5),r=t.next_out,W=t.output,n=r-(e-t.avail_out),a=r+(t.avail_out-257),c=i.dmax,d=i.wsize,l=i.whave,u=i.wnext,p=i.window,h=i.hold,_=i.bits,y=i.lencode,b=i.distcode,S=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do{_<15&&(h+=L[s++]<<_,_+=8,h+=L[s++]<<_,_+=8),f=y[h&S];t:for(;;){if(h>>>=g=f>>>24,_-=g,(g=f>>>16&255)===0)W[r++]=65535&f;else{if(!(16&g)){if(64&g){if(32&g){i.mode=kx;break e}t.msg="invalid literal/length code",i.mode=nd;break e}f=y[(65535&f)+(h&(1<<g)-1)];continue t}for(Z=65535&f,(g&=15)&&(_<g&&(h+=L[s++]<<_,_+=8),Z+=h&(1<<g)-1,h>>>=g,_-=g),_<15&&(h+=L[s++]<<_,_+=8,h+=L[s++]<<_,_+=8),f=b[h&v];;){if(h>>>=g=f>>>24,_-=g,16&(g=f>>>16&255)){if(R=65535&f,_<(g&=15)&&(h+=L[s++]<<_,(_+=8)<g&&(h+=L[s++]<<_,_+=8)),(R+=h&(1<<g)-1)>c){t.msg="invalid distance too far back",i.mode=nd;break e}if(h>>>=g,_-=g,R>(g=r-n)){if((g=R-g)>l&&i.sane){t.msg="invalid distance too far back",i.mode=nd;break e}if(T=0,X=p,u===0){if(T+=d-g,g<Z){Z-=g;do W[r++]=p[T++];while(--g);T=r-R,X=W}}else if(u<g){if(T+=d+u-g,(g-=u)<Z){Z-=g;do W[r++]=p[T++];while(--g);if(T=0,u<Z){Z-=g=u;do W[r++]=p[T++];while(--g);T=r-R,X=W}}}else if(T+=u-g,g<Z){Z-=g;do W[r++]=p[T++];while(--g);T=r-R,X=W}for(;Z>2;)W[r++]=X[T++],W[r++]=X[T++],W[r++]=X[T++],Z-=3;Z&&(W[r++]=X[T++],Z>1&&(W[r++]=X[T++]))}else{T=r-R;do W[r++]=W[T++],W[r++]=W[T++],W[r++]=W[T++],Z-=3;while(Z>2);Z&&(W[r++]=W[T++],Z>1&&(W[r++]=W[T++]))}break}if(64&g){t.msg="invalid distance code",i.mode=nd;break e}f=b[(65535&f)+(h&(1<<g)-1)]}}break}}while(s<o&&r<a);s-=Z=_>>3,h&=(1<<(_-=Z<<3))-1,t.next_in=s,t.next_out=r,t.avail_in=s<o?o-s+5:5-(s-o),t.avail_out=r<a?a-r+257:257-(r-a),i.hold=h,i.bits=_},Fb=Ls,cr=15,Ob=852,Jb=592,Ub=0,jl=1,Ab=2,Mx=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],wx=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Kx=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Yx=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Hx=function(t,e,i,s,o,r,n,a){var c,d,l,u,p,h,_,y,b,S=a.bits,v=0,f=0,g=0,Z=0,R=0,T=0,X=0,L=0,W=0,M=0,k=null,U=0,D=new Fb.Buf16(cr+1),ie=new Fb.Buf16(cr+1),B=null,$=0;for(v=0;v<=cr;v++)D[v]=0;for(f=0;f<s;f++)D[e[i+f]]++;for(R=S,Z=cr;Z>=1&&D[Z]===0;Z--);if(R>Z&&(R=Z),Z===0)return o[r++]=20971520,o[r++]=20971520,a.bits=1,0;for(g=1;g<Z&&D[g]===0;g++);for(R<g&&(R=g),L=1,v=1;v<=cr;v++)if(L<<=1,(L-=D[v])<0)return-1;if(L>0&&(t===Ub||Z!==1))return-1;for(ie[1]=0,v=1;v<cr;v++)ie[v+1]=ie[v]+D[v];for(f=0;f<s;f++)e[i+f]!==0&&(n[ie[e[i+f]]++]=f);if(t===Ub?(k=B=n,h=19):t===jl?(k=Mx,U-=257,B=wx,$-=257,h=256):(k=Kx,B=Yx,h=-1),M=0,f=0,v=g,p=r,T=R,X=0,l=-1,u=(W=1<<R)-1,t===jl&&W>Ob||t===Ab&&W>Jb)return 1;for(;;){_=v-X,n[f]<h?(y=0,b=n[f]):n[f]>h?(y=B[$+n[f]],b=k[U+n[f]]):(y=96,b=0),c=1<<v-X,g=d=1<<T;do o[p+(M>>X)+(d-=c)]=_<<24|y<<16|b;while(d!==0);for(c=1<<v-1;M&c;)c>>=1;if(c!==0?(M&=c-1,M+=c):M=0,f++,--D[v]==0){if(v===Z)break;v=e[i+n[f]]}if(v>R&&(M&u)!==l){for(X===0&&(X=R),p+=g,L=1<<(T=v-X);T+X<Z&&!((L-=D[T+X])<=0);)T++,L<<=1;if(W+=1<<T,t===jl&&W>Ob||t===Ab&&W>Jb)return 1;o[l=M&u]=R<<24|T<<16|p-r}}return M!==0&&(o[p+M]=v-X<<24|64<<16),a.bits=R,0},ei=Ls,sh=pf,ji=bf,Fx=xx,la=Hx,Ox=0,Rf=1,Xf=2,Db=4,Jx=5,ad=6,Fo=0,Ux=1,Ax=2,Oi=-2,Cf=-3,Lf=-4,Dx=-5,zb=8,Wf=1,Qb=2,jb=3,Bb=4,$b=5,qb=6,ey=7,ty=8,iy=9,sy=10,uc=11,ps=12,Bl=13,oy=14,$l=15,ry=16,ny=17,ay=18,dy=19,dd=20,cd=21,cy=22,ly=23,uy=24,my=25,hy=26,ql=27,py=28,by=29,Ke=30,Gf=31,zx=852,Qx=592,jx=15,Bx=jx;function yy(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function $x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ei.Buf16(320),this.work=new ei.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Vf(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Wf,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new ei.Buf32(zx),e.distcode=e.distdyn=new ei.Buf32(Qx),e.sane=1,e.back=-1,Fo):Oi}function Ef(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,Vf(t)):Oi}function Pf(t,e){var i,s;return t&&t.state?(s=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Oi:(s.window!==null&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,Ef(t))):Oi}function Nf(t,e){var i,s;return t?(s=new $x,t.state=s,s.window=null,(i=Pf(t,e))!==Fo&&(t.state=null),i):Oi}function qx(t){return Nf(t,Bx)}var eu,tu,_y=!0;function eM(t){if(_y){var e;for(eu=new ei.Buf32(512),tu=new ei.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(la(Rf,t.lens,0,288,eu,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;la(Xf,t.lens,0,32,tu,0,t.work,{bits:5}),_y=!1}t.lencode=eu,t.lenbits=9,t.distcode=tu,t.distbits=5}function kf(t,e,i,s){var o,r=t.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new ei.Buf8(r.wsize)),s>=r.wsize?(ei.arraySet(r.window,e,i-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((o=r.wsize-r.wnext)>s&&(o=s),ei.arraySet(r.window,e,i-s,o,r.wnext),(s-=o)?(ei.arraySet(r.window,e,i-s,s,0),r.wnext=s,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0}function tM(t,e){var i,s,o,r,n,a,c,d,l,u,p,h,_,y,b,S,v,f,g,Z,R,T,X,L,W=0,M=new ei.Buf8(4),k=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return Oi;(i=t.state).mode===ps&&(i.mode=Bl),n=t.next_out,o=t.output,c=t.avail_out,r=t.next_in,s=t.input,a=t.avail_in,d=i.hold,l=i.bits,u=a,p=c,T=Fo;e:for(;;)switch(i.mode){case Wf:if(i.wrap===0){i.mode=Bl;break}for(;l<16;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(2&i.wrap&&d===35615){i.check=0,M[0]=255&d,M[1]=d>>>8&255,i.check=ji(i.check,M,2,0),d=0,l=0,i.mode=Qb;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31){t.msg="incorrect header check",i.mode=Ke;break}if((15&d)!==zb){t.msg="unknown compression method",i.mode=Ke;break}if(l-=4,R=8+(15&(d>>>=4)),i.wbits===0)i.wbits=R;else if(R>i.wbits){t.msg="invalid window size",i.mode=Ke;break}i.dmax=1<<R,t.adler=i.check=1,i.mode=512&d?sy:ps,d=0,l=0;break;case Qb:for(;l<16;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(i.flags=d,(255&it(i))!==zb){t.msg="unknown compression method",i.mode=Ke;break}if(57344&it(i)){t.msg="unknown header flags set",i.mode=Ke;break}i.head&&(i.head.text=d>>8&1),512&it(i)&&(M[0]=255&d,M[1]=d>>>8&255,i.check=ji(i.check,M,2,0)),d=0,l=0,i.mode=jb;case jb:for(;l<32;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}i.head&&(i.head.time=d),512&it(i)&&(M[0]=255&d,M[1]=d>>>8&255,M[2]=d>>>16&255,M[3]=d>>>24&255,i.check=ji(i.check,M,4,0)),d=0,l=0,i.mode=Bb;case Bb:for(;l<16;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&it(i)&&(M[0]=255&d,M[1]=d>>>8&255,i.check=ji(i.check,M,2,0)),d=0,l=0,i.mode=$b;case $b:if(1024&it(i)){for(;l<16;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}i.length=d,i.head&&(i.head.extra_len=d),512&it(i)&&(M[0]=255&d,M[1]=d>>>8&255,i.check=ji(i.check,M,2,0)),d=0,l=0}else i.head&&(i.head.extra=null);i.mode=qb;case qb:if(1024&it(i)&&((h=i.length)>a&&(h=a),h&&(i.head&&(R=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),ei.arraySet(i.head.extra,s,r,h,R)),512&it(i)&&(i.check=ji(i.check,s,h,r)),a-=h,r+=h,i.length-=h),i.length))break e;i.length=0,i.mode=ey;case ey:if(2048&it(i)){if(a===0)break e;h=0;do R=s[r+h++],i.head&&R&&i.length<65536&&(i.head.name+=String.fromCharCode(R));while(R&&h<a);if(512&it(i)&&(i.check=ji(i.check,s,h,r)),a-=h,r+=h,R)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=ty;case ty:if(4096&it(i)){if(a===0)break e;h=0;do R=s[r+h++],i.head&&R&&i.length<65536&&(i.head.comment+=String.fromCharCode(R));while(R&&h<a);if(512&it(i)&&(i.check=ji(i.check,s,h,r)),a-=h,r+=h,R)break e}else i.head&&(i.head.comment=null);i.mode=iy;case iy:if(512&it(i)){for(;l<16;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(d!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Ke;break}d=0,l=0}i.head&&(i.head.hcrc=it(i)>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=ps;break;case sy:for(;l<32;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}t.adler=i.check=yy(d),d=0,l=0,i.mode=uc;case uc:if(i.havedict===0)return t.next_out=n,t.avail_out=c,t.next_in=r,t.avail_in=a,i.hold=d,i.bits=l,Ax;t.adler=i.check=1,i.mode=ps;case ps:if(e===Jx||e===ad)break e;case Bl:if(i.last){d>>>=7&l,l-=7&l,i.mode=ql;break}for(;l<3;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}switch(i.last=1&d,l-=1,3&(d>>>=1)){case 0:i.mode=oy;break;case 1:if(eM(i),i.mode=dd,e===ad){d>>>=2,l-=2;break e}break;case 2:i.mode=ny;break;case 3:t.msg="invalid block type",i.mode=Ke}d>>>=2,l-=2;break;case oy:for(d>>>=7&l,l-=7&l;l<32;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if((65535&d)!=(d>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Ke;break}if(i.length=65535&d,d=0,l=0,i.mode=$l,e===ad)break e;case $l:i.mode=ry;case ry:if(h=i.length){if(h>a&&(h=a),h>c&&(h=c),h===0)break e;ei.arraySet(o,s,r,h,n),a-=h,r+=h,c-=h,n+=h,i.length-=h;break}i.mode=ps;break;case ny:for(;l<14;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(i.nlen=257+(31&d),d>>>=5,l-=5,i.ndist=1+(31&d),d>>>=5,l-=5,i.ncode=4+(15&d),d>>>=4,l-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Ke;break}i.have=0,i.mode=ay;case ay:for(;i.have<i.ncode;){for(;l<3;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}i.lens[k[i.have++]]=7&d,d>>>=3,l-=3}for(;i.have<19;)i.lens[k[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,X={bits:i.lenbits},T=la(Ox,i.lens,0,19,i.lencode,0,i.work,X),i.lenbits=X.bits,T){t.msg="invalid code lengths set",i.mode=Ke;break}i.have=0,i.mode=dy;case dy:for(;i.have<i.nlen+i.ndist;){for(;S=(W=i.lencode[d&(1<<i.lenbits)-1])>>>16&255,v=65535&W,!((b=W>>>24)<=l);){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(v<16)d>>>=b,l-=b,i.lens[i.have++]=v;else{if(v===16){for(L=b+2;l<L;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(d>>>=b,l-=b,i.have===0){t.msg="invalid bit length repeat",i.mode=Ke;break}R=i.lens[i.have-1],h=3+(3&d),d>>>=2,l-=2}else if(v===17){for(L=b+3;l<L;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}l-=b,R=0,h=3+(7&(d>>>=b)),d>>>=3,l-=3}else{for(L=b+7;l<L;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}l-=b,R=0,h=11+(127&(d>>>=b)),d>>>=7,l-=7}if(i.have+h>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Ke;break}for(;h--;)i.lens[i.have++]=R}}if(i.mode===Ke)break;if(i.lens[256]===0){t.msg="invalid code -- missing end-of-block",i.mode=Ke;break}if(i.lenbits=9,X={bits:i.lenbits},T=la(Rf,i.lens,0,i.nlen,i.lencode,0,i.work,X),i.lenbits=X.bits,T){t.msg="invalid literal/lengths set",i.mode=Ke;break}if(i.distbits=6,i.distcode=i.distdyn,X={bits:i.distbits},T=la(Xf,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,X),i.distbits=X.bits,T){t.msg="invalid distances set",i.mode=Ke;break}if(i.mode=dd,e===ad)break e;case dd:i.mode=cd;case cd:if(a>=6&&c>=258){t.next_out=n,t.avail_out=c,t.next_in=r,t.avail_in=a,i.hold=d,i.bits=l,Fx(t,p),n=t.next_out,o=t.output,c=t.avail_out,r=t.next_in,s=t.input,a=t.avail_in,d=i.hold,l=i.bits,i.mode===ps&&(i.back=-1);break}for(i.back=0;S=(W=i.lencode[d&(1<<i.lenbits)-1])>>>16&255,v=65535&W,!((b=W>>>24)<=l);){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(S&&!(240&S)){for(f=b,g=S,Z=v;S=(W=i.lencode[Z+((d&(1<<f+g)-1)>>f)])>>>16&255,v=65535&W,!(f+(b=W>>>24)<=l);){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}d>>>=f,l-=f,i.back+=f}if(d>>>=b,l-=b,i.back+=b,i.length=v,S===0){i.mode=hy;break}if(32&S){i.back=-1,i.mode=ps;break}if(64&S){t.msg="invalid literal/length code",i.mode=Ke;break}i.extra=15&S,i.mode=cy;case cy:if(i.extra){for(L=i.extra;l<L;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,l-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=ly;case ly:for(;S=(W=i.distcode[d&(1<<i.distbits)-1])>>>16&255,v=65535&W,!((b=W>>>24)<=l);){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(!(240&S)){for(f=b,g=S,Z=v;S=(W=i.distcode[Z+((d&(1<<f+g)-1)>>f)])>>>16&255,v=65535&W,!(f+(b=W>>>24)<=l);){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}d>>>=f,l-=f,i.back+=f}if(d>>>=b,l-=b,i.back+=b,64&S){t.msg="invalid distance code",i.mode=Ke;break}i.offset=v,i.extra=15&S,i.mode=uy;case uy:if(i.extra){for(L=i.extra;l<L;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,l-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Ke;break}i.mode=my;case my:if(c===0)break e;if(h=p-c,i.offset>h){if((h=i.offset-h)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Ke;break}h>i.wnext?(h-=i.wnext,_=i.wsize-h):_=i.wnext-h,h>i.length&&(h=i.length),y=i.window}else y=o,_=n-i.offset,h=i.length;h>c&&(h=c),c-=h,i.length-=h;do o[n++]=y[_++];while(--h);i.length===0&&(i.mode=cd);break;case hy:if(c===0)break e;o[n++]=i.length,c--,i.mode=cd;break;case ql:if(i.wrap){for(;l<32;){if(a===0)break e;a--,d|=s[r++]<<l,l+=8}if(p-=c,t.total_out+=p,i.total+=p,p&&(t.adler=i.check=it(i)?ji(i.check,o,p,n-p):sh(i.check,o,p,n-p)),p=c,(it(i)?d:yy(d))!==i.check){t.msg="incorrect data check",i.mode=Ke;break}d=0,l=0}i.mode=py;case py:if(i.wrap&&it(i)){for(;l<32;){if(a===0)break e;a--,d+=s[r++]<<l,l+=8}if(d!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Ke;break}d=0,l=0}i.mode=by;case by:T=Ux;break e;case Ke:T=Cf;break e;case Gf:return Lf;default:return Oi}return t.next_out=n,t.avail_out=c,t.next_in=r,t.avail_in=a,i.hold=d,i.bits=l,(i.wsize||p!==t.avail_out&&i.mode<Ke&&(i.mode<ql||e!==Db))&&kf(t,t.output,t.next_out,p-t.avail_out),u-=t.avail_in,p-=t.avail_out,t.total_in+=u,t.total_out+=p,i.total+=p,i.wrap&&p&&(t.adler=i.check=it(i)?ji(i.check,o,p,t.next_out-p):sh(i.check,o,p,t.next_out-p)),t.data_type=i.bits+(i.last?64:0)+(i.mode===ps?128:0)+(i.mode===dd||i.mode===$l?256:0),(u===0&&p===0||e===Db)&&T===Fo&&(T=Dx),T}function iM(t){if(!t||!t.state)return Oi;var e=t.state;return e.window&&(e.window=null),t.state=null,Fo}function sM(t,e){var i;return t&&t.state&&2&(i=t.state).wrap?(i.head=e,e.done=!1,Fo):Oi}function oM(t,e){var i,s=e.length;return t&&t.state?(i=t.state).wrap!==0&&i.mode!==uc?Oi:i.mode===uc&&sh(1,e,s,0)!==i.check?Cf:kf(t,e,s,s)?(i.mode=Gf,Lf):(i.havedict=1,Fo):Oi}Pi.inflateReset=Ef,Pi.inflateReset2=Pf,Pi.inflateResetKeep=Vf,Pi.inflateInit=qx,Pi.inflateInit2=Nf,Pi.inflate=tM,Pi.inflateEnd=iM,Pi.inflateGetHeader=sM,Pi.inflateSetDictionary=oM,Pi.inflateInfo="pako inflate (from Nodeca project)";var xf={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function rM(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var nM=rM,Jr=Pi,ta=Ls,Kd=Co,De=xf,oh=hp,aM=Tf,dM=nM,Mf=Object.prototype.toString;function Po(t){if(!(this instanceof Po))return new Po(t);this.options=ta.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new aM,this.strm.avail_out=0;var i=Jr.inflateInit2(this.strm,e.windowBits);if(i!==De.Z_OK)throw new Error(oh[i]);if(this.header=new dM,Jr.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Kd.string2buf(e.dictionary):Mf.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=Jr.inflateSetDictionary(this.strm,e.dictionary))!==De.Z_OK))throw new Error(oh[i])}function rh(t,e){var i=new Po(e);if(i.push(t,!0),i.err)throw i.msg||oh[i.err];return i.result}function cM(t,e){return(e=e||{}).raw=!0,rh(t,e)}Po.prototype.push=function(t,e){var i,s,o,r,n,a=this.strm,c=this.options.chunkSize,d=this.options.dictionary,l=!1;if(this.ended)return!1;s=e===~~e?e:e===!0?De.Z_FINISH:De.Z_NO_FLUSH,typeof t=="string"?a.input=Kd.binstring2buf(t):Mf.call(t)==="[object ArrayBuffer]"?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(a.avail_out===0&&(a.output=new ta.Buf8(c),a.next_out=0,a.avail_out=c),(i=Jr.inflate(a,De.Z_NO_FLUSH))===De.Z_NEED_DICT&&d&&(i=Jr.inflateSetDictionary(this.strm,d)),i===De.Z_BUF_ERROR&&l===!0&&(i=De.Z_OK,l=!1),i!==De.Z_STREAM_END&&i!==De.Z_OK)return this.onEnd(i),this.ended=!0,!1;a.next_out&&(a.avail_out!==0&&i!==De.Z_STREAM_END&&(a.avail_in!==0||s!==De.Z_FINISH&&s!==De.Z_SYNC_FLUSH)||(this.options.to==="string"?(o=Kd.utf8border(a.output,a.next_out),r=a.next_out-o,n=Kd.buf2string(a.output,o),a.next_out=r,a.avail_out=c-r,r&&ta.arraySet(a.output,a.output,o,r,0),this.onData(n)):this.onData(ta.shrinkBuf(a.output,a.next_out)))),a.avail_in===0&&a.avail_out===0&&(l=!0)}while((a.avail_in>0||a.avail_out===0)&&i!==De.Z_STREAM_END);return i===De.Z_STREAM_END&&(s=De.Z_FINISH),s===De.Z_FINISH?(i=Jr.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===De.Z_OK):s!==De.Z_SYNC_FLUSH||(this.onEnd(De.Z_OK),a.avail_out=0,!0)},Po.prototype.onData=function(t){this.chunks.push(t)},Po.prototype.onEnd=function(t){t===De.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ta.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},ea.Inflate=Po,ea.inflate=rh,ea.inflateRaw=cM,ea.ungzip=rh;var lM=Ls.assign,uM=jn,mM=ea,hM=xf,wf={};lM(wf,uM,mM,hM);var pM=wf,nh=Ie(pM);let bM=1,yM=class{constructor(t){m(this,"lockingPromise",Promise.resolve()),m(this,"locks",0),m(this,"name",""),m(this,"lockId",void 0),this.lockId=bM++,t&&(this.name=t)}get isLocked(){return this.locks>0}lock(){let t;this.locks+=1;const e=new Promise((s=>{t=()=>{this.locks-=1,s()}})),i=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>e)),i}};const Sy="VERTC",Nn=()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;class Ht{constructor(e){m(this,"storeName",void 0),m(this,"pendingList",[]),this.storeName=e,!ro()&&Nn()&&this._checkAndCreateStore(e)}async _checkAndCreateStore(e,i){const s=await Ht._promiseLock.lock();if(Nn().databases){let o;await new Promise((r=>{const n=()=>Nn().databases().finally(r);o=setInterval(n,100),n()})).finally((()=>clearInterval(o)))}return new Promise((o=>{Ht.db&&(Ht.db.close(),delete Ht.db);const r=i?Nn().open(Sy,i):Nn().open(Sy);r.onupgradeneeded=()=>{r.result.createObjectStore(e)},r.onerror=()=>{console.error("IndexedDBInterface error",r.error)},r.onsuccess=()=>{const n=r.result;Ht.db=n;try{Ht.db.transaction(this.storeName,"readonly"),this.pendingList.forEach((async a=>{let{txMode:c,pendResolve:d,pendReject:l}=a;try{d(await this._getStore(c))}catch{l()}})),o()}catch{o(this._checkAndCreateStore(e,n.version+1))}finally{s()}}}))}async _getStore(e){const i=await Ht._promiseLock.lock();return new Promise(((s,o)=>{if(!Ht.db)return this.pendingList.push({txMode:e,pendResolve:s,pendReject:o}),void i();try{s(Ht.db.transaction(this.storeName,e).objectStore(this.storeName))}catch{return void this.pendingList.push({txMode:e,pendResolve:s,pendReject:o})}finally{i()}}))}async put2String(e,i){let s;try{s=JSON.stringify(e)}catch{s=e}return await this.put(s,i)}async get4String(e){const i=await this.get(e);let s;try{s=JSON.parse(i)}catch{s=i}return s}async put(e,i){const s=await this._getStore("readwrite");return new Promise(((o,r)=>{const n=s.put(e,i);n.onsuccess=()=>{o()},n.onerror=a=>{r(a)}}))}async get(e){const i=await this._getStore("readonly");return new Promise(((s,o)=>{const r=i.get(e);r.onsuccess=()=>{s(r.result)},r.onerror=n=>{o(n)}}))}async del(e){const i=await this._getStore("readwrite");return new Promise(((s,o)=>{const r=i.delete(e);r.onsuccess=()=>{s()},r.onerror=n=>{o(n)}}))}}m(Ht,"db",void 0),m(Ht,"state","init"),m(Ht,"_promiseLock",new yM("iDB"));var _M=he,SM=Mv.includes,vM=Ge,gM=vM((function(){return!Array(1).includes()}));_M({target:"Array",proto:!0,forced:gM},{includes:function(t){return SM(this,t,arguments.length>1?arguments[1]:void 0)}});var fM=ls,ZM=fM("Array","includes"),TM=Vg,IM=TypeError,RM=function(t){if(TM(t))throw new IM("The method doesn't accept regular expressions");return t},XM=Me,CM=XM("match"),LM=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[CM]=!1,"/./"[t](e)}catch{}}return!1},WM=he,GM=Re,VM=RM,EM=Ao,vy=Qt,PM=LM,NM=GM("".indexOf);WM({target:"String",proto:!0,forced:!PM("includes")},{includes:function(t){return!!~NM(vy(EM(this)),vy(VM(t)),arguments.length>1?arguments[1]:void 0)}});var kM=ls,xM=kM("String","includes"),gy=St,MM=ZM,wM=xM,iu=Array.prototype,su=String.prototype,KM=function(t){var e=t.includes;return t===iu||gy(iu,t)&&e===iu.includes?MM:typeof t=="string"||t===su||gy(su,t)&&e===su.includes?wM:e},YM=KM,HM=YM,FM=HM,OM=FM,JM=OM,UM=JM,AM=UM,Kf=Ie(AM);function DM(t,e){if(t==null)return{};var i={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(Kf(e).call(e,s))continue;i[s]=t[s]}return i}function bo(t,e){if(t==null)return{};var i,s,o=DM(t,e);if(dc){var r=dc(t);for(s=0;s<r.length;s++)i=r[s],Kf(e).call(e,i)||{}.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}const zM=["message"];function QM(t){return t.report_id!==void 0}class jM{constructor(){m(this,"name","LongStringReportor"),m(this,"inBuffer",[]),m(this,"outBuffer",[])}push(e){e.message&&this.inBuffer.push(I(I({},e),{},{message:{id:Wt().slice(0,3),index:0,end:!0,msg:e.message}}))}splice(e){const i=[];let s=0;for(;this.outBuffer.length;){const o=JSON.stringify(this.outBuffer[0]).length;if(!(o<e))break;e-=o,s+=o,i.push(this.outBuffer.shift())}for(;this.inBuffer[0]&&e>0;){const o=this.inBuffer[0],{message:r}=o,n=I(I({},bo(o,zM)),{},{message:I(I({},r),{},{msg:""})}),a=JSON.stringify(n).length,c=e-a,d=I({},n);if(c>r.msg.length)d.message.msg=r.msg,this.inBuffer.shift();else{if(!(c>=10))break;{const p=r.msg.slice(0,c);d.message.msg=p,d.message.end=!1,this.inBuffer[0].message.msg=r.msg.slice(c),this.inBuffer[0].message.index++}}const l=JSON.stringify(d.message),u=l.length;e-=u+a,s+=u+a,i.push(I(I({},d),{},{message:l}))}return{payload:i,payloadSize:s}}unshift(e){this.outBuffer=e.concat(this.outBuffer)}get(){return[...this.outBuffer,...this.inBuffer.map((e=>I(I({},e),{},{message:JSON.stringify(e.message)})))]}set(e){e.forEach((i=>{QM(i)?this.outBuffer.push(i):(i.message||(i.message=""),this.inBuffer.push(I(I({},i),{},{message:JSON.parse(i.message)})))})),this.outBuffer=[].concat(this.outBuffer),this.inBuffer=[].concat(this.inBuffer)}isEmpty(){return this.inBuffer.length===0&&this.outBuffer.length===0}}var ou,ru,Yf=new jM;const BM={product_line:"rtc",report_version:"5",os:"web",user_agent:ro()?"":(ou=navigator)===null||ou===void 0?void 0:ou.userAgent,platform:"web",product:"webrtc",app_state:"active"},fy=typeof window<"u"&&(window.location.search.includes("_rtc_debug_")||((ru=window.localStorage)===null||ru===void 0?void 0:ru.getItem("_rtc_debug_")));class $M{constructor(e){m(this,"_buffer",void 0),this._buffer=new Ht(e)}async set(e,i){await this._buffer.put2String(e,i)}async get(e){var i;let s=[];try{s=await this._buffer.get4String(e)}catch{}return(i=s)!==null&&i!==void 0?i:[]}}class qM{constructor(){m(this,"reportCommon",BM),m(this,"reportIds",new Map),m(this,"dataBuffer",[]),m(this,"reportorList",[]),m(this,"dbBuffer",void 0),m(this,"posting",!1),m(this,"sucSendTimer",void 0),m(this,"preSucTime",0),m(this,"errSendTimer",void 0),m(this,"errSendDelay",100),m(this,"_logServerUrl",void 0),m(this,"_retryCount",0),m(this,"_reportLimit",5e5),m(this,"_disableTimeout",!1),ro()||(window.addEventListener("beforeunload",(()=>{clearTimeout(this.errSendTimer),clearTimeout(this.sucSendTimer),this.send(void 0,!0)})),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="visible"?this.setCommonStats({app_state:"active"}):document.visibilityState==="hidden"&&this.setCommonStats({app_state:"background"})})),fy&&(window.__rtc_debug_reportor__=this)),Ki.on("UPLOAD_REPORT_LIMIT",(e=>{this.setReportLimit(e)})),Ki.on("ENABLE_REPORT_IDB_BUFFER",(e=>{e&&this.enableIndexedDBBuffer()})),setTimeout((()=>{this.reportorList.push(yp),this.reportorList.push(Yf)}))}setUrl(e){this._logServerUrl=e}setCommonStats(e){this.reportCommon=Object.assign(this.reportCommon,e)}getCommonStats(){return this.reportCommon}setReportLimit(e){this._reportLimit=Math.max(e,5e4),this._reportLimit=Math.min(e,5e5)}getReportId(e){var i;e=(i=e)!==null&&i!==void 0?i:"__global__",this.reportIds.has(e)||this.reportIds.set(e,0);let s=this.reportIds.get(e);return s===void 0&&(No("no reportId in reportId map with engine-session-id ".concat(e),0,{}),s=0),this.reportIds.set(e,s+1),s}push(e){if(arguments.length>1&&arguments[1]!==void 0&&arguments[1])this.send(e);else{var i;const s=(i=e.engine_session_id)!==null&&i!==void 0?i:"__global__";this.reportIds.has(s)||this.reportIds.set(s,0),this.dataBuffer.push(e),!this.posting&&!this.errSendTimer&&Date.now()-this.preSucTime>2e3&&(clearTimeout(this.sucSendTimer),this.send())}}enableIndexedDBBuffer(){this.dbBuffer||(this.dbBuffer=new $M("ReportorDBBuffer"),this.dbBuffer.get("LogReportor").then((e=>{e.forEach((i=>{this.push(i)}))})),this.reportorList.forEach((e=>{var i;(i=this.dbBuffer)===null||i===void 0||i.get(e.name).then((s=>{e.set(s)}))})))}backup(){try{var e;(e=this.dbBuffer)===null||e===void 0||e.set([...this.dataBuffer],"LogReportor"),this.reportorList.forEach((i=>{var s;(s=this.dbBuffer)===null||s===void 0||s.set([...i.get()],i.name)}))}catch(i){No("Error when save log into IDB",-1,i)}}unshift(e){this.dataBuffer=e[0].concat(this.dataBuffer),this.reportorList.forEach(((i,s)=>{var o;i.unshift((o=e[s+1])!==null&&o!==void 0?o:[])}))}_splice(){let e=ew(this.dataBuffer,this._reportLimit);e===0&&this.dataBuffer.length>0&&(this._reportLimit=JSON.stringify(this.dataBuffer[0]).length+10,e=1,No("update report limit to ".concat(this._reportLimit),0,null));const i=this.dataBuffer.splice(0,e),s=JSON.stringify(i).length,o=[i];let r=this._reportLimit-s;return this.reportorList.forEach((n=>{const{payload:a,payloadSize:c}=n.splice(r);a.forEach((d=>{var l,u,p;d.report_id===void 0&&(d.report_id=this.getReportId(d.engine_session_id),!ro()&&window.__onRTCReport&&((l=(u=window).__onRTCReport)===null||l===void 0||l.call(u,(p=d.engine_session_id)!==null&&p!==void 0?p:"global",d,this.getCommonStats())))})),o.push(a),r-=c})),o}async send(e,i){this.backup();const s=this.reportorList.reduce(((u,p)=>u&&p.isEmpty()),!0);if(!e&&!this.dataBuffer.length&&s||!this._logServerUrl)return;e||(this.posting=!0);let o=[];e||(o=this._splice());const r=fy,n={data:e||Bg(o).call(o),header:I(I({},this.reportCommon),{},{http_retry_count:this._retryCount}),from:"web",os:"web",version:"1"},a={method:"POST",body:r?JSON.stringify(n):nh.gzip(JSON.stringify(n))};if(!this._disableTimeout)try{const u=new AbortController;a.signal=u.signal,setTimeout((()=>{u.abort()}),1e4)}catch{console.warn("AbortController is not supported"),this._disableTimeout=!0}r||(a.headers={"Content-Encoding":"gzip","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"});let c,d,l=null;try{c=await fetch(this._logServerUrl,a),c.status!==200&&c.status!==304||(l=JSON.parse(await c.text()))}catch(u){d=u}e||(this.posting=!1),l&&l.StatusCode===0?e||i||this.sucSend():(setTimeout((()=>{var u,p,h;No("reportor post error, resJSON:".concat((u=l)===null||u===void 0?void 0:u.toString()," err:").concat(d),(p=(h=c)===null||h===void 0?void 0:h.status)!==null&&p!==void 0?p:-1,d)}),0),e?this.send(e):(this.unshift(o),i?this.send():this.errSend()))}_getDataBufferTotalSize(){return this.dataBuffer.reduce(((e,i)=>e+JSON.stringify(i).length),0)}sucSend(){this.errSendDelay=100,this._retryCount=0,this.preSucTime=Date.now();const e=this._getDataBufferTotalSize()>1e6?1e3:2e3;this.sucSendTimer=setTimeout((()=>this.send()),e)}errSend(){this.errSendTimer=setTimeout((()=>{this.send(),delete this.errSendTimer}),this.errSendDelay),this.errSendDelay*=2,this._retryCount++}}function ew(t,e){let i=0;for(let s=0;s<t.length;s++)if(i+=JSON.stringify(t[s]).length,i>e)return s;return t.length}var ua=new qM;class Hf{constructor(e){m(this,"modifyIds",{pre_connection:!1}),this.id=e}report(e,i,s){const o=I(I(I({event_key:e,rtc_timestamp:Date.now()},this.modifyIds),i),{},{report_id:ua.getReportId(this.modifyIds.engine_session_id)});var r,n;typeof s=="object"&&Object.keys(s).length>0&&(o.common_extra_info=JSON.stringify(s)),Object.keys(o).forEach((a=>{o[a]!==void 0&&o[a]!==""||delete o[a]})),!ro()&&window.__onRTCReport&&((r=(n=window).__onRTCReport)===null||r===void 0||r.call(n,this.modifyIds.engine_session_id,o,ua.getCommonStats())),{}.VITE_TEST!=="UT"&&ua.push(o)}reportLog(e){const i=I(I({event_key:"rtc_invoke_status",sdk_api_name:"console_log",rtc_timestamp:Date.now()},this.modifyIds),{},{message:e});yp.push(i)}reportLongString(e,i){const s=I(I({event_key:"rtc_invoke_status",sdk_api_name:"sdk_long_string_".concat(e),rtc_timestamp:Date.now()},this.modifyIds),{},{message:i});Yf.push(s)}set(e){this.modifyIds=Object.assign(this.modifyIds,e)}destroy(){}}class mi{constructor(e){m(this,"_preTime",Date.now()),m(this,"_one2oneNum",0),m(this,"_one2manyNum",0),m(this,"_one2oneMsgCache",new Map),m(this,"_one2manyMsgCache",new Map),m(this,"roomId",""),m(this,"userId",""),m(this,"rtsSessionId",""),m(this,"logger",void 0),m(this,"serverUrl","server"),this.id=e,this.logger=new ue("MessageReportor",1)}needReport(e){return!!mi.config&&(Date.now()-this._preTime>=36e5&&(this._preTime=Date.now(),this._one2oneNum=0,this._one2manyNum=0),e==="one2one"&&this._one2oneNum<mi.config.max_one2one_fpt_per_hour&&Math.random()<=mi.config.one2one_fpt_ratio/100||e==="one2many"&&this._one2manyNum<mi.config.max_one2many_fpt_per_hour&&Math.random()<=mi.config.one2many_fpt_ratio/100)}cacheP2PMsg(e){var i;this._one2oneMsgCache.set(e.msg_id,I({config_version:((i=mi.config)===null||i===void 0?void 0:i.version)||""},e))}updateP2PMsg(e,i){const s=this._one2oneMsgCache.get(e);s&&this._one2oneMsgCache.set(e,I(I({},s),i))}cacheCustomMsg(e){var i;this._one2manyMsgCache.set(e.msg_id,I({config_version:((i=mi.config)===null||i===void 0?void 0:i.version)||""},e))}updateOne2ManyMsg(e,i){const s=this._one2manyMsgCache.get(e);s&&this._one2manyMsgCache.set(e,I(I({},s),i))}reportP2PMsg(e){const i=this._one2oneMsgCache.get(e);var s;i&&(this.logger.info("reportP2PMsg",i.type,JSON.stringify(i)),(s=ke(this.id))===null||s===void 0||s.report("rts_message",i))}reportOne2ManyMsg(e){const i=this._one2manyMsgCache.get(e);var s;i&&(this.logger.info("reportOne2ManyMsg",i.type,JSON.stringify(i)),(s=ke(this.id))===null||s===void 0||s.report("rts_message",i))}reportMsgRecv(e){var i,s;e.config_version=((i=mi.config)===null||i===void 0?void 0:i.version)||"",this.logger.info("reportMsgRecv",e.type,JSON.stringify(e)),(s=ke(this.id))===null||s===void 0||s.report("rts_message",e)}destroy(){this._one2manyNum=0,this._one2oneNum=0,this._one2manyMsgCache.clear(),this._one2oneMsgCache.clear(),this._preTime=Date.now(),this.roomId="",this.userId="",this.rtsSessionId=""}}m(mi,"config",void 0);const ht=new Map,tw=t=>{new ue("MessageReportor",1).info("setConfig","get config: ".concat(JSON.stringify(t))),mi.config=t},iw=t=>{const e=ht.get(t)||new mi(t);return ht.set(t,e),e},sw=t=>{const e=ht.get(t);e&&(e.destroy(),ht.delete(t))},ow=(t,e)=>{const i=ht.get(t);i&&(i.serverUrl=e)},rw=(t,e)=>{const i=ht.get(t);i&&(i.roomId=e||"")},nw=(t,e)=>{const i=ht.get(t);i&&(i.userId=e||"")},aw=(t,e)=>{const i=ht.get(t);i&&(i.rtsSessionId=e)},dw=(t,e)=>{const i=ht.get(t);if(i!=null&&i.needReport("one2one")){const s=e.to?"one2one":"one2server";e.enable_report=!0,e.report_msg_id=e.id,i.cacheP2PMsg({rts_session_id:i.rtsSessionId,msg_id:"".concat(e.id),node_role:"src_sdk",from:e.from,to:e.to||i.serverUrl,msg_type:s,type:s,rts_room_id:e.room,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})}return e},cw=(t,e,i)=>{var s;e.enable_report&&Zn(e.report_msg_id)&&((s=ht.get(t))===null||s===void 0||s.updateP2PMsg("".concat(e.report_msg_id),{send_ts:Date.now(),msg_size:i}))},lw=(t,e,i)=>{if(e.enable_report&&Zn(e.report_msg_id)){const s=ht.get(t);s?.updateP2PMsg("".concat(e.report_msg_id),{ack_ts:Date.now(),error_code:i}),s?.reportP2PMsg("".concat(e.report_msg_id))}},uw=(t,e,i)=>{const s=ht.get(t);return s!=null&&s.needReport("one2many")&&(i.enable_report=!0,i.report_msg_id=e,s.cacheCustomMsg({rts_session_id:s.rtsSessionId,msg_id:"".concat(e),node_role:"src_sdk",from:i.clientId,to:s.roomId||i.roomId,msg_type:"one2many",type:"one2many",rts_room_id:s.roomId,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})),i},mw=(t,e,i)=>{if(e.enable_report&&Zn(e.report_msg_id)){const s=ht.get(t);s&&s.updateOne2ManyMsg("".concat(e.report_msg_id),{send_ts:Date.now(),msg_size:i})}},hw=(t,e,i)=>{if(e.enable_report&&Zn(e.report_msg_id)){const s=ht.get(t);s&&(s?.updateOne2ManyMsg("".concat(e.report_msg_id),{ack_ts:Date.now(),error_code:i}),s?.reportOne2ManyMsg("".concat(e.report_msg_id)))}},pw=(t,e,i)=>{if(e.enable_report&&Zn(e.report_msg_id)){const s=ht.get(t),o=e.to?"one2one":"one2many";s?.reportMsgRecv({rts_session_id:s.rtsSessionId,msg_id:"".concat(e.report_msg_id),msg_size:i.msg_size,node_role:"dst_sdk",msg_type:o,type:o,rts_room_id:e.room,from:e.from,to:e.to||e.room,error_code:0,recv_msg_ts:i.recv_msg_ts,fwd_msg_ts:i.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:e.to?"":s.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},bw=(t,e,i)=>{if(e.enable_report&&Zn(e.report_msg_id)){const s=ht.get(t);s?.reportMsgRecv({rts_session_id:s.rtsSessionId,msg_id:"".concat(e.report_msg_id),msg_size:i.msg_size,node_role:"dst_sdk",msg_type:"one2many",type:"one2many",rts_room_id:e.roomId,from:e.clientId,to:e.roomId,error_code:0,recv_msg_ts:i.recv_msg_ts,fwd_msg_ts:i.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:s.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},Je={_cache:ht,setServerUrl:ow,setConfig:tw,setRtsSessionId:aw,createRTSMsgReportor:iw,destroyRTSMsgReportor:sw,setRoomId:rw,setUserId:nw,samplingP2PMsg:dw,updateP2PMsgReq:cw,updateP2PMsgAck:lw,samplingOne2ManyMsg:uw,reportP2PMsgRecv:pw,updateOne2ManyMsgAck:hw,updateOne2ManyMsgReq:mw,reportOne2ManyMsgRecv:bw};class yw{constructor(e){m(this,"_timer",void 0),m(this,"userMessage",{}),m(this,"roomMessage",{}),this.id=e,this._setTimer()}_setTimer(){const e=()=>{this._reportAndgReset(),clearTimeout(this._timer),this._timer=setTimeout(e,1e4)};e()}_reportAndgReset(){(Object.keys(this.userMessage).length||Object.keys(this.roomMessage).length)&&(this._report(),this._reset())}_report(){var e;(e=ke(this.id))===null||e===void 0||e.report("rtc_message_statistics",{dc_user_message:Object.keys(this.userMessage).map((i=>this.userMessage[i])),dc_room_message:Object.keys(this.roomMessage).map((i=>this.roomMessage[i])),media_server_ip:""})}_reset(){this.userMessage={},this.roomMessage={}}_checkInitUserMessage(e,i){this.userMessage["".concat(i,"-").concat(e)]||(this.userMessage["".concat(i,"-").concat(e)]={dc_peer_user_id:e,dc_send_total:0,dc_recv_total:0,dc_send_ack:0,dc_send_fail:0,dc_fail_timeout:0,dc_fail_no_receiver:0,dc_fail_no_relay_path:0,dc_cost_time:0,dc_cost_e2s:0,dc_cost_s2s:0,dc_least_time:1/0,dc_most_time:0,dc_cost_peer_s2e:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_message_type:i,dc_send_binary:0})}_sendUserMessage(e,i,s){this._checkInitUserMessage(e,i),this.userMessage["".concat(i,"-").concat(e)].dc_send_total++,s&&this.userMessage["".concat(i,"-").concat(e)].dc_send_binary++}_recvUserMessage(e,i){this._checkInitUserMessage(e,i),this.userMessage["".concat(i,"-").concat(e)].dc_recv_total++}_sendUserFail(e,i,s){const o=this.userMessage["".concat(i,"-").concat(e)];o&&(o.dc_send_fail++,this._handleUserFail(o,s))}_handleUserFail(e,i){i&&(i.code||i.err)&&(["TIME_OUT","USER_MESSAGE_TIMEOUT"].includes(i.code)?e.dc_fail_timeout++:i.err===3?e.dc_fail_no_receiver++:i.err===4?e.dc_fail_no_relay_path++:i.err===1&&e.dc_fail_timeout++)}_sendUserAck(e,i,s,o,r){const n=this.userMessage["".concat(i,"-").concat(e)];n&&(n.dc_send_ack++,n.dc_cost_time+=s,n.dc_cost_s2s+=o||0,n.dc_cost_peer_s2e+=r,n.dc_cost_e2s+=s-(o||0)-r,s/2<=100?(n.dc_send_ack_100++,n.dc_send_ack_200++,n.dc_send_ack_400++,n.dc_send_ack_1s++):s/2<=200?(n.dc_send_ack_200++,n.dc_send_ack_400++,n.dc_send_ack_1s++):s/2<=400?(n.dc_send_ack_400++,n.dc_send_ack_1s++):s/2<=1e3&&n.dc_send_ack_1s++,s<n.dc_least_time&&(n.dc_least_time=s),s>n.dc_most_time&&(n.dc_most_time=s))}sendRoomMessage(e,i){this.roomMessage[e]||(this.roomMessage[e]={dc_room_id:e,dc_send_total:0,dc_send_ack:0,dc_cost_time:0,dc_least_time:1/0,dc_most_time:0,dc_send_fail:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_send_binary:0}),this.roomMessage[e].dc_send_total++,i&&this.roomMessage[e].dc_send_binary++}sendRoomFail(e){const i=this.roomMessage[e];i&&i.dc_send_fail++}sendRoomAck(e,i){const s=this.roomMessage[e];s&&(s.dc_send_ack++,s.dc_cost_time+=i,i<s.dc_least_time&&(s.dc_least_time=i),i>s.dc_most_time&&(s.dc_most_time=i),i/2<=100?(s.dc_send_ack_100++,s.dc_send_ack_200++,s.dc_send_ack_400++,s.dc_send_ack_1s++):i/2<=200?(s.dc_send_ack_200++,s.dc_send_ack_400++,s.dc_send_ack_1s++):i/2<=400?(s.dc_send_ack_400++,s.dc_send_ack_1s++):i/2<=1e3&&s.dc_send_ack_1s++)}sendP2PMessage(e,i){this._sendUserMessage(e,"p2p",i)}recvP2PMessage(e){this._recvUserMessage(e,"p2p")}sendP2PFail(e,i){this._sendUserFail(e,"p2p",i)}sendP2PAck(e,i,s,o){this._sendUserAck(e,"p2p",i,s,o)}sendP2POutRoomMessage(e,i){this._sendUserMessage(e,"p2p_outside_room",i)}recvP2POutRoomMessage(e){this._recvUserMessage(e,"p2p_outside_room")}sendP2POutRoomFail(e,i){this._sendUserFail(e,"p2p_outside_room",i)}sendP2POutRoomAck(e,i,s,o){this._sendUserAck(e,"p2p_outside_room",i,s,o)}sendP2serverMessage(e){this._sendUserMessage("","p2server",e)}sendP2serverFail(e){this._sendUserFail("","p2server",e)}sendP2serveAck(e,i,s){this._sendUserAck("","p2server",e,i,s)}countP2PMessage(e,i,s,o,r){this.sendP2PMessage(i,s),e?this.sendP2PAck(i,Date.now()-o,r.s2s_time||0,r.s2e_time||0):this.sendP2PFail(i,r)}countRoomMessage(e,i,s,o){this.sendRoomMessage(i,s),e?this.sendRoomAck(i,Date.now()-o):this.sendRoomFail(i)}countUserMessageOutsideRoom(e,i,s,o,r){this.sendP2POutRoomMessage(i,s),e?this.sendP2POutRoomAck(i,Date.now()-o,r.s2s_time,r.s2e_time):this.sendP2POutRoomFail(i,r)}countServerMessage(e,i,s,o){this.sendP2serverMessage(i),e?(o=o||{},this.sendP2serveAck(Date.now()-s,o.s2s_time||0,o.s2e_time||0)):this.sendP2serverFail(o)}destroy(){this._reset(),clearTimeout(this._timer)}}const ma=t=>{ua.setCommonStats(t)},Ff=t=>{ua.setUrl(t)},Fa=new Hf("global"),Yd=(t,e,i)=>{Fa.report("rtc_sdk_api_call",{sdk_api_name:t,error_code:e,message:i})},nu=(t,e,i)=>{Fa.report("rtc_sdk_callback",{sdk_callback_name:t,error_code:e,message:i})},No=(t,e,i)=>{Fa.report("rtc_error",{message:t,error_code:e},i)},Zy=function(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;Fa.report("rtc_invoke_status",{sdk_api_name:t,message:e,error_code:i,stream_id:s,elapse:0},o)};function _w(t){Fa.reportLog(t)}const bp=new Map,ke=t=>bp.get(t),Of=(t,e)=>{const i=new Hf(t);return i.set(I(I({},e),{},{engine_session_id:Wt()})),i.report("sdk_init_engine",{start:Date.now(),type:"begin"}),bp.set(t,i),i},Sw=t=>{t.report("sdk_init_engine",{start:Date.now(),type:"end"}),bp.delete(t.id)},Ty=new Map;function P(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Object.assign({debounce:0},e);const{debounce:i,debounceTag:s}=e;function o(r,n,a,c){if(!i)return n(...a);{const d="".concat(c,"_").concat(r),l=Ty.get(d);clearTimeout(l);const u=setTimeout((()=>{n(...a)}),i);Ty.set(d,u)}}return function(r,n,a){if(typeof a.value=="function"){const c=a.value;a.value=function(){for(var d,l,u=arguments.length,p=new Array(u),h=0;h<u;h++)p[h]=arguments[h];const _=this.engineId||this.id,y=Wt(),b={};var S,v;t.forEach(((Z,R)=>{b[Z]=p[R]})),n==="joinRoom"&&((S=ke(_))===null||S===void 0||S.set({room_id:p[1],user_id:(v=p[2])===null||v===void 0?void 0:v.userId}));let f,g="";if(s)try{g=s(...p)}catch{}o(n,vw,[_,n,p,b,{event_session_id:y}],"start_".concat(g));try{f=c.apply(this,p)}catch(Z){throw o(n,wr,[_,n,Z.message,Z.code||-1,{event_session_id:y}],"end_".concat(g)),Z}return typeof((d=f)===null||d===void 0?void 0:d.then)=="function"?f.then((Z=>(o(n,wr,[_,n,[Z??{}],0,{event_session_id:y}],"end_".concat(g)),Z))).catch((Z=>{throw o(n,wr,[_,n,Z.message,Z.code,{event_session_id:y}],"end_".concat(g)),Z})):(o(n,wr,[_,n,[(l=f)!==null&&l!==void 0?l:{}],0,{event_session_id:y}],"end_".concat(g)),f)}}}}const vw=function(t,e,i,s){var o;let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const n=I({sdk_api_name:e,message:JSON.stringify(Jf(i)),error_code:0},r);(o=ke(t))===null||o===void 0||o.report("rtc_sdk_api_call",n,s)},wr=function(t,e,i){var s;let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const r=I({sdk_callback_name:e,error_code:arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,message:JSON.stringify(Array.isArray(i)?Jf(i):i)},o);(s=ke(t))===null||s===void 0||s.report("rtc_sdk_callback",r)},ye=function(t,e,i){var s;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",n=arguments.length>5?arguments[5]:void 0;(s=ke(t))===null||s===void 0||s.report("rtc_invoke_status",{sdk_api_name:e,message:i,error_code:o,stream_id:r,elapse:0},n)},au=10;function Jf(t){const e=i=>{if(i!=null&&i._reportName)return i._reportName;if(i instanceof HTMLElement)return i.toString();if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)){const o=ArrayBuffer.isView(i)?i.buffer:i,r=o.byteLength;let n=[];if(r>au){var s;const a=new DataView(o),c=Array.from({length:au/2}).map(((l,u)=>a.getUint8(u))),d=Wg(s=Array.from({length:au/2}).map(((l,u)=>r-1-u))).call(s).map((l=>a.getUint8(l)));n=[...c,"...",...d]}else n=Array.from(new Uint8Array(o));return"".concat(i.constructor.name,"(").concat(r,") [").concat(n.join(", "),"]")}if(i instanceof ImageData)return"ImageData";if(Array.isArray(i))return i.map(e);if(["[object Object]","[object MediaStreamTrack]","[object CanvasCaptureMediaStreamTrack]"].includes(Object.prototype.toString.call(i))){const o={};for(const r in i)o[r]=e(i[r]);return o}return i instanceof Function?"[User Function]":i};return t.map(e)}const gw=typeof window<"u"&&window.location.search.includes("_rtc_upload_console_");class fw{constructor(){m(this,"name","ConsoleReportor"),m(this,"_uuid","".concat(Math.floor(899*Math.random())+100)),m(this,"_consoleReportId",0),m(this,"_engineReportIdMap",new Map),m(this,"_enabled","NULL"),m(this,"_consoleCutLength",Ki.getParameter("UPLOAD_CONSOLE_LENGTH_CUT")),m(this,"buffer",[]),gw&&setTimeout((()=>{this.switchOn()}),0),Ki.on("UPLOAD_CONSOLE_ON",(e=>{e?this.switchOn():this.turnOff()})),Ki.on("UPLOAD_CONSOLE_LENGTH_CUT",(e=>{this._consoleCutLength=e}))}get enabled(){return this._enabled!=="OFF"}switchOn(){this._enabled==="NULL"&&(console.log("[LoggerReportor.constructor] console upload switch ON"),this._enabled="ON")}turnOff(){this._enabled==="NULL"&&(console.log("[LoggerReportor.constructor] console upload switch OFF"),this._enabled="OFF",this.buffer=[])}getEngineConsoleId(e){var i;const s=(i=this._engineReportIdMap.get(e))!==null&&i!==void 0?i:0;return this._engineReportIdMap.set(e,s+1),s}report(e,i,s,o,r,n,a,c,d){if(this._enabled==="OFF")return;const l=ke(i),u=this._consoleReportId++,p=this.getEngineConsoleId(i),h=Iy(d,this._consoleCutLength),_=[...d],y="".concat(c).replace(/%o|%s/gi,(()=>Iy([_.shift()],this._consoleCutLength))),b="[".concat(this._uuid,"-").concat(u,"][").concat(i,"-").concat(p,"]-").concat(s,"-").concat(e,"[").concat(o,"]").concat(r,"[").concat(n,".").concat(a,"] ").concat(y," ").concat(h);l?l.reportLog(b):_w(b)}push(e){this._enabled!=="OFF"&&this.buffer.push(e)}splice(e){if(this._enabled!=="ON")return{payload:[],payloadSize:0};const{index:i,size:s}=Zw(this.buffer,e);return{payload:this.buffer.splice(0,i),payloadSize:s}}unshift(e){this.buffer=e.concat(this.buffer)}get(){return this.buffer}set(e){this.buffer=e.concat(this.buffer)}isEmpty(){return this._enabled==="OFF"||this.buffer.length===0}}function Iy(t,e){return t.map((i=>{let s="";try{if(typeof i=="string")return i;if(i===void 0)return"undefined";if(i===null)return"null";if(i instanceof MediaStreamTrack)return Zi(i);if(i instanceof MediaStream)return xg(i);if(i instanceof RTCRtpSender)return Mg(i);if(i instanceof RTCRtpReceiver)return wg(i);if(i instanceof RTCRtpTransceiver)return Kg(i);s=JSON.stringify(i)}catch{s=i.toString()}return s&&s.length>=e&&(s=s.slice(0,e)),s})).join(", ")}function Zw(t,e){let i=0;for(let s=0;s<t.length;s++){const o=JSON.stringify(t[s]).length;if(i+=o,i>e)return{index:s,size:i-o}}return{index:t.length,size:i}}var du,yp=new fw;const Tw={DEBUG:"rgba(0, 0, 0, 0)"," INFO":"rgba(93, 173, 226, 0)"," WARN":"rgba(255, 119, 0, 0.3)",ERROR:"rgba(255, 0, 0, 0.3)"," SUCC":"rgba(0, 119, 0, 0.3)"},Iw=typeof window<"u"&&(window.location.search.includes("_rtc_debug_")||((du=window.localStorage)===null||du===void 0?void 0:du.getItem("_rtc_debug_")));class Rw{constructor(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"global";m(this,"indent",void 0),m(this,"module",void 0),m(this,"_engineId",void 0),this.module=e,this.indent=i,this._engineId=s}_print(e,i){for(var s=arguments.length,o=new Array(s>2?s-2:0),r=2;r<s;r++)o[r-2]=arguments[r];const n=o.shift();try{const d=[...o],l="".concat(n).replace(/%o/gi,(()=>{const u=d.shift();return JSON.stringify(u)}));Br.set("".concat("[VERTC]","[").concat(this.module,".").concat(i,"] ").concat(l," ").concat(d.map((u=>JSON.stringify(u))).join(", ")))}catch{}let a="";for(let d=0;d<this.indent;d++)a+="    ";const c=Xw();yp.report("[VERTC]",this._engineId,c,e,a,this.module,i,n,o),Iw&&console.log("%c".concat(c,"-").concat("[VERTC]","%c[").concat(e,"]%c").concat(a,"[").concat(this.module,".").concat(i,"] ").concat(n),"color:".concat("#0050b3",";"),"background-color:".concat(Tw[e],";"),"color:".concat("#0050b3",";"),...o)}print(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];this._print(" INFO",e,...s)}debug(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];this._print("DEBUG",e,...s)}info(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];this._print(" INFO",e,...s)}warn(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];this._print(" WARN",e,...s)}error(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];this._print("ERROR",e,...s)}success(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];this._print(" SUCC",e,...s)}}const Xw=()=>{const t=new Date;return"".concat(t.toTimeString().split(" ")[0],":").concat(t.getMilliseconds().toString().padStart(3,"0"))};var cu,lu,uu,lr,mu,ue=Rw;const xe=()=>typeof window>"u",Ue=xe()?"":window.navigator.userAgent;function _p(){let t="none";return xe()||(Ue.match("Firefox")!==null?t="mozilla":Ue.match("Chrome")!==null?(t="chrome-stable",Ue.match("Electron")!==null&&(t="electron")):(Ue.match("Safari")!==null||Ue.match("AppleWebKit")!==null)&&(t="safari")),t}const Te=_p()==="mozilla",Dt=_p()==="safari",gs=_p()==="chrome-stable",Cw=!xe()&&/CriOS/i.test(Ue),Lw=!xe()&&/Edg\//i.test(Ue),Ww=!xe()&&/EdgA/i.test(Ue),Gw=!xe()&&/EdgiOS/i.test(Ue),Vw=Lw||Ww||Gw,Ew=!xe()&&/DingTalk/i.test(navigator.userAgent),Pw=!xe()&&/OPR\//.test(navigator.userAgent),mc=!xe()&&(!!/(iPad)/i.exec(Ue)||/Macintosh/i.test(Ue)&&"ontouchend"in document),Nw=!xe()&&/Macintosh/i.test(Ue),Ur=!xe()&&/MicroMessenger/i.test(Ue),Hd=!xe()&&Ue.toLowerCase().includes("mobile"),yo=!xe()&&!!/(iPhone|iPad|iPod)/i.exec(Ue),as=!xe()&&/Android/i.test(Ue),kw=!xe()&&/Windows/i.test(Ue),xw=!xe()&&/OpenHarmony/i.test(Ue);let Ac=0,Uf="0";const Ry=!xe()&&((cu=Ue.match(/version\/(\d+)/i))===null||cu===void 0?void 0:cu[1]);var hu;Dt&&Ry&&(Ac=Number(Ry),Uf=(hu=navigator.userAgent.match(/version\/(\d+\.\d+)/i))===null||hu===void 0?void 0:hu[1]);const Xy=!xe()&&((lu=Ue.match(/Firefox\/(\d+)/i))===null||lu===void 0?void 0:lu[1]);Te&&Xy&&(Ac=Number(Xy));const Dc=Ac,Zs=Ac,Xo=Uf,$r=(uu=!xe()&&((lr=Ue.match(/ ([\d_]+) like Mac OS X/i))===null||lr===void 0||(lr=lr[1])===null||lr===void 0?void 0:lr.split("_").map((t=>parseInt(t)))))!==null&&uu!==void 0?uu:[];let Af=0;const Cy=!xe()&&((mu=Ue.match(/Chrome\/(\d+)/i))===null||mu===void 0?void 0:mu[1]);Cy&&(Af=Number(Cy));const qt=Af,_o="VolcEngine",Ly="RTC_DEVICE_ID",kn="RTC_ACCESS_NODE",pu="RTC_ACCESS_URLS",bu="ENGINE_WEB_CONFIG",yu="SERVER_CONFIG";class Mw{get(e){const i=localStorage.getItem(e);if(!i)return null;try{const s=JSON.parse(i);return s.ttl>0&&Date.now()-s.saveTime>s.ttl?(this.delete(e),null):s.message}catch{return null}}set(e,i){const s={ttl:arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,saveTime:Date.now(),message:i};try{return localStorage.setItem(e,JSON.stringify(s)),!0}catch{return!1}}getTtl(e){const i=localStorage.getItem(e);if(!i)return null;try{return JSON.parse(i).ttl}catch{return null}}delete(e){try{return localStorage.removeItem(e),!0}catch{return!1}}}class ww extends Mw{constructor(){super(...arguments),m(this,"_accessVersion","v2")}getDeviceId(){if(xe())return"";let e=this.get(Ly);return e&&!/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/.test(e)||(e=oY(16)),this.setDeviceId(e),e}setDeviceId(e){return ma({device_id:e}),this.set(Ly,e),e}getAccessNode(e){return this.get("".concat(kn,"_").concat(e,"-").concat(_o,"-").concat(this._accessVersion))}setAccessNode(e,i,s){return this.set("".concat(kn,"_").concat(e,"-").concat(_o,"-").concat(this._accessVersion),i,1e3*s)}deleteAccessNode(e,i){let s=this.getAccessNode(e);const o=this.getTtl("".concat(kn,"_").concat(e,"-").concat(_o));Array.isArray(s)&&s.length>0&&(s=s.filter((r=>r.mediaID!==i.mediaID&&r.msgKey!==i.msgKey)),s.length>0?this.setAccessNode(e,s,o||0):this.clearAccessNode(e))}clearAccessNode(e){if(e)this.delete("".concat(kn,"_").concat(e,"-").concat(_o));else for(const i in localStorage)i.startsWith(kn)&&localStorage.removeItem(i)}getAccessUrls(){return this.get("".concat(pu,"-").concat(_o))}setAccessUrls(e){const i=e.map((s=>{let{host:o,path:r}=s;return"https://".concat(o).concat(r)}));return this.set("".concat(pu,"-").concat(_o),i)}clearAccessUrls(){this.delete("".concat(pu,"-").concat(_o))}getEngineWebConfig(e,i){var s;const o="".concat(e,"_").concat(i,"_").concat(this.getDeviceId()),r=this.get(bu),n=(r==null||(s=r.find((a=>a.key===o)))===null||s===void 0?void 0:s.config)||{};return Object.assign({},ae("ENGINE_WEB_CONFIG"),n)}setEngineWebConfig(e,i,s){if(!s)return;const o="".concat(e,"_").concat(i,"_").concat(this.getDeviceId());let r=this.get(bu)||[];return r=r.filter((n=>n.key!==o)),r.push({key:o,config:s}),this.set(bu,r.slice(-5))}getServerConfig(e){var i;const s="".concat(e),o=this.get(yu);return(o==null||(i=o.find((r=>r.key===s)))===null||i===void 0?void 0:i.config)||{}}setServerConfig(e,i){if(!i)return;const s="".concat(e);let o=this.get(yu)||[];return o=o.filter((r=>r.key!==s)),o.push({key:s,config:i}),this.set(yu,o.slice(-5))}}var We=new ww;const Kw=new ue("JoinRoomConfig",0);class _i{constructor(e){m(this,"_useTcpAfterJoinTimeout",_i.DEFAULT_CONF.useTcpAfterJoinTimeout),m(this,"_joinWithTcpOnly",_i.DEFAULT_CONF.joinWithTcpOnly),m(this,"_joinWithTcpOnlyDelay",_i.DEFAULT_CONF.joinWithTcpOnlyDelay),m(this,"_blackBrowserRegexList",[]),this._engineId=e,location.search.indexOf("__rtc_tcp_only__")>-1&&(this._joinWithTcpOnly=!0,this._joinWithTcpOnlyDelay=0),this._report()}static setDefaulConf(e){let{useTcpAfterJoinTimeout:i,joinWithTcpOnly:s,joinWithTcpOnlyDelay:o}=e;return typeof i=="boolean"&&(_i.DEFAULT_CONF.useTcpAfterJoinTimeout=i),typeof s=="boolean"&&(_i.DEFAULT_CONF.joinWithTcpOnly=s),typeof o=="number"&&(_i.DEFAULT_CONF.joinWithTcpOnlyDelay=Math.max(0,o)),_i.DEFAULT_CONF}get useTcpAfterJoinTimeout(){return this._useTcpAfterJoinTimeout}get useTcpJoin(){return this._joinWithTcpOnly}get useTcpJoinDelay(){return this._joinWithTcpOnlyDelay}isBlackBrower(){return this._blackBrowserRegexList.find((e=>new RegExp(e).test(navigator.userAgent)))}setServerConfig(e){var i,s,o;let r=!1;typeof(e==null||(i=e.use_tcp_after_join_timeout)===null||i===void 0?void 0:i.enable)=="boolean"&&(this._useTcpAfterJoinTimeout=e.use_tcp_after_join_timeout.enable,r=!0),typeof(e==null||(s=e.join_with_tcp_only)===null||s===void 0?void 0:s.enable)=="boolean"&&(this._joinWithTcpOnly=e.join_with_tcp_only.enable,r=!0),typeof(e==null||(o=e.join_with_tcp_only)===null||o===void 0?void 0:o.delay_ms)=="number"&&(this._joinWithTcpOnlyDelay=e.join_with_tcp_only.delay_ms,r=!0),e&&Array.isArray(e.black_browser_regex_list)&&(this._blackBrowserRegexList=e.black_browser_regex_list,r=!0),r&&this._report()}toString(){return JSON.stringify({use_tcp_after_join_timeout:this._useTcpAfterJoinTimeout,join_with_tcp_only:this._joinWithTcpOnly,join_with_tcp_only_delay:this._joinWithTcpOnlyDelay,black_browser_regex_list:this._blackBrowserRegexList})}_report(){Kw.print("_report",this.toString()),ye(this._engineId,"web_join_room_config",this.toString())}}m(_i,"DEFAULT_CONF",{useTcpAfterJoinTimeout:!0,joinWithTcpOnly:!1,joinWithTcpOnlyDelay:5e3});var C=(t=>(t.INVALID_ENGINE="INVALID_ENGINE",t.INVALID_PARAMS="INVALID_PARAMS",t.INVOKED_BEFORE_JOIN_ROOM="INVOKED_BEFORE_JOIN_ROOM",t.INVALID_TOKEN="INVALID_TOKEN",t.JOIN_ROOM_FAILED="JOIN_ROOM_FAILED",t.UPDATE_TOKEN_WITH_INVALID_TOKEN="UPDATE_TOKEN_WITH_INVALID_TOKEN",t.UPDATE_TOKEN_BEFORE_JOIN="UPDATE_TOKEN_BEFORE_JOIN",t.REPEAT_JOIN="REPEAT_JOIN",t.REPEAT_PUBLISH="REPEAT_PUBLISH",t.REPEAT_PUSH="REPEAT_PUSH",t.REPEAT_PLAY="REPEAT_PLAY",t.PUBLISH_BEFORE_JOIN="PUBLISH_BEFORE_JOIN",t.UNPUBLISH_BEFORE_JOIN="UNPUBLISH_BEFORE_JOIN",t.SUBSCRIBE_BEFORE_JOIN="SUBSCRIBE_BEFORE_JOIN",t.UNSUBSCRIBE_BEFORE_JOIN="UNSUBSCRIBE_BEFORE_JOIN",t.NO_PUBLISH_PERMISSION="NO_PUBLISH_PERMISSION",t.STREAM_NOT_EXIST="STREAM_NOT_EXIST",t.EMPTY_STREAM="EMPTY_STREAM",t.NOT_CONNECTED_YET="NOT_CONNECTED_YET",t.IM_BEFORE_JOIN="IM_BEFORE_JOIN",t.USER_NOT_EXIST="USER_NOT_EXIST",t.ALREADY_IN_ROOM="ALREADY_IN_ROOM",t.KICKED_OUT="KICKED_OUT",t.ROOM_DISMISS="ROOM_DISMISS",t.TOKEN_EXPIRED="TOKEN_EXPIRED",t.TOKEN_NO_PUBLISH_PERMISSION="TOKEN_NO_PUBLISH_PERMISSION",t.TOKEN_NO_SUBSCRIBE_PERMISSION="TOKEN_NO_SUBSCRIBE_PERMISSION",t.DUPLICATE_LOGIN="DUPLICATE_LOGIN",t.INVOKED_BEFORE_CAPTURE="INVOKED_BEFORE_CAPTURE",t.REPEAT_CAPTURE="REPEAT_CAPTURE",t.GET_VIDEO_TRACK_FAILED="GET_VIDEO_TRACK_FAILED",t.GET_AUDIO_TRACK_FAILED="GET_AUDIO_TRACK_FAILED",t.GET_SCREEN_TRACK_FAILED="GET_SCREEN_TRACK_FAILED",t.STREAM_TYPE_NOT_MATCH="STREAM_TYPE_NOT_MATCH",t.CANT_FIND_DOM="CANT_FIND_DOM",t.INVALID_DEVICE_ID="INVALID_DEVICE_ID",t.NO_PERMISSION="NO_PERMISSION",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INTERRUPT="INTERRUPT",t.ICE_SERVER_WRONG="ICE_SERVER_WRONG",t.ESTABLISH_DATACHANNEL_FAILED="ESTABLISH_DATACHANNEL_FAILED",t.LOAD_RESOURCES_FAILED="LOAD_RESOURCES_FAILED",t.SIGNALING_CHANNEL_NOT_OPEN="SIGNALING_CHANNEL_NOT_OPEN",t.TIME_OUT="TIME_OUT",t.REFUSE_OPERATION_IN_DISCONNECT="REFUSE_OPERATION_IN_DISCONNECT",t.ADD_TRANSCEIVER_FAILED="ADD_TRANSCEIVER_FAILED",t.UPDATE_TRACK_FAILED="UPDATE_TRACK_FAILED",t.PUBLISH_FAILED="PUBLISH_FAILED",t.UNPUBLISH_FAILED="UNPUBLISH_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.OPERATION_CANCEL="OPERATION_CANCEL",t.START_CLOUD_PROXY_AFTER_JOIN="START_CLOUD_PROXY_AFTER_JOIN",t.STOP_CLOUD_PROXY_BEFORE_LEAVE="STOP_CLOUD_PROXY_BEFORE_LEAVE",t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.REPEAT_DEVICE_TEST="REPEAT_DEVICE_TEST",t.AUDIO_DEVICE_TEST_FAILED="AUDIO_DEVICE_RECORD_FAILED",t.ALREADY_LOGIN="ALREADY_LOGIN",t.LOGIN_FAILED="LOGIN_FAILED",t.NOT_LOGIN="NOT_LOGIN",t.RTM_DUPLICATE_LOGIN="RTM_DUPLICATE_LOGIN",t.RTM_TOKEN_ERROR="RTM_TOKEN_ERROR",t.USER_MESSAGE_TIMEOUT="USER_MESSAGE_TIMEOUT",t.USER_MESSAGE_BROKEN="USER_MESSAGE_BROKEN",t.USER_MESSAGE_NO_RECEIVER="USER_MESSAGE_NO_RECEIVER",t.USER_MESSAGE_NO_RELAYPATH="USER_MESSAGE_NO_RELAYPATH",t.USER_MESSAGE_EXCEED_QPS="USER_MESSAGE_EXCEED_QPS",t.USER_MESSAGE_SEND_TO_SERVER_ERROR="USER_MESSAGE_SEND_TO_SERVER_ERROR",t.USER_MESSAGE_SERVER_RESPONSE_ERROR="USER_MESSAGE_SERVER_RESPONSE_ERROR",t.USER_MESSAGE_NOT_JOIN="USER_MESSAGE_NOT_JOIN",t.USER_MESSAGE_INIT="USER_MESSAGE_INIT",t.USER_MESSAGE_NO_CONNECTION="USER_MESSAGE_NO_CONNECTION",t.USER_MESSAGE_NOT_LOGIN="USER_MESSAGE_NOT_LOGIN",t.USER_MESSAGE_SERVER_PARAMS_NOTSET="USER_MESSAGE_SERVER_PARAMS_NOTSET",t.USER_MESSAGE_UNKNOWN="USER_MESSAGE_UNKNOWN",t.START_PUBLIC_STREAM_BEFORE_JOIN="START_PUBLIC_STREAM_BEFORE_JOIN",t.RECONNECT_FAILED="RECONNECT_FAILED",t.SUBTITLE_ALREADY_ON="SUBTITLE_ALREADY_ON",t.SUBTITLE_NOT_TURNED_ON="SUBTITLE_NOT_TURNED_ON",t.SUBTITLE_ERR_POSTPROCESS="SUBTITLE_ERR_POSTPROCESS",t.SUBTITLE_ERR_CONNECTION_ERROR="SUBTITLE_ERR_CONNECTION_ERROR",t.SUBTITLE_ERR_PROCESS_ERROR="SUBTITLE_ERR_PROCESS_ERROR",t.SUBTITLE_ERR_UNKNOWN="SUBTITLE_ERR_UNKNOWN",t.UNEXPECTED_INVOKE_FORWARD_STREAM="UNEXPECTED_INVOKE_FORWARD_STREAM",t.ROOM_FORBIDDEN="ROOM_FORBIDDEN",t.USER_FORBIDDEN="USER_FORBIDDEN",t.ERR_ELECTRON_IS_NULL="ERR_ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.SET_SIMULCAST_FAILED="SET_SIMULCAST_FAILED",t.MIXING_OLD_AND_NEW_APIS="MIXING_OLD_AND_NEW_APIS",t.WTN_PUSH_FAILED="WTN_PUSH_FAILED",t.WTN_PLAY_FAILED="WTN_PLAY_FAILED",t.NOT_ALLOWED_IN_RTS_ROOM="NOT_ALLOWED_IN_RTS_ROOM",t.NOT_ALLOWED_IN_RESTRICTED_MODE="NOT_ALLOWED_IN_RESTRICTED_MODE",t))(C||{}),Nt=(t=>(t[t.AUDIO_MIXING_ERROR_OK=0]="AUDIO_MIXING_ERROR_OK",t[t.AUDIO_MIXING_ERROR_PRELOAD_FAILED=1]="AUDIO_MIXING_ERROR_PRELOAD_FAILED",t[t.AUDIO_MIXING_ERROR_START_FAILED=2]="AUDIO_MIXING_ERROR_START_FAILED",t[t.AUDIO_MIXING_ERROR_ID_NOT_FOUND=3]="AUDIO_MIXING_ERROR_ID_NOT_FOUND",t[t.AUDIO_MIXING_ERROR_SET_POSITION_FAILED=4]="AUDIO_MIXING_ERROR_SET_POSITION_FAILED",t[t.AUDIO_MIXING_ERROR_INVALID_VOLUME=5]="AUDIO_MIXING_ERROR_INVALID_VOLUME",t[t.AUDIO_MIXING_ERROR_LOAD_CONFLICT=6]="AUDIO_MIXING_ERROR_LOAD_CONFLICT",t[t.AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH=7]="AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH",t[t.AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH=8]="AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH",t[t.AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK=9]="AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK",t))(Nt||{});class G extends Error{constructor(e,i,s){super(i),m(this,"code",void 0),m(this,"message",void 0),m(this,"error",void 0),this.code=e,this.message=i,this.error=s,Object.setPrototypeOf(this,G.prototype)}toString(){return"SDKError: ".concat(this.code," ").concat(this.message)}}var Y=(t=>(t.onTrackEnded="onTrackEnded",t.onTrackMute="onTrackMute",t.onTrackUnmute="onTrackUnmute",t.onPlayerEvent="onPlayerEvent",t.onAutoplayFailed="onAutoplayFailed",t.onUserJoined="onUserJoined",t.onUserLeave="onUserLeave",t.onConnectionStateChanged="onConnectionStateChanged",t.onUserPublishStream="onUserPublishStream",t.onUserUnpublishStream="onUserUnpublishStream",t.onUserPublishScreen="onUserPublishScreen",t.onUserUnpublishScreen="onUserUnpublishScreen",t.onRoomMessageReceived="onRoomMessageReceived",t.onRoomBinaryMessageReceived="onRoomBinaryMessageReceived",t.onUserMessageReceived="onUserMessageReceived",t.onUserBinaryMessageReceived="onUserBinaryMessageReceived",t.onVideoFirstFrameRendered="onVideoFirstFrameRendered",t.onVideoFirstFrameDecoded="onVideoFirstFrameDecoded",t.onRemoteVideoFirstFrame="onRemoteVideoFirstFrame",t.onAudioFirstFrameDecoded="onAudioFirstFrameDecoded",t.onRemoteAudioFirstFrame="onRemoteAudioFirstFrame",t.onFirstPublicStreamVideoFrameRendered="onFirstPublicStreamVideoFrameRendered",t.onFirstPublicStreamVideoFrameDecoded="onFirstPublicStreamVideoFrameDecoded",t.onFirstPublicStreamAudioFrameDecoded="onFirstPublicStreamAudioFrameDecoded",t.onVideoDeviceStateChanged="onVideoDeviceStateChanged",t.onAudioDeviceStateChanged="onAudioDeviceStateChanged",t.onRemoteStreamStats="onRemoteStreamStats",t.onPublicStreamStats="onPublicStreamStats",t.onLocalStreamStats="onLocalStreamStats",t.onLocalStatsException="onLocalStatsException",t.onRemoteStatsException="onRemoteStatsException",t.onPublicStatsException="onPublicStatsException",t.onAudioVolumeIndication="onAudioVolumeIndication",t.onLocalAudioPropertiesReport="onLocalAudioPropertiesReport",t.onRemoteAudioPropertiesReport="onRemoteAudioPropertiesReport",t.onActiveSpeaker="onActiveSpeaker",t.onAudioPlaybackDeviceChanged="onAudioPlaybackDeviceChanged",t.onUserStartVideoCapture="onUserStartVideoCapture",t.onUserStopVideoCapture="onUserStopVideoCapture",t.onUserStartAudioCapture="onUserStartAudioCapture",t.onUserStopAudioCapture="onUserStopAudioCapture",t.onAutoPublishResult="onAutoPublishResult",t.onAutoSubscribeResult="onAutoSubscribeResult",t.onLiveTranscodingResult="onLiveTranscodingResult",t.onStreamMixingEvent="onStreamMixingEvent",t.onAudioPlaybackDeviceTestVolume="onAudioPlaybackDeviceTestVolume",t.onSEIMessageReceived="onSEIMessageReceived",t.onError="onError",t.onAudioMixingStateChanged="onAudioMixingStateChanged",t.onUserMessageReceivedOutsideRoom="onUserMessageReceivedOutsideRoom",t.onUserBinaryMessageReceivedOutsideRoom="onUserBinaryMessageReceivedOutsideRoom",t.onTokenWillExpire="onTokenWillExpire",t.onTokenPublishPrivilegeWillExpire="onTokenPublishPrivilegeWillExpire",t.onTokenPublishPrivilegeDidExpired="onTokenPublishPrivilegeDidExpired",t.onTokenSubscribePrivilegeWillExpire="onTokenSubscribePrivilegeWillExpire",t.onTokenSubscribePrivilegeDidExpired="onTokenSubscribePrivilegeDidExpired",t.onCloudProxyConnected="onCloudProxyConnected",t.onPushPublicStreamResult="onPushPublicStreamResult",t.onPublicStreamSEIMessageReceived="onPublicStreamSEIMessageReceived",t.onNetworkQuality="onNetworkQuality",t.onSimulcastSubscribeFallback="onSimulcastSubscribeFallback",t.onRemoteVideoSizeChanged="onRemoteVideoSizeChanged",t.onVideoStreamBanned="onVideoStreamBanned",t.onAudioStreamBanned="onAudioStreamBanned",t.onLocalVideoSizeChanged="onLocalVideoSizeChanged",t.onSubtitleStateChanged="onSubtitleStateChanged",t.onSubtitleMessageReceived="onSubtitleMessageReceived",t.onServerParamsSetResult="onServerParamsSetResult",t.onLocalStreamTrackChangedByExtension="onLocalStreamTrackChangedByExtension",t.onVendorConnectionStateChanged="onVendorConnectionStateChanged",t.onForwardStreamError="onForwardStreamError",t.onRejoinWithTcp="onRejoinWithTcp",t.onIceConnectWithTcp="onIceConnectWithTcp",t.onPublishRetry="onPublishRetry",t.onSubscribeRetry="onSubscribeRetry",t.onPublishResult="onPublishResult",t.onSubscribeResult="onSubscribeResult",t.onSEIStreamUpdate="onSEIStreamUpdate",t.onPlayerVisibility="onPlayerVisibility",t))(Y||{});function _u(t,e){if(typeof t!="boolean")throw new G(C.INVALID_PARAMS,"Invalid ".concat(e,": The value should be boolean type."))}const Df=()=>!ro()&&typeof HTMLVideoElement.prototype.requestVideoFrameCallback=="function";function ko(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.POSITIVE_INFINITY;if(t<i||t>s||typeof t!="number")throw new G(C.INVALID_PARAMS,"Invalid ".concat(e,": the value range is [").concat(i,", ").concat(s,"]. integer only"))}function Le(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.POSITIVE_INFINITY;if(t==null)throw new G(C.INVALID_PARAMS,"".concat(e," cannot be empty"));if(!Hw(t,i,s))throw new G(C.INVALID_PARAMS,"Invalid ".concat(e,": The value should be string type. Length of the string: [").concat(i,",").concat(s,"]"))}function _e(t,e,i){if(!i.includes(t))throw new G(C.INVALID_PARAMS,"Invalid ".concat(e,": The value can only be set as ").concat(JSON.stringify(i)))}function Wy(t){if(!(t instanceof MediaStreamTrack))throw new G(C.INVALID_PARAMS,"Invalid track, The value should be MediaStreamTrack type.")}function zc(t,e){if(gi(t))throw new G(C.INVALID_PARAMS,"Invalid ".concat(e,", should not be empty"))}function Yw(t,e){if(!Array.isArray(t))throw new G(C.INVALID_PARAMS,"Invalid ".concat(e,", should be array"))}function Su(t,e){if(!(t instanceof ArrayBuffer))throw new G(C.INVALID_PARAMS,"Invalid ".concat(e,", should be ArrayBuffer"))}function ah(t){try{const e=navigator.mediaDevices.getSupportedConstraints();for(const i of Object.keys(t))e[i]||delete t[i]}catch{}}function Hw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.POSITIVE_INFINITY;return typeof t=="string"&&t.length<=i&&t.length>=e}function gi(t){return t==null}function ld(t){if(typeof t!="string"||!/^[a-zA-Z0-9@._-]{1,128}$/.test(t))throw new G(C.INVALID_PARAMS,"The RoomId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function wt(t){if(typeof t!="string"||!/^[a-zA-Z0-9@._-]{1,128}$/.test(t))throw new G(C.INVALID_PARAMS,"The userId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function ha(t){if(typeof t!="string"||!/^[a-zA-Z0-9@._-]{1,128}$/.test(t))throw new G(C.INVALID_PARAMS,"The publicStreamId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function Fw(t){return typeof t!="string"}function Ow(t){zc(t,"userInfo"),wt(t.userId),gi(t.extraInfo)||Le(t.extraInfo,"userInfo.extraInfo",1,200)}function Jw(t){zc(t,"roomConfig"),_u(t.isAutoPublish,"roomConfig.isAutoPublish"),_u(t.isAutoSubscribeAudio,"roomConfig.isAutoSubscribeAudio"),_u(t.isAutoSubscribeVideo,"roomConfig.isAutoSubscribeVideo"),gi(t.roomProfileType)||_e(t.roomProfileType,"roomConfig",[Xt.communication,Xt.chat,Xt.chatRoom,Xt.coHost,Xt.meeting,Xt.classRoom])}function Gy(t){zc(t,"videoPlayerOption")}function Uw(t){var e,i;let s,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64;if(!t||t?.byteLength===0)throw new G(C.INVALID_PARAMS,"The message cannot be empty");if(t instanceof ArrayBuffer)s=t;else{if(typeof t!="string")throw new G(C.INVALID_PARAMS,"The message must be string or ArrayBuffer");s=$e.str2ab(t)}if(((e=s)===null||e===void 0?void 0:e.byteLength)>1024*o)throw new G(C.INVALID_PARAMS,"The message length must be less than ".concat(o,"KB"));return(i=s.byteLength)!==null&&i!==void 0?i:0}function Aw(t){const e=ae("FORCE_ENABLED_REPORT_CALLBACKS");return e!=null&&e.includes(t)||t===Y.onRemoteStreamStats&&ae("UPLOAD_REMOTE_STATS")?!0:![Y.onRemoteStreamStats,Y.onLocalStreamStats,Y.onAudioVolumeIndication,Y.onLocalAudioPropertiesReport,Y.onRemoteAudioPropertiesReport].includes(t)}function Dw(t){if(typeof t?.width!="number"||typeof t?.height!="number")throw new G(C.INVALID_PARAMS,"remoteVideoConfig must contain width, height, frameRate")}function vu(t,e){if(typeof t=="number"&&!Number.isNaN(t)&&t>=1)return;const i=t;if(!(i!=null&&i.min||i!=null&&i.max||i!=null&&i.exact||i!=null&&i.ideal))throw new G(C.INVALID_PARAMS,"".concat(e," is not a valid ConstrainULong"))}function gu(t){Yw(t,"videoEncoderConfig");for(const e of t)zc(e,"videoEncoderConfigItem"),ko(e?.maxKbps,"maxKbps"),vu(e?.width,"width"),vu(e?.height,"height"),vu(e?.frameRate,"frameRate")}function Fd(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NEGATIVE_INFINITY,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.POSITIVE_INFINITY;return ko(t,e,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),t=(t=t>i?t:i)<s?t:s}function zw(t,e){let i;return gi(e)||Le(e,"videoDeviceId"),gi(t)||(typeof t=="string"?(Le(t,"audioDeviceId"),i=t):(i=t?.audioDeviceId,e=t?.videoDeviceId,Le(i,"audioDeviceId"),Le(e,"videoDeviceId"))),{audioDeviceId:i,videoDeviceId:e}}var ti=(t=>(t[t.NONE=0]="NONE",t))(ti||{}),Qw=he,fu=Ee;Qw({global:!0,forced:fu.globalThis!==fu},{globalThis:fu});var jw=Ee,Bw=jw,$w=Bw,qw=$w,eK=qw,tK=eK,iK=tK,sK=iK,oK=sK,pa=Ie(oK),Xe=(t=>(t.H264="H264",t.VP8="VP8",t.H265="H265",t))(Xe||{}),Od=(t=>(t.H264="H264",t.VP8="VP8",t.ByteVC1="ByteVC1",t))(Od||{});const rK=async()=>{try{return!(xe()||!window.RTCPeerConnection||!window.RTCPeerConnection.prototype.addTransceiver||!window.RTCPeerConnection.prototype.createDataChannel)&&await jf()&&await Qf()}catch{return!1}},Ca=async()=>{const t=[];return await uK()&&await lK()&&t.push(Xe.H265),await jf()&&await Qf()&&t.push(Xe.H264),await cK()&&await dK()&&t.push(Xe.VP8),t},nK=async()=>(await Ca()).map((t=>t.toUpperCase())),aK=()=>{let t=!1;if(typeof RTCRtpSender.getCapabilities=="function"){const{codecs:e}=RTCRtpSender.getCapabilities("video")||{};e&&e.length>0&&e.forEach((i=>{var s,o;((s=i==null||(o=i.sdpFmtpLine)===null||o===void 0?void 0:o.indexOf("profile-level-id=42001f"))!==null&&s!==void 0?s:-1)>-1&&(t=!0)}))}return t},qe={};function zf(t){const e=t.split(`
`);let i=!1;for(const s of e)if(s.includes("level-asymmetry-allowed=1")&&s.includes("packetization-mode=1")&&s.includes("profile-level-id=42e0")){i=!0;break}if(i){const s=navigator.userAgent.toLowerCase();let o=!1;const r=[/miuibrowser/,/70.*HeyTapBrowser/i];for(const n of r)n.test(s)&&(o=!0);return!o}return!1}const hc=async t=>{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:t});const i=await e.createOffer();return e.close(),i.sdp.toLowerCase()},Sp=async()=>{let t=await hc("sendonly");return navigator.userAgent.includes("VivoBrowser")&&(t=await hc("sendonly")),qe.h264encode=zf(t),qe.vp8encode=t.indexOf("vp8")>-1,qe.h265encode=t.indexOf("h265")>-1,qe},vp=async()=>{let t=await hc("recvonly");return navigator.userAgent.includes("VivoBrowser")&&(t=await hc("recvonly")),qe.h264decode=zf(t),qe.vp8decode=t.indexOf("vp8")>-1,qe.h265decode=t.indexOf("h265")>-1,qe},Qf=async()=>{if(qe.h264encode===void 0)try{await Sp()}catch{return!1}return qe.h264encode||!1},jf=async()=>{if(qe.h264decode===void 0)try{await vp()}catch{return!1}return qe.h264decode||!1},dK=async()=>{if(qe.vp8encode===void 0)try{await Sp()}catch{return!1}return qe.vp8encode||!1},cK=async()=>{if(qe.vp8decode===void 0)try{await vp()}catch{return!1}return qe.vp8decode||!1},lK=async()=>{if(qe.h265encode===void 0)try{await Sp()}catch{return!1}return qe.h265encode||!1},uK=async()=>{if(qe.h265decode===void 0)try{await vp()}catch{return!1}return qe.h265decode||!1},Qo=()=>typeof TransformStream<"u"&&typeof RTCRtpSender<"u"&&typeof RTCRtpReceiver<"u"&&typeof RTCRtpScriptTransform<"u"&&"transform"in RTCRtpSender.prototype&&"transform"in RTCRtpReceiver.prototype&&$f()&&yK(),cs=()=>typeof TransformStream<"u"&&typeof RTCRtpSender<"u"&&typeof RTCRtpReceiver<"u"&&RTCRtpSender.prototype.createEncodedStreams!==void 0&&RTCRtpReceiver.prototype.createEncodedStreams!==void 0,Bf=()=>Nw?gs&&qt>=70||Te&&Zs>=80||Dt&&Dc>=14:kw?gs&&qt>=70||Te&&Zs>=80:yo?$r[0]>=14:!(!as&&!xw)&&gs&&qt>=86,mK=gs&&qt<=114,qr=!Te||Zs>=96,ii=!(Dt&&Dc<=14),hK=as&&gs||yo&&$r[0]>=16,pK=()=>!Te&&!Pw&&$r?.[0]!==14,bK=pa!==void 0&&"PressureObserver"in pa,$f=()=>typeof window<"u"&&window.Worker,yK=()=>typeof MessageChannel<"u",_K=Dt&&(Xo?.includes("16.1")||Xo?.includes("16.2")||Xo?.includes("16.3")),SK=!_K;var ur;const vK="rtc-access-ag.bytedance.com,rtc-access.bytedance.com,rtc-access2-hl.bytedance.com,rtcg-access.bytevcloud.com".split(",");function qf(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return t?(/^https?:\/\/.+/.test(t)||(t="https://".concat(t)),"".concat(t,"/dispatch/v1/AccessInfo?Action=GetAccessInfo")):""}function gK(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return t?(/^https?:\/\/.+/.test(t)||(t="https://".concat(t)),"".concat(t,"/video/v1/webrtc_log/")):""}const eZ="https://web-log-report.rtc.volcvideo.com/video/v1/webrtc_log/",fK="https://web-log-report.volcvideos.com/video/v1/webrtc_log/",ZK="common.rtc.volcvideo.com,rtcg.volcvideos.com".split(","),de={VERSION:"4.67.4",ICE_CONFIG_REQUEST_URLS_INTERNAL:vK.map(qf),ICE_CONFIG_REQUEST_URLS:[],EXPECTED_ADDR:"",LOG_SERVER_URL:eZ,CONFIG_REQUEST_DOMAINS:ZK,DEVICE_ID:"",OVERSEA:!1,PLATFORM:"",PRODUCT:"",FORCE_ENABLED_REPORT_CALLBACKS:[],SKIP_WEB_AUDIO_IN_TRACK:!1,ENFORCE_WEB_AUDIO_SUPPORTED:!1,AUDIO_STALL:!0,VIDEO_STALL:!0,VIDEO_STALL_100MS:!1,STATS_SCALLBACK_SUPPORT:!0,JOIN_ROOM_CONFIG:_i.DEFAULT_CONF,SIGNAL_COMPRESSION:!0,SIGNAL_CROP_JOINROOM:!0,VIDEO_STALL_DATA:500,AUDIO_STALL_DATA:200,IOS_SAFARI_ORIENTATION:!1,BLACK_FRAME_LIFETIME:6e4,FALLBACK_ENCODE_CODEC:"",SEI_TIME_OUT:2e3,SEI_COUNT_FPS:1,PRE_ICE:!1,STATS_LOOP_INTERVAL:1e3,HIDDEN_STATS:!1,UPLOAD_REMOTE_STATS:ti.NONE,SDK_CODEC_NEGOTIATION:!0,AUDIO_CODEC:"OPUS",DISABLE_ENCODED_TRANSFORM:!1,SKIP_SEI_FILTER:!1,AREA_CODE:"",DISABLE_COMPUTE_PRESSURE:!1,SEND_MESSAGE_SYNC:!1,H264_HW_ENCODER:!1,GPU_URL:"",TURN_ON_JOIN_ROOM_FAILURE_CALLBACK:!1,ENABLE_FALLBACK_HANDLER:!1,ENABLE_STANDARD_HANDLER:!1,PC_KILLSWITCH:{},ENABLE_PLAY_AFTER_CLICK:!1,AUTOPLAY_WORKAROUND:!0,ENGINE_WEB_CONFIG:{}},Vy=typeof window>"u"?()=>Promise.resolve():(ur=window)===null||ur===void 0||(ur=ur.RTCPeerConnection)===null||ur===void 0?void 0:ur.prototype.setRemoteDescription;function $t(t,e){if(Yd("setParameter",0,"key: ".concat(t,", value: ").concat(e)),t!=="VERSION"){if(t==="H264_HW_ENCODER"){de.H264_HW_ENCODER=!!e,e?aK()?(Yd("setParameter",0,"key: ".concat(t,", value: ").concat(e," is executed as it met 42001f")),RTCPeerConnection.prototype.setRemoteDescription=function(i){var s;return Vy.call(this,{type:i.type,sdp:(s=i.sdp)===null||s===void 0?void 0:A9(s).call(s,"42e01f","42001f")})}):Yd("setParameter",0,"key: ".concat(t,", value: ").concat(e," fails as sdp contains no 42001f")):RTCPeerConnection.prototype.setRemoteDescription=Vy;return}if(t==="GPU_URL")return void(de.GPU_URL=e);if(t==="JOIN_ROOM_CONFIG")return _i.setDefaulConf(e);if(t==="ICE_CONFIG_REQUEST_URLS"){const i=typeof e=="string"?[e]:e;return de.ICE_CONFIG_REQUEST_URLS=i.map(qf),We.clearAccessUrls(),void We.clearAccessNode()}if(t==="VIDEO_STALL_DATA")return void(de.VIDEO_STALL_DATA=Math.max(500,Number(e)));if(t==="AUDIO_STALL_DATA")return void(de.AUDIO_STALL_DATA=Math.max(200,Number(e)));if(t==="VIDEO_STALL_100MS")return void(de.VIDEO_STALL_100MS=Df()&&!!e);if(t==="PLATFORM"&&typeof e=="string")return void ma({platform:e});if(t==="PRODUCT"&&typeof e=="string")return void ma({product:e});if(t==="FORCE_ENABLED_REPORT_CALLBACKS"){const i=typeof e=="string"?[e]:e;return void(de.FORCE_ENABLED_REPORT_CALLBACKS=i)}if(t==="LOG_SERVER_URL"){const i=e===jm.overseas?fK:e===jm.domestic?eZ:typeof e=="string"?e:void 0;i&&(de.LOG_SERVER_URL=i,Ff(i))}else if(t==="OVERSEA")return ma({extra_is_oversea:e?"1":"0"}),void(de.OVERSEA=e);if(t==="CONFIG_REQUEST_DOMAINS"&&Array.isArray(e)&&e.length>0)return void(de.CONFIG_REQUEST_DOMAINS=e);if(!(t==="SEI_TIME_OUT"&&typeof e!="number")&&!(t==="SEI_COUNT_FPS"&&typeof e!="number")){if(t==="UPLOAD_REMOTE_STATS"&&typeof e=="string"){const i=e.split(",").map((s=>Js(s).call(s))).reduce(((s,o)=>o==="video"?s|Q.VIDEO:o==="audio"?s|Q.AUDIO:s),ti.NONE);return void(de.UPLOAD_REMOTE_STATS=i)}t==="DEVICE_ID"&&We.setDeviceId(e),Ki.getKeys().includes(t)?Ki.setParameter(t,e):Reflect.set(de,t,e)}}}function ae(t){return t==="DEVICE_ID"?We.getDeviceId():de[t]}function Ey(t,e,i){var s,o,r,n,a,c,d,l;return{type:"publicstream",action:e,publicStreamID:t,publicStreamMeta:{audio:{},video:{fps:((s=i.video)===null||s===void 0?void 0:s.fps)||15,bitrate:1e3*(((o=i.video)===null||o===void 0?void 0:o.kBitRate)||40),width:((r=i.video)===null||r===void 0?void 0:r.width)||640,height:((n=i.video)===null||n===void 0?void 0:n.height)||360},layout:{layoutMode:2,interpolationMode:((a=i.layout)===null||a===void 0?void 0:a.interpolationMode)||Pg.PREV_FRAME,canvas:{bgColor:((c=i.layout)===null||c===void 0?void 0:c.backgroundColor)||"#000000",bgImage:((d=i.layout)===null||d===void 0?void 0:d.backgroundImage)||""},regions:((l=i.layout)===null||l===void 0||(l=l.regions)===null||l===void 0?void 0:l.map((u=>({roomId:u.roomId,userId:u.userId,alterImage:u.alertImage||"",alpha:!u.alpha||Number(u.alpha)>1||Number(u.alpha)<=0?1:Number(u.alpha),x:!u.x||Number(u.x)>=1||Number(u.x)<0?0:Number(u.x),y:!u.y||Number(u.y)>=1||Number(u.y)<0?0:Number(u.y),w:!u.w||Number(u.w)>1||Number(u.w)<=0?1:Number(u.w),h:!u.h||Number(u.h)>1||Number(u.h)<=0?1:Number(u.h),zorder:!u.zorder||Number(u.zorder)<0||Number(u.zorder)>100?0:Number(u.zorder),renderMode:u.renderMode===void 0?1:u.renderMode,streamType:u.isScreenStream?1:0,mediaType:u.mediaType||0,sourceCrop:u.sourceCrop}))))||[]}}}}let tZ=[];function TK(){return tZ}function iZ(t){tZ=t}const IK=(t,e)=>{const i=TK();if(!i.length)return;const s=t[0],o=e.width||Ze(s.width),r=e.height||Ze(s.height),n=o*r;if(Ze(s.width)*Ze(s.height)<=n)return;let a,c,d=i[0];i.forEach((u=>{const p=Ze(u.width)*Ze(u.height);a||(n<p?a=u:d=u)})),c=a&&Ze(a.width)*Ze(a.height)-n<n-Ze(d.width)*Ze(d.height)?Object.assign({},a):Object.assign({},d);const l=t.filter((u=>!(c&&Ze(u.width)*Ze(u.height)>=n)||(c.maxKbps=Math.min(u.maxKbps,c.maxKbps),!1)));return l.unshift({width:o,height:r,frameRate:e.frameRate?Math.round(e.frameRate):l[0].frameRate,maxKbps:c.maxKbps}),l},ud={width:640,height:480,frameRate:15,maxKbps:600},RK={width:1920,height:1080,frameRate:15,maxKbps:3e3};let md;const XK=new Uint8Array(16);function CK(){if(!md&&(md=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!md))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return md(XK)}const dt=[];for(let t=0;t<256;++t)dt.push((t+256).toString(16).slice(1));function LK(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return dt[t[e+0]]+dt[t[e+1]]+dt[t[e+2]]+dt[t[e+3]]+"-"+dt[t[e+4]]+dt[t[e+5]]+"-"+dt[t[e+6]]+dt[t[e+7]]+"-"+dt[t[e+8]]+dt[t[e+9]]+"-"+dt[t[e+10]]+dt[t[e+11]]+dt[t[e+12]]+dt[t[e+13]]+dt[t[e+14]]+dt[t[e+15]]}const WK=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var Py={randomUUID:WK};function GK(t,e,i){if(Py.randomUUID&&!e&&!t)return Py.randomUUID();const s=(t=t||{}).random||(t.rng||CK)();return s[6]=15&s[6]|64,s[8]=63&s[8]|128,LK(s)}var sZ={exports:{}};function VK(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ny,ky={exports:{}},EK=new Proxy({},{get(t,e){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${e}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),PK=Object.freeze({__proto__:null,default:EK}),NK=jI(PK);function Ui(){return Ny||(Ny=1,ky.exports=(t=t||(function(e,i){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),pa!==void 0&&pa.crypto&&(s=pa.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&Wo!==void 0&&Wo.crypto&&(s=Wo.crypto),!s&&typeof VK=="function")try{s=NK}catch{}var o=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||(function(){function b(){}return function(S){var v;return b.prototype=S,v=new b,b.prototype=null,v}})(),n={},a=n.lib={},c=a.Base={extend:function(b){var S=r(this);return b&&S.mixIn(b),S.hasOwnProperty("init")&&this.init!==S.init||(S.init=function(){S.$super.init.apply(this,arguments)}),S.init.prototype=S,S.$super=this,S},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var S in b)b.hasOwnProperty(S)&&(this[S]=b[S]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},d=a.WordArray=c.extend({init:function(b,S){b=this.words=b||[],this.sigBytes=S!=i?S:4*b.length},toString:function(b){return(b||u).stringify(this)},concat:function(b){var S=this.words,v=b.words,f=this.sigBytes,g=b.sigBytes;if(this.clamp(),f%4)for(var Z=0;Z<g;Z++){var R=v[Z>>>2]>>>24-Z%4*8&255;S[f+Z>>>2]|=R<<24-(f+Z)%4*8}else for(var T=0;T<g;T+=4)S[f+T>>>2]=v[T>>>2];return this.sigBytes+=g,this},clamp:function(){var b=this.words,S=this.sigBytes;b[S>>>2]&=4294967295<<32-S%4*8,b.length=e.ceil(S/4)},clone:function(){var b=c.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var S=[],v=0;v<b;v+=4)S.push(o());return new d.init(S,b)}}),l=n.enc={},u=l.Hex={stringify:function(b){for(var S=b.words,v=b.sigBytes,f=[],g=0;g<v;g++){var Z=S[g>>>2]>>>24-g%4*8&255;f.push((Z>>>4).toString(16)),f.push((15&Z).toString(16))}return f.join("")},parse:function(b){for(var S=b.length,v=[],f=0;f<S;f+=2)v[f>>>3]|=parseInt(b.substr(f,2),16)<<24-f%8*4;return new d.init(v,S/2)}},p=l.Latin1={stringify:function(b){for(var S=b.words,v=b.sigBytes,f=[],g=0;g<v;g++){var Z=S[g>>>2]>>>24-g%4*8&255;f.push(String.fromCharCode(Z))}return f.join("")},parse:function(b){for(var S=b.length,v=[],f=0;f<S;f++)v[f>>>2]|=(255&b.charCodeAt(f))<<24-f%4*8;return new d.init(v,S)}},h=l.Utf8={stringify:function(b){try{return decodeURIComponent(escape(p.stringify(b)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(b){return p.parse(unescape(encodeURIComponent(b)))}},_=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(b){typeof b=="string"&&(b=h.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var S,v=this._data,f=v.words,g=v.sigBytes,Z=this.blockSize,R=g/(4*Z),T=(R=b?e.ceil(R):e.max((0|R)-this._minBufferSize,0))*Z,X=e.min(4*T,g);if(T){for(var L=0;L<T;L+=Z)this._doProcessBlock(f,L);S=f.splice(0,T),v.sigBytes-=X}return new d.init(S,X)},clone:function(){var b=c.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0});a.Hasher=_.extend({cfg:c.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){return b&&this._append(b),this._doFinalize()},blockSize:16,_createHelper:function(b){return function(S,v){return new b.init(v).finalize(S)}},_createHmacHelper:function(b){return function(S,v){return new y.HMAC.init(b,v).finalize(S)}}});var y=n.algo={};return n})(Math),t)),ky.exports;var t}(function(){var t;sZ.exports=(t=Ui(),(function(){if(typeof ArrayBuffer=="function"){var e=t.lib.WordArray,i=e.init,s=e.init=function(o){if(o instanceof ArrayBuffer&&(o=new Uint8Array(o)),(o instanceof Int8Array||typeof Uint8ClampedArray<"u"&&o instanceof Uint8ClampedArray||o instanceof Int16Array||o instanceof Uint16Array||o instanceof Int32Array||o instanceof Uint32Array||o instanceof Float32Array||o instanceof Float64Array)&&(o=new Uint8Array(o.buffer,o.byteOffset,o.byteLength)),o instanceof Uint8Array){for(var r=o.byteLength,n=[],a=0;a<r;a++)n[a>>>2]|=o[a]<<24-a%4*8;i.call(this,n,r)}else i.apply(this,arguments)};s.prototype=e}})(),t.lib.WordArray)})();var xy,kK=sZ.exports,xK=Ie(kK),oZ={exports:{}},My={exports:{}};function MK(){return xy||(xy=1,My.exports=(t=Ui(),(function(){var e=t,i=e.lib.WordArray;function s(o,r,n){for(var a=[],c=0,d=0;d<r;d++)if(d%4){var l=n[o.charCodeAt(d-1)]<<d%4*2|n[o.charCodeAt(d)]>>>6-d%4*2;a[c>>>2]|=l<<24-c%4*8,c++}return i.create(a,c)}e.enc.Base64={stringify:function(o){var r=o.words,n=o.sigBytes,a=this._map;o.clamp();for(var c=[],d=0;d<n;d+=3)for(var l=(r[d>>>2]>>>24-d%4*8&255)<<16|(r[d+1>>>2]>>>24-(d+1)%4*8&255)<<8|r[d+2>>>2]>>>24-(d+2)%4*8&255,u=0;u<4&&d+.75*u<n;u++)c.push(a.charAt(l>>>6*(3-u)&63));var p=a.charAt(64);if(p)for(;c.length%4;)c.push(p);return c.join("")},parse:function(o){var r=o.length,n=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var c=0;c<n.length;c++)a[n.charCodeAt(c)]=c}var d=n.charAt(64);if(d){var l=o.indexOf(d);l!==-1&&(r=l)}return s(o,r,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),t.enc.Base64)),My.exports;var t}var wy,Ky={exports:{}};function wK(){return wy||(wy=1,Ky.exports=(t=Ui(),(function(e){var i=t,s=i.lib,o=s.WordArray,r=s.Hasher,n=i.algo,a=[];(function(){for(var h=0;h<64;h++)a[h]=4294967296*e.abs(e.sin(h+1))|0})();var c=n.MD5=r.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(h,_){for(var y=0;y<16;y++){var b=_+y,S=h[b];h[b]=16711935&(S<<8|S>>>24)|4278255360&(S<<24|S>>>8)}var v=this._hash.words,f=h[_+0],g=h[_+1],Z=h[_+2],R=h[_+3],T=h[_+4],X=h[_+5],L=h[_+6],W=h[_+7],M=h[_+8],k=h[_+9],U=h[_+10],D=h[_+11],ie=h[_+12],B=h[_+13],$=h[_+14],te=h[_+15],N=v[0],K=v[1],x=v[2],E=v[3];N=d(N,K,x,E,f,7,a[0]),E=d(E,N,K,x,g,12,a[1]),x=d(x,E,N,K,Z,17,a[2]),K=d(K,x,E,N,R,22,a[3]),N=d(N,K,x,E,T,7,a[4]),E=d(E,N,K,x,X,12,a[5]),x=d(x,E,N,K,L,17,a[6]),K=d(K,x,E,N,W,22,a[7]),N=d(N,K,x,E,M,7,a[8]),E=d(E,N,K,x,k,12,a[9]),x=d(x,E,N,K,U,17,a[10]),K=d(K,x,E,N,D,22,a[11]),N=d(N,K,x,E,ie,7,a[12]),E=d(E,N,K,x,B,12,a[13]),x=d(x,E,N,K,$,17,a[14]),N=l(N,K=d(K,x,E,N,te,22,a[15]),x,E,g,5,a[16]),E=l(E,N,K,x,L,9,a[17]),x=l(x,E,N,K,D,14,a[18]),K=l(K,x,E,N,f,20,a[19]),N=l(N,K,x,E,X,5,a[20]),E=l(E,N,K,x,U,9,a[21]),x=l(x,E,N,K,te,14,a[22]),K=l(K,x,E,N,T,20,a[23]),N=l(N,K,x,E,k,5,a[24]),E=l(E,N,K,x,$,9,a[25]),x=l(x,E,N,K,R,14,a[26]),K=l(K,x,E,N,M,20,a[27]),N=l(N,K,x,E,B,5,a[28]),E=l(E,N,K,x,Z,9,a[29]),x=l(x,E,N,K,W,14,a[30]),N=u(N,K=l(K,x,E,N,ie,20,a[31]),x,E,X,4,a[32]),E=u(E,N,K,x,M,11,a[33]),x=u(x,E,N,K,D,16,a[34]),K=u(K,x,E,N,$,23,a[35]),N=u(N,K,x,E,g,4,a[36]),E=u(E,N,K,x,T,11,a[37]),x=u(x,E,N,K,W,16,a[38]),K=u(K,x,E,N,U,23,a[39]),N=u(N,K,x,E,B,4,a[40]),E=u(E,N,K,x,f,11,a[41]),x=u(x,E,N,K,R,16,a[42]),K=u(K,x,E,N,L,23,a[43]),N=u(N,K,x,E,k,4,a[44]),E=u(E,N,K,x,ie,11,a[45]),x=u(x,E,N,K,te,16,a[46]),N=p(N,K=u(K,x,E,N,Z,23,a[47]),x,E,f,6,a[48]),E=p(E,N,K,x,W,10,a[49]),x=p(x,E,N,K,$,15,a[50]),K=p(K,x,E,N,X,21,a[51]),N=p(N,K,x,E,ie,6,a[52]),E=p(E,N,K,x,R,10,a[53]),x=p(x,E,N,K,U,15,a[54]),K=p(K,x,E,N,g,21,a[55]),N=p(N,K,x,E,M,6,a[56]),E=p(E,N,K,x,te,10,a[57]),x=p(x,E,N,K,L,15,a[58]),K=p(K,x,E,N,B,21,a[59]),N=p(N,K,x,E,T,6,a[60]),E=p(E,N,K,x,D,10,a[61]),x=p(x,E,N,K,Z,15,a[62]),K=p(K,x,E,N,k,21,a[63]),v[0]=v[0]+N|0,v[1]=v[1]+K|0,v[2]=v[2]+x|0,v[3]=v[3]+E|0},_doFinalize:function(){var h=this._data,_=h.words,y=8*this._nDataBytes,b=8*h.sigBytes;_[b>>>5]|=128<<24-b%32;var S=e.floor(y/4294967296),v=y;_[15+(b+64>>>9<<4)]=16711935&(S<<8|S>>>24)|4278255360&(S<<24|S>>>8),_[14+(b+64>>>9<<4)]=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8),h.sigBytes=4*(_.length+1),this._process();for(var f=this._hash,g=f.words,Z=0;Z<4;Z++){var R=g[Z];g[Z]=16711935&(R<<8|R>>>24)|4278255360&(R<<24|R>>>8)}return f},clone:function(){var h=r.clone.call(this);return h._hash=this._hash.clone(),h}});function d(h,_,y,b,S,v,f){var g=h+(_&y|~_&b)+S+f;return(g<<v|g>>>32-v)+_}function l(h,_,y,b,S,v,f){var g=h+(_&b|y&~b)+S+f;return(g<<v|g>>>32-v)+_}function u(h,_,y,b,S,v,f){var g=h+(_^y^b)+S+f;return(g<<v|g>>>32-v)+_}function p(h,_,y,b,S,v,f){var g=h+(y^(_|~b))+S+f;return(g<<v|g>>>32-v)+_}i.MD5=r._createHelper(c),i.HmacMD5=r._createHmacHelper(c)})(Math),t.MD5)),Ky.exports;var t}var Yy,Hy={exports:{}},Fy={exports:{}};function KK(){return Yy||(Yy=1,Fy.exports=(a=Ui(),e=(t=a).lib,i=e.WordArray,s=e.Hasher,o=t.algo,r=[],n=o.SHA1=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,d){for(var l=this._hash.words,u=l[0],p=l[1],h=l[2],_=l[3],y=l[4],b=0;b<80;b++){if(b<16)r[b]=0|c[d+b];else{var S=r[b-3]^r[b-8]^r[b-14]^r[b-16];r[b]=S<<1|S>>>31}var v=(u<<5|u>>>27)+y+r[b];v+=b<20?1518500249+(p&h|~p&_):b<40?1859775393+(p^h^_):b<60?(p&h|p&_|h&_)-1894007588:(p^h^_)-899497514,y=_,_=h,h=p<<30|p>>>2,p=u,u=v}l[0]=l[0]+u|0,l[1]=l[1]+p|0,l[2]=l[2]+h|0,l[3]=l[3]+_|0,l[4]=l[4]+y|0},_doFinalize:function(){var c=this._data,d=c.words,l=8*this._nDataBytes,u=8*c.sigBytes;return d[u>>>5]|=128<<24-u%32,d[14+(u+64>>>9<<4)]=Math.floor(l/4294967296),d[15+(u+64>>>9<<4)]=l,c.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var c=s.clone.call(this);return c._hash=this._hash.clone(),c}}),t.SHA1=s._createHelper(n),t.HmacSHA1=s._createHmacHelper(n),a.SHA1)),Fy.exports;var t,e,i,s,o,r,n,a}var Oy,Jy,Uy={exports:{}};function YK(){return Oy||(Oy=1,Uy.exports=(t=Ui(),i=(e=t).lib.Base,s=e.enc.Utf8,void(e.algo.HMAC=i.extend({init:function(o,r){o=this._hasher=new o.init,typeof r=="string"&&(r=s.parse(r));var n=o.blockSize,a=4*n;r.sigBytes>a&&(r=o.finalize(r)),r.clamp();for(var c=this._oKey=r.clone(),d=this._iKey=r.clone(),l=c.words,u=d.words,p=0;p<n;p++)l[p]^=1549556828,u[p]^=909522486;c.sigBytes=d.sigBytes=a,this.reset()},reset:function(){var o=this._hasher;o.reset(),o.update(this._iKey)},update:function(o){return this._hasher.update(o),this},finalize:function(o){var r=this._hasher,n=r.finalize(o);return r.reset(),r.finalize(this._oKey.clone().concat(n))}})))),Uy.exports;var t,e,i,s}function rZ(){return Jy||(Jy=1,Hy.exports=(a=Ui(),KK(),YK(),e=(t=a).lib,i=e.Base,s=e.WordArray,o=t.algo,r=o.MD5,n=o.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:r,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,d){for(var l,u=this.cfg,p=u.hasher.create(),h=s.create(),_=h.words,y=u.keySize,b=u.iterations;_.length<y;){l&&p.update(l),l=p.update(c).finalize(d),p.reset();for(var S=1;S<b;S++)l=p.finalize(l),p.reset();h.concat(l)}return h.sigBytes=4*y,h}}),t.EvpKDF=function(c,d,l){return n.create(l).compute(c,d)},a.EvpKDF)),Hy.exports;var t,e,i,s,o,r,n,a}var Ay,Dy={exports:{}};function gp(){return Ay||(Ay=1,Dy.exports=(t=Ui(),rZ(),void(t.lib.Cipher||(function(e){var i=t,s=i.lib,o=s.Base,r=s.WordArray,n=s.BufferedBlockAlgorithm,a=i.enc;a.Utf8;var c=a.Base64,d=i.algo.EvpKDF,l=s.Cipher=n.extend({cfg:o.extend(),createEncryptor:function(g,Z){return this.create(this._ENC_XFORM_MODE,g,Z)},createDecryptor:function(g,Z){return this.create(this._DEC_XFORM_MODE,g,Z)},init:function(g,Z,R){this.cfg=this.cfg.extend(R),this._xformMode=g,this._key=Z,this.reset()},reset:function(){n.reset.call(this),this._doReset()},process:function(g){return this._append(g),this._process()},finalize:function(g){return g&&this._append(g),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function g(Z){return typeof Z=="string"?f:S}return function(Z){return{encrypt:function(R,T,X){return g(T).encrypt(Z,R,T,X)},decrypt:function(R,T,X){return g(T).decrypt(Z,R,T,X)}}}})()});s.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var u=i.mode={},p=s.BlockCipherMode=o.extend({createEncryptor:function(g,Z){return this.Encryptor.create(g,Z)},createDecryptor:function(g,Z){return this.Decryptor.create(g,Z)},init:function(g,Z){this._cipher=g,this._iv=Z}}),h=u.CBC=(function(){var g=p.extend();function Z(R,T,X){var L,W=this._iv;W?(L=W,this._iv=e):L=this._prevBlock;for(var M=0;M<X;M++)R[T+M]^=L[M]}return g.Encryptor=g.extend({processBlock:function(R,T){var X=this._cipher,L=X.blockSize;Z.call(this,R,T,L),X.encryptBlock(R,T),this._prevBlock=R.slice(T,T+L)}}),g.Decryptor=g.extend({processBlock:function(R,T){var X=this._cipher,L=X.blockSize,W=R.slice(T,T+L);X.decryptBlock(R,T),Z.call(this,R,T,L),this._prevBlock=W}}),g})(),_=(i.pad={}).Pkcs7={pad:function(g,Z){for(var R=4*Z,T=R-g.sigBytes%R,X=T<<24|T<<16|T<<8|T,L=[],W=0;W<T;W+=4)L.push(X);var M=r.create(L,T);g.concat(M)},unpad:function(g){var Z=255&g.words[g.sigBytes-1>>>2];g.sigBytes-=Z}};s.BlockCipher=l.extend({cfg:l.cfg.extend({mode:h,padding:_}),reset:function(){var g;l.reset.call(this);var Z=this.cfg,R=Z.iv,T=Z.mode;this._xformMode==this._ENC_XFORM_MODE?g=T.createEncryptor:(g=T.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==g?this._mode.init(this,R&&R.words):(this._mode=g.call(T,this,R&&R.words),this._mode.__creator=g)},_doProcessBlock:function(g,Z){this._mode.processBlock(g,Z)},_doFinalize:function(){var g,Z=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(Z.pad(this._data,this.blockSize),g=this._process(!0)):(g=this._process(!0),Z.unpad(g)),g},blockSize:4});var y=s.CipherParams=o.extend({init:function(g){this.mixIn(g)},toString:function(g){return(g||this.formatter).stringify(this)}}),b=(i.format={}).OpenSSL={stringify:function(g){var Z=g.ciphertext,R=g.salt;return(R?r.create([1398893684,1701076831]).concat(R).concat(Z):Z).toString(c)},parse:function(g){var Z,R=c.parse(g),T=R.words;return T[0]==1398893684&&T[1]==1701076831&&(Z=r.create(T.slice(2,4)),T.splice(0,4),R.sigBytes-=16),y.create({ciphertext:R,salt:Z})}},S=s.SerializableCipher=o.extend({cfg:o.extend({format:b}),encrypt:function(g,Z,R,T){T=this.cfg.extend(T);var X=g.createEncryptor(R,T),L=X.finalize(Z),W=X.cfg;return y.create({ciphertext:L,key:R,iv:W.iv,algorithm:g,mode:W.mode,padding:W.padding,blockSize:g.blockSize,formatter:T.format})},decrypt:function(g,Z,R,T){return T=this.cfg.extend(T),Z=this._parse(Z,T.format),g.createDecryptor(R,T).finalize(Z.ciphertext)},_parse:function(g,Z){return typeof g=="string"?Z.parse(g,this):g}}),v=(i.kdf={}).OpenSSL={execute:function(g,Z,R,T,X){if(T||(T=r.random(8)),X)L=d.create({keySize:Z+R,hasher:X}).compute(g,T);else var L=d.create({keySize:Z+R}).compute(g,T);var W=r.create(L.words.slice(Z),4*R);return L.sigBytes=4*Z,y.create({key:L,iv:W,salt:T})}},f=s.PasswordBasedCipher=S.extend({cfg:S.cfg.extend({kdf:v}),encrypt:function(g,Z,R,T){var X=(T=this.cfg.extend(T)).kdf.execute(R,g.keySize,g.ivSize,T.salt,T.hasher);T.iv=X.iv;var L=S.encrypt.call(this,g,Z,X.key,T);return L.mixIn(X),L},decrypt:function(g,Z,R,T){T=this.cfg.extend(T),Z=this._parse(Z,T.format);var X=T.kdf.execute(R,g.keySize,g.ivSize,Z.salt,T.hasher);return T.iv=X.iv,S.decrypt.call(this,g,Z,X.key,T)}})})()))),Dy.exports;var t}(function(){var t;oZ.exports=(t=Ui(),MK(),wK(),rZ(),gp(),(function(){var e=t,i=e.lib.BlockCipher,s=e.algo,o=[],r=[],n=[],a=[],c=[],d=[],l=[],u=[],p=[],h=[];(function(){for(var b=[],S=0;S<256;S++)b[S]=S<128?S<<1:S<<1^283;var v=0,f=0;for(S=0;S<256;S++){var g=f^f<<1^f<<2^f<<3^f<<4;g=g>>>8^255&g^99,o[v]=g,r[g]=v;var Z=b[v],R=b[Z],T=b[R],X=257*b[g]^16843008*g;n[v]=X<<24|X>>>8,a[v]=X<<16|X>>>16,c[v]=X<<8|X>>>24,d[v]=X,X=16843009*T^65537*R^257*Z^16843008*v,l[g]=X<<24|X>>>8,u[g]=X<<16|X>>>16,p[g]=X<<8|X>>>24,h[g]=X,v?(v=Z^b[b[b[T^Z]]],f^=b[b[f]]):v=f=1}})();var _=[0,1,2,4,8,16,32,64,128,27,54],y=s.AES=i.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var b=this._keyPriorReset=this._key,S=b.words,v=b.sigBytes/4,f=4*((this._nRounds=v+6)+1),g=this._keySchedule=[],Z=0;Z<f;Z++)Z<v?g[Z]=S[Z]:(X=g[Z-1],Z%v?v>6&&Z%v==4&&(X=o[X>>>24]<<24|o[X>>>16&255]<<16|o[X>>>8&255]<<8|o[255&X]):(X=o[(X=X<<8|X>>>24)>>>24]<<24|o[X>>>16&255]<<16|o[X>>>8&255]<<8|o[255&X],X^=_[Z/v|0]<<24),g[Z]=g[Z-v]^X);for(var R=this._invKeySchedule=[],T=0;T<f;T++){if(Z=f-T,T%4)var X=g[Z];else X=g[Z-4];R[T]=T<4||Z<=4?X:l[o[X>>>24]]^u[o[X>>>16&255]]^p[o[X>>>8&255]]^h[o[255&X]]}}},encryptBlock:function(b,S){this._doCryptBlock(b,S,this._keySchedule,n,a,c,d,o)},decryptBlock:function(b,S){var v=b[S+1];b[S+1]=b[S+3],b[S+3]=v,this._doCryptBlock(b,S,this._invKeySchedule,l,u,p,h,r),v=b[S+1],b[S+1]=b[S+3],b[S+3]=v},_doCryptBlock:function(b,S,v,f,g,Z,R,T){for(var X=this._nRounds,L=b[S]^v[0],W=b[S+1]^v[1],M=b[S+2]^v[2],k=b[S+3]^v[3],U=4,D=1;D<X;D++){var ie=f[L>>>24]^g[W>>>16&255]^Z[M>>>8&255]^R[255&k]^v[U++],B=f[W>>>24]^g[M>>>16&255]^Z[k>>>8&255]^R[255&L]^v[U++],$=f[M>>>24]^g[k>>>16&255]^Z[L>>>8&255]^R[255&W]^v[U++],te=f[k>>>24]^g[L>>>16&255]^Z[W>>>8&255]^R[255&M]^v[U++];L=ie,W=B,M=$,k=te}ie=(T[L>>>24]<<24|T[W>>>16&255]<<16|T[M>>>8&255]<<8|T[255&k])^v[U++],B=(T[W>>>24]<<24|T[M>>>16&255]<<16|T[k>>>8&255]<<8|T[255&L])^v[U++],$=(T[M>>>24]<<24|T[k>>>16&255]<<16|T[L>>>8&255]<<8|T[255&W])^v[U++],te=(T[k>>>24]<<24|T[L>>>16&255]<<16|T[W>>>8&255]<<8|T[255&M])^v[U++],b[S]=ie,b[S+1]=B,b[S+2]=$,b[S+3]=te},keySize:8});e.AES=i._createHelper(y)})(),t.AES)})();var HK=oZ.exports,nZ={exports:{}};nZ.exports=Ui().enc.Hex;var FK=nZ.exports,OK=Ie(FK),aZ={exports:{}};(function(){var t,e,i;aZ.exports=(i=Ui(),gp(),i.mode.CTR=(t=i.lib.BlockCipherMode.extend(),e=t.Encryptor=t.extend({processBlock:function(s,o){var r=this._cipher,n=r.blockSize,a=this._iv,c=this._counter;a&&(c=this._counter=a.slice(0),this._iv=void 0);var d=c.slice(0);r.encryptBlock(d,0),c[n-1]=c[n-1]+1|0;for(var l=0;l<n;l++)s[o+l]^=d[l]}}),t.Decryptor=e,t),i.mode.CTR)})();var JK=aZ.exports,UK=Ie(JK),dZ={exports:{}};(function(){var t;dZ.exports=(t=Ui(),gp(),t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding)})();var AK=dZ.exports,DK=Ie(AK),z={},cZ={},lZ={exports:{}},zy=lZ.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var e="candidate:%s %d %s %d %s %d typ %s";return e+=t.raddr!=null?" raddr %s rport %d":"%v%v",e+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(e+=" generation %d"),e+=t["network-id"]!=null?" network-id %d":"%v",e+=t["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var e="ssrc:%d";return t.attribute!=null&&(e+=" %s",t.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var e="mediaclk:";return e+=t.id!=null?"id=%s %s":"%v%s",e+=t.mediaClockValue!=null?"=%s":"",e+=t.rateNumerator!=null?" rate=%s":"",e+=t.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(zy).forEach((function(t){zy[t].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}));var fp=lZ.exports;(function(t){var e=function(n){return String(Number(n))===n?Number(n):n},i=function(n,a,c){var d=n.name&&n.names;n.push&&!a[n.push]?a[n.push]=[]:d&&!a[n.name]&&(a[n.name]={});var l=n.push?{}:d?a[n.name]:a;(function(u,p,h,_){if(_&&!h)p[_]=e(u[1]);else for(var y=0;y<h.length;y+=1)u[y+1]!=null&&(p[h[y]]=e(u[y+1]))})(c.match(n.reg),l,n.names,n.name),n.push&&a[n.push].push(l)},s=fp,o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(n){var a={},c=[],d=a;return n.split(/(\r\n|\r|\n)/).filter(o).forEach((function(l){var u=l[0],p=l.slice(2);u==="m"&&(c.push({rtp:[],fmtp:[]}),d=c[c.length-1]);for(var h=0;h<(s[u]||[]).length;h+=1){var _=s[u][h];if(_.reg.test(p))return i(_,d,p)}})),a.media=c,a};var r=function(n,a){var c=a.split(/=(.+)/,2);return c.length===2?n[c[0]]=e(c[1]):c.length===1&&a.length>1&&(n[c[0]]=void 0),n};t.parseParams=function(n){return n.split(/;\s?/).reduce(r,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(n){return n.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(n){for(var a=[],c=n.split(" ").map(e),d=0;d<c.length;d+=3)a.push({component:c[d],ip:c[d+1],port:c[d+2]});return a},t.parseImageAttributes=function(n){return n.split(" ").map((function(a){return a.substring(1,a.length-1).split(",").reduce(r,{})}))},t.parseSimulcastStreamList=function(n){return n.split(";").map((function(a){return a.split(",").map((function(c){var d,l=!1;return c[0]!=="~"?d=e(c):(d=e(c.substring(1,c.length)),l=!0),{scid:d,paused:l}}))}))}})(cZ);var Zu,Tu=fp,zK=/%[sdv%]/g,QK=function(t){var e=1,i=arguments,s=i.length;return t.replace(zK,(function(o){if(e>=s)return o;var r=i[e];switch(e+=1,o){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},xn=function(t,e,i){var s=[t+"="+(e.format instanceof Function?e.format(e.push?i:i[e.name]):e.format)];if(e.names)for(var o=0;o<e.names.length;o+=1){var r=e.names[o];e.name?s.push(i[e.name][r]):s.push(i[e.names[o]])}else s.push(i[e.name]);return QK.apply(null,s)},jK=["v","o","s","i","u","e","p","c","b","t","r","z","a"],BK=["i","c","b","a"],$K=function(t,e){e=e||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach((function(r){r.payloads==null&&(r.payloads="")}));var i=e.outerOrder||jK,s=e.innerOrder||BK,o=[];return i.forEach((function(r){Tu[r].forEach((function(n){n.name in t&&t[n.name]!=null?o.push(xn(r,n,t)):n.push in t&&t[n.push]!=null&&t[n.push].forEach((function(a){o.push(xn(r,n,a))}))}))})),t.media.forEach((function(r){o.push(xn("m",Tu.m[0],r)),s.forEach((function(n){Tu[n].forEach((function(a){a.name in r&&r[a.name]!=null?o.push(xn(n,a,r)):a.push in r&&r[a.push]!=null&&r[a.push].forEach((function(c){o.push(xn(n,a,c))}))}))}))})),o.join(`\r
`)+`\r
`},So=cZ,qK=$K,eY=fp;z.grammar=eY,z.write=qK,z.parse=So.parse,z.parseParams=So.parseParams,z.parseFmtpConfig=So.parseFmtpConfig,z.parsePayloads=So.parsePayloads,z.parseRemoteCandidates=So.parseRemoteCandidates,z.parseImageAttributes=So.parseImageAttributes,z.parseSimulcastStreamList=So.parseSimulcastStreamList;const tY=new TextDecoder,iY=new TextEncoder,Ts=()=>GK(),ee=()=>Date.now();function ba(t){let e=0;for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];for(const a of s)e+=a.length;const r=new t(e);let n=0;for(const a of s)r.set(a,n),n+=a.length;return r}class $e{static token2auth(e,i,s,o){return o?"Bearer ".concat(o):"Basic ".concat($e.createUnsafeToken(e,i,s))}static createUnsafeToken(e,i,s){return window.btoa([e,i,s].filter((o=>o!==null)).join(":"))}static merge(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const[s,o]of Object.entries(e))o!==null&&typeof o=="object"?$e.merge(e[s],i[s]):i[s]!==void 0&&(e[s]=i[s])}static ab2str(e){return tY.decode(e)}static ab2obj(e){try{const i=$e.ab2str(e);return JSON.parse(i)}catch{return{}}}static str2ab(e){return iY.encode(e).buffer}static async ab2b64str(e){if(ae("SEND_MESSAGE_SYNC")){const i=String.fromCharCode.apply(null,new Uint8Array(e));return window.btoa(i)}return(await new Promise((i=>{const s=new FileReader;s.onload=()=>i(s.result),s.readAsDataURL(new Blob([e]))}))).split(",",2)[1]}static async b64str2ab(e,i){return fetch("data:application/octet;base64,".concat(e)).then((s=>s.arrayBuffer())).catch((s=>{throw i&&i.report("rtc_error",{error_code:2001,message:"".concat(s.message," -> ").concat(e)}),s}))}}function uZ(t){return new Promise((e=>{setTimeout(e,t)}))}function Qy(){const t=Number("".concat(Math.random()).slice(-7).padEnd(7,"0")).toString(2).padEnd(28,"1").split(""),e=[];for(;t.length;)e.push(t.splice(0,7));return e.map(((i,s)=>{const o=s===e.length-1?"0":"1";return Number.parseInt(o+i.join(""),2)}))}const La=()=>Math.floor(65535*Math.random());function sY(t){return!(128&~t)}function Iu(t){return typeof t=="string"&&t.indexOf("__web__rtc__rtt__")>-1}function oY(t){let e="";for(let i=0;i<t;i++)e+=Math.floor(10*Math.random());return e}let Ru;const rY=async function(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(Ru)return Ru;const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});e.createDataChannel("default"),e.addTransceiver("audio",{direction:"recvonly"}),e.addTransceiver("video",{direction:"recvonly"}),t&&(e.addTransceiver("audio",{direction:"sendonly"}),e.addTransceiver("video",{direction:"sendonly"}));const i=await e.createOffer();return e.close(),Ru=i.sdp,i.sdp},nY=t=>new Promise(((e,i)=>{let s=(t=Array.isArray(t)?t:[]).length;const o=[];s===0?i([]):t.forEach((r=>{r.then((n=>{e(n)}),(n=>{s--,o.push(n),s===0&&i(o)}))}))}));function Mn(t){return Number(Math.max(-127,10*Math.log10(Math.pow(t/255,2))).toFixed(2))}function Be(t){return(t&Q.AUDIO)===Q.AUDIO}function Ve(t){return(t&Q.VIDEO)===Q.VIDEO}function Kt(t){const e={};return Object.keys(t).forEach((i=>{typeof t[i]=="object"?e[i]=Kt(t[i]):i.startsWith("_")&&!ae("HIDDEN_STATS")||(e[i]=t[i])})),e}function aY(t){const e=new DataView(t.buffer);if(e.byteLength<=4||e.getUint16(0)!==65535)return{seiCount:1,seis:[t]};const i={seiCount:0,seis:[]};let s=!1,o=2;for(;o<e.byteLength;){const r=e.getUint16(o);if(o+=2,e.byteLength-o<r){s=!0;break}const n=new Uint8Array(t.buffer,o,r);if(o+=r,e.byteLength-o>0&&e.byteLength-o<=2){s=!0;break}i.seiCount++,i.seis.push(n)}return s&&(i.seiCount=1,i.seis=[t]),i}function qi(t){return t===void 0}function jy(t){return function(e,i,s){const o=s.value;s.value=function(){console.warn("[RTC WebSDK]: Api: ".concat(i," has been abandoned from version ").concat(t));for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return o.apply(this,n)}}}function As(t){console.warn("[RTC WebSDK]: ".concat(t))}function Ze(t){return typeof t=="number"?t:typeof t?.exact=="number"?t.exact:typeof t?.ideal=="number"?t.ideal:typeof t?.max=="number"?t.max:typeof t?.min=="number"?t.min:1}function dY(t,e,i){if(typeof i.value=="function"){const s=i.value;i.value=function(){var o;const r=ke(this.id);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r?.set({room_id:a[1],user_id:(o=a[2])===null||o===void 0?void 0:o.userId}),s.apply(this,a)}}}const By=Math.pow(2,15);class cY{constructor(){m(this,"_id",void 0),this._id=Math.ceil(Math.random()*By)}getMessageId(){return++this._id>By&&(this._id=0),this._id}}function lY(t){const e={};return Object.keys(t).forEach((i=>{t[i]!==void 0&&(e[i]=t[i])})),e}const Qc=typeof window<"u"&&(window.location.search.includes("_rtc_debug_")||!((Zu=window.localStorage)===null||Zu===void 0||!Zu.getItem("_rtc_debug_")));function ia(t){const e=atob(t),i=e.length,s=new Uint8Array(i);for(let o=0;o<i;o++)s[o]=e.charCodeAt(o);return s}function dh(t){let e="";const i=t.byteLength;for(let s=0;s<i;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function uY(t,e,i){const s=Xu(t),o=Xu(e),r=Xu(i);return mY(HK.encrypt(s,o,{iv:r,mode:UK,padding:DK}).ciphertext)}function mY(t){const e=t.toString(OK),i=new Uint8Array(e.length/2);for(let s=0;s<e.length;s+=2)i[s/2]=parseInt(e.substr(s,2),16);return i}function Xu(t){const e=[];for(let i=0;i<t.length;i+=4)e.push(t[i]<<24|(t[i+1]||0)<<16|(t[i+2]||0)<<8|(t[i+3]||0));return xK.create(e,t.length)}function hY(t){return!t||t.length===0?[]:t.map((e=>{const{ip:i,tcpPorts:s,udpPorts:o}=e;return{ip:i,tcpPorts:s,udpPorts:o}}))}function Yi(){const t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)return{renderer:"unknown(WebGLRenderingContext not existed)",vendor:"unknown(WebGLRenderingContext not existed)"};const i=e.getExtension("WEBGL_debug_renderer_info");return i?{renderer:e.getParameter(i.UNMASKED_RENDERER_WEBGL),vendor:e.getParameter(i.UNMASKED_VENDOR_WEBGL)}:{renderer:"unknown(info not existed)",vendor:"unknown(info not existed)"}}function Si(t){var e,i;return t instanceof Error&&t.code?"".concat(t," | native.name=").concat((e=t.error)===null||e===void 0?void 0:e.name," native.message=").concat((i=t.error)===null||i===void 0?void 0:i.message):t instanceof Error?"NativeError: ".concat(t.name," ").concat(t.message):"UnknownError: ".concat(t)}function pc(t){const e=t.toLowerCase();return e==="h264"?Xe.H264:e==="vp8"?Xe.VP8:e==="bytevc1"||e==="h265"?Xe.H265:null}function pY(t){const e=t.toLowerCase();return e==="h264"?Od.H264:e==="vp8"?Od.VP8:e==="bytevc1"||e==="h265"?Od.ByteVC1:null}function mZ(t){if(!t)return[];const e=[];return t.split(",").forEach((i=>{const s=pc(Js(i).call(i));s&&e.push(s)})),e}function hZ(t){return t.toLowerCase().includes("h265")?Xe.H265:t.toLowerCase().includes("h264")?Xe.H264:t.toLowerCase().includes("vp8")?Xe.VP8:void 0}function bY(t){const e=z.parse(t);let i={};return e.media.forEach((s=>{s.type==="video"&&s.rtp.forEach((o=>{let{payload:r,codec:n}=o;const a=pc(n);a!==null&&(i[r]=a)}))})),i}var Cu,Lu,Wu,Gu,Vu,Eu,Pu,Nu,ku,xu,Mu,wu;const jc={};function yY(t,e){return t?Object.getOwnPropertyNames(t).filter((i=>{if(i==="peerIdentity")return!1;try{return typeof t[i]=="function"||t[i]===void 0}catch{return!1}})).map((i=>({obj:t,prefix:e,attr:i}))):[]}function _Y(t,e){try{return t[e].toString().includes("[native code]")?"native":"non-native"}catch{return"untouchable"}}const pZ=(typeof window<"u"?[[(Cu=window.RTCPeerConnection)===null||Cu===void 0?void 0:Cu.prototype,"RTCPeerConnection.prototype"],[window.RTCPeerConnection,"RTCPeerConnection"],[(Lu=window.RTCDataChannel)===null||Lu===void 0?void 0:Lu.prototype,"RTCDataChannel.prototype"],[window.RTCDataChannel,"RTCDataChannel"],[(Wu=window.MediaStreamTrack)===null||Wu===void 0?void 0:Wu.prototype,"MediaStreamTrack.prototype"],[window.MediaStreamTrack,"MediaStreamTrack"],[(Gu=window.MediaStream)===null||Gu===void 0?void 0:Gu.prototype,"MediaStream.prototype"],[window.MediaStream,"MediaStream"],[(Vu=window.HTMLAudioElement)===null||Vu===void 0?void 0:Vu.prototype,"HTMLAudioElement.prototype"],[(Eu=window.HTMLVideoElement)===null||Eu===void 0?void 0:Eu.prototype,"HTMLVideoElement.prototype"],[(Pu=window.HTMLMediaElement)===null||Pu===void 0?void 0:Pu.prototype,"HTMLMediaElement.prototype"],[(Nu=(ku=window.AudioContext)===null||ku===void 0?void 0:ku.prototype)!==null&&Nu!==void 0?Nu:(xu=window.webkitAudioContext)===null||xu===void 0?void 0:xu.prototype,"AudioContext.prototype"],[(Mu=window.BaseAudioContext)===null||Mu===void 0?void 0:Mu.prototype,"BaseAudioContext.prototype"],[(wu=window.AudioNode)===null||wu===void 0?void 0:wu.prototype,"AudioNode.prototype"],[window.navigator.mediaDevices,"navigator.mediaDevices"],[window.console,"console"]]:[]).reduce(((t,e)=>{let[i,s]=e;return t.concat(yY(i,s))}),[]);typeof window<"u"&&pZ.push({obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getUserMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getDisplayMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"enumerateDevices"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getSupportedConstraints"});for(const{obj:t,prefix:e,attr:i}of pZ){const s="".concat(e,".").concat(i);jc[s]=_Y(t,i)}Qc&&console.log("RTC_AMBULANCE",jc);const $y=Object.entries(jc).filter((t=>{let[e,i]=t;return i==="non-native"})).map((t=>{let[e,i]=t;return e}));Object.keys($y).length&&console.warn("RTC_AMBULANCE",`have non-native code:
`,$y.join(`
`));let bZ=!0,yZ=!0;function Jd(t,e,i){const s=t.match(e);return s&&s.length>=i&&parseInt(s[i],10)}function jo(t,e,i){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,o=s.addEventListener;s.addEventListener=function(n,a){if(n!==e)return o.apply(this,arguments);const c=d=>{const l=i(d);l&&(a.handleEvent?a.handleEvent(l):a(l))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),o.apply(this,[n,c])};const r=s.removeEventListener;s.removeEventListener=function(n,a){if(n!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(a))return r.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[n,c])},Object.defineProperty(s,"on"+e,{get(){return this["_on"+e]},set(n){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),n&&this.addEventListener(e,this["_on"+e]=n)},enumerable:!0,configurable:!0})}function SY(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(bZ=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function vY(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(yZ=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function _Z(){if(typeof window=="object"){if(bZ)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Zp(t,e){yZ&&console.warn(t+" is deprecated, please use "+e+" instead.")}function gY(t){const e={browser:null,version:null};if(t===void 0||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:i}=t;if(i.mozGetUserMedia)e.browser="firefox",e.version=Jd(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=Jd(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=Jd(i.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return e}function qy(t){return Object.prototype.toString.call(t)==="[object Object]"}function SZ(t){return qy(t)?Object.keys(t).reduce((function(e,i){const s=qy(t[i]),o=s?SZ(t[i]):t[i],r=s&&!Object.keys(o).length;return o===void 0||r?e:Object.assign(e,{[i]:o})}),{}):t}function ch(t,e,i){e&&!i.has(e.id)&&(i.set(e.id,e),Object.keys(e).forEach((s=>{s.endsWith("Id")?ch(t,t.get(e[s]),i):s.endsWith("Ids")&&e[s].forEach((o=>{ch(t,t.get(o),i)}))})))}function e_(t,e,i){const s=i?"outbound-rtp":"inbound-rtp",o=new Map;if(e===null)return o;const r=[];return t.forEach((n=>{n.type==="track"&&n.trackIdentifier===e.id&&r.push(n)})),r.forEach((n=>{t.forEach((a=>{a.type===s&&a.trackId===n.id&&ch(t,a,o)}))})),o}const t_=_Z;function vZ(t,e){const i=t&&t.navigator;if(!i.mediaDevices)return;const s=function(n){if(typeof n!="object"||n.mandatory||n.optional)return n;const a={};return Object.keys(n).forEach((c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const d=typeof n[c]=="object"?n[c]:{ideal:n[c]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const l=function(u,p){return u?u+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(d.ideal!==void 0){a.optional=a.optional||[];let u={};typeof d.ideal=="number"?(u[l("min",c)]=d.ideal,a.optional.push(u),u={},u[l("max",c)]=d.ideal,a.optional.push(u)):(u[l("",c)]=d.ideal,a.optional.push(u))}d.exact!==void 0&&typeof d.exact!="number"?(a.mandatory=a.mandatory||{},a.mandatory[l("",c)]=d.exact):["min","max"].forEach((u=>{d[u]!==void 0&&(a.mandatory=a.mandatory||{},a.mandatory[l(u,c)]=d[u])}))})),n.advanced&&(a.optional=(a.optional||[]).concat(n.advanced)),a},o=function(n,a){if(e.version>=61)return a(n);if((n=JSON.parse(JSON.stringify(n)))&&typeof n.audio=="object"){const c=function(d,l,u){l in d&&!(u in d)&&(d[u]=d[l],delete d[l])};c((n=JSON.parse(JSON.stringify(n))).audio,"autoGainControl","googAutoGainControl"),c(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=s(n.audio)}if(n&&typeof n.video=="object"){let c=n.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const d=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||d)){let l;if(delete n.video.facingMode,c.exact==="environment"||c.ideal==="environment"?l=["back","rear"]:c.exact!=="user"&&c.ideal!=="user"||(l=["front"]),l)return i.mediaDevices.enumerateDevices().then((u=>{let p=(u=u.filter((h=>h.kind==="videoinput"))).find((h=>l.some((_=>h.label.toLowerCase().includes(_)))));return!p&&u.length&&l.includes("back")&&(p=u[u.length-1]),p&&(n.video.deviceId=c.exact?{exact:p.deviceId}:{ideal:p.deviceId}),n.video=s(n.video),t_("chrome: "+JSON.stringify(n)),a(n)}))}n.video=s(n.video)}return t_("chrome: "+JSON.stringify(n)),a(n)},r=function(n){return e.version>=64?n:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[n.name]||n.name,message:n.message,constraint:n.constraint||n.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(n,a,c){o(n,(d=>{i.webkitGetUserMedia(d,a,(l=>{c&&c(r(l))}))}))}).bind(i),i.mediaDevices.getUserMedia){const n=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(a){return o(a,(c=>n(c).then((d=>{if(c.audio&&!d.getAudioTracks().length||c.video&&!d.getVideoTracks().length)throw d.getTracks().forEach((l=>{l.stop()})),new DOMException("","NotFoundError");return d}),(d=>Promise.reject(r(d))))))}}}function fY(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then((s=>{const o=i.video&&i.video.width,r=i.video&&i.video.height,n=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:n||3}},o&&(i.video.mandatory.maxWidth=o),r&&(i.video.mandatory.maxHeight=r),t.navigator.mediaDevices.getUserMedia(i)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function gZ(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function fZ(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",(s=>{let o;o=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((n=>n.track&&n.track.id===s.track.id)):{track:s.track};const r=new Event("track");r.track=s.track,r.receiver=o,r.transceiver={receiver:o},r.streams=[i.stream],this.dispatchEvent(r)})),i.stream.getTracks().forEach((s=>{let o;o=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((n=>n.track&&n.track.id===s.id)):{track:s};const r=new Event("track");r.track=s,r.receiver=o,r.transceiver={receiver:o},r.streams=[i.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else jo(t,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function ZZ(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(o,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=o.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:o}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(n,a){let c=o.apply(this,arguments);return c||(c=e(this,n),this._senders.push(c)),c};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(n){r.apply(this,arguments);const a=this._senders.indexOf(n);a!==-1&&this._senders.splice(a,1)}}const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach((r=>{this._senders.push(e(this,r))}))};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],s.apply(this,[o]),o.getTracks().forEach((r=>{const n=this._senders.find((a=>a.track===r));n&&this._senders.splice(this._senders.indexOf(n),1)}))}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach((s=>s._pc=this)),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function TZ(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const r=function(a){const c={};return a.result().forEach((d=>{const l={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach((u=>{l[u]=d.stat(u)})),c[l.id]=l})),c},n=function(a){return new Map(Object.keys(a).map((c=>[c,a[c]])))};if(arguments.length>=2){const a=function(c){s(n(r(c)))};return e.apply(this,[a,i])}return new Promise(((a,c)=>{e.apply(this,[function(d){a(n(r(d)))},c])})).then(s,o)}}function IZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=i.apply(this,[]);return o.forEach((r=>r._pc=this)),o});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then((r=>e_(r,o.track,!0)))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach((o=>o._pc=this)),s}),jo(t,"track",(s=>(s.receiver._pc=s.srcElement,s))),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then((o=>e_(o,s.track,!1)))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let s,o,r;return this.getSenders().forEach((n=>{n.track===i&&(s?r=!0:s=n)})),this.getReceivers().forEach((n=>(n.track===i&&(o?r=!0:o=n),n.track===i))),r||s&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function RZ(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((r=>this._shimmedLocalStreams[r][0]))};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(r,n){if(!n)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a=e.apply(this,arguments);return this._shimmedLocalStreams[n.id]?this._shimmedLocalStreams[n.id].indexOf(a)===-1&&this._shimmedLocalStreams[n.id].push(a):this._shimmedLocalStreams[n.id]=[n,a],a};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._shimmedLocalStreams=this._shimmedLocalStreams||{},r.getTracks().forEach((c=>{if(this.getSenders().find((d=>d.track===c)))throw new DOMException("Track already exists.","InvalidAccessError")}));const n=this.getSenders();i.apply(this,arguments);const a=this.getSenders().filter((c=>n.indexOf(c)===-1));this._shimmedLocalStreams[r.id]=[r].concat(a)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[r.id],s.apply(this,arguments)};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach((n=>{const a=this._shimmedLocalStreams[n].indexOf(r);a!==-1&&this._shimmedLocalStreams[n].splice(a,1),this._shimmedLocalStreams[n].length===1&&delete this._shimmedLocalStreams[n]})),o.apply(this,arguments)}}function XZ(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return RZ(t);const i=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const c=i.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map((d=>this._reverseStreams[d.id]))};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach((d=>{if(this.getSenders().find((l=>l.track===d)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[c.id]){const d=new t.MediaStream(c.getTracks());this._streams[c.id]=d,this._reverseStreams[d.id]=c,c=d}s.apply(this,[c])};const o=t.RTCPeerConnection.prototype.removeStream;function r(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach((u=>{const p=c._reverseStreams[u],h=c._streams[p.id];l=l.replace(new RegExp(h.id,"g"),p.id)})),new RTCSessionDescription({type:d.type,sdp:l})}t.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},t.RTCPeerConnection.prototype.addTrack=function(c,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find((p=>p===c)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((p=>p.track===c)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const u=this._streams[d.id];if(u)u.addTrack(c),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const p=new t.MediaStream([c]);this._streams[d.id]=p,this._reverseStreams[p.id]=d,this.addStream(p)}return this.getSenders().find((p=>p.track===c))},["createOffer","createAnswer"].forEach((function(c){const d=t.RTCPeerConnection.prototype[c],l={[c](){const u=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[p=>{const h=r(this,p);u[0].apply(null,[h])},p=>{u[1]&&u[1].apply(null,p)},arguments[2]]):d.apply(this,arguments).then((p=>r(this,p)))}};t.RTCPeerConnection.prototype[c]=l[c]}));const n=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach((u=>{const p=c._reverseStreams[u],h=c._streams[p.id];l=l.replace(new RegExp(p.id,"g"),h.id)})),new RTCSessionDescription({type:d.type,sdp:l})})(this,arguments[0]),n.apply(this,arguments)):n.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=a.get.apply(this);return c.type===""?c:r(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let d;this._streams=this._streams||{},Object.keys(this._streams).forEach((l=>{this._streams[l].getTracks().find((u=>c.track===u))&&(d=this._streams[l])})),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function lh(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]}))}function CZ(t,e){jo(t,"negotiationneeded",(i=>{const s=i.target;if(!(e.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return i}))}var i_=Object.freeze({__proto__:null,fixNegotiationNeeded:CZ,shimAddTrackRemoveTrack:XZ,shimAddTrackRemoveTrackWithNative:RZ,shimGetDisplayMedia:fY,shimGetSendersWithDtmf:ZZ,shimGetStats:TZ,shimGetUserMedia:vZ,shimMediaStream:gZ,shimOnTrack:fZ,shimPeerConnection:lh,shimSenderReceiverGetStats:IZ});function LZ(t,e){const i=t&&t.navigator,s=t&&t.MediaStreamTrack;if(i.getUserMedia=function(o,r,n){Zp("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(o).then(r,n)},!(e.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const o=function(n,a,c){a in n&&!(c in n)&&(n[c]=n[a],delete n[a])},r=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(n){return typeof n=="object"&&typeof n.audio=="object"&&(n=JSON.parse(JSON.stringify(n)),o(n.audio,"autoGainControl","mozAutoGainControl"),o(n.audio,"noiseSuppression","mozNoiseSuppression")),r(n)},s&&s.prototype.getSettings){const n=s.prototype.getSettings;s.prototype.getSettings=function(){const a=n.apply(this,arguments);return o(a,"mozAutoGainControl","autoGainControl"),o(a,"mozNoiseSuppression","noiseSuppression"),a}}if(s&&s.prototype.applyConstraints){const n=s.prototype.applyConstraints;s.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),o(a,"autoGainControl","mozAutoGainControl"),o(a,"noiseSuppression","mozNoiseSuppression")),n.apply(this,[a])}}}}function ZY(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function WZ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uh(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(o){const r=t.RTCPeerConnection.prototype[o],n={[o](){return arguments[0]=new(o==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[o]=n[o]}));const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,r,n]=arguments;return s.apply(this,[o||null]).then((a=>{if(e.version<53&&!r)try{a.forEach((c=>{c.type=i[c.type]||c.type}))}catch(c){if(c.name!=="TypeError")throw c;a.forEach(((d,l)=>{a.set(l,Object.assign({},d,{type:i[d.type]||d.type}))}))}return a})).then(r,n)}}function GZ(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach((o=>o._pc=this)),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function VZ(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach((s=>s._pc=this)),i}),jo(t,"track",(i=>(i.receiver._pc=i.srcElement,i))),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function EZ(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){Zp("removeStream","removeTrack"),this.getSenders().forEach((i=>{i.track&&e.getTracks().includes(i.track)&&this.removeTrack(i)}))})}function PZ(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function NZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach((r=>{if("rid"in r&&!/^[a-z0-9]{0,16}$/i.test(r.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in r&&!(parseFloat(r.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in r&&!(parseFloat(r.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const o=e.apply(this,arguments);if(s){const{sender:r}=o,n=r.getParameters();(!("encodings"in n)||n.encodings.length===1&&Object.keys(n.encodings[0]).length===0)&&(n.encodings=i,r.sendEncodings=i,this.setParametersPromises.push(r.setParameters(n).then((()=>{delete r.sendEncodings})).catch((()=>{delete r.sendEncodings}))))}return o})}function kZ(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function xZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}function MZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}var s_=Object.freeze({__proto__:null,shimAddTransceiver:NZ,shimCreateAnswer:MZ,shimCreateOffer:xZ,shimGetDisplayMedia:ZY,shimGetParameters:kZ,shimGetUserMedia:LZ,shimOnTrack:WZ,shimPeerConnection:uh,shimRTCDataChannel:PZ,shimReceiverGetStats:VZ,shimRemoveStream:EZ,shimSenderGetStats:GZ});function wZ(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach((s=>e.call(this,s,i))),i.getVideoTracks().forEach((s=>e.call(this,s,i)))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,o=new Array(s>1?s-1:0),r=1;r<s;r++)o[r-1]=arguments[r];return o&&o.forEach((n=>{this._localStreams?this._localStreams.includes(n)||this._localStreams.push(n):this._localStreams=[n]})),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(e);if(i===-1)return;this._localStreams.splice(i,1);const s=e.getTracks();this.getSenders().forEach((o=>{s.includes(o.track)&&this.removeTrack(o)}))})}}function KZ(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach((o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const r=new Event("addstream");r.stream=o,this.dispatchEvent(r)}))})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach((o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const r=new Event("addstream");r.stream=o,i.dispatchEvent(r)}))}),e.apply(i,arguments)}}}function YZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,i=e.createOffer,s=e.createAnswer,o=e.setLocalDescription,r=e.setRemoteDescription,n=e.addIceCandidate;e.createOffer=function(c,d){const l=arguments.length>=2?arguments[2]:arguments[0],u=i.apply(this,[l]);return d?(u.then(c,d),Promise.resolve()):u},e.createAnswer=function(c,d){const l=arguments.length>=2?arguments[2]:arguments[0],u=s.apply(this,[l]);return d?(u.then(c,d),Promise.resolve()):u};let a=function(c,d,l){const u=o.apply(this,[c]);return l?(u.then(d,l),Promise.resolve()):u};e.setLocalDescription=a,a=function(c,d,l){const u=r.apply(this,[c]);return l?(u.then(d,l),Promise.resolve()):u},e.setRemoteDescription=a,a=function(c,d,l){const u=n.apply(this,[c]);return l?(u.then(d,l),Promise.resolve()):u},e.addIceCandidate=a}function HZ(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const i=e.mediaDevices,s=i.getUserMedia.bind(i);e.mediaDevices.getUserMedia=o=>s(FZ(o))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,s,o){e.mediaDevices.getUserMedia(i).then(s,o)}).bind(e))}function FZ(t){return t&&t.video!==void 0?Object.assign({},t,{video:SZ(t.video)}):t}function OZ(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const o=[];for(let r=0;r<i.iceServers.length;r++){let n=i.iceServers[r];n.urls===void 0&&n.url?(Zp("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,o.push(n)):o.push(i.iceServers[r])}i.iceServers=o}return new e(i,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function JZ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function UZ(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find((r=>r.receiver.track.kind==="audio"));i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find((r=>r.receiver.track.kind==="video"));i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function AZ(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var o_=Object.freeze({__proto__:null,shimAudioContext:AZ,shimCallbacksAPI:YZ,shimConstraints:FZ,shimCreateOfferLegacy:UZ,shimGetUserMedia:HZ,shimLocalStreamsAPI:wZ,shimRTCIceServerUrls:OZ,shimRemoteStreamsAPI:KZ,shimTrackEventTransceiver:JZ}),DZ={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(i){return Js(i).call(i).split(`
`).map((s=>Js(s).call(s)))},e.splitSections=function(i){return i.split(`
m=`).map(((s,o)=>{var r;return Js(r=o>0?"m="+s:s).call(r)+`\r
`}))},e.getDescription=function(i){const s=e.splitSections(i);return s&&s[0]},e.getMediaSections=function(i){const s=e.splitSections(i);return s.shift(),s},e.matchPrefix=function(i,s){return e.splitLines(i).filter((o=>o.indexOf(s)===0))},e.parseCandidate=function(i){let s;s=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const o={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let r=8;r<s.length;r+=2)switch(s[r]){case"raddr":o.relatedAddress=s[r+1];break;case"rport":o.relatedPort=parseInt(s[r+1],10);break;case"tcptype":o.tcpType=s[r+1];break;case"ufrag":o.ufrag=s[r+1],o.usernameFragment=s[r+1];break;default:o[s[r]]===void 0&&(o[s[r]]=s[r+1])}return o},e.writeCandidate=function(i){const s=[];s.push(i.foundation);const o=i.component;o==="rtp"?s.push(1):o==="rtcp"?s.push(2):s.push(o),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const r=i.type;return s.push("typ"),s.push(r),r!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},e.parseIceOptions=function(i){return i.substring(14).split(" ")},e.parseRtpMap=function(i){let s=i.substring(9).split(" ");const o={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),o.name=s[0],o.clockRate=parseInt(s[1],10),o.channels=s.length===3?parseInt(s[2],10):1,o.numChannels=o.channels,o},e.writeRtpMap=function(i){let s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);const o=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(o!==1?"/"+o:"")+`\r
`},e.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},e.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},e.parseFmtp=function(i){const s={};let o;const r=i.substring(i.indexOf(" ")+1).split(";");for(let c=0;c<r.length;c++){var n,a;o=Js(n=r[c]).call(n).split("="),s[Js(a=o[0]).call(a)]=o[1]}return s},e.writeFmtp=function(i){let s="",o=i.payloadType;if(i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const r=[];Object.keys(i.parameters).forEach((n=>{i.parameters[n]!==void 0?r.push(n+"="+i.parameters[n]):r.push(n)})),s+="a=fmtp:"+o+" "+r.join(";")+`\r
`}return s},e.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},e.writeRtcpFb=function(i){let s="",o=i.payloadType;return i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach((r=>{s+="a=rtcp-fb:"+o+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`})),s},e.parseSsrcMedia=function(i){const s=i.indexOf(" "),o={ssrc:parseInt(i.substring(7,s),10)},r=i.indexOf(":",s);return r>-1?(o.attribute=i.substring(s+1,r),o.value=i.substring(r+1)):o.attribute=i.substring(s+1),o},e.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map((o=>parseInt(o,10)))}},e.getMid=function(i){const s=e.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},e.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},e.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:e.matchPrefix(i+s,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(i,s){let o="a=setup:"+s+`\r
`;return i.fingerprints.forEach((r=>{o+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`})),o},e.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},e.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?e.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},e.getCryptoParameters=function(i,s){return e.matchPrefix(i+s,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(i,s){const o=e.matchPrefix(i+s,"a=ice-ufrag:")[0],r=e.matchPrefix(i+s,"a=ice-pwd:")[0];return o&&r?{usernameFragment:o.substring(12),password:r.substring(10)}:null},e.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(s+=`a=ice-lite\r
`),s},e.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(i)[0].split(" ");s.profile=o[2];for(let n=3;n<o.length;n++){const a=o[n],c=e.matchPrefix(i,"a=rtpmap:"+a+" ")[0];if(c){const d=e.parseRtpMap(c),l=e.matchPrefix(i,"a=fmtp:"+a+" ");switch(d.parameters=l.length?e.parseFmtp(l[0]):{},d.rtcpFeedback=e.matchPrefix(i,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),s.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(d.name.toUpperCase())}}}e.matchPrefix(i,"a=extmap:").forEach((n=>{s.headerExtensions.push(e.parseExtmap(n))}));const r=e.matchPrefix(i,"a=rtcp-fb:* ").map(e.parseRtcpFb);return s.codecs.forEach((n=>{r.forEach((a=>{n.rtcpFeedback.find((c=>c.type===a.type&&c.parameter===a.parameter))||n.rtcpFeedback.push(a)}))})),s},e.writeRtpDescription=function(i,s){let o="";o+="m="+i+" ",o+=s.codecs.length>0?"9":"0",o+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=s.codecs.map((n=>n.preferredPayloadType!==void 0?n.preferredPayloadType:n.payloadType)).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach((n=>{o+=e.writeRtpMap(n),o+=e.writeFmtp(n),o+=e.writeRtcpFb(n)}));let r=0;return s.codecs.forEach((n=>{n.maxptime>r&&(r=n.maxptime)})),r>0&&(o+="a=maxptime:"+r+`\r
`),s.headerExtensions&&s.headerExtensions.forEach((n=>{o+=e.writeExtmap(n)})),o},e.parseRtpEncodingParameters=function(i){const s=[],o=e.parseRtpParameters(i),r=o.fecMechanisms.indexOf("RED")!==-1,n=o.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(i,"a=ssrc:").map((p=>e.parseSsrcMedia(p))).filter((p=>p.attribute==="cname")),c=a.length>0&&a[0].ssrc;let d;const l=e.matchPrefix(i,"a=ssrc-group:FID").map((p=>p.substring(17).split(" ").map((h=>parseInt(h,10)))));l.length>0&&l[0].length>1&&l[0][0]===c&&(d=l[0][1]),o.codecs.forEach((p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let h={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&d&&(h.rtx={ssrc:d}),s.push(h),r&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:c,mechanism:n?"red+ulpfec":"red"},s.push(h))}})),s.length===0&&c&&s.push({ssrc:c});let u=e.matchPrefix(i,"b=");return u.length&&(u=u[0].indexOf("b=TIAS:")===0?parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,s.forEach((p=>{p.maxBitrate=u}))),s},e.parseRtcpParameters=function(i){const s={},o=e.matchPrefix(i,"a=ssrc:").map((a=>e.parseSsrcMedia(a))).filter((a=>a.attribute==="cname"))[0];o&&(s.cname=o.value,s.ssrc=o.ssrc);const r=e.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=r.length>0,s.compound=r.length===0;const n=e.matchPrefix(i,"a=rtcp-mux");return s.mux=n.length>0,s},e.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+=`a=rtcp-rsize\r
`),i.mux&&(s+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),s},e.parseMsid=function(i){let s;const o=e.matchPrefix(i,"a=msid:");if(o.length===1)return s=o[0].substring(7).split(" "),{stream:s[0],track:s[1]};const r=e.matchPrefix(i,"a=ssrc:").map((n=>e.parseSsrcMedia(n))).filter((n=>n.attribute==="msid"));return r.length>0?(s=r[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},e.parseSctpDescription=function(i){const s=e.parseMLine(i),o=e.matchPrefix(i,"a=max-message-size:");let r;o.length>0&&(r=parseInt(o[0].substring(19),10)),isNaN(r)&&(r=65536);const n=e.matchPrefix(i,"a=sctp-port:");if(n.length>0)return{port:parseInt(n[0].substring(12),10),protocol:s.fmt,maxMessageSize:r};const a=e.matchPrefix(i,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:r}}},e.writeSctpDescription=function(i,s){let o=[];return o=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&o.push("a=max-message-size:"+s.maxMessageSize+`\r
`),o.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(i,s,o){let r;const n=s!==void 0?s:2;return r=i||e.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+r+" "+n+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(i,s){const o=e.splitLines(i);for(let r=0;r<o.length;r++)switch(o[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[r].substring(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(i){return e.splitLines(i)[0].split(" ")[0].substring(2)},e.isRejected=function(i){return i.split(" ",2)[1]==="0"},e.parseMLine=function(i){const s=e.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(i){const s=e.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const s=e.splitLines(i);for(let o=0;o<s.length;o++)if(s[o].length<2||s[o].charAt(1)!=="=")return!1;return!0},t.exports=e})(DZ);var zZ=DZ.exports,Ar=Ie(zZ),TY=QI({__proto__:null,default:Ar},[zZ]);function Ud(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const s=new e(i),o=Ar.parseCandidate(i.candidate);for(const r in o)r in s||Object.defineProperty(s,r,{value:o[r]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,jo(t,"icecandidate",(i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i)))}function mh(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||jo(t,"icecandidate",(e=>{if(e.candidate){const i=Ar.parseCandidate(e.candidate.candidate);i.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return e}))}function Ad(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if((function(s){if(!s||!s.sdp)return!1;const o=Ar.splitSections(s.sdp);return o.shift(),o.some((r=>{const n=Ar.parseMLine(r);return n&&n.kind==="application"&&n.protocol.indexOf("SCTP")!==-1}))})(arguments[0])){const s=(function(c){const d=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const l=parseInt(d[1],10);return l!=l?-1:l})(arguments[0]),o=(function(c){let d=65536;return e.browser==="firefox"&&(d=e.version<57?c===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d})(s),r=(function(c,d){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Ar.matchPrefix(c.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&d!==-1&&(l=2147483637),l})(arguments[0],s);let n;n=o===0&&r===0?Number.POSITIVE_INFINITY:o===0||r===0?Math.max(o,r):Math.min(o,r);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>n}),this._sctp=a}return i.apply(this,arguments)}}function Dd(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(s,o){const r=s.send;s.send=function(){return r.apply(s,arguments)}}const i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return e(s),s},jo(t,"datachannel",(s=>(e(s.channel,s.target),s)))}function hh(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((i=>{const s=e[i];e[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const r=o.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const n=new Event("connectionstatechange",o);r.dispatchEvent(n)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}}))}function ph(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=s.sdp.split(`
`).filter((r=>Js(r).call(r)!=="a=extmap-allow-mixed")).join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:o}):s.sdp=o}return i.apply(this,arguments)}}function zd(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Qd(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?i.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((o=>i.apply(this,[o])))})}var IY=Object.freeze({__proto__:null,removeExtmapAllowMixed:ph,shimAddIceCandidateNullOrEmpty:zd,shimConnectionState:hh,shimMaxMessageSize:Ad,shimParameterlessSetLocalDescription:Qd,shimRTCIceCandidate:Ud,shimRTCIceCandidateRelayProtocol:mh,shimSendThrowTypeError:Dd});function RY(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=_Z,s=gY(t),o={browserDetails:s,commonShim:IY,extractVersion:Jd,disableLog:SY,disableWarnings:vY,sdp:TY};switch(s.browser){case"chrome":if(!i_||!lh||!e.shimChrome)return i("Chrome shim is not included in this adapter release."),o;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),o;i("adapter.js shimming chrome."),o.browserShim=i_,zd(t,s),Qd(t),vZ(t,s),gZ(t),lh(t,s),fZ(t),XZ(t,s),ZZ(t),TZ(t),IZ(t),CZ(t,s),Ud(t),mh(t),hh(t),Ad(t,s),Dd(t),ph(t,s);break;case"firefox":if(!s_||!uh||!e.shimFirefox)return i("Firefox shim is not included in this adapter release."),o;i("adapter.js shimming firefox."),o.browserShim=s_,zd(t,s),Qd(t),LZ(t,s),uh(t,s),WZ(t),EZ(t),GZ(t),VZ(t),PZ(t),NZ(t),kZ(t),xZ(t),MZ(t),Ud(t),hh(t),Ad(t,s),Dd(t);break;case"safari":if(!o_||!e.shimSafari)return i("Safari shim is not included in this adapter release."),o;i("adapter.js shimming safari."),o.browserShim=o_,zd(t,s),Qd(t),OZ(t),UZ(t),YZ(t),wZ(t),KZ(t),JZ(t),HZ(t),AZ(t),Ud(t),mh(t),Ad(t,s),Dd(t),ph(t,s);break;default:i("Unsupported browser!")}return o}if(RY({window:typeof window>"u"?void 0:window}),typeof MediaStreamTrack<"u"){const t=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){const e=t.call(this);return e.width&&(e.width=Math.floor(e.width)),e.height&&(e.height=Math.floor(e.height)),e.frameRate&&(e.frameRate=Math.floor(e.frameRate)),e}}var r_=pn,XY=TypeError,CY=function(t,e){if(!delete t[e])throw new XY("Cannot delete property "+r_(e)+" of "+r_(t))},n_=Sn,LY=Math.floor,bh=function(t,e){var i=t.length;if(i<8)for(var s,o,r=1;r<i;){for(o=r,s=t[r];o&&e(t[o-1],s)>0;)t[o]=t[--o];o!==r++&&(t[o]=s)}else for(var n=LY(i/2),a=bh(n_(t,0,n),e),c=bh(n_(t,n),e),d=a.length,l=c.length,u=0,p=0;u<d||p<l;)t[u+p]=u<d&&p<l?e(a[u],c[p])<=0?a[u++]:c[p++]:u<d?a[u++]:c[p++];return t},QZ=bh,WY=ho,a_=WY.match(/firefox\/(\d+)/i),GY=!!a_&&+a_[1],VY=ho,EY=/MSIE|Trident/.test(VY),PY=ho,d_=PY.match(/AppleWebKit\/(\d+)\./),NY=!!d_&&+d_[1],kY=he,jZ=Re,xY=Xi,MY=Ci,c_=Xs,wY=CY,l_=Qt,Tp=Ge,KY=QZ,YY=Ag,u_=GY,HY=EY,m_=Ea,h_=NY,qs=[],p_=jZ(qs.sort),FY=jZ(qs.push),OY=Tp((function(){qs.sort(void 0)})),JY=Tp((function(){qs.sort(null)})),UY=YY("sort"),BZ=!Tp((function(){if(m_)return m_<70;if(!(u_&&u_>3)){if(HY)return!0;if(h_)return h_<603;var t,e,i,s,o="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)qs.push({k:e+s,v:i})}for(qs.sort((function(r,n){return n.v-r.v})),s=0;s<qs.length;s++)e=qs[s].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return o!=="DGBEFHACIJK"}})),AY=OY||!JY||!UY||!BZ,DY=function(t){return function(e,i){return i===void 0?-1:e===void 0?1:t!==void 0?+t(e,i)||0:l_(e)>l_(i)?1:-1}};kY({target:"Array",proto:!0,forced:AY},{sort:function(t){t!==void 0&&xY(t);var e=MY(this);if(BZ)return t===void 0?p_(e):p_(e,t);var i,s,o=[],r=c_(e);for(s=0;s<r;s++)s in e&&FY(o,e[s]);for(KY(o,DY(t)),i=c_(o),s=0;s<i;)e[s]=o[s++];for(;s<r;)wY(e,s++);return e}});var zY=ls,QY=zY("Array","sort"),jY=St,BY=QY,Ku=Array.prototype,$Y=function(t){var e=t.sort;return t===Ku||jY(Ku,t)&&e===Ku.sort?BY:e},qY=$Y,e5=qY,t5=e5,i5=t5,s5=i5,o5=s5,r5=o5,n5=r5,en=Ie(n5),$Z={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function s(){}function o(c,d,l){this.fn=c,this.context=d,this.once=l||!1}function r(c,d,l,u,p){if(typeof l!="function")throw new TypeError("The listener must be a function");var h=new o(l,u||c,p),_=i?i+d:d;return c._events[_]?c._events[_].fn?c._events[_]=[c._events[_],h]:c._events[_].push(h):(c._events[_]=h,c._eventsCount++),c}function n(c,d){--c._eventsCount==0?c._events=new s:delete c._events[d]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(i=!1)),a.prototype.eventNames=function(){var c,d,l=[];if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(c){var d=i?i+c:c,l=this._events[d];if(!l)return[];if(l.fn)return[l.fn];for(var u=0,p=l.length,h=new Array(p);u<p;u++)h[u]=l[u].fn;return h},a.prototype.listenerCount=function(c){var d=i?i+c:c,l=this._events[d];return l?l.fn?1:l.length:0},a.prototype.emit=function(c,d,l,u,p,h){var _=i?i+c:c;if(!this._events[_])return!1;var y,b,S=this._events[_],v=arguments.length;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),v){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,l),!0;case 4:return S.fn.call(S.context,d,l,u),!0;case 5:return S.fn.call(S.context,d,l,u,p),!0;case 6:return S.fn.call(S.context,d,l,u,p,h),!0}for(b=1,y=new Array(v-1);b<v;b++)y[b-1]=arguments[b];S.fn.apply(S.context,y)}else{var f,g=S.length;for(b=0;b<g;b++)switch(S[b].once&&this.removeListener(c,S[b].fn,void 0,!0),v){case 1:S[b].fn.call(S[b].context);break;case 2:S[b].fn.call(S[b].context,d);break;case 3:S[b].fn.call(S[b].context,d,l);break;case 4:S[b].fn.call(S[b].context,d,l,u);break;default:if(!y)for(f=1,y=new Array(v-1);f<v;f++)y[f-1]=arguments[f];S[b].fn.apply(S[b].context,y)}}return!0},a.prototype.on=function(c,d,l){return r(this,c,d,l,!1)},a.prototype.once=function(c,d,l){return r(this,c,d,l,!0)},a.prototype.removeListener=function(c,d,l,u){var p=i?i+c:c;if(!this._events[p])return this;if(!d)return n(this,p),this;var h=this._events[p];if(h.fn)h.fn!==d||u&&!h.once||l&&h.context!==l||n(this,p);else{for(var _=0,y=[],b=h.length;_<b;_++)(h[_].fn!==d||u&&!h[_].once||l&&h[_].context!==l)&&y.push(h[_]);y.length?this._events[p]=y.length===1?y[0]:y:n(this,p)}return this},a.prototype.removeAllListeners=function(c){var d;return c?(d=i?i+c:c,this._events[d]&&n(this,d)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a})($Z);var Ai=$Z.exports,a5=Ie(Ai);const b_=new ue("VERTC",0);class Vt extends Ai.EventEmitter{safeEmit(e){const i=this.listenerCount(e);try{for(var s=arguments.length,o=new Array(s>1?s-1:0),r=1;r<s;r++)o[r-1]=arguments[r];return super.emit(e,...o)}catch(n){return b_.error("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,n),console.error(n),!!i}}async asyncEmit(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];await Promise.resolve().then((()=>{try{super.emit(e,...s)}catch(r){b_.error("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,r),console.error(r)}}))}}var yh=(t=>(t[t.BLACK=0]="BLACK",t[t.NORMAL=1]="NORMAL",t))(yh||{});const y_={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,FRAMERATE_INPUT_TOO_LOW_RECOVER:3001,FRAMERATE_SENT_TOO_LOW_RECOVER:3002,SEND_VIDEO_BITRATE_TOO_LOW_RECOVER:3003,RECV_VIDEO_DECODE_FAILED_RECOVER:3005,AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER:4001,AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER:4002,SEND_AUDIO_BITRATE_TOO_LOW_RECOVER:4003};var _h=(t=>(t.streamRemovedBySchedule308="stream removed",t.clientRePublish="client republish",t.publishStreamFaied="publish failed",t.clientUnPublish="client unpublished",t.clientDisconnected="client disconnected",t.videoMuted="video muted",t))(_h||{}),qZ=(t=>(t.PushLimitWarn="PushLimitWarn",t.OTHER="OTHER",t))(qZ||{}),eT=(t=>(t.CHANGE_CODEC="changeCodec",t))(eT||{}),O=(t=>(t.ON_ADD_STREAM="onAddStream",t.ON_ADD_STREAM_LIST="onAddStreamList",t.ON_REMOVE_STREAM="onRemoveStream",t.ON_REMOVE_STREAM_LIST="onRemoveStreamList",t.USER_DISCONNECTION="userDisconnection",t.USER_DISCONNECTION_LIST="userDisconnectionList",t.USER_CONNECTION="userConnection",t.USER_CONNECTION_LIST="userConnectionList",t.ON_UPDATE_STREAM_ATTRIBUTES="onUpdateStreamAttributes",t.ON_UPDATE_ROOM_ATTRIBUTES="onUpdateRoomAttributes",t.ON_UPDATE_USER_ATTRIBUTES="onUpdateUserAttributes",t.ON_PUSH_TRACK="onPushTrack",t.ON_REMOVE_TRACK="onRemoveTrack",t.ON_CUSTOM_MESSAGE="onCustomMessage",t.NODE_CHANGE="nodeChange",t.USER_MESSAGE_RECEIVED="userMessageReceived",t.USER_BINARY_MESSAGE_RECEIVED="userBinaryMessageReceived",t.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM="userMessageReceivedOutsideRoom",t.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM="userBinaryMessageReceivedOutsideRoom",t.POST_PROCESSING_MESSAGE="postProcessingMessage",t.ON_USER_TOKEN_WILL_EXPIRE="onUserTokenWillExpire",t.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE="onTokenPublishPrivilegeWillExpire",t.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED="onTokenPublishPrivilegeDidExpired",t.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE="onTokenSubscribePrivilegeWillExpire",t.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED="onTokenSubscribePrivilegeDidExpired",t.STREAM_CONTROL_MESSAGE="streamControlMessage",t.ON_SPEAKER_CHANGE="onSpeakerChange",t.ON_STREAM_FAILED="streamFailed",t.ON_NOTIFY_RECONNECT="notifyReconnect",t.ON_FORWARD_DST_ROOM_USER_KICK="onForwardDstRoomUserKick",t.ENGINE_CONTROL_MESSAGE="engineControlMessage",t.ON_STREAM_PUSHED_BY_OTHER="onStreamPushedByOther",t.ON_STREAM_PULL_STATE_CHANGED="onStreamPullStateChanged",t))(O||{}),ds=(t=>(t.RSCP="RSCP",t.RTT="RTT",t.SSC="SSC",t))(ds||{}),Fe=(t=>(t.ON_CONNECTION_STATE_CHANGE="onConnectionStateChange",t.ON_VENDOR_CONNECTION_STATE_CHANGE="onVendorConnectionStateChange",t.ABNORMAL_DISCONNECTION="normalConnection",t.ON_RECONNECT_FAILED="onReconnectFailed",t.CONNECT_WITH_TCP="onIceConnectWithTcp",t.JOIN_ROOM_FAILED_PRIVATE_CALLBACK="joinRoomFailurePrivateCallback",t))(Fe||{}),Ys=(t=>(t.userLeave="userLeave",t.connectionLost="connectionLost",t.userDuplicateLogin="userDuplicateLogin",t.kickedByAdmin="kickedByAdmin",t.roleChanged="roleChanged",t.onUserTokenDidExpire="onUserTokenDidExpire",t))(Ys||{}),tT=(t=>(t[t.roomDismissByAdmin=2]="roomDismissByAdmin",t))(tT||{}),wo=(t=>(t[t.LIMIT_MODE=1]="LIMIT_MODE",t[t.NORMAL_MODE=2]="NORMAL_MODE",t))(wo||{}),Lt=(t=>(t[t.NORMAL=0]="NORMAL",t[t.BLACK=1]="BLACK",t))(Lt||{}),Ne=(t=>(t[t.EXTERNAL=0]="EXTERNAL",t[t.INTERNAL=1]="INTERNAL",t))(Ne||{}),tn=(t=>(t.AUDIO="audio",t.VIDEO="video",t))(tn||{}),He=(t=>(t.MAIN="main",t.SCREEN="screen",t.PUBLIC="public",t.VIRTUAL="virtual",t))(He||{});class iT extends Vt{constructor(e,i,s){super(),m(this,"trackId",Ts()),m(this,"_logger",void 0),m(this,"trackInfo",void 0),m(this,"_originTrack",void 0),m(this,"_channelCount",void 0),this._ctx=e,this._logger=new ue("Track",4,e.id),this.trackInfo=s,this._originTrack=i,this._channelCount=i.getSettings().channelCount}get dummy(){return this.trackInfo.isDummy}get virtual(){return this.trackInfo.streamIndex==="virtual"}get isScreen(){return this.trackInfo.streamIndex==="screen"}get isPublic(){return this.trackInfo.streamIndex==="public"}get sourceType(){return this.trackInfo.sourceType}get mediaType(){return this.trackInfo.mediaType}get captureSessionId(){return this.trackInfo.captureSessionId}get streamIndex(){const{streamIndex:e}=this.trackInfo;return e==="main"?V.STREAM_INDEX_MAIN:e==="screen"?V.STREAM_INDEX_SCREEN:void 0}get channelCount(){var e;return(e=this._channelCount)!==null&&e!==void 0?e:0}get originTrack(){return this._originTrack}set originTrack(e){this._originTrack=e,this._channelCount=mediaTrack.getSettings().channelCount}get logger(){return this._logger.module=this.constructor.name,this._logger}destroy(){this._originTrack.stop()}}class sT extends iT{constructor(e,i,s){super(e,i,s),m(this,"_mediaTrack",void 0),m(this,"_preProcessingTrack",void 0),m(this,"isTrackReady",void 0),m(this,"handleTrackEnded",(()=>{this.emit("track-ended",this),this.destroy()})),m(this,"handleMute",(()=>{this.emit("track-mute",this)})),m(this,"handleUnmute",(()=>{this.emit("track-unmute",this)})),this._initListeners(),this.isTrackReady=this.generatePreProcessingTrack()}get mediaTrack(){var e;return(e=this._mediaTrack)!==null&&e!==void 0?e:this._originTrack}set mediaTrack(e){this.mediaTrack.id!==e.id&&(this._mediaTrack=e,this.isTrackReady=this.generatePreProcessingTrack())}get preprocessingTrack(){var e;return(e=this._preProcessingTrack)!==null&&e!==void 0?e:this.mediaTrack}async generatePreProcessingTrack(){var e;const i=(e=this._preProcessingTrack)===null||e===void 0?void 0:e.id;this._preProcessingTrack=void 0;try{const s=await this._ctx.extensionManager.getPreProcessingTrack(this);s instanceof MediaStreamTrack&&(this._preProcessingTrack=s,i!==this._preProcessingTrack.id&&setTimeout((()=>{this.emit("needReplaceTrack")})))}catch(s){console.error(s)}}destroy(){var e,i;this._originTrack.removeEventListener("ended",this.handleTrackEnded),this._originTrack.removeEventListener("mute",this.handleMute),this._originTrack.removeEventListener("unmute",this.handleUnmute),(e=this._preProcessingTrack)===null||e===void 0||e.stop(),(i=this._mediaTrack)===null||i===void 0||i.stop(),super.destroy()}_initListeners(){this._originTrack instanceof MediaStreamTrack&&(this._originTrack.addEventListener("ended",this.handleTrackEnded),this._originTrack.addEventListener("mute",this.handleMute),this._originTrack.addEventListener("unmute",this.handleUnmute))}}class oT extends iT{constructor(e,i,s){super(e,i,s),m(this,"_mediaTrack",void 0),this._originTrack=i}get mediaTrack(){var e;return(e=this._mediaTrack)!==null&&e!==void 0?e:this._originTrack}set mediaTrack(e){this.mediaTrack.id!==e.id&&(this._mediaTrack=e)}get preprocessingTrack(){return this.mediaTrack}}var rT=(t=>(t[t.internal=0]="internal",t[t.external=1]="external",t[t.bypass=2]="bypass",t))(rT||{});const hd=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,85]),Ns=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,84]),__=new Uint8Array([31,239,3,50,242,120,76,85,169,42,161,91,75,186,22]),d5=t=>{const e=[];let i=0;for(const s of t)i>=2&&s<=3&&(e.push(3),i=0),s===0?i++:i=0,e.push(s);return new Uint8Array(e)},c5=t=>{const e=[];for(let i=0;i<t.length;i++)t[i]<=3&&t[i-1]===0&&t[i-2]===0||e.push(t[i]);return new Uint8Array(e)};function Yu(t){const e=[];for(;t>=255;)t-=255,e.push(255);return e.push(t),new Uint8Array(e)}function Hu(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=0;for(;t[e]===255&&e<t.byteLength;)e++,i+=255;return e<t.byteLength&&(i+=t[e++]),[i,e]}const l5=new Uint8Array([80,1]);class Rn{static generateSEI(e,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const o=new Uint8Array([0,0,0,1]),r=i?l5:new Uint8Array([6]),n=new Uint8Array([5]),a=Rn.__uuid||(s?hd:Ns),c=Yu(e.byteLength+a.byteLength),d=d5(e);return new Uint8Array([...o,...r,...n,...c,...a,...d,128])}static decodeSEIBody(e,i){e=e.slice(0,e.length-1);const s=c5(e);if(s.byteLength<2)return;let o=0;const r=i?2:1;if(s[r]!==5&&s[r]!==100)return;o+=1+r;const[n,a]=Hu(s,o);o=a;let c=2;const d=o+n;return s.byteLength>=Ns.byteLength&&n>=Ns.byteLength&&(s.slice(o,o+Ns.byteLength).toString()===Ns.toString()||s.slice(o,o+__.byteLength).toString()===__.toString())?(o+=Ns.byteLength,c=1):s.byteLength>=Ns.byteLength&&n>=Ns.byteLength&&s.slice(o,o+hd.byteLength).toString()===hd.toString()&&(o+=hd.byteLength,c=0),{type:c,payload:s.slice(o,d)}}static parseInternalSEI(e){const i=new Map;let s=0;if(e.type===0){for(;e.payload.byteLength-s>=2;){const[o,r]=Hu(e.payload,s);s=r;const[n,a]=Hu(e.payload,s);if(s=a,i.get(o)||!(n<=e.payload.byteLength-s))break;i.set(o,e.payload.slice(s,s+n)),s+=n}return i}}static makeInternalSei(e){const i=[];for(const[r,n]of e){const a=Yu(r),c=Yu(n.byteLength);i.push(a,c,n)}const s=i.reduce(((r,n)=>r+n.byteLength),0),o=new Uint8Array(s);return i.reduce(((r,n)=>(o.set(n,r),r+n.byteLength)),0),o}}m(Rn,"__uuid",void 0);var u5=he,m5=Re,h5=xv,p5=RangeError,S_=String.fromCharCode,v_=String.fromCodePoint,b5=m5([].join),y5=!!v_&&v_.length!==1;u5({target:"String",stat:!0,forced:y5},{fromCodePoint:function(t){for(var e,i=[],s=arguments.length,o=0;s>o;){if(e=+arguments[o++],h5(e,1114111)!==e)throw new p5(e+" is not a valid code point");i[o]=e<65536?S_(e):S_(55296+((e-=65536)>>10),e%1024+56320)}return b5(i,"")}});var g_=Ee,_5=et,S5=Object.getOwnPropertyDescriptor,nT=function(t){if(!_5)return g_[t];var e=S5(g_,t);return e&&e.value},v5=Ge,g5=Me,f5=et,f_=Zv,Z5=g5("iterator"),Bc=!v5((function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),s="";return t.pathname="c%20d",e.forEach((function(o,r){e.delete("b"),s+=r+o})),i.delete("a",2),i.delete("b",void 0),f_&&(!t.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b"))||!e.size&&(f_||!f5)||!e.sort||t.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[Z5]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("https://a#Ð±").hash!=="#%D0%B1"||s!=="a1c3"||new URL("https://x",void 0).host!=="x"})),T5=po,I5=function(t,e,i){for(var s in e)i&&i.unsafe&&t[s]?t[s]=e[s]:T5(t,s,e[s],i);return t},R5=St,X5=TypeError,Ip=function(t,e){if(R5(e,t))return t;throw new X5("Incorrect invocation")},C5=_n,Z_=Pc,L5=Va,W5=fn,G5=Me,V5=G5("iterator"),$c=function(t){if(!L5(t))return Z_(t,V5)||Z_(t,"@@iterator")||W5[C5(t)]},E5=tt,P5=Xi,N5=ri,k5=pn,x5=$c,M5=TypeError,Rp=function(t,e){var i=arguments.length<2?x5(t):e;if(P5(i))return N5(E5(i,t));throw new M5(k5(t)+" is not iterable")},w5=TypeError,Oa=function(t,e){if(t<e)throw new w5("Not enough arguments");return t},Fu=he,aT=Ee,Xp=nT,K5=pt,pd=tt,Ji=Re,sa=et,T_=Bc,I_=po,Y5=Hc,H5=I5,F5=Cs,O5=Sg,Cp=gn,dT=Ip,Ou=ze,J5=nt,U5=Rs,A5=_n,D5=ri,cT=Gt,Tt=Qt,z5=ka,R_=mo,X_=Rp,Q5=$c,bd=op,mr=Oa,j5=Me,B5=QZ,$5=j5("iterator"),sn="URLSearchParams",lT=sn+"Iterator",uT=Cp.set,li=Cp.getterFor(sn),q5=Cp.getterFor(lT),C_=Xp("fetch"),bc=Xp("Request"),ya=Xp("Headers"),Ju=bc&&bc.prototype,L_=ya&&ya.prototype,eH=aT.TypeError,tH=aT.encodeURIComponent,iH=String.fromCharCode,sH=K5("String","fromCodePoint"),oH=parseInt,jd=Ji("".charAt),W_=Ji([].join),eo=Ji([].push),mT=Ji("".replace),rH=Ji([].shift),G_=Ji([].splice),V_=Ji("".split),hT=Ji("".slice),nH=Ji(/./.exec),aH=/\+/g,Uu="ï¿½",dH=/^[0-9a-f]+$/i,E_=function(t,e){var i=hT(t,e,e+2);return nH(dH,i)?oH(i,16):NaN},cH=function(t){for(var e=0,i=128;i>0&&t&i;i>>=1)e++;return e},lH=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},P_=function(t){for(var e=(t=mT(t,aH," ")).length,i="",s=0;s<e;){var o=jd(t,s);if(o==="%"){if(jd(t,s+1)==="%"||s+3>e){i+="%",s++;continue}var r=E_(t,s+1);if(r!=r){i+=o,s++;continue}s+=2;var n=cH(r);if(n===0)o=iH(r);else{if(n===1||n>4){i+=Uu,s++;continue}for(var a=[r],c=1;c<n&&!(++s+3>e||jd(t,s)!=="%");){var d=E_(t,s+1);if(d!=d){s+=3;break}if(d>191||d<128)break;eo(a,d),s+=2,c++}if(a.length!==n){i+=Uu;continue}var l=lH(a);l===null?i+=Uu:o=sH(l)}}i+=o,s++}return i},uH=/[!'()~]|%20/g,mH={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},hH=function(t){return mH[t]},N_=function(t){return mT(tH(t),uH,hH)},Au=O5((function(t,e){uT(this,{type:lT,target:li(t).entries,index:0,kind:e})}),sn,(function(){var t=q5(this),e=t.target,i=t.index++;if(!e||i>=e.length)return t.target=null,bd(void 0,!0);var s=e[i];switch(t.kind){case"keys":return bd(s.key,!1);case"values":return bd(s.value,!1)}return bd([s.key,s.value],!1)}),!0),pT=function(t){this.entries=[],this.url=null,t!==void 0&&(cT(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?jd(t,0)==="?"?hT(t,1):t:Tt(t)))};pT.prototype={type:sn,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,i,s,o,r,n,a,c=this.entries,d=Q5(t);if(d)for(i=(e=X_(t,d)).next;!(s=pd(i,e)).done;){if(r=(o=X_(D5(s.value))).next,(n=pd(r,o)).done||(a=pd(r,o)).done||!pd(r,o).done)throw new eH("Expected sequence with length 2");eo(c,{key:Tt(n.value),value:Tt(a.value)})}else for(var l in t)J5(t,l)&&eo(c,{key:l,value:Tt(t[l])})},parseQuery:function(t){if(t)for(var e,i,s=this.entries,o=V_(t,"&"),r=0;r<o.length;)(e=o[r++]).length&&(i=V_(e,"="),eo(s,{key:P_(rH(i)),value:P_(W_(i,"="))}))},serialize:function(){for(var t,e=this.entries,i=[],s=0;s<e.length;)t=e[s++],eo(i,N_(t.key)+"="+N_(t.value));return W_(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var yc=function(){dT(this,Lr);var t=uT(this,new pT(arguments.length>0?arguments[0]:void 0));sa||(this.size=t.entries.length)},Lr=yc.prototype;if(H5(Lr,{append:function(t,e){var i=li(this);mr(arguments.length,2),eo(i.entries,{key:Tt(t),value:Tt(e)}),sa||this.length++,i.updateURL()},delete:function(t){for(var e=li(this),i=mr(arguments.length,1),s=e.entries,o=Tt(t),r=i<2?void 0:arguments[1],n=r===void 0?r:Tt(r),a=0;a<s.length;){var c=s[a];if(c.key!==o||n!==void 0&&c.value!==n)a++;else if(G_(s,a,1),n!==void 0)break}sa||(this.size=s.length),e.updateURL()},get:function(t){var e=li(this).entries;mr(arguments.length,1);for(var i=Tt(t),s=0;s<e.length;s++)if(e[s].key===i)return e[s].value;return null},getAll:function(t){var e=li(this).entries;mr(arguments.length,1);for(var i=Tt(t),s=[],o=0;o<e.length;o++)e[o].key===i&&eo(s,e[o].value);return s},has:function(t){for(var e=li(this).entries,i=mr(arguments.length,1),s=Tt(t),o=i<2?void 0:arguments[1],r=o===void 0?o:Tt(o),n=0;n<e.length;){var a=e[n++];if(a.key===s&&(r===void 0||a.value===r))return!0}return!1},set:function(t,e){var i=li(this);mr(arguments.length,1);for(var s,o=i.entries,r=!1,n=Tt(t),a=Tt(e),c=0;c<o.length;c++)(s=o[c]).key===n&&(r?G_(o,c--,1):(r=!0,s.value=a));r||eo(o,{key:n,value:a}),sa||(this.size=o.length),i.updateURL()},sort:function(){var t=li(this);B5(t.entries,(function(e,i){return e.key>i.key?1:-1})),t.updateURL()},forEach:function(t){for(var e,i=li(this).entries,s=U5(t,arguments.length>1?arguments[1]:void 0),o=0;o<i.length;)s((e=i[o++]).value,e.key,this)},keys:function(){return new Au(this,"keys")},values:function(){return new Au(this,"values")},entries:function(){return new Au(this,"entries")}},{enumerable:!0}),I_(Lr,$5,Lr.entries,{}),I_(Lr,"toString",(function(){return li(this).serialize()}),{enumerable:!0}),sa&&Y5(Lr,"size",{get:function(){return li(this).entries.length},configurable:!0,enumerable:!0}),F5(yc,sn),Fu({global:!0,forced:!T_},{URLSearchParams:yc}),!T_&&Ou(ya)){var pH=Ji(L_.has),bH=Ji(L_.set),k_=function(t){if(cT(t)){var e,i=t.body;if(A5(i)===sn)return e=t.headers?new ya(t.headers):new ya,pH(e,"content-type")||bH(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),z5(t,{body:R_(0,Tt(i)),headers:R_(0,e)})}return t};if(Ou(C_)&&Fu({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return C_(t,arguments.length>1?k_(arguments[1]):{})}}),Ou(bc)){var Du=function(t){return dT(this,Ju),new bc(t,arguments.length>1?k_(arguments[1]):{})};Ju.constructor=Du,Du.prototype=Ju,Fu({global:!0,dontCallGetSet:!0,forced:!0},{Request:Du})}}var ai,yH={URLSearchParams:yc,getState:li},x_=et,_H=Re,SH=tt,vH=Ge,zu=wc,gH=xa,fH=Ec,ZH=Ci,TH=Fh,hr=Object.assign,M_=Object.defineProperty,IH=_H([].concat),RH=!hr||vH((function(){if(x_&&hr({b:1},hr(M_({},"a",{enumerable:!0,get:function(){M_(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},i=Symbol("assign detection"),s="abcdefghijklmnopqrst";return t[i]=7,s.split("").forEach((function(o){e[o]=o})),hr({},t)[i]!==7||zu(hr({},e)).join("")!==s}))?function(t,e){for(var i=ZH(t),s=arguments.length,o=1,r=gH.f,n=fH.f;s>o;)for(var a,c=TH(arguments[o++]),d=r?IH(zu(c),r(c)):zu(c),l=d.length,u=0;l>u;)a=d[u++],x_&&!SH(n,c,a)||(i[a]=c[a]);return i}:hr,XH=tt,w_=ri,CH=Pc,bT=function(t,e,i){var s,o;w_(t);try{if(!(s=CH(t,"return"))){if(e==="throw")throw i;return i}s=XH(s,t)}catch(r){o=!0,s=r}if(e==="throw")throw i;if(o)throw s;return w_(s),i},LH=ri,WH=bT,GH=function(t,e,i,s){try{return s?e(LH(i)[0],i[1]):e(i)}catch(o){WH(t,"throw",o)}},VH=Me,EH=fn,PH=VH("iterator"),NH=Array.prototype,yT=function(t){return t!==void 0&&(EH.Array===t||NH[PH]===t)},kH=Rs,xH=tt,MH=Ci,wH=GH,KH=yT,YH=jh,HH=Xs,K_=kc,FH=Rp,OH=$c,Y_=Array,JH=function(t){var e=MH(t),i=YH(this),s=arguments.length,o=s>1?arguments[1]:void 0,r=o!==void 0;r&&(o=kH(o,s>2?arguments[2]:void 0));var n,a,c,d,l,u,p=OH(e),h=0;if(!p||this===Y_&&KH(p))for(n=HH(e),a=i?new this(n):Y_(n);n>h;h++)u=r?o(e[h],h):e[h],K_(a,h,u);else for(a=i?new this:[],l=(d=FH(e,p)).next;!(c=xH(l,d)).done;h++)u=r?wH(d,o,[c.value,h],!0):c.value,K_(a,h,u);return a.length=h,a},Bo=Re,Qu=2147483647,_a=36,_T=1,Sh=26,UH=38,AH=700,DH=72,zH=128,QH="-",jH=/[^\0-\u007E]/,ST=/[.\u3002\uFF0E\uFF61]/g,H_="Overflow: input needs wider integers to process",ju=_a-_T,F_=RangeError,BH=Bo(ST.exec),Kr=Math.floor,Bu=String.fromCharCode,O_=Bo("".charCodeAt),vT=Bo([].join),to=Bo([].push),$H=Bo("".replace),qH=Bo("".split),eF=Bo("".toLowerCase),tF=function(t){for(var e=[],i=0,s=t.length;i<s;){var o=O_(t,i++);if(o>=55296&&o<=56319&&i<s){var r=O_(t,i++);(64512&r)==56320?to(e,((1023&o)<<10)+(1023&r)+65536):(to(e,o),i--)}else to(e,o)}return e},J_=function(t){return t+22+75*(t<26)},iF=function(t,e,i){var s=0;for(t=i?Kr(t/AH):t>>1,t+=Kr(t/e);t>ju*Sh>>1;)t=Kr(t/ju),s+=_a;return Kr(s+(ju+1)*t/(t+UH))},sF=function(t){var e,i,s=[],o=(t=tF(t)).length,r=zH,n=0,a=DH;for(e=0;e<t.length;e++)(i=t[e])<128&&to(s,Bu(i));var c=s.length,d=c;for(c&&to(s,QH);d<o;){var l=Qu;for(e=0;e<t.length;e++)(i=t[e])>=r&&i<l&&(l=i);var u=d+1;if(l-r>Kr((Qu-n)/u))throw new F_(H_);for(n+=(l-r)*u,r=l,e=0;e<t.length;e++){if((i=t[e])<r&&++n>Qu)throw new F_(H_);if(i===r){for(var p=n,h=_a;;){var _=h<=a?_T:h>=a+Sh?Sh:h-a;if(p<_)break;var y=p-_,b=_a-_;to(s,Bu(J_(_+y%b))),p=Kr(y/b),h+=_a}to(s,Bu(J_(p))),a=iF(n,u,d===c),n=0,d++}}n++,r++}return vT(s,"")},oF=function(t){var e,i,s=[],o=qH($H(eF(t),ST,"."),".");for(e=0;e<o.length;e++)i=o[e],to(s,BH(jH,i)?"xn--"+sF(i):i);return vT(s,".")},rF=he,Lp=et,nF=Bc,Wp=Ee,U_=Rs,Wi=Re,yd=po,di=Hc,aF=Ip,vh=nt,Gp=RH,pr=JH,Vi=Sn,dF=Rg.codeAt,cF=oF,ys=Qt,lF=Cs,uF=Oa,gT=yH,fT=gn,mF=fT.set,_c=fT.getterFor("URL"),hF=gT.URLSearchParams,pF=gT.getState,wn=Wp.URL,gh=Wp.TypeError,Sc=Wp.parseInt,bF=Math.floor,A_=Math.pow,vi=Wi("".charAt),xi=Wi(/./.exec),oa=Wi([].join),yF=Wi(1 .toString),_F=Wi([].pop),Wr=Wi([].push),$u=Wi("".replace),SF=Wi([].shift),vF=Wi("".split),Sa=Wi("".slice),vc=Wi("".toLowerCase),gF=Wi([].unshift),fF="Invalid authority",qu="Invalid scheme",vo="Invalid host",D_="Invalid port",ZT=/[a-z]/i,ZF=/[\d+-.a-z]/i,fh=/\d/,TF=/^0x/i,IF=/^[0-7]+$/,RF=/^\d+$/,TT=/^[\da-f]+$/i,XF=/[\0\t\n\r #%/:<>?@[\\\]^|]/,CF=/[\0\t\n\r #/:<>?@[\\\]^|]/,LF=/^[\u0000-\u0020]+/,WF=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,GF=/[\t\n\r]/g,VF=function(t){var e,i,s,o,r,n,a,c=vF(t,".");if(c.length&&c[c.length-1]===""&&c.length--,(e=c.length)>4)return t;for(i=[],s=0;s<e;s++){if((o=c[s])==="")return t;if(r=10,o.length>1&&vi(o,0)==="0"&&(r=xi(TF,o)?16:8,o=Sa(o,r===8?1:2)),o==="")n=0;else{if(!xi(r===10?RF:r===8?IF:TT,o))return t;n=Sc(o,r)}Wr(i,n)}for(s=0;s<e;s++)if(n=i[s],s===e-1){if(n>=A_(256,5-e))return null}else if(n>255)return null;for(a=_F(i),s=0;s<i.length;s++)a+=i[s]*A_(256,3-s);return a},EF=function(t){var e,i,s,o,r,n,a,c=[0,0,0,0,0,0,0,0],d=0,l=null,u=0,p=function(){return vi(t,u)};if(p()===":"){if(vi(t,1)!==":")return;u+=2,l=++d}for(;p();){if(d===8)return;if(p()!==":"){for(e=i=0;i<4&&xi(TT,p());)e=16*e+Sc(p(),16),u++,i++;if(p()==="."){if(i===0||(u-=i,d>6))return;for(s=0;p();){if(o=null,s>0){if(!(p()==="."&&s<4))return;u++}if(!xi(fh,p()))return;for(;xi(fh,p());){if(r=Sc(p(),10),o===null)o=r;else{if(o===0)return;o=10*o+r}if(o>255)return;u++}c[d]=256*c[d]+o,++s!==2&&s!==4||d++}if(s!==4)return;break}if(p()===":"){if(u++,!p())return}else if(p())return;c[d++]=e}else{if(l!==null)return;u++,l=++d}}if(l!==null)for(n=d-l,d=7;d!==0&&n>0;)a=c[d],c[d--]=c[l+n-1],c[l+--n]=a;else if(d!==8)return;return c},PF=function(t){for(var e=null,i=1,s=null,o=0,r=0;r<8;r++)t[r]!==0?(o>i&&(e=s,i=o),s=null,o=0):(s===null&&(s=r),++o);return o>i?s:e},Kn=function(t){var e,i,s,o;if(typeof t=="number"){for(e=[],i=0;i<4;i++)gF(e,t%256),t=bF(t/256);return oa(e,".")}if(typeof t=="object"){for(e="",s=PF(t),i=0;i<8;i++)o&&t[i]===0||(o&&(o=!1),s===i?(e+=i?":":"::",o=!0):(e+=yF(t[i],16),i<7&&(e+=":")));return"["+e+"]"}return t},Bd={},IT=Gp({},Bd,{" ":1,'"':1,"<":1,">":1,"`":1}),RT=Gp({},IT,{"#":1,"?":1,"{":1,"}":1}),em=Gp({},RT,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ks=function(t,e){var i=dF(t,0);return i>32&&i<127&&!vh(e,t)?t:encodeURIComponent(t)},_d={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ra=function(t,e){var i;return t.length===2&&xi(ZT,vi(t,0))&&((i=vi(t,1))===":"||!e&&i==="|")},z_=function(t){var e;return t.length>1&&ra(Sa(t,0,2))&&(t.length===2||(e=vi(t,2))==="/"||e==="\\"||e==="?"||e==="#")},NF=function(t){return t==="."||vc(t)==="%2e"},kF=function(t){return(t=vc(t))===".."||t==="%2e."||t===".%2e"||t==="%2e%2e"},tm={},Q_={},im={},j_={},B_={},sm={},$_={},q_={},Sd={},vd={},om={},rm={},nm={},am={},eS={},dm={},br={},Bi={},tS={},go={},bs={},Vp=function(t,e,i){var s,o,r,n=ys(t);if(e){if(o=this.parse(n))throw new gh(o);this.searchParams=null}else{if(i!==void 0&&(s=new Vp(i,!0)),o=this.parse(n,null,s))throw new gh(o);(r=pF(new hF)).bindURL(this),this.searchParams=r}};Vp.prototype={type:"URL",parse:function(t,e,i){var s,o,r,n,a=this,c=e||tm,d=0,l="",u=!1,p=!1,h=!1;for(t=ys(t),e||(a.scheme="",a.username="",a.password="",a.host=null,a.port=null,a.path=[],a.query=null,a.fragment=null,a.cannotBeABaseURL=!1,t=$u(t,LF,""),t=$u(t,WF,"$1")),t=$u(t,GF,""),s=pr(t);d<=s.length;){switch(o=s[d],c){case tm:if(!o||!xi(ZT,o)){if(e)return qu;c=im;continue}l+=vc(o),c=Q_;break;case Q_:if(o&&(xi(ZF,o)||o==="+"||o==="-"||o==="."))l+=vc(o);else{if(o!==":"){if(e)return qu;l="",c=im,d=0;continue}if(e&&(a.isSpecial()!==vh(_d,l)||l==="file"&&(a.includesCredentials()||a.port!==null)||a.scheme==="file"&&!a.host))return;if(a.scheme=l,e)return void(a.isSpecial()&&_d[a.scheme]===a.port&&(a.port=null));l="",a.scheme==="file"?c=am:a.isSpecial()&&i&&i.scheme===a.scheme?c=j_:a.isSpecial()?c=q_:s[d+1]==="/"?(c=B_,d++):(a.cannotBeABaseURL=!0,Wr(a.path,""),c=tS)}break;case im:if(!i||i.cannotBeABaseURL&&o!=="#")return qu;if(i.cannotBeABaseURL&&o==="#"){a.scheme=i.scheme,a.path=Vi(i.path),a.query=i.query,a.fragment="",a.cannotBeABaseURL=!0,c=bs;break}c=i.scheme==="file"?am:sm;continue;case j_:if(o!=="/"||s[d+1]!=="/"){c=sm;continue}c=Sd,d++;break;case B_:if(o==="/"){c=vd;break}c=Bi;continue;case sm:if(a.scheme=i.scheme,o===ai)a.username=i.username,a.password=i.password,a.host=i.host,a.port=i.port,a.path=Vi(i.path),a.query=i.query;else if(o==="/"||o==="\\"&&a.isSpecial())c=$_;else if(o==="?")a.username=i.username,a.password=i.password,a.host=i.host,a.port=i.port,a.path=Vi(i.path),a.query="",c=go;else{if(o!=="#"){a.username=i.username,a.password=i.password,a.host=i.host,a.port=i.port,a.path=Vi(i.path),a.path.length--,c=Bi;continue}a.username=i.username,a.password=i.password,a.host=i.host,a.port=i.port,a.path=Vi(i.path),a.query=i.query,a.fragment="",c=bs}break;case $_:if(!a.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){a.username=i.username,a.password=i.password,a.host=i.host,a.port=i.port,c=Bi;continue}c=vd}else c=Sd;break;case q_:if(c=Sd,o!=="/"||vi(l,d+1)!=="/")continue;d++;break;case Sd:if(o!=="/"&&o!=="\\"){c=vd;continue}break;case vd:if(o==="@"){u&&(l="%40"+l),u=!0,r=pr(l);for(var _=0;_<r.length;_++){var y=r[_];if(y!==":"||h){var b=ks(y,em);h?a.password+=b:a.username+=b}else h=!0}l=""}else if(o===ai||o==="/"||o==="?"||o==="#"||o==="\\"&&a.isSpecial()){if(u&&l==="")return fF;d-=pr(l).length+1,l="",c=om}else l+=o;break;case om:case rm:if(e&&a.scheme==="file"){c=dm;continue}if(o!==":"||p){if(o===ai||o==="/"||o==="?"||o==="#"||o==="\\"&&a.isSpecial()){if(a.isSpecial()&&l==="")return vo;if(e&&l===""&&(a.includesCredentials()||a.port!==null))return;if(n=a.parseHost(l))return n;if(l="",c=br,e)return;continue}o==="["?p=!0:o==="]"&&(p=!1),l+=o}else{if(l==="")return vo;if(n=a.parseHost(l))return n;if(l="",c=nm,e===rm)return}break;case nm:if(!xi(fh,o)){if(o===ai||o==="/"||o==="?"||o==="#"||o==="\\"&&a.isSpecial()||e){if(l!==""){var S=Sc(l,10);if(S>65535)return D_;a.port=a.isSpecial()&&S===_d[a.scheme]?null:S,l=""}if(e)return;c=br;continue}return D_}l+=o;break;case am:if(a.scheme="file",o==="/"||o==="\\")c=eS;else{if(!i||i.scheme!=="file"){c=Bi;continue}switch(o){case ai:a.host=i.host,a.path=Vi(i.path),a.query=i.query;break;case"?":a.host=i.host,a.path=Vi(i.path),a.query="",c=go;break;case"#":a.host=i.host,a.path=Vi(i.path),a.query=i.query,a.fragment="",c=bs;break;default:z_(oa(Vi(s,d),""))||(a.host=i.host,a.path=Vi(i.path),a.shortenPath()),c=Bi;continue}}break;case eS:if(o==="/"||o==="\\"){c=dm;break}i&&i.scheme==="file"&&!z_(oa(Vi(s,d),""))&&(ra(i.path[0],!0)?Wr(a.path,i.path[0]):a.host=i.host),c=Bi;continue;case dm:if(o===ai||o==="/"||o==="\\"||o==="?"||o==="#"){if(!e&&ra(l))c=Bi;else if(l===""){if(a.host="",e)return;c=br}else{if(n=a.parseHost(l))return n;if(a.host==="localhost"&&(a.host=""),e)return;l="",c=br}continue}l+=o;break;case br:if(a.isSpecial()){if(c=Bi,o!=="/"&&o!=="\\")continue}else if(e||o!=="?")if(e||o!=="#"){if(o!==ai&&(c=Bi,o!=="/"))continue}else a.fragment="",c=bs;else a.query="",c=go;break;case Bi:if(o===ai||o==="/"||o==="\\"&&a.isSpecial()||!e&&(o==="?"||o==="#")){if(kF(l)?(a.shortenPath(),o==="/"||o==="\\"&&a.isSpecial()||Wr(a.path,"")):NF(l)?o==="/"||o==="\\"&&a.isSpecial()||Wr(a.path,""):(a.scheme==="file"&&!a.path.length&&ra(l)&&(a.host&&(a.host=""),l=vi(l,0)+":"),Wr(a.path,l)),l="",a.scheme==="file"&&(o===ai||o==="?"||o==="#"))for(;a.path.length>1&&a.path[0]==="";)SF(a.path);o==="?"?(a.query="",c=go):o==="#"&&(a.fragment="",c=bs)}else l+=ks(o,RT);break;case tS:o==="?"?(a.query="",c=go):o==="#"?(a.fragment="",c=bs):o!==ai&&(a.path[0]+=ks(o,Bd));break;case go:e||o!=="#"?o!==ai&&(o==="'"&&a.isSpecial()?a.query+="%27":a.query+=o==="#"?"%23":ks(o,Bd)):(a.fragment="",c=bs);break;case bs:o!==ai&&(a.fragment+=ks(o,IT))}d++}},parseHost:function(t){var e,i,s;if(vi(t,0)==="["){if(vi(t,t.length-1)!=="]"||!(e=EF(Sa(t,1,-1))))return vo;this.host=e}else if(this.isSpecial()){if(t=cF(t),xi(XF,t)||(e=VF(t))===null)return vo;this.host=e}else{if(xi(CF,t))return vo;for(e="",i=pr(t),s=0;s<i.length;s++)e+=ks(i[s],Bd);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return vh(_d,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme==="file"&&e===1&&ra(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,i=t.username,s=t.password,o=t.host,r=t.port,n=t.path,a=t.query,c=t.fragment,d=e+":";return o!==null?(d+="//",t.includesCredentials()&&(d+=i+(s?":"+s:"")+"@"),d+=Kn(o),r!==null&&(d+=":"+r)):e==="file"&&(d+="//"),d+=t.cannotBeABaseURL?n[0]:n.length?"/"+oa(n,"/"):"",a!==null&&(d+="?"+a),c!==null&&(d+="#"+c),d},setHref:function(t){var e=this.parse(t);if(e)throw new gh(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t==="blob")try{return new on(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Kn(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(ys(t)+":",tm)},getUsername:function(){return this.username},setUsername:function(t){var e=pr(ys(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<e.length;i++)this.username+=ks(e[i],em)}},getPassword:function(){return this.password},setPassword:function(t){var e=pr(ys(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<e.length;i++)this.password+=ks(e[i],em)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?Kn(t):Kn(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,om)},getHostname:function(){var t=this.host;return t===null?"":Kn(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,rm)},getPort:function(){var t=this.port;return t===null?"":ys(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=ys(t))===""?this.port=null:this.parse(t,nm))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+oa(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,br))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=ys(t))===""?this.query=null:(vi(t,0)==="?"&&(t=Sa(t,1)),this.query="",this.parse(t,go)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=ys(t))!==""?(vi(t,0)==="#"&&(t=Sa(t,1)),this.fragment="",this.parse(t,bs)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var on=function(t){var e=aF(this,Zt),i=uF(arguments.length,1)>1?arguments[1]:void 0,s=mF(e,new Vp(t,!1,i));Lp||(e.href=s.serialize(),e.origin=s.getOrigin(),e.protocol=s.getProtocol(),e.username=s.getUsername(),e.password=s.getPassword(),e.host=s.getHost(),e.hostname=s.getHostname(),e.port=s.getPort(),e.pathname=s.getPathname(),e.search=s.getSearch(),e.searchParams=s.getSearchParams(),e.hash=s.getHash())},Zt=on.prototype,ci=function(t,e){return{get:function(){return _c(this)[t]()},set:e&&function(i){return _c(this)[e](i)},configurable:!0,enumerable:!0}};if(Lp&&(di(Zt,"href",ci("serialize","setHref")),di(Zt,"origin",ci("getOrigin")),di(Zt,"protocol",ci("getProtocol","setProtocol")),di(Zt,"username",ci("getUsername","setUsername")),di(Zt,"password",ci("getPassword","setPassword")),di(Zt,"host",ci("getHost","setHost")),di(Zt,"hostname",ci("getHostname","setHostname")),di(Zt,"port",ci("getPort","setPort")),di(Zt,"pathname",ci("getPathname","setPathname")),di(Zt,"search",ci("getSearch","setSearch")),di(Zt,"searchParams",ci("getSearchParams")),di(Zt,"hash",ci("getHash","setHash"))),yd(Zt,"toJSON",(function(){return _c(this).serialize()}),{enumerable:!0}),yd(Zt,"toString",(function(){return _c(this).serialize()}),{enumerable:!0}),wn){var iS=wn.createObjectURL,sS=wn.revokeObjectURL;iS&&yd(on,"createObjectURL",U_(iS,wn)),sS&&yd(on,"revokeObjectURL",U_(sS,wn))}lF(on,"URL"),rF({global:!0,forced:!nF,sham:!Lp},{URL:on});var xF=he,MF=pt,XT=Ge,wF=Oa,oS=Qt,KF=Bc,Ep=MF("URL"),YF=KF&&XT((function(){Ep.canParse()})),HF=XT((function(){return Ep.canParse.length!==1}));xF({target:"URL",stat:!0,forced:!YF||HF},{canParse:function(t){var e=wF(arguments.length,1),i=oS(t),s=e<2||arguments[1]===void 0?void 0:oS(arguments[1]);try{return!!new Ep(i,s)}catch{return!1}}});var FF=he,OF=pt,JF=Oa,rS=Qt,UF=Bc,AF=OF("URL");FF({target:"URL",stat:!0,forced:!UF},{parse:function(t){var e=JF(arguments.length,1),i=rS(t),s=e<2||arguments[1]===void 0?void 0:rS(arguments[1]);try{return new AF(i,s)}catch{return null}}});var DF=zt,zF=DF.URL,QF=zF,jF=QF,BF=jF,$F=BF,qF=$F,eO=qF,tO=eO,iO=tO,fi=Ie(iO);function nS(t){const e=PressureObserver.supportedSources;let i="thermal";i=e!=null&&e.includes("thermal")?"thermal":"cpu";const s=new PressureObserver((o=>{o.forEach((r=>{r.source===i&&t(r.state)}))}));return s.observe(i,{sampleInterval:2e3}),s}class sO{constructor(){m(this,"_state",void 0),m(this,"_handler",!1)}init(){if(bK&&!ae("DISABLE_COMPUTE_PRESSURE")&&{}.VITE_TEST!=="UT")try{if($f()){const e=new Blob(["(".concat(nS.toString(),")(self.postMessage)")],{type:"text/javascript"}),i=new Worker(fi.createObjectURL(e));i.onmessage=s=>{this._state=s.data},this._handler=i}else this._handler=nS((e=>{this._state=e}))}catch{}}get state(){return Qc&&!ro()&&(window.thermal_status=this._state),this._handler||this.init(),this._state}}var gc=new sO;const oO=["codec","inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","media-source","csrc","peer-connection","data-channel","stream","track","transceiver","sender","receiver","transport","sctp-transport","candidate-pair","local-candidate","remote-candidate","certificate","ice-server"],fc=new Map;let cm=!0;const rO=async t=>new Promise((e=>{const i={all:[],getTrackStats:()=>[]},s=ae("STATS_SCALLBACK_SUPPORT");if(cm&&gs&&window.InstallTrigger===void 0&&mK&&s)try{var o,r,n;(o=t.getStats((a=>{const c=[];a.result().forEach((d=>{if(oO.includes(d.type))return;const l={};d.names().forEach((function(u){l[u]=d.stat(u)})),c.push(I(I({},l),{},{id:d.id,type:d.type,timestamp:d.timestamp}))})),e({all:c,getTrackStats:d=>c.filter((l=>l.type!=="ssrc"||l.googTrackId===d))})})))===null||o===void 0||(r=o.then)===null||r===void 0||(r=r.call(o,(()=>{e(i)})))===null||r===void 0||(n=r.catch)===null||n===void 0||n.call(r,(()=>{cm=!1,e(i)}))}catch{cm=!1,e(i)}else e(i)})),nO=async t=>{var e;const i=await t.getStats(),s={all:[]},o=new Map;i.forEach((c=>{const d=o.get(c.type)||new Map;d.set(c.id,c),o.set(c.type,d),s.all.push(c)}));const r=(c,d)=>{c.forEach((l=>{var u,p,h,_;let y,b,{codecId:S,transportId:v,trackId:f,playoutId:g}=l;if((u=o.get("codec"))===null||u===void 0||u.forEach((L=>{L.id===S&&d.add(L)})),(p=o.get("transport"))===null||p===void 0||p.forEach((L=>{L.id===v&&(y=L,d.add(L))})),(h=o.get("track"))===null||h===void 0||h.forEach((L=>{L.id===f&&d.add(L)})),(_=o.get("media-playout"))===null||_===void 0||_.forEach((L=>{L.id===g&&d.add(L)})),y){var Z,R;const{localCertificateId:L,remoteCertificateId:W,selectedCandidatePairId:M}=y;(Z=o.get("certificate"))===null||Z===void 0||Z.forEach((k=>{(k.id===L||k.id===W)&&d.add(k)})),(R=o.get("candidate-pair"))===null||R===void 0||R.forEach((k=>{k.id===M&&(b=k,d.add(k))}))}if(b){var T,X;const{localCandidateId:L,remoteCandidateId:W}=b;(T=o.get("local-candidate"))===null||T===void 0||T.forEach((M=>{M.id===L&&d.add(M)})),(X=o.get("remote-candidate"))===null||X===void 0||X.forEach((M=>{M.id===W&&d.add(M)}))}}))};var n;if(o.get("media-source"))(n=o.get("media-source"))===null||n===void 0||n.forEach((c=>{var d;const l=new Set;l.add(c);const u=[];(d=o.get("outbound-rtp"))===null||d===void 0||d.forEach((p=>{var h;p.mediaSourceId===c.id&&(l.add(p),u.push(p),(h=o.get("remote-inbound-rtp"))===null||h===void 0||h.forEach((_=>{_.localId===p.id&&l.add(_)})))})),r(u,l),s[c.trackIdentifier]=Array.from(l)}));else if(o.get("track")){var a;(a=o.get("track"))===null||a===void 0||a.forEach((c=>{var d;const l=new Set;l.add(c);const u=[];(d=o.get("outbound-rtp"))===null||d===void 0||d.forEach((p=>{var h;p.trackId===c.id&&(l.add(p),u.push(p),(h=o.get("remote-inbound-rtp"))===null||h===void 0||h.forEach((_=>{_.localId===p.id&&l.add(_)})))})),r(u,l),s[c.trackIdentifier]=Array.from(l)}))}return(e=o.get("inbound-rtp"))===null||e===void 0||e.forEach((c=>{var d;const l=new Set;l.add(c),(d=o.get("remote-outbound-rtp"))===null||d===void 0||d.forEach((h=>{h.localId===c.id&&l.add(h)})),r([c],l);let{trackIdentifier:u}=c;var p;u||(p=o.get("track"))===null||p===void 0||p.forEach((h=>{h.id===c.trackId&&(u=h.trackIdentifier)})),s[u]=Array.from(l)})),s},aO=async(t,e,i,s)=>{const o=e?.id;if(!(t instanceof RTCPeerConnection))return[];if(Te||Dt){const c=[];try{(s?await s.getStats():await t.getStats(e)).forEach((d=>{c.push(d)}))}catch{}return c}let r=fc.get(t);(!r||Date.now()-r.timestamp>150)&&(r={timestamp:Date.now(),statsPromise:nO(t),extraStatsPromise:rO(t)},fc.set(t,r));const n=await r.statsPromise;let a=(o?n[o]:n.all)||[];if(!i){const c=await r.extraStatsPromise;a=a.concat((o?c.getTrackStats(o):c.all)||[])}return a},dO=t=>{fc.has(t)&&fc.delete(t)};class CT extends Vt{constructor(){super(...arguments),m(this,"resultStorage",new Map),m(this,"_continuousVideoEncodeFailure",0),m(this,"_remoteStreamDecodeStatus",new Map)}setLocalAudioStats(e){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",this.checkAudioInputLevel(e)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",this.checkSendAudioBitrate(e))}setLocalVideoStats(e,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",this.checkSendVideoBitrate(e)),this.record("FRAMERATE_SENT_TOO_LOW",this.checkFramerateSent(e)),this.record("FRAMERATE_INPUT_TOO_LOW",this.checkFramerateInput(e,i)),this.checkVideoEncodeFailure(e,i)}setRemoteAudioStats(e){this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",this.checkAudioOutputLevel(e))}setRemoteVideoStats(e,i){this.record("RECV_VIDEO_DECODE_FAILED",this.checkVideoDecode(e)),this.checkVideoDecodeFailure(e,i)}destroy(){this._continuousVideoEncodeFailure=0,this._remoteStreamDecodeStatus=new Map,this.resultStorage=new Map}record(e,i){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(e);if(s&&(s.result.push(i),s.result.length>=5)){const o=s.result.includes(!0);s.isPrevNormal&&!o&&this.emit("stats-exception",{exception:e,code:y_[e]}),!s.isPrevNormal&&o&&this.emit("stats-exception",{exception:e+"_RECOVER",code:y_[e]+2e3}),s.isPrevNormal=o,s.result=[]}}checkAudioOutputLevel(e){let i=e.receivedKBitrate,s=e.volume;return window.__byte_receiveBitrate__!==void 0&&(e.receivedKBitrate=window.__byte_receiveBitrate__),window.__byte_receiveLevel__!==void 0&&(s=window.__byte_receiveLevel__),!(i>0&&s===0)}checkVideoDecode(e){let i=e.receivedKBitrate,s=e.decoderOutputFrameRate;return window.__byte_video_receiveBitrate__!==void 0&&(i=window.__byte_video_receiveBitrate__),window.__byte_decodeFrameRate__!==void 0&&(s=window.__byte_decodeFrameRate__),i===0||s!==0}checkAudioInputLevel(e){let i=e._sendVolumeLevel;return window.__byte_audio_input_level__!==void 0&&(i=window.__byte_audio_input_level__),i>=5}checkSendAudioBitrate(e){let i=e.sendKBitrate;return window.__byte_audio_sendBitrate__!==void 0&&(i=window.__byte_audio_sendBitrate__),i!==0}checkFramerateInput(e,i){let s=i.getSettings().frameRate,o=e.frame_rate_input;if(window.__byte_setFramerate__!==void 0&&(s=window.__byte_setFramerate__),window.__byte_frame_rate_input__!==void 0&&(o=window.__byte_frame_rate_input__),!s||!o)return!0;if(e.is_screen){if(o<1)return!1}else if(s>10&&o<5||s<10&&s>=5&&o<=1)return!1;return!0}checkFramerateSent(e){window.__byte_frame_rate_input__!==void 0&&(e.frame_rate_input=window.__byte_frame_rate_input__),window.__byte_frame_rate_sent__!==void 0&&(e.frame_rate_sent=window.__byte_frame_rate_sent__);const i=e.frame_rate_input,s=e.frame_rate_sent;return!(i&&s&&i>5&&s<=1)}checkSendVideoBitrate(e){let i=e.sendKBitrate;return window.__byte_video_sendBitrate__!==void 0&&(i=window.__byte_video_sendBitrate__),i!==0}checkVideoEncodeFailure(e,i){const s=e.frame_rate_input;window.__createEncodeError__&&(e.frame_rate_sent=0,e.frame_rate_encoded=0);const o=e.frame_rate_sent,r=e.frame_rate_encoded,n=s!==void 0&&s>0&&r!==void 0&&r===0&&o!==void 0&&o===0,a=e!=null&&e.is_screen?10:5;var c;n?(this._continuousVideoEncodeFailure++,this._continuousVideoEncodeFailure>a&&(this.emit("rtc-encode-error",{codec:e?.codecName,media_type:"video",track_frame_size_width:i?.getSettings().width,track_frame_size_height:i?.getSettings().height,track_frame_rate:i?.getSettings().frameRate,stats_frame_size_width:e?.frame_size_width,stats_frame_size_height:e?.frame_size_height,stats_frame_rate_input:e?.frame_rate_input,stats_frame_rate_sent:e?.frame_rate_sent,stats_frame_rate_encoded:e?.frame_rate_encoded,stats_frame_encoder_name:e.encoder_implementation,stats_is_hardware_encoder_enabled:de.H264_HW_ENCODER,stats_gpu_url:de.GPU_URL||((c=Yi())===null||c===void 0?void 0:c.renderer),is_screen:e?.is_screen}),this._continuousVideoEncodeFailure=0)):this._continuousVideoEncodeFailure=0}checkVideoDecodeFailure(e,i){const s=e.stream_id;if(this._remoteStreamDecodeStatus.has(s)){const r=this._remoteStreamDecodeStatus.get(s),n=e.frame_rate_decoded===0&&e.packetsReceived>r.packets_received&&e.framesDecoded<10;var o;r.packets_received=e.packetsReceived,r.frames_decoded=e.framesDecoded,r.frame_rate_decoded=e.frame_rate_decoded,r.continuous_video_decode_failure=n?r.continuous_video_decode_failure+1:0,r.continuous_video_decode_failure>5&&(this.emit("rtc-decode-error",{codec:e.codecName,media_type:"video",track_frame_size_width:i.getSettings().width,track_frame_size_height:i.getSettings().height,track_frame_rate:i.getSettings().frameRate,stats_frame_size_width:e.frame_size_width,stats_frame_size_height:e.frame_size_height,stats_frame_rate_decode:e.frame_rate_decoded,stats_frame_rate_receive:e.frame_rate_received,stats_frame_decoder_name:e.decoder_name,stats_gpu_url:de.GPU_URL||((o=Yi())===null||o===void 0?void 0:o.renderer),is_screen:e.is_screen}),r.continuous_video_decode_failure=0)}else this._remoteStreamDecodeStatus.set(s,{packets_received:e.packetsReceived,frames_decoded:e.framesDecoded,frame_rate_decoded:e.frame_rate_decoded,continuous_video_decode_failure:0})}}class LT extends Vt{constructor(e){super(),m(this,"_timer",void 0),m(this,"_reportTimer",void 0),m(this,"handler",void 0),m(this,"_monitor",void 0),m(this,"logger",void 0),m(this,"_destroyed",!1),m(this,"_isReportStarted",!1),this._context=e,this._monitor=ke(e.id),this.logger=new ue("Stats",3,e.id)}setVar(e){this.handler=e}stopReport(e){this._isReportStarted&&(this.logger.info("stopReport","invoke"),this._isReportStarted=!1,clearTimeout(this._reportTimer),delete this._reportTimer,ye(this._context.id,"del_media_statistics_timer","reason: ".concat(e,", stack: ").concat(new Error().stack),0,this._stream.streamId||""),this._destroyed=!0)}filterIllegal(e){const i={};return Object.keys(e).forEach((s=>{e[s]===null||e[s]===void 0||Number.isNaN(e[s])||(i[s]=e[s])})),i}destroy(){this.logger.info("destroy","invoke"),ye(this._context.id,"media_statistics_destroy","".concat(new Error().stack),0,"".concat(this._stream.streamId)),this.stopReport("destroy"),clearTimeout(this._timer),this._destroyed=!0}}class cO extends LT{constructor(e,i){super(e),m(this,"_stats",{audioStats:{},videoStats:{}}),m(this,"_preReports",{audio:{},video:{}}),m(this,"statsMonitor",void 0),this._stream=i,this.statsMonitor=new CT,this.statsMonitor.on("stats-exception",(o=>{this.emit("stats-exception",o)})),this.statsMonitor.on("rtc-encode-error",(o=>{var r;this.logger.info("rtc_encode_error",JSON.stringify(o)),(r=this._monitor)===null||r===void 0||r.report("rtc_encode_error",o)}));const s=async()=>{this._stats=await this._getLocalStats(this._stream,this._preReports,!1),this._destroyed||(this._timer=setTimeout(s,ae("STATS_LOOP_INTERVAL")))};s()}setLocalStreamStatsEvtInterval(e,i){if(this._isReportStarted)return;this.logger.info("setLocalStreamStatsEvtInterval","invoke"),this._isReportStarted=!0,this.setVar(i),this._destroyed=!1;const s={audio:{},video:{}},o=async()=>{const r=await this._getLocalStats(this._stream,s,!0);e(r),this._destroyed||(this._reportTimer=setTimeout(o,2e3))};o()}getLocalStats(){return this._stats}async _getLocalStats(e,i,s){var o,r,n,a,c,d,l;const u=((o=e.audioTrack)===null||o===void 0?void 0:o.mixType)!==void 0&&e.audioTrack.mixType!==Ti.PLAYOUT?(r=(n=e.audioTrack)===null||n===void 0?void 0:n.mixedAudioTrack)!==null&&r!==void 0?r:(a=e.audioTrack)===null||a===void 0?void 0:a.preprocessingTrack:(c=e.audioTrack)===null||c===void 0?void 0:c.preprocessingTrack,p=(d=e.videoTrack)===null||d===void 0?void 0:d.preprocessingTrack;var h;return Object.keys(i.audio).length===0&&Object.keys(i.video).length===0&&(await this.getAudioStats(u,i,(h=e.audioTrack)===null||h===void 0?void 0:h.getAudioLevel(),s),await this.getVideoStats(p,i,s),await uZ(150)),{audioStats:await this.getAudioStats(u,i,(l=e.audioTrack)===null||l===void 0?void 0:l.getAudioLevel(),s),videoStats:await this.getVideoStats(p,i,s),isScreen:e.isScreen}}async getAudioStats(e,i,s,o){var r,n,a;const c={},d={timestamp:Date.now()},{streamId:l,audioMid:u,isScreen:p,pubAttributes:h,pubAudio:_,audioTrack:y}=this._stream,b={media_type:"audio",is_screen:!!p,direction:"up",stream_id:l,vid:u,connection_status:navigator.onLine,track_enabled:e?.enabled,capture_state:h.localaudio?"capture_state_on":"capture_state_off",mute_state:_?"mute_state_off":"mute_state_on",thermal_status:gc.state,is_public_stream:this._stream.isPublicStream};if(y&&(b.playback_volume=y.getVolume()),!e||!this.handler)return c;const S=await((r=this.handler.peer)===null||r===void 0?void 0:r.getStatsWithLowFrequency(e,!1,(n=this._stream.audioTransceiver)===null||n===void 0?void 0:n.sender));if(!S.length)return c;if(S.forEach((g=>{let{type:Z,packetsSent:R,packetsLost:T,bytesSent:X,clockRate:L,roundTripTime:W,channels:M,audioLevel:k,mimeType:U,availableIncomingBitrate:D,availableOutgoingBitrate:ie,bytesReceived:B,nominated:$,id:te,currentRoundTripTime:N,state:K,writable:x,requestsReceived:E,responsesReceived:q,requestsSent:ce,consentRequestsSent:se,responsesSent:oe,jitter:ne,candidateType:w,ip:J,address:re,networkType:j,port:le,protocol:pe,nackCount:ge,retransmittedBytesSent:Ce,retransmittedPacketsSent:Qe,audioInputLevel:vt,ssrc:Gi,totalAudioEnergy:ms,totalSamplesDuration:hs,mediaType:ni,fractionLost:Ws}=g;Z==="outbound-rtp"?(d.packetsSent=R,d.bytesSent=X,b.bytes=X,b.packetsSent=R,b.nackCount=ge,b.ssrc=Gi,b.retransmitted_bytes_sent=Ce,b.retransmitted_packets_sent=Qe,d.retransmittedBytesSent=Ce,d.retransmittedPacketsSent=Qe):Z==="remote-inbound-rtp"?(d.packetsLost=T,b.packetsLost=T,b.net_jitter=1e3*ne,c.rtt=1e3*W,b.rtt=c.rtt,c._fractionLost=Ws||0):Z==="codec"?(c.recordSampleRate=L,c.numChannels=M,b.codecName=U):Z==="media-source"&&k!==void 0?(b.audio_level=k&&-10*Math.log10(Math.pow(k,2)),b.volume=255*k,b.total_audio_energy=ms,b.totalInputDuration=hs,b.send_level||(b.send_level=k)):Z==="ssrc"&&ni==="audio"?vt&&(b.send_level=vt):Z==="candidate-pair"?(b.ice_available_incoming_bitrate=D,b.ice_available_outgoing_bitrate=ie,b.ice_bytes_received=B,b.ice_bytes_sent=X,b.ice_nominated=Number($),b.ice_pair_id=te,b.ice_pair_rtt=N,b.ice_pair_state=K,b.ice_pair_writable=x,b.recv_ping_requests=E,b.recv_ping_responses=q,b.sent_ping_requests_before_first_response=ce,b.sent_ping_requests_total=ce+(se||0),b.sent_ping_responses=oe):Z==="local-candidate"?(b.local_candidate_type=w,b.local_ip=J||re,b.local_network_type=j,b.local_port=le,b.protocol=pe):Z==="remote-candidate"&&(b.remote_candidate_type=w,b.remote_ip=J||re,b.remote_port=le)})),b.send_level)b.send_level<1?b._sendVolumeLevel=32767*b.send_level:b._sendVolumeLevel=b.send_level;else{const g=y?.getAudioLevel()||0;b._sendVolumeLevel=Math.round(g/255*32767)}b.volume===void 0&&s!==void 0&&(b.volume=s,b.audio_level=s&&-10*Math.log10(Math.pow(s/255,2)));const{audio:v}=i;if(!v.timestamp)return i.audio=d,this.filterIllegal(c);var f;return d.packetsLost!==void 0&&(c.audioLossRate=Math.max(0,d.packetsLost-v.packetsLost)/(d.packetsSent-v.packetsSent),c.audioLossRate=Number.isNaN(c.audioLossRate)?0:c.audioLossRate,b.fraction_lost=c.audioLossRate),c.statsInterval=d.timestamp-v.timestamp,b.stats_interval=c.statsInterval,c.sendKBitrate=(d.bytesSent-v.bytesSent||0)/c.statsInterval*8,b.mediaBitratebps=Math.round(1e3*c.sendKBitrate),b.sendKBitrate=c.sendKBitrate,b.bandwidth=Math.round(b.mediaBitratebps/1024),d.retransmittedBytesSent!==void 0&&(b.retransmitBitratebps=(d.retransmittedBytesSent-v.retransmittedBytesSent||0)/c.statsInterval),i.audio=d,b.vendor_mode=this._stream.vendorCode||0,b.pc_session_id=(a=this.handler)===null||a===void 0?void 0:a.peerConnectionId,o?(f=this._monitor)===null||f===void 0||f.report("rtc_media_statistics",b):this.statsMonitor.setLocalAudioStats(b),c._retransmittedRate=(d.retransmittedPacketsSent-v.retransmittedPacketsSent)/(d.packetsSent-v.packetsSent),c.audioLossRate===void 0&&(c.audioLossRate=c._retransmittedRate,b.fraction_lost=c.audioLossRate),c._fractionLost=Math.max(c._fractionLost,c.audioLossRate),c._sendVolumeLevel=b._sendVolumeLevel,this.filterIllegal(c)}async getVideoStats(e,i,s){var o,r,n;const a={},c={timestamp:Date.now(),simulcast:{}},{streamId:d,videoMid:l,isScreen:u,pubAttributes:p,enableSimulcast:h,pubVideo:_}=this._stream,y={media_type:"video",is_screen:!!u,direction:"up",stream_id:d,vid:l,connection_status:navigator.onLine,track_enabled:e?.enabled,capture_state:p.localvideo?"capture_state_on":"capture_state_off",mute_state:_?"mute_state_off":"mute_state_on",thermal_status:gc.state,is_public_stream:this._stream.isPublicStream};if(!e||!this.handler)return a;y.cap_frame_width=e.getSettings().width,y.cap_frame_height=e.getSettings().height,y.frameRateSent=e.getSettings().frameRate,a.isScreen=u,y.is_intersecting=JSON.stringify((o=this._stream)===null||o===void 0||(o=o.videoTrack)===null||o===void 0?void 0:o.intersection());const b=await((r=this.handler.peer)===null||r===void 0?void 0:r.getStatsWithLowFrequency(e,!1,(n=this._stream.videoTransceiver)===null||n===void 0?void 0:n.sender));if(!b.length)return a;let S=0;b.forEach((X=>{const{type:L,framesEncoded:W,packetsLost:M,bytesSent:k,framesSent:U,retransmittedBytesSent:D,totalPacketSendDelay:ie,totalEncodeTime:B,firCount:$,targetBitrate:te,roundTripTime:N,mimeType:K,frameWidth:x,frameHeight:E,packetsSent:q,googActualEncBitrate:ce,googAvailableReceiveBandwidth:se,googAvailableSendBandwidth:oe,googAvgEncodeMs:ne,googBucketDelay:w,googEncodeUsagePercent:J,googFrameRateInput:re,availableIncomingBitrate:j,availableOutgoingBitrate:le,bytesReceived:pe,nominated:ge,id:Ce,currentRoundTripTime:Qe,state:vt,writable:Gi,candidateType:ms,ip:hs,address:ni,networkType:Ws,port:qo,nackCount:er,pliCount:tr,protocol:Ln,qpSum:Gs,requestsReceived:Di,responsesReceived:ir,googRetransmitBitrate:tl,requestsSent:za,consentRequestsSent:il,responsesSent:sl,ssrc:Wn,googTargetEncBitrate:Vs,googTransmitBitrate:xI,retransmittedPacketsSent:Up,encoderImplementation:MI,jitter:wI,rid:Ap,fractionLost:KI,googAdaptationChanges:YI,qualityLimitationReason:HI,qualityLimitationDurations:FI,googFirsReceived:OI,googFrameRateSent:JI,keyFramesEncoded:UI,scalabilityMode:AI,framesPerSecond:Dp,frames:DI}=X;L==="outbound-rtp"?(h&&(Ap?c.simulcast[Ap]=X:c.simulcast[S]=X,S++),c.framesEncoded=W||c.framesEncoded||0,y.key_frames_encoded=UI||0,c.bytesSent=k||c.bytesSent||0,c.framesSent=U||c.framesSent,y.bytes=k||y.bytes||0,c.packetsSent=q||c.packetsSent||0,y.packetsSent=q||y.packetsSent||0,y.nackCount=er||y.nackCount||0,y.pli_count=tr||y.pli_count||0,y.qp_sum=Gs||y.qp_sum||0,y.ssrc=Wn||y.ssrc||0,y.retransmitted_packets_sent=Up,c.retransmittedPacketsSent=Up,c.retransmittedBytesSent=D,y.encoder_implementation=MI,y.qualityLimitationReason=HI,y.qualityLimitationDurations=FI,y.scalabilityMode=AI,x!==void 0&&((!a.encodedFrameWidth||x>a.encodedFrameWidth)&&(a.encodedFrameWidth=x),(!a.encodedFrameHeight||E>a.encodedFrameHeight)&&(a.encodedFrameHeight=E),y.frame_size_height=E,y.frame_size_width=x)):L==="track"?(a.encodedFrameWidth=x,a.encodedFrameHeight=E,y.frame_size_height=E,y.frame_size_width=x):L==="remote-inbound-rtp"?(c.packetsLost=M,a.rtt=1e3*N,y.rtt=a.rtt,y.jitter=1e3*wI,y.packetsLost=M,a._fractionLost=KI||0):L==="codec"?(a.codecType=K,y.codecName=K):L==="candidate-pair"?(y.ice_available_incoming_bitrate=j,y.ice_available_outgoing_bitrate=le,y.ice_bytes_received=pe,y.ice_bytes_sent=k,y.ice_nominated=Number(ge),y.ice_pair_id=Ce,y.ice_pair_rtt=Qe,y.ice_pair_state=vt,y.ice_pair_writable=Gi,y.recv_ping_requests=Di,y.recv_ping_responses=ir,y.sent_ping_requests_before_first_response=za,y.sent_ping_requests_total=za+il,y.sent_ping_responses=sl):L==="local-candidate"?(y.local_candidate_type=ms,y.local_ip=hs||ni,y.local_network_type=Ws,y.local_port=qo,y.protocol=Ln):L==="remote-candidate"?(y.remote_candidate_type=ms,y.remote_ip=hs||ni,y.remote_port=qo):L==="VideoBwe"?(y.encBitratebps=ce,y.available_receive_bandwidth=se,y.available_send_bandwidth=oe,y.bucket_delay=w,y.retransmitBitratebps=tl,y.targetEncBitratebps=Vs,y.transmit_bitrate=xI,a._sendBandWidth=Number(oe)):L==="ssrc"&&(y.avg_encode_ms=ne,y.encodeUsage=J,y.frame_rate_input=re,y.orignal_input_Framerate=Number(re),y.ddaptationChanges=YI,y.firsReceived=OI,y.frameRateSent=JI);const{video:Qa}=i,ol=c.timestamp-Qa.timestamp;if(L==="outbound-rtp"){const zI=k-Qa.bytesSent,zp=D-Qa.retransmittedBytesSent;y.encBitratebps=Math.round(8e3*(zI-zp)/ol),y.bucket_delay=ie/q,y.retransmitBitratebps=Math.round(8e3*zp/ol),y.targetEncBitratebps=te,y.transmit_bitrate=Math.round(1e3*(k-Qa.bytesSent)*8/ol),y.avg_encode_ms=1e3*B/W,y.firsReceived=$+tr}else L==="candidate-pair"?(y.available_send_bandwidth=le,a._sendBandWidth=le):L==="media-source"&&(y.frame_rate_input=Dp,y.orignal_input_Framerate=Number(Dp),y.frame_input=DI)}));const{video:v}=i;if(!v.timestamp)return i.video=c,this.filterIllegal(a);a.statsInterval=c.timestamp-v.timestamp,y.stats_interval=a.statsInterval;const f=Object.keys(c.simulcast);if(h){var g;y.sim_enc_width=[],y.sim_enc_height=[],y.sim_enc_bps=[],y.sim_enc_framerate=[],y.sim_enc_key_frames=[],y.sim_rids=[],y.sim_enc_bandwidth=[],y.sim_sent_framerate=[],y.sim_fraction_lost=[],y.sim_keyencoded=[],y.active_sim_streams=this._context.videoProfile.activeSimStreams||[],y.sim_retransmittedRate=[];let X=!1;var Z;en(f).call(f,((L,W)=>Number(L)-Number(W))).forEach((L=>{const{frameWidth:W,frameHeight:M,bytesSent:k,framesEncoded:U,framesSent:D,packetsLost:ie,packetsSent:B,qualityLimitationReason:$,qualityLimitationDurations:te,qualityLimitationResolutionChanges:N,retransmittedPacketsSent:K,pliCount:x,keyFramesEncoded:E}=c.simulcast[L];$!==void 0&&(y.sim_qualityLimitationReason||(y.sim_qualityLimitationReason=[],y.sim_qualityLimitationDurations=[],y.sim_qualityLimitationResolutionChanges=[]),y.sim_qualityLimitationReason.push($),y.sim_qualityLimitationDurations.push(te),y.sim_qualityLimitationResolutionChanges.push(N));const q=v.simulcast[L];if(y.sim_enc_width.push(W||0),y.sim_enc_height.push(M||0),y.sim_enc_key_frames.push(E||0),q){const ce=(k-q.bytesSent||0)/a.statsInterval;y.sim_enc_bps.push(Math.round(8e3*ce)),y.sim_enc_bandwidth.push(Math.round(8e3*ce/1024));const se=1e3*(U-q.framesEncoded)/a.statsInterval;y.sim_enc_framerate.push(Math.round(se)),y.sim_rids.push(L);const oe=D!==void 0?D-q.framesSent:U-q.framesEncoded,ne=1e3*oe/a.statsInterval;y.sim_sent_framerate.push(Math.round(ne));let w=(ie-q.packetsLost)/(B-q.packetsSent);a._retransmittedRate=(K-q.retransmittedPacketsSent)/(B-q.packetsSent),w=Number.isNaN(w)?0:w,y.sim_fraction_lost.push(w),y.sim_keyencoded.push(x-q.pliCount>0),y.sim_retransmittedRate.push(a._retransmittedRate),W>0&&!X&&(a.rid=L,a.sentKBitrate=8*ce,a.encoderOutputFrameRate=se,a.encodedFrameCount=oe,a.sentFrameRate=ne,a.videoLossRate=w,X=!0)}})),y.vendor_mode=this._stream.vendorCode||0,y.pc_session_id=(g=this.handler)===null||g===void 0?void 0:g.peerConnectionId,s&&((Z=this._monitor)===null||Z===void 0||Z.report("rtc_media_statistics",y))}else{var R,T;a.encodedFrameCount=c.framesSent!==void 0?c.framesSent-v.framesSent:c.framesEncoded-v.framesEncoded,a.sentKBitrate=(c.bytesSent-v.bytesSent||0)/a.statsInterval*8,y.bitrate=Math.round(1e3*a.sentKBitrate),y.bandwidth=Math.round(y.bitrate/1024),a.encoderOutputFrameRate=1e3*(c.framesEncoded-v.framesEncoded)/a.statsInterval,y.frame_rate_encoded=Math.round(a.encoderOutputFrameRate),a.sentFrameRate=1e3*a.encodedFrameCount/a.statsInterval,y.frame_rate_sent=Math.round(a.sentFrameRate),a.videoLossRate=Math.max(0,c.packetsLost-v.packetsLost)/(c.packetsSent-v.packetsSent),a.videoLossRate=Number.isNaN(a.videoLossRate)?0:a.videoLossRate,y.fraction_lost=a.videoLossRate,a._retransmittedRate=(c.retransmittedPacketsSent-v.retransmittedPacketsSent)/(c.packetsSent-v.packetsSent),y.vendor_mode=this._stream.vendorCode||0,y.pc_session_id=(R=this.handler)===null||R===void 0?void 0:R.peerConnectionId,y.sentKBitrate=a.sentKBitrate,a.inputFrameRate=y.orignal_input_Framerate,a.encoderName=y.encoder_implementation,s?(T=this._monitor)===null||T===void 0||T.report("rtc_media_statistics",y):this.statsMonitor.setLocalVideoStats(y,e)}return i.video=c,a._fractionLost=Math.max(a._fractionLost,a.videoLossRate),a._captureResolutionWidth=y.cap_frame_width,a._captureResolutionHeight=y.cap_frame_height,this.filterIllegal(a)}destroy(){super.destroy(),this.statsMonitor.destroy()}}class lO extends LT{constructor(e,i){super(e),m(this,"_stats",{audioStats:{},videoStats:{}}),m(this,"_preReports",{audio:{},video:{}}),m(this,"statsMonitor",void 0),this._stream=i,this.statsMonitor=new CT,this.statsMonitor.on("stats-exception",(o=>{this.emit("stats-exception",o)})),this.statsMonitor.on("rtc-decode-error",(o=>{var r;this.logger.info("rtc_decode_error",JSON.stringify(o)),(r=this._monitor)===null||r===void 0||r.report("rtc_decode_error",o)}));const s=async()=>{this._stats=await this._getRemoteStreamStats(this._stream,this._preReports,!1),this._destroyed||(this._timer=setTimeout(s,ae("STATS_LOOP_INTERVAL")))};s()}async setRemoteStreamStatsEvtInterval(e,i){if(this._isReportStarted)return;this.logger.info("setRemoteStreamStatsEvtInterval","invoke"),this._isReportStarted=!0,this.setVar(i),this._destroyed=!1;const s={audio:{},video:{}},o=async()=>{const r=await this._getRemoteStreamStats(this._stream,s,!0);e(r),this._destroyed||(this._reportTimer=setTimeout(o,2e3))};o()}getRemoteStreamStats(){return this._stats}async _getRemoteStreamStats(e,i,s){var o,r,n;const a=(o=e.videoTrack)===null||o===void 0?void 0:o.originTrack,c=(r=e.audioTrack)===null||r===void 0?void 0:r.originTrack;var d;return Object.keys(i.audio).length===0&&Object.keys(i.video).length===0&&(await this.getRemoteAudioStats(c,i,(d=this._stream.audioTrack)===null||d===void 0?void 0:d.getAudioLevel(),s),await this.getRemoteVideoStats(a,i,s),await uZ(150)),{audioStats:await this.getRemoteAudioStats(c,i,(n=this._stream.audioTrack)===null||n===void 0?void 0:n.getAudioLevel(),s),videoStats:await this.getRemoteVideoStats(a,i,s),isScreen:e.isScreen,userId:e.userId,streamId:e.streamId}}unsubscribe(){this.logger.info("unsubscribe","invoke"),super.stopReport("unsubscribe"),this._stream.stopAudioStallObserve()}async getRemoteAudioStats(e,i,s,o){var r,n,a,c;const d={},l={},{streamId:u,userId:p,isScreen:h,audioMid:_,subMediaType:y,_attributes:b,virtual:S,audioTrack:v}=this._stream,f={media_type:"audio",is_screen:!!h,direction:"down",stream_id:u,stream_user_id:p,vid:_,audio_mux:S,connection_status:navigator.onLine,track_enabled:e?.enabled,mute_state:Be(y)?"mute_state_off":"mute_state_on",remote_user_capture_state:b.localaudio?"capture_state_on":"capture_state_off",remote_user_mute_state:b.localaudio&&b.audiostream?"mute_state_off":"mute_state_on",thermal_status:gc.state,is_public_stream:this._stream.isPublicStream};if(v&&(f.playback_volume=v.getVolume()),!e||!this.handler)return d;const g=await((r=this.handler.peer)===null||r===void 0?void 0:r.getStatsWithLowFrequency(e,!1,(n=this._stream.audioTransceiver)===null||n===void 0?void 0:n.receiver));if(!g.length)return d;g.forEach((X=>{let{type:L,packetsLost:W,packetsReceived:M,bytesReceived:k,jitterBufferDelay:U,jitterBufferEmittedCount:D,clockRate:ie,channels:B,totalSamplesReceived:$,concealedSamples:te,silentConcealedSamples:N,concealmentEvents:K,totalRoundTripTime:x,packetsDiscarded:E,state:q,currentRoundTripTime:ce,audioLevel:se,totalAudioEnergy:oe,totalSamplesDuration:ne,mimeType:w,googDecodingNormal:J,googDecodingMuted:re,availableIncomingBitrate:j,availableOutgoingBitrate:le,bytesSent:pe,nominated:ge,id:Ce,writable:Qe,jitter:vt,candidateType:Gi,ip:ms,address:hs,networkType:ni,port:Ws,protocol:qo,audioOutputLevel:er,requestsReceived:tr,responsesReceived:Ln,requestsSent:Gs,consentRequestsSent:Di,responsesSent:ir,ssrc:tl,nackCount:za,lastPacketReceivedTimestamp:il,concealmentevents:sl,fecPacketsReceived:Wn}=X;if(L==="inbound-rtp")l.packetsLost=W,l.packetsReceived=M,f.packetsLost=W,f.packetsReceived=M,f.packetsDiscarded=E,f.nackCount=za,f.lastPacketReceivedTimestamp=il,f.concealmentevents=sl,l.bytesReceived=k,U!==void 0&&(d.jitterBufferDelay=U/D*1e3,f.average_jitter_buffer_delay_ms=d.jitterBufferDelay),$!==void 0&&(l.totalSamplesReceived=$,d.concealedSamples=te,l.concealedSamples=te,l.silentConcealedSamples=N,f.concealedSamples=te,d.concealmentEvents=K,f.totalSamplesReceived=$),Wn!==void 0&&(f.fec_packets_received=Wn,l.fecPacketsReceived=Wn),f.jitter=1e3*vt,f.ssrc=tl,se!==void 0&&se!==0?(f.audio_level=se&&-10*Math.log10(Math.pow(se,2)),f.volume=255*se):(f.volume=s??255*se,f.audio_level=s&&-10*Math.log10(Math.pow(s/255,2))),oe!==void 0&&(f.total_audio_energy=oe),ne!==void 0&&(f.totalAudioDuration=ne);else if(L==="codec")d.recordSampleRate=ie,B&&(d.numChannels=B),f.codecName=w,d.codecType=w;else if(L==="candidate-pair"){var Vs;f.ice_available_incoming_bitrate=j,f.ice_available_outgoing_bitrate=le,f.ice_bytes_received=k,f.ice_bytes_sent=pe,f.ice_nominated=Number(ge),f.ice_pair_id=Ce,f.ice_pair_rtt=ce,f.rtt=1e3*ce,f.rtt&&(Vs=this._context.streamRTT)!==null&&Vs!==void 0&&(Vs=Vs[u])!==null&&Vs!==void 0&&Vs.audio&&(f.total_rtt_ms=Math.round(f.rtt+this._context.streamRTT[u].audio)),f.ice_pair_state=q,f.ice_pair_writable=Qe,f.recv_ping_requests=tr,f.recv_ping_responses=Ln,f.sent_ping_requests_before_first_response=Gs,f.sent_ping_requests_total=Gs+(Di||0),f.sent_ping_responses=ir,q==="succeeded"&&(d.rtt=1e3*ce,d.total_rtt=1e3*x)}else L==="track"&&se!==void 0?(se===0&&s!==0?(f.volume=s,f.audio_level=s&&-10*Math.log10(Math.pow(s/255,2))):(f.audio_level=se&&-10*Math.log10(Math.pow(se,2)),f.volume=255*se),f.total_audio_energy=oe,f.totalAudioDuration=ne):L==="ssrc"?(f.decodingNormal=J,f.recvAudioLevel=er,f.decodingMuted=re):L==="local-candidate"?(f.local_candidate_type=Gi,f.local_ip=ms||hs,f.local_network_type=ni,f.local_port=Ws,f.protocol=qo):L==="remote-candidate"&&(f.remote_candidate_type=Gi,f.remote_ip=ms||hs,f.remote_port=Ws)}));const{audio:Z}=i;if(!Z.timestamp)return l.timestamp=Date.now(),i.audio=l,this.filterIllegal(d);let R;var T;return l.concealedSamples!==void 0&&(f.interval_concealed_samples=l.concealedSamples-Z.concealedSamples,f.interval_samples_received=l.totalSamplesReceived-Z.totalSamplesReceived,f.interval_silent_concealed_samples=l.silentConcealedSamples-Z.silentConcealedSamples,R=await this._stream.updateAudioStallInfo(f,d,l)),l.timestamp=Date.now(),d.audioLossRate=Math.max(0,l.packetsLost-Z.packetsLost)/(l.packetsReceived-Z.packetsReceived+(l.packetsLost-Z.packetsLost)),d.audioLossRate=Number.isNaN(d.audioLossRate)?0:d.audioLossRate,f.fraction_lost=d.audioLossRate,d.statsInterval=l.timestamp-Z.timestamp,f.stats_interval=d.statsInterval,d.receivedKBitrate=(l.bytesReceived-Z.bytesReceived||0)/d.statsInterval*8,f.receivedKBitrate=d.receivedKBitrate,f.bandwidth=Math.round(1e3*d.receivedKBitrate/1024),l.concealedSamples!==void 0&&(d.receivedSampleRate=1e3*f.interval_samples_received/d.statsInterval),l.fecPacketsReceived!==void 0&&(f.fecBitratebps=(l.fecPacketsReceived-Z.fecPacketsReceived||0)/d.statsInterval),f.average_jitter_buffer_delay_ms&&f.total_rtt_ms&&(d.e2eDelay=f.average_jitter_buffer_delay_ms+f.total_rtt_ms),(a=this._context.streamRTT)!==null&&a!==void 0&&(a=a[u])!==null&&a!==void 0&&a.audio&&(d.totalRtt=(f.rtt?f.rtt:0)+this._context.streamRTT[u].audio),i.audio=l,f.vendor_mode=this._stream.vendorCode||0,f.pc_session_id=(c=this.handler)===null||c===void 0?void 0:c.peerConnectionId,o?(T=this._monitor)===null||T===void 0||T.report("rtc_media_statistics",f,R):this.statsMonitor.setRemoteAudioStats(f),this.filterIllegal(d)}async getRemoteVideoStats(e,i,s){var o,r,n,a,c;const d={},l={timestamp:Date.now()},{streamId:u,userId:p,isScreen:h,subMediaType:_,_attributes:y}=this._stream,b=I({media_type:"video",is_screen:!!h,direction:"down",stream_id:u,stream_user_id:p,vid:this._stream.videoMid,connection_status:navigator.onLine,track_enabled:e?.enabled,mute_state:Ve(_)?"mute_state_off":"mute_state_on",remote_user_capture_state:y.localvideo?"capture_state_on":"capture_state_off",remote_user_mute_state:y.localvideo&&y.videostream?"mute_state_off":"mute_state_on",is_intersecting:JSON.stringify((o=this._stream.videoTrack)===null||o===void 0?void 0:o.intersection()),thermal_status:gc.state,is_public_stream:this._stream.isPublicStream},this._stream.getVideoRenderInfo());if(!e||!this.handler)return d;d.isScreen=h;const S=await((r=this.handler.peer)===null||r===void 0?void 0:r.getStatsWithLowFrequency(e,!1,(n=this._stream.videoTransceiver)===null||n===void 0?void 0:n.receiver));if(!S.length)return d;S.forEach((R=>{let{type:T,frameHeight:X,frameWidth:L,packetsLost:W,packetsReceived:M,bytesReceived:k,framesDecoded:U,jitterBufferDelay:D,jitterBufferEmittedCount:ie,mimeType:B,firCount:$,availableIncomingBitrate:te,availableOutgoingBitrate:N,bytesSent:K,nominated:x,id:E,currentRoundTripTime:q,state:ce,writable:se,candidateType:oe,ip:ne,address:w,networkType:J,port:re,nackCount:j,pliCount:le,protocol:pe,requestsReceived:ge,responsesReceived:Ce,requestsSent:Qe,consentRequestsSent:vt,responsesSent:Gi,ssrc:ms,jitter:hs,framesReceived:ni,keyFramesDecoded:Ws,totalDecodeTime:qo,decoderImplementation:er,lastPacketReceivedTimestamp:tr,framesDropped:Ln}=R;if(T==="inbound-rtp")l.packetsLost=W,b.packetsLost=W,l.packetsReceived=M,b.packetsReceived=M,l.bytesReceived=k,b.bytes=k,l.framesDecoded=U,l.totalDecodeTime=qo,D!==void 0&&(l.jitterBufferDelay=D/ie*1e3,b.average_jitter_buffer_delay_ms=l.jitterBufferDelay),b.fir_count=$,b.nackCount=j,l.nackCount=j,b.pli_count=le,b.ssrc=ms,b.framesDropped=Ln,b.jitter=1e3*hs,b.framesReceived=ni,l.framesReceived=ni,b.framesDecoded=U,b.key_frames_decoded=Ws,b.decoder_name=er,d.decoderName=er,b.last_packet_received_timestamp=tr,L!==void 0&&(d.width=L,b.frame_size_width=L,d.height=X,b.frame_size_height=X);else if(T==="track"&&L!==void 0)d.width=L,b.frame_size_width=L,d.height=X,b.frame_size_height=X,ni!==void 0&&(b.framesReceived=ni,l.framesReceived=ni);else if(T==="codec"){b.codecName=B,d.codecType=B;const ir=hZ(B);var Gs;ir!==void 0&&((Gs=this._stream._receiveSEIHandler)===null||Gs===void 0||Gs.setCodec(ir))}else if(T==="candidate-pair"){var Di;b.ice_available_incoming_bitrate=te,b.ice_available_outgoing_bitrate=N,b.ice_bytes_received=k,b.ice_bytes_sent=K,b.ice_nominated=Number(x),b.ice_pair_id=E,b.ice_pair_rtt=q,b.rtt=1e3*q,b.rtt&&(Di=this._context.streamRTT)!==null&&Di!==void 0&&(Di=Di[u])!==null&&Di!==void 0&&Di.video&&(b.total_rtt_ms=Math.round(b.rtt+(this._context.streamRTT[u].video||0))),d.rtt=b.rtt,b.ice_pair_state=ce,b.ice_pair_writable=se,b.recv_ping_requests=ge,b.recv_ping_responses=Ce,b.sent_ping_requests_before_first_response=Qe,b.sent_ping_requests_total=Qe+(vt||0),b.sent_ping_responses=Gi}else T==="local-candidate"?(b.local_candidate_type=oe,b.local_ip=ne||w,b.local_network_type=J,b.local_port=re,b.protocol=pe):T==="remote-candidate"&&(b.remote_candidate_type=oe,b.remote_ip=ne||w,b.remote_port=re)}));const{video:v}=i;if(!v.timestamp)return i.video=l,this.filterIllegal(d);const f=Math.max(0,l.packetsLost-v.packetsLost),g=l.packetsReceived-v.packetsReceived;if(d.videoLossRate=f/(g+f),d._receivePackets=l.packetsReceived,d._receivePacketsLost=l.packetsLost,v.totalDecodeTime&&v.framesDecoded&&l.framesDecoded!==v.framesDecoded){const R=l.totalDecodeTime-v.totalDecodeTime,T=l.framesDecoded-v.framesDecoded;b.decode_elapse_per_frame=Number((R/T*1e3).toFixed(2))}var Z;return d._retransmittedRate=(l.nackCount-v.nackCount)/(g+f),d.videoLossRate=Number.isNaN(d.videoLossRate)?0:d.videoLossRate,b.fraction_lost=d.videoLossRate,d.statsInterval=l.timestamp-v.timestamp,b.stats_interval=d.statsInterval,d.receivedKBitrate=(l.bytesReceived-v.bytesReceived||0)/d.statsInterval*8,b.bitrate=Math.round(1e3*d.receivedKBitrate),b.bandwidth=Math.round(b.bitrate/1024),d.decoderOutputFrameRate=1e3*(l.framesDecoded-v.framesDecoded)/d.statsInterval,d.receivedFrameRate=1e3*(l.framesReceived-v.framesReceived)/d.statsInterval,b.frame_rate_decoded=Math.round(d.decoderOutputFrameRate),b.frame_rate_received=Math.round(d.receivedFrameRate),b.average_jitter_buffer_delay_ms&&b.total_rtt_ms&&(d.e2eDelay=b.average_jitter_buffer_delay_ms+b.total_rtt_ms),(a=this._context.streamRTT)!==null&&a!==void 0&&(a=a[u])!==null&&a!==void 0&&a.video&&(d.totalRtt=(b.rtt?b.rtt:0)+(this._context.streamRTT[u].video||0)),i.video=l,this._stream.updateVideoStallInfo(b,d,s),b.vendor_mode=this._stream.vendorCode||0,b.pc_session_id=(c=this.handler)===null||c===void 0?void 0:c.peerConnectionId,d.frameSizeWidth=b.frame_size_width,d.frameSizeHeight=b.frame_size_height,d.decoderName=b.decoder_name,s?(Z=this._monitor)===null||Z===void 0||Z.report("rtc_media_statistics",b):this.statsMonitor.setRemoteVideoStats(b,e),this.filterIllegal(d)}destroy(){super.destroy(),super.stopReport("destroy"),this._stream.stopAudioStallObserve(),this.statsMonitor.destroy()}}class uO{constructor(e){m(this,"_roomId",void 0),m(this,"_constraints",{}),m(this,"_profile",void 0),m(this,"_customMaxBitrate",0),this._appId=e}setRoomId(e){this._roomId=e}setAudioProfile(e){this._profile=e,this._customMaxBitrate=0}get customMaxBitrate(){return this._customMaxBitrate}setCustomMaxBitrate(e){const{audio_encode:i}=We.getEngineWebConfig(this._appId,this._roomId||"");this._customMaxBitrate=i!=null&&i.bitrate?0:1e3*e}getOpusConfigStr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const{audio_encode:i}=We.getEngineWebConfig(this._appId,this._roomId||""),{sampleRate:s,channelCount:o}=this.getConstraints(),r=typeof s=="number"?s:s?.exact,n=typeof o=="number"?o:o?.exact,a={};e.split(";").forEach((u=>{const[p,h]=u.split("=");p&&h&&(a[p]=h)}));const c=i?.bitrate||this._customMaxBitrate||this._getConfigByAudioProfile().bitrate;c&&(a.maxaveragebitrate=c);const d=i?.enc_sample_rate||r;d&&(a["sprop-maxcapturerate"]=d);const l=i?.playback_rate||r;return l&&(a.maxplaybackrate=l),(n&&n>1||i!=null&&i.stereo)&&(a["sprop-stereo"]=1,a.stereo=1),i!=null&&i.dtx&&(a.usedtx=1),Object.keys(a).map((u=>"".concat(u,"=").concat(a[u]))).join(";")}updateConstraints(e){this._constraints=I(I({},this._constraints),e)}getConstraints(){const e=I({},this._constraints),{audio_capture:i}=We.getEngineWebConfig(this._appId,this._roomId||"");qi(i?.sample_rate)||(e.sampleRate=i.sample_rate),qi(i?.channel)||(e.channelCount=i.channel),qi(i?.agc)||(e.autoGainControl=i.agc),qi(i?.ans)||(e.noiseSuppression=i.ans),qi(i?.aec)||(e.echoCancellation=i.aec);const{sampleRate:s,channel:o}=this._getConfigByAudioProfile();return qi(e.sampleRate)&&!qi(s)&&(e.sampleRate=s),qi(e.channelCount)&&!qi(o)&&(e.channelCount=o),e}_getConfigByAudioProfile(){const e={};switch(this._profile){case Ir.fluent:e.sampleRate=16e3,e.bitrate=24e3;break;case Ir.standard:e.sampleRate=48e3,e.bitrate=48e3;break;case Ir.hd:e.sampleRate=48e3,e.bitrate=128e3,e.channel=2;break;case Ir.standardStereo:e.sampleRate=48e3,e.bitrate=8e4,e.channel=2;break;case Ir.hdMono:e.sampleRate=48e3,e.bitrate=128e3}return e}}var At=(t=>(t[t.AUTOPLAY_FAILED=-1e3]="AUTOPLAY_FAILED",t[t.TRACK_ERROR=-1001]="TRACK_ERROR",t[t.Fetch_MODIFY=-1002]="Fetch_MODIFY",t[t.BLACK_BROWSER=-1003]="BLACK_BROWSER",t[t.DC_SEND_ERROR=-1004]="DC_SEND_ERROR",t[t.DUPLICATE_DOM=-1005]="DUPLICATE_DOM",t))(At||{});const mO={start_interval:100,multiplier:2,max_interval:3e4};class WT{constructor(){m(this,"_times",0),m(this,"_config",mO),m(this,"initTs",ee())}getRetryDelay(){return Math.min(this._config.max_interval,Math.pow(this._config.multiplier,this._times++)*this._config.start_interval)}setConfig(e){this._config=e}reset(){this._times=0}}class hO{constructor(e){m(this,"_logger",void 0),m(this,"_monitor",void 0),this._ctx=e;const i=We.getServerConfig(this._ctx.appId);this._logger=new ue("DecisionConfig",1,this._ctx.id),this._monitor=ke(this._ctx.id),setTimeout((()=>{this.updateConfig(i,!0)}),0)}updateConfig(e,i){!i&&We.setServerConfig(this._ctx.appId,e),e.rts_report&&Je.setConfig(e.rts_report),this._ctx.joinRoomConfig.setServerConfig(e.web_join_room),this._setRtsConfig(e.rts_config),this._setRtsQpsConfig(e.rts_qps),this._preConnect(e),this._getServerConfigExecutor(e,i)}_setRtsConfig(e){e!=null&&e.rts_mode&&e.rts_mode!==this._ctx.rtsMode&&(this._logger.print("_setRtsConfig","setRtsMode to %o",e.rts_mode),this._ctx.setRTSMode(e.rts_mode===wo.NORMAL_MODE?wo.NORMAL_MODE:wo.LIMIT_MODE))}_setRtsQpsConfig(e){this._logger.print("_setRtsQpsConfig",JSON.stringify(e)),this._ctx.setRtsQpsConf(e),Object.keys(this._ctx.rtsLimiter).length>0&&ye(this._ctx.id,"setRtsQpsConf",JSON.stringify(e))}_getServerConfigExecutor(e,i){var s,o,r,n,a,c,d,l,u,p,h;const{upload_console_length_cut:_,upload_report_limit:y}=e?.web_rtc_config||{};if(Ki.setParameter("UPLOAD_CONSOLE_ON",!(e==null||(s=e.web_rtc_config)===null||s===void 0||!s.upload_console_on)),_&&Ki.setParameter("UPLOAD_CONSOLE_LENGTH_CUT",_),y&&Ki.setParameter("UPLOAD_REPORT_LIMIT",y),Ki.setParameter("ENABLE_REPORT_IDB_BUFFER",!(e==null||(o=e.web_rtc_config)===null||o===void 0||!o.enable_report_idb_buffer)),(e==null||(r=e.web_rtc_config)===null||r===void 0?void 0:r.sdk_codec_negotiation)===!1&&$t("SDK_CODEC_NEGOTIATION",!1),(e==null||(n=e.web_rtc_config)===null||n===void 0?void 0:n.ainr_enable_dump)!==void 0&&$t("AINR_ENABLE_DUMP",e.web_rtc_config.ainr_enable_dump),(e==null||(a=e.web_rtc_config)===null||a===void 0?void 0:a.ainr_overload_threshold)!==void 0&&$t("AINR_OVERLOAD_THRESHOLD",e.web_rtc_config.ainr_overload_threshold),(e==null||(c=e.web_rtc_config)===null||c===void 0?void 0:c.ainr_url)!==void 0)try{$t("AINR_URL",JSON.parse(e.web_rtc_config.ainr_url))}catch(v){this._logger.warn("_getServerConfigExecutor","parse AINR_URLS error %o",v)}var b,S;(e==null||(d=e.web_rtc_config)===null||d===void 0?void 0:d.ainr_cache_time)!==void 0&&$t("AINR_CACHE_TIME",e.web_rtc_config.ainr_cache_time),(e==null||(l=e.web_rtc_config)===null||l===void 0?void 0:l.ainr_dump_time)!==void 0&&$t("AINR_DUMP_TIME",e.web_rtc_config.ainr_dump_time),e!=null&&(u=e.web_rtc_config)!==null&&u!==void 0&&u.web_pc_killswitch&&(this._logger.print("web_pc_killswitch update: ",JSON.stringify(e.web_rtc_config.web_pc_killswitch)),this._ctx.pcKillSwitch=I(I({},this._ctx.pcKillSwitch),e.web_rtc_config.web_pc_killswitch)),typeof(e==null||(p=e.web_rtc_config)===null||p===void 0?void 0:p.fallback)=="boolean"&&(e?.web_rtc_config.fallback===!1?this._ctx.enableFallbackHandler=!1:Array.isArray(e==null||(b=e.web_rtc_config)===null||b===void 0?void 0:b.fallback_ua_reg)?this._ctx.enableFallbackHandler=e?.web_rtc_config.fallback_ua_reg.every((v=>typeof v=="string"&&new RegExp(v).test(navigator.userAgent))):this._ctx.enableFallbackHandler=!1),typeof(e==null||(h=e.web_rtc_config)===null||h===void 0?void 0:h.standard)=="boolean"&&(e?.web_rtc_config.standard===!1?this._ctx.enableStandardHandler=!1:Array.isArray(e==null||(S=e.web_rtc_config)===null||S===void 0?void 0:S.standard_ua_reg)?this._ctx.enableStandardHandler=e?.web_rtc_config.standard_ua_reg.every((v=>typeof v=="string"&&new RegExp(v).test(navigator.userAgent))):this._ctx.enableStandardHandler=!1)}_preConnect(e){var i;let s=ae("PRE_ICE");var o;typeof(e==null||(i=e.web_rtc_config)===null||i===void 0?void 0:i.pre_ice)=="boolean"&&(s=e.web_rtc_config.pre_ice),s&&(this._logger.print("preConnect","start pre ice connection."),this._ctx.signalingManager.connect(),(o=this._monitor)===null||o===void 0||o.set({pre_connection:!0}),this._ctx.isPreConnection=!0)}}class pO{constructor(e){m(this,"_reconnectTimer",void 0),m(this,"_retryFunc",void 0),m(this,"_abortControllers",[]),m(this,"_monitor",void 0),m(this,"logger",void 0),m(this,"_groupConfigId",Ts()),m(this,"_retryLimiter",new WT),m(this,"_timer",void 0),m(this,"_destroyed",!1),m(this,"_onlineListener",(()=>{this._reconnectTimer&&this._retryFunc&&(clearTimeout(this._reconnectTimer),this._retryFunc())})),m(this,"_decisionConfig",void 0),this._ctx=e,this._monitor=ke(e.id),this.logger=new ue("ICERequest",4,e.id),this._decisionConfig=new hO(e),window.addEventListener("online",this._onlineListener)}async getICENode(e){let i;this.logger.info("getICENode","invoke");try{if(i=await this._getAccessWithRetry(e),i.length===0)throw new Error("server return empty nodes.")}catch(s){throw this._reportRtcInvokeStatus("es.join.getNodeFailed",s),new G(C.ICE_SERVER_WRONG,"get ICE config failed: ".concat(s.message),s)}return this.logger.success("getICENode","success"),this._reportRtcInvokeStatus("es.join.getNodeSuccess",i),i}_getAccessWithRetry(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return i!==0&&this.logger.info("_getAccessWithRetry()","invoke feedbackInfo: %o, 201count: %o",e,i),new Promise(((s,o)=>{this._getAccessNode(e).then((r=>{this._retryLimiter.reset(),s(r)})).catch((r=>{if(this._destroyed)return;if(Array.isArray(r)&&r.length>0){if(r.findIndex((a=>400<=a.code&&a.code<500))>-1)return this._retryLimiter.reset(),o(new Error("HTTP request failed(4xx)"));if(r.every((a=>{var c;return a.code===201||((c=a.error)===null||c===void 0?void 0:c.code)===201}))&&i++,i===3)return this._retryLimiter.reset(),o(new Error("HTTP request failed(201)"))}const n=this._retryLimiter.getRetryDelay();this.logger.warn("_getAccessWithRetry()","_getAccessWithRetry error, will retry after ".concat(n,"ms"),r),this._retryFunc=()=>{this._getAccessWithRetry(e,i).then(s).catch(o)},this._reconnectTimer=self.setTimeout(this._retryFunc,n)}))}))}async _getAccessNode(e){return new Promise(((i,s)=>{const o=We.getAccessNode(this._ctx.appId);if(o){const r=(Array.isArray(o)?o:[o]).map((n=>(n.cache_status=!0,n)));this.logger.info("getAccessNode","use cache node."),i(r),this._timer=setTimeout((()=>{this._getAccessNodeFromServer(e),this._reportRtcInvokeStatus("es.R.node.cache",o),delete this._timer}),0)}else this._getAccessNodeFromServer(e).then(i).catch(s)}))}async _getAccessNodeFromServer(e){const{urls:i,needFallback:s}=this._getAccessUrls();return this.getICEConfigFromServer(i,e).then((o=>{const{nodes:r,decisionConfig:n}=o;return!this._ctx.useCloudProxy&&r?.length>0&&We.setAccessNode(this._ctx.appId,r,o.ttl||11200),n&&this._decisionConfig.updateConfig(n,!1),o.dispatchDomains&&!this._ctx.useCloudProxy&&We.setAccessUrls(o.dispatchDomains),r})).catch((o=>{if(s)return this._reportRtcInvokeStatus("es.R.req.fallback",""),We.clearAccessUrls(),this._getAccessNodeFromServer(e);throw o}))}_getAccessUrls(){let e=We.getAccessUrls()||[],i=!0;return e.length!==0?this._reportRtcInvokeStatus("es.R.req.cache.urls",e):(i=!1,e=de.ICE_CONFIG_REQUEST_URLS,e.length!==0?this._reportRtcInvokeStatus("es.R.req.external.urls",e):(e=de.ICE_CONFIG_REQUEST_URLS_INTERNAL,this._reportRtcInvokeStatus("es.R.req.internal.urls",e))),{urls:e,needFallback:i}}async getICEConfigFromServer(e,i){var s;const o={appID:this._ctx.appId,deviceID:We.getDeviceId(),os:"web",sdkVersion:de.VERSION,isOversea:de.OVERSEA,expectedAddr:ae("EXPECTED_ADDR"),productPlatform:"VolcEngine",enableCloudProxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC,decisionKeys:["rts_report","web_join_room","web_rtc_config","rts_qps","rts_config"],accessParams:JSON.stringify({requireICEUfragV2:!0}),userAgent:(s=navigator)===null||s===void 0?void 0:s.userAgent};var r;i&&(o.feedbackInfo=i,((r=i[0])===null||r===void 0||(r=r.feedbackReason)===null||r===void 0?void 0:r.type)!=="ICE_FAILED"&&delete o.expectedAddr),ae("AREA_CODE")==="AREA_CODE_US_OPCO"&&(o.mediaArea=JSON.stringify([{AreaList:["GEO:US_OPCO"],Attribute:"include"}]),o.accessArea=JSON.stringify([{AreaList:["GEO:US_OPCO"],Attribute:"include"}]));const n=e.map((a=>this._httpRequest(a,o)));return nY(n)}async _httpRequest(e,i){var s;const o=Ts();i.connectSessionID=o;const r=Date.now();(s=this._monitor)===null||s===void 0||s.report("rtc_get_access",{error_code:0,message:JSON.stringify(i),elapse:0,type:"request",host:e,config_id:o,group_config_id:this._groupConfigId});const n=new AbortController;let a;this._abortControllers.push(n);try{var c;try{a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify(i),signal:n.signal})}catch(p){var d;throw nP(fetch)||(d=this._monitor)===null||d===void 0||d.report("rtc_error",{error_code:At.Fetch_MODIFY,message:"get access failed, possibly due to modifying the browser's Fetch API."},{origin_error:p}),p}if(this._abortControllers=this._abortControllers.filter((p=>p!==n)),a.status!==200)throw{message:a.statusText,code:a.status};const u=await a.json();if(u.code!==200)throw u;return(c=this._monitor)===null||c===void 0||c.report("rtc_get_access",{error_code:200,message:JSON.stringify(u),elapse:Date.now()-r,type:"response",host:e,config_id:o,group_config_id:this._groupConfigId}),u}catch(u){var l;throw(l=this._monitor)===null||l===void 0||l.report("rtc_get_access",{error_code:Number(u?.code||u?.server_code),message:u?.message,elapse:Date.now()-r,type:"response",host:e,config_id:o,group_config_id:this._groupConfigId},{error:JSON.stringify(u)}),u}}destroy(){this._destroyed=!0,window.removeEventListener("online",this._onlineListener),this._abortControllers.forEach((e=>e.abort("engine destroy"))),this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer),this._timer&&(window.clearTimeout(this._timer),delete this._timer)}_reportRtcInvokeStatus(e,i){var s;(s=this._monitor)===null||s===void 0||s.report("rtc_invoke_status",{sdk_api_name:e,message:i,error_code:0,stream_id:"",elapse:0,group_config_id:this._groupConfigId})}}function bO(t){return t.replace(/[A-Z]/g,(e=>"_".concat(e.toLowerCase())))}function Zh(t,e){return I(I({},t),e)}function no(t){const e={};return Object.keys(t).forEach((i=>{const s=t[i];try{Array.isArray(s)?e[i]=s.map((o=>o!==null&&typeof o=="object"?no(o):o)):e[i]=s!==null&&typeof s=="object"?no(s):s}catch{}})),e}function aS(t){return t===null?[]:Object.keys(t).map((e=>t[e]))}const yO=new ue("FirefoxHandler",3),Th=Math.pow(2,32),dS="kp34Za0H+aVf862l",_O="o/i14u9pJrxRKAsu",SO=()=>Math.floor(Math.random()*Th+1e4);function rn(t){return t>Th-18?(yO.warn("generateAllSsrc","reset start id",t),rn(t=t-Th+1e4+18)):{audio:t,audioFec:t+1,audioRtx:t+2,video:t+3,videoFec:t+4,videoRtx:t+5,next:t+18}}const nn=function(t,e,i){return[{id:i,attribute:"cname",value:arguments.length>3&&arguments[3]!==void 0?arguments[3]:_O},{id:i,attribute:"msid",value:"".concat(t," ").concat(t,"-").concat(e)},{id:i,attribute:"mslabel",value:"".concat(t)},{id:i,attribute:"label",value:"".concat(t,"-").concat(e)}]},Wa=function(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=e.video,o=e.videoRtx,r=e.videoFec,n=[s,o],{cname:a,flexfec:c}=i;c&&n.push(r);const d=n.reduce(((u,p)=>u.concat(nn(t,"video",p,a))),[]),l=[{semantics:"FID",ssrcs:"".concat(s," ").concat(o)}];return c&&l.push({semantics:"FEC-FR",ssrcs:"".concat(s," ").concat(r)}),{ssrcs:d,ssrcGroups:l}};function an(t){return t.direction="inactive",t.port=0,delete t.ext,delete t.ssrcs,delete t.ssrcGroups,delete t.simulcast,delete t.simulcast_03,delete t.rids,delete t.extmapAllowMixed,delete t.msid,delete t.bundleOnly,t}const ao=function(t,e,i){let s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const o=I(I({},t),{},{media:[]});return s&&(o.invalid=[{value:"realx-exts:rscp"}]),e&&o.media.push(no(e)),i&&o.media.push(no(i)),delete o.groups,delete o.msidSemantic,VT(o)};function vO(t){const e={},{publicIPs:i,certFingerprint:s,iceParams:o,iceConfig:r}=t;return e.fingerprint={type:"sha-256",hash:s},e.icePwd=o.serverIcePwd,e.iceUfrag=fO(o.serverIceUfrag),e.candidates=gO(i,r),e.setup="active",e.iceOptions="renomination",e}function gO(t,e){if(!Array.isArray(t))return[];let i=0;const s=2130706431,o=[];return t.forEach((r=>{const n={component:1,ip:r.ip,type:"host",generation:r.generation};r.udpPorts&&!e.tcpOnly&&r.udpPorts.forEach((a=>{o.push(I(I({},n),{},{foundation:i++,transport:"udp",port:a,priority:s}))})),r.tcpPorts&&r.tcpPorts.forEach((a=>{o.push(I(I({},n),{},{foundation:i++,transport:"tcp",port:a,tcptype:"passive",priority:2130705431}))}))})),o}const fO=t=>{const e=new TextEncoder().encode("PREC"),i=ia(t),s=new Uint8Array(4);crypto.getRandomValues(s);const o=new Uint8Array(2);return o[0]=0,o[1]=1,dh(ba(Uint8Array,e,i,s,o))};var na=(t=>(t[t.kICEConfigTypeSrtpDtlsType=0]="kICEConfigTypeSrtpDtlsType",t[t.kICEConfigTypeRenominationType=1]="kICEConfigTypeRenominationType",t[t.kICEConfigTypeTcpType=2]="kICEConfigTypeTcpType",t[t.kICEConfigTypeMultiSendType=3]="kICEConfigTypeMultiSendType",t[t.kICEConfigTypeKcpType=4]="kICEConfigTypeKcpType",t[t.kICEConfigTypeSrtpSdesType=5]="kICEConfigTypeSrtpSdesType",t))(na||{});function cS(t){let{random:e,serverUfrag:i,serverPwd:s,clientPwd:o,options:r}=t,n=0;const a=new TextEncoder().encode("WPRE");n+=4,e||(e=new Uint8Array(4),crypto.getRandomValues(e)),n+=4;const c=ia(i);n+=1,n+=c.byteLength;const d=uY(ia(o),ia(s).subarray(0,16),ia(i).subarray(0,16));n+=1,n+=d.byteLength;const l=new Uint8Array(Object.keys(r).reduce(((p,h)=>{const _=Number(h);return p.push(_),p.push(r[_]?1:0),p}),[]));n+=l.byteLength;let u=ba(Uint8Array,a,e,[c.byteLength],c,[d.byteLength],d,l);return u.byteLength%3!=0&&(u=ba(Uint8Array,u,new Uint8Array(3-u.byteLength%3).fill(255))),[dh(u),dh(ba(Uint8Array,e,c.subarray(0,20)))]}const Ih=(t,e)=>{if(!Array.isArray(t.fmtp)||!Array.isArray(t.rtp))return;for(let s=0;s<t.rtp.length;s++)if(t.rtp[s].codec.toUpperCase()===e.toUpperCase()){t.rtp.unshift(t.rtp.splice(s,1)[0]);break}const i=[];t.rtp.forEach((s=>i.push(s.payload))),t.payloads=i.join(" ")},Oo=(t,e)=>{let i=0;if(!Array.isArray(t.fmtp)||!Array.isArray(t.rtp))return;for(const o of t.fmtp)if(o.config.includes("level-asymmetry-allowed=1")&&o.config.includes("packetization-mode=1")&&o.config.includes("profile-level-id=42e0")){i=o.payload;break}for(let o=0;o<t.rtp.length;o++){const r=t.rtp[o];if(e==="H264"){if(r.payload===i){t.rtp.unshift(t.rtp.splice(o,1)[0]);break}}else if(r.codec===e){t.rtp.unshift(t.rtp.splice(o,1)[0]);break}}const s=[];t.rtp.forEach((o=>s.push(o.payload))),t.payloads=s.join(" ")},ZO=t=>{const e=z.parse(t);return e.media=e.media.map((i=>i.type==="audio"?IO(i,e):TO(i,["H264","VP8","ByteVC1"],e))),z.write(e)},Mi=t=>{t.media.forEach((e=>{e.type!=="audio"&&e.type!=="video"||e.rtp.forEach((i=>{e.rtcpFb||(e.rtcpFb=[]),e.rtcpFb.find((s=>s.payload===i.payload&&s.type==="rrtr"))||e.rtcpFb.push({payload:i.payload,type:"rrtr"})}))}))},TO=function(t,e,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{rrtr:!1};const o={},r={};let n=-1;const a=[];return Array.isArray(t.fmtp)&&t.fmtp.forEach((c=>{let{payload:d,config:l}=c;if(l.startsWith("apt=")){const u=l.slice(4);o[d]=u}else l.includes("42e0")&&l.includes("packetization-mode=1")&&(n=d)})),Array.isArray(t.rtp)&&(t.rtp=t.rtp.filter((c=>{const d=c.codec,l=c.payload;let u;switch(d){case"H264":return u=!1,e.map((p=>{p==="H264"&&l===n&&(r[l]=l,a.push(l),u=!0)})),u;case"rtx":return!!r[o[l]]&&(r[l]=l,!0);case"red":case"ulpfec":case"flexfec-03":return r[l]=l,!0;default:return u=!1,e.map((p=>{p===d&&(r[l]=l,a.push(l),u=!0)})),u}}))),Array.isArray(t.fmtp)&&(t.fmtp=t.fmtp.filter((c=>r[c.payload]))),Array.isArray(t.rtcpFb)?t.rtcpFb=t.rtcpFb.filter((c=>r[c.payload])):t.rtcpFb=[],s.rrtr&&a.forEach((c=>{var d;(d=t.rtcpFb)===null||d===void 0||d.push({payload:c,type:"rrtr"})})),GT(t,i),Array.isArray(t.ext)&&(t.ext=t.ext.filter((c=>{if(c.uri!=="http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"&&c.uri!=="http://www.webrtc.org/experiments/rtp-hdrext/video-timing"&&c.uri!=="http://www.webrtc.org/experiments/rtp-hdrext/color-space")return c}))),typeof t.payloads=="string"&&(t.payloads=t.payloads.split(" ").filter((c=>r[c])).join(" ")),t},IO=function(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{rrtr:!1};const s={};if(Array.isArray(t.rtp)&&(t.rtp=t.rtp.filter((o=>{const r=o.codec,n=o.payload;return(r==="opus"||r==="red")&&(s[n]=n,!0)}))),Array.isArray(t.rtcpFb)||(t.rtcpFb=[]),i.rrtr&&Object.keys(s).forEach((o=>{var r;(r=t.rtcpFb)===null||r===void 0||r.push({payload:Number(o),type:"rrtr"})})),GT(t,e),typeof t.payloads=="string"){const o=[];t.payloads.split(" ").forEach((r=>{s[r]&&o.push(r)})),t.payloads=o.join(" ")}return t},GT=(t,e)=>{t.iceOptions&&delete t.iceOptions,t.icePwd&&(e.icePwd=t.icePwd,delete t.icePwd),t.iceUfrag&&(e.iceUfrag=t.iceUfrag,delete t.iceUfrag),t.fingerprint&&(e.fingerprint=t.fingerprint,delete t.fingerprint)},VT=t=>ET(t,"H265","ByteVC1"),Pp=t=>ET(t,"ByteVC1","H265"),ET=(t,e,i)=>{const s=typeof t=="string"?z.parse(t):t;return s.media=s.media.map((o=>(o.type==="video"&&(o.rtp=o.rtp.map((r=>(r.codec===e&&(r.codec=i),r)))),o))),z.write(s)};function Gr(t,e){const i=new Error().stack;if(!t){No("[DCHECK FAILED] ".concat(e),-1,{stack:i});for(var s=arguments.length,o=new Array(s>2?s-2:0),r=2;r<s;r++)o[r-2]=arguments[r];throw console.error("[DCHECK FAILED]",e,...o),new Error("[DCHECK FAILED], ".concat(e))}}const RO=cs(),XO={iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};var PT=(t=>(t[t.DC_ERROR=0]="DC_ERROR",t[t.DC_CLOSE=1]="DC_CLOSE",t[t.ICE_FAILED=2]="ICE_FAILED",t[t.DESTROY=3]="DESTROY",t[t.TIMEOUT=4]="TIMEOUT",t))(PT||{});let CO=0;class Zc extends Vt{constructor(e,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];super(),m(this,"uuid",(CO++).toString()),m(this,"_peerConnectionId",""),m(this,"audioTrack4ff",void 0),m(this,"_pc",void 0),m(this,"_dc",void 0),m(this,"_iceNode",void 0),m(this,"_initSctpEvents",!1),m(this,"_monitor",void 0),m(this,"_offerIce",{}),m(this,"_answerIce",{}),m(this,"_offerSession",void 0),m(this,"_answerSession",void 0),m(this,"_offerMlines",[]),m(this,"_answerMlines",[]),m(this,"_connectReject",void 0),m(this,"_closeManually",!1),m(this,"_logger",void 0),m(this,"_destroyed",!1),m(this,"_reportTimer",void 0),m(this,"_onLineCheckerTimer",void 0),m(this,"_clearPeerListeners",void 0),m(this,"_peerConfig",void 0),m(this,"_iceStartTs",0),m(this,"_icePreStepTs",0),this._ctx=e,this._groupConnectionId=i,this._isReconnect=s,this._monitor=ke(e.id),this._logger=new ue("PeerConnection_".concat(this.uuid),4,e.id),this._ctx.enableFallbackHandler&&this._logger.warn("ctor","PeerConnection running in fallback mode"),this._peerConfig=LO(e),this._pc=new RTCPeerConnection(this._peerConfig),this._pc.ontrack=o=>{var r;const n=(r=o.streams)===null||r===void 0||(r=r[0])===null||r===void 0?void 0:r.id;this._print("pc.ontrack","".concat(o.track.kind," ").concat(o.track.id," ").concat(n)),n==="ff-stream"&&(this.audioTrack4ff=o.track),this.emit("ontrack",o)},this._pc.onconnectionstatechange=()=>{this._print("onconnectionstatechange","".concat(this._pc.connectionState,". ice -> ").concat(this._pc.iceConnectionState)),this._pc.iceConnectionState!=="failed"&&this._pc.iceConnectionState!=="closed"&&this._pc.connectionState!=="failed"||this.emit("disconnect",ut.ICE_FAILED),this._pc.connectionState==="disconnected"&&(navigator.onLine?this.emit("disconnect",ut.ICE_FAILED):this._onLineCheckerTimer=setInterval((()=>{navigator.onLine&&(clearInterval(this._onLineCheckerTimer),this.emit("disconnect",ut.ICE_FAILED))}),1e3)),this._pc.connectionState!=="connecting"&&this._pc.connectionState!=="connected"||clearInterval(this._onLineCheckerTimer)},this._pc.oniceconnectionstatechange=()=>{const o=this._pc.iceConnectionState;this._report("rtc_pre_ice_state",{message:o,ice_state:o.toUpperCase()}),this.emit("ice_state",o)}}static checkSupported(){if(!RTCPeerConnection)throw new G(C.NOT_SUPPORTED,"missing RTCPeerConnection API.");["addTransceiver","createDataChannel","createOffer","setLocalDescription","setRemoteDescription"].forEach((e=>{var i;if((i=RTCPeerConnection)===null||i===void 0||(i=i.prototype)===null||i===void 0||!i[e])throw new G(C.NOT_SUPPORTED,"missing peer.".concat(e," API."))}))}getOriginRTCPeerConnection(){return this._pc}getConnectionId(){return this._peerConnectionId}getGroupConnectionId(){return this._groupConnectionId}getIceConnectionState(){return this._pc.iceConnectionState}async createOfferSdp(){let{sdp:e}=await this._pc.createOffer();return e}_reportFailureIPCallback(){var e;this.emit("join_room_failed_private_callback",hY((e=this._iceNode)===null||e===void 0?void 0:e.publicIPs))}async startIceConnect(e){if(this._ctx.enableStandardHandler)return this.startIceConnectStandard(e);this.emit("__startIceConnect_hook",e),this._print("connect","invoke. %o",e),this._iceNode=e,this._closeManually=!1;const i=this._pc.createDataChannel("signaling",{negotiated:!0,id:100});i.binaryType="arraybuffer",this._dc=i;const{offerIce:s,answerIce:o}=this._genIceInfo(e);this._offerIce=s,this._answerIce=o,Te&&Zs<138&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"}));const r=await this.createOfferSdp();if(!r)throw new G(C.NOT_SUPPORTED,"create offer sdp failed.");const n=z.parse(r);this._peerConnectionId=o.iceUfrag||"";const a=!s.iceUfrag&&!s.icePwd;if(a){var c,d;const u=((c=n.media[0])===null||c===void 0?void 0:c.iceOptions)==="renomination"||!this._ctx.enableFallbackHandler&&this._ctx.pcKillSwitch.sld_iceoption_renomination;u||(delete s.iceOptions,delete o.iceOptions),delete s.iceUfrag,delete s.icePwd;const[p,h]=cS({serverUfrag:e.iceParams.serverIceUfrag,serverPwd:e.iceParams.serverIcePwd,clientPwd:(d=n.media[0])===null||d===void 0?void 0:d.icePwd,options:{[na.kICEConfigTypeSrtpDtlsType]:!0,[na.kICEConfigTypeRenominationType]:u}});this._peerConnectionId=h,o.iceUfrag=p,this._logger.info("use serverUfrag v2",JSON.stringify({dtls:!0,renomination:u}))}this.reportRtcPreIce("ice_start");const[l]=n.media;if(this._offerIce.fingerprint=n.fingerprint||l.fingerprint,Te||this._ctx.enableFallbackHandler){n.media=n.media.map((p=>{const h=I(I({},p),this._offerIce);var _,y,b,S;return h.type==="video"&&(qr?(h.ext=(_=h.ext)===null||_===void 0?void 0:_.filter((v=>v.uri.indexOf("abs-send-time")===-1)),h.rtcpFb=(y=h.rtcpFb)===null||y===void 0?void 0:y.filter((v=>v.type!=="goog-remb"))):(h.rtcpFb=(b=h.rtcpFb)===null||b===void 0?void 0:b.filter((v=>v.type!=="transport-cc")),h.ext=(S=h.ext)===null||S===void 0?void 0:S.filter((v=>v.uri.indexOf("transport")===-1)))),h})),ii&&Mi(n);const u=I({},n);u.fingerprint=this._answerIce.fingerprint,u.media=u.media.map((p=>(delete(p=I(I({},p),this._answerIce)).bundleOnly,p.port=9,p.type==="application"?p.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}:(p.type==="audio"&&(p.msid="ff-stream ff-stream-audio"),p.direction="sendonly"),p))),ii&&Mi(u),this._ctx.enableFallbackHandler?await this.setLocalDescription(r):await this.setLocalDescription(z.write(n)),await this.setRemoteDescription(z.write(u))}else{delete n.media,this._offerSession=I({},n),this._answerSession=I({},n),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint);const u=0;a&&(this._offerIce.iceUfrag=l.iceUfrag,this._offerIce.icePwd=l.icePwd),this._offerMlines=[I(I(I({},l),this._offerIce),{},{mid:"".concat(u)})],this._answerMlines=[I(I(I({},l),this._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144},mid:"".concat(u)})],this.setDescription()}return this._reportTransportStats(),await new Promise(((u,p)=>{this._connectReject=p;const h=setTimeout((()=>{var f;this.reportRtcPreIce("timeout"),this._reportFailureIPCallback(),(f=this._connectReject)===null||f===void 0||f.call(this,{code:4,message:"connect timeout"}),delete this._connectReject}),8e3),_=()=>{this._print("connect","dataChannel open"),this._reportRtcInvokeStatus("es.dc.open",""),this.reportRtcPreIce("datachannel_opened"),clearTimeout(h),u(""),delete this._connectReject},y=f=>{var g,Z,R,T;this._report("rtc_signaling_msg_error",{error_code:f==null||(g=f.error)===null||g===void 0?void 0:g.sdpLineNumber,message:f==null||(Z=f.error)===null||Z===void 0?void 0:Z.errorDetail,reason:"invalid data"}),this._reportRtcInvokeStatus("es.dc.error",""),this._reportFailureIPCallback(),(R=this._connectReject)===null||R===void 0||R.call(this,{message:"dc.onerror, ".concat((T=f.error)===null||T===void 0?void 0:T.errorDetail),code:0}),this.emit("disconnect",ut.DC_ERROR),delete this._connectReject,clearTimeout(h)},b=()=>{var f;this._reportRtcInvokeStatus("es.dc.close",""),this._closeManually||this._reportFailureIPCallback(),(f=this._connectReject)===null||f===void 0||f.call(this,{message:"dc.onclose",code:1}),this.reportRtcPreIce("datachannel_closed"),this.emit("disconnect",ut.DC_CLOSE),delete this._connectReject,clearTimeout(h)},S=()=>{this._pc.iceConnectionState==="connected"?this.reportRtcPreIce("ice_connected"):this._pc.iceConnectionState!=="failed"&&this._pc.iceConnectionState!=="closed"||(this._reportFailureIPCallback(),this.reportRtcPreIce("ice_failed"))},v=()=>{var f;this._pc.iceConnectionState!=="failed"&&this._pc.iceConnectionState!=="closed"&&this._pc.connectionState!=="failed"||(this._reportFailureIPCallback(),(f=this._connectReject)===null||f===void 0||f.call(this,{message:"pc.connectionstatechange -> ".concat(this._pc.connectionState,", ice -> ").concat(this._pc.iceConnectionState),code:2}),delete this._connectReject,clearTimeout(h))};i.addEventListener("open",_),i.addEventListener("error",y),i.addEventListener("close",b),this._pc.addEventListener("iceconnectionstatechange",S),this._pc.addEventListener("connectionstatechange",v),this._clearPeerListeners=()=>{i.removeEventListener("open",_),i.removeEventListener("error",y),i.removeEventListener("close",b),this._pc.removeEventListener("iceconnectionstatechange",S),this._pc.removeEventListener("connectionstatechange",v)}})),this._print("connect","dataChannel establish success"),i}async startIceConnectStandard(e){this._print("connect","standard invoke. %o",e),this._iceNode=e;const i=this._pc.createDataChannel("signaling",{negotiated:!0,id:100});i.binaryType="arraybuffer",this._dc=i;const{offerIce:s,answerIce:o}=this._genIceInfo(e);this._offerIce=s,this._answerIce=o,Te&&Zs<138&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"}));const r=await this.createOfferSdp();if(!r)throw new G(C.NOT_SUPPORTED,"create offer sdp failed.");const n=z.parse(r);this._answerSession=I({},n),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint);const a=n.media.find((d=>d.type==="application"));if(this._peerConnectionId=o.iceUfrag||"",!s.iceUfrag&&!s.icePwd){const d=this._ctx.pcKillSwitch.sld_iceoption_renomination||a?.iceOptions==="renomination";d||(delete s.iceOptions,delete o.iceOptions),delete s.iceUfrag,delete s.icePwd;const[l,u]=cS({serverUfrag:e.iceParams.serverIceUfrag,serverPwd:e.iceParams.serverIcePwd,clientPwd:a?.icePwd,options:{[na.kICEConfigTypeSrtpDtlsType]:!0,[na.kICEConfigTypeRenominationType]:d}});this._peerConnectionId=u,o.iceUfrag=l,this._logger.info("use serverUfrag v2",JSON.stringify({dtls:!0,renomination:d}))}this.reportRtcPreIce("ice_start"),this._offerIce.fingerprint=n.fingerprint||a.fingerprint;const c=I({},n);return c.fingerprint=this._answerIce.fingerprint,c.media=c.media.map((d=>{if((d=I(I({},d),this._answerIce)).type==="application"&&(d.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}),Te){if(delete d.bundleOnly,d.port=9,d.type==="audio")d.msid="ff-stream ff-stream-audio",d.direction="sendonly";else if(d.type==="video"){var l,u,p,h;qr?(d.ext=(l=d.ext)===null||l===void 0?void 0:l.filter((_=>_.uri.indexOf("abs-send-time")===-1)),d.rtcpFb=(u=d.rtcpFb)===null||u===void 0?void 0:u.filter((_=>_.type!=="goog-remb"))):(d.rtcpFb=(p=d.rtcpFb)===null||p===void 0?void 0:p.filter((_=>_.type!=="transport-cc")),d.ext=(h=d.ext)===null||h===void 0?void 0:h.filter((_=>_.uri.indexOf("transport")===-1))),d.direction="sendonly"}}return d})),this.getIceVersion()==="v1"||this._ctx.pcKillSwitch.sld_iceoption_renomination?(n.media=n.media.map((d=>d=I(I({},d),this._offerIce))),await this.setLocalDescription(z.write(n))):await this.setLocalDescription(r),await this.setRemoteDescription(z.write(c)),this._reportTransportStats(),await new Promise(((d,l)=>{this._connectReject=l;const u=setTimeout((()=>{var S;this.reportRtcPreIce("timeout"),(S=this._connectReject)===null||S===void 0||S.call(this,{code:4,message:"connect timeout"}),delete this._connectReject}),8e3),p=()=>{this._print("connect","dataChannel open"),this._reportRtcInvokeStatus("es.dc.open",""),this.reportRtcPreIce("datachannel_opened"),clearTimeout(u),d(""),delete this._connectReject},h=S=>{var v,f,g,Z;this._report("rtc_signaling_msg_error",{error_code:S==null||(v=S.error)===null||v===void 0?void 0:v.sdpLineNumber,message:S==null||(f=S.error)===null||f===void 0?void 0:f.errorDetail,reason:"invalid data"}),this._reportRtcInvokeStatus("es.dc.error",""),(g=this._connectReject)===null||g===void 0||g.call(this,{message:"dc.onerror, ".concat((Z=S.error)===null||Z===void 0?void 0:Z.errorDetail),code:0}),this.emit("disconnect",ut.DC_ERROR),delete this._connectReject,clearTimeout(u)},_=()=>{var S;this._reportRtcInvokeStatus("es.dc.close",""),(S=this._connectReject)===null||S===void 0||S.call(this,{message:"dc.onclose",code:1}),this.reportRtcPreIce("datachannel_closed"),this.emit("disconnect",ut.DC_CLOSE),delete this._connectReject,clearTimeout(u)},y=()=>{this._pc.iceConnectionState==="connected"?this.reportRtcPreIce("ice_connected"):this._pc.iceConnectionState!=="failed"&&this._pc.iceConnectionState!=="closed"||this.reportRtcPreIce("ice_failed")},b=()=>{var S;this._pc.iceConnectionState!=="failed"&&this._pc.iceConnectionState!=="closed"&&this._pc.connectionState!=="failed"||((S=this._connectReject)===null||S===void 0||S.call(this,{message:"pc.connectionstatechange -> ".concat(this._pc.connectionState,", ice -> ").concat(this._pc.iceConnectionState),code:2}),delete this._connectReject,clearTimeout(u))};i.addEventListener("open",p),i.addEventListener("error",h),i.addEventListener("close",_),this._pc.addEventListener("iceconnectionstatechange",y),this._pc.addEventListener("connectionstatechange",b),this._clearPeerListeners=()=>{i.removeEventListener("open",p),i.removeEventListener("error",h),i.removeEventListener("close",_),this._pc.removeEventListener("iceconnectionstatechange",y),this._pc.removeEventListener("connectionstatechange",b)}})),this._print("connect","dataChannel establish success"),i}async setDescription(e){this._print("setDescription","invoke."),this._offerSession.media=this._offerMlines,this._answerSession.media=this._answerMlines;const i=[];this._offerMlines.forEach((o=>{o.direction!=="inactive"&&o.mid&&i.push(o.mid)})),this._offerSession.groups&&this._answerSession.groups&&(this._offerSession.groups[0].mids=i.join(" "),this._answerSession.groups[0].mids=i.join(" "));const s=ee();e&&this._report("rtc_begin_create_offer",{direction:e.streamUserId==="local"?"up":"down",stream_id:e.streamId,stream_user_id:e.streamUserId,pc_session_id:this._peerConnectionId,vendor_mode:0}),e&&this._report("rtc_create_offer",{error_code:0,direction:e.streamUserId==="local"?"up":"down",stream_id:e.streamId,stream_user_id:e.streamUserId,elapse:ee()-s}),await this.setLocalDescription(z.write(this._offerSession),e),await this.setRemoteDescription(z.write(this._answerSession),e)}async setLocalDescription(e,i){const s=ee();try{if(await this._pc.setLocalDescription({type:"offer",sdp:e}),this._report("rtc_set_description",{error_code:0,message:e,is_local:"1",direction:i?.streamUserId==="local"?"up":"down",stream_id:i?.streamId||"",stream_user_id:i?.streamUserId||"",elapse:ee()-s},{type:"offer"}),!this._initSctpEvents){var o;this._initSctpEvents=!0;const r=(o=this._pc)===null||o===void 0?void 0:o.sctp;r&&(r.onstatechange=()=>{this._reportRtcInvokeStatus("sctp","sctp state change TO: ".concat(r.state))},r.transport&&(r.transport.onstatechange=()=>{var n;this._reportRtcInvokeStatus("dtls","dtls state change TO: ".concat(r==null||(n=r.transport)===null||n===void 0?void 0:n.state))}))}}catch(r){throw console.error("setLocal",r),this._report("rtc_set_description",{error_code:-1,message:r.message+e,is_local:"1",direction:i?.streamUserId==="local"?"up":"down",stream_id:"",stream_user_id:"",elapse:ee()-s},{type:"offer"}),r}}async setRemoteDescription(e,i){const s=ee();try{await this._pc.setRemoteDescription({type:"answer",sdp:e}),this._report("rtc_set_description",{error_code:0,message:e,is_local:"0",direction:i?.streamUserId==="local"?"up":"down",stream_id:i?.streamId||"",stream_user_id:i?.streamUserId||"",elapse:ee()-s},{type:"answer"})}catch(o){throw console.error("setRemote",o),this._report("rtc_set_description",{error_code:-1,message:o.message+e,is_local:"0",direction:i?.streamUserId==="local"?"up":"down",stream_id:i?.streamId||"",stream_user_id:i?.streamUserId||"",elapse:ee()-s},{type:"answer"}),o}}closeIceConnect(){var e,i,s,o;this._closeManually=!0,(e=this._connectReject)===null||e===void 0||e.call(this,{code:3,message:"invoke destroy()"}),delete this._connectReject,this._closeManually=!0,(i=this._pc)===null||i===void 0||i.close(),(s=this._dc)===null||s===void 0||s.close(),delete this._dc,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,dO(this._pc),(o=this._clearPeerListeners)===null||o===void 0||o.call(this),delete this._clearPeerListeners}reportRtcPreIce(e){var i;const s=ee();e==="ice_start"&&(this._iceStartTs=s,this._icePreStepTs=s),this._report("rtc_pre_ice",{connect_event:e,message:e,elapse:s-this._icePreStepTs,total_elapse:s-this._iceStartTs,cache_status:!((i=this._iceNode)===null||i===void 0||!i.cache_status),is_reconnect:this._isReconnect}),this._icePreStepTs=s}getStatsWithLowFrequency(e,i,s){return aO(this._pc,e,i,s)}getIceVersion(){var e,i;return(e=this._iceNode)!==null&&e!==void 0&&e.iceParams.clientIceUfrag||(i=this._iceNode)!==null&&i!==void 0&&i.iceParams.clientIcePwd?"v1":"v2"}createAnswerSdp(e,i){Gr(this._answerSession,"_answerSession should be existed");const s=I({},this._answerSession);return s.media=e,s.groups=i,z.write(s)}destroy(){this._print("destroy",this._peerConnectionId),super.removeAllListeners(),this.closeIceConnect(),this._destroyed=!0,this._reportTimer&&(clearTimeout(this._reportTimer),delete this._reportTimer),this._onLineCheckerTimer&&(clearInterval(this._onLineCheckerTimer),delete this._onLineCheckerTimer),delete this._pc}_genIceInfo(e){var i,s;return{offerIce:{iceUfrag:(i=e.iceParams)===null||i===void 0?void 0:i.clientIceUfrag,icePwd:(s=e.iceParams)===null||s===void 0?void 0:s.clientIcePwd,iceOptions:"renomination"},answerIce:vO(e)}}async _reportTransportStats(){const e=await this.getStatsWithLowFrequency(),i={};var s;if(e.forEach((o=>{o.type==="transport"?(i.dtls_state=o.dtlsState,i.bytes_received=o.bytesReceived,i.bytes_sent=o.bytesSent,i.ice_state=o.iceState,i.packets_received=o.packetsReceived,i.packets_sent=o.packetsSent,i.selected_candidate_pair_changes=o.selectedCandidatePairChanges):o.type==="local-candidate"||o.type==="remote-candidate"?i.candidates_info=[...i.candidates_info||[],{id:o.id,is_remote:o.isRemote,port:o.port,protocol:o.protocol,candidate_type:o.candidateType,priority:o.priority,network_type:o.networkType,candidate_ip:o.ip}]:o.type==="candidate-pair"&&(i.candidatePairsInfo={},i.candidatePairsInfo.candidate_state=o.state,i.candidatePairsInfo.writable_state=o.writable,i.candidatePairsInfo.sent_ping_requests_total=o.requestsSent,i.candidatePairsInfo.recv_ping_requests=o.requestsReceived,i.candidatePairsInfo.sent_ping_responses=o.responsesSent,i.candidatePairsInfo.recv_ping_responses=o.responsesReceived,i.candidatePairsInfo.current_rtt=o.currentRoundTripTime,i.candidatePairsInfo.total_rtt=o.totalRoundTripTime,["localCandidateId","remoteCandidateId","bytesSent","bytesReceived","availableOutgoingBitrate","availableIncomingBitrate","bytesDiscardedOnSend","consentRequestsSent","packetsDiscardedOnSend","lastPacketReceivedTimestamp","lastPacketSentTimestamp"].forEach((r=>{o[r]!==void 0&&(i.candidatePairsInfo[bO(r)]=o[r])})))})),Object.keys(i).length>0&&((s=this._monitor)===null||s===void 0||s.report("rtc_transport_statistics",i)),!this._destroyed){const o=this._pc.iceConnectionState==="connected"&&this._pc.connectionState==="connected";this._reportTimer=setTimeout((()=>{this._reportTransportStats()}),o?5e3:1e3)}}_print(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];this._logger.info("".concat(e),...s)}_report(e,i,s){var o,r,n;(o=this._monitor)===null||o===void 0||o.report(e,I(I({},i),{},{connection_id:this._peerConnectionId,group_connection_id:this._groupConnectionId}),I(I({},s),{},{tcp_only:(r=this._iceNode)===null||r===void 0?void 0:r.iceConfig.tcpOnly,ms_addr:JSON.stringify(((n=this._iceNode)===null||n===void 0?void 0:n.publicIPs.map((a=>({ip:a.ip,tcp:a.tcpPorts,udp:a.udpPorts}))))||[])}))}_reportRtcInvokeStatus(e,i){this._report("rtc_invoke_status",{sdk_api_name:e,message:i,error_code:0,stream_id:"",elapse:0})}}const LO=t=>{const e=I({},XO);return t.pcKillSwitch.ctor_sdpsemantics_add&&(e.sdpSemantics="unified-plan"),t.pcKillSwitch.ctor_encodedinsetablestream_add&&RO&&!ae("DISABLE_ENCODED_TRANSFORM")&&(e.encodedInsertableStreams=!0),e};var Hs=(t=>(t[t.SEND=0]="SEND",t[t.FEEDBACK=1]="FEEDBACK",t))(Hs||{}),Np=(t=>(t[t.P2P=0]="P2P",t[t.SIGNAL=1]="SIGNAL",t[t.BROADCAST=2]="BROADCAST",t[t.BUSINESS_SERVER=3]="BUSINESS_SERVER",t))(Np||{}),Rh=(t=>(t[t.SUCCESS=0]="SUCCESS",t[t.TIMEOUT=1]="TIMEOUT",t[t.BROKEN=2]="BROKEN",t[t.NO_RECEIVER=3]="NO_RECEIVER",t[t.NO_RELAYPATH=4]="NO_RELAYPATH",t[t.EXCEED_QPS=5]="EXCEED_QPS",t[t.SEND_TO_SERVER_ERROR=17]="SEND_TO_SERVER_ERROR",t[t.SERVER_RESPONSE_ERROR=18]="SERVER_RESPONSE_ERROR",t[t.NOT_JOIN=100]="NOT_JOIN",t[t.NOT_LOGIN=105]="NOT_LOGIN",t[t.SERVER_PARAMS_NOTSET=106]="SERVER_PARAMS_NOTSET",t[t.UNKNOWN=1e3]="UNKNOWN",t))(Rh||{});const WO={0:[0,"success"],1:[C.USER_MESSAGE_TIMEOUT,"timeout, failed to send."],2:[C.USER_MESSAGE_BROKEN,"dataChannel broken, failed to send."],3:[C.USER_MESSAGE_NO_RECEIVER,"cannot find the receiver."],4:[C.USER_MESSAGE_NO_RECEIVER,"cannot find relay path."],5:[C.USER_MESSAGE_EXCEED_QPS,"cannot find relay path."],17:[C.USER_MESSAGE_SEND_TO_SERVER_ERROR,"failed to send to business server."],18:[C.USER_MESSAGE_SERVER_RESPONSE_ERROR,"business server response error."],100:[C.USER_MESSAGE_NOT_JOIN,"not join room"],105:[C.USER_MESSAGE_NOT_LOGIN,"not login."],106:[C.USER_MESSAGE_SERVER_PARAMS_NOTSET,"server param is not set."],1e3:[C.USER_MESSAGE_UNKNOWN,"unknown."]},GO=["msg"],lS=[],VO=[O.ENGINE_CONTROL_MESSAGE];var Lo=(t=>(t[t.C2S=0]="C2S",t[t.C2C=1]="C2C",t[t.C2GW=2]="C2GW",t[t.C2CDirect=3]="C2CDirect",t[t.C2RTM=4]="C2RTM",t))(Lo||{});class EO extends Ai.EventEmitter{constructor(e,i,s){super(),m(this,"_singlingCache",new Map),m(this,"_p2pCache",new Map),m(this,"_rttIds",{}),m(this,"_p2pMessageId",new cY),m(this,"_clearDataChannelListener",void 0),m(this,"_monitor",void 0),m(this,"logger",void 0),this.id=e,this._dataChannel=i,this.connectionIds=s,this._clearDataChannelListener=this._handleHandler(),this._monitor=ke(e),this.logger=new ue("DataChannelSignaling",3,e)}destroy(){this._clearDataChannelListener(),delete this._dataChannel,this._singlingCache.forEach(((e,i)=>{e.error(new G(C.OPERATION_CANCEL,"disconnect")),this._singlingCache.delete(i)})),this._singlingCache.clear(),this._p2pCache.clear(),this._rttIds={}}sendSignaling(e,i,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6e4;return new Promise(((r,n)=>{var a;const c=this._genHeader(s);c.id=Qy();const d=c.id.join("-"),l=I({error_code:0,message:JSON.stringify(i),signaling_event:"call-".concat(e),signaling_type:"Send",stream_id:i.streamId,stream_user_id:i.streamUserId,direction:"up",event_session_id:d},this.connectionIds);(a=this._monitor)===null||a===void 0||a.report("rtc_signaling",l);const u=e==="customMessage";u&&Je.samplingOne2ManyMsg(this.id,Number(c.id.join("")),i);const p=setTimeout((()=>{this._singlingCache.delete(d),n(new G(C.TIME_OUT,"".concat(e," message time out"))),u&&Je.updateOne2ManyMsgAck(this.id,i,999)}),o);this._singlingCache.set(d,{start:ee(),signalingType:e,success:h=>{clearTimeout(p),r(h),u&&Je.updateOne2ManyMsgAck(this.id,i,0)},error:h=>{clearTimeout(p),n(h),u&&Je.updateOne2ManyMsgAck(this.id,i,h.code)},id:d}),this.logger.info("Signal",">>>>>> [".concat(e,"{").concat(c.functionType,"}][").concat(d,"]"),i),this._sendMessage(e,c,i)}))}sendPingSignaling(){return this.sendSignaling("CheckConnectivity",{ts:Date.now()},{functionType:2})}async sendP2PMessage(e,i){let{msg:s}=e,o=bo(e,GO);const r=s instanceof ArrayBuffer;return this._sendP2PMessage(Je.samplingP2PMsg(this.id,I(I({ver:1,id:this._p2pMessageId.getMessageId(),time:Date.now(),dir:Hs.SEND,type:Np.P2P,err:Rh.SUCCESS},o),{},{binary:r,msg:r?await $e.ab2b64str(s):s})),i)}_sendP2PMessage(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this._genHeader(I(I({needAck:!0,functionType:1},i),{},{id:Qy()}));return Iu(e.msg)?this._rttIds[e.id]=e.id:e.dir===Hs.SEND&&this.logger.info("_sendP2PMessage [DC Signaling p2p{".concat(s.functionType,"} >>]"),JSON.stringify(e)),new Promise(((o,r)=>{if(e.dir===Hs.SEND){const n=setTimeout((()=>{this._p2pCache.delete(e.id),r(new G(C.USER_MESSAGE_TIMEOUT,"P2P message timeout")),Je.updateP2PMsgAck(this.id,e,999)}),12e3);this._p2pCache.set(e.id,{success:(a,c)=>{clearTimeout(n),o(c),Je.updateP2PMsgAck(this.id,e,0)},error:a=>{clearTimeout(n),Je.updateP2PMsgAck(this.id,e,a.err);const[c,d]=WO[a.err]||[C.USER_MESSAGE_UNKNOWN,"err: ".concat(a.err,", msg: ").concat(a.msg)];r({err:a.err,code:c,message:a.msg||d})}})}try{this._sendMessage("p2p",s,e)}catch(n){throw n.code===C.NOT_CONNECTED_YET&&(n.code=C.USER_MESSAGE_BROKEN),n}}))}_sendMessage(e,i,s){if(!this._dataChannel||this._dataChannel.readyState!=="open")throw new G(C.NOT_CONNECTED_YET,"DataChannel not open");const o=ae("SIGNAL_COMPRESSION")||i.zip,r=i.version+(Number(o)<<4)+(Number(i.encrypt)<<5),n=Number(i.needAck)+(Number(i.direction)<<1)+(Number(i.functionType)<<2)+(Number(i.binary)<<6),a=$e.str2ab(JSON.stringify([e,s])),c=ba(Uint8Array,[r,n,...i.id||[]],o||i.zip?nh.deflate(new Uint8Array(a)):new Uint8Array(a));try{this._dataChannel.send(c.buffer)}catch(l){var d;throw(d=this._monitor)===null||d===void 0||d.report("rtc_error",{message:"datachannel send error: ".concat(l.message),error_code:At.DC_SEND_ERROR}),l}e==="p2p"?Je.updateP2PMsgReq(this.id,s,c.buffer.byteLength):e==="customMessage"&&Je.updateOne2ManyMsgReq(this.id,s,c.buffer.byteLength)}_dispartData(e){const i=new Uint8Array(e);let s=0;const o=i[s++],r=i[s++],n={version:15&o,zip:!(16&~o),encrypt:!(32&~o),needAck:!(1&~r),direction:(2&r)>>1,functionType:(60&r)>>2,binary:!(64&~r)};if(n.needAck||n.direction===1){for(;s<=6;s++)if(!sY(i[s])){s++;break}n.id=Array.from(i.slice(2,s))}return{header:n,data:i.slice(s)}}_feedbackSignaling(e,i,s){const o=this._genHeader({needAck:!0,direction:1,id:e.split("-").map((r=>Number(r)))});lS.includes(i)||this.logger.info("Signal",">>>>>> [".concat(i,"-res][").concat(e,"]")),this._sendMessage("".concat(i,"-res"),o,s)}async _handleMessage(e){const i=Date.now(),{byteLength:s}=e,o=this._dispartData(e);let{data:r}=o;const{header:n}=o;if(n.zip){const l=new nh.Inflate;l.push(r,!0),r=l.result}const a=$e.ab2str(r);let c=[];try{c=JSON.parse(a)}catch(l){var d;l instanceof Error&&((d=this._monitor)===null||d===void 0||d.report("rtc_signaling_msg_error",I({error_code:-1,message:l.message,reason:"message parse failed"},this.connectionIds)));return}switch(n.functionType){case 0:case 4:this.C2S(n,c,a,s,i);break;case 1:this.C2C(c,s,i);break;case 2:this.C2GW(n,c,a)}}async C2S(e,i,s,o,r){var n;const a=((n=e.id)===null||n===void 0?void 0:n.join("-"))||"";if(e.direction===1)this._handleAckMessage(a,i[0]||{},s,e.functionType);else if(Array.isArray(i)){var c;const d=i[0];i=i[1],lS.includes(d)||this.logger.info("Signal","<<<<<< ".concat(d,"{").concat(e.functionType,"}"),i,a),VO.includes(d)||this._feedbackSignaling(a,d,d===O.ON_CUSTOM_MESSAGE?I(I({},i),{},{message:""}):""),i.binary&&typeof i.message=="string"&&(i.message=await $e.b64str2ab(i.message,this._monitor));const l=Date.now();this.emit(d,I({},i)),d===O.ON_CUSTOM_MESSAGE&&Je.reportOne2ManyMsgRecv(this.id,i,{msg_size:o,recv_msg_ts:r,fwd_msg_ts:l}),(c=this._monitor)===null||c===void 0||c.report("rtc_signaling",I({error_code:0,message:s,signaling_event:"on-".concat(d),signaling_type:"Recv",stream_id:i.streamId,stream_user_id:i.clientId,direction:"down"},this.connectionIds))}}async C2C(e,i,s){var o,r,n,a;Array.isArray(e)&&(e=e[1]);const c=(o=e)===null||o===void 0?void 0:o.id;switch(this._rttIds[c]||((r=e)===null||r===void 0?void 0:r.dir)===Hs.FEEDBACK||Iu((n=e)===null||n===void 0?void 0:n.msg)?delete this._rttIds[c]:this.logger.info("Signal","<<<<<< p2p response",e),e.dir){case Hs.SEND:const d=Date.now();if(!Iu((a=e)===null||a===void 0?void 0:a.msg)){const{binary:l,msg:u,room:p,to:h,from:_}=e,y=p===""?l?O.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM:O.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM:l?O.USER_BINARY_MESSAGE_RECEIVED:O.USER_MESSAGE_RECEIVED;h?this.emit(y,I(I({},e),{},{msg:l?await $e.b64str2ab(u,this._monitor):u})):this.emit(O.ON_CUSTOM_MESSAGE,{clientId:_,binary:l,message:l?await $e.b64str2ab(u,this._monitor):u})}this._sendP2PMessage(I(I({},e),{},{dir:Hs.FEEDBACK,msg:""})),Je.reportP2PMsgRecv(this.id,e,{msg_size:i,recv_msg_ts:s,fwd_msg_ts:d});break;case Hs.FEEDBACK:this._handleP2PMsgFeedback(e)}}C2GW(e,i,s){if(e.direction===1){var o;const n=((o=e.id)===null||o===void 0?void 0:o.join("-"))||"";this._handleAckMessage(n,i[0]||{},s,e.functionType)}else{const[n,a={}]=i;if(n==="RXMediaMsg"){var r;const{type:c,data:d}=a;switch((r=this._monitor)===null||r===void 0||r.report("rtc_signaling",I({error_code:0,message:s,signaling_event:"on-".concat(c),signaling_type:"Recv",stream_id:"",stream_user_id:"",direction:"down"},this.connectionIds)),c){case"RSCP":try{const l=JSON.parse(d);Array.isArray(l)&&this.emit(c,l)}catch{}break;case"RTT":try{const l=JSON.parse(d);l.length&&this.emit(c,l[0])}catch{}break;case"SSC":try{const l=JSON.parse(d);l.length&&(this.logger.info("Signal","<<<<<< ".concat(c),l),this.emit(c,l[0]))}catch{}}}else n==="engineControlMessage"&&this.C2S(e,i,s,0,0)}}_handleHandler(){const e=o=>{this.logger.warn("_handleHandler","dataChannel close",o)},i=o=>{this.logger.error("_handleHandler","dataChannel error",o)},s=o=>{this._handleMessage(o.data)};return this._dataChannel.addEventListener("close",e),this._dataChannel.addEventListener("error",i),this._dataChannel.addEventListener("message",s),()=>{const o=this._dataChannel;o?.removeEventListener("close",e),o?.removeEventListener("error",i),o?.removeEventListener("message",s)}}_genHeader(){return I({version:2,zip:!1,encrypt:!1,needAck:!0,direction:0,functionType:0,binary:!1},arguments.length>0&&arguments[0]!==void 0?arguments[0]:{})}_handleAckMessage(e,i,s,o){var r;const n=this._singlingCache.get(e);n&&(this._singlingCache.delete(e),i.code===200?n.success(i):n.error(i),this.logger.info("Signal","<<<<<< [".concat(n.signalingType,"{").concat(o,"}-ack] ").concat(e),i));const a=I({error_code:0,message:s,signaling_event:n?.signalingType,signaling_type:"Ack",stream_id:"",stream_user_id:"",direction:"down",elapse:n?ee()-n.start:0},this.connectionIds);n!=null&&n.id&&(a.event_session_id=n.id),(r=this._monitor)===null||r===void 0||r.report("rtc_signaling",a)}_handleP2PMsgFeedback(e){const i=this._p2pCache.get(e.id);i&&(this._p2pCache.delete(e.id),e.err===Rh.SUCCESS?i.success(e.id,e):i.error(e))}}var ut=(t=>(t.ICE_FAILED="ice failed",t.DC_ERROR="datachannel onerror",t.DC_CLOSE="datachannel onclose",t.NODE_CHANGE="recv nodeChange signaling",t.NOTIFY_RECONNECT="recv notifyReconnect signaling",t.JOIN_TIMEOUT="joinRoom timeout, retry with tcp only",t))(ut||{});class PO extends Vt{constructor(e){super(),m(this,"id",void 0),m(this,"_monitor",void 0),m(this,"logger",void 0),m(this,"_getAccessManager",void 0),m(this,"_connectionPool",new Map),m(this,"_curConnection",void 0),m(this,"_hasReportBrowerWarning",!1),m(this,"_reconnectTimer",void 0),m(this,"_connecting",!1),m(this,"_isFirstTimeConnected",!0),m(this,"_feedbackNodes",[]),m(this,"_preIceStartTime",-1),m(this,"_tcpOnlyTimer",void 0),m(this,"_destroyed",!1),this._ctx=e,this.id=e.id,this._monitor=ke(this.id),this.logger=new ue("ConnectionManager",3,this.id),this.logger.info("constructor","invoke"),this._getAccessManager=new pO(e)}startup(){this.logger.info("connect","invoke");try{Zc.checkSupported()}catch(e){this.asyncEmit("disconnected",e)}this._connecting||(this._onConnectStart(),Promise.resolve().then((()=>this.emit("__onGetIceConfigHook"))),this._getAccess())}async reconnectByNodeChange(e){var i,s,o;this.logger.info("reconnectByNodeChange","invoke %o",e);const{nodes:r,reason:n}=e;(i=this._monitor)===null||i===void 0||i.report("rtc_node_change",{error_code:0,message:JSON.stringify(e),reason:JSON.stringify(n)}),We.clearAccessNode(this._ctx.appId),(s=this._curConnection)===null||s===void 0||s.pc.reportRtcPreIce("node_change");const a=((o=this._curConnection)===null||o===void 0||(o=o.node.publicIPs[0])===null||o===void 0?void 0:o.ip)||"";this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart("recv nodeChange signaling"),Array.isArray(r)&&r.length>0?this._startIceConnect(r):this._getAccess([{feedbackIP:a,feedbackReason:{type:"NODE_CHANGED",reason:n}}])}async reconnect(e){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.logger.info("reconnect","invoke. ".concat(i?"ICE over TCP":"")),this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart(e),this._getAccess(void 0,i)}shotdown(){this.logger.info("destroy","invoke"),this._destroyed=!0,this.asyncEmit("disconnected",new G(C.OPERATION_CANCEL,"destroy")).then((()=>{super.removeAllListeners()})),this._clearReconnectTimer(),this._clearConnectionPool(),this._getAccessManager.destroy(),this._closeCurrentConnection()}_getAccess(e){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._getAccessManager.getICENode(e).then((s=>{this.emit("__onGetIceSuccessHook",s),this._startIceConnect(s,i)})).catch((s=>{this.asyncEmit("disconnected",s)})).finally((()=>{this._feedbackNodes=[]}))}_startIceConnect(e){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(this._destroyed)return;this.logger.info("_startIceConnect","invoke");const s=Wt();this._preIceStartTime=ee();const o=this._ctx.joinRoomConfig.useTcpJoin,r=this._ctx.joinRoomConfig.useTcpJoinDelay,n=async a=>{i&&((a=no(a)).iceConfig.tcpOnly=!0);const c={node:a};try{const d=new Zc(this._ctx,s,!this._isFirstTimeConnected);c.pc=d,this._addJoinRoomFailedPrivateHandler(d),this._connectionPool.set(d.uuid,c);const l=await d.startIceConnect(a),u=new EO(this.id,l,{connection_id:d.getConnectionId(),group_connection_id:s});c.signaling=u,d.reportRtcPreIce("datachannel_send_ping"),await u.sendPingSignaling(),d.reportRtcPreIce("datachannel_recv_pong"),this._onConnectSuccess({node:a,pc:d,signaling:u,dc:l}),this.safeEmit("__onConnectSuccessHook",e.length)}catch(d){this._onConnectionFailed(c,d)}};this.emit("__onIceConnectStartHook"),e.forEach(n),o&&!i&&(this.logger.info("_startIceConnect","tcp-only will try after ".concat(r,"ms")),this._tcpOnlyTimer=setTimeout((()=>{this.emit("connectWidthTcp"),e.forEach((a=>{(a=no(a)).iceConfig.tcpOnly=!0,n(a)})),delete this._tcpOnlyTimer}),r))}_onConnectSuccess(e){var i;this.logger.info("connect","peer_%s connect success.",e.pc.uuid),this.emit("__onIceConnectSuccessHook",e),this._curConnection?(e.pc.destroy(),e.signaling.destroy(),this._connectionPool.delete(e.pc.uuid)):(this._curConnection=e,this._addConnectionHandler(e.pc),(i=this._monitor)===null||i===void 0||i.set({connection_id:e.pc.getConnectionId()}),this._connectionPool.delete(e.pc.uuid),this._feedbackNodes.forEach((s=>this._feedbackBySignaling(s))),this._feedbackNodes=[],this._onConnectEnded(e))}_onConnectionFailed(e,i){var s,o;this.logger.info("connect","peer_%s connect failed. %s",((s=e.pc)===null||s===void 0?void 0:s.uuid)||"",i.message),this.emit("__onIceConnectFailedHook",e),i.code!==PT.DESTROY&&i.code!==C.OPERATION_CANCEL&&(this._curConnection?this._feedbackBySignaling(e.node):this._feedbackNodes.push(e.node),this.logger.info("connect","remove cache node"),We.deleteAccessNode(this._ctx.appId,e.node),e.pc&&(this._connectionPool.delete(e.pc.uuid),e.pc.destroy()),(o=e.signaling)===null||o===void 0||o.destroy(),this._connectionPool.size!==0||this._curConnection||this._destroyed||(this.logger.error("connect","establish peerConnection failed"),this._checkBrowserUA(),ee()-this._preIceStartTime<1e3?(this._clearReconnectTimer(),this._reconnectTimer=setTimeout((()=>{delete this._reconnectTimer,this._reconnectWithIceFailed(this._feedbackNodes)}),1e3)):this._reconnectWithIceFailed(this._feedbackNodes)))}_feedbackBySignaling(e){var i;(i=this._curConnection)===null||i===void 0||i.signaling.sendSignaling("scheduleMessage",{type:"feedback",body:{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})}async _reconnectWithIceFailed(e){this._onConnectStart("ice failed"),this.logger.warn("reconnect","because of ice failed"),this._getAccess(e.map((i=>({feedbackIP:i.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}))))}_checkBrowserUA(){var e;!this._hasReportBrowerWarning&&this._ctx.joinRoomConfig.isBlackBrower()&&(this._hasReportBrowerWarning=!0,(e=this._monitor)===null||e===void 0||e.report("rtc_error",{error_code:At.BLACK_BROWSER,message:"failed to establish data-channel, and the current browser is on the browser blacklist."}))}_onConnectStart(e){var i;this.logger.info("_onConnectStart","invoke, reason: ".concat(e||"init")),this._connecting=!0,e?this.asyncEmit("reconnecting",e):this.asyncEmit("connecting");const s=Wt();var o;(i=this._monitor)===null||i===void 0||i.set({connect_session_id:s}),this._isFirstTimeConnected||(o=this._monitor)===null||o===void 0||o.report("rtc_reconnect",{error_code:1002,message:"peerconnection reconnecting",reconnect_id:s,reconnect_type:"peerconnection"},{reason:e})}_onConnectEnded(e){var i;this.logger.info("_onConnectEnded","invoke"),this._connecting=!1,this._isFirstTimeConnected||(i=this._monitor)===null||i===void 0||i.report("rtc_reconnected",{message:"peerconnection reconnected",reconnect_type:"peerconnection"}),this._isFirstTimeConnected=!1,this.asyncEmit("connected",e),e.node.iceConfig.tcpOnly&&(this.logger.info("_onConnectEnded","use tcp only"),ye(this._ctx.id,"connected_with_tcp_only",JSON.stringify(e.node))),this._tcpOnlyTimer&&(window.clearTimeout(this._tcpOnlyTimer),delete this._tcpOnlyTimer),this._clearConnectionPool()}_addConnectionHandler(e){e.on("disconnect",(i=>{this._closeCurrentConnection(),this._clearReconnectTimer(),navigator.onLine?this.reconnect(i):this._reconnectTimer=setTimeout((()=>this.reconnect(i)),3e3)}))}_addJoinRoomFailedPrivateHandler(e){e.on("join_room_failed_private_callback",(i=>{this.emit("joinRoomFailedPrivateCallback",i)})),e.on("__startIceConnect_hook",(i=>{this.emit("__startIceConnect_hook",i)}))}_closeCurrentConnection(){var e,i;(e=this._curConnection)===null||e===void 0||e.pc.destroy(),(i=this._curConnection)===null||i===void 0||i.signaling.destroy(),delete this._curConnection}_clearConnectionPool(){this._connectionPool.forEach(((e,i)=>{var s,o;(s=e.signaling)===null||s===void 0||s.destroy(),(o=e.pc)===null||o===void 0||o.destroy(),this._connectionPool.delete(i)}))}_clearReconnectTimer(){this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer)}}var NO=vn,kO=NO.f("asyncIterator"),xO=kO,MO=xO,wO=MO,KO=wO,YO=KO,HO=YO,FO=HO,OO=Ie(FO),uS=nt,JO=Dg,UO=mn,AO=Li,DO=function(t,e,i){for(var s=JO(e),o=AO.f,r=UO.f,n=0;n<s.length;n++){var a=s[n];uS(t,a)||i&&uS(i,a)||o(t,a,r(e,a))}},zO=Gt,QO=Do,jO=function(t,e){zO(e)&&"cause"in e&&QO(t,"cause",e.cause)},BO=Re,NT=Error,$O=BO("".replace),qO=String(new NT("zxcasd").stack),kT=/\n\s*at [^:]*:[^\n]*/,eJ=kT.test(qO),tJ=function(t,e){if(eJ&&typeof t=="string"&&!NT.prepareStackTrace)for(;e--;)t=$O(t,kT,"");return t},iJ=Ge,sJ=mo,oJ=!iJ((function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",sJ(1,7)),t.stack!==7)})),rJ=Do,nJ=tJ,aJ=oJ,mS=Error.captureStackTrace,dJ=function(t,e,i,s){aJ&&(mS?mS(t,e):rJ(t,"stack",nJ(i,s)))},cJ=Rs,lJ=tt,uJ=ri,mJ=pn,hJ=yT,pJ=Xs,hS=St,bJ=Rp,yJ=$c,pS=bT,_J=TypeError,$d=function(t,e){this.stopped=t,this.result=e},bS=$d.prototype,Xn=function(t,e,i){var s,o,r,n,a,c,d,l=i&&i.that,u=!(!i||!i.AS_ENTRIES),p=!(!i||!i.IS_RECORD),h=!(!i||!i.IS_ITERATOR),_=!(!i||!i.INTERRUPTED),y=cJ(e,l),b=function(v){return s&&pS(s,"normal",v),new $d(!0,v)},S=function(v){return u?(uJ(v),_?y(v[0],v[1],b):y(v[0],v[1])):_?y(v,b):y(v)};if(p)s=t.iterator;else if(h)s=t;else{if(!(o=yJ(t)))throw new _J(mJ(t)+" is not iterable");if(hJ(o)){for(r=0,n=pJ(t);n>r;r++)if((a=S(t[r]))&&hS(bS,a))return a;return new $d(!1)}s=bJ(t,o)}for(c=p?t.next:s.next;!(d=lJ(c,s)).done;){try{a=S(d.value)}catch(v){pS(s,"throw",v)}if(typeof a=="object"&&a&&hS(bS,a))return a}return new $d(!1)},SJ=Qt,vJ=function(t,e){return t===void 0?arguments.length<2?"":e:SJ(t)},gJ=he,fJ=St,ZJ=sp,Tc=k1,TJ=DO,xT=ka,lm=Do,um=mo,IJ=jO,RJ=dJ,XJ=Xn,CJ=vJ,LJ=Me,WJ=LJ("toStringTag"),Ic=Error,GJ=[].push,dn=function(t,e){var i,s=fJ(mm,this);Tc?i=Tc(new Ic,s?ZJ(this):mm):(i=s?this:xT(mm),lm(i,WJ,"Error")),e!==void 0&&lm(i,"message",CJ(e)),RJ(i,dn,i.stack,1),arguments.length>2&&IJ(i,arguments[2]);var o=[];return XJ(t,GJ,{that:o}),lm(i,"errors",o),i};Tc?Tc(dn,Ic):TJ(dn,Ic,{name:!0});var mm=dn.prototype=xT(Ic.prototype,{constructor:um(1,dn),message:um(1,""),name:um(1,"AggregateError")});gJ({global:!0},{AggregateError:dn});var Ga,yr,yS,hm,Yn=Ee,VJ=ho,EJ=uo,gd=function(t){return VJ.slice(0,t.length)===t},MT=gd("Bun/")?"BUN":gd("Cloudflare-Workers")?"CLOUDFLARE":gd("Deno/")?"DENO":gd("Node.js/")?"NODE":Yn.Bun&&typeof Bun.version=="string"?"BUN":Yn.Deno&&typeof Deno.version=="object"?"DENO":EJ(Yn.process)==="process"?"NODE":Yn.window&&Yn.document?"BROWSER":"REST",PJ=MT,kp=PJ==="NODE",NJ=pt,kJ=Hc,xJ=Me,MJ=et,_S=xJ("species"),wJ=function(t){var e=NJ(t);MJ&&e&&!e[_S]&&kJ(e,_S,{configurable:!0,get:function(){return this}})},KJ=jh,YJ=pn,HJ=TypeError,FJ=function(t){if(KJ(t))return t;throw new HJ(YJ(t)+" is not a constructor")},SS=ri,OJ=FJ,JJ=Va,UJ=Me,AJ=UJ("species"),wT=function(t,e){var i,s=SS(t).constructor;return s===void 0||JJ(i=SS(s)[AJ])?e:OJ(i)},DJ=ho,KT=/(?:ipad|iphone|ipod).*applewebkit/i.test(DJ),si=Ee,zJ=Vc,QJ=Rs,vS=ze,jJ=nt,YT=Ge,gS=Kv,BJ=Sn,fS=Ah,$J=Oa,qJ=KT,eU=kp,Xh=si.setImmediate,ZS=si.clearImmediate,tU=si.process,pm=si.Dispatch,iU=si.Function,TS=si.MessageChannel,sU=si.String,bm=0,va={},IS="onreadystatechange";YT((function(){Ga=si.location}));var xp=function(t){if(jJ(va,t)){var e=va[t];delete va[t],e()}},ym=function(t){return function(){xp(t)}},RS=function(t){xp(t.data)},XS=function(t){si.postMessage(sU(t),Ga.protocol+"//"+Ga.host)};Xh&&ZS||(Xh=function(t){$J(arguments.length,1);var e=vS(t)?t:iU(t),i=BJ(arguments,1);return va[++bm]=function(){zJ(e,void 0,i)},yr(bm),bm},ZS=function(t){delete va[t]},eU?yr=function(t){tU.nextTick(ym(t))}:pm&&pm.now?yr=function(t){pm.now(ym(t))}:TS&&!qJ?(hm=(yS=new TS).port2,yS.port1.onmessage=RS,yr=QJ(hm.postMessage,hm)):si.addEventListener&&vS(si.postMessage)&&!si.importScripts&&Ga&&Ga.protocol!=="file:"&&!YT(XS)?(yr=XS,si.addEventListener("message",RS,!1)):yr=IS in fS("script")?function(t){gS.appendChild(fS("script"))[IS]=function(){gS.removeChild(this),xp(t)}}:function(t){setTimeout(ym(t),0)});var HT={set:Xh},FT=function(){this.head=null,this.tail=null};FT.prototype={add:function(t){var e={item:t,next:null},i=this.tail;i?i.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var _r,_m,Sm,vm,CS,OT=FT,oU=ho,rU=/ipad|iphone|ipod/i.test(oU)&&typeof Pebble<"u",nU=ho,aU=/web0s(?!.*chrome)/i.test(nU),cn=Ee,dU=nT,LS=Rs,gm=HT.set,cU=OT,lU=KT,uU=rU,mU=aU,fm=kp,WS=cn.MutationObserver||cn.WebKitMutationObserver,GS=cn.document,VS=cn.process,fd=cn.Promise,Ch=dU("queueMicrotask");if(!Ch){var Zd=new cU,Td=function(){var t,e;for(fm&&(t=VS.domain)&&t.exit();e=Zd.get();)try{e()}catch(i){throw Zd.head&&_r(),i}t&&t.enter()};lU||fm||mU||!WS||!GS?!uU&&fd&&fd.resolve?((vm=fd.resolve(void 0)).constructor=fd,CS=LS(vm.then,vm),_r=function(){CS(Td)}):fm?_r=function(){VS.nextTick(Td)}:(gm=LS(gm,cn),_r=function(){gm(Td)}):(_m=!0,Sm=GS.createTextNode(""),new WS(Td).observe(Sm,{characterData:!0}),_r=function(){Sm.data=_m=!_m}),Ch=function(t){Zd.head||_r(),Zd.add(t)}}var hU=Ch,pU=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},Cn=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},bU=Ee,Jo=bU.Promise,yU=Ee,ga=Jo,_U=ze,SU=Iv,vU=Wv,gU=Me,ES=MT,Zm=Ea,PS=ga&&ga.prototype,fU=gU("species"),JT=_U(yU.PromiseRejectionEvent),ZU=SU("Promise",(function(){var t=vU(ga),e=t!==String(ga);if(!e&&Zm===66||!PS.catch||!PS.finally)return!0;if(!Zm||Zm<51||!/native code/.test(t)){var i=new ga((function(o){o(1)})),s=function(o){o((function(){}),(function(){}))};if((i.constructor={})[fU]=s,!(i.then((function(){}))instanceof s))return!0}return!(e||ES!=="BROWSER"&&ES!=="DENO"||JT)})),Ja={CONSTRUCTOR:ZU,REJECTION_EVENT:JT},us={},NS=Xi,TU=TypeError,IU=function(t){var e,i;this.promise=new t((function(s,o){if(e!==void 0||i!==void 0)throw new TU("Bad Promise constructor");e=s,i=o})),this.resolve=NS(e),this.reject=NS(i)};us.f=function(t){return new IU(t)};var RU=he,Rc=kp,co=Ee,Ua=tt,XU=po,CU=Cs,LU=wJ,WU=Xi,Lh=ze,GU=Gt,VU=Ip,EU=wT,UT=HT.set,Mp=hU,PU=pU,NU=Cn,kU=OT,AT=gn,Wh=Jo,DT=Ja,zT=us,qd="Promise",kS=DT.CONSTRUCTOR,xU=DT.REJECTION_EVENT,Tm,xS,MU,Im=AT.getterFor(qd),wU=AT.set,KU=Wh&&Wh.prototype,Hn=Wh,Rm=KU,QT=co.TypeError,Gh=co.document,wp=co.process,Vh=zT.f,YU=Vh,HU=!!(Gh&&Gh.createEvent&&co.dispatchEvent),jT="unhandledrejection",FU="rejectionhandled",MS=0,BT=1,OU=2,Kp=1,$T=2,qT=function(t){var e;return!(!GU(t)||!Lh(e=t.then))&&e},eI=function(t,e){var i,s,o,r=e.value,n=e.state===BT,a=n?t.ok:t.fail,c=t.resolve,d=t.reject,l=t.domain;try{a?(n||(e.rejection===$T&&UU(e),e.rejection=Kp),a===!0?i=r:(l&&l.enter(),i=a(r),l&&(l.exit(),o=!0)),i===t.promise?d(new QT("Promise-chain cycle")):(s=qT(i))?Ua(s,i,c,d):c(i)):d(r)}catch(u){l&&!o&&l.exit(),d(u)}},tI=function(t,e){t.notified||(t.notified=!0,Mp((function(){for(var i,s=t.reactions;i=s.get();)eI(i,t);t.notified=!1,e&&!t.rejection&&JU(t)})))},iI=function(t,e,i){var s,o;HU?((s=Gh.createEvent("Event")).promise=e,s.reason=i,s.initEvent(t,!1,!0),co.dispatchEvent(s)):s={promise:e,reason:i},!xU&&(o=co["on"+t])?o(s):t===jT&&PU("Unhandled promise rejection",i)},JU=function(t){Ua(UT,co,(function(){var e,i=t.facade,s=t.value;if(wS(t)&&(e=NU((function(){Rc?wp.emit("unhandledRejection",s,i):iI(jT,i,s)})),t.rejection=Rc||wS(t)?$T:Kp,e.error))throw e.value}))},wS=function(t){return t.rejection!==Kp&&!t.parent},UU=function(t){Ua(UT,co,(function(){var e=t.facade;Rc?wp.emit("rejectionHandled",e):iI(FU,e,t.value)}))},Yr=function(t,e,i){return function(s){t(e,s,i)}},Dr=function(t,e,i){t.done||(t.done=!0,i&&(t=i),t.value=e,t.state=OU,tI(t,!0))},Eh=function(t,e,i){if(!t.done){t.done=!0,i&&(t=i);try{if(t.facade===e)throw new QT("Promise can't be resolved itself");var s=qT(e);s?Mp((function(){var o={done:!1};try{Ua(s,e,Yr(Eh,o,t),Yr(Dr,o,t))}catch(r){Dr(o,r,t)}})):(t.value=e,t.state=BT,tI(t,!1))}catch(o){Dr({done:!1},o,t)}}};kS&&(Rm=(Hn=function(t){VU(this,Rm),WU(t),Ua(Tm,this);var e=Im(this);try{t(Yr(Eh,e),Yr(Dr,e))}catch(i){Dr(e,i)}}).prototype,(Tm=function(t){wU(this,{type:qd,done:!1,notified:!1,parent:!1,reactions:new kU,rejection:!1,state:MS,value:null})}).prototype=XU(Rm,"then",(function(t,e){var i=Im(this),s=Vh(EU(this,Hn));return i.parent=!0,s.ok=!Lh(t)||t,s.fail=Lh(e)&&e,s.domain=Rc?wp.domain:void 0,i.state===MS?i.reactions.add(s):Mp((function(){eI(s,i)})),s.promise})),xS=function(){var t=new Tm,e=Im(t);this.promise=t,this.resolve=Yr(Eh,e),this.reject=Yr(Dr,e)},zT.f=Vh=function(t){return t===Hn||t===MU?new xS(t):YU(t)}),RU({global:!0,wrap:!0,forced:kS},{Promise:Hn}),CU(Hn,qd,!1,!0),LU(qd);var AU=Me,sI=AU("iterator"),oI=!1;try{var DU=0,KS={next:function(){return{done:!!DU++}},return:function(){oI=!0}};KS[sI]=function(){return this},Array.from(KS,(function(){throw 2}))}catch{}var zU=function(t,e){try{if(!e&&!oI)return!1}catch{return!1}var i=!1;try{var s={};s[sI]=function(){return{next:function(){return{done:i=!0}}}},t(s)}catch{}return i},QU=Jo,jU=zU,BU=Ja.CONSTRUCTOR,qc=BU||!jU((function(t){QU.all(t).then(void 0,(function(){}))})),$U=he,qU=tt,eA=Xi,tA=us,iA=Cn,sA=Xn,oA=qc;$U({target:"Promise",stat:!0,forced:oA},{all:function(t){var e=this,i=tA.f(e),s=i.resolve,o=i.reject,r=iA((function(){var n=eA(e.resolve),a=[],c=0,d=1;sA(t,(function(l){var u=c++,p=!1;d++,qU(n,e,l).then((function(h){p||(p=!0,a[u]=h,--d||s(a))}),o)})),--d||s(a)}));return r.error&&o(r.value),i.promise}});var rA=he,nA=Ja.CONSTRUCTOR;Jo&&Jo.prototype,rA({target:"Promise",proto:!0,forced:nA,real:!0},{catch:function(t){return this.then(void 0,t)}});var aA=he,dA=tt,cA=Xi,lA=us,uA=Cn,mA=Xn,hA=qc;aA({target:"Promise",stat:!0,forced:hA},{race:function(t){var e=this,i=lA.f(e),s=i.reject,o=uA((function(){var r=cA(e.resolve);mA(t,(function(n){dA(r,e,n).then(i.resolve,s)}))}));return o.error&&s(o.value),i.promise}});var pA=he,bA=us,yA=Ja.CONSTRUCTOR;pA({target:"Promise",stat:!0,forced:yA},{reject:function(t){var e=bA.f(this);return(0,e.reject)(t),e.promise}});var _A=ri,SA=Gt,vA=us,rI=function(t,e){if(_A(t),SA(e)&&e.constructor===t)return e;var i=vA.f(t);return(0,i.resolve)(e),i.promise},gA=he,fA=pt,ZA=Zv,TA=Jo,IA=Ja.CONSTRUCTOR,RA=rI,XA=fA("Promise"),CA=!IA;gA({target:"Promise",stat:!0,forced:ZA},{resolve:function(t){return RA(CA&&this===XA?TA:this,t)}});var LA=he,WA=tt,GA=Xi,VA=us,EA=Cn,PA=Xn,NA=qc;LA({target:"Promise",stat:!0,forced:NA},{allSettled:function(t){var e=this,i=VA.f(e),s=i.resolve,o=i.reject,r=EA((function(){var n=GA(e.resolve),a=[],c=0,d=1;PA(t,(function(l){var u=c++,p=!1;d++,WA(n,e,l).then((function(h){p||(p=!0,a[u]={status:"fulfilled",value:h},--d||s(a))}),(function(h){p||(p=!0,a[u]={status:"rejected",reason:h},--d||s(a))}))})),--d||s(a)}));return r.error&&o(r.value),i.promise}});var kA=he,xA=tt,MA=Xi,wA=pt,KA=us,YA=Cn,HA=Xn,FA=qc,YS="No one promise resolved";kA({target:"Promise",stat:!0,forced:FA},{any:function(t){var e=this,i=wA("AggregateError"),s=KA.f(e),o=s.resolve,r=s.reject,n=YA((function(){var a=MA(e.resolve),c=[],d=0,l=1,u=!1;HA(t,(function(p){var h=d++,_=!1;l++,xA(a,e,p).then((function(y){_||u||(u=!0,o(y))}),(function(y){_||u||(_=!0,c[h]=y,--l||r(new i(c,YS)))}))})),--l||r(new i(c,YS))}));return n.error&&r(n.value),s.promise}});var OA=he,JA=Ee,UA=Vc,AA=Sn,DA=us,zA=Xi,nI=Cn,Xm=JA.Promise,HS=!1,QA=!Xm||!Xm.try||nI((function(){Xm.try((function(t){HS=t===8}),8)})).error||!HS;OA({target:"Promise",stat:!0,forced:QA},{try:function(t){var e=arguments.length>1?AA(arguments,1):[],i=DA.f(this),s=nI((function(){return UA(zA(t),void 0,e)}));return(s.error?i.reject:i.resolve)(s.value),i.promise}});var jA=he,BA=us;jA({target:"Promise",stat:!0},{withResolvers:function(){var t=BA.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var $A=he,Ph=Jo,qA=Ge,eD=pt,tD=ze,iD=wT,FS=rI,sD=Ph&&Ph.prototype,oD=!!Ph&&qA((function(){sD.finally.call({then:function(){}},(function(){}))}));$A({target:"Promise",proto:!0,real:!0,forced:oD},{finally:function(t){var e=iD(this,eD("Promise")),i=tD(t);return this.then(i?function(s){return FS(e,t()).then((function(){return s}))}:t,i?function(s){return FS(e,t()).then((function(){throw s}))}:t)}});var rD=zt,nD=rD.Promise,aD=nD,dD=aD,cD=dD,lD=cD,uD=lD,mD=uD,hD=mD,Id=Ie(hD);function pD(t){var e,i,s,o=2;for(Dn!==void 0&&(i=OO,s=Lg);o--;){if(i&&(e=t[i])!=null)return e.call(t);if(s&&(e=t[s])!=null)return new Nh(e.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Nh(t){function e(i){if(Object(i)!==i)return Id.reject(new TypeError(i+" is not an object."));var s=i.done;return Id.resolve(i.value).then((function(o){return{value:o,done:s}}))}return(Nh=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Id.resolve({value:i,done:!0}):e(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Id.reject(i):e(s.apply(this.s,arguments))}},new Nh(t)}var bD=(t=>(t[t.AUTO=0]="AUTO",t[t.MODE_L=1]="MODE_L",t[t.MODE_R=2]="MODE_R",t[t.MODE_MIX=3]="MODE_MIX",t))(bD||{}),Ti=(t=>(t[t.PLAYOUT=0]="PLAYOUT",t[t.PUBLISH=1]="PUBLISH",t[t.PLAYOUT_AND_PUBLISH=2]="PLAYOUT_AND_PUBLISH",t))(Ti||{}),kt=(t=>(t[t.AUDIO_MIXING_STATE_PRELOADED=0]="AUDIO_MIXING_STATE_PRELOADED",t[t.AUDIO_MIXING_STATE_PLAYING=1]="AUDIO_MIXING_STATE_PLAYING",t[t.AUDIO_MIXING_STATE_PAUSED=2]="AUDIO_MIXING_STATE_PAUSED",t[t.AUDIO_MIXING_STATE_STOPPED=3]="AUDIO_MIXING_STATE_STOPPED",t[t.AUDIO_MIXING_STATE_FAILED=4]="AUDIO_MIXING_STATE_FAILED",t[t.AUDIO_MIXING_STATE_FINISHED=5]="AUDIO_MIXING_STATE_FINISHED",t[t.AUDIO_MIXING_STATE_PCM_ENABLED=6]="AUDIO_MIXING_STATE_PCM_ENABLED",t[t.AUDIO_MIXING_STATE_PCM_DISABLED=7]="AUDIO_MIXING_STATE_PCM_DISABLED",t))(kt||{});class Aa extends Ai.EventEmitter{constructor(e,i){super(),m(this,"_context",void 0),m(this,"peerConnectionMode",0),m(this,"id",void 0),m(this,"_monitor",void 0),m(this,"logger",void 0),m(this,"_nextSsrc",SO()),m(this,"_aSendonlyAnswerTpl",void 0),m(this,"_vSendonlyAnswerTpl",void 0),m(this,"_enableSubFlexfec",!1),m(this,"audioTrack4ff",void 0),m(this,"setLocalDescription",void 0),m(this,"setRemoteDescription",void 0),this.peer=i,this.id=e.id,this._monitor=ke(this.id),this.logger=new ue("BasicHandler",3,e.id),this.setLocalDescription=i.setLocalDescription.bind(i),this.setRemoteDescription=i.setRemoteDescription.bind(i),this._context=e,this.peer.on("ontrack",(s=>{this.emit("ontrack",s)}))}destroy(){this.logger.info("destroy",this.peerConnectionId||""),super.removeAllListeners()}get _peerConnection(){return this.peer.getOriginRTCPeerConnection()}getTransceivers(){return this._peerConnection.getTransceivers()}getConnectionState(){return this._peerConnection.connectionState}internalPublish(e){const{stream:i,videoTrack:s,audioTrack:o,pubAudio:r,pubVideo:n}=e,a={direction:"sendonly",streams:[i]},c={direction:"sendonly",streams:[i]},{sendEncodings:d,videoDescriptions:l,subVideoDescriptions:u,activeSimulcastStreams:p}=this._context.videoProfile.genVideoDescriptions(e);c.sendEncodings=d,this._context.videoProfile.activeSimStreams=p,this.logger.info("publish videoTransceiverInit videoDescriptions","",c,l);let h=o?.preprocessingTrack;o?.mixType!==Ti.PLAYOUT&&o!=null&&o.mixedAudioTrack&&(h=o?.mixedAudioTrack),h=r&&h?h:"audio";let _=s?.preprocessingTrack;_=n&&_?_:"video";try{this._reportRtcInvokeStatus("Handler.internalPublish",JSON.stringify({aTrack:Zi(h),vTrack:Zi(_),audioTransceiverInit:a,videoTransceiverInit:c}))}catch{}return{semantics:"unified-plan",videoDescriptions:l,subVideoDescriptions:u,audioTransceiverInit:{track:h,init:a},videoTransceiverInit:{track:_,init:c}}}async setCurrentDescription(){}createAVMlineAnswerTpl(e){const i=z.parse(e);i.media.forEach((s=>{if(s.type==="audio"){if(s.direction==="sendonly"){const o=s?.rtp.find((r=>r.codec==="opus"));if(o&&s!=null&&s.fmtp){const r=s?.fmtp.find((n=>n.payload===o.payload));r&&this._context&&(r.config+=";stereo=1;sprop-stereo=1")}this._aSendonlyAnswerTpl=s}}else s.type==="video"&&(s.direction==="sendonly"&&(this._vSendonlyAnswerTpl=s),Array.isArray(s.rtp)&&s.rtp.forEach((o=>{var r;(r=o.codec)!==null&&r!==void 0&&r.includes("flexfec")&&(this._enableSubFlexfec=!0)})))})),ii&&Mi(i)}get peerConnectionId(){return this.peer.getConnectionId()||""}addBitrateLimit(e,i){e?.rtp.forEach((s=>{let{codec:o,payload:r}=s;if(["vp8","h264"].includes(o.toLocaleLowerCase())){const n=e.fmtp.find((a=>a.payload===r));n?n.config=[...n.config.split(";"),"x-google-min-bitrate=100","x-google-start-bitrate=".concat(i)].join(";"):e.fmtp.push({payload:r,config:"x-google-min-bitrate=100;x-google-start-bitrate=".concat(i)})}}))}_report(e,i,s){var o;(o=this._monitor)===null||o===void 0||o.report(e,I(I({},i),{},{connection_id:this.peer.getConnectionId(),group_connection_id:this.peer.getGroupConnectionId()}),s)}_reportRtcInvokeStatus(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",r=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:i,error_code:s,stream_id:o,elapse:0},r)}}const yD=new ue("queue",4);var aI=(t=>(t[t.ADD=0]="ADD",t[t.CLOSE=1]="CLOSE",t))(aI||{}),Se=(t=>(t.publish="publish",t.unpublish="unpublish",t.subscribe="subscribe",t.unsubscribe="unsubscribe",t.pushtrack="pushtrack",t.removetrack="removetrack",t))(Se||{});const _D={publish:"unpublish",subscribe:"unsubscribe",pushtrack:"removetrack"},OS={publish:0,subscribe:0,pushtrack:0,unpublish:1,unsubscribe:1,removetrack:1};class SD extends a5{constructor(){super(),m(this,"_queue",void 0),this._queue=[]}get queue(){return this._queue}enqueue(e){const i=this._queue.length;let s="";return this._queue=this._queue.filter((o=>o.streamId!==e.streamId||e.action!==_D[o.action]||(s=o.streamId,yD.info("offsetStreamId",s),!1))),this._queue.length===i&&this._queue.push(e),this.emit("start"),s}dequeue(){if(!this._queue.length)return null;let e=this._queue.length;gs&&qt>=86&&qt<=92&&(e=Math.min(this._queue.length,5));const i=OS[this._queue[0].action];for(let s=1;s<e;s++)if(OS[this._queue[s].action]!==i)return{sdpStrategy:i,items:this._queue.splice(0,s)};return{sdpStrategy:i,items:this._queue.splice(0,e)}}destroy(){this._queue=[]}}const JS=cs()||Qo();class vD extends Aa{constructor(e,i){var s;super(e,i),m(this,"name","chrome"),m(this,"_queueBusy",!1),m(this,"_sdpQueue",void 0),m(this,"_aSendonlyOfferTpl",void 0),m(this,"_vSendonlyOfferTpl",void 0),m(this,"_aRecvonlyOfferTpl",void 0),m(this,"_vRecvonlyOfferTpl",void 0),m(this,"_mid",10),m(this,"_inactiveMlineIndex",[]),m(this,"setDescription",void 0),this.logger=new ue("ChromeHandler",3,e.id),this.setDescription=i.setDescription.bind(i),this._sdpQueue=new SD,this._sdpQueue.on("start",(()=>{this._queueBusy||this._peerConnection.signalingState!=="stable"||(this.logger.info("dequeue start"),this.dequeue())})),(s=this._context.monitor)===null||s===void 0||s.set({handler_mode:"chrome"})}destroy(){super.destroy(),this._sdpQueue.destroy()}async publish(e){var i;const{stream:s,enableSimulcast:o}=e,{videoDescriptions:r,subVideoDescriptions:n,audioTransceiverInit:a,videoTransceiverInit:c}=super.internalPublish(e),d=rn(this._nextSsrc);this._nextSsrc=d.next;const l="".concat(this._mid++),u="".concat(this._mid++),p=I(I(I({},this._aSendonlyOfferTpl),this.peer._offerIce),{},{mid:l,msid:"".concat(s.id," ").concat(s.id,"-audio"),ssrcs:nn(s.id,"audio",d.audio,dS)}),h=I(I(I({},this._vSendonlyOfferTpl),this.peer._offerIce),{},{mid:u,msid:"".concat(s.id," ").concat(s.id,"-video")});if(o){this.logger.info("subVideoDesc","desc: %o ",n),delete h.ssrcGroups,delete h.ssrcs;const y=[];h.rids=r.map((b=>{let{rid:S}=b;return y.unshift(S),{id:S,direction:"send"}})),h.simulcast={dir1:"send",list1:y.join(";")}}else{const{ssrcs:y,ssrcGroups:b}=Wa(s.id,d,{cname:dS});h.ssrcs=y,h.ssrcGroups=b}if((i=this._context.serverConfig)!==null&&i!==void 0&&i.audioRed&&Array.isArray(p.rtp)){this.logger.info("audioCodec","use Red");const y=p.rtp.findIndex((S=>S.codec==="red"));if(y!==-1){const[S]=p.rtp.splice(y,1);p.rtp.unshift(S)}const b=[];p.rtp.forEach((S=>b.push(S.payload))),p.payloads=b.join(" ")}Array.isArray(h.ext)&&(ae("IOS_SAFARI_ORIENTATION")||!Dt&&!yo||(h.ext=h.ext.filter((y=>{var b;return!(y!=null&&(b=y.uri)!==null&&b!==void 0&&b.includes("video-orientation"))}))),h.ext=h.ext.filter((y=>{var b;return!(y!=null&&(b=y.uri)!==null&&b!==void 0&&b.includes("framemarking"))})));const _=p?.rtp.find((y=>y.codec==="opus"));if(_&&p.fmtp){const y=p.fmtp.find((b=>b.payload===_.payload));y&&this._context.audioProfileManager&&(y.config=this._context.audioProfileManager.getOpusConfigStr(y.config))}return o||Dt||this.addBitrateLimit(h,e.videoEncodeConfig[0].maxKbps),e.audioMLine=p,e.videoMLine=h,{partialSdp:ao(this.peer._offerSession,p,h),audioMid:l,videoMid:u,type:"incroffer",semantics:"unified-plan",videoDescriptions:r,subVideoDescriptions:n,audioTransceiverInit:a,videoTransceiverInit:c,peerConnectionMode:this.peerConnectionMode}}async subscribe(e,i){var s,o;if(this.logger.info("subscribe"),!this._aRecvonlyOfferTpl||!this._vRecvonlyOfferTpl){const R=await this._genOfferSdp();await this.createAVMlineOfferTpl(R)}let r,n,a,c,d="",l="",u=!1,p=!1;e.audioMLine=r,e.videoMLine=n,e.virtual?(d="".concat(this._mid++),u=!0):i.multiChatMode?(d="".concat(this._mid++),l="".concat(this._mid++),p=!0):(u=!0,p=!0,d="".concat(this._mid++),l="".concat(this._mid++)),d&&(r=I(I({},no(this._aRecvonlyOfferTpl)),{},{mid:d})),u&&(e.audioMLine=r,a={track:"audio",init:{direction:"recvonly"}}),l&&(n=I(I({},no(this._vRecvonlyOfferTpl)),{},{mid:l})),p&&(e.videoMLine=n,c={track:"video",init:{direction:"recvonly"}});const h=ao(this.peer._offerSession,r,n);let _,y;if(!e.enableVendorMode&&!i.multiChatMode&&!e.virtual&&this._aSendonlyAnswerTpl&&this._vSendonlyAnswerTpl){var b;_=rn(this._nextSsrc),this._nextSsrc=_.next;const R=I(I(I({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:"".concat(e.streamId).concat(this._context.avSync?"":"-audio"," ").concat(e.streamId,"-audio"),ssrcs:nn(e.streamId,"audio",_.audio)}),T=I(I(I({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:l,msid:"".concat(e.streamId).concat(this._context.avSync?"":"-video"," ").concat(e.streamId,"-video")},Wa(e.streamId,_,{flexfec:this._enableSubFlexfec}));y={sdp:z.write(I(I({},this.peer._answerSession),{},{media:[R,T]})),sequenceId:e.sequenceId?++e.sequenceId:0},(b=_)===null||b===void 0||delete b.next}const S=(s=r)===null||s===void 0?void 0:s.rtp.find((R=>R.codec==="opus"));if(S&&(o=r)!==null&&o!==void 0&&o.fmtp){var v;const R=(v=r)===null||v===void 0?void 0:v.fmtp.find((T=>T.payload===S.payload));R&&this._context&&(R.config+=";stereo=1;sprop-stereo=1")}if(e.isPublic&&qt>=86){var f,g;const R=(f=n)===null||f===void 0?void 0:f.rtp.filter((T=>T.codec==="H264"));var Z;R!=null&&R.length&&(g=n)!==null&&g!==void 0&&g.fmtp&&((Z=n)===null||Z===void 0||Z.fmtp.forEach((T=>{R.find((X=>X.payload===T.payload))&&(T.config+=";sps-pps-idr-in-keyframe=1")})))}return{partialSdp:h,audioMid:d,videoMid:l,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:a,videoTransceiverInit:c,allSsrc:_,peerConnectionMode:this.peerConnectionMode,signalingAck:y}}async handleAck(e){return this.logger.info("handleAck()","item: %o",e),this._sdpQueue.enqueue(e)}async dequeue(){this._queueBusy=!0;const e=this._sdpQueue.dequeue();if(this.logger.info("dequeue()","ret: %o",e),!e)return void(this._queueBusy=!1);const i=[];try{const{items:p,sdpStrategy:h}=e,_=[],y=[],b=[];if(h===aI.ADD){delete I({},this.peer._answerIce).candidates;var s,o=!1,r=!1;try{for(var n,a=pD(p);o=!(n=await a.next()).done;o=!1){const S=n.value;{var c;const{audioMid:v,videoMid:f,action:g,audioTransceiverInit:Z,videoTransceiverInit:R,signalingAck:T,stream:X,videoCodec:L,onSuccess:W,onFail:M}=S,k=X instanceof Lc;if(W&&b.push(W),M&&i.push(M),k&&T.sequenceId<X.sequenceId)break;const U=z.parse(T.sdp);if(!Array.isArray(U.media))break;en(c=U.media).call(c,((E,q)=>{var ce;return E==null||(ce=E.type)===null||ce===void 0?void 0:ce.localeCompare(q?.type)}));const D=U.media.find((E=>E.type==="audio")),ie=U.media.find((E=>E.type==="video"));if(!D||!ie)break;const B=I(I(I({},D),this.peer._answerIce),{},{mid:v}),$=I(I(I({},ie),this.peer._answerIce),{},{mid:f}),{audioMLine:te,videoMLine:N,audioTransceiver:K,videoTransceiver:x}=X;if(te){let E=this.peer._offerMlines.findIndex((q=>q.mid===v));var d;if(K){if(this._reportRtcInvokeStatus("chromeHandler.updateTrack",JSON.stringify({audioStreamTrack:Zi((d=X.audioTrack)===null||d===void 0?void 0:d.preprocessingTrack)})),E===-1){this.logger.error("dequeue","audio mid not found when update sdp, %s from %o",v,this.peer._offerMlines);continue}}else Z&&te&&(X.audioTransceiver=this._peerConnection.addTransceiver(Z.track,Z.init),this._reportRtcInvokeStatus("chromeHandler.addTrack",JSON.stringify({audioStreamTrack:Zi(Z.track)})),E=this._inactiveMlineIndex.shift(),E||(E=this.peer._offerMlines.length),JS&&X.initAudioEncodedTransform());g===Se.publish&&ae("AUDIO_CODEC")!=="OPUS"&&(Ih(te,ae("AUDIO_CODEC")),Ih(B,ae("AUDIO_CODEC"))),this.peer._offerMlines[E]=I({},te),this.peer._answerMlines[E]=I({},B)}if(N){let E=this.peer._offerMlines.findIndex((q=>q.mid===f));var l;if(x){if(this._reportRtcInvokeStatus("chromeHandler.updateTrack",JSON.stringify({audioStreamTrack:Zi((l=X.videoTrack)===null||l===void 0?void 0:l.preprocessingTrack)})),E===-1){this.logger.error("dequeue","video mid not found when update sdp, %s from %o",f,this.peer._offerMlines);continue}}else R&&N&&(X.videoTransceiver=this._peerConnection.addTransceiver(R.track,R.init),this._reportRtcInvokeStatus("chromeHandler.addTrack",JSON.stringify({videoStreamTrack:Zi(R.track)})),E=this._inactiveMlineIndex.shift(),E||(E=this.peer._offerMlines.length),JS&&X.initVideoEncodedTransform());this.peer._offerMlines[E]=I({},N),g===Se.publish&&L&&(Oo(N,L),Oo($,L)),this.peer._answerMlines[E]=$}_.push(X.streamId||""),y.push(k?X.userId:"local"),k&&(X.sequenceId=T.sequenceId)}}}catch(S){r=!0,s=S}finally{try{o&&a.return!=null&&await a.return()}finally{if(r)throw s}}}else{var u;const S={};p.forEach((v=>{const{audioMid:f,videoMid:g,action:Z}=v;S[f]=f,Z!==Se.removetrack&&(S[g]=g),S[f]=f})),this.peer._offerMlines=this.peer._offerMlines.map(((v,f)=>(v.mid&&S[v.mid]&&(v=an(v),this._inactiveMlineIndex.push(f)),v))),this._inactiveMlineIndex=[...new Set(this._inactiveMlineIndex)],en(u=this._inactiveMlineIndex).call(u,((v,f)=>v-f)),this.peer._answerMlines=this.peer._answerMlines.map((v=>(v.mid&&S[v.mid]&&(v=an(v)),v)))}try{await this.peer.getOriginRTCPeerConnection().createOffer(),await this.setDescription(_.length?{streamId:_.join(","),streamUserId:y.join(",")}:void 0)}catch(S){throw this._peerConnection.signalingState==="have-local-offer"&&await this._peerConnection.setLocalDescription({type:"rollback"}),S}try{b.forEach((S=>S()))}catch{}this.logger.info("dequeue","loop")}catch(p){this.logger.error("dequeue","unknown error: %o",p),i.forEach((h=>h(p)))}finally{this.dequeue()}}async getDefaultSdp(){const e=await this._genOfferSdp();this.createAVMlineOfferTpl(e);const i=z.parse(e),s=[];return i.media=i.media.filter((o=>o.direction==="recvonly"&&(Array.isArray(o.ext)&&(o.ext=o.ext.filter((r=>r.uri!=="urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"))),s.push("".concat(o.mid)),!0))),i.groups=[{mids:s.join(" "),type:"BUNDLE"}],ii&&Mi(i),{sdp:z.write(i),semantics:"unified-plan",type:"incroffer"}}async rollback(e){let{stream:i}=e;i instanceof un||await this.handleAck({action:Se.unsubscribe,streamId:i.streamId,audioMid:i.audioMid,videoMid:i.videoMid,stream:i}),delete i.audioMLine,delete i.videoMLine}createAVMlineOfferTpl(e){const i=z.parse(e);i.media.forEach((s=>{s.icePwd=this.peer._offerIce.icePwd,s.iceUfrag=this.peer._offerIce.iceUfrag,s.type==="audio"?s.direction==="sendonly"?this._aSendonlyOfferTpl=s:(Array.isArray(s.ext)&&(s.ext=s.ext.filter((o=>o.uri!=="urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"))),this._aRecvonlyOfferTpl=s):s.type==="video"&&(s.direction==="sendonly"?this._vSendonlyOfferTpl=s:(Array.isArray(s.ext)&&(s.ext=s.ext.filter((o=>o.uri!=="urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"))),this._vRecvonlyOfferTpl=s))})),ii&&Mi(i)}async _genOfferSdp(){let e;try{if(e=await rY(!0),!e)throw"pc.createOffer() return empty."}catch(i){const s="Get offer Error. ".concat(i.message|i);throw new G(C.NOT_SUPPORTED,s)}return e}}class dI extends Aa{constructor(e,i){var s;super(e,i),m(this,"name","firefox"),m(this,"_aRecvonlyOfferTpl",void 0),this.logger=new ue("FirefoxHandler",3,e.id),(s=this._context.monitor)===null||s===void 0||s.set({handler_mode:"firefox"})}async publish(e){var i,s;const{videoDescriptions:o,subVideoDescriptions:r,audioTransceiverInit:n,videoTransceiverInit:a}=super.internalPublish(e);e.audioTransceiver=this._peerConnection.addTransceiver(n.track,n.init),Array.isArray(a.init.sendEncodings)&&a.init.sendEncodings.length===1&&(a.init.sendEncodings=a.init.sendEncodings.map((y=>(delete y.rid,y)))),e.videoTransceiver=this._peerConnection.addTransceiver(a.track,a.init);const c=ee();this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0});const d=await this.peer.createOfferSdp();this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:ee()-c});const l=z.parse(d);l.media=(i=l.media)===null||i===void 0?void 0:i.map((y=>I(I({},y),this.peer._offerIce))),Mi(l),await this.setLocalDescription(z.write(l));const u=e.audioTransceiver.mid,p=e.videoTransceiver.mid;let h=null,_=null;return l.media=(s=l.media)===null||s===void 0?void 0:s.map((y=>{if("".concat(y.mid)===u){var b;h=y;const v=(b=h)===null||b===void 0?void 0:b.rtp.find((f=>f.codec==="opus"));if(v&&h.fmtp){var S;const f=h.fmtp.find((g=>g.payload===v.payload));f&&(S=this._context)!==null&&S!==void 0&&S.audioProfileManager&&(f.config=this._context.audioProfileManager.getOpusConfigStr(f.config))}}else"".concat(y.mid)===p&&(_=y);return y})),this.addBitrateLimit(_,e.videoEncodeConfig[0].maxKbps),await this.setLocalDescription(z.write(l)),e.initVideoEncodedTransform(),e.initAudioEncodedTransform(),{partialSdp:ao(l,h,_),audioMid:u,videoMid:p,type:"incroffer",semantics:"unified-plan",videoDescriptions:o,subVideoDescriptions:r,audioTransceiverInit:n,videoTransceiverInit:a,peerConnectionMode:this.peerConnectionMode}}async _internalChangePubCodec(){const{localDescription:e}=this._peerConnection;e&&(await this.peer.createOfferSdp(),await this._peerConnection.setLocalDescription(e))}async subscribe(e,i){var s,o,r,n;this.logger.info("subscribe()");let a,c,d="",l="",u=!1,p=!1;e.virtual?u=!0:(i.multiChatMode||(u=!0),p=!0),u&&(e.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),p&&(e.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}));const h=ee();this._report("rtc_begin_create_offer",{direction:"up",stream_id:e.streamId,stream_user_id:e.userId,pc_session_id:this.peerConnectionId,vendor_mode:0});const _=await this.peer.createOfferSdp();this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:e.streamId,stream_user_id:e.userId,elapse:ee()-h});const y=z.parse(_);let b,S;if(y.media=(s=y.media)===null||s===void 0?void 0:s.map((Z=>I(I({},Z),this.peer._offerIce))),y.media.map((Z=>{var R,T,X,L;Z.type==="video"&&(qr?(Z.ext=(R=Z.ext)===null||R===void 0?void 0:R.filter((W=>W.uri.indexOf("abs-send-time")===-1)),Z.rtcpFb=(T=Z.rtcpFb)===null||T===void 0?void 0:T.filter((W=>W.type!=="goog-remb"))):(Z.rtcpFb=(X=Z.rtcpFb)===null||X===void 0?void 0:X.filter((W=>W.type!=="transport-cc")),Z.ext=(L=Z.ext)===null||L===void 0?void 0:L.filter((W=>W.uri.indexOf("transport")===-1))))})),ii&&Mi(y),await this.setLocalDescription(z.write(y),{streamId:e.streamId||"",streamUserId:e.userId}),d=(o=e.audioTransceiver)===null||o===void 0?void 0:o.mid,l=(r=e.videoTransceiver)===null||r===void 0?void 0:r.mid,(n=y.media)===null||n===void 0||n.forEach((Z=>{"".concat(Z.mid)===d?a=Z:"".concat(Z.mid)===l&&(c=Z)})),d&&a||(d="audio_".concat(l),a=I(I({},this._aRecvonlyOfferTpl),{},{mid:d})),e.audioMid=d,e.videoMid=l,!i.multiChatMode&&!e.virtual&&this._aSendonlyAnswerTpl&&this._aSendonlyAnswerTpl){var v,f,g;b=rn(this._nextSsrc),this._nextSsrc=b.next;const Z=I(I(I({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:"".concat(e.streamId).concat((v=this._context)!==null&&v!==void 0&&v.avSync?"":"-audio"," ").concat(e.streamId,"-audio"),ssrcs:nn(e.streamId,"audio",b.audio)}),R=I(I(I({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:l,msid:"".concat(e.streamId).concat((f=this._context)!==null&&f!==void 0&&f.avSync?"":"-video"," ").concat(e.streamId,"-video")},Wa(e.streamId,b,{flexfec:this._enableSubFlexfec}));S={sdp:z.write(I(I({},this.peer._answerSession),{},{media:[Z,R]})),sequenceId:e.sequenceId?++e.sequenceId:0},(g=b)===null||g===void 0||delete g.next}return e.initVideoEncodedTransform(),e.initAudioEncodedTransform(),{partialSdp:ao(y,a,c,!1),audioMid:d,videoMid:l,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:e.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:e.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:b,peerConnectionMode:this.peerConnectionMode,signalingAck:S}}async handleAck(e){const{stream:i,action:s}=e;if(s===Se.removetrack)return"";if(s===Se.unpublish||s===Se.unsubscribe){try{await this.close(i),typeof e.onSuccess=="function"&&e.onSuccess()}catch(a){typeof e.onFail=="function"&&e.onFail(a)}return i.streamId||""}const{signalingAck:o,videoCodec:r}=e,n=z.parse(o.sdp);try{await this._internalSetRemoteDescription(n.media,i,r),typeof e.onSuccess=="function"&&e.onSuccess()}catch(a){typeof e.onFail=="function"&&e.onFail(a)}return""}async _internalSetRemoteDescription(e,i,s){var o,r;const n={},a=z.parse((o=this._peerConnection.remoteDescription)===null||o===void 0?void 0:o.sdp);a.media.forEach((l=>{l.mid!==void 0&&(n[l.mid]=l)})),e.forEach((l=>{if((l=I(I({},l),this.peer._answerIce)).type==="audio"&&(i.audioMid?(l.mid=i.audioMid,n[i.audioMid]=l):n[l.mid]=l),l.type==="video"){if(i instanceof un&&Zs<=87){const u={};Array.isArray(l.rtp)&&(l.rtp=l.rtp.filter((p=>p.codec!=="rtx"||(u[p.payload]=p.payload,!1)))),typeof l.payloads=="string"&&(l.payloads=l.payloads.split(" ").filter((p=>!u[p])).join(" ")),Array.isArray(l.fmtp)&&(l.fmtp=l.fmtp.filter((p=>!u[p.payload]))),Array.isArray(l.rtcpFb)&&(l.fmtp=l.fmtp.filter((p=>!u[p.payload])))}s&&Oo(l,s),i.videoMid?(l.mid=i.videoMid,n[i.videoMid]=l):n[l.mid]=l}}));const c=z.parse((r=this._peerConnection.localDescription)===null||r===void 0?void 0:r.sdp),d=c.media.map((l=>{const u=n[l.mid];return l.direction==="inactive"?l:u}));a.groups=c.groups,a.media=d,a.media.map((l=>{if(l.type==="video"){var u,p,h,_,y;qr?(l.ext=(u=l.ext)===null||u===void 0?void 0:u.filter((b=>b.uri.indexOf("abs-send-time")===-1)),l.rtcpFb=(p=l.rtcpFb)===null||p===void 0?void 0:p.filter((b=>b.type!=="goog-remb"))):(l.rtcpFb=(h=l.rtcpFb)===null||h===void 0?void 0:h.filter((b=>b.type!=="transport-cc")),l.ext=(_=l.ext)===null||_===void 0?void 0:_.filter((b=>b.uri.indexOf("transport")===-1))),Zs>=138&&(l.ext=(y=l.ext)===null||y===void 0?void 0:y.filter((b=>!b.uri.includes("sdes:mid"))))}})),ii&&Mi(a),await this.setRemoteDescription(z.write(a))}async getDefaultSdp(){const e=new RTCPeerConnection;e.addTransceiver("audio",{direction:"recvonly"}),e.addTransceiver("video",{direction:"recvonly"});const i=await e.createOffer(),s=z.parse(i.sdp);this.createAVMlineOfferTpl(i.sdp);const o=[];return s.media=s.media.filter((r=>{if(r.direction==="recvonly"){const n="template_".concat(r.type);return r.mid=n,o.push(n),!0}return!1})),ii&&Mi(s),s.groups=[{mids:o.join(" "),type:"BUNDLE"}],e.close(),{sdp:z.write(s),semantics:"unified-plan",type:"incroffer"}}async rollback(e){let{msid:i,stream:s,audioMid:o,videoMid:r}=e;return this.logger.warn("rollback()"),this.close(s,o,r)}async close(e,i,s){var o;this.logger.info("close()");const r=e.audioMid||i,n=e.videoMid||s,a={};e.audioTransceiver&&r&&(e.audioTransceiver.stop(),a[r]=r),e.videoTransceiver&&n&&(e.videoTransceiver.stop(),a[n]=n);const c=[],d=await this.peer.createOfferSdp(),l=z.parse(d);l.media=l.media.map((h=>(a[h.mid]&&(h=an(h)),h.direction!=="inactive"&&c.push(h.mid),I(I({},h),this.peer._offerIce))));const u=z.parse((o=this._peerConnection.remoteDescription)===null||o===void 0?void 0:o.sdp),p={};u.media.forEach((h=>{h.mid!==void 0&&(p[h.mid]=h)})),u.media=l.media.map((h=>h.direction==="inactive"?h:p[h.mid])),l.groups&&u.groups&&(l.groups[0].mids=c.join(" "),u.groups[0].mids=c.join(" ")),await this.setLocalDescription(z.write(l)),await this.setRemoteDescription(z.write(u))}async setCurrentDescription(){await this.peer.createOfferSdp(),this._peerConnection.localDescription&&this._peerConnection.remoteDescription&&(await this._peerConnection.setLocalDescription(this._peerConnection.localDescription),await this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription))}createAVMlineOfferTpl(e){const i=z.parse(e);i.media.forEach((s=>{s.type==="audio"&&(this._aRecvonlyOfferTpl=s)})),ii&&Mi(i)}}class cI extends Aa{constructor(e,i){var s,o;super(e,i),m(this,"name","fallback"),m(this,"_aRecvonlyOfferTpl",void 0),this.logger=new ue("FallbackHandler",3,e.id),this.logger.warn("ctor","using fallback handler"),(s=this._context.monitor)===null||s===void 0||s.report("rtc_error",{message:"using fallback handler",error_code:-1}),(o=this._context.monitor)===null||o===void 0||o.set({handler_mode:"fallback"})}async publish(e){var i;const{videoDescriptions:s,subVideoDescriptions:o,audioTransceiverInit:r,videoTransceiverInit:n}=super.internalPublish(e);e.audioTransceiver=this._peerConnection.addTransceiver(r.track,r.init),Array.isArray(n.init.sendEncodings)&&n.init.sendEncodings.length===1&&(n.init.sendEncodings=n.init.sendEncodings.map((_=>(delete _.rid,_)))),e.videoTransceiver=this._peerConnection.addTransceiver(n.track,n.init);const a=ee();this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0});const c=await this.peer.createOfferSdp();this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:ee()-a});const d=z.parse(c);await this.setLocalDescription(c);const l=e.audioTransceiver.mid,u=e.videoTransceiver.mid;let p=null,h=null;return d.media=(i=d.media)===null||i===void 0?void 0:i.map((_=>("".concat(_.mid)===l?p=_:"".concat(_.mid)===u&&(h=_),_))),e.initVideoEncodedTransform(),e.initAudioEncodedTransform(),{partialSdp:ao(d,p,h),audioMid:l,videoMid:u,type:"incroffer",semantics:"unified-plan",videoDescriptions:s,subVideoDescriptions:o,audioTransceiverInit:r,videoTransceiverInit:n,peerConnectionMode:this.peerConnectionMode}}async _internalChangePubCodec(){const{localDescription:e}=this._peerConnection;e&&(await this.peer.createOfferSdp(),await this._peerConnection.setLocalDescription(e))}async subscribe(e,i){var s,o,r;this.logger.info("subscribe()");let n,a,c="",d="",l=!1,u=!1;e.virtual?l=!0:(i.multiChatMode||(l=!0),u=!0),l&&(e.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),u&&(e.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}));const p=ee();this._report("rtc_begin_create_offer",{direction:"up",stream_id:e.streamId,stream_user_id:e.userId,pc_session_id:this.peerConnectionId,vendor_mode:0});const h=await this.peer.createOfferSdp();this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:e.streamId,stream_user_id:e.userId,elapse:ee()-p});const _=z.parse(h);let y,b;if(await this.setLocalDescription(h,{streamId:e.streamId||"",streamUserId:e.userId}),c=(s=e.audioTransceiver)===null||s===void 0?void 0:s.mid,d=(o=e.videoTransceiver)===null||o===void 0?void 0:o.mid,(r=_.media)===null||r===void 0||r.forEach((g=>{"".concat(g.mid)===c?n=g:"".concat(g.mid)===d&&(a=g)})),c&&n||(c="audio_".concat(d),n=I(I({},this._aRecvonlyOfferTpl),{},{mid:c})),e.audioMid=c,e.videoMid=d,!i.multiChatMode&&!e.virtual&&this._aSendonlyAnswerTpl&&this._aSendonlyAnswerTpl){var S,v,f;y=rn(this._nextSsrc),this._nextSsrc=y.next;const g=I(I(I({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:c,msid:"".concat(e.streamId).concat((S=this._context)!==null&&S!==void 0&&S.avSync?"":"-audio"," ").concat(e.streamId,"-audio"),ssrcs:nn(e.streamId,"audio",y.audio)}),Z=I(I(I({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:"".concat(e.streamId).concat((v=this._context)!==null&&v!==void 0&&v.avSync?"":"-video"," ").concat(e.streamId,"-video")},Wa(e.streamId,y,{flexfec:this._enableSubFlexfec}));b={sdp:z.write(I(I({},this.peer._answerSession),{},{media:[g,Z]})),sequenceId:e.sequenceId?++e.sequenceId:0},(f=y)===null||f===void 0||delete f.next}return e.initVideoEncodedTransform(),e.initAudioEncodedTransform(),{partialSdp:ao(_,n,a,!1),audioMid:c,videoMid:d,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:e.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:e.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:y,peerConnectionMode:this.peerConnectionMode,signalingAck:b}}async handleAck(e){const{stream:i,action:s}=e;if(s===Se.removetrack)return"";if(s===Se.unpublish||s===Se.unsubscribe){try{await this.close(i),typeof e.onSuccess=="function"&&e.onSuccess()}catch(a){typeof e.onFail=="function"&&e.onFail(a)}return i.streamId||""}const{signalingAck:o,videoCodec:r}=e,n=z.parse(o.sdp);try{await this._internalSetRemoteDescription(n.media,i,r),typeof e.onSuccess=="function"&&e.onSuccess()}catch(a){typeof e.onFail=="function"&&e.onFail(a)}return""}async _internalSetRemoteDescription(e,i,s){var o,r;const n={},a=z.parse((o=this._peerConnection.remoteDescription)===null||o===void 0?void 0:o.sdp);a.media.forEach((l=>{l.mid!==void 0&&(n[l.mid]=l)})),e.forEach((l=>{(l=I(I({},l),this.peer._answerIce)).type==="audio"&&(i.audioMid?(l.mid=i.audioMid,n[i.audioMid]=l):n[l.mid]=l),l.type==="video"&&(s&&Oo(l,s),i.videoMid?(l.mid=i.videoMid,n[i.videoMid]=l):n[l.mid]=l)}));const c=z.parse((r=this._peerConnection.localDescription)===null||r===void 0?void 0:r.sdp),d=c.media.map((l=>{const u=n[l.mid];return l.direction==="inactive"?l:u}));a.groups=c.groups,a.media=d,a.media.map((l=>{var u,p,h,_;l.type==="video"&&(qr?(l.ext=(u=l.ext)===null||u===void 0?void 0:u.filter((y=>y.uri.indexOf("abs-send-time")===-1)),l.rtcpFb=(p=l.rtcpFb)===null||p===void 0?void 0:p.filter((y=>y.type!=="goog-remb"))):(l.rtcpFb=(h=l.rtcpFb)===null||h===void 0?void 0:h.filter((y=>y.type!=="transport-cc")),l.ext=(_=l.ext)===null||_===void 0?void 0:_.filter((y=>y.uri.indexOf("transport")===-1))))})),await this.setRemoteDescription(z.write(a))}async getDefaultSdp(){const e=new RTCPeerConnection;e.addTransceiver("audio",{direction:"recvonly"}),e.addTransceiver("video",{direction:"recvonly"});const i=await e.createOffer(),s=z.parse(i.sdp);this.createAVMlineOfferTpl(i.sdp);const o=[];return s.media=s.media.filter((r=>{if(r.direction==="recvonly"){const n="template_".concat(r.type);return r.mid=n,o.push(n),!0}return!1})),s.groups=[{mids:o.join(" "),type:"BUNDLE"}],e.close(),{sdp:z.write(s),semantics:"unified-plan",type:"incroffer"}}async rollback(e){let{msid:i,stream:s,audioMid:o,videoMid:r}=e;return this.logger.warn("rollback()"),this.close(s,o,r)}async close(e,i,s){var o;this.logger.info("close()");const r=e.audioMid||i,n=e.videoMid||s,a={};e.audioTransceiver&&r&&(e.audioTransceiver.stop(),a[r]=r),e.videoTransceiver&&n&&(e.videoTransceiver.stop(),a[n]=n);const c=[],d=await this.peer.createOfferSdp(),l=z.parse(d);l.media=l.media.map((h=>(a[h.mid]&&(h=an(h)),h.direction!=="inactive"&&c.push(h.mid),I(I({},h),this.peer._offerIce))));const u=z.parse((o=this._peerConnection.remoteDescription)===null||o===void 0?void 0:o.sdp),p={};u.media.forEach((h=>{h.mid!==void 0&&(p[h.mid]=h)})),u.media=l.media.map((h=>h.direction==="inactive"?h:p[h.mid])),l.groups&&u.groups&&(l.groups[0].mids=c.join(" "),u.groups[0].mids=c.join(" ")),await this.setLocalDescription(d),await this.setRemoteDescription(z.write(u))}async setCurrentDescription(){await this.peer.createOfferSdp(),this._peerConnection.localDescription&&this._peerConnection.remoteDescription&&(await this._peerConnection.setLocalDescription(this._peerConnection.localDescription),await this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription))}createAVMlineOfferTpl(e){z.parse(e).media.forEach((i=>{i.type==="audio"&&(this._aRecvonlyOfferTpl=i)}))}}var gD=Object.defineProperty,fD=Object.getOwnPropertyDescriptor,US=(t,e,i,s)=>{for(var o,r=fD(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&gD(e,i,r),r};class AS{constructor(e){m(this,"_queue",[]),m(this,"_runningTask",[]),m(this,"executor",void 0),m(this,"busy",!1),this.executor=e}add(e){const{promise:i,resolve:s,reject:o}=lI();return this._queue.push({item:e,resolve:s,reject:o}),this.busy||this._emit(),i}destroy(){[...this._queue,...this._runningTask].forEach((e=>{let{reject:i}=e;i(new G(C.OPERATION_CANCEL,"queue close"))})),this.busy=!1,this._queue=[]}async _emit(){const e=this._queue;if(this._runningTask=e,this._queue=[],e.length===0)return void(this.busy=!1);const i=e.map((r=>r.item)),s=e.map((r=>r.resolve)),o=e.map((r=>r.reject));try{this.busy=!0;const r=await this.executor(i);s.forEach((n=>n(r)))}catch(r){o.forEach((n=>n(r)))}this._runningTask=[],setTimeout((()=>{this._emit()}))}}function DS(){return cs()||Qo()}class kh extends Aa{constructor(e,i){var s;super(e,i),m(this,"name","standard"),m(this,"_applyQueue",new AS(this.apply.bind(this))),m(this,"_createQueue",new AS(this.create.bind(this))),m(this,"_pqueue",new ID),m(this,"_midMap",new Map),m(this,"_aRecvonlyOfferTpl",void 0),this.logger=new ue("StandardHandler",3,e.id),this.logger.warn("ctor","using standard handler"),(s=this._context.monitor)===null||s===void 0||s.set({handler_mode:"standard"})}async publish(e){var i;this.logger.info("publish()","streamId: ".concat(e.streamId));const{videoDescriptions:s,subVideoDescriptions:o,audioTransceiverInit:r,videoTransceiverInit:n}=super.internalPublish(e);e.audioTransceiver=this._peerConnection.addTransceiver(r.track,I(I({},r.init),{},{direction:"sendonly"})),Array.isArray(n.init.sendEncodings)&&n.init.sendEncodings.length===1&&(n.init.sendEncodings=n.init.sendEncodings.map((_=>(delete _.rid,_)))),e.videoTransceiver=this._peerConnection.addTransceiver(n.track,I(I({},n.init),{},{direction:"sendonly"}));const a=ee();this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0});const c=await this._createQueue.add();this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:ee()-a});const d=e.audioTransceiver.mid,l=e.videoTransceiver.mid;Gr(d&&l,"Transceiver not return MID after setLocalDescription"),e.audioMid=d,e.videoMid=l;let u=null,p=null;const h=z.parse(c);return h.media=(i=h.media)===null||i===void 0?void 0:i.map((_=>("".concat(_.mid)===d?u=_:"".concat(_.mid)===l&&(p=_),_))),DS()&&(e.initVideoEncodedTransform(),e.initAudioEncodedTransform()),{partialSdp:ao(h,u,p),audioMid:d,videoMid:l,type:"incroffer",semantics:"unified-plan",videoDescriptions:s,subVideoDescriptions:o,audioTransceiverInit:r,videoTransceiverInit:n,peerConnectionMode:this.peerConnectionMode}}async subscribe(e,i){var s,o,r,n,a;this.logger.info("subscribe()","streamId: ".concat(e.streamId));let c,d,l=!1,u=!1;e.virtual?l=!0:(i.multiChatMode||(l=!0),u=!0),l&&(e.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),u&&(e.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}));const p=ee();this._report("rtc_begin_create_offer",{direction:"up",stream_id:e.streamId,stream_user_id:e.userId,pc_session_id:this.peerConnectionId,vendor_mode:0});const h=await this._createQueue.add();this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:e.streamId,stream_user_id:e.userId,elapse:ee()-p});let _=(s=(o=e.audioTransceiver)===null||o===void 0?void 0:o.mid)!==null&&s!==void 0?s:void 0;const y=(r=(n=e.videoTransceiver)===null||n===void 0?void 0:n.mid)!==null&&r!==void 0?r:void 0,b=z.parse(h);let S,v;if((a=b.media)===null||a===void 0||a.forEach((R=>{"".concat(R.mid)===_?c=R:"".concat(R.mid)===y&&(d=R)})),_&&c||(_="audio_".concat(y),c=I(I({},this._aRecvonlyOfferTpl),{},{mid:_})),e.audioMid=_,e.videoMid=y,!i.multiChatMode&&!e.virtual&&this._aSendonlyAnswerTpl&&this._aSendonlyAnswerTpl){var f,g,Z;S=this._generateAllSsrc();const R=I(I(I({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:_,msid:"".concat(e.streamId).concat((f=this._context)!==null&&f!==void 0&&f.avSync?"":"-audio"," ").concat(e.streamId,"-audio"),ssrcs:nn(e.streamId,"audio",S.audio)}),T=I(I(I({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:y,msid:"".concat(e.streamId).concat((g=this._context)!==null&&g!==void 0&&g.avSync?"":"-video"," ").concat(e.streamId,"-video")},Wa(e.streamId,S,{flexfec:this._enableSubFlexfec}));v={sdp:z.write(I(I({},this.peer._answerSession),{},{media:[R,T]})),sequenceId:e.sequenceId?++e.sequenceId:0},(Z=S)===null||Z===void 0||delete Z.next}return DS()&&(e.initVideoEncodedTransform(),e.initAudioEncodedTransform()),{partialSdp:ao(b,c,d,!1),audioMid:_,videoMid:y||"",type:"incroffer",semantics:"unified-plan",audioTransceiverInit:e.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:e.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:S,peerConnectionMode:this.peerConnectionMode,signalingAck:v}}async handleAck(e){const{stream:i,action:s}=e;if(s===Se.removetrack)return"";if(s===Se.unpublish||s===Se.unsubscribe){try{await this.close(i),typeof e.onSuccess=="function"&&e.onSuccess()}catch(a){typeof e.onFail=="function"&&e.onFail(a)}return i.streamId||""}const{signalingAck:o,videoCodec:r}=e,n=z.parse(o.sdp);try{await this._internalSetRemoteDescription(n.media,i,r),typeof e.onSuccess=="function"&&e.onSuccess()}catch(a){typeof e.onFail=="function"&&e.onFail(a)}return""}async _internalSetRemoteDescription(e,i,s){e.forEach((o=>{(o=I(I({},o),this.peer._answerIce)).type==="audio"&&(i.audioMid?(o.mid=i.audioMid,this._midMap.set(i.audioMid,o)):this._midMap.set(o.mid,o)),o.type==="video"&&(s&&Oo(o,s),i.videoMid?(o.mid=i.videoMid,this._midMap.set(i.videoMid,o)):this._midMap.set(o.mid,o))})),i instanceof un?this.handlePublishAction({stream:i,videoCodec:s}):this.handleSubscribeAction({stream:i}),await this._applyQueue.add()}handlePublishAction(e){var i;const{videoCodec:s,stream:o}=e,r=o.audioMid?this._midMap.get(o.audioMid):void 0,n=o.videoMid?this._midMap.get(o.videoMid):void 0;this._context.pcKillSwitch.sld_rtcpfb_rrtr_add&&ii&&(gt.addRRTR(r),gt.addRRTR(n));const a=(i=this._context.serverConfig)!==null&&i!==void 0&&i.audioRed?"RED":ae("AUDIO_CODEC");a!=="OPUS"&&r&&Ih(r,a),this._context.pcKillSwitch.sld_fmtp_opus_add&&gt.decorateOpusConfig(r,this._context.audioProfileManager),Te&&Zs<=87&&gt.removeRtxInMLine(n),s&&n&&Oo(n,s),this._context.pcKillSwitch.sld_ext_sdesmid_remove&&Te&&Zs>=138&&gt.removeExtSdesMid(n),this._context.pcKillSwitch.sld_fmtp_bitrate_add&&(o.enableSimulcast||Dt||!n||this.addBitrateLimit(n,o.videoEncodeConfig[0].maxKbps)),Te&&gt.selectCC(n,qr?"tcc":"remb"),o.audioMid&&r&&this._midMap.set(o.audioMid,r),o.videoMid&&n&&this._midMap.set(o.videoMid,n)}handleSubscribeAction(e){const{stream:i}=e,s=i.audioMid?this._midMap.get(i.audioMid):void 0,o=i.videoMid?this._midMap.get(i.videoMid):void 0;Te||(gt.removeRtpStreamId(s),gt.removeRtpStreamId(o)),this._context.pcKillSwitch.sld_rtcpfb_rrtr_add&&ii&&(gt.addRRTR(s),gt.addRRTR(o)),this._context.pcKillSwitch.sld_fmtp_opus_add&&gt.decorateOpusConfig(s),ae("IOS_SAFARI_ORIENTATION")||!Dt&&!yo||gt.removeExtVideoOrientation(o),this._context.pcKillSwitch.sld_fmtp_sps_add&&i.isPublic&&gs&&qt>=86&&gt.decorateSpsPpsIdrInKeyframe(o),i.audioMid&&s&&this._midMap.set(i.audioMid,s),i.videoMid&&o&&this._midMap.set(i.videoMid,o)}async getDefaultSdp(){const e=new RTCPeerConnection;e.addTransceiver("audio",{direction:"recvonly"}),e.addTransceiver("video",{direction:"recvonly"});const i=await e.createOffer(),s=z.parse(i.sdp);this.createAVMlineOfferTpl(i.sdp);const o=[];return s.media=s.media.filter((r=>{if(r.direction==="recvonly"){const n="template_".concat(r.type);return r.mid=n,o.push(n),!0}return!1})),ii&&Mi(s),s.groups=[{mids:o.join(" "),type:"BUNDLE"}],e.close(),{sdp:z.write(s),semantics:"unified-plan",type:"incroffer"}}async rollback(e){let{msid:i,stream:s,audioMid:o,videoMid:r}=e;return this.logger.warn("rollback()"),this.close(s,o,r)}async close(e,i,s){this.logger.info("close()");const o=e.audioMid||i,r=e.videoMid||s;if(e.audioTransceiver&&o)try{e.audioTransceiver.stop(),delete e.audioTransceiver}catch{}if(e.videoTransceiver&&r)try{e.videoTransceiver.stop(),delete e.videoTransceiver}catch{}const n=o?this._midMap.get(o):void 0,a=r?this._midMap.get(r):void 0;n&&an(n),a&&an(a),o&&n&&this._midMap.set(o,n),r&&a&&this._midMap.set(r,a),await this._applyQueue.add()}async setCurrentDescription(){await this._applyQueue.add()}createAVMlineOfferTpl(e){z.parse(e).media.forEach((i=>{i.type==="audio"&&(this._aRecvonlyOfferTpl=i)}))}_generateAllSsrc(){const e=rn(this._nextSsrc);return this._nextSsrc=e.next,e}async create(){this.logger.info("RTCPeerConnection create");const e=await this.peer.createOfferSdp();return Gr(e,"RTCPeerConnection not return SDP"),await this.peer.setLocalDescription(e),e}async apply(){this.logger.info("RTCPeerConnection apply");let e=await this.peer.createOfferSdp();Gr(e,"RTCPeerConnection not return SDP",e);const i=z.parse(e);e=this.generateOffer(i,e);const s=this.generateAnswer(i);await this.setLocalDescription(e),await this.setRemoteDescription(s)}generateOffer(e,i){let s=!1;return this.peer.getIceVersion()==="v1"&&Te&&(e.media=e.media.map((o=>I(I({},o),this.peer._offerIce))),s=!0),this._context.pcKillSwitch.sld_fmtp_opus_add&&(e.media=e.media.map((o=>{if(o.type==="audio"){const r=o.direction==="sendonly";gt.decorateOpusConfig(o,r?this._context.audioProfileManager:void 0)}return o})),s=!0),this._context.pcKillSwitch.sld_rtcpfb_rrtr_add&&(e.media=e.media.map((o=>(!ii||o.type!=="audio"&&o.type!=="video"||gt.addRRTR(o),o))),s=!0),s?z.write(e):i}generateAnswer(e){const i=[];return e.media.forEach((s=>{if(s.type==="application"){Gr(s.mid!==void 0,"should always have mid in mline",s);let n=this._midMap.get(s.mid);return n||(n=this.generateDCAnswer(s),this._midMap.set(s.mid,n)),void i.push(I({},n))}const o="".concat(s.mid);Gr(o,"No MID in offer m-line: ".concat(s));let r=this._midMap.get(o);r||(this.logger.info("generateInactiveAnswerMLine","mid: %o, mLine: %o",s.mid,s),r=this.generateInactiveAnswerMLine(s)),i.push(r)})),this.peer.createAnswerSdp(i,e.groups)}generateInactiveAnswerMLine(e){return I(I(I({},e),this.peer._answerIce),{},{direction:"inactive"})}generateDCAnswer(e){const i=I(I(I({},e),this.peer._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}});return Te&&(delete i.bundleOnly,i.port=9),i}destroy(){super.destroy(),this._pqueue.destroy(),this._applyQueue.destroy(),this._createQueue.destroy()}}function ZD(t,e,i){const s=i.value;return i.value=async function(){const o=this.logger;o.info("SDP Lock","pending task %o",e);const r=await this._pqueue.enqueue(0);o.info("SDP Lock","running task %o",e);try{for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return await s?.apply(this,a)}finally{o.info("SDP Lock","unlocking by task %o",e),r()}},i}function TD(t,e,i){const s=i.value;return i.value=async function(){const o=this.logger;o.info("SDP Lock","pending task %o",e);const r=await this._pqueue.enqueue(1);o.info("SDP Lock","running task %o",e);try{for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return await s?.apply(this,a)}finally{o.info("SDP Lock","unlocking by task %o",e),r()}},i}US([ZD],kh.prototype,"create"),US([TD],kh.prototype,"apply");const gt={decorateOpusConfig(t,e){if(!t)return;const i=t?.rtp.find((o=>o.codec==="opus"));if(!i||!t.fmtp)return;const s=t.fmtp.find((o=>o.payload===i.payload));s&&(e&&(s.config=e.getOpusConfigStr(s.config)),s.config=RD(s.config))},removeRtxInMLine(t){var e;if(!t)return;const i=[];t.rtp=t.rtp.filter((s=>(s.codec==="rtx"&&i.push(s.payload),s.codec!=="rtx"))),t.fmtp=t.fmtp.filter((s=>i.includes(s.payload))),t.payloads=(e=t.payloads)===null||e===void 0?void 0:e.split(" ").filter((s=>!i.includes(parseInt(s)))).join(" ")},removeExtSdesMid(t){var e;t&&(t.ext=(e=t.ext)===null||e===void 0?void 0:e.filter((i=>!i.uri.includes("sdes:mid"))))},selectCC(t,e){var i,s;if(t){if(e==="tcc")t.ext=(i=t.ext)===null||i===void 0?void 0:i.filter((n=>n.uri.indexOf("abs-send-time")===-1)),t.rtcpFb=(s=t.rtcpFb)===null||s===void 0?void 0:s.filter((n=>n.type!=="goog-remb"));else if(e==="remb"){var o,r;t.rtcpFb=(o=t.rtcpFb)===null||o===void 0?void 0:o.filter((n=>n.type!=="transport-cc")),t.ext=(r=t.ext)===null||r===void 0?void 0:r.filter((n=>n.uri.indexOf("transport")===-1))}}},addRRTR(t){t&&t.rtp.forEach((e=>{t.rtcpFb||(t.rtcpFb=[]),t.rtcpFb.find((i=>i.payload===e.payload&&i.type==="rrtr"))||t.rtcpFb.push({payload:e.payload,type:"rrtr"})}))},removeRtpStreamId(t){t&&Array.isArray(t.ext)&&(t.ext=t.ext.filter((e=>e.uri!=="urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id")))},decorateSpsPpsIdrInKeyframe(t){if(!t)return;const e=t.rtp.filter((i=>i.codec==="H264"));e.length&&t.fmtp&&t.fmtp.forEach((i=>{e.find((s=>s.payload===i.payload))&&(i.config+=";sps-pps-idr-in-keyframe=1")}))},removeExtVideoOrientation(t){t&&Array.isArray(t.ext)&&(t.ext=t.ext.filter((e=>!e.uri.includes("video-orientation"))))},removeExtFramemarking(t){t&&Array.isArray(t.ext)&&(t.ext=t.ext.filter((e=>!e.uri.includes("framemarking"))))}};class ID{constructor(){m(this,"queue",[]),m(this,"processing",!1)}async enqueue(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const{promise:i,resolve:s}=lI(),o={priority:e,resolve:s},r=this.queue.findIndex((n=>n.priority>e));return r===-1?this.queue.push(o):this.queue.splice(r,0,o),this.tryProcess(),await i,this.processing=!0,()=>{this.processing=!1,this.tryProcess()}}destroy(){this.queue.forEach((e=>{let{resolve:i}=e;i()})),this.queue=[],this.processing=!1}tryProcess(){if(this.processing)return;const e=this.queue.shift();e&&e.resolve()}}function lI(){let t,e;const i=new Promise(((s,o)=>{t=s,e=o}));if(!t||!e)throw Error("Broken Implement of Promise");return{promise:i,resolve:t,reject:e}}const RD=t=>{const e={};return t.split(";").forEach((i=>{const[s,o]=i.split("=");s&&o&&(e[s]=o)})),e["sprop-stereo"]=1,e.stereo=1,Object.keys(e).map((i=>"".concat(i,"=").concat(e[i]))).join(";")},XD=(t,e)=>t.enableFallbackHandler?new cI(t,e):t.enableStandardHandler?new kh(t,e):Te?new dI(t,e):new vD(t,e),CD={[ut.ICE_FAILED]:Os.ICE_FAILED,[ut.DC_ERROR]:Os.ICE_FAILED,[ut.DC_CLOSE]:Os.ICE_FAILED,[ut.NODE_CHANGE]:Os.NODE_CHANGE,[ut.NOTIFY_RECONNECT]:Os.NOTIFY_RECONNECT,[ut.JOIN_TIMEOUT]:Os.JOIN_TIMEOUT};class LD extends Vt{constructor(e){super(),m(this,"_connectionManager",void 0),m(this,"_dataChannelSignal",void 0),m(this,"_state",void 0),m(this,"_connectionLostTimer",void 0),m(this,"_isReconnecting",!1),m(this,"logger",void 0),this._ctx=e,this.logger=new ue("SignalingManager",1,e.id),this.logger.info("constructor","invoke"),this._connectionManager=new PO(e),this._addConnectorHandler()}connect(){return this.isConnected()?Promise.resolve():new Promise(((e,i)=>{this._connectionManager.once("connected",(()=>e())),this._connectionManager.once("disconnected",i),this._connectionManager.startup()}))}reconnect(e,i){this._connectionManager.reconnect(e,i)}sendSignaling(e,i,s,o){if(!this._dataChannelSignal)throw new G(C.NOT_CONNECTED_YET,"signaling channel is not connected");return this._dataChannelSignal.sendSignaling(e,i,s,o)}sendP2PMessage(e,i){if(!this._dataChannelSignal)throw new G(C.NOT_CONNECTED_YET,"signaling channel is not connected");return this._dataChannelSignal.sendP2PMessage(e,i)}destroy(){var e,i;this.logger.info("destroy()"),this._clearConnectionLostTimer(),this._connectionManager.shotdown(),(e=this._ctx.handler)===null||e===void 0||e.destroy(),this._ctx.handler=void 0,(i=this._dataChannelSignal)===null||i===void 0||i.destroy(),this._state&&this._setState(fe.CONNECTION_STATE_DISCONNECTED),this.removeAllListeners()}isConnected(){return this._state===fe.CONNECTION_STATE_CONNECTED||this._state===fe.CONNECTION_STATE_RECONNECTED}isReconnecting(){return this._state===fe.CONNECTION_STATE_CONNECTING||this._state===fe.CONNECTION_STATE_RECONNECTING}_setState(e,i){if(this._state===e)return;this._state=e;const s={state:e};i&&(s.reason=CD[i]||Os.ICE_FAILED),this.safeEmit(Fe.ON_CONNECTION_STATE_CHANGE,s)}_addConnectorHandler(){var e=this;this._connectionManager.on("connected",(i=>{var s;this.logger.info("connectStateChange","connected"),this._clearConnectionLostTimer(),(s=this._dataChannelSignal)===null||s===void 0||s.destroy(),this._ctx.peerConnection=i.pc,this._ctx.handler=XD(this._ctx,i.pc),this._dataChannelSignal=i.signaling,this._addSignalEventHandler(),this._setState(this._isReconnecting?fe.CONNECTION_STATE_RECONNECTED:fe.CONNECTION_STATE_CONNECTED)})),this._connectionManager.on("disconnected",(i=>{this._clearConnectionLostTimer(),this._setState(fe.CONNECTION_STATE_DISCONNECTED),this.logger.error("connectStateChange","disconnected. %o",i.message),this._isReconnecting&&this.safeEmit(Fe.ON_RECONNECT_FAILED)})),this._connectionManager.on("connecting",(()=>{this._isReconnecting=!1,this._ctx.handler=void 0,this._setState(fe.CONNECTION_STATE_CONNECTING),this.logger.info("connectStateChange","connecting")})),this._connectionManager.on("reconnecting",(i=>{this._setState(fe.CONNECTION_STATE_DISCONNECTED,i),this._connectionLostTimer||(this._connectionLostTimer=setTimeout((()=>{this.safeEmit(Fe.ON_CONNECTION_STATE_CHANGE,{state:fe.CONNECTION_STATE_LOST})}),1e4)),this._isReconnecting=!0,this._ctx.handler=void 0,this._setState(fe.CONNECTION_STATE_RECONNECTING,i),this.logger.warn("connectStateChange","reconnecting")})),this._connectionManager.on("connectWidthTcp",(()=>{this.safeEmit(Fe.CONNECT_WITH_TCP)})),["__onGetIceConfigHook","__onIceConnectSuccessHook","__onConnectSuccessHook","__startIceConnect_hook"].forEach((i=>{this._connectionManager.on(i,(function(){for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return e.emit(i,...o)}))})),this._connectionManager.on("joinRoomFailedPrivateCallback",(i=>{this.safeEmit(Fe.JOIN_ROOM_FAILED_PRIVATE_CALLBACK,i)}))}_clearConnectionLostTimer(){this._connectionLostTimer&&(clearTimeout(this._connectionLostTimer),delete this._connectionLostTimer)}_addSignalEventHandler(){var e,i;[O.ON_ADD_STREAM,O.ON_ADD_STREAM_LIST,O.ON_REMOVE_STREAM,O.ON_REMOVE_STREAM_LIST,O.USER_CONNECTION,O.USER_CONNECTION_LIST,O.USER_DISCONNECTION,O.USER_DISCONNECTION_LIST,O.ON_UPDATE_STREAM_ATTRIBUTES,O.ON_UPDATE_ROOM_ATTRIBUTES,O.ON_PUSH_TRACK,O.ON_REMOVE_TRACK,O.ON_CUSTOM_MESSAGE,O.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,O.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,O.USER_MESSAGE_RECEIVED,O.USER_BINARY_MESSAGE_RECEIVED,O.POST_PROCESSING_MESSAGE,O.ON_USER_TOKEN_WILL_EXPIRE,O.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE,O.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED,O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE,O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED,O.STREAM_CONTROL_MESSAGE,O.ENGINE_CONTROL_MESSAGE,O.ON_UPDATE_USER_ATTRIBUTES,O.ON_SPEAKER_CHANGE,O.ON_STREAM_FAILED,O.ON_FORWARD_DST_ROOM_USER_KICK,O.ON_STREAM_PULL_STATE_CHANGED,O.ON_STREAM_PUSHED_BY_OTHER,ds.RSCP,ds.RTT,ds.SSC].forEach((s=>{var o;(o=this._dataChannelSignal)===null||o===void 0||o.on(s,(r=>{this.safeEmit(s,r)}))})),(e=this._dataChannelSignal)===null||e===void 0||e.on(O.NODE_CHANGE,(s=>{this._connectionManager.reconnectByNodeChange(s)})),(i=this._dataChannelSignal)===null||i===void 0||i.on(O.ON_NOTIFY_RECONNECT,(()=>{this._connectionManager.reconnect(ut.NOTIFY_RECONNECT)}))}}const Cm=new ue("Locker",2);let WD=1;class Ni{constructor(e){m(this,"lockingPromise",Promise.resolve()),m(this,"locks",0),m(this,"name",""),m(this,"lockId",void 0),m(this,"closeReason",void 0),this.lockId=WD++,e&&(this.name=e),Cm.info("lock-".concat(this.name,"-").concat(this.lockId),"is created.")}get isLocked(){return this.locks>0}lock(){let e;this.locks+=1,Cm.info("lock-".concat(this.name,"-").concat(this.lockId),"locked, current queue ".concat(this.locks,"."));const i=new Promise((o=>{e=()=>{this.locks-=1,Cm.info("lock-".concat(this.name,"-").concat(this.lockId),"unlocked, current queue ".concat(this.locks,".")),o()}})),s=this.lockingPromise.then((()=>e));return this.lockingPromise=this.lockingPromise.then((()=>i)),s}}var xh=(t=>(t.NORMAL_USER="normalUser",t.SILENT_USER="silentUser",t))(xh||{});const Sr=[{maxLayers:3,totalPixels:2073600},{maxLayers:3,totalPixels:921600},{maxLayers:3,totalPixels:518400},{maxLayers:2,totalPixels:230400},{maxLayers:2,totalPixels:129600},{maxLayers:1,totalPixels:57600},{maxLayers:1,totalPixels:0}],GD=(t,e)=>{const i=Sr.findIndex((r=>t*e>=r.totalPixels)),s=t*e;if(i===0)return Sr[i].maxLayers;const o=Sr[i-1].totalPixels;return(o-s)/(o-Sr[i].totalPixels)<.1?Sr[i-1].maxLayers:Sr[i].maxLayers};function zS(t,e,i){var s;const o=t?(s=i.find((r=>r.rid===t)))===null||s===void 0?void 0:s.maxkbps:i[0].maxkbps;return Math.min(o??Number.POSITIVE_INFINITY,e)}const QS=(t,e)=>{var i,s,o,r;let n=0,a=-1;const{videoDescriptions:c,subVideoDescriptions:d}=e?.attributes||{},l=Array.isArray(d)?d:c;let u=-1;const p=t.width*t.height;for(let b=0;b<l?.length;b++){var h,_;if(p>=((h=l[b])===null||h===void 0?void 0:h.width)*((_=l[b])===null||_===void 0?void 0:_.height)){u=b;break}}let y=l[0];if(u===-1)u=l.length-1,y=l[u];else if(u!==0){const b=l[u-1].width*l[u-1].height,S=(b-p)/(b-l[u].width*l[u].height);y=S<.1?l[u-1]:l[u],u=S<.1?u-1:u}return a=(i=(s=y)===null||s===void 0?void 0:s.sub_index)!==null&&i!==void 0?i:-1,n=(o=(r=y)===null||r===void 0?void 0:r.video_index)!==null&&o!==void 0?o:u,{spatialLayer:n,spatialSubLayer:a}},vr=t=>({width:Ze(t.width),height:Ze(t.height),frameRate:Ze(t.frameRate),maxKbps:t.maxKbps}),gr=t=>{let{width:e,height:i}=t;return Ze(e)*Ze(i)},jS=(t,e)=>{const i=Ze(t.width)/Ze(e.width)||1,s=Ze(t.height)/Ze(e.height)||1;Math.floor(i)===i&&Math.floor(s)===s||As("setLocalSimulcastMode: The resolution setting needs to be an integer multiple")},VD=["preferCodecName"];class ED{constructor(e){m(this,"_captureDeviceId",void 0),m(this,"_contentHint",void 0),m(this,"_videoCaptureConf",I({},ud)),m(this,"_mainPreferCodec",void 0),m(this,"_screenPreferCodec",void 0),m(this,"_remoteVideoConfig",new Map),m(this,"_remoteSimulcastStreamType",new Map),m(this,"_simulcastMode",Qs.VIDEO_ONLY_ONE),m(this,"_highVideoEncodeConf",vr(ud)),m(this,"_midVideoEncodeConf",void 0),m(this,"_lowVideoEncodeConf",void 0),m(this,"_screenEncodeConfig",RK),m(this,"_invalidVideoEncodeConf",void 0),m(this,"activeSimStreams",[]),m(this,"_logger",void 0),m(this,"_apiVersion",void 0),this._ctx=e,this._logger=new ue("EngineVideoProfile",1,e.id)}setCaptureDeviceId(e){this._captureDeviceId=e}setCaptureConfig(e){this._videoCaptureConf=I(I({},this._videoCaptureConf),e)}getCaptureConfig(e){e=e||this._captureDeviceId;const i=I({},this._videoCaptureConf);return e==="user"||e==="environment"||e==="left"||e==="right"?(delete i.deviceId,i.facingMode=e):e&&(!Ew||yo?i.deviceId={exact:e}:delete i.deviceId),i}getContentHint(){return this._contentHint}getPreferCodec(e){return e?this._screenPreferCodec:this._mainPreferCodec}setRemoteUserVideoConfig(e,i){typeof i=="object"?this._remoteVideoConfig.set(e,i):this._remoteSimulcastStreamType.set(e,i)}getSubLayer(e,i){const s=this._remoteSimulcastStreamType.get(e.userId),o=this._remoteVideoConfig.get(e.userId);if(s){var r,n,a,c,d,l;const{videoDescriptions:u,subVideoDescriptions:p}=e.attributes||{},h=Array.isArray(p)?p:u;let _;return h.length===1?_=0:h.length===2?_=s===js.VIDEO_STREAM_HIGH?0:1:h.length>=3&&(_={[js.VIDEO_STREAM_HIGH]:0,[js.VIDEO_STREAM_MID]:1,[js.VIDEO_STREAM_LOW]:2}[s]),{spatialLayer:(r=(n=_&&((a=h[_])===null||a===void 0?void 0:a.video_index))!==null&&n!==void 0?n:_)!==null&&r!==void 0?r:0,spatialSubLayer:(c=(d=_&&((l=h[_])===null||l===void 0?void 0:l.sub_index))!==null&&d!==void 0?d:_)!==null&&c!==void 0?c:-1}}return o?QS(o,e):i?QS(i,e):void 0}getSimulcastMode(){return this._simulcastMode}async setSimulcastMode(e,i){if(!pK())throw new G(C.NOT_SUPPORTED,"Simulcast is not supported");if(this._simulcastMode!==e){if(i!=null&&i.hasPublished){var s,o;if((s=i.localStream)!==null&&s!==void 0&&s.videoHasPublish||(o=i.localStream)!==null&&o!==void 0&&o.audioHasPublish)throw new G(C.SET_SIMULCAST_FAILED,"Cannot change simulcast mode after publishing the video streams");this._logger.print("setSimulcastMode()","change simulcast mode and unpublish."),await i.unpublish()}this._simulcastMode=e,e!==Qs.VIDEO_ONLY_ONE&&this._autoGenerateSubVideoEncodeConfig()}}closeSimulcast(){this._simulcastMode=Qs.VIDEO_ONLY_ONE}async setVideoEncodeConfigPolyfill(e){if(Array.isArray(e)){gu(e);const[i,...s]=e;this.setVideoEncodeConfig(i),await this.setSubVideoEncodeConfig(Wg(s).call(s))}else this.setVideoEncodeConfig(e)}setVideoEncodeConfig(e){gu([e]);const i=this._midVideoEncodeConf||this._lowVideoEncodeConf;i&&gr(i)>=gr(e)?(this._logger.warn("setVideoEncodeConfig","smaller then substream"),this._invalidVideoEncodeConf=vr(e),e=i):delete this._invalidVideoEncodeConf;const s=I({},e),{preferCodecName:o}=s,r=bo(s,VD);ah(r),this._logger.print("setVideoEncodeConfig","update encode config",e),this._highVideoEncodeConf=vr(e),this._contentHint=r.contentHint,this._mainPreferCodec=o,this._logger.print("setVideoEncodeConfig","update capture config",r),this._videoCaptureConf=r}async setSubVideoEncodeConfig(e,i,s){if(this._logger.print("setSubVideoEncodeConfig","%o, published=%s",e,i?.hasPublished),e&&e.length>0){gu(e),en(e).call(e,((l,u)=>gr(l)-gr(u)));const n=this._invalidVideoEncodeConf||this._highVideoEncodeConf,a=e[e.length-1];if(gr(a)>=gr(n))throw new G(C.SET_SIMULCAST_FAILED,"The resolution cannot exceed the mainstream");if(i!=null&&i.hasPublished&&e.length!==this._getSubLayers().length){var o,r;if((o=i.localStream)!==null&&o!==void 0&&o.videoHasPublish||(r=i.localStream)!==null&&r!==void 0&&r.audioHasPublish)throw new G(C.SET_SIMULCAST_FAILED,"Cannot change the number of substreams after publishing the video streams");await i.unpublish()}e.length>2&&(ye(this._ctx.id,"simulcast_over_limit","setLocalSimulcastMode: You can set parameters for up to 2 streams"),As("setLocalSimulcastMode: You can set parameters for up to 2 streams"));const[c,d]=e;c&&(jS(n,c),this._lowVideoEncodeConf=vr(c)),d&&(jS(n,d),this._midVideoEncodeConf=vr(d)),this._invalidVideoEncodeConf&&(this.setVideoEncodeConfig(this._invalidVideoEncodeConf),await s?.updateVideoCaptureConfig(this._ctx.videoProfile.getCaptureConfig()))}else this._autoGenerateSubVideoEncodeConfig()}genVideoDescriptions(e){var i,s;const o=[];let r=[];const n=[],a=[];let{width:c,height:d,frameRate:l,maxKbps:u}=e.videoEncodeConfig[0];c=Ze(c),d=Ze(d);const p=(i=e.videoTrack)===null||i===void 0?void 0:i.preprocessingTrack,{width:h,height:_,frameRate:y}=(s=p?.getSettings())!==null&&s!==void 0?s:{};h&&(c=Math.floor(h)),_&&(d=Math.floor(_)),y&&(l=Math.floor(y)),(typeof l!="number"||Number.isNaN(l))&&(l=30),o.push({width:c,height:d,framerate:l,maxkbps:u,rid:"0"}),n.unshift({maxBitrate:1e3*u,rid:"0",maxFramerate:l});const{serverConfig:b}=this._ctx;if(!(e.isScreen||this._simulcastMode===Qs.VIDEO_ONLY_ONE||Te&&b?.videoCodec!=="VP8")){const S=GD(c,d);if(S>1){const v=this._getSubVideoEncodeConfig(S,{width:c,height:d});this._logger.info("simulcast() ","simulcastLayers: %o",v),a.push(!0),v.forEach(((f,g)=>{const Z={maxBitrate:1e3*f.maxkbps,scaleResolutionDownBy:f.scaleResolutionDownBy,rid:"".concat(g+1),maxFramerate:f.frameRate};n.unshift(Z),o.push({width:f.width,height:f.height,framerate:f.frameRate,maxkbps:f.maxkbps,rid:"".concat(g+1)}),a.push(!0)})),b!=null&&b.simulcastOnDemand&&(r=o.map(((f,g)=>I(I({},f),{},{video_index:g,sub_index:g}))))}}return b!=null&&b.e2eFeedback&&(r=o.map(((S,v)=>I(I({},S),{},{video_index:v,sub_index:v})))),{videoDescriptions:o,subVideoDescriptions:r,sendEncodings:n,activeSimulcastStreams:a}}getVideoEncodeConfig(){return[this._highVideoEncodeConf,this._midVideoEncodeConf,this._lowVideoEncodeConf].filter((e=>e))}setScreenEncodeConfig(e){this._screenEncodeConfig=e}getScreenEncodeConfig(){return this._screenEncodeConfig}checkSimulcastApiVersion(e){if(this._apiVersion){if(this._apiVersion!==e){const i="mixing old and new apis, please use ".concat(this._apiVersion==="new"?"setLocalSimulcastMode/setRemoteSimulcastStreamType":"enableSimulcastMode/setRemoteVideoConfig"," instead.");throw ye(this._ctx.id,"mixingOldAndNewApis",i),new G(C.MIXING_OLD_AND_NEW_APIS,i)}}else this._apiVersion=e}destroy(){this._videoCaptureConf=ud,this._highVideoEncodeConf=vr(ud),delete this._invalidVideoEncodeConf,this._remoteVideoConfig.clear(),this._remoteSimulcastStreamType.clear()}_autoGenerateSubVideoEncodeConfig(){this._logger.print("_autoGenerateSubVideoEncodeConfig()","generate low stream.");const e=this._highVideoEncodeConf,i=Ze(e.width),s=Ze(e.height),o=Math.min(i,s)/90;this._lowVideoEncodeConf={width:Math.floor(i/o),height:Math.floor(s/o),maxKbps:100,frameRate:10}}_getSubLayers(){const e=[];return this._midVideoEncodeConf&&e.push(this._midVideoEncodeConf),this._lowVideoEncodeConf&&e.push(this._lowVideoEncodeConf),e}_getSubVideoEncodeConfig(e,i){return this._getSubLayers().slice(1-e).map((s=>{if(s.width>s.height&&i.width<i.height||s.width<s.height&&i.width>i.height){const a=s.width;s.width=s.height,s.height=a}const o=Ze(s.width),r=Ze(s.height),n=Math.max(i.width/o,i.height/r);return{width:Math.floor(i.width/n),height:Math.floor(i.height/n),scaleResolutionDownBy:n,frameRate:Ze(s.frameRate)||15,maxkbps:s.maxKbps||600}}))}__autoResetVideoEncoderConfig(e){const i=IK(this.getVideoEncodeConfig(),e);i&&(this.setVideoEncodeConfigPolyfill(i),this._logger.print("autoResetVideoEncoderConfig() result",JSON.stringify(i)),ye(this._ctx.id,"autoResetVideoEncoderConfig",JSON.stringify(i)))}}class Lm{constructor(e){m(this,"_sendTimes",[]),m(this,"_bufferSizeLimit",void 0),m(this,"_totalSizeLimitPerSecond",void 0),m(this,"_limitModeInterval",void 0),m(this,"_limitModeQPS",void 0),m(this,"_interval",void 0),m(this,"_qps",void 0),this.setLimitMode(e)}setLimitMode(e){e===wo.LIMIT_MODE?(this._bufferSizeLimit=1,this._totalSizeLimitPerSecond=30720,this._limitModeInterval=1e3,this._limitModeQPS=60):(this._bufferSizeLimit=64,delete this._totalSizeLimitPerSecond,delete this._limitModeInterval,delete this._limitModeQPS)}setQPS(e,i){this._interval=e,this._qps=i}check(e){var i,s;const o=Date.now(),r=Uw(e,this._bufferSizeLimit);if(typeof this._totalSizeLimitPerSecond=="number"&&this._sendTimes.reduce(((c,d)=>o-d.ts<1e3?c+d.size:c),0)+r>this._totalSizeLimitPerSecond)throw new G(C.USER_MESSAGE_EXCEED_QPS,"user message exceed total size(".concat(this._totalSizeLimitPerSecond,")"));const n=(i=this._limitModeInterval)!==null&&i!==void 0?i:this._interval,a=(s=this._limitModeQPS)!==null&&s!==void 0?s:this._qps;if(typeof n=="number"&&typeof a=="number")if(this._sendTimes.length<a)this._sendTimes.push({ts:o,size:r});else{if(o-this._sendTimes[0].ts<n)throw new G(C.USER_MESSAGE_EXCEED_QPS,"user message exceed qps(".concat(a,")"));this._sendTimes.splice(0,1),this._sendTimes.push({ts:o,size:r})}}}var zr=(t=>(t[t.CAPTURE=0]="CAPTURE",t[t.PRE_PROCESSING=1]="PRE_PROCESSING",t[t.ENCODE=2]="ENCODE",t[t.TRANSFER=3]="TRANSFER",t[t.POST_PROCESSING=4]="POST_PROCESSING",t[t.DECODE=5]="DECODE",t[t.RENDERING=6]="RENDERING",t))(zr||{}),ln=(t=>(t[t.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",t[t.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",t))(ln||{});class PD{constructor(e){m(this,"_plugins",new Map),this.id=e}register(e){const i=this._plugins.get(e.type)||[];if(i.findIndex((s=>s.name===e.name))>-1)throw new Error("Failed to register ".concat(e.name,": name is repeated."));i.push(e),this._plugins.set(e.type,i)}getPluginsByType(e){return this._plugins.get(e)||[]}getPluginByName(e,i){return(this._plugins.get(e)||[]).find((s=>s.name===i))}async getPreProcessingTrack(e){const i=this._plugins.get(1)||[];let s=e.mediaTrack;for(const o of i)s=await o.effect(e,s);return s}destroy(){this._plugins.forEach((e=>{e.forEach((i=>i.destroy()))})),this._plugins.clear()}}const uI="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciB0PSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e307ZnVuY3Rpb24gZSh0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwiZGVmYXVsdCIpP3QuZGVmYXVsdDp0fWZ1bmN0aW9uIHIodCl7aWYodC5fX2VzTW9kdWxlKXJldHVybiB0O3ZhciBlPXQuZGVmYXVsdDtpZigiZnVuY3Rpb24iPT10eXBlb2YgZSl7dmFyIHI9ZnVuY3Rpb24gdCgpe2lmKHRoaXMgaW5zdGFuY2VvZiB0KXt2YXIgcj1bbnVsbF07cmV0dXJuIHIucHVzaC5hcHBseShyLGFyZ3VtZW50cyksbmV3KEZ1bmN0aW9uLmJpbmQuYXBwbHkoZSxyKSl9cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfTtyLnByb3RvdHlwZT1lLnByb3RvdHlwZX1lbHNlIHI9e307cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxPYmplY3Qua2V5cyh0KS5mb3JFYWNoKChmdW5jdGlvbihlKXt2YXIgbj1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsZSxuLmdldD9uOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0W2VdfX0pfSkpLHJ9dmFyIG49e2V4cG9ydHM6e319LGk9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuTWF0aD09PU1hdGgmJnR9LG89aSgib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXMmJmdsb2JhbFRoaXMpfHxpKCJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3cpfHxpKCJvYmplY3QiPT10eXBlb2Ygc2VsZiYmc2VsZil8fGkoIm9iamVjdCI9PXR5cGVvZiB0JiZ0KXx8aSgib2JqZWN0Ij09dHlwZW9mIHQmJnQpfHxmdW5jdGlvbigpe3JldHVybiB0aGlzfSgpfHxGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpLHM9ZnVuY3Rpb24odCl7dHJ5e3JldHVybiEhdCgpfWNhdGNoKGUpe3JldHVybiEwfX0sYT0hcygoZnVuY3Rpb24oKXt2YXIgdD1mdW5jdGlvbigpe30uYmluZCgpO3JldHVybiJmdW5jdGlvbiIhPXR5cGVvZiB0fHx0Lmhhc093blByb3BlcnR5KCJwcm90b3R5cGUiKX0pKSxjPWEsdT1GdW5jdGlvbi5wcm90b3R5cGUsbD11LmFwcGx5LGg9dS5jYWxsLGQ9Im9iamVjdCI9PXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmFwcGx5fHwoYz9oLmJpbmQobCk6ZnVuY3Rpb24oKXtyZXR1cm4gaC5hcHBseShsLGFyZ3VtZW50cyl9KSxmPWEscD1GdW5jdGlvbi5wcm90b3R5cGUsXz1wLmNhbGwsZz1mJiZwLmJpbmQuYmluZChfLF8pLG09Zj9nOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBfLmFwcGx5KHQsYXJndW1lbnRzKX19LHk9bSx2PXkoe30udG9TdHJpbmcpLGI9eSgiIi5zbGljZSksdz1mdW5jdGlvbih0KXtyZXR1cm4gYih2KHQpLDgsLTEpfSxTPXcsaz1tLE89ZnVuY3Rpb24odCl7aWYoIkZ1bmN0aW9uIj09PVModCkpcmV0dXJuIGsodCl9LHg9Im9iamVjdCI9PXR5cGVvZiBkb2N1bWVudCYmZG9jdW1lbnQuYWxsLEE9dm9pZCAwPT09eCYmdm9pZCAwIT09eD9mdW5jdGlvbih0KXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdHx8dD09PXh9OmZ1bmN0aW9uKHQpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiB0fSxFPXt9LEM9IXMoKGZ1bmN0aW9uKCl7cmV0dXJuIDchPT1PYmplY3QuZGVmaW5lUHJvcGVydHkoe30sMSx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSlbMV19KSksST1hLFQ9RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsQj1JP1QuYmluZChUKTpmdW5jdGlvbigpe3JldHVybiBULmFwcGx5KFQsYXJndW1lbnRzKX0sTD17fSxOPXt9LnByb3BlcnR5SXNFbnVtZXJhYmxlLFI9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcix6PVImJiFOLmNhbGwoezE6Mn0sMSk7TC5mPXo/ZnVuY3Rpb24odCl7dmFyIGU9Uih0aGlzLHQpO3JldHVybiEhZSYmZS5lbnVtZXJhYmxlfTpOO3ZhciBELFAsTT1mdW5jdGlvbih0LGUpe3JldHVybntlbnVtZXJhYmxlOiEoMSZ0KSxjb25maWd1cmFibGU6ISgyJnQpLHdyaXRhYmxlOiEoNCZ0KSx2YWx1ZTplfX0sVT1zLEY9dyxqPU9iamVjdCxIPW0oIiIuc3BsaXQpLEs9VSgoZnVuY3Rpb24oKXtyZXR1cm4haigieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApfSkpP2Z1bmN0aW9uKHQpe3JldHVybiJTdHJpbmciPT09Rih0KT9IKHQsIiIpOmoodCl9OmosSj1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dH0sVz1KLFo9VHlwZUVycm9yLEc9ZnVuY3Rpb24odCl7aWYoVyh0KSl0aHJvdyBuZXcgWigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIit0KTtyZXR1cm4gdH0sVj1LLCQ9RyxYPWZ1bmN0aW9uKHQpe3JldHVybiBWKCQodCkpfSxZPUEscT1mdW5jdGlvbih0KXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIHQ/bnVsbCE9PXQ6WSh0KX0sUT17fSx0dD1RLGV0PW8scnQ9QSxudD1mdW5jdGlvbih0KXtyZXR1cm4gcnQodCk/dDp2b2lkIDB9LGl0PWZ1bmN0aW9uKHQsZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj9udCh0dFt0XSl8fG50KGV0W3RdKTp0dFt0XSYmdHRbdF1bZV18fGV0W3RdJiZldFt0XVtlXX0sb3Q9bSh7fS5pc1Byb3RvdHlwZU9mKSxzdD1vLm5hdmlnYXRvcixhdD1zdCYmc3QudXNlckFnZW50LGN0PW8sdXQ9YXQ/U3RyaW5nKGF0KToiIixsdD1jdC5wcm9jZXNzLGh0PWN0LkRlbm8sZHQ9bHQmJmx0LnZlcnNpb25zfHxodCYmaHQudmVyc2lvbixmdD1kdCYmZHQudjg7ZnQmJihQPShEPWZ0LnNwbGl0KCIuIikpWzBdPjAmJkRbMF08ND8xOisoRFswXStEWzFdKSksIVAmJnV0JiYoIShEPXV0Lm1hdGNoKC9FZGdlXC8oXGQrKS8pKXx8RFsxXT49NzQpJiYoRD11dC5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pKSYmKFA9K0RbMV0pO3ZhciBwdD1QLF90PXB0LGd0PXMsbXQ9by5TdHJpbmcseXQ9ISFPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzJiYhZ3QoKGZ1bmN0aW9uKCl7dmFyIHQ9U3ltYm9sKCJzeW1ib2wgZGV0ZWN0aW9uIik7cmV0dXJuIW10KHQpfHwhKE9iamVjdCh0KWluc3RhbmNlb2YgU3ltYm9sKXx8IVN5bWJvbC5zaGFtJiZfdCYmX3Q8NDF9KSksdnQ9eXQmJiFTeW1ib2wuc2hhbSYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3IsYnQ9aXQsd3Q9QSxTdD1vdCxrdD1PYmplY3QsT3Q9dnQ/ZnVuY3Rpb24odCl7cmV0dXJuInN5bWJvbCI9PXR5cGVvZiB0fTpmdW5jdGlvbih0KXt2YXIgZT1idCgiU3ltYm9sIik7cmV0dXJuIHd0KGUpJiZTdChlLnByb3RvdHlwZSxrdCh0KSl9LHh0PVN0cmluZyxBdD1mdW5jdGlvbih0KXt0cnl7cmV0dXJuIHh0KHQpfWNhdGNoKGUpe3JldHVybiJPYmplY3QifX0sRXQ9QSxDdD1BdCxJdD1UeXBlRXJyb3IsVHQ9ZnVuY3Rpb24odCl7aWYoRXQodCkpcmV0dXJuIHQ7dGhyb3cgbmV3IEl0KEN0KHQpKyIgaXMgbm90IGEgZnVuY3Rpb24iKX0sQnQ9VHQsTHQ9SixOdD1CLFJ0PUEsenQ9cSxEdD1UeXBlRXJyb3IsUHQ9e2V4cG9ydHM6e319LE10PW8sVXQ9T2JqZWN0LmRlZmluZVByb3BlcnR5LEZ0PW8sanQ9ZnVuY3Rpb24odCxlKXt0cnl7VXQoTXQsdCx7dmFsdWU6ZSxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KX1jYXRjaChyKXtNdFt0XT1lfXJldHVybiBlfSxIdD0iX19jb3JlLWpzX3NoYXJlZF9fIixLdD1QdC5leHBvcnRzPUZ0W0h0XXx8anQoSHQse30pOyhLdC52ZXJzaW9uc3x8KEt0LnZlcnNpb25zPVtdKSkucHVzaCh7dmVyc2lvbjoiMy4zOS4wIixtb2RlOiJwdXJlIixjb3B5cmlnaHQ6IsKpIDIwMTQtMjAyNCBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSIsbGljZW5zZToiaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvYmxvYi92My4zOS4wL0xJQ0VOU0UiLHNvdXJjZToiaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMifSk7dmFyIEp0PVB0LmV4cG9ydHMsV3Q9SnQsWnQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gV3RbdF18fChXdFt0XT1lfHx7fSl9LEd0PUcsVnQ9T2JqZWN0LCR0PWZ1bmN0aW9uKHQpe3JldHVybiBWdChHdCh0KSl9LFh0PSR0LFl0PW0oe30uaGFzT3duUHJvcGVydHkpLHF0PU9iamVjdC5oYXNPd258fGZ1bmN0aW9uKHQsZSl7cmV0dXJuIFl0KFh0KHQpLGUpfSxRdD1tLHRlPTAsZWU9TWF0aC5yYW5kb20oKSxyZT1RdCgxLi50b1N0cmluZyksbmU9ZnVuY3Rpb24odCl7cmV0dXJuIlN5bWJvbCgiKyh2b2lkIDA9PT10PyIiOnQpKyIpXyIrcmUoKyt0ZStlZSwzNil9LGllPVp0LG9lPXF0LHNlPW5lLGFlPXl0LGNlPXZ0LHVlPW8uU3ltYm9sLGxlPWllKCJ3a3MiKSxoZT1jZT91ZS5mb3J8fHVlOnVlJiZ1ZS53aXRob3V0U2V0dGVyfHxzZSxkZT1mdW5jdGlvbih0KXtyZXR1cm4gb2UobGUsdCl8fChsZVt0XT1hZSYmb2UodWUsdCk/dWVbdF06aGUoIlN5bWJvbC4iK3QpKSxsZVt0XX0sZmU9QixwZT1xLF9lPU90LGdlPWZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlXTtyZXR1cm4gTHQocik/dm9pZCAwOkJ0KHIpfSxtZT1mdW5jdGlvbih0LGUpe3ZhciByLG47aWYoInN0cmluZyI9PT1lJiZSdChyPXQudG9TdHJpbmcpJiYhenQobj1OdChyLHQpKSlyZXR1cm4gbjtpZihSdChyPXQudmFsdWVPZikmJiF6dChuPU50KHIsdCkpKXJldHVybiBuO2lmKCJzdHJpbmciIT09ZSYmUnQocj10LnRvU3RyaW5nKSYmIXp0KG49TnQocix0KSkpcmV0dXJuIG47dGhyb3cgbmV3IER0KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX0seWU9VHlwZUVycm9yLHZlPWRlKCJ0b1ByaW1pdGl2ZSIpLGJlPWZ1bmN0aW9uKHQsZSl7aWYoIXBlKHQpfHxfZSh0KSlyZXR1cm4gdDt2YXIgcixuPWdlKHQsdmUpO2lmKG4pe2lmKHZvaWQgMD09PWUmJihlPSJkZWZhdWx0Iikscj1mZShuLHQsZSksIXBlKHIpfHxfZShyKSlyZXR1cm4gcjt0aHJvdyBuZXcgeWUoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpfXJldHVybiB2b2lkIDA9PT1lJiYoZT0ibnVtYmVyIiksbWUodCxlKX0sd2U9T3QsU2U9ZnVuY3Rpb24odCl7dmFyIGU9YmUodCwic3RyaW5nIik7cmV0dXJuIHdlKGUpP2U6ZSsiIn0sa2U9cSxPZT1vLmRvY3VtZW50LHhlPWtlKE9lKSYma2UoT2UuY3JlYXRlRWxlbWVudCksQWU9ZnVuY3Rpb24odCl7cmV0dXJuIHhlP09lLmNyZWF0ZUVsZW1lbnQodCk6e319LEVlPUFlLENlPSFDJiYhcygoZnVuY3Rpb24oKXtyZXR1cm4gNyE9PU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFZSgiZGl2IiksImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KS5hfSkpLEllPUMsVGU9QixCZT1MLExlPU0sTmU9WCxSZT1TZSx6ZT1xdCxEZT1DZSxQZT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO0UuZj1JZT9QZTpmdW5jdGlvbih0LGUpe2lmKHQ9TmUodCksZT1SZShlKSxEZSl0cnl7cmV0dXJuIFBlKHQsZSl9Y2F0Y2gocil7fWlmKHplKHQsZSkpcmV0dXJuIExlKCFUZShCZS5mLHQsZSksdFtlXSl9O3ZhciBNZT1zLFVlPUEsRmU9LyN8XC5wcm90b3R5cGVcLi8samU9ZnVuY3Rpb24odCxlKXt2YXIgcj1LZVtIZSh0KV07cmV0dXJuIHI9PT1XZXx8ciE9PUplJiYoVWUoZSk/TWUoZSk6ISFlKX0sSGU9amUubm9ybWFsaXplPWZ1bmN0aW9uKHQpe3JldHVybiBTdHJpbmcodCkucmVwbGFjZShGZSwiLiIpLnRvTG93ZXJDYXNlKCl9LEtlPWplLmRhdGE9e30sSmU9amUuTkFUSVZFPSJOIixXZT1qZS5QT0xZRklMTD0iUCIsWmU9amUsR2U9VHQsVmU9YSwkZT1PKE8uYmluZCksWGU9ZnVuY3Rpb24odCxlKXtyZXR1cm4gR2UodCksdm9pZCAwPT09ZT90OlZlPyRlKHQsZSk6ZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShlLGFyZ3VtZW50cyl9fSxZZT17fSxxZT1DJiZzKChmdW5jdGlvbigpe3JldHVybiA0MiE9PU9iamVjdC5kZWZpbmVQcm9wZXJ0eSgoZnVuY3Rpb24oKXt9KSwicHJvdG90eXBlIix7dmFsdWU6NDIsd3JpdGFibGU6ITF9KS5wcm90b3R5cGV9KSksUWU9cSx0cj1TdHJpbmcsZXI9VHlwZUVycm9yLHJyPWZ1bmN0aW9uKHQpe2lmKFFlKHQpKXJldHVybiB0O3Rocm93IG5ldyBlcih0cih0KSsiIGlzIG5vdCBhbiBvYmplY3QiKX0sbnI9Qyxpcj1DZSxvcj1xZSxzcj1ycixhcj1TZSxjcj1UeXBlRXJyb3IsdXI9T2JqZWN0LmRlZmluZVByb3BlcnR5LGxyPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsaHI9ImVudW1lcmFibGUiLGRyPSJjb25maWd1cmFibGUiLGZyPSJ3cml0YWJsZSI7WWUuZj1ucj9vcj9mdW5jdGlvbih0LGUscil7aWYoc3IodCksZT1hcihlKSxzcihyKSwiZnVuY3Rpb24iPT10eXBlb2YgdCYmInByb3RvdHlwZSI9PT1lJiYidmFsdWUiaW4gciYmZnIgaW4gciYmIXJbZnJdKXt2YXIgbj1scih0LGUpO24mJm5bZnJdJiYodFtlXT1yLnZhbHVlLHI9e2NvbmZpZ3VyYWJsZTpkciBpbiByP3JbZHJdOm5bZHJdLGVudW1lcmFibGU6aHIgaW4gcj9yW2hyXTpuW2hyXSx3cml0YWJsZTohMX0pfXJldHVybiB1cih0LGUscil9OnVyOmZ1bmN0aW9uKHQsZSxyKXtpZihzcih0KSxlPWFyKGUpLHNyKHIpLGlyKXRyeXtyZXR1cm4gdXIodCxlLHIpfWNhdGNoKG4pe31pZigiZ2V0ImluIHJ8fCJzZXQiaW4gcil0aHJvdyBuZXcgY3IoIkFjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIik7cmV0dXJuInZhbHVlImluIHImJih0W2VdPXIudmFsdWUpLHR9O3ZhciBwcj1ZZSxfcj1NLGdyPUM/ZnVuY3Rpb24odCxlLHIpe3JldHVybiBwci5mKHQsZSxfcigxLHIpKX06ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0W2VdPXIsdH0sbXI9byx5cj1kLHZyPU8sYnI9QSx3cj1FLmYsU3I9WmUsa3I9USxPcj1YZSx4cj1ncixBcj1xdCxFcj1mdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbihyLG4saSl7aWYodGhpcyBpbnN0YW5jZW9mIGUpe3N3aXRjaChhcmd1bWVudHMubGVuZ3RoKXtjYXNlIDA6cmV0dXJuIG5ldyB0O2Nhc2UgMTpyZXR1cm4gbmV3IHQocik7Y2FzZSAyOnJldHVybiBuZXcgdChyLG4pfXJldHVybiBuZXcgdChyLG4saSl9cmV0dXJuIHlyKHQsdGhpcyxhcmd1bWVudHMpfTtyZXR1cm4gZS5wcm90b3R5cGU9dC5wcm90b3R5cGUsZX0sQ3I9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYyx1LGwsaD10LnRhcmdldCxkPXQuZ2xvYmFsLGY9dC5zdGF0LHA9dC5wcm90byxfPWQ/bXI6Zj9tcltoXTptcltoXSYmbXJbaF0ucHJvdG90eXBlLGc9ZD9rcjprcltoXXx8eHIoa3IsaCx7fSlbaF0sbT1nLnByb3RvdHlwZTtmb3IobyBpbiBlKW49IShyPVNyKGQ/bzpoKyhmPyIuIjoiIyIpK28sdC5mb3JjZWQpKSYmXyYmQXIoXyxvKSxhPWdbb10sbiYmKGM9dC5kb250Q2FsbEdldFNldD8obD13cihfLG8pKSYmbC52YWx1ZTpfW29dKSxzPW4mJmM/YzplW29dLChyfHxwfHx0eXBlb2YgYSE9dHlwZW9mIHMpJiYodT10LmJpbmQmJm4/T3Iocyxtcik6dC53cmFwJiZuP0VyKHMpOnAmJmJyKHMpP3ZyKHMpOnMsKHQuc2hhbXx8cyYmcy5zaGFtfHxhJiZhLnNoYW0pJiZ4cih1LCJzaGFtIiwhMCkseHIoZyxvLHUpLHAmJihBcihrcixpPWgrIlByb3RvdHlwZSIpfHx4cihrcixpLHt9KSx4cihrcltpXSxvLHMpLHQucmVhbCYmbSYmKHJ8fCFtW29dKSYmeHIobSxvLHMpKSl9LElyPUNyLFRyPUMsQnI9WWUuZjtJcih7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOk9iamVjdC5kZWZpbmVQcm9wZXJ0eSE9PUJyLHNoYW06IVRyfSx7ZGVmaW5lUHJvcGVydHk6QnJ9KTt2YXIgTHI9US5PYmplY3QsTnI9bi5leHBvcnRzPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gTHIuZGVmaW5lUHJvcGVydHkodCxlLHIpfTtMci5kZWZpbmVQcm9wZXJ0eS5zaGFtJiYoTnIuc2hhbT0hMCk7dmFyIFJyPWUobi5leHBvcnRzKSx6cj13LERyPUFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKHQpe3JldHVybiJBcnJheSI9PT16cih0KX0sUHI9TWF0aC5jZWlsLE1yPU1hdGguZmxvb3IsVXI9TWF0aC50cnVuY3x8ZnVuY3Rpb24odCl7dmFyIGU9K3Q7cmV0dXJuKGU+MD9NcjpQcikoZSl9LEZyPWZ1bmN0aW9uKHQpe3ZhciBlPSt0O3JldHVybiBlIT1lfHwwPT09ZT8wOlVyKGUpfSxqcj1GcixIcj1NYXRoLm1pbixLcj1mdW5jdGlvbih0KXt2YXIgZT1qcih0KTtyZXR1cm4gZT4wP0hyKGUsOTAwNzE5OTI1NDc0MDk5MSk6MH0sSnI9ZnVuY3Rpb24odCl7cmV0dXJuIEtyKHQubGVuZ3RoKX0sV3I9VHlwZUVycm9yLFpyPWZ1bmN0aW9uKHQpe2lmKHQ+OTAwNzE5OTI1NDc0MDk5MSl0aHJvdyBXcigiTWF4aW11bSBhbGxvd2VkIGluZGV4IGV4Y2VlZGVkIik7cmV0dXJuIHR9LEdyPUMsVnI9WWUsJHI9TSxYcj1mdW5jdGlvbih0LGUscil7R3I/VnIuZih0LGUsJHIoMCxyKSk6dFtlXT1yfSxZcj17fTtZcltkZSgidG9TdHJpbmdUYWciKV09InoiO3ZhciBxcj0iW29iamVjdCB6XSI9PT1TdHJpbmcoWXIpLFFyPXFyLHRuPUEsZW49dyxybj1kZSgidG9TdHJpbmdUYWciKSxubj1PYmplY3Qsb249IkFyZ3VtZW50cyI9PT1lbihmdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHN9KCkpLHNuPVFyP2VuOmZ1bmN0aW9uKHQpe3ZhciBlLHIsbjtyZXR1cm4gdm9pZCAwPT09dD8iVW5kZWZpbmVkIjpudWxsPT09dD8iTnVsbCI6InN0cmluZyI9PXR5cGVvZihyPWZ1bmN0aW9uKHQsZSl7dHJ5e3JldHVybiB0W2VdfWNhdGNoKHIpe319KGU9bm4odCkscm4pKT9yOm9uP2VuKGUpOiJPYmplY3QiPT09KG49ZW4oZSkpJiZ0bihlLmNhbGxlZSk/IkFyZ3VtZW50cyI6bn0sYW49QSxjbj1KdCx1bj1tKEZ1bmN0aW9uLnRvU3RyaW5nKTthbihjbi5pbnNwZWN0U291cmNlKXx8KGNuLmluc3BlY3RTb3VyY2U9ZnVuY3Rpb24odCl7cmV0dXJuIHVuKHQpfSk7dmFyIGxuPWNuLmluc3BlY3RTb3VyY2UsaG49bSxkbj1zLGZuPUEscG49c24sX249bG4sZ249ZnVuY3Rpb24oKXt9LG1uPWl0KCJSZWZsZWN0IiwiY29uc3RydWN0IikseW49L15ccyooPzpjbGFzc3xmdW5jdGlvbilcYi8sdm49aG4oeW4uZXhlYyksYm49IXluLnRlc3QoZ24pLHduPWZ1bmN0aW9uKHQpe2lmKCFmbih0KSlyZXR1cm4hMTt0cnl7cmV0dXJuIG1uKGduLFtdLHQpLCEwfWNhdGNoKGUpe3JldHVybiExfX0sU249ZnVuY3Rpb24odCl7aWYoIWZuKHQpKXJldHVybiExO3N3aXRjaChwbih0KSl7Y2FzZSJBc3luY0Z1bmN0aW9uIjpjYXNlIkdlbmVyYXRvckZ1bmN0aW9uIjpjYXNlIkFzeW5jR2VuZXJhdG9yRnVuY3Rpb24iOnJldHVybiExfXRyeXtyZXR1cm4gYm58fCEhdm4oeW4sX24odCkpfWNhdGNoKGUpe3JldHVybiEwfX07U24uc2hhbT0hMDt2YXIga249IW1ufHxkbigoZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gd24od24uY2FsbCl8fCF3bihPYmplY3QpfHwhd24oKGZ1bmN0aW9uKCl7dD0hMH0pKXx8dH0pKT9Tbjp3bixPbj1Ecix4bj1rbixBbj1xLEVuPWRlKCJzcGVjaWVzIiksQ249QXJyYXksSW49ZnVuY3Rpb24odCl7dmFyIGU7cmV0dXJuIE9uKHQpJiYoZT10LmNvbnN0cnVjdG9yLCh4bihlKSYmKGU9PT1Dbnx8T24oZS5wcm90b3R5cGUpKXx8QW4oZSkmJm51bGw9PT0oZT1lW0VuXSkpJiYoZT12b2lkIDApKSx2b2lkIDA9PT1lP0NuOmV9LFRuPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyhJbih0KSkoMD09PWU/MDplKX0sQm49cyxMbj1wdCxObj1kZSgic3BlY2llcyIpLFJuPWZ1bmN0aW9uKHQpe3JldHVybiBMbj49NTF8fCFCbigoZnVuY3Rpb24oKXt2YXIgZT1bXTtyZXR1cm4oZS5jb25zdHJ1Y3Rvcj17fSlbTm5dPWZ1bmN0aW9uKCl7cmV0dXJue2ZvbzoxfX0sMSE9PWVbdF0oQm9vbGVhbikuZm9vfSkpfSx6bj1DcixEbj1zLFBuPURyLE1uPXEsVW49JHQsRm49SnIsam49WnIsSG49WHIsS249VG4sSm49Um4sV249cHQsWm49ZGUoImlzQ29uY2F0U3ByZWFkYWJsZSIpLEduPVduPj01MXx8IURuKChmdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0W1puXT0hMSx0LmNvbmNhdCgpWzBdIT09dH0pKSxWbj1mdW5jdGlvbih0KXtpZighTW4odCkpcmV0dXJuITE7dmFyIGU9dFtabl07cmV0dXJuIHZvaWQgMCE9PWU/ISFlOlBuKHQpfTt6bih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsYXJpdHk6MSxmb3JjZWQ6IUdufHwhSm4oImNvbmNhdCIpfSx7Y29uY2F0OmZ1bmN0aW9uKHQpe3ZhciBlLHIsbixpLG8scz1Vbih0aGlzKSxhPUtuKHMsMCksYz0wO2ZvcihlPS0xLG49YXJndW1lbnRzLmxlbmd0aDtlPG47ZSsrKWlmKFZuKG89LTE9PT1lP3M6YXJndW1lbnRzW2VdKSlmb3IoaT1GbihvKSxqbihjK2kpLHI9MDtyPGk7cisrLGMrKylyIGluIG8mJkhuKGEsYyxvW3JdKTtlbHNlIGpuKGMrMSksSG4oYSxjKyssbyk7cmV0dXJuIGEubGVuZ3RoPWMsYX19KTt2YXIgJG49c24sWG49U3RyaW5nLFluPWZ1bmN0aW9uKHQpe2lmKCJTeW1ib2wiPT09JG4odCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNvbnZlcnQgYSBTeW1ib2wgdmFsdWUgdG8gYSBzdHJpbmciKTtyZXR1cm4gWG4odCl9LHFuPXt9LFFuPUZyLHRpPU1hdGgubWF4LGVpPU1hdGgubWluLHJpPVgsbmk9ZnVuY3Rpb24odCxlKXt2YXIgcj1Rbih0KTtyZXR1cm4gcjwwP3RpKHIrZSwwKTplaShyLGUpfSxpaT1KcixvaT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyLG4pe3ZhciBpPXJpKGUpLG89aWkoaSk7aWYoMD09PW8pcmV0dXJuIXQmJi0xO3ZhciBzLGE9bmkobixvKTtpZih0JiZyIT1yKXtmb3IoO28+YTspaWYoKHM9aVthKytdKSE9cylyZXR1cm4hMH1lbHNlIGZvcig7bz5hO2ErKylpZigodHx8YSBpbiBpKSYmaVthXT09PXIpcmV0dXJuIHR8fGF8fDA7cmV0dXJuIXQmJi0xfX0sc2k9e2luY2x1ZGVzOm9pKCEwKSxpbmRleE9mOm9pKCExKX0sYWk9e30sY2k9cXQsdWk9WCxsaT1zaS5pbmRleE9mLGhpPWFpLGRpPW0oW10ucHVzaCksZmk9ZnVuY3Rpb24odCxlKXt2YXIgcixuPXVpKHQpLGk9MCxvPVtdO2ZvcihyIGluIG4pIWNpKGhpLHIpJiZjaShuLHIpJiZkaShvLHIpO2Zvcig7ZS5sZW5ndGg+aTspY2kobixyPWVbaSsrXSkmJih+bGkobyxyKXx8ZGkobyxyKSk7cmV0dXJuIG99LHBpPVsiY29uc3RydWN0b3IiLCJoYXNPd25Qcm9wZXJ0eSIsImlzUHJvdG90eXBlT2YiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInRvTG9jYWxlU3RyaW5nIiwidG9TdHJpbmciLCJ2YWx1ZU9mIl0sX2k9ZmksZ2k9cGksbWk9T2JqZWN0LmtleXN8fGZ1bmN0aW9uKHQpe3JldHVybiBfaSh0LGdpKX0seWk9Qyx2aT1xZSxiaT1ZZSx3aT1ycixTaT1YLGtpPW1pO3FuLmY9eWkmJiF2aT9PYmplY3QuZGVmaW5lUHJvcGVydGllczpmdW5jdGlvbih0LGUpe3dpKHQpO2Zvcih2YXIgcixuPVNpKGUpLGk9a2koZSksbz1pLmxlbmd0aCxzPTA7bz5zOyliaS5mKHQscj1pW3MrK10sbltyXSk7cmV0dXJuIHR9O3ZhciBPaSx4aT1pdCgiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiKSxBaT1uZSxFaT1adCgia2V5cyIpLENpPWZ1bmN0aW9uKHQpe3JldHVybiBFaVt0XXx8KEVpW3RdPUFpKHQpKX0sSWk9cnIsVGk9cW4sQmk9cGksTGk9YWksTmk9eGksUmk9QWUsemk9InByb3RvdHlwZSIsRGk9InNjcmlwdCIsUGk9Q2koIklFX1BST1RPIiksTWk9ZnVuY3Rpb24oKXt9LFVpPWZ1bmN0aW9uKHQpe3JldHVybiI8IitEaSsiPiIrdCsiPC8iK0RpKyI+In0sRmk9ZnVuY3Rpb24odCl7dC53cml0ZShVaSgiIikpLHQuY2xvc2UoKTt2YXIgZT10LnBhcmVudFdpbmRvdy5PYmplY3Q7cmV0dXJuIHQ9bnVsbCxlfSxqaT1mdW5jdGlvbigpe3RyeXtPaT1uZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKX1jYXRjaChpKXt9dmFyIHQsZSxyO2ppPSJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQuZG9tYWluJiZPaT9GaShPaSk6KGU9UmkoImlmcmFtZSIpLHI9ImphdmEiK0RpKyI6IixlLnN0eWxlLmRpc3BsYXk9Im5vbmUiLE5pLmFwcGVuZENoaWxkKGUpLGUuc3JjPVN0cmluZyhyKSwodD1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQpLm9wZW4oKSx0LndyaXRlKFVpKCJkb2N1bWVudC5GPU9iamVjdCIpKSx0LmNsb3NlKCksdC5GKTpGaShPaSk7Zm9yKHZhciBuPUJpLmxlbmd0aDtuLS07KWRlbGV0ZSBqaVt6aV1bQmlbbl1dO3JldHVybiBqaSgpfTtMaVtQaV09ITA7dmFyIEhpPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKHQsZSl7dmFyIHI7cmV0dXJuIG51bGwhPT10PyhNaVt6aV09SWkodCkscj1uZXcgTWksTWlbemldPW51bGwscltQaV09dCk6cj1qaSgpLHZvaWQgMD09PWU/cjpUaS5mKHIsZSl9LEtpPXt9LEppPWZpLFdpPXBpLmNvbmNhdCgibGVuZ3RoIiwicHJvdG90eXBlIik7S2kuZj1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc3x8ZnVuY3Rpb24odCl7cmV0dXJuIEppKHQsV2kpfTt2YXIgWmk9e30sR2k9bShbXS5zbGljZSksVmk9dywkaT1YLFhpPUtpLmYsWWk9R2kscWk9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyYmT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM/T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KTpbXTtaaS5mPWZ1bmN0aW9uKHQpe3JldHVybiBxaSYmIldpbmRvdyI9PT1WaSh0KT9mdW5jdGlvbih0KXt0cnl7cmV0dXJuIFhpKHQpfWNhdGNoKGUpe3JldHVybiBZaShxaSl9fSh0KTpYaSgkaSh0KSl9O3ZhciBRaT17fTtRaS5mPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7dmFyIHRvPWdyLGVvPWZ1bmN0aW9uKHQsZSxyLG4pe3JldHVybiBuJiZuLmVudW1lcmFibGU/dFtlXT1yOnRvKHQsZSxyKSx0fSxybz1ZZSxubz17fSxpbz1kZTtuby5mPWlvO3ZhciBvbyxzbyxhbyxjbz1RLHVvPXF0LGxvPW5vLGhvPVllLmYsZm89ZnVuY3Rpb24odCl7dmFyIGU9Y28uU3ltYm9sfHwoY28uU3ltYm9sPXt9KTt1byhlLHQpfHxobyhlLHQse3ZhbHVlOmxvLmYodCl9KX0scG89Qixfbz1pdCxnbz1kZSxtbz1lbyx5bz1mdW5jdGlvbigpe3ZhciB0PV9vKCJTeW1ib2wiKSxlPXQmJnQucHJvdG90eXBlLHI9ZSYmZS52YWx1ZU9mLG49Z28oInRvUHJpbWl0aXZlIik7ZSYmIWVbbl0mJm1vKGUsbiwoZnVuY3Rpb24odCl7cmV0dXJuIHBvKHIsdGhpcyl9KSx7YXJpdHk6MX0pfSx2bz1zbixibz1xcj97fS50b1N0cmluZzpmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0ICIrdm8odGhpcykrIl0ifSx3bz1xcixTbz1ZZS5mLGtvPWdyLE9vPXF0LHhvPWJvLEFvPWRlKCJ0b1N0cmluZ1RhZyIpLEVvPWZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPXI/dDp0JiZ0LnByb3RvdHlwZTtpJiYoT28oaSxBbyl8fFNvKGksQW8se2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTplfSksbiYmIXdvJiZrbyhpLCJ0b1N0cmluZyIseG8pKX0sQ289QSxJbz1vLldlYWtNYXAsVG89Q28oSW8pJiYvbmF0aXZlIGNvZGUvLnRlc3QoU3RyaW5nKElvKSksQm89byxMbz1xLE5vPWdyLFJvPXF0LHpvPUp0LERvPUNpLFBvPWFpLE1vPSJPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCIsVW89Qm8uVHlwZUVycm9yLEZvPUJvLldlYWtNYXA7aWYoVG98fHpvLnN0YXRlKXt2YXIgam89em8uc3RhdGV8fCh6by5zdGF0ZT1uZXcgRm8pO2pvLmdldD1qby5nZXQsam8uaGFzPWpvLmhhcyxqby5zZXQ9am8uc2V0LG9vPWZ1bmN0aW9uKHQsZSl7aWYoam8uaGFzKHQpKXRocm93IG5ldyBVbyhNbyk7cmV0dXJuIGUuZmFjYWRlPXQsam8uc2V0KHQsZSksZX0sc289ZnVuY3Rpb24odCl7cmV0dXJuIGpvLmdldCh0KXx8e319LGFvPWZ1bmN0aW9uKHQpe3JldHVybiBqby5oYXModCl9fWVsc2V7dmFyIEhvPURvKCJzdGF0ZSIpO1BvW0hvXT0hMCxvbz1mdW5jdGlvbih0LGUpe2lmKFJvKHQsSG8pKXRocm93IG5ldyBVbyhNbyk7cmV0dXJuIGUuZmFjYWRlPXQsTm8odCxIbyxlKSxlfSxzbz1mdW5jdGlvbih0KXtyZXR1cm4gUm8odCxIbyk/dFtIb106e319LGFvPWZ1bmN0aW9uKHQpe3JldHVybiBSbyh0LEhvKX19dmFyIEtvPXtzZXQ6b28sZ2V0OnNvLGhhczphbyxlbmZvcmNlOmZ1bmN0aW9uKHQpe3JldHVybiBhbyh0KT9zbyh0KTpvbyh0LHt9KX0sZ2V0dGVyRm9yOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcjtpZighTG8oZSl8fChyPXNvKGUpKS50eXBlIT09dCl0aHJvdyBuZXcgVW8oIkluY29tcGF0aWJsZSByZWNlaXZlciwgIit0KyIgcmVxdWlyZWQiKTtyZXR1cm4gcn19fSxKbz1YZSxXbz1LLFpvPSR0LEdvPUpyLFZvPVRuLCRvPW0oW10ucHVzaCksWG89ZnVuY3Rpb24odCl7dmFyIGU9MT09PXQscj0yPT09dCxuPTM9PT10LGk9ND09PXQsbz02PT09dCxzPTc9PT10LGE9NT09PXR8fG87cmV0dXJuIGZ1bmN0aW9uKGMsdSxsLGgpe2Zvcih2YXIgZCxmLHA9Wm8oYyksXz1XbyhwKSxnPUdvKF8pLG09Sm8odSxsKSx5PTAsdj1ofHxWbyxiPWU/dihjLGcpOnJ8fHM/dihjLDApOnZvaWQgMDtnPnk7eSsrKWlmKChhfHx5IGluIF8pJiYoZj1tKGQ9X1t5XSx5LHApLHQpKWlmKGUpYlt5XT1mO2Vsc2UgaWYoZilzd2l0Y2godCl7Y2FzZSAzOnJldHVybiEwO2Nhc2UgNTpyZXR1cm4gZDtjYXNlIDY6cmV0dXJuIHk7Y2FzZSAyOiRvKGIsZCl9ZWxzZSBzd2l0Y2godCl7Y2FzZSA0OnJldHVybiExO2Nhc2UgNzokbyhiLGQpfXJldHVybiBvPy0xOm58fGk/aTpifX0sWW89e2ZvckVhY2g6WG8oMCksbWFwOlhvKDEpLGZpbHRlcjpYbygyKSxzb21lOlhvKDMpLGV2ZXJ5OlhvKDQpLGZpbmQ6WG8oNSksZmluZEluZGV4OlhvKDYpLGZpbHRlclJlamVjdDpYbyg3KX0scW89Q3IsUW89byx0cz1CLGVzPW0scnM9Qyxucz15dCxpcz1zLG9zPXF0LHNzPW90LGFzPXJyLGNzPVgsdXM9U2UsbHM9WW4saHM9TSxkcz1IaSxmcz1taSxwcz1LaSxfcz1aaSxncz1RaSxtcz1FLHlzPVllLHZzPXFuLGJzPUwsd3M9ZW8sU3M9ZnVuY3Rpb24odCxlLHIpe3JldHVybiByby5mKHQsZSxyKX0sa3M9WnQsT3M9YWkseHM9bmUsQXM9ZGUsRXM9bm8sQ3M9Zm8sSXM9eW8sVHM9RW8sQnM9S28sTHM9WW8uZm9yRWFjaCxOcz1DaSgiaGlkZGVuIiksUnM9IlN5bWJvbCIsenM9InByb3RvdHlwZSIsRHM9QnMuc2V0LFBzPUJzLmdldHRlckZvcihScyksTXM9T2JqZWN0W3pzXSxVcz1Rby5TeW1ib2wsRnM9VXMmJlVzW3pzXSxqcz1Rby5SYW5nZUVycm9yLEhzPVFvLlR5cGVFcnJvcixLcz1Rby5RT2JqZWN0LEpzPW1zLmYsV3M9eXMuZixacz1fcy5mLEdzPWJzLmYsVnM9ZXMoW10ucHVzaCksJHM9a3MoInN5bWJvbHMiKSxYcz1rcygib3Atc3ltYm9scyIpLFlzPWtzKCJ3a3MiKSxxcz0hS3N8fCFLc1t6c118fCFLc1t6c10uZmluZENoaWxkLFFzPWZ1bmN0aW9uKHQsZSxyKXt2YXIgbj1KcyhNcyxlKTtuJiZkZWxldGUgTXNbZV0sV3ModCxlLHIpLG4mJnQhPT1NcyYmV3MoTXMsZSxuKX0sdGE9cnMmJmlzKChmdW5jdGlvbigpe3JldHVybiA3IT09ZHMoV3Moe30sImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gV3ModGhpcywiYSIse3ZhbHVlOjd9KS5hfX0pKS5hfSkpP1FzOldzLGVhPWZ1bmN0aW9uKHQsZSl7dmFyIHI9JHNbdF09ZHMoRnMpO3JldHVybiBEcyhyLHt0eXBlOlJzLHRhZzp0LGRlc2NyaXB0aW9uOmV9KSxyc3x8KHIuZGVzY3JpcHRpb249ZSkscn0scmE9ZnVuY3Rpb24odCxlLHIpe3Q9PT1NcyYmcmEoWHMsZSxyKSxhcyh0KTt2YXIgbj11cyhlKTtyZXR1cm4gYXMociksb3MoJHMsbik/KHIuZW51bWVyYWJsZT8ob3ModCxOcykmJnRbTnNdW25dJiYodFtOc11bbl09ITEpLHI9ZHMocix7ZW51bWVyYWJsZTpocygwLCExKX0pKToob3ModCxOcyl8fFdzKHQsTnMsaHMoMSxkcyhudWxsKSkpLHRbTnNdW25dPSEwKSx0YSh0LG4scikpOldzKHQsbixyKX0sbmE9ZnVuY3Rpb24odCxlKXthcyh0KTt2YXIgcj1jcyhlKSxuPWZzKHIpLmNvbmNhdChhYShyKSk7cmV0dXJuIExzKG4sKGZ1bmN0aW9uKGUpe3JzJiYhdHMoaWEscixlKXx8cmEodCxlLHJbZV0pfSkpLHR9LGlhPWZ1bmN0aW9uKHQpe3ZhciBlPXVzKHQpLHI9dHMoR3MsdGhpcyxlKTtyZXR1cm4hKHRoaXM9PT1NcyYmb3MoJHMsZSkmJiFvcyhYcyxlKSkmJighKHJ8fCFvcyh0aGlzLGUpfHwhb3MoJHMsZSl8fG9zKHRoaXMsTnMpJiZ0aGlzW05zXVtlXSl8fHIpfSxvYT1mdW5jdGlvbih0LGUpe3ZhciByPWNzKHQpLG49dXMoZSk7aWYociE9PU1zfHwhb3MoJHMsbil8fG9zKFhzLG4pKXt2YXIgaT1KcyhyLG4pO3JldHVybiFpfHwhb3MoJHMsbil8fG9zKHIsTnMpJiZyW05zXVtuXXx8KGkuZW51bWVyYWJsZT0hMCksaX19LHNhPWZ1bmN0aW9uKHQpe3ZhciBlPVpzKGNzKHQpKSxyPVtdO3JldHVybiBMcyhlLChmdW5jdGlvbih0KXtvcygkcyx0KXx8b3MoT3MsdCl8fFZzKHIsdCl9KSkscn0sYWE9ZnVuY3Rpb24odCl7dmFyIGU9dD09PU1zLHI9WnMoZT9Yczpjcyh0KSksbj1bXTtyZXR1cm4gTHMociwoZnVuY3Rpb24odCl7IW9zKCRzLHQpfHxlJiYhb3MoTXMsdCl8fFZzKG4sJHNbdF0pfSkpLG59O25zfHwoVXM9ZnVuY3Rpb24oKXtpZihzcyhGcyx0aGlzKSl0aHJvdyBuZXcgSHMoIlN5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvciIpO3ZhciB0PWFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9scyhhcmd1bWVudHNbMF0pOnZvaWQgMCxlPXhzKHQpLHI9ZnVuY3Rpb24odCl7dmFyIG49dm9pZCAwPT09dGhpcz9Rbzp0aGlzO249PT1NcyYmdHMocixYcyx0KSxvcyhuLE5zKSYmb3MobltOc10sZSkmJihuW05zXVtlXT0hMSk7dmFyIGk9aHMoMSx0KTt0cnl7dGEobixlLGkpfWNhdGNoKG8pe2lmKCEobyBpbnN0YW5jZW9mIGpzKSl0aHJvdyBvO1FzKG4sZSxpKX19O3JldHVybiBycyYmcXMmJnRhKE1zLGUse2NvbmZpZ3VyYWJsZTohMCxzZXQ6cn0pLGVhKGUsdCl9LHdzKEZzPVVzW3pzXSwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiBQcyh0aGlzKS50YWd9KSksd3MoVXMsIndpdGhvdXRTZXR0ZXIiLChmdW5jdGlvbih0KXtyZXR1cm4gZWEoeHModCksdCl9KSksYnMuZj1pYSx5cy5mPXJhLHZzLmY9bmEsbXMuZj1vYSxwcy5mPV9zLmY9c2EsZ3MuZj1hYSxFcy5mPWZ1bmN0aW9uKHQpe3JldHVybiBlYShBcyh0KSx0KX0scnMmJlNzKEZzLCJkZXNjcmlwdGlvbiIse2NvbmZpZ3VyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gUHModGhpcykuZGVzY3JpcHRpb259fSkpLHFvKHtnbG9iYWw6ITAsY29uc3RydWN0b3I6ITAsd3JhcDohMCxmb3JjZWQ6IW5zLHNoYW06IW5zfSx7U3ltYm9sOlVzfSksTHMoZnMoWXMpLChmdW5jdGlvbih0KXtDcyh0KX0pKSxxbyh7dGFyZ2V0OlJzLHN0YXQ6ITAsZm9yY2VkOiFuc30se3VzZVNldHRlcjpmdW5jdGlvbigpe3FzPSEwfSx1c2VTaW1wbGU6ZnVuY3Rpb24oKXtxcz0hMX19KSxxbyh7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOiFucyxzaGFtOiFyc30se2NyZWF0ZTpmdW5jdGlvbih0LGUpe3JldHVybiB2b2lkIDA9PT1lP2RzKHQpOm5hKGRzKHQpLGUpfSxkZWZpbmVQcm9wZXJ0eTpyYSxkZWZpbmVQcm9wZXJ0aWVzOm5hLGdldE93blByb3BlcnR5RGVzY3JpcHRvcjpvYX0pLHFvKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6IW5zfSx7Z2V0T3duUHJvcGVydHlOYW1lczpzYX0pLElzKCksVHMoVXMsUnMpLE9zW05zXT0hMDt2YXIgY2E9eXQmJiEhU3ltYm9sLmZvciYmISFTeW1ib2wua2V5Rm9yLHVhPUNyLGxhPWl0LGhhPXF0LGRhPVluLGZhPVp0LHBhPWNhLF9hPWZhKCJzdHJpbmctdG8tc3ltYm9sLXJlZ2lzdHJ5IiksZ2E9ZmEoInN5bWJvbC10by1zdHJpbmctcmVnaXN0cnkiKTt1YSh7dGFyZ2V0OiJTeW1ib2wiLHN0YXQ6ITAsZm9yY2VkOiFwYX0se2ZvcjpmdW5jdGlvbih0KXt2YXIgZT1kYSh0KTtpZihoYShfYSxlKSlyZXR1cm4gX2FbZV07dmFyIHI9bGEoIlN5bWJvbCIpKGUpO3JldHVybiBfYVtlXT1yLGdhW3JdPWUscn19KTt2YXIgbWE9Q3IseWE9cXQsdmE9T3QsYmE9QXQsd2E9Y2EsU2E9WnQoInN5bWJvbC10by1zdHJpbmctcmVnaXN0cnkiKTttYSh7dGFyZ2V0OiJTeW1ib2wiLHN0YXQ6ITAsZm9yY2VkOiF3YX0se2tleUZvcjpmdW5jdGlvbih0KXtpZighdmEodCkpdGhyb3cgbmV3IFR5cGVFcnJvcihiYSh0KSsiIGlzIG5vdCBhIHN5bWJvbCIpO2lmKHlhKFNhLHQpKXJldHVybiBTYVt0XX19KTt2YXIga2E9RHIsT2E9QSx4YT13LEFhPVluLEVhPW0oW10ucHVzaCksQ2E9Q3IsSWE9aXQsVGE9ZCxCYT1CLExhPW0sTmE9cyxSYT1BLHphPU90LERhPUdpLFBhPWZ1bmN0aW9uKHQpe2lmKE9hKHQpKXJldHVybiB0O2lmKGthKHQpKXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rKyl7dmFyIGk9dFtuXTsic3RyaW5nIj09dHlwZW9mIGk/RWEocixpKToibnVtYmVyIiE9dHlwZW9mIGkmJiJOdW1iZXIiIT09eGEoaSkmJiJTdHJpbmciIT09eGEoaSl8fEVhKHIsQWEoaSkpfXZhciBvPXIubGVuZ3RoLHM9ITA7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7aWYocylyZXR1cm4gcz0hMSxlO2lmKGthKHRoaXMpKXJldHVybiBlO2Zvcih2YXIgbj0wO248bztuKyspaWYocltuXT09PXQpcmV0dXJuIGV9fX0sTWE9eXQsVWE9U3RyaW5nLEZhPUlhKCJKU09OIiwic3RyaW5naWZ5IiksamE9TGEoLy4vLmV4ZWMpLEhhPUxhKCIiLmNoYXJBdCksS2E9TGEoIiIuY2hhckNvZGVBdCksSmE9TGEoIiIucmVwbGFjZSksV2E9TGEoMS4udG9TdHJpbmcpLFphPS9bXHVEODAwLVx1REZGRl0vZyxHYT0vXltcdUQ4MDAtXHVEQkZGXSQvLFZhPS9eW1x1REMwMC1cdURGRkZdJC8sJGE9IU1hfHxOYSgoZnVuY3Rpb24oKXt2YXIgdD1JYSgiU3ltYm9sIikoInN0cmluZ2lmeSBkZXRlY3Rpb24iKTtyZXR1cm4iW251bGxdIiE9PUZhKFt0XSl8fCJ7fSIhPT1GYSh7YTp0fSl8fCJ7fSIhPT1GYShPYmplY3QodCkpfSkpLFhhPU5hKChmdW5jdGlvbigpe3JldHVybiciXFx1ZGYwNlxcdWQ4MzQiJyE9PUZhKCJcdWRmMDZcdWQ4MzQiKXx8JyJcXHVkZWFkIichPT1GYSgiXHVkZWFkIil9KSksWWE9ZnVuY3Rpb24odCxlKXt2YXIgcj1EYShhcmd1bWVudHMpLG49UGEoZSk7aWYoUmEobil8fHZvaWQgMCE9PXQmJiF6YSh0KSlyZXR1cm4gclsxXT1mdW5jdGlvbih0LGUpe2lmKFJhKG4pJiYoZT1CYShuLHRoaXMsVWEodCksZSkpLCF6YShlKSlyZXR1cm4gZX0sVGEoRmEsbnVsbCxyKX0scWE9ZnVuY3Rpb24odCxlLHIpe3ZhciBuPUhhKHIsZS0xKSxpPUhhKHIsZSsxKTtyZXR1cm4gamEoR2EsdCkmJiFqYShWYSxpKXx8amEoVmEsdCkmJiFqYShHYSxuKT8iXFx1IitXYShLYSh0LDApLDE2KTp0fTtGYSYmQ2Eoe3RhcmdldDoiSlNPTiIsc3RhdDohMCxhcml0eTozLGZvcmNlZDokYXx8WGF9LHtzdHJpbmdpZnk6ZnVuY3Rpb24odCxlLHIpe3ZhciBuPURhKGFyZ3VtZW50cyksaT1UYSgkYT9ZYTpGYSxudWxsLG4pO3JldHVybiBYYSYmInN0cmluZyI9PXR5cGVvZiBpP0phKGksWmEscWEpOml9fSk7dmFyIFFhPVFpLHRjPSR0O0NyKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6IXl0fHxzKChmdW5jdGlvbigpe1FhLmYoMSl9KSl9LHtnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6ZnVuY3Rpb24odCl7dmFyIGU9UWEuZjtyZXR1cm4gZT9lKHRjKHQpKTpbXX19KSxmbygiYXN5bmNJdGVyYXRvciIpLGZvKCJoYXNJbnN0YW5jZSIpLGZvKCJpc0NvbmNhdFNwcmVhZGFibGUiKSxmbygiaXRlcmF0b3IiKSxmbygibWF0Y2giKSxmbygibWF0Y2hBbGwiKSxmbygicmVwbGFjZSIpLGZvKCJzZWFyY2giKSxmbygic3BlY2llcyIpLGZvKCJzcGxpdCIpO3ZhciBlYz15bztmbygidG9QcmltaXRpdmUiKSxlYygpO3ZhciByYz1pdCxuYz1FbztmbygidG9TdHJpbmdUYWciKSxuYyhyYygiU3ltYm9sIiksIlN5bWJvbCIpLGZvKCJ1bnNjb3BhYmxlcyIpLEVvKG8uSlNPTiwiSlNPTiIsITApO3ZhciBpYyxvYyxzYyxhYz1RLlN5bWJvbCxjYz17fSx1Yz1DLGxjPXF0LGhjPUZ1bmN0aW9uLnByb3RvdHlwZSxkYz11YyYmT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixmYz1sYyhoYywibmFtZSIpLHBjPXtFWElTVFM6ZmMsUFJPUEVSOmZjJiYic29tZXRoaW5nIj09PWZ1bmN0aW9uKCl7fS5uYW1lLENPTkZJR1VSQUJMRTpmYyYmKCF1Y3x8dWMmJmRjKGhjLCJuYW1lIikuY29uZmlndXJhYmxlKX0sX2M9IXMoKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gdC5wcm90b3R5cGUuY29uc3RydWN0b3I9bnVsbCxPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IHQpIT09dC5wcm90b3R5cGV9KSksZ2M9cXQsbWM9QSx5Yz0kdCx2Yz1fYyxiYz1DaSgiSUVfUFJPVE8iKSx3Yz1PYmplY3QsU2M9d2MucHJvdG90eXBlLGtjPXZjP3djLmdldFByb3RvdHlwZU9mOmZ1bmN0aW9uKHQpe3ZhciBlPXljKHQpO2lmKGdjKGUsYmMpKXJldHVybiBlW2JjXTt2YXIgcj1lLmNvbnN0cnVjdG9yO3JldHVybiBtYyhyKSYmZSBpbnN0YW5jZW9mIHI/ci5wcm90b3R5cGU6ZSBpbnN0YW5jZW9mIHdjP1NjOm51bGx9LE9jPXMseGM9QSxBYz1xLEVjPUhpLENjPWtjLEljPWVvLFRjPWRlKCJpdGVyYXRvciIpLEJjPSExO1tdLmtleXMmJigibmV4dCJpbihzYz1bXS5rZXlzKCkpPyhvYz1DYyhDYyhzYykpKSE9PU9iamVjdC5wcm90b3R5cGUmJihpYz1vYyk6QmM9ITApO3ZhciBMYz0hQWMoaWMpfHxPYygoZnVuY3Rpb24oKXt2YXIgdD17fTtyZXR1cm4gaWNbVGNdLmNhbGwodCkhPT10fSkpO3hjKChpYz1MYz97fTpFYyhpYykpW1RjXSl8fEljKGljLFRjLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBOYz17SXRlcmF0b3JQcm90b3R5cGU6aWMsQlVHR1lfU0FGQVJJX0lURVJBVE9SUzpCY30sUmM9TmMuSXRlcmF0b3JQcm90b3R5cGUsemM9SGksRGM9TSxQYz1FbyxNYz1jYyxVYz1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxGYz1DcixqYz1CLEhjPXBjLEtjPWZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPWUrIiBJdGVyYXRvciI7cmV0dXJuIHQucHJvdG90eXBlPXpjKFJjLHtuZXh0OkRjKCshbixyKX0pLFBjKHQsaSwhMSwhMCksTWNbaV09VWMsdH0sSmM9a2MsV2M9RW8sWmM9ZW8sR2M9Y2MsVmM9TmMsJGM9SGMuUFJPUEVSLFhjPVZjLkJVR0dZX1NBRkFSSV9JVEVSQVRPUlMsWWM9ZGUoIml0ZXJhdG9yIikscWM9ImtleXMiLFFjPSJ2YWx1ZXMiLHR1PSJlbnRyaWVzIixldT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxydT1mdW5jdGlvbih0LGUscixuLGksbyxzKXtLYyhyLGUsbik7dmFyIGEsYyx1LGw9ZnVuY3Rpb24odCl7aWYodD09PWkmJl8pcmV0dXJuIF87aWYoIVhjJiZ0JiZ0IGluIGYpcmV0dXJuIGZbdF07c3dpdGNoKHQpe2Nhc2UgcWM6Y2FzZSBRYzpjYXNlIHR1OnJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgcih0aGlzLHQpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHIodGhpcyl9fSxoPWUrIiBJdGVyYXRvciIsZD0hMSxmPXQucHJvdG90eXBlLHA9ZltZY118fGZbIkBAaXRlcmF0b3IiXXx8aSYmZltpXSxfPSFYYyYmcHx8bChpKSxnPSJBcnJheSI9PT1lJiZmLmVudHJpZXN8fHA7aWYoZyYmKGE9SmMoZy5jYWxsKG5ldyB0KSkpIT09T2JqZWN0LnByb3RvdHlwZSYmYS5uZXh0JiYoV2MoYSxoLCEwLCEwKSxHY1toXT1ldSksJGMmJmk9PT1RYyYmcCYmcC5uYW1lIT09UWMmJihkPSEwLF89ZnVuY3Rpb24oKXtyZXR1cm4gamMocCx0aGlzKX0pLGkpaWYoYz17dmFsdWVzOmwoUWMpLGtleXM6bz9fOmwocWMpLGVudHJpZXM6bCh0dSl9LHMpZm9yKHUgaW4gYykoWGN8fGR8fCEodSBpbiBmKSkmJlpjKGYsdSxjW3VdKTtlbHNlIEZjKHt0YXJnZXQ6ZSxwcm90bzohMCxmb3JjZWQ6WGN8fGR9LGMpO3JldHVybiBzJiZmW1ljXSE9PV8mJlpjKGYsWWMsXyx7bmFtZTppfSksR2NbZV09XyxjfSxudT1mdW5jdGlvbih0LGUpe3JldHVybnt2YWx1ZTp0LGRvbmU6ZX19LGl1PVgsb3U9Y2Msc3U9S287WWUuZjt2YXIgYXU9cnUsY3U9bnUsdXU9IkFycmF5IEl0ZXJhdG9yIixsdT1zdS5zZXQsaHU9c3UuZ2V0dGVyRm9yKHV1KTthdShBcnJheSwiQXJyYXkiLChmdW5jdGlvbih0LGUpe2x1KHRoaXMse3R5cGU6dXUsdGFyZ2V0Oml1KHQpLGluZGV4OjAsa2luZDplfSl9KSwoZnVuY3Rpb24oKXt2YXIgdD1odSh0aGlzKSxlPXQudGFyZ2V0LHI9dC5pbmRleCsrO2lmKCFlfHxyPj1lLmxlbmd0aClyZXR1cm4gdC50YXJnZXQ9bnVsbCxjdSh2b2lkIDAsITApO3N3aXRjaCh0LmtpbmQpe2Nhc2Uia2V5cyI6cmV0dXJuIGN1KHIsITEpO2Nhc2UidmFsdWVzIjpyZXR1cm4gY3UoZVtyXSwhMSl9cmV0dXJuIGN1KFtyLGVbcl1dLCExKX0pLCJ2YWx1ZXMiKSxvdS5Bcmd1bWVudHM9b3UuQXJyYXk7dmFyIGR1PXtDU1NSdWxlTGlzdDowLENTU1N0eWxlRGVjbGFyYXRpb246MCxDU1NWYWx1ZUxpc3Q6MCxDbGllbnRSZWN0TGlzdDowLERPTVJlY3RMaXN0OjAsRE9NU3RyaW5nTGlzdDowLERPTVRva2VuTGlzdDoxLERhdGFUcmFuc2Zlckl0ZW1MaXN0OjAsRmlsZUxpc3Q6MCxIVE1MQWxsQ29sbGVjdGlvbjowLEhUTUxDb2xsZWN0aW9uOjAsSFRNTEZvcm1FbGVtZW50OjAsSFRNTFNlbGVjdEVsZW1lbnQ6MCxNZWRpYUxpc3Q6MCxNaW1lVHlwZUFycmF5OjAsTmFtZWROb2RlTWFwOjAsTm9kZUxpc3Q6MSxQYWludFJlcXVlc3RMaXN0OjAsUGx1Z2luOjAsUGx1Z2luQXJyYXk6MCxTVkdMZW5ndGhMaXN0OjAsU1ZHTnVtYmVyTGlzdDowLFNWR1BhdGhTZWdMaXN0OjAsU1ZHUG9pbnRMaXN0OjAsU1ZHU3RyaW5nTGlzdDowLFNWR1RyYW5zZm9ybUxpc3Q6MCxTb3VyY2VCdWZmZXJMaXN0OjAsU3R5bGVTaGVldExpc3Q6MCxUZXh0VHJhY2tDdWVMaXN0OjAsVGV4dFRyYWNrTGlzdDowLFRvdWNoTGlzdDowfSxmdT1vLHB1PUVvLF91PWNjO2Zvcih2YXIgZ3UgaW4gZHUpcHUoZnVbZ3VdLGd1KSxfdVtndV09X3UuQXJyYXk7dmFyIG11PWFjLHl1PWRlLHZ1PVllLmYsYnU9eXUoIm1ldGFkYXRhIiksd3U9RnVuY3Rpb24ucHJvdG90eXBlO3ZvaWQgMD09PXd1W2J1XSYmdnUod3UsYnUse3ZhbHVlOm51bGx9KSxmbygiYXN5bmNEaXNwb3NlIiksZm8oImRpc3Bvc2UiKSxmbygibWV0YWRhdGEiKTt2YXIgU3U9bXUsa3U9bSxPdT1pdCgiU3ltYm9sIikseHU9T3Uua2V5Rm9yLEF1PWt1KE91LnByb3RvdHlwZS52YWx1ZU9mKSxFdT1PdS5pc1JlZ2lzdGVyZWRTeW1ib2x8fGZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gdm9pZCAwIT09eHUoQXUodCkpfWNhdGNoKGUpe3JldHVybiExfX07Q3Ioe3RhcmdldDoiU3ltYm9sIixzdGF0OiEwfSx7aXNSZWdpc3RlcmVkU3ltYm9sOkV1fSk7Zm9yKHZhciBDdT1adCxJdT1pdCxUdT1tLEJ1PU90LEx1PWRlLE51PUl1KCJTeW1ib2wiKSxSdT1OdS5pc1dlbGxLbm93blN5bWJvbCx6dT1JdSgiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlOYW1lcyIpLER1PVR1KE51LnByb3RvdHlwZS52YWx1ZU9mKSxQdT1DdSgid2tzIiksTXU9MCxVdT16dShOdSksRnU9VXUubGVuZ3RoO011PEZ1O011KyspdHJ5e3ZhciBqdT1VdVtNdV07QnUoTnVbanVdKSYmTHUoanUpfWNhdGNoKFlnKXt9dmFyIEh1PWZ1bmN0aW9uKHQpe2lmKFJ1JiZSdSh0KSlyZXR1cm4hMDt0cnl7Zm9yKHZhciBlPUR1KHQpLHI9MCxuPXp1KFB1KSxpPW4ubGVuZ3RoO3I8aTtyKyspaWYoUHVbbltyXV09PWUpcmV0dXJuITB9Y2F0Y2goWWcpe31yZXR1cm4hMX07Q3Ioe3RhcmdldDoiU3ltYm9sIixzdGF0OiEwLGZvcmNlZDohMH0se2lzV2VsbEtub3duU3ltYm9sOkh1fSksZm8oImN1c3RvbU1hdGNoZXIiKSxmbygib2JzZXJ2YWJsZSIpLENyKHt0YXJnZXQ6IlN5bWJvbCIsc3RhdDohMCxuYW1lOiJpc1JlZ2lzdGVyZWRTeW1ib2wifSx7aXNSZWdpc3RlcmVkOkV1fSksQ3Ioe3RhcmdldDoiU3ltYm9sIixzdGF0OiEwLG5hbWU6ImlzV2VsbEtub3duU3ltYm9sIixmb3JjZWQ6ITB9LHtpc1dlbGxLbm93bjpIdX0pLGZvKCJtYXRjaGVyIiksZm8oIm1ldGFkYXRhS2V5IiksZm8oInBhdHRlcm5NYXRjaCIpLGZvKCJyZXBsYWNlQWxsIik7dmFyIEt1PWUoU3UpLEp1PW0sV3U9RnIsWnU9WW4sR3U9RyxWdT1KdSgiIi5jaGFyQXQpLCR1PUp1KCIiLmNoYXJDb2RlQXQpLFh1PUp1KCIiLnNsaWNlKSxZdT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXt2YXIgbixpLG89WnUoR3UoZSkpLHM9V3UociksYT1vLmxlbmd0aDtyZXR1cm4gczwwfHxzPj1hP3Q/IiI6dm9pZCAwOihuPSR1KG8scykpPDU1Mjk2fHxuPjU2MzE5fHxzKzE9PT1hfHwoaT0kdShvLHMrMSkpPDU2MzIwfHxpPjU3MzQzP3Q/VnUobyxzKTpuOnQ/WHUobyxzLHMrMik6aS01NjMyMCsobi01NTI5Njw8MTApKzY1NTM2fX0scXU9e2NvZGVBdDpZdSghMSksY2hhckF0Oll1KCEwKX0uY2hhckF0LFF1PVluLHRsPUtvLGVsPXJ1LHJsPW51LG5sPSJTdHJpbmcgSXRlcmF0b3IiLGlsPXRsLnNldCxvbD10bC5nZXR0ZXJGb3IobmwpO2VsKFN0cmluZywiU3RyaW5nIiwoZnVuY3Rpb24odCl7aWwodGhpcyx7dHlwZTpubCxzdHJpbmc6UXUodCksaW5kZXg6MH0pfSksKGZ1bmN0aW9uKCl7dmFyIHQsZT1vbCh0aGlzKSxyPWUuc3RyaW5nLG49ZS5pbmRleDtyZXR1cm4gbj49ci5sZW5ndGg/cmwodm9pZCAwLCEwKToodD1xdShyLG4pLGUuaW5kZXgrPXQubGVuZ3RoLHJsKHQsITEpKX0pKTt2YXIgc2w9ZShuby5mKCJpdGVyYXRvciIpKTtmdW5jdGlvbiBhbCh0KXtyZXR1cm4oYWw9ImZ1bmN0aW9uIj09dHlwZW9mIEt1JiYic3ltYm9sIj09dHlwZW9mIHNsP2Z1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdH06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBLdSYmdC5jb25zdHJ1Y3Rvcj09PUt1JiZ0IT09S3UucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiB0fSkodCl9dmFyIGNsPWUobm8uZigidG9QcmltaXRpdmUiKSk7ZnVuY3Rpb24gdWwodCl7dmFyIGU9ZnVuY3Rpb24odCxlKXtpZigib2JqZWN0IiE9YWwodCl8fCF0KXJldHVybiB0O3ZhciByPXRbY2xdO2lmKHZvaWQgMCE9PXIpe3ZhciBuPXIuY2FsbCh0LGV8fCJkZWZhdWx0Iik7aWYoIm9iamVjdCIhPWFsKG4pKXJldHVybiBuO3Rocm93IG5ldyBUeXBlRXJyb3IoIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuIil9cmV0dXJuKCJzdHJpbmciPT09ZT9TdHJpbmc6TnVtYmVyKSh0KX0odCwic3RyaW5nIik7cmV0dXJuInN5bWJvbCI9PWFsKGUpP2U6ZSsiIn1mdW5jdGlvbiBsbCh0LGUscil7cmV0dXJuKGU9dWwoZSkpaW4gdD9Scih0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTp0W2VdPXIsdH12YXIgaGwsZGw9byxmbD1RLHBsPWZ1bmN0aW9uKHQsZSl7dmFyIHI9ZmxbdCsiUHJvdG90eXBlIl0sbj1yJiZyW2VdO2lmKG4pcmV0dXJuIG47dmFyIGk9ZGxbdF0sbz1pJiZpLnByb3RvdHlwZTtyZXR1cm4gbyYmb1tlXX0sX2w9cSxnbD13LG1sPWRlKCJtYXRjaCIpLHlsPXJyLHZsPUIsYmw9cXQsd2w9b3QsU2w9ZnVuY3Rpb24oKXt2YXIgdD15bCh0aGlzKSxlPSIiO3JldHVybiB0Lmhhc0luZGljZXMmJihlKz0iZCIpLHQuZ2xvYmFsJiYoZSs9ImciKSx0Lmlnbm9yZUNhc2UmJihlKz0iaSIpLHQubXVsdGlsaW5lJiYoZSs9Im0iKSx0LmRvdEFsbCYmKGUrPSJzIiksdC51bmljb2RlJiYoZSs9InUiKSx0LnVuaWNvZGVTZXRzJiYoZSs9InYiKSx0LnN0aWNreSYmKGUrPSJ5IiksZX0sa2w9UmVnRXhwLnByb3RvdHlwZSxPbD1uZXcgVWludDhBcnJheSgxNik7ZnVuY3Rpb24geGwoKXtpZighaGwmJiEoaGw9InVuZGVmaW5lZCIhPXR5cGVvZiBjcnlwdG8mJmNyeXB0by5nZXRSYW5kb21WYWx1ZXMmJmNyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChjcnlwdG8pfHwidW5kZWZpbmVkIiE9dHlwZW9mIG1zQ3J5cHRvJiYiZnVuY3Rpb24iPT10eXBlb2YgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzJiZtc0NyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChtc0NyeXB0bykpKXRocm93IG5ldyBFcnJvcigiY3J5cHRvLmdldFJhbmRvbVZhbHVlcygpIG5vdCBzdXBwb3J0ZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQjZ2V0cmFuZG9tdmFsdWVzLW5vdC1zdXBwb3J0ZWQiKTtyZXR1cm4gaGwoT2wpfXZhciBBbD0vXig/OlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9fDAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCkkL2k7Zm9yKHZhciBFbD1bXSxDbD0wO0NsPDI1NjsrK0NsKUVsLnB1c2goKENsKzI1NikudG9TdHJpbmcoMTYpLnN1YnN0cigxKSk7ZnVuY3Rpb24gSWwodCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjAscj0oRWxbdFtlKzBdXStFbFt0W2UrMV1dK0VsW3RbZSsyXV0rRWxbdFtlKzNdXSsiLSIrRWxbdFtlKzRdXStFbFt0W2UrNV1dKyItIitFbFt0W2UrNl1dK0VsW3RbZSs3XV0rIi0iK0VsW3RbZSs4XV0rRWxbdFtlKzldXSsiLSIrRWxbdFtlKzEwXV0rRWxbdFtlKzExXV0rRWxbdFtlKzEyXV0rRWxbdFtlKzEzXV0rRWxbdFtlKzE0XV0rRWxbdFtlKzE1XV0pLnRvTG93ZXJDYXNlKCk7aWYoIWZ1bmN0aW9uKHQpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdCYmQWwudGVzdCh0KX0ocikpdGhyb3cgVHlwZUVycm9yKCJTdHJpbmdpZmllZCBVVUlEIGlzIGludmFsaWQiKTtyZXR1cm4gcn1mdW5jdGlvbiBUbCh0LGUscil7dmFyIG49KHQ9dHx8e30pLnJhbmRvbXx8KHQucm5nfHx4bCkoKTtpZihuWzZdPTE1Jm5bNl18NjQsbls4XT02MyZuWzhdfDEyOCxlKXtyPXJ8fDA7Zm9yKHZhciBpPTA7aTwxNjsrK2kpZVtyK2ldPW5baV07cmV0dXJuIGV9cmV0dXJuIElsKG4pfWNvbnN0IEJsPSgpPT4idW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdztmdW5jdGlvbiBMbCh0KXtyZXR1cm4gbnVsbD09dD8idW5kZWZpbmVkIHwgbnVsbCI6InN0cmluZyI9PXR5cGVvZiB0P3Q6SlNPTi5zdHJpbmdpZnkoe2NvbnRlbnRIaW50OnQuY29udGVudEhpbnQsZW5hYmxlZDp0LmVuYWJsZWQsaWQ6dC5pZCxraW5kOnQua2luZCxsYWJlbDp0LmxhYmVsLG11dGVkOnQubXV0ZWQscmVhZHlTdGF0ZTp0LnJlYWR5U3RhdGV9KX1mdW5jdGlvbiBObCh0KXtyZXR1cm4gbnVsbD09dD8idW5kZWZpbmVkIHwgbnVsbCI6InN0cmluZyI9PXR5cGVvZiB0P3Q6SlNPTi5zdHJpbmdpZnkoe3RyYWNrOkxsKHQudHJhY2spfSl9ZnVuY3Rpb24gUmwodCl7cmV0dXJuIG51bGw9PXQ/InVuZGVmaW5lZCB8IG51bGwiOiJzdHJpbmciPT10eXBlb2YgdD90OkpTT04uc3RyaW5naWZ5KHt0cmFjazpMbCh0LnRyYWNrKX0pfWNvbnN0IHpsPSJAYnl0ZWQvdmUtcnRjIixEbD0iQGJ5dGVkL3ZlLXJ0Yy1jYWNoZS1zaXplIjt2YXIgUGw9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7bGwodGhpcywic3RvcmVLZXkiLHZvaWQgMCksbGwodGhpcywibG9nTGV2ZWwiLHZvaWQgMCksbGwodGhpcywiTG9nZmlsZVNpemUiLHZvaWQgMCksbGwodGhpcywiZGIiLHZvaWQgMCksbGwodGhpcywibG9nSWQiLHZvaWQgMCksbGwodGhpcywiY2FjaGVMb2ciLHZvaWQgMCksbGwodGhpcywiY2FjaGVkU2l6ZSIsdm9pZCAwKSxsbCh0aGlzLCJwcmVDYWNoZVRpbWUiLHZvaWQgMCksbGwodGhpcywidGltZXIiLHZvaWQgMCksbGwodGhpcywiX2dldFNpemUiLCh0PT5uZXcgQmxvYih0KS5zaXplLzEwNDg1NzYpKSx0aGlzLnN0b3JlS2V5PSIiLHRoaXMubG9nSWQ9MSx0aGlzLmNhY2hlTG9nPSIiLHRoaXMubG9nTGV2ZWw9Im5vbmUiLHRoaXMuTG9nZmlsZVNpemU9MTAwLHRoaXMuX2NyZWF0ZVN0b3JlKCl9X2NyZWF0ZVN0b3JlKCl7aWYoQmwoKXx8IXdpbmRvdy5pbmRleGVkREIpcmV0dXJuO2NvbnN0IHQ9aW5kZXhlZERCLm9wZW4oIkBieXRlZC92ZS1ydGMiKTt0Lm9udXBncmFkZW5lZWRlZD0oKT0+e3QucmVzdWx0LmNyZWF0ZU9iamVjdFN0b3JlKHpsKTt0cnl7bG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oRGwpfWNhdGNoKFlnKXt9fSx0Lm9uZXJyb3I9dD0+e30sdC5vbnN1Y2Nlc3M9KCk9Pnt0aGlzLmRiPXQucmVzdWx0LHRoaXMuX2dldENhY2hlZFNpemUoKX19X2dldENhY2hlZFNpemUoKXt0cnl7Y29uc3QgdD1sb2NhbFN0b3JhZ2UuZ2V0SXRlbShEbCk7dD90aGlzLmNhY2hlZFNpemU9TnVtYmVyKHQpOnRoaXMudmFsdWVzKCkudGhlbigodD0+e3RoaXMuY2FjaGVkU2l6ZT10aGlzLl9nZXRTaXplKHQpLHRoaXMuX3NldENhY2hlZFNpemUoKX0pKX1jYXRjaChZZyl7fX1fc2V0Q2FjaGVkU2l6ZSgpe3RyeXtsb2NhbFN0b3JhZ2Uuc2V0SXRlbShEbCwiIi5jb25jYXQodGhpcy5jYWNoZWRTaXplKSl9Y2F0Y2goWWcpe319X2dldFN0b3JlKHQpe2lmKHRoaXMuZGIpcmV0dXJuIHRoaXMuZGIudHJhbnNhY3Rpb24oemwsdCkub2JqZWN0U3RvcmUoemwpfXNldCh0KXtyZXR1cm4gbmV3IFByb21pc2UoKChlLHIpPT57aWYoIm5vbmUiPT09dGhpcy5sb2dMZXZlbClyZXR1cm4gZSgpO2lmKHQmJnRoaXMucHJlQ2FjaGVUaW1lJiZ0aGlzLnByZUNhY2hlVGltZS1EYXRlLm5vdygpPDFlMylyZXR1cm4gdGhpcy5jYWNoZUxvZys9IlxuXG4iLmNvbmNhdCh0aGlzLmxvZ0lkLCI6ICIpLmNvbmNhdCh0KSx0aGlzLmxvZ0lkKyssdGhpcy50aW1lcnx8KHRoaXMudGltZXI9c2V0VGltZW91dCgoKCk9Pnt0aGlzLnNldCgiIil9KSwxZTMtKHRoaXMucHJlQ2FjaGVUaW1lLURhdGUubm93KCkpKSksZSgpO2NsZWFyVGltZW91dCh0aGlzLnRpbWVyKSx0aGlzLnRpbWVyPW51bGw7Y29uc3Qgbj10aGlzLl9nZXRTdG9yZSgicmVhZHdyaXRlIik7aWYoIW4pcmV0dXJuIHIoImdldCBzdG9yZSBmYWlsIik7dGhpcy5jYWNoZWRTaXplJiZ0aGlzLmNhY2hlZFNpemU+dGhpcy5Mb2dmaWxlU2l6ZSYmdGhpcy5rZXlFYXJsaWVzdCgpLnRoZW4oKHQ9Pnt0aGlzLmdldCh0KS50aGVuKChlPT57dGhpcy5kZWwodCkudGhlbigoKCk9Pnt0aGlzLmNhY2hlZFNpemU9dGhpcy5jYWNoZWRTaXplLXRoaXMuX2dldFNpemUoWyIiLmNvbmNhdChlKV0pLHRoaXMuX3NldENhY2hlZFNpemUoKX0pKX0pKX0pKTtjb25zdCBpPW4uZ2V0KHRoaXMuc3RvcmVLZXkpO2kub25zdWNjZXNzPSgpPT57dHJ5e2NvbnN0IHI9IiIuY29uY2F0KGkucmVzdWx0fHwiIikuY29uY2F0KHRoaXMuY2FjaGVMb2cpLG89dD8iIi5jb25jYXQocj8iXG5cbiI6IiIpLmNvbmNhdCh0aGlzLmxvZ0lkLCI6ICIpLmNvbmNhdCh0KToiIjtuLnB1dCgiIi5jb25jYXQocikuY29uY2F0KG8pLHRoaXMuc3RvcmVLZXkpLHQmJnRoaXMubG9nSWQrKyx0aGlzLmNhY2hlTG9nPSIiLHRoaXMuY2FjaGVkU2l6ZT0odGhpcy5jYWNoZWRTaXplfHwwKSt0aGlzLl9nZXRTaXplKFsiIi5jb25jYXQodGhpcy5jYWNoZUxvZykuY29uY2F0KG8pXSksdGhpcy5fc2V0Q2FjaGVkU2l6ZSgpLHRoaXMucHJlQ2FjaGVUaW1lPURhdGUubm93KCksZSgpfWNhdGNoKG8pe2lmKCF0KXJldHVybiByKG8pO3RoaXMuY2FjaGVMb2crPSJcblxuIi5jb25jYXQodGhpcy5sb2dJZCwiOiAiKS5jb25jYXQodCksdGhpcy5sb2dJZCsrLHIobyl9fSxpLm9uZXJyb3I9ZT0+e2lmKCF0KXJldHVybiByKGUpO3RoaXMuY2FjaGVMb2crPSJcblxuIi5jb25jYXQodGhpcy5sb2dJZCwiOiAiKS5jb25jYXQodCksdGhpcy5sb2dJZCsrLHIoZSl9fSkpfWdldCh0KXtyZXR1cm4gbmV3IFByb21pc2UoKChlLHIpPT57Y29uc3Qgbj10aGlzLl9nZXRTdG9yZSgicmVhZG9ubHkiKTtpZighbilyZXR1cm4gcigpO2NvbnN0IGk9bi5nZXQodCk7aS5vbnN1Y2Nlc3M9KCk9PntlKGkucmVzdWx0KX0saS5vbmVycm9yPXQ9PntyKHQpfX0pKX1kZWwoKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06dGhpcy5zdG9yZUtleTtyZXR1cm4gbmV3IFByb21pc2UoKChlLHIpPT57Y29uc3Qgbj10aGlzLl9nZXRTdG9yZSgicmVhZHdyaXRlIik7aWYoIW4pcmV0dXJuIHIoKTtjb25zdCBpPW4uZGVsZXRlKHQpO2kub25zdWNjZXNzPSgpPT5lKGkucmVzdWx0KSxpLm9uZXJyb3I9dD0+cih0KX0pKX1rZXlFYXJsaWVzdCgpe3JldHVybiB0aGlzLmtleXMoKS50aGVuKCh0PT57bGV0IGUscj1EYXRlLm5vdygpO3JldHVybiB0LmZvckVhY2goKHQ9PntpZighdHx8IXQubGVuZ3RoKXJldHVybjtjb25zdCBuPXQuc3BsaXQoIi0iKVswXTtOdW1iZXIobik8ciYmKHI9TnVtYmVyKG4pLGU9dCl9KSksZX0pKX1rZXlzKCl7cmV0dXJuIG5ldyBQcm9taXNlKCgodCxlKT0+e2NvbnN0IHI9dGhpcy5fZ2V0U3RvcmUoInJlYWRvbmx5Iik7aWYoIXIpcmV0dXJuIGUoKTtpZihyLmdldEFsbEtleXMpe2NvbnN0IG49ci5nZXRBbGxLZXlzKCk7cmV0dXJuIG4ub25zdWNjZXNzPSgpPT57dChuLnJlc3VsdCl9LHZvaWQobi5vbmVycm9yPSgpPT57ZSgpfSl9Y29uc3Qgbj1bXTtyLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt0aGlzLnJlc3VsdCYmKG4ucHVzaCh0aGlzLnJlc3VsdC5rZXkpLHRoaXMucmVzdWx0LmNvbnRpbnVlKCkpfSxyLnRyYW5zYWN0aW9uLm9uY29tcGxldGU9KCk9PnQobil9KSl9dmFsdWVzKCl7cmV0dXJuIG5ldyBQcm9taXNlKCgodCxlKT0+e2NvbnN0IHI9dGhpcy5fZ2V0U3RvcmUoInJlYWRvbmx5Iik7aWYoIXIpcmV0dXJuIGUoKTtpZihyLmdldEFsbCl7Y29uc3Qgbj1yLmdldEFsbCgpO3JldHVybiBuLm9uc3VjY2Vzcz0oKT0+e3Qobi5yZXN1bHQpfSx2b2lkKG4ub25lcnJvcj0oKT0+e2UoKX0pfWNvbnN0IG49W107ci5vcGVuQ3Vyc29yKCkub25zdWNjZXNzPWZ1bmN0aW9uKCl7dGhpcy5yZXN1bHQmJihuLnB1c2godGhpcy5yZXN1bHQudmFsdWUpLHRoaXMucmVzdWx0LmNvbnRpbnVlKCkpfSxyLnRyYW5zYWN0aW9uLm9uY29tcGxldGU9KCk9PnQobil9KSl9ZG93bmxvYWQodCl7dD10fHx0aGlzLnN0b3JlS2V5LHRoaXMuZ2V0KHQpLnRoZW4oKGU9Pntjb25zdCByPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTtyLmRvd25sb2FkPSIiLmNvbmNhdCh0LCIudHh0Iiksci5ocmVmPSJkYXRhOnRleHQvcGFpbnQ7dXRmLTgsIi5jb25jYXQoZXx8IiIpLHIuY2xpY2soKX0pKX19O2NsYXNzIE1se2NvbnN0cnVjdG9yKCl7bGwodGhpcywiX2FsbCIse30pfW9uKHQsZSl7Y29uc3Qgcj10aGlzLl9hbGxbdF07cj9yLnB1c2goZSk6dGhpcy5fYWxsW3RdPVtlXX1vbmNlKHQsZSl7dmFyIHI9dGhpcztjb25zdCBuPWZ1bmN0aW9uKCl7ZSguLi5hcmd1bWVudHMpLHIub2ZmKHQsbil9O3RoaXMub24odCxuKX1vZmYodCxlKXtjb25zdCByPXRoaXMuX2FsbFt0XTtudWxsPT1yfHxyLnNwbGljZShyLmluZGV4T2YoZSk+Pj4wLDEpfWVtaXQodCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO2NvbnN0IGk9dGhpcy5fYWxsW3RdO251bGw9PWl8fGkuc2xpY2UoKS5mb3JFYWNoKCh0PT50KC4uLnIpKSl9c2FmZUVtaXQodCl7dHJ5e2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGU+MT9lLTE6MCksbj0xO248ZTtuKyspcltuLTFdPWFyZ3VtZW50c1tuXTtyZXR1cm4gdGhpcy5lbWl0KHQsLi4ucil9Y2F0Y2goWWcpe2NvbnNvbGUuZXJyb3IoWWcpfX1kZXN0cm95KCl7dGhpcy5fYWxsPXt9fX1jb25zdCBVbD1bIlVQTE9BRF9DT05TT0xFX0xFTkdUSF9DVVQiLCJVUExPQURfUkVQT1JUX0xJTUlUIl07Y29uc3QgRmw9bmV3IGNsYXNzIGV4dGVuZHMgTWx7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLGxsKHRoaXMsImNvbmZpZyIse1VQTE9BRF9DT05TT0xFX09OOiExLFVQTE9BRF9DT05TT0xFX0xFTkdUSF9DVVQ6MjAwLFVQTE9BRF9SRVBPUlRfTElNSVQ6NDVlNCxFTkFCTEVfUkVQT1JUX0lEQl9CVUZGRVI6ITF9KX1zZXRQYXJhbWV0ZXIodCxlKXtpZihmdW5jdGlvbih0KXtyZXR1cm4gVWwuaW5jbHVkZXModCl9KHQpKXRyeXtjb25zdCByPU51bWJlcihlKTtpZihOdW1iZXIuaXNOYU4ocikpcmV0dXJuO3RoaXMuY29uZmlnW3RdPXJ9Y2F0Y2gocil7cmV0dXJuIHZvaWQgY29uc29sZS53YXJuKCJDYW5ub3QgY29udmVydCBjb3JlIGxpYiBwYXJhbWV0ZXIgIi5jb25jYXQodCwiOiIpLmNvbmNhdChlLCIgaW50byBudW1iZXIiKSl9ZWxzZSB0aGlzLmNvbmZpZ1t0XT1lO3RoaXMuZW1pdCh0LHRoaXMuY29uZmlnW3RdKX1nZXRQYXJhbWV0ZXIodCl7cmV0dXJuIHRoaXMuY29uZmlnW3RdfWdldEtleXMoKXtyZXR1cm4gT2JqZWN0LmtleXModGhpcy5jb25maWcpfX07dmFyIGpsPSR0LEhsPW1pO0NyKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6cygoZnVuY3Rpb24oKXtIbCgxKX0pKX0se2tleXM6ZnVuY3Rpb24odCl7cmV0dXJuIEhsKGpsKHQpKX19KTt2YXIgS2w9ZShRLk9iamVjdC5rZXlzKSxKbD1lKFEuT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyksV2w9WW8uZmlsdGVyO0NyKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6IVJuKCJmaWx0ZXIiKX0se2ZpbHRlcjpmdW5jdGlvbih0KXtyZXR1cm4gV2wodGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KTt2YXIgWmw9cGwoIkFycmF5IiwiZmlsdGVyIiksR2w9b3QsVmw9WmwsJGw9QXJyYXkucHJvdG90eXBlLFhsPWUoKGZ1bmN0aW9uKHQpe3ZhciBlPXQuZmlsdGVyO3JldHVybiB0PT09JGx8fEdsKCRsLHQpJiZlPT09JGwuZmlsdGVyP1ZsOmV9KSksWWw9e2V4cG9ydHM6e319LHFsPUNyLFFsPXMsdGg9WCxlaD1FLmYscmg9QztxbCh7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOiFyaHx8UWwoKGZ1bmN0aW9uKCl7ZWgoMSl9KSksc2hhbTohcmh9LHtnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gZWgodGgodCksZSl9fSk7dmFyIG5oPVEuT2JqZWN0LGloPVlsLmV4cG9ydHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmguZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSl9O25oLmdldE93blByb3BlcnR5RGVzY3JpcHRvci5zaGFtJiYoaWguc2hhbT0hMCk7dmFyIG9oPWUoWWwuZXhwb3J0cyksc2g9QyxhaD1EcixjaD1UeXBlRXJyb3IsdWg9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixsaD1zaCYmIWZ1bmN0aW9uKCl7aWYodm9pZCAwIT09dGhpcylyZXR1cm4hMDt0cnl7T2JqZWN0LmRlZmluZVByb3BlcnR5KFtdLCJsZW5ndGgiLHt3cml0YWJsZTohMX0pLmxlbmd0aD0xfWNhdGNoKFlnKXtyZXR1cm4gWWcgaW5zdGFuY2VvZiBUeXBlRXJyb3J9fSgpLGhoPSR0LGRoPUpyLGZoPWxoP2Z1bmN0aW9uKHQsZSl7aWYoYWgodCkmJiF1aCh0LCJsZW5ndGgiKS53cml0YWJsZSl0aHJvdyBuZXcgY2goIkNhbm5vdCBzZXQgcmVhZCBvbmx5IC5sZW5ndGgiKTtyZXR1cm4gdC5sZW5ndGg9ZX06ZnVuY3Rpb24odCxlKXtyZXR1cm4gdC5sZW5ndGg9ZX0scGg9WnI7Q3Ioe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGFyaXR5OjEsZm9yY2VkOnMoKGZ1bmN0aW9uKCl7cmV0dXJuIDQyOTQ5NjcyOTchPT1bXS5wdXNoLmNhbGwoe2xlbmd0aDo0Mjk0OTY3Mjk2fSwxKX0pKXx8IWZ1bmN0aW9uKCl7dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0eShbXSwibGVuZ3RoIix7d3JpdGFibGU6ITF9KS5wdXNoKCl9Y2F0Y2goWWcpe3JldHVybiBZZyBpbnN0YW5jZW9mIFR5cGVFcnJvcn19KCl9LHtwdXNoOmZ1bmN0aW9uKHQpe3ZhciBlPWhoKHRoaXMpLHI9ZGgoZSksbj1hcmd1bWVudHMubGVuZ3RoO3BoKHIrbik7Zm9yKHZhciBpPTA7aTxuO2krKyllW3JdPWFyZ3VtZW50c1tpXSxyKys7cmV0dXJuIGZoKGUscikscn19KTt2YXIgX2g9cGwoIkFycmF5IiwicHVzaCIpLGdoPW90LG1oPV9oLHloPUFycmF5LnByb3RvdHlwZSx2aD1lKChmdW5jdGlvbih0KXt2YXIgZT10LnB1c2g7cmV0dXJuIHQ9PT15aHx8Z2goeWgsdCkmJmU9PT15aC5wdXNoP21oOmV9KSksYmg9cyx3aD1Zby5mb3JFYWNoLFNoPWZ1bmN0aW9uKHQsZSl7dmFyIHI9W11bdF07cmV0dXJuISFyJiZiaCgoZnVuY3Rpb24oKXtyLmNhbGwobnVsbCxlfHxmdW5jdGlvbigpe3JldHVybiAxfSwxKX0pKX0oImZvckVhY2giKT9bXS5mb3JFYWNoOmZ1bmN0aW9uKHQpe3JldHVybiB3aCh0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfTtDcih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOltdLmZvckVhY2ghPT1TaH0se2ZvckVhY2g6U2h9KTt2YXIga2g9cGwoIkFycmF5IiwiZm9yRWFjaCIpLE9oPXNuLHhoPXF0LEFoPW90LEVoPWtoLENoPUFycmF5LnByb3RvdHlwZSxJaD17RE9NVG9rZW5MaXN0OiEwLE5vZGVMaXN0OiEwfSxUaD1lKChmdW5jdGlvbih0KXt2YXIgZT10LmZvckVhY2g7cmV0dXJuIHQ9PT1DaHx8QWgoQ2gsdCkmJmU9PT1DaC5mb3JFYWNofHx4aChJaCxPaCh0KSk/RWg6ZX0pKSxCaD1pdCxMaD1LaSxOaD1RaSxSaD1ycix6aD1tKFtdLmNvbmNhdCksRGg9QmgoIlJlZmxlY3QiLCJvd25LZXlzIil8fGZ1bmN0aW9uKHQpe3ZhciBlPUxoLmYoUmgodCkpLHI9TmguZjtyZXR1cm4gcj96aChlLHIodCkpOmV9LFBoPVgsTWg9RSxVaD1YcjtDcih7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsc2hhbTohQ30se2dldE93blByb3BlcnR5RGVzY3JpcHRvcnM6ZnVuY3Rpb24odCl7Zm9yKHZhciBlLHIsbj1QaCh0KSxpPU1oLmYsbz1EaChuKSxzPXt9LGE9MDtvLmxlbmd0aD5hOyl2b2lkIDAhPT0ocj1pKG4sZT1vW2ErK10pKSYmVWgocyxlLHIpO3JldHVybiBzfX0pO3ZhciBGaD1lKFEuT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpLGpoPXtleHBvcnRzOnt9fSxIaD1DcixLaD1DLEpoPXFuLmY7SGgoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDpPYmplY3QuZGVmaW5lUHJvcGVydGllcyE9PUpoLHNoYW06IUtofSx7ZGVmaW5lUHJvcGVydGllczpKaH0pO3ZhciBXaD1RLk9iamVjdCxaaD1qaC5leHBvcnRzPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIFdoLmRlZmluZVByb3BlcnRpZXModCxlKX07V2guZGVmaW5lUHJvcGVydGllcy5zaGFtJiYoWmguc2hhbT0hMCk7dmFyIEdoPWUoamguZXhwb3J0cyk7ZnVuY3Rpb24gVmgodCxlKXt2YXIgcj1LbCh0KTtpZihKbCl7dmFyIG49SmwodCk7ZSYmKG49WGwobikuY2FsbChuLChmdW5jdGlvbihlKXtyZXR1cm4gb2godCxlKS5lbnVtZXJhYmxlfSkpKSx2aChyKS5hcHBseShyLG4pfXJldHVybiByfWZ1bmN0aW9uICRoKHQpe2Zvcih2YXIgZT0xO2U8YXJndW1lbnRzLmxlbmd0aDtlKyspe3ZhciByLG4saT1udWxsIT1hcmd1bWVudHNbZV0/YXJndW1lbnRzW2VdOnt9O2UlMj9UaChyPVZoKE9iamVjdChpKSwhMCkpLmNhbGwociwoZnVuY3Rpb24oZSl7bGwodCxlLGlbZV0pfSkpOkZoP0doKHQsRmgoaSkpOlRoKG49VmgoT2JqZWN0KGkpKSkuY2FsbChuLChmdW5jdGlvbihlKXtScih0LGUsb2goaSxlKSl9KSl9cmV0dXJuIHR9dmFyIFhoPURyLFloPUpyLHFoPVpyLFFoPVhlLHRkPWZ1bmN0aW9uKHQsZSxyLG4saSxvLHMsYSl7Zm9yKHZhciBjLHUsbD1pLGg9MCxkPSEhcyYmUWgocyxhKTtoPG47KWggaW4gciYmKGM9ZD9kKHJbaF0saCxlKTpyW2hdLG8+MCYmWGgoYyk/KHU9WWgoYyksbD10ZCh0LGUsYyx1LGwsby0xKS0xKToocWgobCsxKSx0W2xdPWMpLGwrKyksaCsrO3JldHVybiBsfSxlZD10ZCxyZD0kdCxuZD1KcixpZD1GcixvZD1UbjtDcih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITB9LHtmbGF0OmZ1bmN0aW9uKCl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD9hcmd1bWVudHNbMF06dm9pZCAwLGU9cmQodGhpcykscj1uZChlKSxuPW9kKGUsMCk7cmV0dXJuIG4ubGVuZ3RoPWVkKG4sZSxlLHIsMCx2b2lkIDA9PT10PzE6aWQodCkpLG59fSk7dmFyIHNkPXBsKCJBcnJheSIsImZsYXQiKSxhZD1vdCxjZD1zZCx1ZD1BcnJheS5wcm90b3R5cGUsbGQ9ZSgoZnVuY3Rpb24odCl7dmFyIGU9dC5mbGF0O3JldHVybiB0PT09dWR8fGFkKHVkLHQpJiZlPT09dWQuZmxhdD9jZDplfSkpLGhkPXt9OyFmdW5jdGlvbih0KXt2YXIgZT0idW5kZWZpbmVkIiE9dHlwZW9mIFVpbnQ4QXJyYXkmJiJ1bmRlZmluZWQiIT10eXBlb2YgVWludDE2QXJyYXkmJiJ1bmRlZmluZWQiIT10eXBlb2YgSW50MzJBcnJheTtmdW5jdGlvbiByKHQsZSl7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LGUpfXQuYXNzaWduPWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7ZS5sZW5ndGg7KXt2YXIgbj1lLnNoaWZ0KCk7aWYobil7aWYoIm9iamVjdCIhPXR5cGVvZiBuKXRocm93IG5ldyBUeXBlRXJyb3IobisibXVzdCBiZSBub24tb2JqZWN0Iik7Zm9yKHZhciBpIGluIG4pcihuLGkpJiYodFtpXT1uW2ldKX19cmV0dXJuIHR9LHQuc2hyaW5rQnVmPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQubGVuZ3RoPT09ZT90OnQuc3ViYXJyYXk/dC5zdWJhcnJheSgwLGUpOih0Lmxlbmd0aD1lLHQpfTt2YXIgbj17YXJyYXlTZXQ6ZnVuY3Rpb24odCxlLHIsbixpKXtpZihlLnN1YmFycmF5JiZ0LnN1YmFycmF5KXQuc2V0KGUuc3ViYXJyYXkocixyK24pLGkpO2Vsc2UgZm9yKHZhciBvPTA7bzxuO28rKyl0W2krb109ZVtyK29dfSxmbGF0dGVuQ2h1bmtzOmZ1bmN0aW9uKHQpe3ZhciBlLHIsbixpLG8scztmb3Iobj0wLGU9MCxyPXQubGVuZ3RoO2U8cjtlKyspbis9dFtlXS5sZW5ndGg7Zm9yKHM9bmV3IFVpbnQ4QXJyYXkobiksaT0wLGU9MCxyPXQubGVuZ3RoO2U8cjtlKyspbz10W2VdLHMuc2V0KG8saSksaSs9by5sZW5ndGg7cmV0dXJuIHN9fSxpPXthcnJheVNldDpmdW5jdGlvbih0LGUscixuLGkpe2Zvcih2YXIgbz0wO288bjtvKyspdFtpK29dPWVbcitvXX0sZmxhdHRlbkNodW5rczpmdW5jdGlvbih0KXtyZXR1cm5bXS5jb25jYXQuYXBwbHkoW10sdCl9fTt0LnNldFR5cGVkPWZ1bmN0aW9uKGUpe2U/KHQuQnVmOD1VaW50OEFycmF5LHQuQnVmMTY9VWludDE2QXJyYXksdC5CdWYzMj1JbnQzMkFycmF5LHQuYXNzaWduKHQsbikpOih0LkJ1Zjg9QXJyYXksdC5CdWYxNj1BcnJheSx0LkJ1ZjMyPUFycmF5LHQuYXNzaWduKHQsaSkpfSx0LnNldFR5cGVkKGUpfShoZCk7dmFyIGRkPXt9LGZkPXt9LHBkPXt9LF9kPWhkO2Z1bmN0aW9uIGdkKHQpe2Zvcih2YXIgZT10Lmxlbmd0aDstLWU+PTA7KXRbZV09MH12YXIgbWQ9MjU2LHlkPTI4Nix2ZD0zMCxiZD0xNSx3ZD1bMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwXSxTZD1bMCwwLDAsMCwxLDEsMiwyLDMsMyw0LDQsNSw1LDYsNiw3LDcsOCw4LDksOSwxMCwxMCwxMSwxMSwxMiwxMiwxMywxM10sa2Q9WzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMiwzLDddLE9kPVsxNiwxNywxOCwwLDgsNyw5LDYsMTAsNSwxMSw0LDEyLDMsMTMsMiwxNCwxLDE1XSx4ZD1uZXcgQXJyYXkoNTc2KTtnZCh4ZCk7dmFyIEFkPW5ldyBBcnJheSg2MCk7Z2QoQWQpO3ZhciBFZD1uZXcgQXJyYXkoNTEyKTtnZChFZCk7dmFyIENkPW5ldyBBcnJheSgyNTYpO2dkKENkKTt2YXIgSWQ9bmV3IEFycmF5KDI5KTtnZChJZCk7dmFyIFRkLEJkLExkLE5kPW5ldyBBcnJheSh2ZCk7ZnVuY3Rpb24gUmQodCxlLHIsbixpKXt0aGlzLnN0YXRpY190cmVlPXQsdGhpcy5leHRyYV9iaXRzPWUsdGhpcy5leHRyYV9iYXNlPXIsdGhpcy5lbGVtcz1uLHRoaXMubWF4X2xlbmd0aD1pLHRoaXMuaGFzX3N0cmVlPXQmJnQubGVuZ3RofWZ1bmN0aW9uIHpkKHQsZSl7dGhpcy5keW5fdHJlZT10LHRoaXMubWF4X2NvZGU9MCx0aGlzLnN0YXRfZGVzYz1lfWZ1bmN0aW9uIERkKHQpe3JldHVybiB0PDI1Nj9FZFt0XTpFZFsyNTYrKHQ+Pj43KV19ZnVuY3Rpb24gUGQodCxlKXt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTV9ZnVuY3Rpb24gTWQodCxlLHIpe3QuYmlfdmFsaWQ+MTYtcj8odC5iaV9idWZ8PWU8PHQuYmlfdmFsaWQmNjU1MzUsUGQodCx0LmJpX2J1ZiksdC5iaV9idWY9ZT4+MTYtdC5iaV92YWxpZCx0LmJpX3ZhbGlkKz1yLTE2KToodC5iaV9idWZ8PWU8PHQuYmlfdmFsaWQmNjU1MzUsdC5iaV92YWxpZCs9cil9ZnVuY3Rpb24gVWQodCxlLHIpe01kKHQsclsyKmVdLHJbMiplKzFdKX1mdW5jdGlvbiBGZCh0LGUpe3ZhciByPTA7ZG97cnw9MSZ0LHQ+Pj49MSxyPDw9MX13aGlsZSgtLWU+MCk7cmV0dXJuIHI+Pj4xfWZ1bmN0aW9uIGpkKHQsZSxyKXt2YXIgbixpLG89bmV3IEFycmF5KDE2KSxzPTA7Zm9yKG49MTtuPD1iZDtuKyspb1tuXT1zPXMrcltuLTFdPDwxO2ZvcihpPTA7aTw9ZTtpKyspe3ZhciBhPXRbMippKzFdOzAhPT1hJiYodFsyKmldPUZkKG9bYV0rKyxhKSl9fWZ1bmN0aW9uIEhkKHQpe3ZhciBlO2ZvcihlPTA7ZTx5ZDtlKyspdC5keW5fbHRyZWVbMiplXT0wO2ZvcihlPTA7ZTx2ZDtlKyspdC5keW5fZHRyZWVbMiplXT0wO2ZvcihlPTA7ZTwxOTtlKyspdC5ibF90cmVlWzIqZV09MDt0LmR5bl9sdHJlZVs1MTJdPTEsdC5vcHRfbGVuPXQuc3RhdGljX2xlbj0wLHQubGFzdF9saXQ9dC5tYXRjaGVzPTB9ZnVuY3Rpb24gS2QodCl7dC5iaV92YWxpZD44P1BkKHQsdC5iaV9idWYpOnQuYmlfdmFsaWQ+MCYmKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPXQuYmlfYnVmKSx0LmJpX2J1Zj0wLHQuYmlfdmFsaWQ9MH1mdW5jdGlvbiBKZCh0LGUscixuKXt2YXIgaT0yKmUsbz0yKnI7cmV0dXJuIHRbaV08dFtvXXx8dFtpXT09PXRbb10mJm5bZV08PW5bcl19ZnVuY3Rpb24gV2QodCxlLHIpe2Zvcih2YXIgbj10LmhlYXBbcl0saT1yPDwxO2k8PXQuaGVhcF9sZW4mJihpPHQuaGVhcF9sZW4mJkpkKGUsdC5oZWFwW2krMV0sdC5oZWFwW2ldLHQuZGVwdGgpJiZpKyssIUpkKGUsbix0LmhlYXBbaV0sdC5kZXB0aCkpOyl0LmhlYXBbcl09dC5oZWFwW2ldLHI9aSxpPDw9MTt0LmhlYXBbcl09bn1mdW5jdGlvbiBaZCh0LGUscil7dmFyIG4saSxvLHMsYT0wO2lmKDAhPT10Lmxhc3RfbGl0KWRve249dC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqYV08PDh8dC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqYSsxXSxpPXQucGVuZGluZ19idWZbdC5sX2J1ZithXSxhKyssMD09PW4/VWQodCxpLGUpOihVZCh0LChvPUNkW2ldKSttZCsxLGUpLDAhPT0ocz13ZFtvXSkmJk1kKHQsaS09SWRbb10scyksVWQodCxvPURkKC0tbiksciksMCE9PShzPVNkW29dKSYmTWQodCxuLT1OZFtvXSxzKSl9d2hpbGUoYTx0Lmxhc3RfbGl0KTtVZCh0LDI1NixlKX1mdW5jdGlvbiBHZCh0LGUpe3ZhciByLG4saSxvPWUuZHluX3RyZWUscz1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxhPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxjPWUuc3RhdF9kZXNjLmVsZW1zLHU9LTE7Zm9yKHQuaGVhcF9sZW49MCx0LmhlYXBfbWF4PTU3MyxyPTA7cjxjO3IrKykwIT09b1syKnJdPyh0LmhlYXBbKyt0LmhlYXBfbGVuXT11PXIsdC5kZXB0aFtyXT0wKTpvWzIqcisxXT0wO2Zvcig7dC5oZWFwX2xlbjwyOylvWzIqKGk9dC5oZWFwWysrdC5oZWFwX2xlbl09dTwyPysrdTowKV09MSx0LmRlcHRoW2ldPTAsdC5vcHRfbGVuLS0sYSYmKHQuc3RhdGljX2xlbi09c1syKmkrMV0pO2ZvcihlLm1heF9jb2RlPXUscj10LmhlYXBfbGVuPj4xO3I+PTE7ci0tKVdkKHQsbyxyKTtpPWM7ZG97cj10LmhlYXBbMV0sdC5oZWFwWzFdPXQuaGVhcFt0LmhlYXBfbGVuLS1dLFdkKHQsbywxKSxuPXQuaGVhcFsxXSx0LmhlYXBbLS10LmhlYXBfbWF4XT1yLHQuaGVhcFstLXQuaGVhcF9tYXhdPW4sb1syKmldPW9bMipyXStvWzIqbl0sdC5kZXB0aFtpXT0odC5kZXB0aFtyXT49dC5kZXB0aFtuXT90LmRlcHRoW3JdOnQuZGVwdGhbbl0pKzEsb1syKnIrMV09b1syKm4rMV09aSx0LmhlYXBbMV09aSsrLFdkKHQsbywxKX13aGlsZSh0LmhlYXBfbGVuPj0yKTt0LmhlYXBbLS10LmhlYXBfbWF4XT10LmhlYXBbMV0sZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYz1lLmR5bl90cmVlLHU9ZS5tYXhfY29kZSxsPWUuc3RhdF9kZXNjLnN0YXRpY190cmVlLGg9ZS5zdGF0X2Rlc2MuaGFzX3N0cmVlLGQ9ZS5zdGF0X2Rlc2MuZXh0cmFfYml0cyxmPWUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UscD1lLnN0YXRfZGVzYy5tYXhfbGVuZ3RoLF89MDtmb3Iobz0wO288PWJkO28rKyl0LmJsX2NvdW50W29dPTA7Zm9yKGNbMip0LmhlYXBbdC5oZWFwX21heF0rMV09MCxyPXQuaGVhcF9tYXgrMTtyPDU3MztyKyspKG89Y1syKmNbMioobj10LmhlYXBbcl0pKzFdKzFdKzEpPnAmJihvPXAsXysrKSxjWzIqbisxXT1vLG4+dXx8KHQuYmxfY291bnRbb10rKyxzPTAsbj49ZiYmKHM9ZFtuLWZdKSxhPWNbMipuXSx0Lm9wdF9sZW4rPWEqKG8rcyksaCYmKHQuc3RhdGljX2xlbis9YSoobFsyKm4rMV0rcykpKTtpZigwIT09Xyl7ZG97Zm9yKG89cC0xOzA9PT10LmJsX2NvdW50W29dOylvLS07dC5ibF9jb3VudFtvXS0tLHQuYmxfY291bnRbbysxXSs9Mix0LmJsX2NvdW50W3BdLS0sXy09Mn13aGlsZShfPjApO2ZvcihvPXA7MCE9PW87by0tKWZvcihuPXQuYmxfY291bnRbb107MCE9PW47KShpPXQuaGVhcFstLXJdKT51fHwoY1syKmkrMV0hPT1vJiYodC5vcHRfbGVuKz0oby1jWzIqaSsxXSkqY1syKmldLGNbMippKzFdPW8pLG4tLSl9fSh0LGUpLGpkKG8sdSx0LmJsX2NvdW50KX1mdW5jdGlvbiBWZCh0LGUscil7dmFyIG4saSxvPS0xLHM9ZVsxXSxhPTAsYz03LHU9NDtmb3IoMD09PXMmJihjPTEzOCx1PTMpLGVbMioocisxKSsxXT02NTUzNSxuPTA7bjw9cjtuKyspaT1zLHM9ZVsyKihuKzEpKzFdLCsrYTxjJiZpPT09c3x8KGE8dT90LmJsX3RyZWVbMippXSs9YTowIT09aT8oaSE9PW8mJnQuYmxfdHJlZVsyKmldKyssdC5ibF90cmVlWzMyXSsrKTphPD0xMD90LmJsX3RyZWVbMzRdKys6dC5ibF90cmVlWzM2XSsrLGE9MCxvPWksMD09PXM/KGM9MTM4LHU9Myk6aT09PXM/KGM9Nix1PTMpOihjPTcsdT00KSl9ZnVuY3Rpb24gJGQodCxlLHIpe3ZhciBuLGksbz0tMSxzPWVbMV0sYT0wLGM9Nyx1PTQ7Zm9yKDA9PT1zJiYoYz0xMzgsdT0zKSxuPTA7bjw9cjtuKyspaWYoaT1zLHM9ZVsyKihuKzEpKzFdLCEoKythPGMmJmk9PT1zKSl7aWYoYTx1KWRve1VkKHQsaSx0LmJsX3RyZWUpfXdoaWxlKDAhPS0tYSk7ZWxzZSAwIT09aT8oaSE9PW8mJihVZCh0LGksdC5ibF90cmVlKSxhLS0pLFVkKHQsMTYsdC5ibF90cmVlKSxNZCh0LGEtMywyKSk6YTw9MTA/KFVkKHQsMTcsdC5ibF90cmVlKSxNZCh0LGEtMywzKSk6KFVkKHQsMTgsdC5ibF90cmVlKSxNZCh0LGEtMTEsNykpO2E9MCxvPWksMD09PXM/KGM9MTM4LHU9Myk6aT09PXM/KGM9Nix1PTMpOihjPTcsdT00KX19Z2QoTmQpO3ZhciBYZD0hMTtmdW5jdGlvbiBZZCh0LGUscixuKXtNZCh0LDArKG4/MTowKSwzKSxmdW5jdGlvbih0LGUscixuKXtLZCh0KSxuJiYoUGQodCxyKSxQZCh0LH5yKSksX2QuYXJyYXlTZXQodC5wZW5kaW5nX2J1Zix0LndpbmRvdyxlLHIsdC5wZW5kaW5nKSx0LnBlbmRpbmcrPXJ9KHQsZSxyLCEwKX1wZC5fdHJfaW5pdD1mdW5jdGlvbih0KXtYZHx8KCFmdW5jdGlvbigpe3ZhciB0LGUscixuLGksbz1uZXcgQXJyYXkoMTYpO2ZvcihyPTAsbj0wO248Mjg7bisrKWZvcihJZFtuXT1yLHQ9MDt0PDE8PHdkW25dO3QrKylDZFtyKytdPW47Zm9yKENkW3ItMV09bixpPTAsbj0wO248MTY7bisrKWZvcihOZFtuXT1pLHQ9MDt0PDE8PFNkW25dO3QrKylFZFtpKytdPW47Zm9yKGk+Pj03O248dmQ7bisrKWZvcihOZFtuXT1pPDw3LHQ9MDt0PDE8PFNkW25dLTc7dCsrKUVkWzI1NitpKytdPW47Zm9yKGU9MDtlPD1iZDtlKyspb1tlXT0wO2Zvcih0PTA7dDw9MTQzOyl4ZFsyKnQrMV09OCx0Kyssb1s4XSsrO2Zvcig7dDw9MjU1Oyl4ZFsyKnQrMV09OSx0Kyssb1s5XSsrO2Zvcig7dDw9Mjc5Oyl4ZFsyKnQrMV09Nyx0Kyssb1s3XSsrO2Zvcig7dDw9Mjg3Oyl4ZFsyKnQrMV09OCx0Kyssb1s4XSsrO2ZvcihqZCh4ZCwyODcsbyksdD0wO3Q8dmQ7dCsrKUFkWzIqdCsxXT01LEFkWzIqdF09RmQodCw1KTtUZD1uZXcgUmQoeGQsd2QsMjU3LHlkLGJkKSxCZD1uZXcgUmQoQWQsU2QsMCx2ZCxiZCksTGQ9bmV3IFJkKG5ldyBBcnJheSgwKSxrZCwwLDE5LDcpfSgpLFhkPSEwKSx0LmxfZGVzYz1uZXcgemQodC5keW5fbHRyZWUsVGQpLHQuZF9kZXNjPW5ldyB6ZCh0LmR5bl9kdHJlZSxCZCksdC5ibF9kZXNjPW5ldyB6ZCh0LmJsX3RyZWUsTGQpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wLEhkKHQpfSxwZC5fdHJfc3RvcmVkX2Jsb2NrPVlkLHBkLl90cl9mbHVzaF9ibG9jaz1mdW5jdGlvbih0LGUscixuKXt2YXIgaSxvLHM9MDt0LmxldmVsPjA/KDI9PT10LnN0cm0uZGF0YV90eXBlJiYodC5zdHJtLmRhdGFfdHlwZT1mdW5jdGlvbih0KXt2YXIgZSxyPTQwOTM2MjQ0NDc7Zm9yKGU9MDtlPD0zMTtlKysscj4+Pj0xKWlmKDEmciYmMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIDA7aWYoMCE9PXQuZHluX2x0cmVlWzE4XXx8MCE9PXQuZHluX2x0cmVlWzIwXXx8MCE9PXQuZHluX2x0cmVlWzI2XSlyZXR1cm4gMTtmb3IoZT0zMjtlPG1kO2UrKylpZigwIT09dC5keW5fbHRyZWVbMiplXSlyZXR1cm4gMTtyZXR1cm4gMH0odCkpLEdkKHQsdC5sX2Rlc2MpLEdkKHQsdC5kX2Rlc2MpLHM9ZnVuY3Rpb24odCl7dmFyIGU7Zm9yKFZkKHQsdC5keW5fbHRyZWUsdC5sX2Rlc2MubWF4X2NvZGUpLFZkKHQsdC5keW5fZHRyZWUsdC5kX2Rlc2MubWF4X2NvZGUpLEdkKHQsdC5ibF9kZXNjKSxlPTE4O2U+PTMmJjA9PT10LmJsX3RyZWVbMipPZFtlXSsxXTtlLS0pO3JldHVybiB0Lm9wdF9sZW4rPTMqKGUrMSkrNSs1KzQsZX0odCksaT10Lm9wdF9sZW4rMys3Pj4+Mywobz10LnN0YXRpY19sZW4rMys3Pj4+Myk8PWkmJihpPW8pKTppPW89cis1LHIrNDw9aSYmLTEhPT1lP1lkKHQsZSxyLG4pOjQ9PT10LnN0cmF0ZWd5fHxvPT09aT8oTWQodCwyKyhuPzE6MCksMyksWmQodCx4ZCxBZCkpOihNZCh0LDQrKG4/MTowKSwzKSxmdW5jdGlvbih0LGUscixuKXt2YXIgaTtmb3IoTWQodCxlLTI1Nyw1KSxNZCh0LHItMSw1KSxNZCh0LG4tNCw0KSxpPTA7aTxuO2krKylNZCh0LHQuYmxfdHJlZVsyKk9kW2ldKzFdLDMpOyRkKHQsdC5keW5fbHRyZWUsZS0xKSwkZCh0LHQuZHluX2R0cmVlLHItMSl9KHQsdC5sX2Rlc2MubWF4X2NvZGUrMSx0LmRfZGVzYy5tYXhfY29kZSsxLHMrMSksWmQodCx0LmR5bl9sdHJlZSx0LmR5bl9kdHJlZSkpLEhkKHQpLG4mJktkKHQpfSxwZC5fdHJfdGFsbHk9ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0LnBlbmRpbmdfYnVmW3QuZF9idWYrMip0Lmxhc3RfbGl0XT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqdC5sYXN0X2xpdCsxXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QubF9idWYrdC5sYXN0X2xpdF09MjU1JnIsdC5sYXN0X2xpdCsrLDA9PT1lP3QuZHluX2x0cmVlWzIqcl0rKzoodC5tYXRjaGVzKyssZS0tLHQuZHluX2x0cmVlWzIqKENkW3JdK21kKzEpXSsrLHQuZHluX2R0cmVlWzIqRGQoZSldKyspLHQubGFzdF9saXQ9PT10LmxpdF9idWZzaXplLTF9LHBkLl90cl9hbGlnbj1mdW5jdGlvbih0KXtNZCh0LDIsMyksVWQodCwyNTYseGQpLGZ1bmN0aW9uKHQpezE2PT09dC5iaV92YWxpZD8oUGQodCx0LmJpX2J1ZiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTApOnQuYmlfdmFsaWQ+PTgmJih0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmdC5iaV9idWYsdC5iaV9idWY+Pj04LHQuYmlfdmFsaWQtPTgpfSh0KX07dmFyIHFkPWZ1bmN0aW9uKHQsZSxyLG4pe2Zvcih2YXIgaT02NTUzNSZ0LG89dD4+PjE2JjY1NTM1LHM9MDswIT09cjspe3ItPXM9cj4yZTM/MmUzOnI7ZG97bz1vKyhpPWkrZVtuKytdfDApfDB9d2hpbGUoLS1zKTtpJT02NTUyMSxvJT02NTUyMX1yZXR1cm4gaXxvPDwxNn07dmFyIFFkPWZ1bmN0aW9uKCl7Zm9yKHZhciB0LGU9W10scj0wO3I8MjU2O3IrKyl7dD1yO2Zvcih2YXIgbj0wO248ODtuKyspdD0xJnQ/Mzk4ODI5MjM4NF50Pj4+MTp0Pj4+MTtlW3JdPXR9cmV0dXJuIGV9KCk7dmFyIHRmLGVmPWZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPVFkLG89bityO3RePS0xO2Zvcih2YXIgcz1uO3M8bztzKyspdD10Pj4+OF5pWzI1NSYodF5lW3NdKV07cmV0dXJufnR9LHJmPXsyOiJuZWVkIGRpY3Rpb25hcnkiLDE6InN0cmVhbSBlbmQiLDA6IiIsIi0xIjoiZmlsZSBlcnJvciIsIi0yIjoic3RyZWFtIGVycm9yIiwiLTMiOiJkYXRhIGVycm9yIiwiLTQiOiJpbnN1ZmZpY2llbnQgbWVtb3J5IiwiLTUiOiJidWZmZXIgZXJyb3IiLCItNiI6ImluY29tcGF0aWJsZSB2ZXJzaW9uIn0sbmY9aGQsb2Y9cGQsc2Y9cWQsYWY9ZWYsY2Y9cmYsdWY9LTIsbGY9MjU4LGhmPTI2MixkZj0xMDMsZmY9MTEzLHBmPTY2NjtmdW5jdGlvbiBfZih0LGUpe3JldHVybiB0Lm1zZz1jZltlXSxlfWZ1bmN0aW9uIGdmKHQpe3JldHVybih0PDwxKS0odD40Pzk6MCl9ZnVuY3Rpb24gbWYodCl7Zm9yKHZhciBlPXQubGVuZ3RoOy0tZT49MDspdFtlXT0wfWZ1bmN0aW9uIHlmKHQpe3ZhciBlPXQuc3RhdGUscj1lLnBlbmRpbmc7cj50LmF2YWlsX291dCYmKHI9dC5hdmFpbF9vdXQpLDAhPT1yJiYobmYuYXJyYXlTZXQodC5vdXRwdXQsZS5wZW5kaW5nX2J1ZixlLnBlbmRpbmdfb3V0LHIsdC5uZXh0X291dCksdC5uZXh0X291dCs9cixlLnBlbmRpbmdfb3V0Kz1yLHQudG90YWxfb3V0Kz1yLHQuYXZhaWxfb3V0LT1yLGUucGVuZGluZy09ciwwPT09ZS5wZW5kaW5nJiYoZS5wZW5kaW5nX291dD0wKSl9ZnVuY3Rpb24gdmYodCxlKXtvZi5fdHJfZmx1c2hfYmxvY2sodCx0LmJsb2NrX3N0YXJ0Pj0wP3QuYmxvY2tfc3RhcnQ6LTEsdC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LGUpLHQuYmxvY2tfc3RhcnQ9dC5zdHJzdGFydCx5Zih0LnN0cm0pfWZ1bmN0aW9uIGJmKHQsZSl7dC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109ZX1mdW5jdGlvbiB3Zih0LGUpe3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZX1mdW5jdGlvbiBTZih0LGUpe3ZhciByLG4saT10Lm1heF9jaGFpbl9sZW5ndGgsbz10LnN0cnN0YXJ0LHM9dC5wcmV2X2xlbmd0aCxhPXQubmljZV9tYXRjaCxjPXQuc3Ryc3RhcnQ+dC53X3NpemUtaGY/dC5zdHJzdGFydC0odC53X3NpemUtaGYpOjAsdT10LndpbmRvdyxsPXQud19tYXNrLGg9dC5wcmV2LGQ9dC5zdHJzdGFydCtsZixmPXVbbytzLTFdLHA9dVtvK3NdO3QucHJldl9sZW5ndGg+PXQuZ29vZF9tYXRjaCYmKGk+Pj0yKSxhPnQubG9va2FoZWFkJiYoYT10Lmxvb2thaGVhZCk7ZG97aWYodVsocj1lKStzXT09PXAmJnVbcitzLTFdPT09ZiYmdVtyXT09PXVbb10mJnVbKytyXT09PXVbbysxXSl7bys9MixyKys7ZG97fXdoaWxlKHVbKytvXT09PXVbKytyXSYmdVsrK29dPT09dVsrK3JdJiZ1Wysrb109PT11Wysrcl0mJnVbKytvXT09PXVbKytyXSYmdVsrK29dPT09dVsrK3JdJiZ1Wysrb109PT11Wysrcl0mJnVbKytvXT09PXVbKytyXSYmdVsrK29dPT09dVsrK3JdJiZvPGQpO2lmKG49bGYtKGQtbyksbz1kLWxmLG4+cyl7aWYodC5tYXRjaF9zdGFydD1lLHM9bixuPj1hKWJyZWFrO2Y9dVtvK3MtMV0scD11W28rc119fX13aGlsZSgoZT1oW2UmbF0pPmMmJjAhPS0taSk7cmV0dXJuIHM8PXQubG9va2FoZWFkP3M6dC5sb29rYWhlYWR9ZnVuY3Rpb24ga2YodCl7dmFyIGUscixuLGksbyxzLGEsYyx1LGwsaD10Lndfc2l6ZTtkb3tpZihpPXQud2luZG93X3NpemUtdC5sb29rYWhlYWQtdC5zdHJzdGFydCx0LnN0cnN0YXJ0Pj1oKyhoLWhmKSl7bmYuYXJyYXlTZXQodC53aW5kb3csdC53aW5kb3csaCxoLDApLHQubWF0Y2hfc3RhcnQtPWgsdC5zdHJzdGFydC09aCx0LmJsb2NrX3N0YXJ0LT1oLGU9cj10Lmhhc2hfc2l6ZTtkb3tuPXQuaGVhZFstLWVdLHQuaGVhZFtlXT1uPj1oP24taDowfXdoaWxlKC0tcik7ZT1yPWg7ZG97bj10LnByZXZbLS1lXSx0LnByZXZbZV09bj49aD9uLWg6MH13aGlsZSgtLXIpO2krPWh9aWYoMD09PXQuc3RybS5hdmFpbF9pbilicmVhaztpZihzPXQuc3RybSxhPXQud2luZG93LGM9dC5zdHJzdGFydCt0Lmxvb2thaGVhZCx1PWksbD12b2lkIDAsKGw9cy5hdmFpbF9pbik+dSYmKGw9dSkscj0wPT09bD8wOihzLmF2YWlsX2luLT1sLG5mLmFycmF5U2V0KGEscy5pbnB1dCxzLm5leHRfaW4sbCxjKSwxPT09cy5zdGF0ZS53cmFwP3MuYWRsZXI9c2Yocy5hZGxlcixhLGwsYyk6Mj09PXMuc3RhdGUud3JhcCYmKHMuYWRsZXI9YWYocy5hZGxlcixhLGwsYykpLHMubmV4dF9pbis9bCxzLnRvdGFsX2luKz1sLGwpLHQubG9va2FoZWFkKz1yLHQubG9va2FoZWFkK3QuaW5zZXJ0Pj0zKWZvcihvPXQuc3Ryc3RhcnQtdC5pbnNlcnQsdC5pbnNfaD10LndpbmRvd1tvXSx0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbbysxXSkmdC5oYXNoX21hc2s7dC5pbnNlcnQmJih0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbbyszLTFdKSZ0Lmhhc2hfbWFzayx0LnByZXZbbyZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT1vLG8rKyx0Lmluc2VydC0tLCEodC5sb29rYWhlYWQrdC5pbnNlcnQ8MykpOyk7fXdoaWxlKHQubG9va2FoZWFkPGhmJiYwIT09dC5zdHJtLmF2YWlsX2luKX1mdW5jdGlvbiBPZih0LGUpe2Zvcih2YXIgcixuOzspe2lmKHQubG9va2FoZWFkPGhmKXtpZihrZih0KSx0Lmxvb2thaGVhZDxoZiYmMD09PWUpcmV0dXJuIDE7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHI9MCx0Lmxvb2thaGVhZD49MyYmKHQuaW5zX2g9KHQuaW5zX2g8PHQuaGFzaF9zaGlmdF50LndpbmRvd1t0LnN0cnN0YXJ0KzMtMV0pJnQuaGFzaF9tYXNrLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksMCE9PXImJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtaGYmJih0Lm1hdGNoX2xlbmd0aD1TZih0LHIpKSx0Lm1hdGNoX2xlbmd0aD49MylpZihuPW9mLl90cl90YWxseSh0LHQuc3Ryc3RhcnQtdC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aC0zKSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg8PXQubWF4X2xhenlfbWF0Y2gmJnQubG9va2FoZWFkPj0zKXt0Lm1hdGNoX2xlbmd0aC0tO2Rve3Quc3Ryc3RhcnQrKyx0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbdC5zdHJzdGFydCszLTFdKSZ0Lmhhc2hfbWFzayxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnR9d2hpbGUoMCE9LS10Lm1hdGNoX2xlbmd0aCk7dC5zdHJzdGFydCsrfWVsc2UgdC5zdHJzdGFydCs9dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg9MCx0Lmluc19oPXQud2luZG93W3Quc3Ryc3RhcnRdLHQuaW5zX2g9KHQuaW5zX2g8PHQuaGFzaF9zaGlmdF50LndpbmRvd1t0LnN0cnN0YXJ0KzFdKSZ0Lmhhc2hfbWFzaztlbHNlIG49b2YuX3RyX3RhbGx5KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0Kys7aWYobiYmKHZmKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gMX1yZXR1cm4gdC5pbnNlcnQ9dC5zdHJzdGFydDwyP3Quc3Ryc3RhcnQ6Miw0PT09ZT8odmYodCwhMCksMD09PXQuc3RybS5hdmFpbF9vdXQ/Mzo0KTp0Lmxhc3RfbGl0JiYodmYodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpPzE6Mn1mdW5jdGlvbiB4Zih0LGUpe2Zvcih2YXIgcixuLGk7Oyl7aWYodC5sb29rYWhlYWQ8aGYpe2lmKGtmKHQpLHQubG9va2FoZWFkPGhmJiYwPT09ZSlyZXR1cm4gMTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj0zJiYodC5pbnNfaD0odC5pbnNfaDw8dC5oYXNoX3NoaWZ0XnQud2luZG93W3Quc3Ryc3RhcnQrMy0xXSkmdC5oYXNoX21hc2sscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0KSx0LnByZXZfbGVuZ3RoPXQubWF0Y2hfbGVuZ3RoLHQucHJldl9tYXRjaD10Lm1hdGNoX3N0YXJ0LHQubWF0Y2hfbGVuZ3RoPTIsMCE9PXImJnQucHJldl9sZW5ndGg8dC5tYXhfbGF6eV9tYXRjaCYmdC5zdHJzdGFydC1yPD10Lndfc2l6ZS1oZiYmKHQubWF0Y2hfbGVuZ3RoPVNmKHQsciksdC5tYXRjaF9sZW5ndGg8PTUmJigxPT09dC5zdHJhdGVneXx8Mz09PXQubWF0Y2hfbGVuZ3RoJiZ0LnN0cnN0YXJ0LXQubWF0Y2hfc3RhcnQ+NDA5NikmJih0Lm1hdGNoX2xlbmd0aD0yKSksdC5wcmV2X2xlbmd0aD49MyYmdC5tYXRjaF9sZW5ndGg8PXQucHJldl9sZW5ndGgpe2k9dC5zdHJzdGFydCt0Lmxvb2thaGVhZC0zLG49b2YuX3RyX3RhbGx5KHQsdC5zdHJzdGFydC0xLXQucHJldl9tYXRjaCx0LnByZXZfbGVuZ3RoLTMpLHQubG9va2FoZWFkLT10LnByZXZfbGVuZ3RoLTEsdC5wcmV2X2xlbmd0aC09Mjtkb3srK3Quc3Ryc3RhcnQ8PWkmJih0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbdC5zdHJzdGFydCszLTFdKSZ0Lmhhc2hfbWFzayxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpfXdoaWxlKDAhPS0tdC5wcmV2X2xlbmd0aCk7aWYodC5tYXRjaF9hdmFpbGFibGU9MCx0Lm1hdGNoX2xlbmd0aD0yLHQuc3Ryc3RhcnQrKyxuJiYodmYodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxfWVsc2UgaWYodC5tYXRjaF9hdmFpbGFibGUpe2lmKChuPW9mLl90cl90YWxseSh0LDAsdC53aW5kb3dbdC5zdHJzdGFydC0xXSkpJiZ2Zih0LCExKSx0LnN0cnN0YXJ0KyssdC5sb29rYWhlYWQtLSwwPT09dC5zdHJtLmF2YWlsX291dClyZXR1cm4gMX1lbHNlIHQubWF0Y2hfYXZhaWxhYmxlPTEsdC5zdHJzdGFydCsrLHQubG9va2FoZWFkLS19cmV0dXJuIHQubWF0Y2hfYXZhaWxhYmxlJiYobj1vZi5fdHJfdGFsbHkodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLHQubWF0Y2hfYXZhaWxhYmxlPTApLHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8Mj90LnN0cnN0YXJ0OjIsND09PWU/KHZmKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0PzM6NCk6dC5sYXN0X2xpdCYmKHZmKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT8xOjJ9ZnVuY3Rpb24gQWYodCxlLHIsbixpKXt0aGlzLmdvb2RfbGVuZ3RoPXQsdGhpcy5tYXhfbGF6eT1lLHRoaXMubmljZV9sZW5ndGg9cix0aGlzLm1heF9jaGFpbj1uLHRoaXMuZnVuYz1pfWZ1bmN0aW9uIEVmKCl7dGhpcy5zdHJtPW51bGwsdGhpcy5zdGF0dXM9MCx0aGlzLnBlbmRpbmdfYnVmPW51bGwsdGhpcy5wZW5kaW5nX2J1Zl9zaXplPTAsdGhpcy5wZW5kaW5nX291dD0wLHRoaXMucGVuZGluZz0wLHRoaXMud3JhcD0wLHRoaXMuZ3poZWFkPW51bGwsdGhpcy5nemluZGV4PTAsdGhpcy5tZXRob2Q9OCx0aGlzLmxhc3RfZmx1c2g9LTEsdGhpcy53X3NpemU9MCx0aGlzLndfYml0cz0wLHRoaXMud19tYXNrPTAsdGhpcy53aW5kb3c9bnVsbCx0aGlzLndpbmRvd19zaXplPTAsdGhpcy5wcmV2PW51bGwsdGhpcy5oZWFkPW51bGwsdGhpcy5pbnNfaD0wLHRoaXMuaGFzaF9zaXplPTAsdGhpcy5oYXNoX2JpdHM9MCx0aGlzLmhhc2hfbWFzaz0wLHRoaXMuaGFzaF9zaGlmdD0wLHRoaXMuYmxvY2tfc3RhcnQ9MCx0aGlzLm1hdGNoX2xlbmd0aD0wLHRoaXMucHJldl9tYXRjaD0wLHRoaXMubWF0Y2hfYXZhaWxhYmxlPTAsdGhpcy5zdHJzdGFydD0wLHRoaXMubWF0Y2hfc3RhcnQ9MCx0aGlzLmxvb2thaGVhZD0wLHRoaXMucHJldl9sZW5ndGg9MCx0aGlzLm1heF9jaGFpbl9sZW5ndGg9MCx0aGlzLm1heF9sYXp5X21hdGNoPTAsdGhpcy5sZXZlbD0wLHRoaXMuc3RyYXRlZ3k9MCx0aGlzLmdvb2RfbWF0Y2g9MCx0aGlzLm5pY2VfbWF0Y2g9MCx0aGlzLmR5bl9sdHJlZT1uZXcgbmYuQnVmMTYoMTE0NiksdGhpcy5keW5fZHRyZWU9bmV3IG5mLkJ1ZjE2KDEyMiksdGhpcy5ibF90cmVlPW5ldyBuZi5CdWYxNig3OCksbWYodGhpcy5keW5fbHRyZWUpLG1mKHRoaXMuZHluX2R0cmVlKSxtZih0aGlzLmJsX3RyZWUpLHRoaXMubF9kZXNjPW51bGwsdGhpcy5kX2Rlc2M9bnVsbCx0aGlzLmJsX2Rlc2M9bnVsbCx0aGlzLmJsX2NvdW50PW5ldyBuZi5CdWYxNigxNiksdGhpcy5oZWFwPW5ldyBuZi5CdWYxNig1NzMpLG1mKHRoaXMuaGVhcCksdGhpcy5oZWFwX2xlbj0wLHRoaXMuaGVhcF9tYXg9MCx0aGlzLmRlcHRoPW5ldyBuZi5CdWYxNig1NzMpLG1mKHRoaXMuZGVwdGgpLHRoaXMubF9idWY9MCx0aGlzLmxpdF9idWZzaXplPTAsdGhpcy5sYXN0X2xpdD0wLHRoaXMuZF9idWY9MCx0aGlzLm9wdF9sZW49MCx0aGlzLnN0YXRpY19sZW49MCx0aGlzLm1hdGNoZXM9MCx0aGlzLmluc2VydD0wLHRoaXMuYmlfYnVmPTAsdGhpcy5iaV92YWxpZD0wfWZ1bmN0aW9uIENmKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPyh0LnRvdGFsX2luPXQudG90YWxfb3V0PTAsdC5kYXRhX3R5cGU9MiwoZT10LnN0YXRlKS5wZW5kaW5nPTAsZS5wZW5kaW5nX291dD0wLGUud3JhcDwwJiYoZS53cmFwPS1lLndyYXApLGUuc3RhdHVzPWUud3JhcD80MjpmZix0LmFkbGVyPTI9PT1lLndyYXA/MDoxLGUubGFzdF9mbHVzaD0wLG9mLl90cl9pbml0KGUpLDApOl9mKHQsdWYpfWZ1bmN0aW9uIElmKHQpe3ZhciBlLHI9Q2YodCk7cmV0dXJuIDA9PT1yJiYoKGU9dC5zdGF0ZSkud2luZG93X3NpemU9MiplLndfc2l6ZSxtZihlLmhlYWQpLGUubWF4X2xhenlfbWF0Y2g9dGZbZS5sZXZlbF0ubWF4X2xhenksZS5nb29kX21hdGNoPXRmW2UubGV2ZWxdLmdvb2RfbGVuZ3RoLGUubmljZV9tYXRjaD10ZltlLmxldmVsXS5uaWNlX2xlbmd0aCxlLm1heF9jaGFpbl9sZW5ndGg9dGZbZS5sZXZlbF0ubWF4X2NoYWluLGUuc3Ryc3RhcnQ9MCxlLmJsb2NrX3N0YXJ0PTAsZS5sb29rYWhlYWQ9MCxlLmluc2VydD0wLGUubWF0Y2hfbGVuZ3RoPWUucHJldl9sZW5ndGg9MixlLm1hdGNoX2F2YWlsYWJsZT0wLGUuaW5zX2g9MCkscn1mdW5jdGlvbiBUZih0LGUscixuLGksbyl7aWYoIXQpcmV0dXJuIHVmO3ZhciBzPTE7aWYoLTE9PT1lJiYoZT02KSxuPDA/KHM9MCxuPS1uKTpuPjE1JiYocz0yLG4tPTE2KSxpPDF8fGk+OXx8OCE9PXJ8fG48OHx8bj4xNXx8ZTwwfHxlPjl8fG88MHx8bz40KXJldHVybiBfZih0LHVmKTs4PT09biYmKG49OSk7dmFyIGE9bmV3IEVmO3JldHVybiB0LnN0YXRlPWEsYS5zdHJtPXQsYS53cmFwPXMsYS5nemhlYWQ9bnVsbCxhLndfYml0cz1uLGEud19zaXplPTE8PGEud19iaXRzLGEud19tYXNrPWEud19zaXplLTEsYS5oYXNoX2JpdHM9aSs3LGEuaGFzaF9zaXplPTE8PGEuaGFzaF9iaXRzLGEuaGFzaF9tYXNrPWEuaGFzaF9zaXplLTEsYS5oYXNoX3NoaWZ0PX5+KChhLmhhc2hfYml0cyszLTEpLzMpLGEud2luZG93PW5ldyBuZi5CdWY4KDIqYS53X3NpemUpLGEuaGVhZD1uZXcgbmYuQnVmMTYoYS5oYXNoX3NpemUpLGEucHJldj1uZXcgbmYuQnVmMTYoYS53X3NpemUpLGEubGl0X2J1ZnNpemU9MTw8aSs2LGEucGVuZGluZ19idWZfc2l6ZT00KmEubGl0X2J1ZnNpemUsYS5wZW5kaW5nX2J1Zj1uZXcgbmYuQnVmOChhLnBlbmRpbmdfYnVmX3NpemUpLGEuZF9idWY9MSphLmxpdF9idWZzaXplLGEubF9idWY9MyphLmxpdF9idWZzaXplLGEubGV2ZWw9ZSxhLnN0cmF0ZWd5PW8sYS5tZXRob2Q9cixJZih0KX10Zj1bbmV3IEFmKDAsMCwwLDAsKGZ1bmN0aW9uKHQsZSl7dmFyIHI9NjU1MzU7Zm9yKHI+dC5wZW5kaW5nX2J1Zl9zaXplLTUmJihyPXQucGVuZGluZ19idWZfc2l6ZS01KTs7KXtpZih0Lmxvb2thaGVhZDw9MSl7aWYoa2YodCksMD09PXQubG9va2FoZWFkJiYwPT09ZSlyZXR1cm4gMTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9dC5zdHJzdGFydCs9dC5sb29rYWhlYWQsdC5sb29rYWhlYWQ9MDt2YXIgbj10LmJsb2NrX3N0YXJ0K3I7aWYoKDA9PT10LnN0cnN0YXJ0fHx0LnN0cnN0YXJ0Pj1uKSYmKHQubG9va2FoZWFkPXQuc3Ryc3RhcnQtbix0LnN0cnN0YXJ0PW4sdmYodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxO2lmKHQuc3Ryc3RhcnQtdC5ibG9ja19zdGFydD49dC53X3NpemUtaGYmJih2Zih0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIDF9cmV0dXJuIHQuaW5zZXJ0PTAsND09PWU/KHZmKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0PzM6NCk6KHQuc3Ryc3RhcnQ+dC5ibG9ja19zdGFydCYmKHZmKHQsITEpLHQuc3RybS5hdmFpbF9vdXQpLDEpfSkpLG5ldyBBZig0LDQsOCw0LE9mKSxuZXcgQWYoNCw1LDE2LDgsT2YpLG5ldyBBZig0LDYsMzIsMzIsT2YpLG5ldyBBZig0LDQsMTYsMTYseGYpLG5ldyBBZig4LDE2LDMyLDMyLHhmKSxuZXcgQWYoOCwxNiwxMjgsMTI4LHhmKSxuZXcgQWYoOCwzMiwxMjgsMjU2LHhmKSxuZXcgQWYoMzIsMTI4LDI1OCwxMDI0LHhmKSxuZXcgQWYoMzIsMjU4LDI1OCw0MDk2LHhmKV0sZmQuZGVmbGF0ZUluaXQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gVGYodCxlLDgsMTUsOCwwKX0sZmQuZGVmbGF0ZUluaXQyPVRmLGZkLmRlZmxhdGVSZXNldD1JZixmZC5kZWZsYXRlUmVzZXRLZWVwPUNmLGZkLmRlZmxhdGVTZXRIZWFkZXI9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCYmdC5zdGF0ZT8yIT09dC5zdGF0ZS53cmFwP3VmOih0LnN0YXRlLmd6aGVhZD1lLDApOnVmfSxmZC5kZWZsYXRlPWZ1bmN0aW9uKHQsZSl7dmFyIHIsbixpLG87aWYoIXR8fCF0LnN0YXRlfHxlPjV8fGU8MClyZXR1cm4gdD9fZih0LHVmKTp1ZjtpZihuPXQuc3RhdGUsIXQub3V0cHV0fHwhdC5pbnB1dCYmMCE9PXQuYXZhaWxfaW58fG4uc3RhdHVzPT09cGYmJjQhPT1lKXJldHVybiBfZih0LDA9PT10LmF2YWlsX291dD8tNTp1Zik7aWYobi5zdHJtPXQscj1uLmxhc3RfZmx1c2gsbi5sYXN0X2ZsdXNoPWUsNDI9PT1uLnN0YXR1cylpZigyPT09bi53cmFwKXQuYWRsZXI9MCxiZihuLDMxKSxiZihuLDEzOSksYmYobiw4KSxuLmd6aGVhZD8oYmYobiwobi5nemhlYWQudGV4dD8xOjApKyhuLmd6aGVhZC5oY3JjPzI6MCkrKG4uZ3poZWFkLmV4dHJhPzQ6MCkrKG4uZ3poZWFkLm5hbWU/ODowKSsobi5nemhlYWQuY29tbWVudD8xNjowKSksYmYobiwyNTUmbi5nemhlYWQudGltZSksYmYobixuLmd6aGVhZC50aW1lPj44JjI1NSksYmYobixuLmd6aGVhZC50aW1lPj4xNiYyNTUpLGJmKG4sbi5nemhlYWQudGltZT4+MjQmMjU1KSxiZihuLDk9PT1uLmxldmVsPzI6bi5zdHJhdGVneT49Mnx8bi5sZXZlbDwyPzQ6MCksYmYobiwyNTUmbi5nemhlYWQub3MpLG4uZ3poZWFkLmV4dHJhJiZuLmd6aGVhZC5leHRyYS5sZW5ndGgmJihiZihuLDI1NSZuLmd6aGVhZC5leHRyYS5sZW5ndGgpLGJmKG4sbi5nemhlYWQuZXh0cmEubGVuZ3RoPj44JjI1NSkpLG4uZ3poZWFkLmhjcmMmJih0LmFkbGVyPWFmKHQuYWRsZXIsbi5wZW5kaW5nX2J1ZixuLnBlbmRpbmcsMCkpLG4uZ3ppbmRleD0wLG4uc3RhdHVzPTY5KTooYmYobiwwKSxiZihuLDApLGJmKG4sMCksYmYobiwwKSxiZihuLDApLGJmKG4sOT09PW4ubGV2ZWw/MjpuLnN0cmF0ZWd5Pj0yfHxuLmxldmVsPDI/NDowKSxiZihuLDMpLG4uc3RhdHVzPWZmKTtlbHNle3ZhciBzPTgrKG4ud19iaXRzLTg8PDQpPDw4O3N8PShuLnN0cmF0ZWd5Pj0yfHxuLmxldmVsPDI/MDpuLmxldmVsPDY/MTo2PT09bi5sZXZlbD8yOjMpPDw2LDAhPT1uLnN0cnN0YXJ0JiYoc3w9MzIpLHMrPTMxLXMlMzEsbi5zdGF0dXM9ZmYsd2YobixzKSwwIT09bi5zdHJzdGFydCYmKHdmKG4sdC5hZGxlcj4+PjE2KSx3ZihuLDY1NTM1JnQuYWRsZXIpKSx0LmFkbGVyPTF9aWYoNjk9PT1uLnN0YXR1cylpZihuLmd6aGVhZC5leHRyYSl7Zm9yKGk9bi5wZW5kaW5nO24uZ3ppbmRleDwoNjU1MzUmbi5nemhlYWQuZXh0cmEubGVuZ3RoKSYmKG4ucGVuZGluZyE9PW4ucGVuZGluZ19idWZfc2l6ZXx8KG4uZ3poZWFkLmhjcmMmJm4ucGVuZGluZz5pJiYodC5hZGxlcj1hZih0LmFkbGVyLG4ucGVuZGluZ19idWYsbi5wZW5kaW5nLWksaSkpLHlmKHQpLGk9bi5wZW5kaW5nLG4ucGVuZGluZyE9PW4ucGVuZGluZ19idWZfc2l6ZSkpOyliZihuLDI1NSZuLmd6aGVhZC5leHRyYVtuLmd6aW5kZXhdKSxuLmd6aW5kZXgrKztuLmd6aGVhZC5oY3JjJiZuLnBlbmRpbmc+aSYmKHQuYWRsZXI9YWYodC5hZGxlcixuLnBlbmRpbmdfYnVmLG4ucGVuZGluZy1pLGkpKSxuLmd6aW5kZXg9PT1uLmd6aGVhZC5leHRyYS5sZW5ndGgmJihuLmd6aW5kZXg9MCxuLnN0YXR1cz03Myl9ZWxzZSBuLnN0YXR1cz03MztpZig3Mz09PW4uc3RhdHVzKWlmKG4uZ3poZWFkLm5hbWUpe2k9bi5wZW5kaW5nO2Rve2lmKG4ucGVuZGluZz09PW4ucGVuZGluZ19idWZfc2l6ZSYmKG4uZ3poZWFkLmhjcmMmJm4ucGVuZGluZz5pJiYodC5hZGxlcj1hZih0LmFkbGVyLG4ucGVuZGluZ19idWYsbi5wZW5kaW5nLWksaSkpLHlmKHQpLGk9bi5wZW5kaW5nLG4ucGVuZGluZz09PW4ucGVuZGluZ19idWZfc2l6ZSkpe289MTticmVha31vPW4uZ3ppbmRleDxuLmd6aGVhZC5uYW1lLmxlbmd0aD8yNTUmbi5nemhlYWQubmFtZS5jaGFyQ29kZUF0KG4uZ3ppbmRleCsrKTowLGJmKG4sbyl9d2hpbGUoMCE9PW8pO24uZ3poZWFkLmhjcmMmJm4ucGVuZGluZz5pJiYodC5hZGxlcj1hZih0LmFkbGVyLG4ucGVuZGluZ19idWYsbi5wZW5kaW5nLWksaSkpLDA9PT1vJiYobi5nemluZGV4PTAsbi5zdGF0dXM9OTEpfWVsc2Ugbi5zdGF0dXM9OTE7aWYoOTE9PT1uLnN0YXR1cylpZihuLmd6aGVhZC5jb21tZW50KXtpPW4ucGVuZGluZztkb3tpZihuLnBlbmRpbmc9PT1uLnBlbmRpbmdfYnVmX3NpemUmJihuLmd6aGVhZC5oY3JjJiZuLnBlbmRpbmc+aSYmKHQuYWRsZXI9YWYodC5hZGxlcixuLnBlbmRpbmdfYnVmLG4ucGVuZGluZy1pLGkpKSx5Zih0KSxpPW4ucGVuZGluZyxuLnBlbmRpbmc9PT1uLnBlbmRpbmdfYnVmX3NpemUpKXtvPTE7YnJlYWt9bz1uLmd6aW5kZXg8bi5nemhlYWQuY29tbWVudC5sZW5ndGg/MjU1Jm4uZ3poZWFkLmNvbW1lbnQuY2hhckNvZGVBdChuLmd6aW5kZXgrKyk6MCxiZihuLG8pfXdoaWxlKDAhPT1vKTtuLmd6aGVhZC5oY3JjJiZuLnBlbmRpbmc+aSYmKHQuYWRsZXI9YWYodC5hZGxlcixuLnBlbmRpbmdfYnVmLG4ucGVuZGluZy1pLGkpKSwwPT09byYmKG4uc3RhdHVzPWRmKX1lbHNlIG4uc3RhdHVzPWRmO2lmKG4uc3RhdHVzPT09ZGYmJihuLmd6aGVhZC5oY3JjPyhuLnBlbmRpbmcrMj5uLnBlbmRpbmdfYnVmX3NpemUmJnlmKHQpLG4ucGVuZGluZysyPD1uLnBlbmRpbmdfYnVmX3NpemUmJihiZihuLDI1NSZ0LmFkbGVyKSxiZihuLHQuYWRsZXI+PjgmMjU1KSx0LmFkbGVyPTAsbi5zdGF0dXM9ZmYpKTpuLnN0YXR1cz1mZiksMCE9PW4ucGVuZGluZyl7aWYoeWYodCksMD09PXQuYXZhaWxfb3V0KXJldHVybiBuLmxhc3RfZmx1c2g9LTEsMH1lbHNlIGlmKDA9PT10LmF2YWlsX2luJiZnZihlKTw9Z2YocikmJjQhPT1lKXJldHVybiBfZih0LC01KTtpZihuLnN0YXR1cz09PXBmJiYwIT09dC5hdmFpbF9pbilyZXR1cm4gX2YodCwtNSk7aWYoMCE9PXQuYXZhaWxfaW58fDAhPT1uLmxvb2thaGVhZHx8MCE9PWUmJm4uc3RhdHVzIT09cGYpe3ZhciBhPTI9PT1uLnN0cmF0ZWd5P2Z1bmN0aW9uKHQsZSl7Zm9yKHZhciByOzspe2lmKDA9PT10Lmxvb2thaGVhZCYmKGtmKHQpLDA9PT10Lmxvb2thaGVhZCkpe2lmKDA9PT1lKXJldHVybiAxO2JyZWFrfWlmKHQubWF0Y2hfbGVuZ3RoPTAscj1vZi5fdHJfdGFsbHkodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyxyJiYodmYodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxfXJldHVybiB0Lmluc2VydD0wLDQ9PT1lPyh2Zih0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD8zOjQpOnQubGFzdF9saXQmJih2Zih0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCk/MToyfShuLGUpOjM9PT1uLnN0cmF0ZWd5P2Z1bmN0aW9uKHQsZSl7Zm9yKHZhciByLG4saSxvLHM9dC53aW5kb3c7Oyl7aWYodC5sb29rYWhlYWQ8PWxmKXtpZihrZih0KSx0Lmxvb2thaGVhZDw9bGYmJjA9PT1lKXJldHVybiAxO2lmKDA9PT10Lmxvb2thaGVhZClicmVha31pZih0Lm1hdGNoX2xlbmd0aD0wLHQubG9va2FoZWFkPj0zJiZ0LnN0cnN0YXJ0PjAmJihuPXNbaT10LnN0cnN0YXJ0LTFdKT09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSl7bz10LnN0cnN0YXJ0K2xmO2Rve313aGlsZShuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZpPG8pO3QubWF0Y2hfbGVuZ3RoPWxmLShvLWkpLHQubWF0Y2hfbGVuZ3RoPnQubG9va2FoZWFkJiYodC5tYXRjaF9sZW5ndGg9dC5sb29rYWhlYWQpfWlmKHQubWF0Y2hfbGVuZ3RoPj0zPyhyPW9mLl90cl90YWxseSh0LDEsdC5tYXRjaF9sZW5ndGgtMyksdC5sb29rYWhlYWQtPXQubWF0Y2hfbGVuZ3RoLHQuc3Ryc3RhcnQrPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPTApOihyPW9mLl90cl90YWxseSh0LDAsdC53aW5kb3dbdC5zdHJzdGFydF0pLHQubG9va2FoZWFkLS0sdC5zdHJzdGFydCsrKSxyJiYodmYodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxfXJldHVybiB0Lmluc2VydD0wLDQ9PT1lPyh2Zih0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD8zOjQpOnQubGFzdF9saXQmJih2Zih0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCk/MToyfShuLGUpOnRmW24ubGV2ZWxdLmZ1bmMobixlKTtpZigzIT09YSYmNCE9PWF8fChuLnN0YXR1cz1wZiksMT09PWF8fDM9PT1hKXJldHVybiAwPT09dC5hdmFpbF9vdXQmJihuLmxhc3RfZmx1c2g9LTEpLDA7aWYoMj09PWEmJigxPT09ZT9vZi5fdHJfYWxpZ24obik6NSE9PWUmJihvZi5fdHJfc3RvcmVkX2Jsb2NrKG4sMCwwLCExKSwzPT09ZSYmKG1mKG4uaGVhZCksMD09PW4ubG9va2FoZWFkJiYobi5zdHJzdGFydD0wLG4uYmxvY2tfc3RhcnQ9MCxuLmluc2VydD0wKSkpLHlmKHQpLDA9PT10LmF2YWlsX291dCkpcmV0dXJuIG4ubGFzdF9mbHVzaD0tMSwwfXJldHVybiA0IT09ZT8wOm4ud3JhcDw9MD8xOigyPT09bi53cmFwPyhiZihuLDI1NSZ0LmFkbGVyKSxiZihuLHQuYWRsZXI+PjgmMjU1KSxiZihuLHQuYWRsZXI+PjE2JjI1NSksYmYobix0LmFkbGVyPj4yNCYyNTUpLGJmKG4sMjU1JnQudG90YWxfaW4pLGJmKG4sdC50b3RhbF9pbj4+OCYyNTUpLGJmKG4sdC50b3RhbF9pbj4+MTYmMjU1KSxiZihuLHQudG90YWxfaW4+PjI0JjI1NSkpOih3ZihuLHQuYWRsZXI+Pj4xNiksd2Yobiw2NTUzNSZ0LmFkbGVyKSkseWYodCksbi53cmFwPjAmJihuLndyYXA9LW4ud3JhcCksMCE9PW4ucGVuZGluZz8wOjEpfSxmZC5kZWZsYXRlRW5kPWZ1bmN0aW9uKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPzQyIT09KGU9dC5zdGF0ZS5zdGF0dXMpJiY2OSE9PWUmJjczIT09ZSYmOTEhPT1lJiZlIT09ZGYmJmUhPT1mZiYmZSE9PXBmP19mKHQsdWYpOih0LnN0YXRlPW51bGwsZT09PWZmP19mKHQsLTMpOjApOnVmfSxmZC5kZWZsYXRlU2V0RGljdGlvbmFyeT1mdW5jdGlvbih0LGUpe3ZhciByLG4saSxvLHMsYSxjLHUsbD1lLmxlbmd0aDtpZighdHx8IXQuc3RhdGUpcmV0dXJuIHVmO2lmKDI9PT0obz0ocj10LnN0YXRlKS53cmFwKXx8MT09PW8mJjQyIT09ci5zdGF0dXN8fHIubG9va2FoZWFkKXJldHVybiB1Zjtmb3IoMT09PW8mJih0LmFkbGVyPXNmKHQuYWRsZXIsZSxsLDApKSxyLndyYXA9MCxsPj1yLndfc2l6ZSYmKDA9PT1vJiYobWYoci5oZWFkKSxyLnN0cnN0YXJ0PTAsci5ibG9ja19zdGFydD0wLHIuaW5zZXJ0PTApLHU9bmV3IG5mLkJ1Zjgoci53X3NpemUpLG5mLmFycmF5U2V0KHUsZSxsLXIud19zaXplLHIud19zaXplLDApLGU9dSxsPXIud19zaXplKSxzPXQuYXZhaWxfaW4sYT10Lm5leHRfaW4sYz10LmlucHV0LHQuYXZhaWxfaW49bCx0Lm5leHRfaW49MCx0LmlucHV0PWUsa2Yocik7ci5sb29rYWhlYWQ+PTM7KXtuPXIuc3Ryc3RhcnQsaT1yLmxvb2thaGVhZC0yO2Rve3IuaW5zX2g9KHIuaW5zX2g8PHIuaGFzaF9zaGlmdF5yLndpbmRvd1tuKzMtMV0pJnIuaGFzaF9tYXNrLHIucHJldltuJnIud19tYXNrXT1yLmhlYWRbci5pbnNfaF0sci5oZWFkW3IuaW5zX2hdPW4sbisrfXdoaWxlKC0taSk7ci5zdHJzdGFydD1uLHIubG9va2FoZWFkPTIsa2Yocil9cmV0dXJuIHIuc3Ryc3RhcnQrPXIubG9va2FoZWFkLHIuYmxvY2tfc3RhcnQ9ci5zdHJzdGFydCxyLmluc2VydD1yLmxvb2thaGVhZCxyLmxvb2thaGVhZD0wLHIubWF0Y2hfbGVuZ3RoPXIucHJldl9sZW5ndGg9MixyLm1hdGNoX2F2YWlsYWJsZT0wLHQubmV4dF9pbj1hLHQuaW5wdXQ9Yyx0LmF2YWlsX2luPXMsci53cmFwPW8sMH0sZmQuZGVmbGF0ZUluZm89InBha28gZGVmbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkiO3ZhciBCZj17fSxMZj1oZCxOZj0hMCxSZj0hMDt0cnl7U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLFswXSl9Y2F0Y2gocWcpe05mPSExfXRyeXtTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbmV3IFVpbnQ4QXJyYXkoMSkpfWNhdGNoKHFnKXtSZj0hMX1mb3IodmFyIHpmPW5ldyBMZi5CdWY4KDI1NiksRGY9MDtEZjwyNTY7RGYrKyl6ZltEZl09RGY+PTI1Mj82OkRmPj0yNDg/NTpEZj49MjQwPzQ6RGY+PTIyND8zOkRmPj0xOTI/MjoxO2Z1bmN0aW9uIFBmKHQsZSl7aWYoZTw2NTUzNCYmKHQuc3ViYXJyYXkmJlJmfHwhdC5zdWJhcnJheSYmTmYpKXJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsTGYuc2hyaW5rQnVmKHQsZSkpO2Zvcih2YXIgcj0iIixuPTA7bjxlO24rKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbbl0pO3JldHVybiByfXpmWzI1NF09emZbMjU0XT0xLEJmLnN0cmluZzJidWY9ZnVuY3Rpb24odCl7dmFyIGUscixuLGksbyxzPXQubGVuZ3RoLGE9MDtmb3IoaT0wO2k8cztpKyspNTUyOTY9PSg2NDUxMiYocj10LmNoYXJDb2RlQXQoaSkpKSYmaSsxPHMmJjU2MzIwPT0oNjQ1MTImKG49dC5jaGFyQ29kZUF0KGkrMSkpKSYmKHI9NjU1MzYrKHItNTUyOTY8PDEwKSsobi01NjMyMCksaSsrKSxhKz1yPDEyOD8xOnI8MjA0OD8yOnI8NjU1MzY/Mzo0O2ZvcihlPW5ldyBMZi5CdWY4KGEpLG89MCxpPTA7bzxhO2krKyk1NTI5Nj09KDY0NTEyJihyPXQuY2hhckNvZGVBdChpKSkpJiZpKzE8cyYmNTYzMjA9PSg2NDUxMiYobj10LmNoYXJDb2RlQXQoaSsxKSkpJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspLHI8MTI4P2VbbysrXT1yOnI8MjA0OD8oZVtvKytdPTE5MnxyPj4+NixlW28rK109MTI4fDYzJnIpOnI8NjU1MzY/KGVbbysrXT0yMjR8cj4+PjEyLGVbbysrXT0xMjh8cj4+PjYmNjMsZVtvKytdPTEyOHw2MyZyKTooZVtvKytdPTI0MHxyPj4+MTgsZVtvKytdPTEyOHxyPj4+MTImNjMsZVtvKytdPTEyOHxyPj4+NiY2MyxlW28rK109MTI4fDYzJnIpO3JldHVybiBlfSxCZi5idWYyYmluc3RyaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBQZih0LHQubGVuZ3RoKX0sQmYuYmluc3RyaW5nMmJ1Zj1mdW5jdGlvbih0KXtmb3IodmFyIGU9bmV3IExmLkJ1ZjgodC5sZW5ndGgpLHI9MCxuPWUubGVuZ3RoO3I8bjtyKyspZVtyXT10LmNoYXJDb2RlQXQocik7cmV0dXJuIGV9LEJmLmJ1ZjJzdHJpbmc9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzPWV8fHQubGVuZ3RoLGE9bmV3IEFycmF5KDIqcyk7Zm9yKG49MCxyPTA7cjxzOylpZigoaT10W3IrK10pPDEyOClhW24rK109aTtlbHNlIGlmKChvPXpmW2ldKT40KWFbbisrXT02NTUzMyxyKz1vLTE7ZWxzZXtmb3IoaSY9Mj09PW8/MzE6Mz09PW8/MTU6NztvPjEmJnI8czspaT1pPDw2fDYzJnRbcisrXSxvLS07bz4xP2FbbisrXT02NTUzMzppPDY1NTM2P2FbbisrXT1pOihpLT02NTUzNixhW24rK109NTUyOTZ8aT4+MTAmMTAyMyxhW24rK109NTYzMjB8MTAyMyZpKX1yZXR1cm4gUGYoYSxuKX0sQmYudXRmOGJvcmRlcj1mdW5jdGlvbih0LGUpe3ZhciByO2ZvcigoZT1lfHx0Lmxlbmd0aCk+dC5sZW5ndGgmJihlPXQubGVuZ3RoKSxyPWUtMTtyPj0wJiYxMjg9PSgxOTImdFtyXSk7KXItLTtyZXR1cm4gcjwwfHwwPT09cj9lOnIremZbdFtyXV0+ZT9yOmV9O3ZhciBNZj1mdW5jdGlvbigpe3RoaXMuaW5wdXQ9bnVsbCx0aGlzLm5leHRfaW49MCx0aGlzLmF2YWlsX2luPTAsdGhpcy50b3RhbF9pbj0wLHRoaXMub3V0cHV0PW51bGwsdGhpcy5uZXh0X291dD0wLHRoaXMuYXZhaWxfb3V0PTAsdGhpcy50b3RhbF9vdXQ9MCx0aGlzLm1zZz0iIix0aGlzLnN0YXRlPW51bGwsdGhpcy5kYXRhX3R5cGU9Mix0aGlzLmFkbGVyPTB9LFVmPWZkLEZmPWhkLGpmPUJmLEhmPXJmLEtmPU1mLEpmPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7ZnVuY3Rpb24gV2YodCl7aWYoISh0aGlzIGluc3RhbmNlb2YgV2YpKXJldHVybiBuZXcgV2YodCk7dGhpcy5vcHRpb25zPUZmLmFzc2lnbih7bGV2ZWw6LTEsbWV0aG9kOjgsY2h1bmtTaXplOjE2Mzg0LHdpbmRvd0JpdHM6MTUsbWVtTGV2ZWw6OCxzdHJhdGVneTowLHRvOiIifSx0fHx7fSk7dmFyIGU9dGhpcy5vcHRpb25zO2UucmF3JiZlLndpbmRvd0JpdHM+MD9lLndpbmRvd0JpdHM9LWUud2luZG93Qml0czplLmd6aXAmJmUud2luZG93Qml0cz4wJiZlLndpbmRvd0JpdHM8MTYmJihlLndpbmRvd0JpdHMrPTE2KSx0aGlzLmVycj0wLHRoaXMubXNnPSIiLHRoaXMuZW5kZWQ9ITEsdGhpcy5jaHVua3M9W10sdGhpcy5zdHJtPW5ldyBLZix0aGlzLnN0cm0uYXZhaWxfb3V0PTA7dmFyIHI9VWYuZGVmbGF0ZUluaXQyKHRoaXMuc3RybSxlLmxldmVsLGUubWV0aG9kLGUud2luZG93Qml0cyxlLm1lbUxldmVsLGUuc3RyYXRlZ3kpO2lmKDAhPT1yKXRocm93IG5ldyBFcnJvcihIZltyXSk7aWYoZS5oZWFkZXImJlVmLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLGUuaGVhZGVyKSxlLmRpY3Rpb25hcnkpe3ZhciBuO2lmKG49InN0cmluZyI9PXR5cGVvZiBlLmRpY3Rpb25hcnk/amYuc3RyaW5nMmJ1ZihlLmRpY3Rpb25hcnkpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT1KZi5jYWxsKGUuZGljdGlvbmFyeSk/bmV3IFVpbnQ4QXJyYXkoZS5kaWN0aW9uYXJ5KTplLmRpY3Rpb25hcnksMCE9PShyPVVmLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSxuKSkpdGhyb3cgbmV3IEVycm9yKEhmW3JdKTt0aGlzLl9kaWN0X3NldD0hMH19ZnVuY3Rpb24gWmYodCxlKXt2YXIgcj1uZXcgV2YoZSk7aWYoci5wdXNoKHQsITApLHIuZXJyKXRocm93IHIubXNnfHxIZltyLmVycl07cmV0dXJuIHIucmVzdWx0fVdmLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKHQsZSl7dmFyIHIsbixpPXRoaXMuc3RybSxvPXRoaXMub3B0aW9ucy5jaHVua1NpemU7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtuPWU9PT1+fmU/ZTohMD09PWU/NDowLCJzdHJpbmciPT10eXBlb2YgdD9pLmlucHV0PWpmLnN0cmluZzJidWYodCk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PUpmLmNhbGwodCk/aS5pbnB1dD1uZXcgVWludDhBcnJheSh0KTppLmlucHV0PXQsaS5uZXh0X2luPTAsaS5hdmFpbF9pbj1pLmlucHV0Lmxlbmd0aDtkb3tpZigwPT09aS5hdmFpbF9vdXQmJihpLm91dHB1dD1uZXcgRmYuQnVmOChvKSxpLm5leHRfb3V0PTAsaS5hdmFpbF9vdXQ9byksMSE9PShyPVVmLmRlZmxhdGUoaSxuKSkmJjAhPT1yKXJldHVybiB0aGlzLm9uRW5kKHIpLHRoaXMuZW5kZWQ9ITAsITE7MCE9PWkuYXZhaWxfb3V0JiYoMCE9PWkuYXZhaWxfaW58fDQhPT1uJiYyIT09bil8fCgic3RyaW5nIj09PXRoaXMub3B0aW9ucy50bz90aGlzLm9uRGF0YShqZi5idWYyYmluc3RyaW5nKEZmLnNocmlua0J1ZihpLm91dHB1dCxpLm5leHRfb3V0KSkpOnRoaXMub25EYXRhKEZmLnNocmlua0J1ZihpLm91dHB1dCxpLm5leHRfb3V0KSkpfXdoaWxlKChpLmF2YWlsX2luPjB8fDA9PT1pLmF2YWlsX291dCkmJjEhPT1yKTtyZXR1cm4gND09PW4/KHI9VWYuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLHRoaXMub25FbmQociksdGhpcy5lbmRlZD0hMCwwPT09cik6MiE9PW58fCh0aGlzLm9uRW5kKDApLGkuYXZhaWxfb3V0PTAsITApfSxXZi5wcm90b3R5cGUub25EYXRhPWZ1bmN0aW9uKHQpe3RoaXMuY2h1bmtzLnB1c2godCl9LFdmLnByb3RvdHlwZS5vbkVuZD1mdW5jdGlvbih0KXswPT09dCYmKCJzdHJpbmciPT09dGhpcy5vcHRpb25zLnRvP3RoaXMucmVzdWx0PXRoaXMuY2h1bmtzLmpvaW4oIiIpOnRoaXMucmVzdWx0PUZmLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9LGRkLkRlZmxhdGU9V2YsZGQuZGVmbGF0ZT1aZixkZC5kZWZsYXRlUmF3PWZ1bmN0aW9uKHQsZSl7cmV0dXJuKGU9ZXx8e30pLnJhdz0hMCxaZih0LGUpfSxkZC5nemlwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuKGU9ZXx8e30pLmd6aXA9ITAsWmYodCxlKX07dmFyIEdmPXt9LFZmPW90LCRmPWZ1bmN0aW9uKHQpe3ZhciBlPXQuZmxhZ3M7cmV0dXJuIHZvaWQgMCE9PWV8fCJmbGFncyJpbiBrbHx8YmwodCwiZmxhZ3MiKXx8IXdsKGtsLHQpP2U6dmwoU2wsdCl9LFhmPVJlZ0V4cC5wcm90b3R5cGUsWWY9ZSgoZnVuY3Rpb24odCl7cmV0dXJuIHQ9PT1YZnx8VmYoWGYsdCk/JGYodCk6dC5mbGFnc30pKSxxZj17fSxRZj1oZCx0cD0xNSxlcD1bMyw0LDUsNiw3LDgsOSwxMCwxMSwxMywxNSwxNywxOSwyMywyNywzMSwzNSw0Myw1MSw1OSw2Nyw4Myw5OSwxMTUsMTMxLDE2MywxOTUsMjI3LDI1OCwwLDBdLHJwPVsxNiwxNiwxNiwxNiwxNiwxNiwxNiwxNiwxNywxNywxNywxNywxOCwxOCwxOCwxOCwxOSwxOSwxOSwxOSwyMCwyMCwyMCwyMCwyMSwyMSwyMSwyMSwxNiw3Miw3OF0sbnA9WzEsMiwzLDQsNSw3LDksMTMsMTcsMjUsMzMsNDksNjUsOTcsMTI5LDE5MywyNTcsMzg1LDUxMyw3NjksMTAyNSwxNTM3LDIwNDksMzA3Myw0MDk3LDYxNDUsODE5MywxMjI4OSwxNjM4NSwyNDU3NywwLDBdLGlwPVsxNiwxNiwxNiwxNiwxNywxNywxOCwxOCwxOSwxOSwyMCwyMCwyMSwyMSwyMiwyMiwyMywyMywyNCwyNCwyNSwyNSwyNiwyNiwyNywyNywyOCwyOCwyOSwyOSw2NCw2NF0sb3A9aGQsc3A9cWQsYXA9ZWYsY3A9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYyx1LGwsaCxkLGYscCxfLGcsbSx5LHYsYix3LFMsayxPLHgsQTtyPXQuc3RhdGUsbj10Lm5leHRfaW4seD10LmlucHV0LGk9bisodC5hdmFpbF9pbi01KSxvPXQubmV4dF9vdXQsQT10Lm91dHB1dCxzPW8tKGUtdC5hdmFpbF9vdXQpLGE9bysodC5hdmFpbF9vdXQtMjU3KSxjPXIuZG1heCx1PXIud3NpemUsbD1yLndoYXZlLGg9ci53bmV4dCxkPXIud2luZG93LGY9ci5ob2xkLHA9ci5iaXRzLF89ci5sZW5jb2RlLGc9ci5kaXN0Y29kZSxtPSgxPDxyLmxlbmJpdHMpLTEseT0oMTw8ci5kaXN0Yml0cyktMTt0OmRve3A8MTUmJihmKz14W24rK108PHAscCs9OCxmKz14W24rK108PHAscCs9OCksdj1fW2YmbV07ZTpmb3IoOzspe2lmKGY+Pj49Yj12Pj4+MjQscC09YiwwPT09KGI9dj4+PjE2JjI1NSkpQVtvKytdPTY1NTM1JnY7ZWxzZXtpZighKDE2JmIpKXtpZig2NCZiKXtpZigzMiZiKXtyLm1vZGU9MTI7YnJlYWsgdH10Lm1zZz0iaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIixyLm1vZGU9MzA7YnJlYWsgdH12PV9bKDY1NTM1JnYpKyhmJigxPDxiKS0xKV07Y29udGludWUgZX1mb3Iodz02NTUzNSZ2LChiJj0xNSkmJihwPGImJihmKz14W24rK108PHAscCs9OCksdys9ZiYoMTw8YiktMSxmPj4+PWIscC09YikscDwxNSYmKGYrPXhbbisrXTw8cCxwKz04LGYrPXhbbisrXTw8cCxwKz04KSx2PWdbZiZ5XTs7KXtpZihmPj4+PWI9dj4+PjI0LHAtPWIsMTYmKGI9dj4+PjE2JjI1NSkpe2lmKFM9NjU1MzUmdixwPChiJj0xNSkmJihmKz14W24rK108PHAsKHArPTgpPGImJihmKz14W24rK108PHAscCs9OCkpLChTKz1mJigxPDxiKS0xKT5jKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLHIubW9kZT0zMDticmVhayB0fWlmKGY+Pj49YixwLT1iLFM+KGI9by1zKSl7aWYoKGI9Uy1iKT5sJiZyLnNhbmUpe3QubXNnPSJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsci5tb2RlPTMwO2JyZWFrIHR9aWYoaz0wLE89ZCwwPT09aCl7aWYoays9dS1iLGI8dyl7dy09Yjtkb3tBW28rK109ZFtrKytdfXdoaWxlKC0tYik7az1vLVMsTz1BfX1lbHNlIGlmKGg8Yil7aWYoays9dStoLWIsKGItPWgpPHcpe3ctPWI7ZG97QVtvKytdPWRbaysrXX13aGlsZSgtLWIpO2lmKGs9MCxoPHcpe3ctPWI9aDtkb3tBW28rK109ZFtrKytdfXdoaWxlKC0tYik7az1vLVMsTz1BfX19ZWxzZSBpZihrKz1oLWIsYjx3KXt3LT1iO2Rve0FbbysrXT1kW2srK119d2hpbGUoLS1iKTtrPW8tUyxPPUF9Zm9yKDt3PjI7KUFbbysrXT1PW2srK10sQVtvKytdPU9baysrXSxBW28rK109T1trKytdLHctPTM7dyYmKEFbbysrXT1PW2srK10sdz4xJiYoQVtvKytdPU9baysrXSkpfWVsc2V7az1vLVM7ZG97QVtvKytdPUFbaysrXSxBW28rK109QVtrKytdLEFbbysrXT1BW2srK10sdy09M313aGlsZSh3PjIpO3cmJihBW28rK109QVtrKytdLHc+MSYmKEFbbysrXT1BW2srK10pKX1icmVha31pZig2NCZiKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZSBjb2RlIixyLm1vZGU9MzA7YnJlYWsgdH12PWdbKDY1NTM1JnYpKyhmJigxPDxiKS0xKV19fWJyZWFrfX13aGlsZShuPGkmJm88YSk7bi09dz1wPj4zLGYmPSgxPDwocC09dzw8MykpLTEsdC5uZXh0X2luPW4sdC5uZXh0X291dD1vLHQuYXZhaWxfaW49bjxpP2ktbis1OjUtKG4taSksdC5hdmFpbF9vdXQ9bzxhP2EtbysyNTc6MjU3LShvLWEpLHIuaG9sZD1mLHIuYml0cz1wfSx1cD1mdW5jdGlvbih0LGUscixuLGksbyxzLGEpe3ZhciBjLHUsbCxoLGQsZixwLF8sZyxtPWEuYml0cyx5PTAsdj0wLGI9MCx3PTAsUz0wLGs9MCxPPTAseD0wLEE9MCxFPTAsQz1udWxsLEk9MCxUPW5ldyBRZi5CdWYxNigxNiksQj1uZXcgUWYuQnVmMTYoMTYpLEw9bnVsbCxOPTA7Zm9yKHk9MDt5PD10cDt5KyspVFt5XT0wO2Zvcih2PTA7djxuO3YrKylUW2Vbcit2XV0rKztmb3IoUz1tLHc9dHA7dz49MSYmMD09PVRbd107dy0tKTtpZihTPncmJihTPXcpLDA9PT13KXJldHVybiBpW28rK109MjA5NzE1MjAsaVtvKytdPTIwOTcxNTIwLGEuYml0cz0xLDA7Zm9yKGI9MTtiPHcmJjA9PT1UW2JdO2IrKyk7Zm9yKFM8YiYmKFM9YikseD0xLHk9MTt5PD10cDt5KyspaWYoeDw8PTEsKHgtPVRbeV0pPDApcmV0dXJuLTE7aWYoeD4wJiYoMD09PXR8fDEhPT13KSlyZXR1cm4tMTtmb3IoQlsxXT0wLHk9MTt5PHRwO3krKylCW3krMV09Qlt5XStUW3ldO2Zvcih2PTA7djxuO3YrKykwIT09ZVtyK3ZdJiYoc1tCW2Vbcit2XV0rK109dik7aWYoMD09PXQ/KEM9TD1zLGY9MTkpOjE9PT10PyhDPWVwLEktPTI1NyxMPXJwLE4tPTI1NyxmPTI1Nik6KEM9bnAsTD1pcCxmPS0xKSxFPTAsdj0wLHk9YixkPW8saz1TLE89MCxsPS0xLGg9KEE9MTw8UyktMSwxPT09dCYmQT44NTJ8fDI9PT10JiZBPjU5MilyZXR1cm4gMTtmb3IoOzspe3A9eS1PLHNbdl08Zj8oXz0wLGc9c1t2XSk6c1t2XT5mPyhfPUxbTitzW3ZdXSxnPUNbSStzW3ZdXSk6KF89OTYsZz0wKSxjPTE8PHktTyxiPXU9MTw8aztkb3tpW2QrKEU+Pk8pKyh1LT1jKV09cDw8MjR8Xzw8MTZ8Z313aGlsZSgwIT09dSk7Zm9yKGM9MTw8eS0xO0UmYzspYz4+PTE7aWYoMCE9PWM/KEUmPWMtMSxFKz1jKTpFPTAsdisrLDA9PS0tVFt5XSl7aWYoeT09PXcpYnJlYWs7eT1lW3Irc1t2XV19aWYoeT5TJiYoRSZoKSE9PWwpe2ZvcigwPT09TyYmKE89UyksZCs9Yix4PTE8PChrPXktTyk7aytPPHcmJiEoKHgtPVRbaytPXSk8PTApOylrKysseDw8PTE7aWYoQSs9MTw8aywxPT09dCYmQT44NTJ8fDI9PT10JiZBPjU5MilyZXR1cm4gMTtpW2w9RSZoXT1TPDwyNHxrPDwxNnxkLW99fXJldHVybiAwIT09RSYmKGlbZCtFXT15LU88PDI0fDY0PDwxNiksYS5iaXRzPVMsMH0sbHA9LTIsaHA9MTIsZHA9MzA7ZnVuY3Rpb24gZnAodCl7cmV0dXJuKHQ+Pj4yNCYyNTUpKyh0Pj4+OCY2NTI4MCkrKCg2NTI4MCZ0KTw8OCkrKCgyNTUmdCk8PDI0KX1mdW5jdGlvbiBwcCgpe3RoaXMubW9kZT0wLHRoaXMubGFzdD0hMSx0aGlzLndyYXA9MCx0aGlzLmhhdmVkaWN0PSExLHRoaXMuZmxhZ3M9MCx0aGlzLmRtYXg9MCx0aGlzLmNoZWNrPTAsdGhpcy50b3RhbD0wLHRoaXMuaGVhZD1udWxsLHRoaXMud2JpdHM9MCx0aGlzLndzaXplPTAsdGhpcy53aGF2ZT0wLHRoaXMud25leHQ9MCx0aGlzLndpbmRvdz1udWxsLHRoaXMuaG9sZD0wLHRoaXMuYml0cz0wLHRoaXMubGVuZ3RoPTAsdGhpcy5vZmZzZXQ9MCx0aGlzLmV4dHJhPTAsdGhpcy5sZW5jb2RlPW51bGwsdGhpcy5kaXN0Y29kZT1udWxsLHRoaXMubGVuYml0cz0wLHRoaXMuZGlzdGJpdHM9MCx0aGlzLm5jb2RlPTAsdGhpcy5ubGVuPTAsdGhpcy5uZGlzdD0wLHRoaXMuaGF2ZT0wLHRoaXMubmV4dD1udWxsLHRoaXMubGVucz1uZXcgb3AuQnVmMTYoMzIwKSx0aGlzLndvcms9bmV3IG9wLkJ1ZjE2KDI4OCksdGhpcy5sZW5keW49bnVsbCx0aGlzLmRpc3RkeW49bnVsbCx0aGlzLnNhbmU9MCx0aGlzLmJhY2s9MCx0aGlzLndhcz0wfWZ1bmN0aW9uIF9wKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPyhlPXQuc3RhdGUsdC50b3RhbF9pbj10LnRvdGFsX291dD1lLnRvdGFsPTAsdC5tc2c9IiIsZS53cmFwJiYodC5hZGxlcj0xJmUud3JhcCksZS5tb2RlPTEsZS5sYXN0PTAsZS5oYXZlZGljdD0wLGUuZG1heD0zMjc2OCxlLmhlYWQ9bnVsbCxlLmhvbGQ9MCxlLmJpdHM9MCxlLmxlbmNvZGU9ZS5sZW5keW49bmV3IG9wLkJ1ZjMyKDg1MiksZS5kaXN0Y29kZT1lLmRpc3RkeW49bmV3IG9wLkJ1ZjMyKDU5MiksZS5zYW5lPTEsZS5iYWNrPS0xLDApOmxwfWZ1bmN0aW9uIGdwKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPygoZT10LnN0YXRlKS53c2l6ZT0wLGUud2hhdmU9MCxlLnduZXh0PTAsX3AodCkpOmxwfWZ1bmN0aW9uIG1wKHQsZSl7dmFyIHIsbjtyZXR1cm4gdCYmdC5zdGF0ZT8obj10LnN0YXRlLGU8MD8ocj0wLGU9LWUpOihyPTErKGU+PjQpLGU8NDgmJihlJj0xNSkpLGUmJihlPDh8fGU+MTUpP2xwOihudWxsIT09bi53aW5kb3cmJm4ud2JpdHMhPT1lJiYobi53aW5kb3c9bnVsbCksbi53cmFwPXIsbi53Yml0cz1lLGdwKHQpKSk6bHB9ZnVuY3Rpb24geXAodCxlKXt2YXIgcixuO3JldHVybiB0PyhuPW5ldyBwcCx0LnN0YXRlPW4sbi53aW5kb3c9bnVsbCwwIT09KHI9bXAodCxlKSkmJih0LnN0YXRlPW51bGwpLHIpOmxwfXZhciB2cCxicCx3cD0hMDtmdW5jdGlvbiBTcCh0KXtpZih3cCl7dmFyIGU7Zm9yKHZwPW5ldyBvcC5CdWYzMig1MTIpLGJwPW5ldyBvcC5CdWYzMigzMiksZT0wO2U8MTQ0Oyl0LmxlbnNbZSsrXT04O2Zvcig7ZTwyNTY7KXQubGVuc1tlKytdPTk7Zm9yKDtlPDI4MDspdC5sZW5zW2UrK109Nztmb3IoO2U8Mjg4Oyl0LmxlbnNbZSsrXT04O2Zvcih1cCgxLHQubGVucywwLDI4OCx2cCwwLHQud29yayx7Yml0czo5fSksZT0wO2U8MzI7KXQubGVuc1tlKytdPTU7dXAoMix0LmxlbnMsMCwzMixicCwwLHQud29yayx7Yml0czo1fSksd3A9ITF9dC5sZW5jb2RlPXZwLHQubGVuYml0cz05LHQuZGlzdGNvZGU9YnAsdC5kaXN0Yml0cz01fWZ1bmN0aW9uIGtwKHQsZSxyLG4pe3ZhciBpLG89dC5zdGF0ZTtyZXR1cm4gbnVsbD09PW8ud2luZG93JiYoby53c2l6ZT0xPDxvLndiaXRzLG8ud25leHQ9MCxvLndoYXZlPTAsby53aW5kb3c9bmV3IG9wLkJ1Zjgoby53c2l6ZSkpLG4+PW8ud3NpemU/KG9wLmFycmF5U2V0KG8ud2luZG93LGUsci1vLndzaXplLG8ud3NpemUsMCksby53bmV4dD0wLG8ud2hhdmU9by53c2l6ZSk6KChpPW8ud3NpemUtby53bmV4dCk+biYmKGk9biksb3AuYXJyYXlTZXQoby53aW5kb3csZSxyLW4saSxvLnduZXh0KSwobi09aSk/KG9wLmFycmF5U2V0KG8ud2luZG93LGUsci1uLG4sMCksby53bmV4dD1uLG8ud2hhdmU9by53c2l6ZSk6KG8ud25leHQrPWksby53bmV4dD09PW8ud3NpemUmJihvLnduZXh0PTApLG8ud2hhdmU8by53c2l6ZSYmKG8ud2hhdmUrPWkpKSksMH1xZi5pbmZsYXRlUmVzZXQ9Z3AscWYuaW5mbGF0ZVJlc2V0Mj1tcCxxZi5pbmZsYXRlUmVzZXRLZWVwPV9wLHFmLmluZmxhdGVJbml0PWZ1bmN0aW9uKHQpe3JldHVybiB5cCh0LDE1KX0scWYuaW5mbGF0ZUluaXQyPXlwLHFmLmluZmxhdGU9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYyx1LGwsaCxkLGYscCxfLGcsbSx5LHYsYix3LFMsayxPLHgsQT0wLEU9bmV3IG9wLkJ1ZjgoNCksQz1bMTYsMTcsMTgsMCw4LDcsOSw2LDEwLDUsMTEsNCwxMiwzLDEzLDIsMTQsMSwxNV07aWYoIXR8fCF0LnN0YXRlfHwhdC5vdXRwdXR8fCF0LmlucHV0JiYwIT09dC5hdmFpbF9pbilyZXR1cm4gbHA7KHI9dC5zdGF0ZSkubW9kZT09PWhwJiYoci5tb2RlPTEzKSxzPXQubmV4dF9vdXQsaT10Lm91dHB1dCxjPXQuYXZhaWxfb3V0LG89dC5uZXh0X2luLG49dC5pbnB1dCxhPXQuYXZhaWxfaW4sdT1yLmhvbGQsbD1yLmJpdHMsaD1hLGQ9YyxrPTA7dDpmb3IoOzspc3dpdGNoKHIubW9kZSl7Y2FzZSAxOmlmKDA9PT1yLndyYXApe3IubW9kZT0xMzticmVha31mb3IoO2w8MTY7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZigyJnIud3JhcCYmMzU2MTU9PT11KXtyLmNoZWNrPTAsRVswXT0yNTUmdSxFWzFdPXU+Pj44JjI1NSxyLmNoZWNrPWFwKHIuY2hlY2ssRSwyLDApLHU9MCxsPTAsci5tb2RlPTI7YnJlYWt9aWYoci5mbGFncz0wLHIuaGVhZCYmKHIuaGVhZC5kb25lPSExKSwhKDEmci53cmFwKXx8KCgoMjU1JnUpPDw4KSsodT4+OCkpJTMxKXt0Lm1zZz0iaW5jb3JyZWN0IGhlYWRlciBjaGVjayIsci5tb2RlPWRwO2JyZWFrfWlmKDghPSgxNSZ1KSl7dC5tc2c9InVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIixyLm1vZGU9ZHA7YnJlYWt9aWYobC09NCxTPTgrKDE1Jih1Pj4+PTQpKSwwPT09ci53Yml0cylyLndiaXRzPVM7ZWxzZSBpZihTPnIud2JpdHMpe3QubXNnPSJpbnZhbGlkIHdpbmRvdyBzaXplIixyLm1vZGU9ZHA7YnJlYWt9ci5kbWF4PTE8PFMsdC5hZGxlcj1yLmNoZWNrPTEsci5tb2RlPTUxMiZ1PzEwOmhwLHU9MCxsPTA7YnJlYWs7Y2FzZSAyOmZvcig7bDwxNjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWlmKHIuZmxhZ3M9dSw4IT0oMjU1JllmKHIpKSl7dC5tc2c9InVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIixyLm1vZGU9ZHA7YnJlYWt9aWYoNTczNDQmWWYocikpe3QubXNnPSJ1bmtub3duIGhlYWRlciBmbGFncyBzZXQiLHIubW9kZT1kcDticmVha31yLmhlYWQmJihyLmhlYWQudGV4dD11Pj44JjEpLDUxMiZZZihyKSYmKEVbMF09MjU1JnUsRVsxXT11Pj4+OCYyNTUsci5jaGVjaz1hcChyLmNoZWNrLEUsMiwwKSksdT0wLGw9MCxyLm1vZGU9MztjYXNlIDM6Zm9yKDtsPDMyOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5oZWFkJiYoci5oZWFkLnRpbWU9dSksNTEyJllmKHIpJiYoRVswXT0yNTUmdSxFWzFdPXU+Pj44JjI1NSxFWzJdPXU+Pj4xNiYyNTUsRVszXT11Pj4+MjQmMjU1LHIuY2hlY2s9YXAoci5jaGVjayxFLDQsMCkpLHU9MCxsPTAsci5tb2RlPTQ7Y2FzZSA0OmZvcig7bDwxNjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fXIuaGVhZCYmKHIuaGVhZC54ZmxhZ3M9MjU1JnUsci5oZWFkLm9zPXU+PjgpLDUxMiZZZihyKSYmKEVbMF09MjU1JnUsRVsxXT11Pj4+OCYyNTUsci5jaGVjaz1hcChyLmNoZWNrLEUsMiwwKSksdT0wLGw9MCxyLm1vZGU9NTtjYXNlIDU6aWYoMTAyNCZZZihyKSl7Zm9yKDtsPDE2Oyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5sZW5ndGg9dSxyLmhlYWQmJihyLmhlYWQuZXh0cmFfbGVuPXUpLDUxMiZZZihyKSYmKEVbMF09MjU1JnUsRVsxXT11Pj4+OCYyNTUsci5jaGVjaz1hcChyLmNoZWNrLEUsMiwwKSksdT0wLGw9MH1lbHNlIHIuaGVhZCYmKHIuaGVhZC5leHRyYT1udWxsKTtyLm1vZGU9NjtjYXNlIDY6aWYoMTAyNCZZZihyKSYmKChmPXIubGVuZ3RoKT5hJiYoZj1hKSxmJiYoci5oZWFkJiYoUz1yLmhlYWQuZXh0cmFfbGVuLXIubGVuZ3RoLHIuaGVhZC5leHRyYXx8KHIuaGVhZC5leHRyYT1uZXcgQXJyYXkoci5oZWFkLmV4dHJhX2xlbikpLG9wLmFycmF5U2V0KHIuaGVhZC5leHRyYSxuLG8sZixTKSksNTEyJllmKHIpJiYoci5jaGVjaz1hcChyLmNoZWNrLG4sZixvKSksYS09ZixvKz1mLHIubGVuZ3RoLT1mKSxyLmxlbmd0aCkpYnJlYWsgdDtyLmxlbmd0aD0wLHIubW9kZT03O2Nhc2UgNzppZigyMDQ4JllmKHIpKXtpZigwPT09YSlicmVhayB0O2Y9MDtkb3tTPW5bbytmKytdLHIuaGVhZCYmUyYmci5sZW5ndGg8NjU1MzYmJihyLmhlYWQubmFtZSs9U3RyaW5nLmZyb21DaGFyQ29kZShTKSl9d2hpbGUoUyYmZjxhKTtpZig1MTImWWYocikmJihyLmNoZWNrPWFwKHIuY2hlY2ssbixmLG8pKSxhLT1mLG8rPWYsUylicmVhayB0fWVsc2Ugci5oZWFkJiYoci5oZWFkLm5hbWU9bnVsbCk7ci5sZW5ndGg9MCxyLm1vZGU9ODtjYXNlIDg6aWYoNDA5NiZZZihyKSl7aWYoMD09PWEpYnJlYWsgdDtmPTA7ZG97Uz1uW28rZisrXSxyLmhlYWQmJlMmJnIubGVuZ3RoPDY1NTM2JiYoci5oZWFkLmNvbW1lbnQrPVN0cmluZy5mcm9tQ2hhckNvZGUoUykpfXdoaWxlKFMmJmY8YSk7aWYoNTEyJllmKHIpJiYoci5jaGVjaz1hcChyLmNoZWNrLG4sZixvKSksYS09ZixvKz1mLFMpYnJlYWsgdH1lbHNlIHIuaGVhZCYmKHIuaGVhZC5jb21tZW50PW51bGwpO3IubW9kZT05O2Nhc2UgOTppZig1MTImWWYocikpe2Zvcig7bDwxNjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWlmKHUhPT0oNjU1MzUmci5jaGVjaykpe3QubXNnPSJoZWFkZXIgY3JjIG1pc21hdGNoIixyLm1vZGU9ZHA7YnJlYWt9dT0wLGw9MH1yLmhlYWQmJihyLmhlYWQuaGNyYz1ZZihyKT4+OSYxLHIuaGVhZC5kb25lPSEwKSx0LmFkbGVyPXIuY2hlY2s9MCxyLm1vZGU9aHA7YnJlYWs7Y2FzZSAxMDpmb3IoO2w8MzI7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH10LmFkbGVyPXIuY2hlY2s9ZnAodSksdT0wLGw9MCxyLm1vZGU9MTE7Y2FzZSAxMTppZigwPT09ci5oYXZlZGljdClyZXR1cm4gdC5uZXh0X291dD1zLHQuYXZhaWxfb3V0PWMsdC5uZXh0X2luPW8sdC5hdmFpbF9pbj1hLHIuaG9sZD11LHIuYml0cz1sLDI7dC5hZGxlcj1yLmNoZWNrPTEsci5tb2RlPWhwO2Nhc2UgaHA6aWYoNT09PWV8fDY9PT1lKWJyZWFrIHQ7Y2FzZSAxMzppZihyLmxhc3Qpe3U+Pj49NyZsLGwtPTcmbCxyLm1vZGU9Mjc7YnJlYWt9Zm9yKDtsPDM7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1zd2l0Y2goci5sYXN0PTEmdSxsLT0xLDMmKHU+Pj49MSkpe2Nhc2UgMDpyLm1vZGU9MTQ7YnJlYWs7Y2FzZSAxOmlmKFNwKHIpLHIubW9kZT0yMCw2PT09ZSl7dT4+Pj0yLGwtPTI7YnJlYWsgdH1icmVhaztjYXNlIDI6ci5tb2RlPTE3O2JyZWFrO2Nhc2UgMzp0Lm1zZz0iaW52YWxpZCBibG9jayB0eXBlIixyLm1vZGU9ZHB9dT4+Pj0yLGwtPTI7YnJlYWs7Y2FzZSAxNDpmb3IodT4+Pj03JmwsbC09NyZsO2w8MzI7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZigoNjU1MzUmdSkhPSh1Pj4+MTZeNjU1MzUpKXt0Lm1zZz0iaW52YWxpZCBzdG9yZWQgYmxvY2sgbGVuZ3RocyIsci5tb2RlPWRwO2JyZWFrfWlmKHIubGVuZ3RoPTY1NTM1JnUsdT0wLGw9MCxyLm1vZGU9MTUsNj09PWUpYnJlYWsgdDtjYXNlIDE1OnIubW9kZT0xNjtjYXNlIDE2OmlmKGY9ci5sZW5ndGgpe2lmKGY+YSYmKGY9YSksZj5jJiYoZj1jKSwwPT09ZilicmVhayB0O29wLmFycmF5U2V0KGksbixvLGYscyksYS09ZixvKz1mLGMtPWYscys9ZixyLmxlbmd0aC09ZjticmVha31yLm1vZGU9aHA7YnJlYWs7Y2FzZSAxNzpmb3IoO2w8MTQ7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZihyLm5sZW49MjU3KygzMSZ1KSx1Pj4+PTUsbC09NSxyLm5kaXN0PTErKDMxJnUpLHU+Pj49NSxsLT01LHIubmNvZGU9NCsoMTUmdSksdT4+Pj00LGwtPTQsci5ubGVuPjI4Nnx8ci5uZGlzdD4zMCl7dC5tc2c9InRvbyBtYW55IGxlbmd0aCBvciBkaXN0YW5jZSBzeW1ib2xzIixyLm1vZGU9ZHA7YnJlYWt9ci5oYXZlPTAsci5tb2RlPTE4O2Nhc2UgMTg6Zm9yKDtyLmhhdmU8ci5uY29kZTspe2Zvcig7bDwzOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5sZW5zW0Nbci5oYXZlKytdXT03JnUsdT4+Pj0zLGwtPTN9Zm9yKDtyLmhhdmU8MTk7KXIubGVuc1tDW3IuaGF2ZSsrXV09MDtpZihyLmxlbmNvZGU9ci5sZW5keW4sci5sZW5iaXRzPTcsTz17Yml0czpyLmxlbmJpdHN9LGs9dXAoMCxyLmxlbnMsMCwxOSxyLmxlbmNvZGUsMCxyLndvcmssTyksci5sZW5iaXRzPU8uYml0cyxrKXt0Lm1zZz0iaW52YWxpZCBjb2RlIGxlbmd0aHMgc2V0IixyLm1vZGU9ZHA7YnJlYWt9ci5oYXZlPTAsci5tb2RlPTE5O2Nhc2UgMTk6Zm9yKDtyLmhhdmU8ci5ubGVuK3IubmRpc3Q7KXtmb3IoO209KEE9ci5sZW5jb2RlW3UmKDE8PHIubGVuYml0cyktMV0pPj4+MTYmMjU1LHk9NjU1MzUmQSwhKChnPUE+Pj4yNCk8PWwpOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9aWYoeTwxNil1Pj4+PWcsbC09ZyxyLmxlbnNbci5oYXZlKytdPXk7ZWxzZXtpZigxNj09PXkpe2Zvcih4PWcrMjtsPHg7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZih1Pj4+PWcsbC09ZywwPT09ci5oYXZlKXt0Lm1zZz0iaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCIsci5tb2RlPWRwO2JyZWFrfVM9ci5sZW5zW3IuaGF2ZS0xXSxmPTMrKDMmdSksdT4+Pj0yLGwtPTJ9ZWxzZSBpZigxNz09PXkpe2Zvcih4PWcrMztsPHg7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1sLT1nLFM9MCxmPTMrKDcmKHU+Pj49ZykpLHU+Pj49MyxsLT0zfWVsc2V7Zm9yKHg9Zys3O2w8eDspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWwtPWcsUz0wLGY9MTErKDEyNyYodT4+Pj1nKSksdT4+Pj03LGwtPTd9aWYoci5oYXZlK2Y+ci5ubGVuK3IubmRpc3Qpe3QubXNnPSJpbnZhbGlkIGJpdCBsZW5ndGggcmVwZWF0IixyLm1vZGU9ZHA7YnJlYWt9Zm9yKDtmLS07KXIubGVuc1tyLmhhdmUrK109U319aWYoci5tb2RlPT09ZHApYnJlYWs7aWYoMD09PXIubGVuc1syNTZdKXt0Lm1zZz0iaW52YWxpZCBjb2RlIC0tIG1pc3NpbmcgZW5kLW9mLWJsb2NrIixyLm1vZGU9ZHA7YnJlYWt9aWYoci5sZW5iaXRzPTksTz17Yml0czpyLmxlbmJpdHN9LGs9dXAoMSxyLmxlbnMsMCxyLm5sZW4sci5sZW5jb2RlLDAsci53b3JrLE8pLHIubGVuYml0cz1PLmJpdHMsayl7dC5tc2c9ImludmFsaWQgbGl0ZXJhbC9sZW5ndGhzIHNldCIsci5tb2RlPWRwO2JyZWFrfWlmKHIuZGlzdGJpdHM9NixyLmRpc3Rjb2RlPXIuZGlzdGR5bixPPXtiaXRzOnIuZGlzdGJpdHN9LGs9dXAoMixyLmxlbnMsci5ubGVuLHIubmRpc3Qsci5kaXN0Y29kZSwwLHIud29yayxPKSxyLmRpc3RiaXRzPU8uYml0cyxrKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZXMgc2V0IixyLm1vZGU9ZHA7YnJlYWt9aWYoci5tb2RlPTIwLDY9PT1lKWJyZWFrIHQ7Y2FzZSAyMDpyLm1vZGU9MjE7Y2FzZSAyMTppZihhPj02JiZjPj0yNTgpe3QubmV4dF9vdXQ9cyx0LmF2YWlsX291dD1jLHQubmV4dF9pbj1vLHQuYXZhaWxfaW49YSxyLmhvbGQ9dSxyLmJpdHM9bCxjcCh0LGQpLHM9dC5uZXh0X291dCxpPXQub3V0cHV0LGM9dC5hdmFpbF9vdXQsbz10Lm5leHRfaW4sbj10LmlucHV0LGE9dC5hdmFpbF9pbix1PXIuaG9sZCxsPXIuYml0cyxyLm1vZGU9PT1ocCYmKHIuYmFjaz0tMSk7YnJlYWt9Zm9yKHIuYmFjaz0wO209KEE9ci5sZW5jb2RlW3UmKDE8PHIubGVuYml0cyktMV0pPj4+MTYmMjU1LHk9NjU1MzUmQSwhKChnPUE+Pj4yNCk8PWwpOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9aWYobSYmISgyNDAmbSkpe2Zvcih2PWcsYj1tLHc9eTttPShBPXIubGVuY29kZVt3KygodSYoMTw8ditiKS0xKT4+dildKT4+PjE2JjI1NSx5PTY1NTM1JkEsISh2KyhnPUE+Pj4yNCk8PWwpOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9dT4+Pj12LGwtPXYsci5iYWNrKz12fWlmKHU+Pj49ZyxsLT1nLHIuYmFjays9ZyxyLmxlbmd0aD15LDA9PT1tKXtyLm1vZGU9MjY7YnJlYWt9aWYoMzImbSl7ci5iYWNrPS0xLHIubW9kZT1ocDticmVha31pZig2NCZtKXt0Lm1zZz0iaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIixyLm1vZGU9ZHA7YnJlYWt9ci5leHRyYT0xNSZtLHIubW9kZT0yMjtjYXNlIDIyOmlmKHIuZXh0cmEpe2Zvcih4PXIuZXh0cmE7bDx4Oyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5sZW5ndGgrPXUmKDE8PHIuZXh0cmEpLTEsdT4+Pj1yLmV4dHJhLGwtPXIuZXh0cmEsci5iYWNrKz1yLmV4dHJhfXIud2FzPXIubGVuZ3RoLHIubW9kZT0yMztjYXNlIDIzOmZvcig7bT0oQT1yLmRpc3Rjb2RlW3UmKDE8PHIuZGlzdGJpdHMpLTFdKT4+PjE2JjI1NSx5PTY1NTM1JkEsISgoZz1BPj4+MjQpPD1sKTspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWlmKCEoMjQwJm0pKXtmb3Iodj1nLGI9bSx3PXk7bT0oQT1yLmRpc3Rjb2RlW3crKCh1JigxPDx2K2IpLTEpPj52KV0pPj4+MTYmMjU1LHk9NjU1MzUmQSwhKHYrKGc9QT4+PjI0KTw9bCk7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH11Pj4+PXYsbC09dixyLmJhY2srPXZ9aWYodT4+Pj1nLGwtPWcsci5iYWNrKz1nLDY0Jm0pe3QubXNnPSJpbnZhbGlkIGRpc3RhbmNlIGNvZGUiLHIubW9kZT1kcDticmVha31yLm9mZnNldD15LHIuZXh0cmE9MTUmbSxyLm1vZGU9MjQ7Y2FzZSAyNDppZihyLmV4dHJhKXtmb3IoeD1yLmV4dHJhO2w8eDspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fXIub2Zmc2V0Kz11JigxPDxyLmV4dHJhKS0xLHU+Pj49ci5leHRyYSxsLT1yLmV4dHJhLHIuYmFjays9ci5leHRyYX1pZihyLm9mZnNldD5yLmRtYXgpe3QubXNnPSJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsci5tb2RlPWRwO2JyZWFrfXIubW9kZT0yNTtjYXNlIDI1OmlmKDA9PT1jKWJyZWFrIHQ7aWYoZj1kLWMsci5vZmZzZXQ+Zil7aWYoKGY9ci5vZmZzZXQtZik+ci53aGF2ZSYmci5zYW5lKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLHIubW9kZT1kcDticmVha31mPnIud25leHQ/KGYtPXIud25leHQscD1yLndzaXplLWYpOnA9ci53bmV4dC1mLGY+ci5sZW5ndGgmJihmPXIubGVuZ3RoKSxfPXIud2luZG93fWVsc2UgXz1pLHA9cy1yLm9mZnNldCxmPXIubGVuZ3RoO2Y+YyYmKGY9YyksYy09ZixyLmxlbmd0aC09Zjtkb3tpW3MrK109X1twKytdfXdoaWxlKC0tZik7MD09PXIubGVuZ3RoJiYoci5tb2RlPTIxKTticmVhaztjYXNlIDI2OmlmKDA9PT1jKWJyZWFrIHQ7aVtzKytdPXIubGVuZ3RoLGMtLSxyLm1vZGU9MjE7YnJlYWs7Y2FzZSAyNzppZihyLndyYXApe2Zvcig7bDwzMjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHV8PW5bbysrXTw8bCxsKz04fWlmKGQtPWMsdC50b3RhbF9vdXQrPWQsci50b3RhbCs9ZCxkJiYodC5hZGxlcj1yLmNoZWNrPVlmKHIpP2FwKHIuY2hlY2ssaSxkLHMtZCk6c3Aoci5jaGVjayxpLGQscy1kKSksZD1jLChZZihyKT91OmZwKHUpKSE9PXIuY2hlY2spe3QubXNnPSJpbmNvcnJlY3QgZGF0YSBjaGVjayIsci5tb2RlPWRwO2JyZWFrfXU9MCxsPTB9ci5tb2RlPTI4O2Nhc2UgMjg6aWYoci53cmFwJiZZZihyKSl7Zm9yKDtsPDMyOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9aWYodSE9PSg0Mjk0OTY3Mjk1JnIudG90YWwpKXt0Lm1zZz0iaW5jb3JyZWN0IGxlbmd0aCBjaGVjayIsci5tb2RlPWRwO2JyZWFrfXU9MCxsPTB9ci5tb2RlPTI5O2Nhc2UgMjk6az0xO2JyZWFrIHQ7Y2FzZSBkcDprPS0zO2JyZWFrIHQ7Y2FzZSAzMTpyZXR1cm4tNDtkZWZhdWx0OnJldHVybiBscH1yZXR1cm4gdC5uZXh0X291dD1zLHQuYXZhaWxfb3V0PWMsdC5uZXh0X2luPW8sdC5hdmFpbF9pbj1hLHIuaG9sZD11LHIuYml0cz1sLChyLndzaXplfHxkIT09dC5hdmFpbF9vdXQmJnIubW9kZTxkcCYmKHIubW9kZTwyN3x8NCE9PWUpKSYma3AodCx0Lm91dHB1dCx0Lm5leHRfb3V0LGQtdC5hdmFpbF9vdXQpLGgtPXQuYXZhaWxfaW4sZC09dC5hdmFpbF9vdXQsdC50b3RhbF9pbis9aCx0LnRvdGFsX291dCs9ZCxyLnRvdGFsKz1kLHIud3JhcCYmZCYmKHQuYWRsZXI9ci5jaGVjaz1ZZihyKT9hcChyLmNoZWNrLGksZCx0Lm5leHRfb3V0LWQpOnNwKHIuY2hlY2ssaSxkLHQubmV4dF9vdXQtZCkpLHQuZGF0YV90eXBlPXIuYml0cysoci5sYXN0PzY0OjApKyhyLm1vZGU9PT1ocD8xMjg6MCkrKDIwPT09ci5tb2RlfHwxNT09PXIubW9kZT8yNTY6MCksKDA9PT1oJiYwPT09ZHx8ND09PWUpJiYwPT09ayYmKGs9LTUpLGt9LHFmLmluZmxhdGVFbmQ9ZnVuY3Rpb24odCl7aWYoIXR8fCF0LnN0YXRlKXJldHVybiBscDt2YXIgZT10LnN0YXRlO3JldHVybiBlLndpbmRvdyYmKGUud2luZG93PW51bGwpLHQuc3RhdGU9bnVsbCwwfSxxZi5pbmZsYXRlR2V0SGVhZGVyPWZ1bmN0aW9uKHQsZSl7dmFyIHI7cmV0dXJuIHQmJnQuc3RhdGUmJjImKHI9dC5zdGF0ZSkud3JhcD8oci5oZWFkPWUsZS5kb25lPSExLDApOmxwfSxxZi5pbmZsYXRlU2V0RGljdGlvbmFyeT1mdW5jdGlvbih0LGUpe3ZhciByLG49ZS5sZW5ndGg7cmV0dXJuIHQmJnQuc3RhdGU/MCE9PShyPXQuc3RhdGUpLndyYXAmJjExIT09ci5tb2RlP2xwOjExPT09ci5tb2RlJiZzcCgxLGUsbiwwKSE9PXIuY2hlY2s/LTM6a3AodCxlLG4sbik/KHIubW9kZT0zMSwtNCk6KHIuaGF2ZWRpY3Q9MSwwKTpscH0scWYuaW5mbGF0ZUluZm89InBha28gaW5mbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkiO3ZhciBPcD17Wl9OT19GTFVTSDowLFpfUEFSVElBTF9GTFVTSDoxLFpfU1lOQ19GTFVTSDoyLFpfRlVMTF9GTFVTSDozLFpfRklOSVNIOjQsWl9CTE9DSzo1LFpfVFJFRVM6NixaX09LOjAsWl9TVFJFQU1fRU5EOjEsWl9ORUVEX0RJQ1Q6MixaX0VSUk5POi0xLFpfU1RSRUFNX0VSUk9SOi0yLFpfREFUQV9FUlJPUjotMyxaX0JVRl9FUlJPUjotNSxaX05PX0NPTVBSRVNTSU9OOjAsWl9CRVNUX1NQRUVEOjEsWl9CRVNUX0NPTVBSRVNTSU9OOjksWl9ERUZBVUxUX0NPTVBSRVNTSU9OOi0xLFpfRklMVEVSRUQ6MSxaX0hVRkZNQU5fT05MWToyLFpfUkxFOjMsWl9GSVhFRDo0LFpfREVGQVVMVF9TVFJBVEVHWTowLFpfQklOQVJZOjAsWl9URVhUOjEsWl9VTktOT1dOOjIsWl9ERUZMQVRFRDo4fTt2YXIgeHA9cWYsQXA9aGQsRXA9QmYsQ3A9T3AsSXA9cmYsVHA9TWYsQnA9ZnVuY3Rpb24oKXt0aGlzLnRleHQ9MCx0aGlzLnRpbWU9MCx0aGlzLnhmbGFncz0wLHRoaXMub3M9MCx0aGlzLmV4dHJhPW51bGwsdGhpcy5leHRyYV9sZW49MCx0aGlzLm5hbWU9IiIsdGhpcy5jb21tZW50PSIiLHRoaXMuaGNyYz0wLHRoaXMuZG9uZT0hMX0sTHA9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBOcCh0KXtpZighKHRoaXMgaW5zdGFuY2VvZiBOcCkpcmV0dXJuIG5ldyBOcCh0KTt0aGlzLm9wdGlvbnM9QXAuYXNzaWduKHtjaHVua1NpemU6MTYzODQsd2luZG93Qml0czowLHRvOiIifSx0fHx7fSk7dmFyIGU9dGhpcy5vcHRpb25zO2UucmF3JiZlLndpbmRvd0JpdHM+PTAmJmUud2luZG93Qml0czwxNiYmKGUud2luZG93Qml0cz0tZS53aW5kb3dCaXRzLDA9PT1lLndpbmRvd0JpdHMmJihlLndpbmRvd0JpdHM9LTE1KSksIShlLndpbmRvd0JpdHM+PTAmJmUud2luZG93Qml0czwxNil8fHQmJnQud2luZG93Qml0c3x8KGUud2luZG93Qml0cys9MzIpLGUud2luZG93Qml0cz4xNSYmZS53aW5kb3dCaXRzPDQ4JiYoMTUmZS53aW5kb3dCaXRzfHwoZS53aW5kb3dCaXRzfD0xNSkpLHRoaXMuZXJyPTAsdGhpcy5tc2c9IiIsdGhpcy5lbmRlZD0hMSx0aGlzLmNodW5rcz1bXSx0aGlzLnN0cm09bmV3IFRwLHRoaXMuc3RybS5hdmFpbF9vdXQ9MDt2YXIgcj14cC5pbmZsYXRlSW5pdDIodGhpcy5zdHJtLGUud2luZG93Qml0cyk7aWYociE9PUNwLlpfT0spdGhyb3cgbmV3IEVycm9yKElwW3JdKTtpZih0aGlzLmhlYWRlcj1uZXcgQnAseHAuaW5mbGF0ZUdldEhlYWRlcih0aGlzLnN0cm0sdGhpcy5oZWFkZXIpLGUuZGljdGlvbmFyeSYmKCJzdHJpbmciPT10eXBlb2YgZS5kaWN0aW9uYXJ5P2UuZGljdGlvbmFyeT1FcC5zdHJpbmcyYnVmKGUuZGljdGlvbmFyeSk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PUxwLmNhbGwoZS5kaWN0aW9uYXJ5KSYmKGUuZGljdGlvbmFyeT1uZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpKSxlLnJhdyYmKHI9eHAuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLGUuZGljdGlvbmFyeSkpIT09Q3AuWl9PSykpdGhyb3cgbmV3IEVycm9yKElwW3JdKX1mdW5jdGlvbiBScCh0LGUpe3ZhciByPW5ldyBOcChlKTtpZihyLnB1c2godCwhMCksci5lcnIpdGhyb3cgci5tc2d8fElwW3IuZXJyXTtyZXR1cm4gci5yZXN1bHR9TnAucHJvdG90eXBlLnB1c2g9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGE9dGhpcy5zdHJtLGM9dGhpcy5vcHRpb25zLmNodW5rU2l6ZSx1PXRoaXMub3B0aW9ucy5kaWN0aW9uYXJ5LGw9ITE7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtuPWU9PT1+fmU/ZTohMD09PWU/Q3AuWl9GSU5JU0g6Q3AuWl9OT19GTFVTSCwic3RyaW5nIj09dHlwZW9mIHQ/YS5pbnB1dD1FcC5iaW5zdHJpbmcyYnVmKHQpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT1McC5jYWxsKHQpP2EuaW5wdXQ9bmV3IFVpbnQ4QXJyYXkodCk6YS5pbnB1dD10LGEubmV4dF9pbj0wLGEuYXZhaWxfaW49YS5pbnB1dC5sZW5ndGg7ZG97aWYoMD09PWEuYXZhaWxfb3V0JiYoYS5vdXRwdXQ9bmV3IEFwLkJ1ZjgoYyksYS5uZXh0X291dD0wLGEuYXZhaWxfb3V0PWMpLChyPXhwLmluZmxhdGUoYSxDcC5aX05PX0ZMVVNIKSk9PT1DcC5aX05FRURfRElDVCYmdSYmKHI9eHAuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLHUpKSxyPT09Q3AuWl9CVUZfRVJST1ImJiEwPT09bCYmKHI9Q3AuWl9PSyxsPSExKSxyIT09Q3AuWl9TVFJFQU1fRU5EJiZyIT09Q3AuWl9PSylyZXR1cm4gdGhpcy5vbkVuZChyKSx0aGlzLmVuZGVkPSEwLCExO2EubmV4dF9vdXQmJigwIT09YS5hdmFpbF9vdXQmJnIhPT1DcC5aX1NUUkVBTV9FTkQmJigwIT09YS5hdmFpbF9pbnx8biE9PUNwLlpfRklOSVNIJiZuIT09Q3AuWl9TWU5DX0ZMVVNIKXx8KCJzdHJpbmciPT09dGhpcy5vcHRpb25zLnRvPyhpPUVwLnV0Zjhib3JkZXIoYS5vdXRwdXQsYS5uZXh0X291dCksbz1hLm5leHRfb3V0LWkscz1FcC5idWYyc3RyaW5nKGEub3V0cHV0LGkpLGEubmV4dF9vdXQ9byxhLmF2YWlsX291dD1jLW8sbyYmQXAuYXJyYXlTZXQoYS5vdXRwdXQsYS5vdXRwdXQsaSxvLDApLHRoaXMub25EYXRhKHMpKTp0aGlzLm9uRGF0YShBcC5zaHJpbmtCdWYoYS5vdXRwdXQsYS5uZXh0X291dCkpKSksMD09PWEuYXZhaWxfaW4mJjA9PT1hLmF2YWlsX291dCYmKGw9ITApfXdoaWxlKChhLmF2YWlsX2luPjB8fDA9PT1hLmF2YWlsX291dCkmJnIhPT1DcC5aX1NUUkVBTV9FTkQpO3JldHVybiByPT09Q3AuWl9TVFJFQU1fRU5EJiYobj1DcC5aX0ZJTklTSCksbj09PUNwLlpfRklOSVNIPyhyPXhwLmluZmxhdGVFbmQodGhpcy5zdHJtKSx0aGlzLm9uRW5kKHIpLHRoaXMuZW5kZWQ9ITAscj09PUNwLlpfT0spOm4hPT1DcC5aX1NZTkNfRkxVU0h8fCh0aGlzLm9uRW5kKENwLlpfT0spLGEuYXZhaWxfb3V0PTAsITApfSxOcC5wcm90b3R5cGUub25EYXRhPWZ1bmN0aW9uKHQpe3RoaXMuY2h1bmtzLnB1c2godCl9LE5wLnByb3RvdHlwZS5vbkVuZD1mdW5jdGlvbih0KXt0PT09Q3AuWl9PSyYmKCJzdHJpbmciPT09dGhpcy5vcHRpb25zLnRvP3RoaXMucmVzdWx0PXRoaXMuY2h1bmtzLmpvaW4oIiIpOnRoaXMucmVzdWx0PUFwLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9LEdmLkluZmxhdGU9TnAsR2YuaW5mbGF0ZT1ScCxHZi5pbmZsYXRlUmF3PWZ1bmN0aW9uKHQsZSl7cmV0dXJuKGU9ZXx8e30pLnJhdz0hMCxScCh0LGUpfSxHZi51bmd6aXA9UnA7dmFyIHpwPXt9OygwLGhkLmFzc2lnbikoenAsZGQsR2YsT3ApO3ZhciBEcD1lKHpwKTtsZXQgUHA9MTtjb25zdCBNcD0iX19ydGNfdW1kX25hbWVfXyIsVXA9KCk9PndpbmRvdy5pbmRleGVkREJ8fHdpbmRvdy5tb3pJbmRleGVkREJ8fHdpbmRvdy53ZWJraXRJbmRleGVkREJ8fHdpbmRvdy5tc0luZGV4ZWREQjtjbGFzcyBGcHtjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJzdG9yZU5hbWUiLHZvaWQgMCksbGwodGhpcywicGVuZGluZ0xpc3QiLFtdKSx0aGlzLnN0b3JlTmFtZT10LCFCbCgpJiZVcCgpJiZ0aGlzLl9jaGVja0FuZENyZWF0ZVN0b3JlKHQpfWFzeW5jIF9jaGVja0FuZENyZWF0ZVN0b3JlKHQsZSl7Y29uc3Qgcj1hd2FpdCBGcC5fcHJvbWlzZUxvY2subG9jaygpO2lmKFVwKCkuZGF0YWJhc2VzKXtsZXQgdDthd2FpdCBuZXcgUHJvbWlzZSgoZT0+e2NvbnN0IHI9KCk9PlVwKCkuZGF0YWJhc2VzKCkuZmluYWxseShlKTt0PXNldEludGVydmFsKHIsMTAwKSxyKCl9KSkuZmluYWxseSgoKCk9PmNsZWFySW50ZXJ2YWwodCkpKX1yZXR1cm4gbmV3IFByb21pc2UoKG49PntGcC5kYiYmKEZwLmRiLmNsb3NlKCksZGVsZXRlIEZwLmRiKTtjb25zdCBpPWU/VXAoKS5vcGVuKE1wLGUpOlVwKCkub3BlbihNcCk7aS5vbnVwZ3JhZGVuZWVkZWQ9KCk9PntpLnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZSh0KX0saS5vbmVycm9yPSgpPT57Y29uc29sZS5lcnJvcigiSW5kZXhlZERCSW50ZXJmYWNlIGVycm9yIixpLmVycm9yKX0saS5vbnN1Y2Nlc3M9KCk9Pntjb25zdCBlPWkucmVzdWx0O0ZwLmRiPWU7dHJ5e0ZwLmRiLnRyYW5zYWN0aW9uKHRoaXMuc3RvcmVOYW1lLCJyZWFkb25seSIpLHRoaXMucGVuZGluZ0xpc3QuZm9yRWFjaCgoYXN5bmMgdD0+e2xldHt0eE1vZGU6ZSxwZW5kUmVzb2x2ZTpyLHBlbmRSZWplY3Q6bn09dDt0cnl7cihhd2FpdCB0aGlzLl9nZXRTdG9yZShlKSl9Y2F0Y2goaSl7bigpfX0pKSxuKCl9Y2F0Y2gobyl7bih0aGlzLl9jaGVja0FuZENyZWF0ZVN0b3JlKHQsZS52ZXJzaW9uKzEpKX1maW5hbGx5e3IoKX19fSkpfWFzeW5jIF9nZXRTdG9yZSh0KXtjb25zdCBlPWF3YWl0IEZwLl9wcm9taXNlTG9jay5sb2NrKCk7cmV0dXJuIG5ldyBQcm9taXNlKCgocixuKT0+e2lmKCFGcC5kYilyZXR1cm4gdGhpcy5wZW5kaW5nTGlzdC5wdXNoKHt0eE1vZGU6dCxwZW5kUmVzb2x2ZTpyLHBlbmRSZWplY3Q6bn0pLHZvaWQgZSgpO3RyeXtyKEZwLmRiLnRyYW5zYWN0aW9uKHRoaXMuc3RvcmVOYW1lLHQpLm9iamVjdFN0b3JlKHRoaXMuc3RvcmVOYW1lKSl9Y2F0Y2goaSl7cmV0dXJuIHZvaWQgdGhpcy5wZW5kaW5nTGlzdC5wdXNoKHt0eE1vZGU6dCxwZW5kUmVzb2x2ZTpyLHBlbmRSZWplY3Q6bn0pfWZpbmFsbHl7ZSgpfX0pKX1hc3luYyBwdXQyU3RyaW5nKHQsZSl7bGV0IHI7dHJ5e3I9SlNPTi5zdHJpbmdpZnkodCl9Y2F0Y2gobil7cj10fXJldHVybiBhd2FpdCB0aGlzLnB1dChyLGUpfWFzeW5jIGdldDRTdHJpbmcodCl7Y29uc3QgZT1hd2FpdCB0aGlzLmdldCh0KTtsZXQgcjt0cnl7cj1KU09OLnBhcnNlKGUpfWNhdGNoKG4pe3I9ZX1yZXR1cm4gcn1hc3luYyBwdXQodCxlKXtjb25zdCByPWF3YWl0IHRoaXMuX2dldFN0b3JlKCJyZWFkd3JpdGUiKTtyZXR1cm4gbmV3IFByb21pc2UoKChuLGkpPT57Y29uc3Qgbz1yLnB1dCh0LGUpO28ub25zdWNjZXNzPSgpPT57bigpfSxvLm9uZXJyb3I9dD0+e2kodCl9fSkpfWFzeW5jIGdldCh0KXtjb25zdCBlPWF3YWl0IHRoaXMuX2dldFN0b3JlKCJyZWFkb25seSIpO3JldHVybiBuZXcgUHJvbWlzZSgoKHIsbik9Pntjb25zdCBpPWUuZ2V0KHQpO2kub25zdWNjZXNzPSgpPT57cihpLnJlc3VsdCl9LGkub25lcnJvcj10PT57bih0KX19KSl9YXN5bmMgZGVsKHQpe2NvbnN0IGU9YXdhaXQgdGhpcy5fZ2V0U3RvcmUoInJlYWR3cml0ZSIpO3JldHVybiBuZXcgUHJvbWlzZSgoKHIsbik9Pntjb25zdCBpPWUuZGVsZXRlKHQpO2kub25zdWNjZXNzPSgpPT57cigpfSxpLm9uZXJyb3I9dD0+e24odCl9fSkpfX1sbChGcCwiZGIiLHZvaWQgMCksbGwoRnAsInN0YXRlIiwiaW5pdCIpLGxsKEZwLCJfcHJvbWlzZUxvY2siLG5ldyBjbGFzc3tjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJsb2NraW5nUHJvbWlzZSIsUHJvbWlzZS5yZXNvbHZlKCkpLGxsKHRoaXMsImxvY2tzIiwwKSxsbCh0aGlzLCJuYW1lIiwiIiksbGwodGhpcywibG9ja0lkIix2b2lkIDApLHRoaXMubG9ja0lkPVBwKyssdCYmKHRoaXMubmFtZT10KX1nZXQgaXNMb2NrZWQoKXtyZXR1cm4gdGhpcy5sb2Nrcz4wfWxvY2soKXtsZXQgdDt0aGlzLmxvY2tzKz0xO2NvbnN0IGU9bmV3IFByb21pc2UoKGU9Pnt0PSgpPT57dGhpcy5sb2Nrcy09MSxlKCl9fSkpLHI9dGhpcy5sb2NraW5nUHJvbWlzZS50aGVuKCgoKT0+dCkpO3JldHVybiB0aGlzLmxvY2tpbmdQcm9taXNlPXRoaXMubG9ja2luZ1Byb21pc2UudGhlbigoKCk9PmUpKSxyfX0oImlEQiIpKTt2YXIganA9c2kuaW5jbHVkZXM7Q3Ioe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDpzKChmdW5jdGlvbigpe3JldHVybiFBcnJheSgxKS5pbmNsdWRlcygpfSkpfSx7aW5jbHVkZXM6ZnVuY3Rpb24odCl7cmV0dXJuIGpwKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIEhwPXBsKCJBcnJheSIsImluY2x1ZGVzIiksS3A9ZnVuY3Rpb24odCl7dmFyIGU7cmV0dXJuIF9sKHQpJiYodm9pZCAwIT09KGU9dFttbF0pPyEhZToiUmVnRXhwIj09PWdsKHQpKX0sSnA9VHlwZUVycm9yLFdwPWRlKCJtYXRjaCIpLFpwPUNyLEdwPWZ1bmN0aW9uKHQpe2lmKEtwKHQpKXRocm93IG5ldyBKcCgiVGhlIG1ldGhvZCBkb2Vzbid0IGFjY2VwdCByZWd1bGFyIGV4cHJlc3Npb25zIik7cmV0dXJuIHR9LFZwPUcsJHA9WW4sWHA9ZnVuY3Rpb24odCl7dmFyIGU9Ly4vO3RyeXsiLy4vIlt0XShlKX1jYXRjaChyKXt0cnl7cmV0dXJuIGVbV3BdPSExLCIvLi8iW3RdKGUpfWNhdGNoKG4pe319cmV0dXJuITF9LFlwPW0oIiIuaW5kZXhPZik7WnAoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6IVhwKCJpbmNsdWRlcyIpfSx7aW5jbHVkZXM6ZnVuY3Rpb24odCl7cmV0dXJuISF+WXAoJHAoVnAodGhpcykpLCRwKEdwKHQpKSxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIHFwPXBsKCJTdHJpbmciLCJpbmNsdWRlcyIpLFFwPW90LHRfPUhwLGVfPXFwLHJfPUFycmF5LnByb3RvdHlwZSxuXz1TdHJpbmcucHJvdG90eXBlLGlfPWUoKGZ1bmN0aW9uKHQpe3ZhciBlPXQuaW5jbHVkZXM7cmV0dXJuIHQ9PT1yX3x8UXAocl8sdCkmJmU9PT1yXy5pbmNsdWRlcz90Xzoic3RyaW5nIj09dHlwZW9mIHR8fHQ9PT1uX3x8UXAobl8sdCkmJmU9PT1uXy5pbmNsdWRlcz9lXzplfSkpO2Z1bmN0aW9uIG9fKHQsZSl7aWYobnVsbD09dClyZXR1cm57fTt2YXIgcixuLGk9ZnVuY3Rpb24odCxlKXtpZihudWxsPT10KXJldHVybnt9O3ZhciByPXt9O2Zvcih2YXIgbiBpbiB0KWlmKHt9Lmhhc093blByb3BlcnR5LmNhbGwodCxuKSl7aWYoaV8oZSkuY2FsbChlLG4pKWNvbnRpbnVlO3Jbbl09dFtuXX1yZXR1cm4gcn0odCxlKTtpZihKbCl7dmFyIG89SmwodCk7Zm9yKG49MDtuPG8ubGVuZ3RoO24rKylyPW9bbl0saV8oZSkuY2FsbChlLHIpfHx7fS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHQscikmJihpW3JdPXRbcl0pfXJldHVybiBpfWNvbnN0IHNfPVsibWVzc2FnZSJdO3ZhciBhXyxjXyx1Xz1uZXcgY2xhc3N7Y29uc3RydWN0b3IoKXtsbCh0aGlzLCJuYW1lIiwiTG9uZ1N0cmluZ1JlcG9ydG9yIiksbGwodGhpcywiaW5CdWZmZXIiLFtdKSxsbCh0aGlzLCJvdXRCdWZmZXIiLFtdKX1wdXNoKHQpe3QubWVzc2FnZSYmdGhpcy5pbkJ1ZmZlci5wdXNoKCRoKCRoKHt9LHQpLHt9LHttZXNzYWdlOntpZDpUbCgpLnNsaWNlKDAsMyksaW5kZXg6MCxlbmQ6ITAsbXNnOnQubWVzc2FnZX19KSl9c3BsaWNlKHQpe2NvbnN0IGU9W107bGV0IHI9MDtmb3IoO3RoaXMub3V0QnVmZmVyLmxlbmd0aDspe2NvbnN0IG49SlNPTi5zdHJpbmdpZnkodGhpcy5vdXRCdWZmZXJbMF0pLmxlbmd0aDtpZighKG48dCkpYnJlYWs7dC09bixyKz1uLGUucHVzaCh0aGlzLm91dEJ1ZmZlci5zaGlmdCgpKX1mb3IoO3RoaXMuaW5CdWZmZXJbMF0mJnQ+MDspe2NvbnN0IG49dGhpcy5pbkJ1ZmZlclswXSx7bWVzc2FnZTppfT1uLG89JGgoJGgoe30sb18obixzXykpLHt9LHttZXNzYWdlOiRoKCRoKHt9LGkpLHt9LHttc2c6IiJ9KX0pLHM9SlNPTi5zdHJpbmdpZnkobykubGVuZ3RoLGE9dC1zLGM9JGgoe30sbyk7aWYoYT5pLm1zZy5sZW5ndGgpYy5tZXNzYWdlLm1zZz1pLm1zZyx0aGlzLmluQnVmZmVyLnNoaWZ0KCk7ZWxzZXtpZighKGE+PTEwKSlicmVhazt7Y29uc3QgdD1pLm1zZy5zbGljZSgwLGEpO2MubWVzc2FnZS5tc2c9dCxjLm1lc3NhZ2UuZW5kPSExLHRoaXMuaW5CdWZmZXJbMF0ubWVzc2FnZS5tc2c9aS5tc2cuc2xpY2UoYSksdGhpcy5pbkJ1ZmZlclswXS5tZXNzYWdlLmluZGV4Kyt9fWNvbnN0IHU9SlNPTi5zdHJpbmdpZnkoYy5tZXNzYWdlKSxsPXUubGVuZ3RoO3QtPWwrcyxyKz1sK3MsZS5wdXNoKCRoKCRoKHt9LGMpLHt9LHttZXNzYWdlOnV9KSl9cmV0dXJue3BheWxvYWQ6ZSxwYXlsb2FkU2l6ZTpyfX11bnNoaWZ0KHQpe3RoaXMub3V0QnVmZmVyPXQuY29uY2F0KHRoaXMub3V0QnVmZmVyKX1nZXQoKXtyZXR1cm5bLi4udGhpcy5vdXRCdWZmZXIsLi4udGhpcy5pbkJ1ZmZlci5tYXAoKHQ9PiRoKCRoKHt9LHQpLHt9LHttZXNzYWdlOkpTT04uc3RyaW5naWZ5KHQubWVzc2FnZSl9KSkpXX1zZXQodCl7dC5mb3JFYWNoKCh0PT57IWZ1bmN0aW9uKHQpe3JldHVybiB2b2lkIDAhPT10LnJlcG9ydF9pZH0odCk/KHQubWVzc2FnZXx8KHQubWVzc2FnZT0iIiksdGhpcy5pbkJ1ZmZlci5wdXNoKCRoKCRoKHt9LHQpLHt9LHttZXNzYWdlOkpTT04ucGFyc2UodC5tZXNzYWdlKX0pKSk6dGhpcy5vdXRCdWZmZXIucHVzaCh0KX0pKSx0aGlzLm91dEJ1ZmZlcj1bXS5jb25jYXQodGhpcy5vdXRCdWZmZXIpLHRoaXMuaW5CdWZmZXI9W10uY29uY2F0KHRoaXMuaW5CdWZmZXIpfWlzRW1wdHkoKXtyZXR1cm4gMD09PXRoaXMuaW5CdWZmZXIubGVuZ3RoJiYwPT09dGhpcy5vdXRCdWZmZXIubGVuZ3RofX07Y29uc3QgbF89NWU1LGhfPXtwcm9kdWN0X2xpbmU6InJ0YyIscmVwb3J0X3ZlcnNpb246IjUiLG9zOiJ3ZWIiLHVzZXJfYWdlbnQ6QmwoKT8iIjpudWxsPT09KGFfPW5hdmlnYXRvcil8fHZvaWQgMD09PWFfP3ZvaWQgMDphXy51c2VyQWdlbnQscGxhdGZvcm06IndlYiIscHJvZHVjdDoid2VicnRjIixhcHBfc3RhdGU6ImFjdGl2ZSJ9LGRfPSJMb2dSZXBvcnRvciIsZl89InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJih3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluY2x1ZGVzKCJfcnRjX2RlYnVnXyIpfHwobnVsbD09PShjXz13aW5kb3cubG9jYWxTdG9yYWdlKXx8dm9pZCAwPT09Y18/dm9pZCAwOmNfLmdldEl0ZW0oIl9ydGNfZGVidWdfIikpKTtjbGFzcyBwX3tjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJfYnVmZmVyIix2b2lkIDApLHRoaXMuX2J1ZmZlcj1uZXcgRnAodCl9YXN5bmMgc2V0KHQsZSl7YXdhaXQgdGhpcy5fYnVmZmVyLnB1dDJTdHJpbmcodCxlKX1hc3luYyBnZXQodCl7dmFyIGU7bGV0IHI9W107dHJ5e3I9YXdhaXQgdGhpcy5fYnVmZmVyLmdldDRTdHJpbmcodCl9Y2F0Y2gobil7fXJldHVybiBudWxsIT09KGU9cikmJnZvaWQgMCE9PWU/ZTpbXX19dmFyIF9fPW5ldyBjbGFzc3tjb25zdHJ1Y3Rvcigpe2xsKHRoaXMsInJlcG9ydENvbW1vbiIsaF8pLGxsKHRoaXMsInJlcG9ydElkcyIsbmV3IE1hcCksbGwodGhpcywiZGF0YUJ1ZmZlciIsW10pLGxsKHRoaXMsInJlcG9ydG9yTGlzdCIsW10pLGxsKHRoaXMsImRiQnVmZmVyIix2b2lkIDApLGxsKHRoaXMsInBvc3RpbmciLCExKSxsbCh0aGlzLCJzdWNTZW5kVGltZXIiLHZvaWQgMCksbGwodGhpcywicHJlU3VjVGltZSIsMCksbGwodGhpcywiZXJyU2VuZFRpbWVyIix2b2lkIDApLGxsKHRoaXMsImVyclNlbmREZWxheSIsMTAwKSxsbCh0aGlzLCJfbG9nU2VydmVyVXJsIix2b2lkIDApLGxsKHRoaXMsIl9yZXRyeUNvdW50IiwwKSxsbCh0aGlzLCJfcmVwb3J0TGltaXQiLGxfKSxsbCh0aGlzLCJfZGlzYWJsZVRpbWVvdXQiLCExKSxCbCgpfHwod2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsKCgpPT57Y2xlYXJUaW1lb3V0KHRoaXMuZXJyU2VuZFRpbWVyKSxjbGVhclRpbWVvdXQodGhpcy5zdWNTZW5kVGltZXIpLHRoaXMuc2VuZCh2b2lkIDAsITApfSkpLGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInZpc2liaWxpdHljaGFuZ2UiLCgoKT0+eyJ2aXNpYmxlIj09PWRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZT90aGlzLnNldENvbW1vblN0YXRzKHthcHBfc3RhdGU6ImFjdGl2ZSJ9KToiaGlkZGVuIj09PWRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSYmdGhpcy5zZXRDb21tb25TdGF0cyh7YXBwX3N0YXRlOiJiYWNrZ3JvdW5kIn0pfSkpLGZfJiYod2luZG93Ll9fcnRjX2RlYnVnX3JlcG9ydG9yX189dGhpcykpLEZsLm9uKCJVUExPQURfUkVQT1JUX0xJTUlUIiwodD0+e3RoaXMuc2V0UmVwb3J0TGltaXQodCl9KSksRmwub24oIkVOQUJMRV9SRVBPUlRfSURCX0JVRkZFUiIsKHQ9Pnt0JiZ0aGlzLmVuYWJsZUluZGV4ZWREQkJ1ZmZlcigpfSkpLHNldFRpbWVvdXQoKCgpPT57dGhpcy5yZXBvcnRvckxpc3QucHVzaChPXyksdGhpcy5yZXBvcnRvckxpc3QucHVzaCh1Xyl9KSl9c2V0VXJsKHQpe3RoaXMuX2xvZ1NlcnZlclVybD10fXNldENvbW1vblN0YXRzKHQpe3RoaXMucmVwb3J0Q29tbW9uPU9iamVjdC5hc3NpZ24odGhpcy5yZXBvcnRDb21tb24sdCl9Z2V0Q29tbW9uU3RhdHMoKXtyZXR1cm4gdGhpcy5yZXBvcnRDb21tb259c2V0UmVwb3J0TGltaXQodCl7dGhpcy5fcmVwb3J0TGltaXQ9TWF0aC5tYXgodCw1ZTQpLHRoaXMuX3JlcG9ydExpbWl0PU1hdGgubWluKHQsNWU1KX1nZXRSZXBvcnRJZCh0KXt2YXIgZTt0PW51bGwhPT0oZT10KSYmdm9pZCAwIT09ZT9lOiJfX2dsb2JhbF9fIix0aGlzLnJlcG9ydElkcy5oYXModCl8fHRoaXMucmVwb3J0SWRzLnNldCh0LDApO2xldCByPXRoaXMucmVwb3J0SWRzLmdldCh0KTtyZXR1cm4gdm9pZCAwPT09ciYmKHlfKCJubyByZXBvcnRJZCBpbiByZXBvcnRJZCBtYXAgd2l0aCBlbmdpbmUtc2Vzc2lvbi1pZCAiLmNvbmNhdCh0KSwwLHt9KSxyPTApLHRoaXMucmVwb3J0SWRzLnNldCh0LHIrMSkscn1wdXNoKHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdJiZhcmd1bWVudHNbMV0pdGhpcy5zZW5kKHQpO2Vsc2V7dmFyIGU7Y29uc3Qgcj1udWxsIT09KGU9dC5lbmdpbmVfc2Vzc2lvbl9pZCkmJnZvaWQgMCE9PWU/ZToiX19nbG9iYWxfXyI7dGhpcy5yZXBvcnRJZHMuaGFzKHIpfHx0aGlzLnJlcG9ydElkcy5zZXQociwwKSx0aGlzLmRhdGFCdWZmZXIucHVzaCh0KSwhdGhpcy5wb3N0aW5nJiYhdGhpcy5lcnJTZW5kVGltZXImJkRhdGUubm93KCktdGhpcy5wcmVTdWNUaW1lPjJlMyYmKGNsZWFyVGltZW91dCh0aGlzLnN1Y1NlbmRUaW1lciksdGhpcy5zZW5kKCkpfX1lbmFibGVJbmRleGVkREJCdWZmZXIoKXt0aGlzLmRiQnVmZmVyfHwodGhpcy5kYkJ1ZmZlcj1uZXcgcF8oIlJlcG9ydG9yREJCdWZmZXIiKSx0aGlzLmRiQnVmZmVyLmdldChkXykudGhlbigodD0+e3QuZm9yRWFjaCgodD0+e3RoaXMucHVzaCh0KX0pKX0pKSx0aGlzLnJlcG9ydG9yTGlzdC5mb3JFYWNoKCh0PT57dmFyIGU7bnVsbD09PShlPXRoaXMuZGJCdWZmZXIpfHx2b2lkIDA9PT1lfHxlLmdldCh0Lm5hbWUpLnRoZW4oKGU9Pnt0LnNldChlKX0pKX0pKSl9YmFja3VwKCl7dHJ5e3ZhciB0O251bGw9PT0odD10aGlzLmRiQnVmZmVyKXx8dm9pZCAwPT09dHx8dC5zZXQoWy4uLnRoaXMuZGF0YUJ1ZmZlcl0sZF8pLHRoaXMucmVwb3J0b3JMaXN0LmZvckVhY2goKHQ9Pnt2YXIgZTtudWxsPT09KGU9dGhpcy5kYkJ1ZmZlcil8fHZvaWQgMD09PWV8fGUuc2V0KFsuLi50LmdldCgpXSx0Lm5hbWUpfSkpfWNhdGNoKGUpe3lfKCJFcnJvciB3aGVuIHNhdmUgbG9nIGludG8gSURCIiwtMSxlKX19dW5zaGlmdCh0KXt0aGlzLmRhdGFCdWZmZXI9dFswXS5jb25jYXQodGhpcy5kYXRhQnVmZmVyKSx0aGlzLnJlcG9ydG9yTGlzdC5mb3JFYWNoKCgoZSxyKT0+e3ZhciBuO2UudW5zaGlmdChudWxsIT09KG49dFtyKzFdKSYmdm9pZCAwIT09bj9uOltdKX0pKX1fc3BsaWNlKCl7bGV0IHQ9ZnVuY3Rpb24odCxlKXtsZXQgcj0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWlmKHIrPUpTT04uc3RyaW5naWZ5KHRbbl0pLmxlbmd0aCxyPmUpcmV0dXJuIG47cmV0dXJuIHQubGVuZ3RofSh0aGlzLmRhdGFCdWZmZXIsdGhpcy5fcmVwb3J0TGltaXQpOzA9PT10JiZ0aGlzLmRhdGFCdWZmZXIubGVuZ3RoPjAmJih0aGlzLl9yZXBvcnRMaW1pdD1KU09OLnN0cmluZ2lmeSh0aGlzLmRhdGFCdWZmZXJbMF0pLmxlbmd0aCsxMCx0PTEseV8oInVwZGF0ZSByZXBvcnQgbGltaXQgdG8gIi5jb25jYXQodGhpcy5fcmVwb3J0TGltaXQpLDAsbnVsbCkpO2NvbnN0IGU9dGhpcy5kYXRhQnVmZmVyLnNwbGljZSgwLHQpLHI9SlNPTi5zdHJpbmdpZnkoZSkubGVuZ3RoLG49W2VdO2xldCBpPXRoaXMuX3JlcG9ydExpbWl0LXI7cmV0dXJuIHRoaXMucmVwb3J0b3JMaXN0LmZvckVhY2goKHQ9Pntjb25zdHtwYXlsb2FkOmUscGF5bG9hZFNpemU6cn09dC5zcGxpY2UoaSk7ZS5mb3JFYWNoKCh0PT57dmFyIGUscixuO3ZvaWQgMD09PXQucmVwb3J0X2lkJiYodC5yZXBvcnRfaWQ9dGhpcy5nZXRSZXBvcnRJZCh0LmVuZ2luZV9zZXNzaW9uX2lkKSwhQmwoKSYmd2luZG93Ll9fb25SVENSZXBvcnQmJihudWxsPT09KGU9KHI9d2luZG93KS5fX29uUlRDUmVwb3J0KXx8dm9pZCAwPT09ZXx8ZS5jYWxsKHIsbnVsbCE9PShuPXQuZW5naW5lX3Nlc3Npb25faWQpJiZ2b2lkIDAhPT1uP246Imdsb2JhbCIsdCx0aGlzLmdldENvbW1vblN0YXRzKCkpKSl9KSksbi5wdXNoKGUpLGktPXJ9KSksbn1hc3luYyBzZW5kKHQsZSl7dGhpcy5iYWNrdXAoKTtjb25zdCByPXRoaXMucmVwb3J0b3JMaXN0LnJlZHVjZSgoKHQsZSk9PnQmJmUuaXNFbXB0eSgpKSwhMCk7aWYoIXQmJiF0aGlzLmRhdGFCdWZmZXIubGVuZ3RoJiZyfHwhdGhpcy5fbG9nU2VydmVyVXJsKXJldHVybjt0fHwodGhpcy5wb3N0aW5nPSEwKTtsZXQgbj1bXTt0fHwobj10aGlzLl9zcGxpY2UoKSk7Y29uc3QgaT1mXyxvPXtkYXRhOnR8fGxkKG4pLmNhbGwobiksaGVhZGVyOiRoKCRoKHt9LHRoaXMucmVwb3J0Q29tbW9uKSx7fSx7aHR0cF9yZXRyeV9jb3VudDp0aGlzLl9yZXRyeUNvdW50fSksZnJvbToid2ViIixvczoid2ViIix2ZXJzaW9uOiIxIn0scz17bWV0aG9kOiJQT1NUIixib2R5Omk/SlNPTi5zdHJpbmdpZnkobyk6RHAuZ3ppcChKU09OLnN0cmluZ2lmeShvKSl9O2lmKCF0aGlzLl9kaXNhYmxlVGltZW91dCl0cnl7Y29uc3QgdD1uZXcgQWJvcnRDb250cm9sbGVyO3Muc2lnbmFsPXQuc2lnbmFsLHNldFRpbWVvdXQoKCgpPT57dC5hYm9ydCgpfSksMWU0KX1jYXRjaChsKXtjb25zb2xlLndhcm4oIkFib3J0Q29udHJvbGxlciBpcyBub3Qgc3VwcG9ydGVkIiksdGhpcy5fZGlzYWJsZVRpbWVvdXQ9ITB9aXx8KHMuaGVhZGVycz17IkNvbnRlbnQtRW5jb2RpbmciOiJnemlwIiwiQ29udGVudC1UeXBlIjoiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04In0pO2xldCBhLGMsdT1udWxsO3RyeXthPWF3YWl0IGZldGNoKHRoaXMuX2xvZ1NlcnZlclVybCxzKSwyMDAhPT1hLnN0YXR1cyYmMzA0IT09YS5zdGF0dXN8fCh1PUpTT04ucGFyc2UoYXdhaXQgYS50ZXh0KCkpKX1jYXRjaChoKXtjPWh9dHx8KHRoaXMucG9zdGluZz0hMSksdSYmMD09PXUuU3RhdHVzQ29kZT90fHxlfHx0aGlzLnN1Y1NlbmQoKTooc2V0VGltZW91dCgoKCk9Pnt2YXIgdCxlLHI7eV8oInJlcG9ydG9yIHBvc3QgZXJyb3IsIHJlc0pTT046Ii5jb25jYXQobnVsbD09PSh0PXUpfHx2b2lkIDA9PT10P3ZvaWQgMDp0LnRvU3RyaW5nKCksIiBlcnI6IikuY29uY2F0KGMpLG51bGwhPT0oZT1udWxsPT09KHI9YSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuc3RhdHVzKSYmdm9pZCAwIT09ZT9lOi0xLGMpfSksMCksdD90aGlzLnNlbmQodCk6KHRoaXMudW5zaGlmdChuKSxlP3RoaXMuc2VuZCgpOnRoaXMuZXJyU2VuZCgpKSl9X2dldERhdGFCdWZmZXJUb3RhbFNpemUoKXtyZXR1cm4gdGhpcy5kYXRhQnVmZmVyLnJlZHVjZSgoKHQsZSk9PnQrSlNPTi5zdHJpbmdpZnkoZSkubGVuZ3RoKSwwKX1zdWNTZW5kKCl7dGhpcy5lcnJTZW5kRGVsYXk9MTAwLHRoaXMuX3JldHJ5Q291bnQ9MCx0aGlzLnByZVN1Y1RpbWU9RGF0ZS5ub3coKTtjb25zdCB0PXRoaXMuX2dldERhdGFCdWZmZXJUb3RhbFNpemUoKT4xZTY/MWUzOjJlMzt0aGlzLnN1Y1NlbmRUaW1lcj1zZXRUaW1lb3V0KCgoKT0+dGhpcy5zZW5kKCkpLHQpfWVyclNlbmQoKXt0aGlzLmVyclNlbmRUaW1lcj1zZXRUaW1lb3V0KCgoKT0+e3RoaXMuc2VuZCgpLGRlbGV0ZSB0aGlzLmVyclNlbmRUaW1lcn0pLHRoaXMuZXJyU2VuZERlbGF5KSx0aGlzLmVyclNlbmREZWxheSo9Mix0aGlzLl9yZXRyeUNvdW50Kyt9fTtjbGFzcyBnX3tjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJfcHJlVGltZSIsRGF0ZS5ub3coKSksbGwodGhpcywiX29uZTJvbmVOdW0iLDApLGxsKHRoaXMsIl9vbmUybWFueU51bSIsMCksbGwodGhpcywiX29uZTJvbmVNc2dDYWNoZSIsbmV3IE1hcCksbGwodGhpcywiX29uZTJtYW55TXNnQ2FjaGUiLG5ldyBNYXApLGxsKHRoaXMsInJvb21JZCIsIiIpLGxsKHRoaXMsInVzZXJJZCIsIiIpLGxsKHRoaXMsInJ0c1Nlc3Npb25JZCIsIiIpLGxsKHRoaXMsImxvZ2dlciIsdm9pZCAwKSxsbCh0aGlzLCJzZXJ2ZXJVcmwiLCJzZXJ2ZXIiKSx0aGlzLmlkPXQsdGhpcy5sb2dnZXI9bmV3IHpfKCJNZXNzYWdlUmVwb3J0b3IiLDEpfW5lZWRSZXBvcnQodCl7cmV0dXJuISFnXy5jb25maWcmJihEYXRlLm5vdygpLXRoaXMuX3ByZVRpbWU+PTM2ZTUmJih0aGlzLl9wcmVUaW1lPURhdGUubm93KCksdGhpcy5fb25lMm9uZU51bT0wLHRoaXMuX29uZTJtYW55TnVtPTApLCJvbmUyb25lIj09PXQmJnRoaXMuX29uZTJvbmVOdW08Z18uY29uZmlnLm1heF9vbmUyb25lX2ZwdF9wZXJfaG91ciYmTWF0aC5yYW5kb20oKTw9Z18uY29uZmlnLm9uZTJvbmVfZnB0X3JhdGlvLzEwMHx8Im9uZTJtYW55Ij09PXQmJnRoaXMuX29uZTJtYW55TnVtPGdfLmNvbmZpZy5tYXhfb25lMm1hbnlfZnB0X3Blcl9ob3VyJiZNYXRoLnJhbmRvbSgpPD1nXy5jb25maWcub25lMm1hbnlfZnB0X3JhdGlvLzEwMCl9Y2FjaGVQMlBNc2codCl7dmFyIGU7dGhpcy5fb25lMm9uZU1zZ0NhY2hlLnNldCh0Lm1zZ19pZCwkaCh7Y29uZmlnX3ZlcnNpb246KG51bGw9PT0oZT1nXy5jb25maWcpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLnZlcnNpb24pfHwiIn0sdCkpfXVwZGF0ZVAyUE1zZyh0LGUpe2NvbnN0IHI9dGhpcy5fb25lMm9uZU1zZ0NhY2hlLmdldCh0KTtyJiZ0aGlzLl9vbmUyb25lTXNnQ2FjaGUuc2V0KHQsJGgoJGgoe30sciksZSkpfWNhY2hlQ3VzdG9tTXNnKHQpe3ZhciBlO3RoaXMuX29uZTJtYW55TXNnQ2FjaGUuc2V0KHQubXNnX2lkLCRoKHtjb25maWdfdmVyc2lvbjoobnVsbD09PShlPWdfLmNvbmZpZyl8fHZvaWQgMD09PWU/dm9pZCAwOmUudmVyc2lvbil8fCIifSx0KSl9dXBkYXRlT25lMk1hbnlNc2codCxlKXtjb25zdCByPXRoaXMuX29uZTJtYW55TXNnQ2FjaGUuZ2V0KHQpO3ImJnRoaXMuX29uZTJtYW55TXNnQ2FjaGUuc2V0KHQsJGgoJGgoe30sciksZSkpfXJlcG9ydFAyUE1zZyh0KXtjb25zdCBlPXRoaXMuX29uZTJvbmVNc2dDYWNoZS5nZXQodCk7dmFyIHI7ZSYmKHRoaXMubG9nZ2VyLmluZm8oInJlcG9ydFAyUE1zZyIsZS50eXBlLEpTT04uc3RyaW5naWZ5KGUpKSxudWxsPT09KHI9Yl8odGhpcy5pZCkpfHx2b2lkIDA9PT1yfHxyLnJlcG9ydCgicnRzX21lc3NhZ2UiLGUpKX1yZXBvcnRPbmUyTWFueU1zZyh0KXtjb25zdCBlPXRoaXMuX29uZTJtYW55TXNnQ2FjaGUuZ2V0KHQpO3ZhciByO2UmJih0aGlzLmxvZ2dlci5pbmZvKCJyZXBvcnRPbmUyTWFueU1zZyIsZS50eXBlLEpTT04uc3RyaW5naWZ5KGUpKSxudWxsPT09KHI9Yl8odGhpcy5pZCkpfHx2b2lkIDA9PT1yfHxyLnJlcG9ydCgicnRzX21lc3NhZ2UiLGUpKX1yZXBvcnRNc2dSZWN2KHQpe3ZhciBlLHI7dC5jb25maWdfdmVyc2lvbj0obnVsbD09PShlPWdfLmNvbmZpZyl8fHZvaWQgMD09PWU/dm9pZCAwOmUudmVyc2lvbil8fCIiLHRoaXMubG9nZ2VyLmluZm8oInJlcG9ydE1zZ1JlY3YiLHQudHlwZSxKU09OLnN0cmluZ2lmeSh0KSksbnVsbD09PShyPWJfKHRoaXMuaWQpKXx8dm9pZCAwPT09cnx8ci5yZXBvcnQoInJ0c19tZXNzYWdlIix0KX1kZXN0cm95KCl7dGhpcy5fb25lMm1hbnlOdW09MCx0aGlzLl9vbmUyb25lTnVtPTAsdGhpcy5fb25lMm1hbnlNc2dDYWNoZS5jbGVhcigpLHRoaXMuX29uZTJvbmVNc2dDYWNoZS5jbGVhcigpLHRoaXMuX3ByZVRpbWU9RGF0ZS5ub3coKSx0aGlzLnJvb21JZD0iIix0aGlzLnVzZXJJZD0iIix0aGlzLnJ0c1Nlc3Npb25JZD0iIn19bGwoZ18sImNvbmZpZyIsdm9pZCAwKTtjb25zdCBtXz1uZXcgY2xhc3N7Y29uc3RydWN0b3IodCl7bGwodGhpcywibW9kaWZ5SWRzIix7cHJlX2Nvbm5lY3Rpb246ITF9KSx0aGlzLmlkPXR9cmVwb3J0KHQsZSxyKXtjb25zdCBuPSRoKCRoKCRoKHtldmVudF9rZXk6dCxydGNfdGltZXN0YW1wOkRhdGUubm93KCl9LHRoaXMubW9kaWZ5SWRzKSxlKSx7fSx7cmVwb3J0X2lkOl9fLmdldFJlcG9ydElkKHRoaXMubW9kaWZ5SWRzLmVuZ2luZV9zZXNzaW9uX2lkKX0pO3ZhciBpLG87KCJvYmplY3QiPT10eXBlb2YgciYmT2JqZWN0LmtleXMocikubGVuZ3RoPjAmJihuLmNvbW1vbl9leHRyYV9pbmZvPUpTT04uc3RyaW5naWZ5KHIpKSxPYmplY3Qua2V5cyhuKS5mb3JFYWNoKCh0PT57dm9pZCAwIT09blt0XSYmIiIhPT1uW3RdfHxkZWxldGUgblt0XX0pKSwhQmwoKSYmd2luZG93Ll9fb25SVENSZXBvcnQpJiYobnVsbD09PShpPShvPXdpbmRvdykuX19vblJUQ1JlcG9ydCl8fHZvaWQgMD09PWl8fGkuY2FsbChvLHRoaXMubW9kaWZ5SWRzLmVuZ2luZV9zZXNzaW9uX2lkLG4sX18uZ2V0Q29tbW9uU3RhdHMoKSkpOyJVVCIhPT17fS5WSVRFX1RFU1QmJl9fLnB1c2gobil9cmVwb3J0TG9nKHQpe2NvbnN0IGU9JGgoJGgoe2V2ZW50X2tleToicnRjX2ludm9rZV9zdGF0dXMiLHNka19hcGlfbmFtZToiY29uc29sZV9sb2ciLHJ0Y190aW1lc3RhbXA6RGF0ZS5ub3coKX0sdGhpcy5tb2RpZnlJZHMpLHt9LHttZXNzYWdlOnR9KTtPXy5wdXNoKGUpfXJlcG9ydExvbmdTdHJpbmcodCxlKXtjb25zdCByPSRoKCRoKHtldmVudF9rZXk6InJ0Y19pbnZva2Vfc3RhdHVzIixzZGtfYXBpX25hbWU6InNka19sb25nX3N0cmluZ18iLmNvbmNhdCh0KSxydGNfdGltZXN0YW1wOkRhdGUubm93KCl9LHRoaXMubW9kaWZ5SWRzKSx7fSx7bWVzc2FnZTplfSk7dV8ucHVzaChyKX1zZXQodCl7dGhpcy5tb2RpZnlJZHM9T2JqZWN0LmFzc2lnbih0aGlzLm1vZGlmeUlkcyx0KX1kZXN0cm95KCl7fX0oImdsb2JhbCIpLHlfPSh0LGUscik9PnttXy5yZXBvcnQoInJ0Y19lcnJvciIse21lc3NhZ2U6dCxlcnJvcl9jb2RlOmV9LHIpfTtjb25zdCB2Xz1uZXcgTWFwLGJfPXQ9PnZfLmdldCh0KSx3Xz0idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmxvY2F0aW9uLnNlYXJjaC5pbmNsdWRlcygiX3J0Y191cGxvYWRfY29uc29sZV8iKTtmdW5jdGlvbiBTXyh0LGUpe3JldHVybiB0Lm1hcCgodD0+e2xldCByPSIiO3RyeXtpZigic3RyaW5nIj09dHlwZW9mIHQpcmV0dXJuIHQ7aWYodm9pZCAwPT09dClyZXR1cm4idW5kZWZpbmVkIjtpZihudWxsPT09dClyZXR1cm4ibnVsbCI7aWYodCBpbnN0YW5jZW9mIE1lZGlhU3RyZWFtVHJhY2spcmV0dXJuIExsKHQpO2lmKHQgaW5zdGFuY2VvZiBNZWRpYVN0cmVhbSlyZXR1cm4gbnVsbD09KGk9dCk/InVuZGVmaW5lZCB8IG51bGwiOiJzdHJpbmciPT10eXBlb2YgaT9pOkpTT04uc3RyaW5naWZ5KHtpZDppLmlkLGFjdGl2ZTppLmFjdGl2ZX0pO2lmKHQgaW5zdGFuY2VvZiBSVENSdHBTZW5kZXIpcmV0dXJuIE5sKHQpO2lmKHQgaW5zdGFuY2VvZiBSVENSdHBSZWNlaXZlcilyZXR1cm4gUmwodCk7aWYodCBpbnN0YW5jZW9mIFJUQ1J0cFRyYW5zY2VpdmVyKXJldHVybiBudWxsPT0obj10KT8idW5kZWZpbmVkIHwgbnVsbCI6InN0cmluZyI9PXR5cGVvZiBuP246SlNPTi5zdHJpbmdpZnkoe2N1cnJlbnREaXJlY3Rpb246bi5jdXJyZW50RGlyZWN0aW9uLGRpcmVjdGlvbjpuLmRpcmVjdGlvbixtaWQ6bi5taWQsc3RvcHBlZDpuLnN0b3BwZWQscmVjZWl2ZXI6Umwobi5yZWNlaXZlciksc2VuZGVyOk5sKG4uc2VuZGVyKX0pO3I9SlNPTi5zdHJpbmdpZnkodCl9Y2F0Y2gobyl7cj10LnRvU3RyaW5nKCl9dmFyIG4saTtyZXR1cm4gciYmci5sZW5ndGg+PWUmJihyPXIuc2xpY2UoMCxlKSkscn0pKS5qb2luKCIsICIpfXZhciBrXyxPXz1uZXcgY2xhc3N7Y29uc3RydWN0b3IoKXtsbCh0aGlzLCJuYW1lIiwiQ29uc29sZVJlcG9ydG9yIiksbGwodGhpcywiX3V1aWQiLCIiLmNvbmNhdChNYXRoLmZsb29yKDg5OSpNYXRoLnJhbmRvbSgpKSsxMDApKSxsbCh0aGlzLCJfY29uc29sZVJlcG9ydElkIiwwKSxsbCh0aGlzLCJfZW5naW5lUmVwb3J0SWRNYXAiLG5ldyBNYXApLGxsKHRoaXMsIl9lbmFibGVkIiwiTlVMTCIpLGxsKHRoaXMsIl9jb25zb2xlQ3V0TGVuZ3RoIixGbC5nZXRQYXJhbWV0ZXIoIlVQTE9BRF9DT05TT0xFX0xFTkdUSF9DVVQiKSksbGwodGhpcywiYnVmZmVyIixbXSksd18mJnNldFRpbWVvdXQoKCgpPT57dGhpcy5zd2l0Y2hPbigpfSksMCksRmwub24oIlVQTE9BRF9DT05TT0xFX09OIiwodD0+e3Q/dGhpcy5zd2l0Y2hPbigpOnRoaXMudHVybk9mZigpfSkpLEZsLm9uKCJVUExPQURfQ09OU09MRV9MRU5HVEhfQ1VUIiwodD0+e3RoaXMuX2NvbnNvbGVDdXRMZW5ndGg9dH0pKX1nZXQgZW5hYmxlZCgpe3JldHVybiJPRkYiIT09dGhpcy5fZW5hYmxlZH1zd2l0Y2hPbigpeyJOVUxMIj09PXRoaXMuX2VuYWJsZWQmJihjb25zb2xlLmxvZygiW0xvZ2dlclJlcG9ydG9yLmNvbnN0cnVjdG9yXSBjb25zb2xlIHVwbG9hZCBzd2l0Y2ggT04iKSx0aGlzLl9lbmFibGVkPSJPTiIpfXR1cm5PZmYoKXsiTlVMTCI9PT10aGlzLl9lbmFibGVkJiYoY29uc29sZS5sb2coIltMb2dnZXJSZXBvcnRvci5jb25zdHJ1Y3Rvcl0gY29uc29sZSB1cGxvYWQgc3dpdGNoIE9GRiIpLHRoaXMuX2VuYWJsZWQ9Ik9GRiIsdGhpcy5idWZmZXI9W10pfWdldEVuZ2luZUNvbnNvbGVJZCh0KXt2YXIgZTtjb25zdCByPW51bGwhPT0oZT10aGlzLl9lbmdpbmVSZXBvcnRJZE1hcC5nZXQodCkpJiZ2b2lkIDAhPT1lP2U6MDtyZXR1cm4gdGhpcy5fZW5naW5lUmVwb3J0SWRNYXAuc2V0KHQscisxKSxyfXJlcG9ydCh0LGUscixuLGksbyxzLGEsYyl7aWYoIk9GRiI9PT10aGlzLl9lbmFibGVkKXJldHVybjtjb25zdCB1PWJfKGUpLGw9dGhpcy5fY29uc29sZVJlcG9ydElkKyssaD10aGlzLmdldEVuZ2luZUNvbnNvbGVJZChlKSxkPVNfKGMsdGhpcy5fY29uc29sZUN1dExlbmd0aCksZj1bLi4uY10scD0iIi5jb25jYXQoYSkucmVwbGFjZSgvJW98JXMvZ2ksKCgpPT5TXyhbZi5zaGlmdCgpXSx0aGlzLl9jb25zb2xlQ3V0TGVuZ3RoKSkpLF89IlsiLmNvbmNhdCh0aGlzLl91dWlkLCItIikuY29uY2F0KGwsIl1bIikuY29uY2F0KGUsIi0iKS5jb25jYXQoaCwiXS0iKS5jb25jYXQociwiLSIpLmNvbmNhdCh0LCJbIikuY29uY2F0KG4sIl0iKS5jb25jYXQoaSwiWyIpLmNvbmNhdChvLCIuIikuY29uY2F0KHMsIl0gIikuY29uY2F0KHAsIiAiKS5jb25jYXQoZCk7dmFyIGc7dT91LnJlcG9ydExvZyhfKTooZz1fLG1fLnJlcG9ydExvZyhnKSl9cHVzaCh0KXsiT0ZGIiE9PXRoaXMuX2VuYWJsZWQmJnRoaXMuYnVmZmVyLnB1c2godCl9c3BsaWNlKHQpe2lmKCJPTiIhPT10aGlzLl9lbmFibGVkKXJldHVybntwYXlsb2FkOltdLHBheWxvYWRTaXplOjB9O2NvbnN0e2luZGV4OmUsc2l6ZTpyfT1mdW5jdGlvbih0LGUpe2xldCByPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspe2NvbnN0IGk9SlNPTi5zdHJpbmdpZnkodFtuXSkubGVuZ3RoO2lmKHIrPWkscj5lKXJldHVybntpbmRleDpuLHNpemU6ci1pfX1yZXR1cm57aW5kZXg6dC5sZW5ndGgsc2l6ZTpyfX0odGhpcy5idWZmZXIsdCk7cmV0dXJue3BheWxvYWQ6dGhpcy5idWZmZXIuc3BsaWNlKDAsZSkscGF5bG9hZFNpemU6cn19dW5zaGlmdCh0KXt0aGlzLmJ1ZmZlcj10LmNvbmNhdCh0aGlzLmJ1ZmZlcil9Z2V0KCl7cmV0dXJuIHRoaXMuYnVmZmVyfXNldCh0KXt0aGlzLmJ1ZmZlcj10LmNvbmNhdCh0aGlzLmJ1ZmZlcil9aXNFbXB0eSgpe3JldHVybiJPRkYiPT09dGhpcy5fZW5hYmxlZHx8MD09PXRoaXMuYnVmZmVyLmxlbmd0aH19O2NvbnN0IHhfPSJbVkVSVENdIixBXz0iIzAwNTBiMyIsRV89e0RFQlVHOiJyZ2JhKDAsIDAsIDAsIDApIiwiIElORk8iOiJyZ2JhKDkzLCAxNzMsIDIyNiwgMCkiLCIgV0FSTiI6InJnYmEoMjU1LCAxMTksIDAsIDAuMykiLEVSUk9SOiJyZ2JhKDI1NSwgMCwgMCwgMC4zKSIsIiBTVUNDIjoicmdiYSgwLCAxMTksIDAsIDAuMykifSxDXz0idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guaW5jbHVkZXMoIl9ydGNfZGVidWdfIil8fChudWxsPT09KGtfPXdpbmRvdy5sb2NhbFN0b3JhZ2UpfHx2b2lkIDA9PT1rXz92b2lkIDA6a18uZ2V0SXRlbSgiX3J0Y19kZWJ1Z18iKSkpO2NvbnN0IElfPSgpPT57Y29uc3QgdD1uZXcgRGF0ZTtyZXR1cm4iIi5jb25jYXQodC50b1RpbWVTdHJpbmcoKS5zcGxpdCgiICIpWzBdLCI6IikuY29uY2F0KHQuZ2V0TWlsbGlzZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgzLCIwIikpfTt2YXIgVF8sQl8sTF8sTl8sUl8sel89Y2xhc3N7Y29uc3RydWN0b3IodCxlKXtsZXQgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06Imdsb2JhbCI7bGwodGhpcywiaW5kZW50Iix2b2lkIDApLGxsKHRoaXMsIm1vZHVsZSIsdm9pZCAwKSxsbCh0aGlzLCJfZW5naW5lSWQiLHZvaWQgMCksdGhpcy5tb2R1bGU9dCx0aGlzLmluZGVudD1lLHRoaXMuX2VuZ2luZUlkPXJ9X3ByaW50KHQsZSl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsbj1uZXcgQXJyYXkocj4yP3ItMjowKSxpPTI7aTxyO2krKyluW2ktMl09YXJndW1lbnRzW2ldO2NvbnN0IG89bi5zaGlmdCgpO3RyeXtjb25zdCB0PVsuLi5uXSxyPSIiLmNvbmNhdChvKS5yZXBsYWNlKC8lby9naSwoKCk9Pntjb25zdCBlPXQuc2hpZnQoKTtyZXR1cm4gSlNPTi5zdHJpbmdpZnkoZSl9KSk7UGwuc2V0KCIiLmNvbmNhdCh4XywiWyIpLmNvbmNhdCh0aGlzLm1vZHVsZSwiLiIpLmNvbmNhdChlLCJdICIpLmNvbmNhdChyLCIgIikuY29uY2F0KHQubWFwKCh0PT5KU09OLnN0cmluZ2lmeSh0KSkpLmpvaW4oIiwgIikpKX1jYXRjaChZZyl7fWxldCBzPSIiO2ZvcihsZXQgYz0wO2M8dGhpcy5pbmRlbnQ7YysrKXMrPSIgICAgIjtjb25zdCBhPUlfKCk7T18ucmVwb3J0KHhfLHRoaXMuX2VuZ2luZUlkLGEsdCxzLHRoaXMubW9kdWxlLGUsbyxuKSxDXyYmY29uc29sZS5sb2coIiVjIi5jb25jYXQoYSwiLSIpLmNvbmNhdCh4XywiJWNbIikuY29uY2F0KHQsIl0lYyIpLmNvbmNhdChzLCJbIikuY29uY2F0KHRoaXMubW9kdWxlLCIuIikuY29uY2F0KGUsIl0gIikuY29uY2F0KG8pLCJjb2xvcjoiLmNvbmNhdChBXywiOyIpLCJiYWNrZ3JvdW5kLWNvbG9yOiIuY29uY2F0KEVfW3RdLCI7IiksImNvbG9yOiIuY29uY2F0KEFfLCI7IiksLi4ubil9cHJpbnQodCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO3RoaXMuX3ByaW50KCIgSU5GTyIsdCwuLi5yKX1kZWJ1Zyh0KXtmb3IodmFyIGU9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheShlPjE/ZS0xOjApLG49MTtuPGU7bisrKXJbbi0xXT1hcmd1bWVudHNbbl07dGhpcy5fcHJpbnQoIkRFQlVHIix0LC4uLnIpfWluZm8odCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO3RoaXMuX3ByaW50KCIgSU5GTyIsdCwuLi5yKX13YXJuKHQpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGU+MT9lLTE6MCksbj0xO248ZTtuKyspcltuLTFdPWFyZ3VtZW50c1tuXTt0aGlzLl9wcmludCgiIFdBUk4iLHQsLi4ucil9ZXJyb3IodCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO3RoaXMuX3ByaW50KCJFUlJPUiIsdCwuLi5yKX1zdWNjZXNzKHQpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGU+MT9lLTE6MCksbj0xO248ZTtuKyspcltuLTFdPWFyZ3VtZW50c1tuXTt0aGlzLl9wcmludCgiIFNVQ0MiLHQsLi4ucil9fTtjb25zdCBEXz0oKT0+InVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3csUF89RF8oKT8iIjp3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtmdW5jdGlvbiBNXygpe2xldCB0PSJub25lIjtyZXR1cm4gRF8oKXx8KG51bGwhPT1QXy5tYXRjaCgiRmlyZWZveCIpP3Q9Im1vemlsbGEiOm51bGwhPT1QXy5tYXRjaCgiQ2hyb21lIik/KHQ9ImNocm9tZS1zdGFibGUiLG51bGwhPT1QXy5tYXRjaCgiRWxlY3Ryb24iKSYmKHQ9ImVsZWN0cm9uIikpOihudWxsIT09UF8ubWF0Y2goIlNhZmFyaSIpfHxudWxsIT09UF8ubWF0Y2goIkFwcGxlV2ViS2l0IikpJiYodD0ic2FmYXJpIikpLHR9TV8oKTtjb25zdCBVXz0ic2FmYXJpIj09PU1fKCksRl89ImNocm9tZS1zdGFibGUiPT09TV8oKTshRF8oKSYmUF8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygibW9iaWxlIik7Y29uc3Qgal89IURfKCkmJiEhLyhpUGhvbmV8aVBhZHxpUG9kKS9pLmV4ZWMoUF8pLEhfPSFEXygpJiYvQW5kcm9pZC9pLnRlc3QoUF8pO2xldCBLXz0iMCI7Y29uc3QgSl89IURfKCkmJihudWxsPT09KFRfPVBfLm1hdGNoKC92ZXJzaW9uXC8oXGQrKS9pKSl8fHZvaWQgMD09PVRfP3ZvaWQgMDpUX1sxXSk7dmFyIFdfO1VfJiZKXyYmKEtfPW51bGw9PT0oV189bmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvdmVyc2lvblwvKFxkK1wuXGQrKS9pKSl8fHZvaWQgMD09PVdfP3ZvaWQgMDpXX1sxXSk7IURfKCkmJihudWxsPT09KEJfPVBfLm1hdGNoKC9GaXJlZm94XC8oXGQrKS9pKSl8fHZvaWQgMD09PUJffHxCX1sxXSk7Y29uc3QgWl89S18sR189bnVsbCE9PShMXz0hRF8oKSYmKG51bGw9PT0oTl89UF8ubWF0Y2goLyAoW1xkX10rKSBsaWtlIE1hYyBPUyBYL2kpKXx8dm9pZCAwPT09Tl98fG51bGw9PT0oTl89Tl9bMV0pfHx2b2lkIDA9PT1OXz92b2lkIDA6Tl8uc3BsaXQoIl8iKS5tYXAoKHQ9PnBhcnNlSW50KHQpKSkpKSYmdm9pZCAwIT09TF8/TF86W107IURfKCkmJihudWxsPT09KFJfPVBfLm1hdGNoKC9DaHJvbWVcLyhcZCspL2kpKXx8dm9pZCAwPT09Ul98fFJfWzFdKTtjb25zdCBWXz0iX19ydGNfcHJvZHVjdFBsYXRmb3JtX18iLCRfPSJSVENfREVWSUNFX0lEIixYXz0iUlRDX0FDQ0VTU19OT0RFIixZXz0iUlRDX0FDQ0VTU19VUkxTIixxXz0iRU5HSU5FX1dFQl9DT05GSUciLFFfPSJTRVJWRVJfQ09ORklHIjtjbGFzcyB0Z3tnZXQodCl7Y29uc3QgZT1sb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0KTtpZighZSlyZXR1cm4gbnVsbDt0cnl7Y29uc3Qgcj1KU09OLnBhcnNlKGUpO3JldHVybiByLnR0bD4wJiZEYXRlLm5vdygpLXIuc2F2ZVRpbWU+ci50dGw/KHRoaXMuZGVsZXRlKHQpLG51bGwpOnIubWVzc2FnZX1jYXRjaChyKXtyZXR1cm4gbnVsbH19c2V0KHQsZSl7Y29uc3Qgcj17dHRsOmFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTotMSxzYXZlVGltZTpEYXRlLm5vdygpLG1lc3NhZ2U6ZX07dHJ5e3JldHVybiBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0LEpTT04uc3RyaW5naWZ5KHIpKSwhMH1jYXRjaChuKXtyZXR1cm4hMX19Z2V0VHRsKHQpe2NvbnN0IGU9bG9jYWxTdG9yYWdlLmdldEl0ZW0odCk7aWYoIWUpcmV0dXJuIG51bGw7dHJ5e3JldHVybiBKU09OLnBhcnNlKGUpLnR0bH1jYXRjaChyKXtyZXR1cm4gbnVsbH19ZGVsZXRlKHQpe3RyeXtyZXR1cm4gbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odCksITB9Y2F0Y2goZSl7cmV0dXJuITF9fX12YXIgZWc9bmV3IGNsYXNzIGV4dGVuZHMgdGd7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLGxsKHRoaXMsIl9hY2Nlc3NWZXJzaW9uIiwidjIiKX1nZXREZXZpY2VJZCgpe2lmKERfKCkpcmV0dXJuIiI7bGV0IHQ9dGhpcy5nZXQoJF8pO3JldHVybiB0JiYhL15bMC05YS1mXXs4fSgtWzAtOWEtZl17NH0pezN9LVswLTlhLWZdezEyfSQvLnRlc3QodCl8fCh0PWZ1bmN0aW9uKHQpe2xldCBlPSIiO2ZvcihsZXQgcj0wO3I8dDtyKyspZSs9TWF0aC5mbG9vcigxMCpNYXRoLnJhbmRvbSgpKTtyZXR1cm4gZX0oMTYpKSx0aGlzLnNldERldmljZUlkKHQpLHR9c2V0RGV2aWNlSWQodCl7dmFyIGU7cmV0dXJuIGU9e2RldmljZV9pZDp0fSxfXy5zZXRDb21tb25TdGF0cyhlKSx0aGlzLnNldCgkXyx0KSx0fWdldEFjY2Vzc05vZGUodCl7cmV0dXJuIHRoaXMuZ2V0KCIiLmNvbmNhdChYXywiXyIpLmNvbmNhdCh0LCItIikuY29uY2F0KFZfLCItIikuY29uY2F0KHRoaXMuX2FjY2Vzc1ZlcnNpb24pKX1zZXRBY2Nlc3NOb2RlKHQsZSxyKXtyZXR1cm4gdGhpcy5zZXQoIiIuY29uY2F0KFhfLCJfIikuY29uY2F0KHQsIi0iKS5jb25jYXQoVl8sIi0iKS5jb25jYXQodGhpcy5fYWNjZXNzVmVyc2lvbiksZSwxZTMqcil9ZGVsZXRlQWNjZXNzTm9kZSh0LGUpe2xldCByPXRoaXMuZ2V0QWNjZXNzTm9kZSh0KTtjb25zdCBuPXRoaXMuZ2V0VHRsKCIiLmNvbmNhdChYXywiXyIpLmNvbmNhdCh0LCItIikuY29uY2F0KFZfKSk7QXJyYXkuaXNBcnJheShyKSYmci5sZW5ndGg+MCYmKHI9ci5maWx0ZXIoKHQ9PnQubWVkaWFJRCE9PWUubWVkaWFJRCYmdC5tc2dLZXkhPT1lLm1zZ0tleSkpLHIubGVuZ3RoPjA/dGhpcy5zZXRBY2Nlc3NOb2RlKHQscixufHwwKTp0aGlzLmNsZWFyQWNjZXNzTm9kZSh0KSl9Y2xlYXJBY2Nlc3NOb2RlKHQpe2lmKHQpdGhpcy5kZWxldGUoIiIuY29uY2F0KFhfLCJfIikuY29uY2F0KHQsIi0iKS5jb25jYXQoVl8pKTtlbHNlIGZvcihjb25zdCBlIGluIGxvY2FsU3RvcmFnZSllLnN0YXJ0c1dpdGgoWF8pJiZsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShlKX1nZXRBY2Nlc3NVcmxzKCl7cmV0dXJuIHRoaXMuZ2V0KCIiLmNvbmNhdChZXywiLSIpLmNvbmNhdChWXykpfXNldEFjY2Vzc1VybHModCl7Y29uc3QgZT10Lm1hcCgodD0+e2xldHtob3N0OmUscGF0aDpyfT10O3JldHVybiJodHRwczovLyIuY29uY2F0KGUpLmNvbmNhdChyKX0pKTtyZXR1cm4gdGhpcy5zZXQoIiIuY29uY2F0KFlfLCItIikuY29uY2F0KFZfKSxlKX1jbGVhckFjY2Vzc1VybHMoKXt0aGlzLmRlbGV0ZSgiIi5jb25jYXQoWV8sIi0iKS5jb25jYXQoVl8pKX1nZXRFbmdpbmVXZWJDb25maWcodCxlKXt2YXIgcjtjb25zdCBuPSIiLmNvbmNhdCh0LCJfIikuY29uY2F0KGUsIl8iKS5jb25jYXQodGhpcy5nZXREZXZpY2VJZCgpKSxpPXRoaXMuZ2V0KHFfKSxvPShudWxsPT1pfHxudWxsPT09KHI9aS5maW5kKCh0PT50LmtleT09PW4pKSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuY29uZmlnKXx8e307cmV0dXJuIE9iamVjdC5hc3NpZ24oe30sZnVuY3Rpb24odCl7aWYoIkRFVklDRV9JRCI9PT10KXJldHVybiBlZy5nZXREZXZpY2VJZCgpO3JldHVybiBoZ1t0XX0oIkVOR0lORV9XRUJfQ09ORklHIiksbyl9c2V0RW5naW5lV2ViQ29uZmlnKHQsZSxyKXtpZighcilyZXR1cm47Y29uc3Qgbj0iIi5jb25jYXQodCwiXyIpLmNvbmNhdChlLCJfIikuY29uY2F0KHRoaXMuZ2V0RGV2aWNlSWQoKSk7bGV0IGk9dGhpcy5nZXQocV8pfHxbXTtyZXR1cm4gaT1pLmZpbHRlcigodD0+dC5rZXkhPT1uKSksaS5wdXNoKHtrZXk6bixjb25maWc6cn0pLHRoaXMuc2V0KHFfLGkuc2xpY2UoLTUpKX1nZXRTZXJ2ZXJDb25maWcodCl7dmFyIGU7Y29uc3Qgcj0iIi5jb25jYXQodCksbj10aGlzLmdldChRXyk7cmV0dXJuKG51bGw9PW58fG51bGw9PT0oZT1uLmZpbmQoKHQ9PnQua2V5PT09cikpKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5jb25maWcpfHx7fX1zZXRTZXJ2ZXJDb25maWcodCxlKXtpZighZSlyZXR1cm47Y29uc3Qgcj0iIi5jb25jYXQodCk7bGV0IG49dGhpcy5nZXQoUV8pfHxbXTtyZXR1cm4gbj1uLmZpbHRlcigodD0+dC5rZXkhPT1yKSksbi5wdXNoKHtrZXk6cixjb25maWc6ZX0pLHRoaXMuc2V0KFFfLG4uc2xpY2UoLTUpKX19O2NvbnN0IHJnPW5ldyB6XygiSm9pblJvb21Db25maWciLDApO2NsYXNzIG5ne2NvbnN0cnVjdG9yKHQpe2xsKHRoaXMsIl91c2VUY3BBZnRlckpvaW5UaW1lb3V0IixuZy5ERUZBVUxUX0NPTkYudXNlVGNwQWZ0ZXJKb2luVGltZW91dCksbGwodGhpcywiX2pvaW5XaXRoVGNwT25seSIsbmcuREVGQVVMVF9DT05GLmpvaW5XaXRoVGNwT25seSksbGwodGhpcywiX2pvaW5XaXRoVGNwT25seURlbGF5IixuZy5ERUZBVUxUX0NPTkYuam9pbldpdGhUY3BPbmx5RGVsYXkpLGxsKHRoaXMsIl9ibGFja0Jyb3dzZXJSZWdleExpc3QiLFtdKSx0aGlzLl9lbmdpbmVJZD10LGxvY2F0aW9uLnNlYXJjaC5pbmRleE9mKCJfX3J0Y190Y3Bfb25seV9fIik+LTEmJih0aGlzLl9qb2luV2l0aFRjcE9ubHk9ITAsdGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXk9MCksdGhpcy5fcmVwb3J0KCl9c3RhdGljIHNldERlZmF1bENvbmYodCl7bGV0e3VzZVRjcEFmdGVySm9pblRpbWVvdXQ6ZSxqb2luV2l0aFRjcE9ubHk6cixqb2luV2l0aFRjcE9ubHlEZWxheTpufT10O3JldHVybiJib29sZWFuIj09dHlwZW9mIGUmJihuZy5ERUZBVUxUX0NPTkYudXNlVGNwQWZ0ZXJKb2luVGltZW91dD1lKSwiYm9vbGVhbiI9PXR5cGVvZiByJiYobmcuREVGQVVMVF9DT05GLmpvaW5XaXRoVGNwT25seT1yKSwibnVtYmVyIj09dHlwZW9mIG4mJihuZy5ERUZBVUxUX0NPTkYuam9pbldpdGhUY3BPbmx5RGVsYXk9TWF0aC5tYXgoMCxuKSksbmcuREVGQVVMVF9DT05GfWdldCB1c2VUY3BBZnRlckpvaW5UaW1lb3V0KCl7cmV0dXJuIHRoaXMuX3VzZVRjcEFmdGVySm9pblRpbWVvdXR9Z2V0IHVzZVRjcEpvaW4oKXtyZXR1cm4gdGhpcy5fam9pbldpdGhUY3BPbmx5fWdldCB1c2VUY3BKb2luRGVsYXkoKXtyZXR1cm4gdGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXl9aXNCbGFja0Jyb3dlcigpe3JldHVybiB0aGlzLl9ibGFja0Jyb3dzZXJSZWdleExpc3QuZmluZCgodD0+bmV3IFJlZ0V4cCh0KS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSl9c2V0U2VydmVyQ29uZmlnKHQpe3ZhciBlLHIsbjtsZXQgaT0hMTsiYm9vbGVhbiI9PXR5cGVvZihudWxsPT10fHxudWxsPT09KGU9dC51c2VfdGNwX2FmdGVyX2pvaW5fdGltZW91dCl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZW5hYmxlKSYmKHRoaXMuX3VzZVRjcEFmdGVySm9pblRpbWVvdXQ9dC51c2VfdGNwX2FmdGVyX2pvaW5fdGltZW91dC5lbmFibGUsaT0hMCksImJvb2xlYW4iPT10eXBlb2YobnVsbD09dHx8bnVsbD09PShyPXQuam9pbl93aXRoX3RjcF9vbmx5KXx8dm9pZCAwPT09cj92b2lkIDA6ci5lbmFibGUpJiYodGhpcy5fam9pbldpdGhUY3BPbmx5PXQuam9pbl93aXRoX3RjcF9vbmx5LmVuYWJsZSxpPSEwKSwibnVtYmVyIj09dHlwZW9mKG51bGw9PXR8fG51bGw9PT0obj10LmpvaW5fd2l0aF90Y3Bfb25seSl8fHZvaWQgMD09PW4/dm9pZCAwOm4uZGVsYXlfbXMpJiYodGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXk9dC5qb2luX3dpdGhfdGNwX29ubHkuZGVsYXlfbXMsaT0hMCksdCYmQXJyYXkuaXNBcnJheSh0LmJsYWNrX2Jyb3dzZXJfcmVnZXhfbGlzdCkmJih0aGlzLl9ibGFja0Jyb3dzZXJSZWdleExpc3Q9dC5ibGFja19icm93c2VyX3JlZ2V4X2xpc3QsaT0hMCksaSYmdGhpcy5fcmVwb3J0KCl9dG9TdHJpbmcoKXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkoe3VzZV90Y3BfYWZ0ZXJfam9pbl90aW1lb3V0OnRoaXMuX3VzZVRjcEFmdGVySm9pblRpbWVvdXQsam9pbl93aXRoX3RjcF9vbmx5OnRoaXMuX2pvaW5XaXRoVGNwT25seSxqb2luX3dpdGhfdGNwX29ubHlfZGVsYXk6dGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXksYmxhY2tfYnJvd3Nlcl9yZWdleF9saXN0OnRoaXMuX2JsYWNrQnJvd3NlclJlZ2V4TGlzdH0pfV9yZXBvcnQoKXtyZy5wcmludCgiX3JlcG9ydCIsdGhpcy50b1N0cmluZygpKSxmdW5jdGlvbih0LGUscil7dmFyIG47bGV0IGk9YXJndW1lbnRzLmxlbmd0aD4zJiZ2b2lkIDAhPT1hcmd1bWVudHNbM10/YXJndW1lbnRzWzNdOjAsbz1hcmd1bWVudHMubGVuZ3RoPjQmJnZvaWQgMCE9PWFyZ3VtZW50c1s0XT9hcmd1bWVudHNbNF06IiIscz1hcmd1bWVudHMubGVuZ3RoPjU/YXJndW1lbnRzWzVdOnZvaWQgMDtudWxsPT09KG49Yl8odCkpfHx2b2lkIDA9PT1ufHxuLnJlcG9ydCgicnRjX2ludm9rZV9zdGF0dXMiLHtzZGtfYXBpX25hbWU6ZSxtZXNzYWdlOnIsZXJyb3JfY29kZTppLHN0cmVhbV9pZDpvLGVsYXBzZTowfSxzKX0odGhpcy5fZW5naW5lSWQsIndlYl9qb2luX3Jvb21fY29uZmlnIix0aGlzLnRvU3RyaW5nKCkpfX1sbChuZywiREVGQVVMVF9DT05GIix7dXNlVGNwQWZ0ZXJKb2luVGltZW91dDohMCxqb2luV2l0aFRjcE9ubHk6ITEsam9pbldpdGhUY3BPbmx5RGVsYXk6NWUzfSk7dmFyIGlnPSh0PT4odFt0Lk5PTkU9MF09Ik5PTkUiLHQpKShpZ3x8e30pLG9nPW87Q3Ioe2dsb2JhbDohMCxmb3JjZWQ6b2cuZ2xvYmFsVGhpcyE9PW9nfSx7Z2xvYmFsVGhpczpvZ30pO3ZhciBzZyxhZz1lKG8pLGNnPSh0PT4odC5IMjY0PSJIMjY0Iix0LlZQOD0iVlA4Iix0LkgyNjU9IkgyNjUiLHQpKShjZ3x8e30pO0hfJiZGX3x8al8mJkdfWzBdLFVfJiYoKG51bGw9PVpfP3ZvaWQgMDpaXy5pbmNsdWRlcygiMTYuMSIpKXx8KG51bGw9PVpfP3ZvaWQgMDpaXy5pbmNsdWRlcygiMTYuMiIpKXx8bnVsbD09Wl98fFpfLmluY2x1ZGVzKCIxNi4zIikpO2NvbnN0IHVnPSJfX3J0Y19hY2Nlc3NEb21haW5zX18iLnNwbGl0KCIsIik7Y29uc3QgbGc9Il9fcnRjX2NvbmZpZ0RvbWFpbnNfXyIuc3BsaXQoIiwiKSxoZz17VkVSU0lPTjoiX19QTEFDRUhPTERFUl9WRVJTSU9OX18iLElDRV9DT05GSUdfUkVRVUVTVF9VUkxTX0lOVEVSTkFMOnVnLm1hcCgoZnVuY3Rpb24oKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06IiI7cmV0dXJuIHQ/KC9eaHR0cHM/OlwvXC8uKy8udGVzdCh0KXx8KHQ9Imh0dHBzOi8vIi5jb25jYXQodCkpLCIiLmNvbmNhdCh0LCIvZGlzcGF0Y2gvdjEvQWNjZXNzSW5mbz9BY3Rpb249R2V0QWNjZXNzSW5mbyIpKToiIn0pKSxJQ0VfQ09ORklHX1JFUVVFU1RfVVJMUzpbXSxFWFBFQ1RFRF9BRERSOiIiLExPR19TRVJWRVJfVVJMOiJfX3J0Y19kb21lc3RpY0xvZ1NlcnZlclVybF9fIixDT05GSUdfUkVRVUVTVF9ET01BSU5TOmxnLERFVklDRV9JRDoiIixPVkVSU0VBOiExLFBMQVRGT1JNOiIiLFBST0RVQ1Q6IiIsRk9SQ0VfRU5BQkxFRF9SRVBPUlRfQ0FMTEJBQ0tTOltdLFNLSVBfV0VCX0FVRElPX0lOX1RSQUNLOiExLEVORk9SQ0VfV0VCX0FVRElPX1NVUFBPUlRFRDohMSxBVURJT19TVEFMTDohMCxWSURFT19TVEFMTDohMCxWSURFT19TVEFMTF8xMDBNUzohMSxTVEFUU19TQ0FMTEJBQ0tfU1VQUE9SVDohMCxKT0lOX1JPT01fQ09ORklHOm5nLkRFRkFVTFRfQ09ORixTSUdOQUxfQ09NUFJFU1NJT046ITAsU0lHTkFMX0NST1BfSk9JTlJPT006ITAsVklERU9fU1RBTExfREFUQTo1MDAsQVVESU9fU1RBTExfREFUQToyMDAsSU9TX1NBRkFSSV9PUklFTlRBVElPTjohMSxCTEFDS19GUkFNRV9MSUZFVElNRTo2ZTQsRkFMTEJBQ0tfRU5DT0RFX0NPREVDOiIiLFNFSV9USU1FX09VVDoyZTMsU0VJX0NPVU5UX0ZQUzoxLFBSRV9JQ0U6ITEsU1RBVFNfTE9PUF9JTlRFUlZBTDoxZTMsSElEREVOX1NUQVRTOiExLFVQTE9BRF9SRU1PVEVfU1RBVFM6aWcuTk9ORSxTREtfQ09ERUNfTkVHT1RJQVRJT046ITAsQVVESU9fQ09ERUM6Ik9QVVMiLERJU0FCTEVfRU5DT0RFRF9UUkFOU0ZPUk06ITEsU0tJUF9TRUlfRklMVEVSOiExLEFSRUFfQ09ERToiIixESVNBQkxFX0NPTVBVVEVfUFJFU1NVUkU6ITEsU0VORF9NRVNTQUdFX1NZTkM6ITEsSDI2NF9IV19FTkNPREVSOiExLEdQVV9VUkw6IiIsVFVSTl9PTl9KT0lOX1JPT01fRkFJTFVSRV9DQUxMQkFDSzohMSxFTkFCTEVfRkFMTEJBQ0tfSEFORExFUjohMSxFTkFCTEVfU1RBTkRBUkRfSEFORExFUjohMSxQQ19LSUxMU1dJVENIOnt9LEVOQUJMRV9QTEFZX0FGVEVSX0NMSUNLOiExLEFVVE9QTEFZX1dPUktBUk9VTkQ6ITAsRU5HSU5FX1dFQl9DT05GSUc6e319OyJ1bmRlZmluZWQiPT10eXBlb2Ygd2luZG93fHxudWxsPT09KHNnPXdpbmRvdyl8fHZvaWQgMD09PXNnfHxudWxsPT09KHNnPXNnLlJUQ1BlZXJDb25uZWN0aW9uKXx8dm9pZCAwPT09c2d8fHNnLnByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbjt2YXIgZGcsZmcscGc9e2V4cG9ydHM6e319LF9nPW5ldyBQcm94eSh7fSx7Z2V0KHQsZSl7dGhyb3cgbmV3IEVycm9yKGBNb2R1bGUgIiIgaGFzIGJlZW4gZXh0ZXJuYWxpemVkIGZvciBicm93c2VyIGNvbXBhdGliaWxpdHkuIENhbm5vdCBhY2Nlc3MgIi4ke2V9IiBpbiBjbGllbnQgY29kZS4gIFNlZSBodHRwOi8vdml0ZWpzLmRldi9ndWlkZS90cm91Ymxlc2hvb3RpbmcuaHRtbCNtb2R1bGUtZXh0ZXJuYWxpemVkLWZvci1icm93c2VyLWNvbXBhdGliaWxpdHkgZm9yIG1vcmUgZGV0YWlscy5gKX19KSxnZz1yKE9iamVjdC5mcmVlemUoe19fcHJvdG9fXzpudWxsLGRlZmF1bHQ6X2d9KSk7ZnVuY3Rpb24gbWcoKXtyZXR1cm4gZGd8fChkZz0xLHBnLmV4cG9ydHM9KGU9ZXx8ZnVuY3Rpb24oZSxyKXt2YXIgbjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmNyeXB0byYmKG49d2luZG93LmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLmNyeXB0byYmKG49c2VsZi5jcnlwdG8pLHZvaWQgMCE9PWFnJiZhZy5jcnlwdG8mJihuPWFnLmNyeXB0byksIW4mJiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZ3aW5kb3cubXNDcnlwdG8mJihuPXdpbmRvdy5tc0NyeXB0byksIW4mJnZvaWQgMCE9PXQmJnQuY3J5cHRvJiYobj10LmNyeXB0byksIW4pdHJ5e249Z2d9Y2F0Y2goZyl7fXZhciBpPWZ1bmN0aW9uKCl7aWYobil7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4uZ2V0UmFuZG9tVmFsdWVzKXRyeXtyZXR1cm4gbi5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQzMkFycmF5KDEpKVswXX1jYXRjaChnKXt9aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4ucmFuZG9tQnl0ZXMpdHJ5e3JldHVybiBuLnJhbmRvbUJ5dGVzKDQpLnJlYWRJbnQzMkxFKCl9Y2F0Y2goZyl7fX10aHJvdyBuZXcgRXJyb3IoIk5hdGl2ZSBjcnlwdG8gbW9kdWxlIGNvdWxkIG5vdCBiZSB1c2VkIHRvIGdldCBzZWN1cmUgcmFuZG9tIG51bWJlci4iKX0sbz1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt9cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByO3JldHVybiB0LnByb3RvdHlwZT1lLHI9bmV3IHQsdC5wcm90b3R5cGU9bnVsbCxyfX0oKSxzPXt9LGE9cy5saWI9e30sYz1hLkJhc2U9e2V4dGVuZDpmdW5jdGlvbih0KXt2YXIgZT1vKHRoaXMpO3JldHVybiB0JiZlLm1peEluKHQpLGUuaGFzT3duUHJvcGVydHkoImluaXQiKSYmdGhpcy5pbml0IT09ZS5pbml0fHwoZS5pbml0PWZ1bmN0aW9uKCl7ZS4kc3VwZXIuaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSxlLmluaXQucHJvdG90eXBlPWUsZS4kc3VwZXI9dGhpcyxlfSxjcmVhdGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmV4dGVuZCgpO3JldHVybiB0LmluaXQuYXBwbHkodCxhcmd1bWVudHMpLHR9LGluaXQ6ZnVuY3Rpb24oKXt9LG1peEluOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSBpbiB0KXQuaGFzT3duUHJvcGVydHkoZSkmJih0aGlzW2VdPXRbZV0pO3QuaGFzT3duUHJvcGVydHkoInRvU3RyaW5nIikmJih0aGlzLnRvU3RyaW5nPXQudG9TdHJpbmcpfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmluaXQucHJvdG90eXBlLmV4dGVuZCh0aGlzKX19LHU9YS5Xb3JkQXJyYXk9Yy5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxlKXt0PXRoaXMud29yZHM9dHx8W10sdGhpcy5zaWdCeXRlcz1lIT1yP2U6NCp0Lmxlbmd0aH0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fGgpLnN0cmluZ2lmeSh0aGlzKX0sY29uY2F0OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMud29yZHMscj10LndvcmRzLG49dGhpcy5zaWdCeXRlcyxpPXQuc2lnQnl0ZXM7aWYodGhpcy5jbGFtcCgpLG4lNClmb3IodmFyIG89MDtvPGk7bysrKXt2YXIgcz1yW28+Pj4yXT4+PjI0LW8lNCo4JjI1NTtlW24rbz4+PjJdfD1zPDwyNC0obitvKSU0Kjh9ZWxzZSBmb3IodmFyIGE9MDthPGk7YSs9NCllW24rYT4+PjJdPXJbYT4+PjJdO3JldHVybiB0aGlzLnNpZ0J5dGVzKz1pLHRoaXN9LGNsYW1wOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy53b3JkcyxyPXRoaXMuc2lnQnl0ZXM7dFtyPj4+Ml0mPTQyOTQ5NjcyOTU8PDMyLXIlNCo4LHQubGVuZ3RoPWUuY2VpbChyLzQpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWMuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC53b3Jkcz10aGlzLndvcmRzLnNsaWNlKDApLHR9LHJhbmRvbTpmdW5jdGlvbih0KXtmb3IodmFyIGU9W10scj0wO3I8dDtyKz00KWUucHVzaChpKCkpO3JldHVybiBuZXcgdS5pbml0KGUsdCl9fSksbD1zLmVuYz17fSxoPWwuSGV4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBvPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaCgobz4+PjQpLnRvU3RyaW5nKDE2KSksbi5wdXNoKCgxNSZvKS50b1N0cmluZygxNikpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rPTIpcltuPj4+M118PXBhcnNlSW50KHQuc3Vic3RyKG4sMiksMTYpPDwyNC1uJTgqNDtyZXR1cm4gbmV3IHUuaW5pdChyLGUvMil9fSxkPWwuTGF0aW4xPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBvPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKG8pKX1yZXR1cm4gbi5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQubGVuZ3RoLHI9W10sbj0wO248ZTtuKyspcltuPj4+Ml18PSgyNTUmdC5jaGFyQ29kZUF0KG4pKTw8MjQtbiU0Kjg7cmV0dXJuIG5ldyB1LmluaXQocixlKX19LGY9bC5VdGY4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dHJ5e3JldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKGQuc3RyaW5naWZ5KHQpKSl9Y2F0Y2goZSl7dGhyb3cgbmV3IEVycm9yKCJNYWxmb3JtZWQgVVRGLTggZGF0YSIpfX0scGFyc2U6ZnVuY3Rpb24odCl7cmV0dXJuIGQucGFyc2UodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHQpKSl9fSxwPWEuQnVmZmVyZWRCbG9ja0FsZ29yaXRobT1jLmV4dGVuZCh7cmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhPW5ldyB1LmluaXQsdGhpcy5fbkRhdGFCeXRlcz0wfSxfYXBwZW5kOmZ1bmN0aW9uKHQpeyJzdHJpbmciPT10eXBlb2YgdCYmKHQ9Zi5wYXJzZSh0KSksdGhpcy5fZGF0YS5jb25jYXQodCksdGhpcy5fbkRhdGFCeXRlcys9dC5zaWdCeXRlc30sX3Byb2Nlc3M6ZnVuY3Rpb24odCl7dmFyIHIsbj10aGlzLl9kYXRhLGk9bi53b3JkcyxvPW4uc2lnQnl0ZXMscz10aGlzLmJsb2NrU2l6ZSxhPW8vKDQqcyksYz0oYT10P2UuY2VpbChhKTplLm1heCgoMHxhKS10aGlzLl9taW5CdWZmZXJTaXplLDApKSpzLGw9ZS5taW4oNCpjLG8pO2lmKGMpe2Zvcih2YXIgaD0wO2g8YztoKz1zKXRoaXMuX2RvUHJvY2Vzc0Jsb2NrKGksaCk7cj1pLnNwbGljZSgwLGMpLG4uc2lnQnl0ZXMtPWx9cmV0dXJuIG5ldyB1LmluaXQocixsKX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1jLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLHR9LF9taW5CdWZmZXJTaXplOjB9KTthLkhhc2hlcj1wLmV4dGVuZCh7Y2ZnOmMuZXh0ZW5kKCksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3AucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX0sYmxvY2tTaXplOjE2LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscil7cmV0dXJuIG5ldyB0LmluaXQocikuZmluYWxpemUoZSl9fSxfY3JlYXRlSG1hY0hlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IF8uSE1BQy5pbml0KHQscikuZmluYWxpemUoZSl9fX0pO3ZhciBfPXMuYWxnbz17fTtyZXR1cm4gc30oTWF0aCksZSkpLHBnLmV4cG9ydHM7dmFyIGV9Zmc9bWcoKSxmdW5jdGlvbigpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBBcnJheUJ1ZmZlcil7dmFyIHQ9ZmcubGliLldvcmRBcnJheSxlPXQuaW5pdCxyPXQuaW5pdD1mdW5jdGlvbih0KXtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJih0PW5ldyBVaW50OEFycmF5KHQpKSwodCBpbnN0YW5jZW9mIEludDhBcnJheXx8InVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OENsYW1wZWRBcnJheSYmdCBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHx0IGluc3RhbmNlb2YgSW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgSW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSYmKHQ9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0LHQuYnl0ZUxlbmd0aCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtmb3IodmFyIHI9dC5ieXRlTGVuZ3RoLG49W10saT0wO2k8cjtpKyspbltpPj4+Ml18PXRbaV08PDI0LWklNCo4O2UuY2FsbCh0aGlzLG4scil9ZWxzZSBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07ci5wcm90b3R5cGU9dH19KCksZmcubGliLldvcmRBcnJheTt2YXIgeWcsdmc9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGJnKCl7cmV0dXJuIHlnfHwoeWc9MSxmdW5jdGlvbih0KXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLldvcmRBcnJheTtmdW5jdGlvbiBuKHQsZSxuKXtmb3IodmFyIGk9W10sbz0wLHM9MDtzPGU7cysrKWlmKHMlNCl7dmFyIGE9blt0LmNoYXJDb2RlQXQocy0xKV08PHMlNCoyfG5bdC5jaGFyQ29kZUF0KHMpXT4+PjYtcyU0KjI7aVtvPj4+Ml18PWE8PDI0LW8lNCo4LG8rK31yZXR1cm4gci5jcmVhdGUoaSxvKX1lLmVuYy5CYXNlNjQ9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPXRoaXMuX21hcDt0LmNsYW1wKCk7Zm9yKHZhciBpPVtdLG89MDtvPHI7bys9Mylmb3IodmFyIHM9KGVbbz4+PjJdPj4+MjQtbyU0KjgmMjU1KTw8MTZ8KGVbbysxPj4+Ml0+Pj4yNC0obysxKSU0KjgmMjU1KTw8OHxlW28rMj4+PjJdPj4+MjQtKG8rMiklNCo4JjI1NSxhPTA7YTw0JiZvKy43NSphPHI7YSsrKWkucHVzaChuLmNoYXJBdChzPj4+NiooMy1hKSY2MykpO3ZhciBjPW4uY2hhckF0KDY0KTtpZihjKWZvcig7aS5sZW5ndGglNDspaS5wdXNoKGMpO3JldHVybiBpLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZT10Lmxlbmd0aCxyPXRoaXMuX21hcCxpPXRoaXMuX3JldmVyc2VNYXA7aWYoIWkpe2k9dGhpcy5fcmV2ZXJzZU1hcD1bXTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylpW3IuY2hhckNvZGVBdChvKV09b312YXIgcz1yLmNoYXJBdCg2NCk7aWYocyl7dmFyIGE9dC5pbmRleE9mKHMpOy0xIT09YSYmKGU9YSl9cmV0dXJuIG4odCxlLGkpfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9fSgpLHQuZW5jLkJhc2U2NH0obWcoKSl9KHZnKSksdmcuZXhwb3J0c312YXIgd2csU2c9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGtnKCl7cmV0dXJuIHdnfHwod2c9MSxmdW5jdGlvbih0KXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uV29yZEFycmF5LG89bi5IYXNoZXIscz1yLmFsZ28sYT1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9MDt0PDY0O3QrKylhW3RdPTQyOTQ5NjcyOTYqZS5hYnMoZS5zaW4odCsxKSl8MH0oKTt2YXIgYz1zLk1ENT1vLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBpLmluaXQoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OF0pfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9MDtyPDE2O3IrKyl7dmFyIG49ZStyLGk9dFtuXTt0W25dPTE2NzExOTM1JihpPDw4fGk+Pj4yNCl8NDI3ODI1NTM2MCYoaTw8MjR8aT4+PjgpfXZhciBvPXRoaXMuX2hhc2gud29yZHMscz10W2UrMF0sYz10W2UrMV0sZj10W2UrMl0scD10W2UrM10sXz10W2UrNF0sZz10W2UrNV0sbT10W2UrNl0seT10W2UrN10sdj10W2UrOF0sYj10W2UrOV0sdz10W2UrMTBdLFM9dFtlKzExXSxrPXRbZSsxMl0sTz10W2UrMTNdLHg9dFtlKzE0XSxBPXRbZSsxNV0sRT1vWzBdLEM9b1sxXSxJPW9bMl0sVD1vWzNdO0U9dShFLEMsSSxULHMsNyxhWzBdKSxUPXUoVCxFLEMsSSxjLDEyLGFbMV0pLEk9dShJLFQsRSxDLGYsMTcsYVsyXSksQz11KEMsSSxULEUscCwyMixhWzNdKSxFPXUoRSxDLEksVCxfLDcsYVs0XSksVD11KFQsRSxDLEksZywxMixhWzVdKSxJPXUoSSxULEUsQyxtLDE3LGFbNl0pLEM9dShDLEksVCxFLHksMjIsYVs3XSksRT11KEUsQyxJLFQsdiw3LGFbOF0pLFQ9dShULEUsQyxJLGIsMTIsYVs5XSksST11KEksVCxFLEMsdywxNyxhWzEwXSksQz11KEMsSSxULEUsUywyMixhWzExXSksRT11KEUsQyxJLFQsayw3LGFbMTJdKSxUPXUoVCxFLEMsSSxPLDEyLGFbMTNdKSxJPXUoSSxULEUsQyx4LDE3LGFbMTRdKSxFPWwoRSxDPXUoQyxJLFQsRSxBLDIyLGFbMTVdKSxJLFQsYyw1LGFbMTZdKSxUPWwoVCxFLEMsSSxtLDksYVsxN10pLEk9bChJLFQsRSxDLFMsMTQsYVsxOF0pLEM9bChDLEksVCxFLHMsMjAsYVsxOV0pLEU9bChFLEMsSSxULGcsNSxhWzIwXSksVD1sKFQsRSxDLEksdyw5LGFbMjFdKSxJPWwoSSxULEUsQyxBLDE0LGFbMjJdKSxDPWwoQyxJLFQsRSxfLDIwLGFbMjNdKSxFPWwoRSxDLEksVCxiLDUsYVsyNF0pLFQ9bChULEUsQyxJLHgsOSxhWzI1XSksST1sKEksVCxFLEMscCwxNCxhWzI2XSksQz1sKEMsSSxULEUsdiwyMCxhWzI3XSksRT1sKEUsQyxJLFQsTyw1LGFbMjhdKSxUPWwoVCxFLEMsSSxmLDksYVsyOV0pLEk9bChJLFQsRSxDLHksMTQsYVszMF0pLEU9aChFLEM9bChDLEksVCxFLGssMjAsYVszMV0pLEksVCxnLDQsYVszMl0pLFQ9aChULEUsQyxJLHYsMTEsYVszM10pLEk9aChJLFQsRSxDLFMsMTYsYVszNF0pLEM9aChDLEksVCxFLHgsMjMsYVszNV0pLEU9aChFLEMsSSxULGMsNCxhWzM2XSksVD1oKFQsRSxDLEksXywxMSxhWzM3XSksST1oKEksVCxFLEMseSwxNixhWzM4XSksQz1oKEMsSSxULEUsdywyMyxhWzM5XSksRT1oKEUsQyxJLFQsTyw0LGFbNDBdKSxUPWgoVCxFLEMsSSxzLDExLGFbNDFdKSxJPWgoSSxULEUsQyxwLDE2LGFbNDJdKSxDPWgoQyxJLFQsRSxtLDIzLGFbNDNdKSxFPWgoRSxDLEksVCxiLDQsYVs0NF0pLFQ9aChULEUsQyxJLGssMTEsYVs0NV0pLEk9aChJLFQsRSxDLEEsMTYsYVs0Nl0pLEU9ZChFLEM9aChDLEksVCxFLGYsMjMsYVs0N10pLEksVCxzLDYsYVs0OF0pLFQ9ZChULEUsQyxJLHksMTAsYVs0OV0pLEk9ZChJLFQsRSxDLHgsMTUsYVs1MF0pLEM9ZChDLEksVCxFLGcsMjEsYVs1MV0pLEU9ZChFLEMsSSxULGssNixhWzUyXSksVD1kKFQsRSxDLEkscCwxMCxhWzUzXSksST1kKEksVCxFLEMsdywxNSxhWzU0XSksQz1kKEMsSSxULEUsYywyMSxhWzU1XSksRT1kKEUsQyxJLFQsdiw2LGFbNTZdKSxUPWQoVCxFLEMsSSxBLDEwLGFbNTddKSxJPWQoSSxULEUsQyxtLDE1LGFbNThdKSxDPWQoQyxJLFQsRSxPLDIxLGFbNTldKSxFPWQoRSxDLEksVCxfLDYsYVs2MF0pLFQ9ZChULEUsQyxJLFMsMTAsYVs2MV0pLEk9ZChJLFQsRSxDLGYsMTUsYVs2Ml0pLEM9ZChDLEksVCxFLGIsMjEsYVs2M10pLG9bMF09b1swXStFfDAsb1sxXT1vWzFdK0N8MCxvWzJdPW9bMl0rSXwwLG9bM109b1szXStUfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxyPXQud29yZHMsbj04KnRoaXMuX25EYXRhQnl0ZXMsaT04KnQuc2lnQnl0ZXM7cltpPj4+NV18PTEyODw8MjQtaSUzMjt2YXIgbz1lLmZsb29yKG4vNDI5NDk2NzI5Nikscz1uO3JbMTUrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKG88PDh8bz4+PjI0KXw0Mjc4MjU1MzYwJihvPDwyNHxvPj4+OCksclsxNCsoaSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYoczw8OHxzPj4+MjQpfDQyNzgyNTUzNjAmKHM8PDI0fHM+Pj44KSx0LnNpZ0J5dGVzPTQqKHIubGVuZ3RoKzEpLHRoaXMuX3Byb2Nlc3MoKTtmb3IodmFyIGE9dGhpcy5faGFzaCxjPWEud29yZHMsdT0wO3U8NDt1Kyspe3ZhciBsPWNbdV07Y1t1XT0xNjcxMTkzNSYobDw8OHxsPj4+MjQpfDQyNzgyNTUzNjAmKGw8PDI0fGw+Pj44KX1yZXR1cm4gYX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1vLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ZnVuY3Rpb24gdSh0LGUscixuLGksbyxzKXt2YXIgYT10KyhlJnJ8fmUmbikraStzO3JldHVybihhPDxvfGE+Pj4zMi1vKStlfWZ1bmN0aW9uIGwodCxlLHIsbixpLG8scyl7dmFyIGE9dCsoZSZufHImfm4pK2krcztyZXR1cm4oYTw8b3xhPj4+MzItbykrZX1mdW5jdGlvbiBoKHQsZSxyLG4saSxvLHMpe3ZhciBhPXQrKGVecl5uKStpK3M7cmV0dXJuKGE8PG98YT4+PjMyLW8pK2V9ZnVuY3Rpb24gZCh0LGUscixuLGksbyxzKXt2YXIgYT10KyhyXihlfH5uKSkraStzO3JldHVybihhPDxvfGE+Pj4zMi1vKStlfXIuTUQ1PW8uX2NyZWF0ZUhlbHBlcihjKSxyLkhtYWNNRDU9by5fY3JlYXRlSG1hY0hlbHBlcihjKX0oTWF0aCksdC5NRDV9KG1nKCkpfShTZykpLFNnLmV4cG9ydHN9dmFyIE9nLHhnPXtleHBvcnRzOnt9fSxBZz17ZXhwb3J0czp7fX07ZnVuY3Rpb24gRWcoKXtyZXR1cm4gT2d8fChPZz0xLGZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gcj0oZT10KS5saWIsbj1yLldvcmRBcnJheSxpPXIuSGFzaGVyLG89ZS5hbGdvLHM9W10sYT1vLlNIQTE9aS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgbi5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzgsMzI4NTM3NzUyMF0pfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy5faGFzaC53b3JkcyxuPXJbMF0saT1yWzFdLG89clsyXSxhPXJbM10sYz1yWzRdLHU9MDt1PDgwO3UrKyl7aWYodTwxNilzW3VdPTB8dFtlK3VdO2Vsc2V7dmFyIGw9c1t1LTNdXnNbdS04XV5zW3UtMTRdXnNbdS0xNl07c1t1XT1sPDwxfGw+Pj4zMX12YXIgaD0objw8NXxuPj4+MjcpK2Mrc1t1XTtoKz11PDIwPzE1MTg1MDAyNDkrKGkmb3x+aSZhKTp1PDQwPzE4NTk3NzUzOTMrKGleb15hKTp1PDYwPyhpJm98aSZhfG8mYSktMTg5NDAwNzU4ODooaV5vXmEpLTg5OTQ5NzUxNCxjPWEsYT1vLG89aTw8MzB8aT4+PjIsaT1uLG49aH1yWzBdPXJbMF0rbnwwLHJbMV09clsxXStpfDAsclsyXT1yWzJdK298MCxyWzNdPXJbM10rYXwwLHJbNF09cls0XStjfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxlPXQud29yZHMscj04KnRoaXMuX25EYXRhQnl0ZXMsbj04KnQuc2lnQnl0ZXM7cmV0dXJuIGVbbj4+PjVdfD0xMjg8PDI0LW4lMzIsZVsxNCsobis2ND4+Pjk8PDQpXT1NYXRoLmZsb29yKHIvNDI5NDk2NzI5NiksZVsxNSsobis2ND4+Pjk8PDQpXT1yLHQuc2lnQnl0ZXM9NCplLmxlbmd0aCx0aGlzLl9wcm9jZXNzKCksdGhpcy5faGFzaH0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1pLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSksZS5TSEExPWkuX2NyZWF0ZUhlbHBlcihhKSxlLkhtYWNTSEExPWkuX2NyZWF0ZUhtYWNIZWxwZXIoYSksdC5TSEExO3ZhciBlLHIsbixpLG8scyxhfShtZygpKX0oQWcpKSxBZy5leHBvcnRzfXZhciBDZyxJZyxUZz17ZXhwb3J0czp7fX07ZnVuY3Rpb24gQmcoKXtyZXR1cm4gSWd8fChJZz0xLGZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gcj0oZT10KS5saWIsbj1yLkJhc2UsaT1yLldvcmRBcnJheSxvPWUuYWxnbyxzPW8uTUQ1LGE9by5FdnBLREY9bi5leHRlbmQoe2NmZzpuLmV4dGVuZCh7a2V5U2l6ZTo0LGhhc2hlcjpzLGl0ZXJhdGlvbnM6MX0pLGluaXQ6ZnVuY3Rpb24odCl7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHQpfSxjb21wdXRlOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByLG49dGhpcy5jZmcsbz1uLmhhc2hlci5jcmVhdGUoKSxzPWkuY3JlYXRlKCksYT1zLndvcmRzLGM9bi5rZXlTaXplLHU9bi5pdGVyYXRpb25zO2EubGVuZ3RoPGM7KXtyJiZvLnVwZGF0ZShyKSxyPW8udXBkYXRlKHQpLmZpbmFsaXplKGUpLG8ucmVzZXQoKTtmb3IodmFyIGw9MTtsPHU7bCsrKXI9by5maW5hbGl6ZShyKSxvLnJlc2V0KCk7cy5jb25jYXQocil9cmV0dXJuIHMuc2lnQnl0ZXM9NCpjLHN9fSksZS5FdnBLREY9ZnVuY3Rpb24odCxlLHIpe3JldHVybiBhLmNyZWF0ZShyKS5jb21wdXRlKHQsZSl9LHQuRXZwS0RGO3ZhciBlLHIsbixpLG8scyxhfShtZygpLEVnKCksQ2d8fChDZz0xLGZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXt2YXIgZSxyLG47cj0oZT10KS5saWIuQmFzZSxuPWUuZW5jLlV0ZjgsZS5hbGdvLkhNQUM9ci5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxlKXt0PXRoaXMuX2hhc2hlcj1uZXcgdC5pbml0LCJzdHJpbmciPT10eXBlb2YgZSYmKGU9bi5wYXJzZShlKSk7dmFyIHI9dC5ibG9ja1NpemUsaT00KnI7ZS5zaWdCeXRlcz5pJiYoZT10LmZpbmFsaXplKGUpKSxlLmNsYW1wKCk7Zm9yKHZhciBvPXRoaXMuX29LZXk9ZS5jbG9uZSgpLHM9dGhpcy5faUtleT1lLmNsb25lKCksYT1vLndvcmRzLGM9cy53b3Jkcyx1PTA7dTxyO3UrKylhW3VdXj0xNTQ5NTU2ODI4LGNbdV1ePTkwOTUyMjQ4NjtvLnNpZ0J5dGVzPXMuc2lnQnl0ZXM9aSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5faGFzaGVyO3QucmVzZXQoKSx0LnVwZGF0ZSh0aGlzLl9pS2V5KX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9oYXNoZXIudXBkYXRlKHQpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2hhc2hlcixyPWUuZmluYWxpemUodCk7cmV0dXJuIGUucmVzZXQoKSxlLmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQocikpfX0pfShtZygpKX0oVGcpKSl9KHhnKSkseGcuZXhwb3J0c312YXIgTGcsTmc9e2V4cG9ydHM6e319O2Z1bmN0aW9uIFJnKCl7cmV0dXJuIExnfHwoTGc9MSxmdW5jdGlvbih0KXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dC5saWIuQ2lwaGVyfHxmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLkJhc2Usbz1uLldvcmRBcnJheSxzPW4uQnVmZmVyZWRCbG9ja0FsZ29yaXRobSxhPXIuZW5jO2EuVXRmODt2YXIgYz1hLkJhc2U2NCx1PXIuYWxnby5FdnBLREYsbD1uLkNpcGhlcj1zLmV4dGVuZCh7Y2ZnOmkuZXh0ZW5kKCksY3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLHQsZSl9LGNyZWF0ZURlY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSx0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSxyKXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQociksdGhpcy5feGZvcm1Nb2RlPXQsdGhpcy5fa2V5PWUsdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3MucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHByb2Nlc3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2FwcGVuZCh0KSx0aGlzLl9wcm9jZXNzKCl9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxrZXlTaXplOjQsaXZTaXplOjQsX0VOQ19YRk9STV9NT0RFOjEsX0RFQ19YRk9STV9NT0RFOjIsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P3Y6bX1yZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmVuY3J5cHQoZSxyLG4saSl9LGRlY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmRlY3J5cHQoZSxyLG4saSl9fX19KCl9KTtuLlN0cmVhbUNpcGhlcj1sLmV4dGVuZCh7X2RvRmluYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcHJvY2VzcyghMCl9LGJsb2NrU2l6ZToxfSk7dmFyIGg9ci5tb2RlPXt9LGQ9bi5CbG9ja0NpcGhlck1vZGU9aS5leHRlbmQoe2NyZWF0ZUVuY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUodCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZSh0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSl7dGhpcy5fY2lwaGVyPXQsdGhpcy5faXY9ZX19KSxmPWguQ0JDPWZ1bmN0aW9uKCl7dmFyIHQ9ZC5leHRlbmQoKTtmdW5jdGlvbiByKHQscixuKXt2YXIgaSxvPXRoaXMuX2l2O28/KGk9byx0aGlzLl9pdj1lKTppPXRoaXMuX3ByZXZCbG9jaztmb3IodmFyIHM9MDtzPG47cysrKXRbcitzXV49aVtzXX1yZXR1cm4gdC5FbmNyeXB0b3I9dC5leHRlbmQoe3Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplO3IuY2FsbCh0aGlzLHQsZSxpKSxuLmVuY3J5cHRCbG9jayh0LGUpLHRoaXMuX3ByZXZCbG9jaz10LnNsaWNlKGUsZStpKX19KSx0LkRlY3J5cHRvcj10LmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemUsbz10LnNsaWNlKGUsZStpKTtuLmRlY3J5cHRCbG9jayh0LGUpLHIuY2FsbCh0aGlzLHQsZSxpKSx0aGlzLl9wcmV2QmxvY2s9b319KSx0fSgpLHA9KHIucGFkPXt9KS5Qa2NzNz17cGFkOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTQqZSxuPXItdC5zaWdCeXRlcyVyLGk9bjw8MjR8bjw8MTZ8bjw8OHxuLHM9W10sYT0wO2E8bjthKz00KXMucHVzaChpKTt2YXIgYz1vLmNyZWF0ZShzLG4pO3QuY29uY2F0KGMpfSx1bnBhZDpmdW5jdGlvbih0KXt2YXIgZT0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1lfX07bi5CbG9ja0NpcGhlcj1sLmV4dGVuZCh7Y2ZnOmwuY2ZnLmV4dGVuZCh7bW9kZTpmLHBhZGRpbmc6cH0pLHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ7bC5yZXNldC5jYWxsKHRoaXMpO3ZhciBlPXRoaXMuY2ZnLHI9ZS5pdixuPWUubW9kZTt0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFP3Q9bi5jcmVhdGVFbmNyeXB0b3I6KHQ9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlJiZ0aGlzLl9tb2RlLl9fY3JlYXRvcj09dD90aGlzLl9tb2RlLmluaXQodGhpcyxyJiZyLndvcmRzKToodGhpcy5fbW9kZT10LmNhbGwobix0aGlzLHImJnIud29yZHMpLHRoaXMuX21vZGUuX19jcmVhdG9yPXQpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayh0LGUpfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5jZmcucGFkZGluZztyZXR1cm4gdGhpcy5feGZvcm1Nb2RlPT10aGlzLl9FTkNfWEZPUk1fTU9ERT8oZS5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksdD10aGlzLl9wcm9jZXNzKCEwKSk6KHQ9dGhpcy5fcHJvY2VzcyghMCksZS51bnBhZCh0KSksdH0sYmxvY2tTaXplOjR9KTt2YXIgXz1uLkNpcGhlclBhcmFtcz1pLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0KXt0aGlzLm1peEluKHQpfSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19KSxnPShyLmZvcm1hdD17fSkuT3BlblNTTD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQuY2lwaGVydGV4dCxyPXQuc2FsdDtyZXR1cm4ocj9vLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdChlKTplKS50b1N0cmluZyhjKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGUscj1jLnBhcnNlKHQpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09blswXSYmMTcwMTA3NjgzMT09blsxXSYmKGU9by5jcmVhdGUobi5zbGljZSgyLDQpKSxuLnNwbGljZSgwLDQpLHIuc2lnQnl0ZXMtPTE2KSxfLmNyZWF0ZSh7Y2lwaGVydGV4dDpyLHNhbHQ6ZX0pfX0sbT1uLlNlcmlhbGl6YWJsZUNpcGhlcj1pLmV4dGVuZCh7Y2ZnOmkuZXh0ZW5kKHtmb3JtYXQ6Z30pLGVuY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7bj10aGlzLmNmZy5leHRlbmQobik7dmFyIGk9dC5jcmVhdGVFbmNyeXB0b3IocixuKSxvPWkuZmluYWxpemUoZSkscz1pLmNmZztyZXR1cm4gXy5jcmVhdGUoe2NpcGhlcnRleHQ6byxrZXk6cixpdjpzLml2LGFsZ29yaXRobTp0LG1vZGU6cy5tb2RlLHBhZGRpbmc6cy5wYWRkaW5nLGJsb2NrU2l6ZTp0LmJsb2NrU2l6ZSxmb3JtYXR0ZXI6bi5mb3JtYXR9KX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtyZXR1cm4gbj10aGlzLmNmZy5leHRlbmQobiksZT10aGlzLl9wYXJzZShlLG4uZm9ybWF0KSx0LmNyZWF0ZURlY3J5cHRvcihyLG4pLmZpbmFsaXplKGUuY2lwaGVydGV4dCl9LF9wYXJzZTpmdW5jdGlvbih0LGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD9lLnBhcnNlKHQsdGhpcyk6dH19KSx5PShyLmtkZj17fSkuT3BlblNTTD17ZXhlY3V0ZTpmdW5jdGlvbih0LGUscixuLGkpe2lmKG58fChuPW8ucmFuZG9tKDgpKSxpKXM9dS5jcmVhdGUoe2tleVNpemU6ZStyLGhhc2hlcjppfSkuY29tcHV0ZSh0LG4pO2Vsc2UgdmFyIHM9dS5jcmVhdGUoe2tleVNpemU6ZStyfSkuY29tcHV0ZSh0LG4pO3ZhciBhPW8uY3JlYXRlKHMud29yZHMuc2xpY2UoZSksNCpyKTtyZXR1cm4gcy5zaWdCeXRlcz00KmUsXy5jcmVhdGUoe2tleTpzLGl2OmEsc2FsdDpufSl9fSx2PW4uUGFzc3dvcmRCYXNlZENpcGhlcj1tLmV4dGVuZCh7Y2ZnOm0uY2ZnLmV4dGVuZCh7a2RmOnl9KSxlbmNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPShuPXRoaXMuY2ZnLmV4dGVuZChuKSkua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsbi5zYWx0LG4uaGFzaGVyKTtuLml2PWkuaXY7dmFyIG89bS5lbmNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbik7cmV0dXJuIG8ubWl4SW4oaSksb30sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpO3ZhciBpPW4ua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsZS5zYWx0LG4uaGFzaGVyKTtyZXR1cm4gbi5pdj1pLml2LG0uZGVjcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pfX0pfSgpfShtZygpLEJnKCkpfShOZykpLE5nLmV4cG9ydHN9IWZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuQmxvY2tDaXBoZXIsbj1lLmFsZ28saT1bXSxvPVtdLHM9W10sYT1bXSxjPVtdLHU9W10sbD1bXSxoPVtdLGQ9W10sZj1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8MjU2O2UrKyl0W2VdPWU8MTI4P2U8PDE6ZTw8MV4yODM7dmFyIHI9MCxuPTA7Zm9yKGU9MDtlPDI1NjtlKyspe3ZhciBwPW5ebjw8MV5uPDwyXm48PDNebjw8NDtwPXA+Pj44XjI1NSZwXjk5LGlbcl09cCxvW3BdPXI7dmFyIF89dFtyXSxnPXRbX10sbT10W2ddLHk9MjU3KnRbcF1eMTY4NDMwMDgqcDtzW3JdPXk8PDI0fHk+Pj44LGFbcl09eTw8MTZ8eT4+PjE2LGNbcl09eTw8OHx5Pj4+MjQsdVtyXT15LHk9MTY4NDMwMDkqbV42NTUzNypnXjI1NypfXjE2ODQzMDA4KnIsbFtwXT15PDwyNHx5Pj4+OCxoW3BdPXk8PDE2fHk+Pj4xNixkW3BdPXk8PDh8eT4+PjI0LGZbcF09eSxyPyhyPV9edFt0W3RbbV5fXV1dLG5ePXRbdFtuXV0pOnI9bj0xfX0oKTt2YXIgcD1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0sXz1uLkFFUz1yLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7Zm9yKHZhciB0PXRoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5LGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMvNCxuPTQqKCh0aGlzLl9uUm91bmRzPXIrNikrMSksbz10aGlzLl9rZXlTY2hlZHVsZT1bXSxzPTA7czxuO3MrKylzPHI/b1tzXT1lW3NdOih1PW9bcy0xXSxzJXI/cj42JiZzJXI9PTQmJih1PWlbdT4+PjI0XTw8MjR8aVt1Pj4+MTYmMjU1XTw8MTZ8aVt1Pj4+OCYyNTVdPDw4fGlbMjU1JnVdKToodT1pWyh1PXU8PDh8dT4+PjI0KT4+PjI0XTw8MjR8aVt1Pj4+MTYmMjU1XTw8MTZ8aVt1Pj4+OCYyNTVdPDw4fGlbMjU1JnVdLHVePXBbcy9yfDBdPDwyNCksb1tzXT1vW3Mtcl1edSk7Zm9yKHZhciBhPXRoaXMuX2ludktleVNjaGVkdWxlPVtdLGM9MDtjPG47YysrKXtpZihzPW4tYyxjJTQpdmFyIHU9b1tzXTtlbHNlIHU9b1tzLTRdO2FbY109Yzw0fHxzPD00P3U6bFtpW3U+Pj4yNF1dXmhbaVt1Pj4+MTYmMjU1XV1eZFtpW3U+Pj44JjI1NV1dXmZbaVsyNTUmdV1dfX19LGVuY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5fa2V5U2NoZWR1bGUscyxhLGMsdSxpKX0sZGVjcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlKzFdO3RbZSsxXT10W2UrM10sdFtlKzNdPXIsdGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxsLGgsZCxmLG8pLHI9dFtlKzFdLHRbZSsxXT10W2UrM10sdFtlKzNdPXJ9LF9kb0NyeXB0QmxvY2s6ZnVuY3Rpb24odCxlLHIsbixpLG8scyxhKXtmb3IodmFyIGM9dGhpcy5fblJvdW5kcyx1PXRbZV1eclswXSxsPXRbZSsxXV5yWzFdLGg9dFtlKzJdXnJbMl0sZD10W2UrM11eclszXSxmPTQscD0xO3A8YztwKyspe3ZhciBfPW5bdT4+PjI0XV5pW2w+Pj4xNiYyNTVdXm9baD4+PjgmMjU1XV5zWzI1NSZkXV5yW2YrK10sZz1uW2w+Pj4yNF1eaVtoPj4+MTYmMjU1XV5vW2Q+Pj44JjI1NV1ec1syNTUmdV1ecltmKytdLG09bltoPj4+MjRdXmlbZD4+PjE2JjI1NV1eb1t1Pj4+OCYyNTVdXnNbMjU1JmxdXnJbZisrXSx5PW5bZD4+PjI0XV5pW3U+Pj4xNiYyNTVdXm9bbD4+PjgmMjU1XV5zWzI1NSZoXV5yW2YrK107dT1fLGw9ZyxoPW0sZD15fV89KGFbdT4+PjI0XTw8MjR8YVtsPj4+MTYmMjU1XTw8MTZ8YVtoPj4+OCYyNTVdPDw4fGFbMjU1JmRdKV5yW2YrK10sZz0oYVtsPj4+MjRdPDwyNHxhW2g+Pj4xNiYyNTVdPDwxNnxhW2Q+Pj44JjI1NV08PDh8YVsyNTUmdV0pXnJbZisrXSxtPShhW2g+Pj4yNF08PDI0fGFbZD4+PjE2JjI1NV08PDE2fGFbdT4+PjgmMjU1XTw8OHxhWzI1NSZsXSlecltmKytdLHk9KGFbZD4+PjI0XTw8MjR8YVt1Pj4+MTYmMjU1XTw8MTZ8YVtsPj4+OCYyNTVdPDw4fGFbMjU1JmhdKV5yW2YrK10sdFtlXT1fLHRbZSsxXT1nLHRbZSsyXT1tLHRbZSszXT15fSxrZXlTaXplOjh9KTtlLkFFUz1yLl9jcmVhdGVIZWxwZXIoXyl9KCksdC5BRVN9KG1nKCksYmcoKSxrZygpLEJnKCksUmcoKSl9KHtleHBvcnRzOnt9fSk7IWZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gdC5lbmMuSGV4fShtZygpKX0oe2V4cG9ydHM6e319KTshZnVuY3Rpb24odCl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB0Lm1vZGUuQ1RSPShlPXQubGliLkJsb2NrQ2lwaGVyTW9kZS5leHRlbmQoKSxyPWUuRW5jcnlwdG9yPWUuZXh0ZW5kKHtwcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgcj10aGlzLl9jaXBoZXIsbj1yLmJsb2NrU2l6ZSxpPXRoaXMuX2l2LG89dGhpcy5fY291bnRlcjtpJiYobz10aGlzLl9jb3VudGVyPWkuc2xpY2UoMCksdGhpcy5faXY9dm9pZCAwKTt2YXIgcz1vLnNsaWNlKDApO3IuZW5jcnlwdEJsb2NrKHMsMCksb1tuLTFdPW9bbi0xXSsxfDA7Zm9yKHZhciBhPTA7YTxuO2ErKyl0W2UrYV1ePXNbYV19fSksZS5EZWNyeXB0b3I9cixlKSx0Lm1vZGUuQ1RSO3ZhciBlLHJ9KG1nKCksUmcoKSl9KHtleHBvcnRzOnt9fSk7IWZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gdC5wYWQuTm9QYWRkaW5nPXtwYWQ6ZnVuY3Rpb24oKXt9LHVucGFkOmZ1bmN0aW9uKCl7fX0sdC5wYWQuTm9QYWRkaW5nfShtZygpLFJnKCkpfSh7ZXhwb3J0czp7fX0pO3ZhciB6Zz17fSxEZz17ZXhwb3J0czp7fX0sUGc9RGcuZXhwb3J0cz17djpbe25hbWU6InZlcnNpb24iLHJlZzovXihcZCopJC99XSxvOlt7bmFtZToib3JpZ2luIixyZWc6L14oXFMqKSAoXGQqKSAoXGQqKSAoXFMqKSBJUChcZCkgKFxTKikvLG5hbWVzOlsidXNlcm5hbWUiLCJzZXNzaW9uSWQiLCJzZXNzaW9uVmVyc2lvbiIsIm5ldFR5cGUiLCJpcFZlciIsImFkZHJlc3MiXSxmb3JtYXQ6IiVzICVzICVkICVzIElQJWQgJXMifV0sczpbe25hbWU6Im5hbWUifV0saTpbe25hbWU6ImRlc2NyaXB0aW9uIn1dLHU6W3tuYW1lOiJ1cmkifV0sZTpbe25hbWU6ImVtYWlsIn1dLHA6W3tuYW1lOiJwaG9uZSJ9XSx6Olt7bmFtZToidGltZXpvbmVzIn1dLHI6W3tuYW1lOiJyZXBlYXRzIn1dLHQ6W3tuYW1lOiJ0aW1pbmciLHJlZzovXihcZCopIChcZCopLyxuYW1lczpbInN0YXJ0Iiwic3RvcCJdLGZvcm1hdDoiJWQgJWQifV0sYzpbe25hbWU6ImNvbm5lY3Rpb24iLHJlZzovXklOIElQKFxkKSAoXFMqKS8sbmFtZXM6WyJ2ZXJzaW9uIiwiaXAiXSxmb3JtYXQ6IklOIElQJWQgJXMifV0sYjpbe3B1c2g6ImJhbmR3aWR0aCIscmVnOi9eKFRJQVN8QVN8Q1R8UlJ8UlMpOihcZCopLyxuYW1lczpbInR5cGUiLCJsaW1pdCJdLGZvcm1hdDoiJXM6JXMifV0sbTpbe3JlZzovXihcdyopIChcZCopIChbXHcvXSopKD86ICguKikpPy8sbmFtZXM6WyJ0eXBlIiwicG9ydCIsInByb3RvY29sIiwicGF5bG9hZHMiXSxmb3JtYXQ6IiVzICVkICVzICVzIn1dLGE6W3twdXNoOiJydHAiLHJlZzovXnJ0cG1hcDooXGQqKSAoW1x3XC0uXSopKD86XHMqXC8oXGQqKSg/OlxzKlwvKFxTKikpPyk/LyxuYW1lczpbInBheWxvYWQiLCJjb2RlYyIsInJhdGUiLCJlbmNvZGluZyJdLGZvcm1hdDpmdW5jdGlvbih0KXtyZXR1cm4gdC5lbmNvZGluZz8icnRwbWFwOiVkICVzLyVzLyVzIjp0LnJhdGU/InJ0cG1hcDolZCAlcy8lcyI6InJ0cG1hcDolZCAlcyJ9fSx7cHVzaDoiZm10cCIscmVnOi9eZm10cDooXGQqKSAoW1xTfCBdKikvLG5hbWVzOlsicGF5bG9hZCIsImNvbmZpZyJdLGZvcm1hdDoiZm10cDolZCAlcyJ9LHtuYW1lOiJjb250cm9sIixyZWc6L15jb250cm9sOiguKikvLGZvcm1hdDoiY29udHJvbDolcyJ9LHtuYW1lOiJydGNwIixyZWc6L15ydGNwOihcZCopKD86IChcUyopIElQKFxkKSAoXFMqKSk/LyxuYW1lczpbInBvcnQiLCJuZXRUeXBlIiwiaXBWZXIiLCJhZGRyZXNzIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiBudWxsIT10LmFkZHJlc3M/InJ0Y3A6JWQgJXMgSVAlZCAlcyI6InJ0Y3A6JWQifX0se3B1c2g6InJ0Y3BGYlRyckludCIscmVnOi9ecnRjcC1mYjooXCp8XGQqKSB0cnItaW50IChcZCopLyxuYW1lczpbInBheWxvYWQiLCJ2YWx1ZSJdLGZvcm1hdDoicnRjcC1mYjolcyB0cnItaW50ICVkIn0se3B1c2g6InJ0Y3BGYiIscmVnOi9ecnRjcC1mYjooXCp8XGQqKSAoW1x3LV9dKikoPzogKFtcdy1fXSopKT8vLG5hbWVzOlsicGF5bG9hZCIsInR5cGUiLCJzdWJ0eXBlIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiBudWxsIT10LnN1YnR5cGU/InJ0Y3AtZmI6JXMgJXMgJXMiOiJydGNwLWZiOiVzICVzIn19LHtwdXNoOiJleHQiLHJlZzovXmV4dG1hcDooXGQrKSg/OlwvKFx3KykpPyg/OiAodXJuOmlldGY6cGFyYW1zOnJ0cC1oZHJleHQ6ZW5jcnlwdCkpPyAoXFMqKSg/OiAoXFMqKSk/LyxuYW1lczpbInZhbHVlIiwiZGlyZWN0aW9uIiwiZW5jcnlwdC11cmkiLCJ1cmkiLCJjb25maWciXSxmb3JtYXQ6ZnVuY3Rpb24odCl7cmV0dXJuImV4dG1hcDolZCIrKHQuZGlyZWN0aW9uPyIvJXMiOiIldiIpKyh0WyJlbmNyeXB0LXVyaSJdPyIgJXMiOiIldiIpKyIgJXMiKyh0LmNvbmZpZz8iICVzIjoiIil9fSx7bmFtZToiZXh0bWFwQWxsb3dNaXhlZCIscmVnOi9eKGV4dG1hcC1hbGxvdy1taXhlZCkvfSx7cHVzaDoiY3J5cHRvIixyZWc6L15jcnlwdG86KFxkKikgKFtcd19dKikgKFxTKikoPzogKFxTKikpPy8sbmFtZXM6WyJpZCIsInN1aXRlIiwiY29uZmlnIiwic2Vzc2lvbkNvbmZpZyJdLGZvcm1hdDpmdW5jdGlvbih0KXtyZXR1cm4gbnVsbCE9dC5zZXNzaW9uQ29uZmlnPyJjcnlwdG86JWQgJXMgJXMgJXMiOiJjcnlwdG86JWQgJXMgJXMifX0se25hbWU6InNldHVwIixyZWc6L15zZXR1cDooXHcqKS8sZm9ybWF0OiJzZXR1cDolcyJ9LHtuYW1lOiJjb25uZWN0aW9uVHlwZSIscmVnOi9eY29ubmVjdGlvbjoobmV3fGV4aXN0aW5nKS8sZm9ybWF0OiJjb25uZWN0aW9uOiVzIn0se25hbWU6Im1pZCIscmVnOi9ebWlkOihbXlxzXSopLyxmb3JtYXQ6Im1pZDolcyJ9LHtuYW1lOiJtc2lkIixyZWc6L15tc2lkOiguKikvLGZvcm1hdDoibXNpZDolcyJ9LHtuYW1lOiJwdGltZSIscmVnOi9ecHRpbWU6KFxkKig/OlwuXGQqKSopLyxmb3JtYXQ6InB0aW1lOiVkIn0se25hbWU6Im1heHB0aW1lIixyZWc6L15tYXhwdGltZTooXGQqKD86XC5cZCopKikvLGZvcm1hdDoibWF4cHRpbWU6JWQifSx7bmFtZToiZGlyZWN0aW9uIixyZWc6L14oc2VuZHJlY3Z8cmVjdm9ubHl8c2VuZG9ubHl8aW5hY3RpdmUpL30se25hbWU6ImljZWxpdGUiLHJlZzovXihpY2UtbGl0ZSkvfSx7bmFtZToiaWNlVWZyYWciLHJlZzovXmljZS11ZnJhZzooXFMqKS8sZm9ybWF0OiJpY2UtdWZyYWc6JXMifSx7bmFtZToiaWNlUHdkIixyZWc6L15pY2UtcHdkOihcUyopLyxmb3JtYXQ6ImljZS1wd2Q6JXMifSx7bmFtZToiZmluZ2VycHJpbnQiLHJlZzovXmZpbmdlcnByaW50OihcUyopIChcUyopLyxuYW1lczpbInR5cGUiLCJoYXNoIl0sZm9ybWF0OiJmaW5nZXJwcmludDolcyAlcyJ9LHtwdXNoOiJjYW5kaWRhdGVzIixyZWc6L15jYW5kaWRhdGU6KFxTKikgKFxkKikgKFxTKikgKFxkKikgKFxTKikgKFxkKikgdHlwIChcUyopKD86IHJhZGRyIChcUyopIHJwb3J0IChcZCopKT8oPzogdGNwdHlwZSAoXFMqKSk/KD86IGdlbmVyYXRpb24gKFxkKikpPyg/OiBuZXR3b3JrLWlkIChcZCopKT8oPzogbmV0d29yay1jb3N0IChcZCopKT8vLG5hbWVzOlsiZm91bmRhdGlvbiIsImNvbXBvbmVudCIsInRyYW5zcG9ydCIsInByaW9yaXR5IiwiaXAiLCJwb3J0IiwidHlwZSIsInJhZGRyIiwicnBvcnQiLCJ0Y3B0eXBlIiwiZ2VuZXJhdGlvbiIsIm5ldHdvcmstaWQiLCJuZXR3b3JrLWNvc3QiXSxmb3JtYXQ6ZnVuY3Rpb24odCl7dmFyIGU9ImNhbmRpZGF0ZTolcyAlZCAlcyAlZCAlcyAlZCB0eXAgJXMiO3JldHVybiBlKz1udWxsIT10LnJhZGRyPyIgcmFkZHIgJXMgcnBvcnQgJWQiOiIldiV2IixlKz1udWxsIT10LnRjcHR5cGU/IiB0Y3B0eXBlICVzIjoiJXYiLG51bGwhPXQuZ2VuZXJhdGlvbiYmKGUrPSIgZ2VuZXJhdGlvbiAlZCIpLGUrPW51bGwhPXRbIm5ldHdvcmstaWQiXT8iIG5ldHdvcmstaWQgJWQiOiIldiIsZSs9bnVsbCE9dFsibmV0d29yay1jb3N0Il0/IiBuZXR3b3JrLWNvc3QgJWQiOiIldiJ9fSx7bmFtZToiZW5kT2ZDYW5kaWRhdGVzIixyZWc6L14oZW5kLW9mLWNhbmRpZGF0ZXMpL30se25hbWU6InJlbW90ZUNhbmRpZGF0ZXMiLHJlZzovXnJlbW90ZS1jYW5kaWRhdGVzOiguKikvLGZvcm1hdDoicmVtb3RlLWNhbmRpZGF0ZXM6JXMifSx7bmFtZToiaWNlT3B0aW9ucyIscmVnOi9eaWNlLW9wdGlvbnM6KFxTKikvLGZvcm1hdDoiaWNlLW9wdGlvbnM6JXMifSx7cHVzaDoic3NyY3MiLHJlZzovXnNzcmM6KFxkKikgKFtcd18tXSopKD86OiguKikpPy8sbmFtZXM6WyJpZCIsImF0dHJpYnV0ZSIsInZhbHVlIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3ZhciBlPSJzc3JjOiVkIjtyZXR1cm4gbnVsbCE9dC5hdHRyaWJ1dGUmJihlKz0iICVzIixudWxsIT10LnZhbHVlJiYoZSs9IjolcyIpKSxlfX0se3B1c2g6InNzcmNHcm91cHMiLHJlZzovXnNzcmMtZ3JvdXA6KFtceDIxXHgyM1x4MjRceDI1XHgyNlx4MjdceDJBXHgyQlx4MkRceDJFXHddKikgKC4qKS8sbmFtZXM6WyJzZW1hbnRpY3MiLCJzc3JjcyJdLGZvcm1hdDoic3NyYy1ncm91cDolcyAlcyJ9LHtuYW1lOiJtc2lkU2VtYW50aWMiLHJlZzovXm1zaWQtc2VtYW50aWM6XHM/KFx3KikgKFxTKikvLG5hbWVzOlsic2VtYW50aWMiLCJ0b2tlbiJdLGZvcm1hdDoibXNpZC1zZW1hbnRpYzogJXMgJXMifSx7cHVzaDoiZ3JvdXBzIixyZWc6L15ncm91cDooXHcqKSAoLiopLyxuYW1lczpbInR5cGUiLCJtaWRzIl0sZm9ybWF0OiJncm91cDolcyAlcyJ9LHtuYW1lOiJydGNwTXV4IixyZWc6L14ocnRjcC1tdXgpL30se25hbWU6InJ0Y3BSc2l6ZSIscmVnOi9eKHJ0Y3AtcnNpemUpL30se25hbWU6InNjdHBtYXAiLHJlZzovXnNjdHBtYXA6KFtcd18vXSopIChcUyopKD86IChcUyopKT8vLG5hbWVzOlsic2N0cG1hcE51bWJlciIsImFwcCIsIm1heE1lc3NhZ2VTaXplIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiBudWxsIT10Lm1heE1lc3NhZ2VTaXplPyJzY3RwbWFwOiVzICVzICVzIjoic2N0cG1hcDolcyAlcyJ9fSx7bmFtZToieEdvb2dsZUZsYWciLHJlZzovXngtZ29vZ2xlLWZsYWc6KFteXHNdKikvLGZvcm1hdDoieC1nb29nbGUtZmxhZzolcyJ9LHtwdXNoOiJyaWRzIixyZWc6L15yaWQ6KFtcZFx3XSspIChcdyspKD86IChbXFN8IF0qKSk/LyxuYW1lczpbImlkIiwiZGlyZWN0aW9uIiwicGFyYW1zIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiB0LnBhcmFtcz8icmlkOiVzICVzICVzIjoicmlkOiVzICVzIn19LHtwdXNoOiJpbWFnZWF0dHJzIixyZWc6bmV3IFJlZ0V4cCgiXmltYWdlYXR0cjooXFxkK3xcXCopW1xcc1xcdF0rKHNlbmR8cmVjdilbXFxzXFx0XSsoXFwqfFxcW1xcUytcXF0oPzpbXFxzXFx0XStcXFtcXFMrXFxdKSopKD86W1xcc1xcdF0rKHJlY3Z8c2VuZClbXFxzXFx0XSsoXFwqfFxcW1xcUytcXF0oPzpbXFxzXFx0XStcXFtcXFMrXFxdKSopKT8iKSxuYW1lczpbInB0IiwiZGlyMSIsImF0dHJzMSIsImRpcjIiLCJhdHRyczIiXSxmb3JtYXQ6ZnVuY3Rpb24odCl7cmV0dXJuImltYWdlYXR0cjolcyAlcyAlcyIrKHQuZGlyMj8iICVzICVzIjoiIil9fSx7bmFtZToic2ltdWxjYXN0IixyZWc6bmV3IFJlZ0V4cCgiXnNpbXVsY2FzdDooc2VuZHxyZWN2KSAoW2EtekEtWjAtOVxcLV9+OyxdKykoPzpcXHM/KHNlbmR8cmVjdikgKFthLXpBLVowLTlcXC1ffjssXSspKT8kIiksbmFtZXM6WyJkaXIxIiwibGlzdDEiLCJkaXIyIiwibGlzdDIiXSxmb3JtYXQ6ZnVuY3Rpb24odCl7cmV0dXJuInNpbXVsY2FzdDolcyAlcyIrKHQuZGlyMj8iICVzICVzIjoiIil9fSx7bmFtZToic2ltdWxjYXN0XzAzIixyZWc6L15zaW11bGNhc3Q6W1xzXHRdKyhbXFMrXHNcdF0rKSQvLG5hbWVzOlsidmFsdWUiXSxmb3JtYXQ6InNpbXVsY2FzdDogJXMifSx7bmFtZToiZnJhbWVyYXRlIixyZWc6L15mcmFtZXJhdGU6KFxkKyg/OiR8XC5cZCspKS8sZm9ybWF0OiJmcmFtZXJhdGU6JXMifSx7bmFtZToic291cmNlRmlsdGVyIixyZWc6L15zb3VyY2UtZmlsdGVyOiAqKGV4Y2x8aW5jbCkgKFxTKikgKElQNHxJUDZ8XCopIChcUyopICguKikvLG5hbWVzOlsiZmlsdGVyTW9kZSIsIm5ldFR5cGUiLCJhZGRyZXNzVHlwZXMiLCJkZXN0QWRkcmVzcyIsInNyY0xpc3QiXSxmb3JtYXQ6InNvdXJjZS1maWx0ZXI6ICVzICVzICVzICVzICVzIn0se25hbWU6ImJ1bmRsZU9ubHkiLHJlZzovXihidW5kbGUtb25seSkvfSx7bmFtZToibGFiZWwiLHJlZzovXmxhYmVsOiguKykvLGZvcm1hdDoibGFiZWw6JXMifSx7bmFtZToic2N0cFBvcnQiLHJlZzovXnNjdHAtcG9ydDooXGQrKSQvLGZvcm1hdDoic2N0cC1wb3J0OiVzIn0se25hbWU6Im1heE1lc3NhZ2VTaXplIixyZWc6L15tYXgtbWVzc2FnZS1zaXplOihcZCspJC8sZm9ybWF0OiJtYXgtbWVzc2FnZS1zaXplOiVzIn0se3B1c2g6InRzUmVmQ2xvY2tzIixyZWc6L150cy1yZWZjbGs6KFteXHM9XSopKD86PShcUyopKT8vLG5hbWVzOlsiY2xrc3JjIiwiY2xrc3JjRXh0Il0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiJ0cy1yZWZjbGs6JXMiKyhudWxsIT10LmNsa3NyY0V4dD8iPSVzIjoiIil9fSx7bmFtZToibWVkaWFDbGsiLHJlZzovXm1lZGlhY2xrOig/OmlkPShcUyopKT8gKihbXlxzPV0qKSg/Oj0oXFMqKSk/KD86ICpyYXRlPShcZCspXC8oXGQrKSk/LyxuYW1lczpbImlkIiwibWVkaWFDbG9ja05hbWUiLCJtZWRpYUNsb2NrVmFsdWUiLCJyYXRlTnVtZXJhdG9yIiwicmF0ZURlbm9taW5hdG9yIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3ZhciBlPSJtZWRpYWNsazoiO3JldHVybiBlKz1udWxsIT10LmlkPyJpZD0lcyAlcyI6IiV2JXMiLGUrPW51bGwhPXQubWVkaWFDbG9ja1ZhbHVlPyI9JXMiOiIiLGUrPW51bGwhPXQucmF0ZU51bWVyYXRvcj8iIHJhdGU9JXMiOiIiLGUrPW51bGwhPXQucmF0ZURlbm9taW5hdG9yPyIvJXMiOiIifX0se25hbWU6ImtleXdvcmRzIixyZWc6L15rZXl3ZHM6KC4rKSQvLGZvcm1hdDoia2V5d2RzOiVzIn0se25hbWU6ImNvbnRlbnQiLHJlZzovXmNvbnRlbnQ6KC4rKS8sZm9ybWF0OiJjb250ZW50OiVzIn0se25hbWU6ImJmY3BGbG9vckN0cmwiLHJlZzovXmZsb29yY3RybDooYy1vbmx5fHMtb25seXxjLXMpLyxmb3JtYXQ6ImZsb29yY3RybDolcyJ9LHtuYW1lOiJiZmNwQ29uZklkIixyZWc6L15jb25maWQ6KFxkKykvLGZvcm1hdDoiY29uZmlkOiVzIn0se25hbWU6ImJmY3BVc2VySWQiLHJlZzovXnVzZXJpZDooXGQrKS8sZm9ybWF0OiJ1c2VyaWQ6JXMifSx7bmFtZToiYmZjcEZsb29ySWQiLHJlZzovXmZsb29yaWQ6KC4rKSAoPzptLXN0cmVhbXxtc3RybSk6KC4rKS8sbmFtZXM6WyJpZCIsIm1TdHJlYW0iXSxmb3JtYXQ6ImZsb29yaWQ6JXMgbXN0cm06JXMifSx7cHVzaDoiaW52YWxpZCIsbmFtZXM6WyJ2YWx1ZSJdfV19O09iamVjdC5rZXlzKFBnKS5mb3JFYWNoKChmdW5jdGlvbih0KXtQZ1t0XS5mb3JFYWNoKChmdW5jdGlvbih0KXt0LnJlZ3x8KHQucmVnPS8oLiopLyksdC5mb3JtYXR8fCh0LmZvcm1hdD0iJXMiKX0pKX0pKTt2YXIgTWc9RGcuZXhwb3J0czshZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24odCl7cmV0dXJuIFN0cmluZyhOdW1iZXIodCkpPT09dD9OdW1iZXIodCk6dH0scj1mdW5jdGlvbih0LHIsbil7dmFyIGk9dC5uYW1lJiZ0Lm5hbWVzO3QucHVzaCYmIXJbdC5wdXNoXT9yW3QucHVzaF09W106aSYmIXJbdC5uYW1lXSYmKHJbdC5uYW1lXT17fSk7dmFyIG89dC5wdXNoP3t9Omk/clt0Lm5hbWVdOnI7IWZ1bmN0aW9uKHQscixuLGkpe2lmKGkmJiFuKXJbaV09ZSh0WzFdKTtlbHNlIGZvcih2YXIgbz0wO288bi5sZW5ndGg7bys9MSludWxsIT10W28rMV0mJihyW25bb11dPWUodFtvKzFdKSl9KG4ubWF0Y2godC5yZWcpLG8sdC5uYW1lcyx0Lm5hbWUpLHQucHVzaCYmclt0LnB1c2hdLnB1c2gobyl9LG49TWcsaT1SZWdFeHAucHJvdG90eXBlLnRlc3QuYmluZCgvXihbYS16XSk9KC4qKS8pO3QucGFyc2U9ZnVuY3Rpb24odCl7dmFyIGU9e30sbz1bXSxzPWU7cmV0dXJuIHQuc3BsaXQoLyhcclxufFxyfFxuKS8pLmZpbHRlcihpKS5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgZT10WzBdLGk9dC5zbGljZSgyKTsibSI9PT1lJiYoby5wdXNoKHtydHA6W10sZm10cDpbXX0pLHM9b1tvLmxlbmd0aC0xXSk7Zm9yKHZhciBhPTA7YTwobltlXXx8W10pLmxlbmd0aDthKz0xKXt2YXIgYz1uW2VdW2FdO2lmKGMucmVnLnRlc3QoaSkpcmV0dXJuIHIoYyxzLGkpfX0pKSxlLm1lZGlhPW8sZX07dmFyIG89ZnVuY3Rpb24odCxyKXt2YXIgbj1yLnNwbGl0KC89KC4rKS8sMik7cmV0dXJuIDI9PT1uLmxlbmd0aD90W25bMF1dPWUoblsxXSk6MT09PW4ubGVuZ3RoJiZyLmxlbmd0aD4xJiYodFtuWzBdXT12b2lkIDApLHR9O3QucGFyc2VQYXJhbXM9ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoLztccz8vKS5yZWR1Y2Uobyx7fSl9LHQucGFyc2VGbXRwQ29uZmlnPXQucGFyc2VQYXJhbXMsdC5wYXJzZVBheWxvYWRzPWZ1bmN0aW9uKHQpe3JldHVybiB0LnRvU3RyaW5nKCkuc3BsaXQoIiAiKS5tYXAoTnVtYmVyKX0sdC5wYXJzZVJlbW90ZUNhbmRpZGF0ZXM9ZnVuY3Rpb24odCl7Zm9yKHZhciByPVtdLG49dC5zcGxpdCgiICIpLm1hcChlKSxpPTA7aTxuLmxlbmd0aDtpKz0zKXIucHVzaCh7Y29tcG9uZW50Om5baV0saXA6bltpKzFdLHBvcnQ6bltpKzJdfSk7cmV0dXJuIHJ9LHQucGFyc2VJbWFnZUF0dHJpYnV0ZXM9ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoIiAiKS5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiB0LnN1YnN0cmluZygxLHQubGVuZ3RoLTEpLnNwbGl0KCIsIikucmVkdWNlKG8se30pfSkpfSx0LnBhcnNlU2ltdWxjYXN0U3RyZWFtTGlzdD1mdW5jdGlvbih0KXtyZXR1cm4gdC5zcGxpdCgiOyIpLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoIiwiKS5tYXAoKGZ1bmN0aW9uKHQpe3ZhciByLG49ITE7cmV0dXJuIn4iIT09dFswXT9yPWUodCk6KHI9ZSh0LnN1YnN0cmluZygxLHQubGVuZ3RoKSksbj0hMCkse3NjaWQ6cixwYXVzZWQ6bn19KSl9KSl9fSh6Zyk7dmFyIFVnO25ldyBUZXh0RGVjb2RlcixuZXcgVGV4dEVuY29kZXIsInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJih3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluY2x1ZGVzKCJfcnRjX2RlYnVnXyIpfHxudWxsIT09KFVnPXdpbmRvdy5sb2NhbFN0b3JhZ2UpJiZ2b2lkIDAhPT1VZyYmVWcuZ2V0SXRlbSgiX3J0Y19kZWJ1Z18iKSk7Y29uc3QgRmc9e2dldE5BTFVuaXRzKHQpe2xldCBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdJiZhcmd1bWVudHNbMV07aWYodC5sZW5ndGgtdC5wb3NpdGlvbjw0KXJldHVybltdO2NvbnN0e3Bvc2l0aW9uOnJ9PXQ7cmV0dXJuIDE9PT10LmdldEludDMyKHIpfHwwPT09dC5nZXRJbnQxNihyKSYmMT09PXQuZ2V0SW50OChyKzIpP0ZnLmdldEFubmV4Yk5hbHModCxlKTpGZy5nZXRBdmNjTmFscyh0LGUpfSxnZXRBbm5leGJOYWxzKHQsZSl7Y29uc3Qgcj1bXTtsZXQgbj1GZy5nZXRIZWFkZXJQb3NpdGlvbkFubmV4Qih0KSxpPW4ucG9zLG89aTtmb3IoO2k8dC5sZW5ndGgtNDspe2NvbnN0IHM9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIuc2xpY2UoaSxpK24uaGVhZGVyTGVuZ3RoKSk7bi5wb3M9PT10LnBvc2l0aW9uJiZ0LnNraXAobi5oZWFkZXJMZW5ndGgpLG49RmcuZ2V0SGVhZGVyUG9zaXRpb25Bbm5leEIodCksbz1uLnBvcztjb25zdCBhPXtoZWFkZXI6cyxib2R5Om5ldyBVaW50OEFycmF5KHQuYnVmZmVyLnNsaWNlKGkrcy5ieXRlTGVuZ3RoLG8pKSx0eXBlOi0xfTtlP0ZnLmFuYWx5c2VIMjY1TmFsKGEpOkZnLmFuYWx5c2VOYWwoYSksKGEudHlwZTw9OXx8ZSYmYS50eXBlPD00MCkmJjAhPT1hLnR5cGUmJnIucHVzaChhKSx0LnNraXAoby10LnBvc2l0aW9uKSxpPW99cmV0dXJuIHJ9LGdldEF2Y2NOYWxzKHQsZSl7Y29uc3Qgcj1bXTtmb3IoO3QucG9zaXRpb248dC5sZW5ndGgtNDspe2NvbnN0IG49dC5nZXRJbnQzMih0LnBvc2l0aW9uKTtpZighKHQubGVuZ3RoLXQucG9zaXRpb24+PW4pKWJyZWFrO3tjb25zdCBpPW5ldyBVaW50OEFycmF5KHQuYnVmZmVyLnNsaWNlKHQucG9zaXRpb24sdC5wb3NpdGlvbis0KSk7dC5za2lwKDQpO2NvbnN0IG89bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIuc2xpY2UodC5wb3NpdGlvbix0LnBvc2l0aW9uK24pKTt0LnNraXAobik7Y29uc3Qgcz17aGVhZGVyOmksYm9keTpvLHR5cGU6LTF9O2U/RmcuYW5hbHlzZUgyNjVOYWwocyk6RmcuYW5hbHlzZU5hbChzKSxzLnR5cGU8PTkmJjAhPT1zLnR5cGUmJnIucHVzaChzKX19cmV0dXJuIHJ9LGFuYWx5c2VOYWwodCl7Y29uc3QgZT0zMSZ0LmJvZHlbMF07c3dpdGNoKHQudHlwZT1lLGUpe2Nhc2UgMTp0Lm5kcj0hMDticmVhaztjYXNlIDU6dC5pZHI9ITA7YnJlYWs7Y2FzZSA2OnQuc2VpPSEwO2JyZWFrO2Nhc2UgNzp0LnNwcz0hMDticmVhaztjYXNlIDg6dC5wcHM9ITB9fSxhbmFseXNlSDI2NU5hbCh0KXtjb25zdCBlPSgxMjYmdC5ib2R5WzBdKT4+MTtzd2l0Y2godC50eXBlPWUsZSl7Y2FzZSAzOTpjYXNlIDQwOnQuc2VpPSEwfX0sZ2V0SGVhZGVyUG9zaXRpb25Bbm5leEIodCl7bGV0IGU9dC5wb3NpdGlvbixyPTA7Y29uc3Qgbj10Lmxlbmd0aDtmb3IoOzMhPT1yJiY0IT09ciYmZTxuLTQ7KTA9PT10LmdldEludDE2KGUpPzE9PT10LmdldEludDE2KGUrMik/cj00OjE9PT10LmdldEludDgoZSsyKT9yPTM6ZSsrOmUrKztyZXR1cm4gZT09PW4tNCYmKDA9PT10LmdldEludDE2KGUpPzE9PT10LmdldEludDE2KGUrMik/cj00OmU9bjooZSsrLDA9PT10LmdldEludDE2KGUpJiYxPT09dC5nZXRJbnQ4KGUpP3I9MzplPW4pKSx7cG9zOmUsaGVhZGVyTGVuZ3RoOnJ9fSxnZXRDb2RlY05hbWVGcm9tRnJhbWUodCxlKXtjb25zdHttaW1lVHlwZTpyLHBheWxvYWRUeXBlOm59PXQuZ2V0TWV0YWRhdGEoKTtyZXR1cm4gcj9mdW5jdGlvbih0KXtyZXR1cm4gdC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJoMjY1Iik/Y2cuSDI2NTp0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImgyNjQiKT9jZy5IMjY0OnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygidnA4Iik/Y2cuVlA4OnZvaWQgMH0ocik6biYmZT9lW25dOnZvaWQgMH0saXNIMjY1VmlkZW9GcmFtZSh0KXt2YXIgZTtyZXR1cm4oKG51bGw9PT0oZT10LmdldE1ldGFkYXRhKXx8dm9pZCAwPT09ZXx8bnVsbD09PShlPWUuY2FsbCh0KSl8fHZvaWQgMD09PWU/dm9pZCAwOmUubWltZVR5cGUpfHwiIikudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiaDI2NSIpfX07Y2xhc3Mgamd7Y29uc3RydWN0b3IodCl7bGwodGhpcywiX3Bvc2l0aW9uIiwwKSxsbCh0aGlzLCJfZGF0YXZpZXciLHZvaWQgMCksdGhpcy5fZGF0YXZpZXc9bmV3IERhdGFWaWV3KHQpfWdldCBsZW5ndGgoKXtyZXR1cm4gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aH1nZXQgYnVmZmVyKCl7cmV0dXJuIHRoaXMuX2RhdGF2aWV3LmJ1ZmZlcn1zZXQgcG9zaXRpb24odCl7dGhpcy5fcG9zaXRpb249dH1nZXQgcG9zaXRpb24oKXtyZXR1cm4gdGhpcy5fcG9zaXRpb259YmFjayh0KXt0aGlzLnBvc2l0aW9uLT10fWdldFVpbnQ4KHQpe3JldHVybiB0aGlzLl9kYXRhdmlldy5nZXRVaW50OCh0KX1nZXRJbnQ4KHQpe3JldHVybiB0aGlzLl9kYXRhdmlldy5nZXRJbnQ4KHQpfWdldEludDE2KHQpe3JldHVybiB0aGlzLl9kYXRhdmlldy5nZXRJbnQxNih0KX1nZXRVaW50MTYodCl7cmV0dXJuIHRoaXMuX2RhdGF2aWV3LmdldFVpbnQxNih0KX1nZXRVaW50MzIodCl7cmV0dXJuIHRoaXMuX2RhdGF2aWV3LmdldFVpbnQzMih0KX1nZXRJbnQzMih0KXtyZXR1cm4gdGhpcy5fZGF0YXZpZXcuZ2V0SW50MzIodCl9c2tpcCh0KXtjb25zdCBlPU1hdGguZmxvb3IodC80KSxyPXQlNDtmb3IobGV0IG49MDtuPGU7bisrKWpnLnJlYWRCeXRlKHRoaXMsNCk7cj4wJiZqZy5yZWFkQnl0ZSh0aGlzLHIpfXN0YXRpYyByZWFkQnl0ZSh0LGUscil7bGV0IG47c3dpdGNoKGUpe2Nhc2UgMTpuPXI/dC5nZXRJbnQ4KHQucG9zaXRpb24pOnQuZ2V0VWludDgodC5wb3NpdGlvbik7YnJlYWs7Y2FzZSAyOm49cj90LmdldEludDE2KHQucG9zaXRpb24pOnQuZ2V0VWludDE2KHQucG9zaXRpb24pO2JyZWFrO2Nhc2UgMzppZihyKXRocm93IG5ldyBFcnJvcigibm90IHN1cHBvcnRlZCBmb3IgcmVhZEJ5dGUgMyIpO249dC5nZXRVaW50OCh0LnBvc2l0aW9uKTw8MTYsbnw9dC5nZXRVaW50OCh0LnBvc2l0aW9uKzEpPDw4LG58PXQuZ2V0VWludDgodC5wb3NpdGlvbisyKTticmVhaztjYXNlIDQ6bj1yP3QuZ2V0SW50MzIodC5wb3NpdGlvbik6dC5nZXRVaW50MzIodC5wb3NpdGlvbik7YnJlYWs7Y2FzZSA4OmlmKHIpdGhyb3cgbmV3IEVycm9yKCJub3Qgc3VwcG9ydGVkIGZvciByZWFkQm9keSA4Iik7bj10LmdldFVpbnQzMih0LnBvc2l0aW9uKTw8MzIsbnw9dC5nZXRVaW50MzIodC5wb3NpdGlvbis0KTticmVhaztkZWZhdWx0Om49IiJ9cmV0dXJuIHQucG9zaXRpb24rPWUsbn1yZWFkVWludDgoKXtyZXR1cm4gamcucmVhZEJ5dGUodGhpcywxKX1yZWFkVWludDE2KCl7cmV0dXJuIGpnLnJlYWRCeXRlKHRoaXMsMil9cmVhZFVpbnQyNCgpe3JldHVybiBqZy5yZWFkQnl0ZSh0aGlzLDMpfXJlYWRVaW50MzIoKXtyZXR1cm4gamcucmVhZEJ5dGUodGhpcyw0KX1yZWFkVWludDY0KCl7cmV0dXJuIGpnLnJlYWRCeXRlKHRoaXMsOCl9cmVhZEludDgoKXtyZXR1cm4gamcucmVhZEJ5dGUodGhpcywxLCEwKX1yZWFkSW50MTYoKXtyZXR1cm4gamcucmVhZEJ5dGUodGhpcywyLCEwKX1yZWFkSW50MzIoKXtyZXR1cm4gamcucmVhZEJ5dGUodGhpcyw0LCEwKX13cml0ZVVpbnQzMih0KXtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoW3Q+Pj4yNCYyNTUsdD4+PjE2JjI1NSx0Pj4+OCYyNTUsMjU1JnRdKX19dmFyIEhnPSh0PT4odFt0LmludGVybmFsPTBdPSJpbnRlcm5hbCIsdFt0LmV4dGVybmFsPTFdPSJleHRlcm5hbCIsdFt0LmJ5cGFzcz0yXT0iYnlwYXNzIix0KSkoSGd8fHt9KTtjb25zdCBLZz1uZXcgVWludDhBcnJheShbMTA5LDE2Nyw1MywxOTAsMTAzLDkwLDcyLDEsMTcwLDg5LDYzLDE2NCwxOTQsMTk5LDE5LDg1XSksSmc9bmV3IFVpbnQ4QXJyYXkoWzEwOSwxNjcsNTMsMTkwLDEwMyw5MCw3MiwxLDE3MCw4OSw2MywxNjQsMTk0LDE5OSwxOSw4NF0pLFdnPW5ldyBVaW50OEFycmF5KFszMSwyMzksMyw1MCwyNDIsMTIwLDc2LDg1LDE2OSw0MiwxNjEsOTEsNzUsMTg2LDIyXSk7ZnVuY3Rpb24gWmcodCl7Y29uc3QgZT1bXTtmb3IoO3Q+PTI1NTspdC09MjU1LGUucHVzaCgyNTUpO3JldHVybiBlLnB1c2godCksbmV3IFVpbnQ4QXJyYXkoZSl9ZnVuY3Rpb24gR2codCl7bGV0IGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjAscj0wO2Zvcig7MjU1PT09dFtlXSYmZTx0LmJ5dGVMZW5ndGg7KWUrKyxyKz0yNTU7cmV0dXJuIGU8dC5ieXRlTGVuZ3RoJiYocis9dFtlKytdKSxbcixlXX1jb25zdCBWZz1uZXcgVWludDhBcnJheShbODAsMV0pO2NsYXNzICRne3N0YXRpYyBnZW5lcmF0ZVNFSSh0LGUpe2xldCByPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdJiZhcmd1bWVudHNbMl07Y29uc3Qgbj1uZXcgVWludDhBcnJheShbMCwwLDAsMV0pLGk9ZT9WZzpuZXcgVWludDhBcnJheShbNl0pLG89bmV3IFVpbnQ4QXJyYXkoWzVdKSxzPSRnLl9fdXVpZHx8KHI/S2c6SmcpLGE9WmcodC5ieXRlTGVuZ3RoK3MuYnl0ZUxlbmd0aCksYz0odD0+e2NvbnN0IGU9W107bGV0IHI9MDtmb3IoY29uc3QgbiBvZiB0KXI+PTImJm48PTMmJihlLnB1c2goMykscj0wKSwwPT09bj9yKys6cj0wLGUucHVzaChuKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoZSl9KSh0KTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWy4uLm4sLi4uaSwuLi5vLC4uLmEsLi4ucywuLi5jLDEyOF0pfXN0YXRpYyBkZWNvZGVTRUlCb2R5KHQsZSl7Y29uc3Qgcj0odD0+e2NvbnN0IGU9W107Zm9yKGxldCByPTA7cjx0Lmxlbmd0aDtyKyspdFtyXTw9MyYmMD09PXRbci0xXSYmMD09PXRbci0yXXx8ZS5wdXNoKHRbcl0pO3JldHVybiBuZXcgVWludDhBcnJheShlKX0pKHQ9dC5zbGljZSgwLHQubGVuZ3RoLTEpKTtpZihyLmJ5dGVMZW5ndGg8MilyZXR1cm47bGV0IG49MDtjb25zdCBpPWU/MjoxO2lmKDUhPT1yW2ldJiYxMDAhPT1yW2ldKXJldHVybjtuKz0xK2k7Y29uc3RbbyxzXT1HZyhyLG4pO249cztsZXQgYT0yO2NvbnN0IGM9bitvO3IuYnl0ZUxlbmd0aD49SmcuYnl0ZUxlbmd0aCYmbz49SmcuYnl0ZUxlbmd0aCYmKHIuc2xpY2UobixuK0pnLmJ5dGVMZW5ndGgpLnRvU3RyaW5nKCk9PT1KZy50b1N0cmluZygpfHxyLnNsaWNlKG4sbitXZy5ieXRlTGVuZ3RoKS50b1N0cmluZygpPT09V2cudG9TdHJpbmcoKSk/KG4rPUpnLmJ5dGVMZW5ndGgsYT0xKTpyLmJ5dGVMZW5ndGg+PUpnLmJ5dGVMZW5ndGgmJm8+PUpnLmJ5dGVMZW5ndGgmJnIuc2xpY2UobixuK0tnLmJ5dGVMZW5ndGgpLnRvU3RyaW5nKCk9PT1LZy50b1N0cmluZygpJiYobis9S2cuYnl0ZUxlbmd0aCxhPTApO3JldHVybnt0eXBlOmEscGF5bG9hZDpyLnNsaWNlKG4sYyl9fXN0YXRpYyBwYXJzZUludGVybmFsU0VJKHQpe2NvbnN0IGU9bmV3IE1hcDtsZXQgcj0wO2lmKDA9PT10LnR5cGUpe2Zvcig7dC5wYXlsb2FkLmJ5dGVMZW5ndGgtcj49Mjspe2NvbnN0W24saV09R2codC5wYXlsb2FkLHIpO3I9aTtjb25zdFtvLHNdPUdnKHQucGF5bG9hZCxyKTtpZihyPXMsZS5nZXQobil8fCEobzw9dC5wYXlsb2FkLmJ5dGVMZW5ndGgtcikpYnJlYWs7ZS5zZXQobix0LnBheWxvYWQuc2xpY2UocixyK28pKSxyKz1vfXJldHVybiBlfX1zdGF0aWMgbWFrZUludGVybmFsU2VpKHQpe2NvbnN0IGU9W107Zm9yKGNvbnN0W2ksb11vZiB0KXtjb25zdCB0PVpnKGkpLHI9Wmcoby5ieXRlTGVuZ3RoKTtlLnB1c2godCxyLG8pfWNvbnN0IHI9ZS5yZWR1Y2UoKCh0LGUpPT50K2UuYnl0ZUxlbmd0aCksMCksbj1uZXcgVWludDhBcnJheShyKTtyZXR1cm4gZS5yZWR1Y2UoKCh0LGUpPT4obi5zZXQoZSx0KSx0K2UuYnl0ZUxlbmd0aCkpLDApLG59fWxsKCRnLCJfX3V1aWQiLHZvaWQgMCk7Y2xhc3MgWGd7Y29uc3RydWN0b3IodCl7bGwodGhpcywic2tpcEZpbHRlciIsdm9pZCAwKSxsbCh0aGlzLCJwb3N0TWVzc2FnZSIsdm9pZCAwKSxsbCh0aGlzLCJjdXJyZW50Q29kZWMiLHZvaWQgMCksbGwodGhpcywicGF5bG9hZE1hcCIsdm9pZCAwKSx0aGlzLnNraXBGaWx0ZXI9dC5za2lwRmlsdGVyLHRoaXMucG9zdE1lc3NhZ2U9dC5wb3N0TWVzc2FnZSx0aGlzLnBheWxvYWRNYXA9dC5wYXlsb2FkTWFwfXRyYW5zZm9ybSh0LGUpe3ZhciByO2NvbnN0IG49bnVsbCE9PShyPUZnLmdldENvZGVjTmFtZUZyb21GcmFtZSh0LHRoaXMucGF5bG9hZE1hcCkpJiZ2b2lkIDAhPT1yP3I6dGhpcy5jdXJyZW50Q29kZWM7aWYobiE9PWNnLkgyNjQmJm4hPT1jZy5IMjY1KXJldHVybiB2b2lkIGUuZW5xdWV1ZSh0KTtGZy5nZXROQUxVbml0cyhuZXcgamcodC5kYXRhKSxuPT09Y2cuSDI2NSkuZm9yRWFjaCgodD0+e2lmKHQuc2VpKXtjb25zdCBlPSRnLmRlY29kZVNFSUJvZHkodC5ib2R5LG49PT1jZy5IMjY1KTtlJiYodGhpcy5za2lwRmlsdGVyfHxlLnR5cGU9PT1IZy5leHRlcm5hbCkmJnRoaXMucG9zdE1lc3NhZ2UoZSl9fSkpLGUuZW5xdWV1ZSh0KX1zZXRDb2RlYyh0KXt0aGlzLmN1cnJlbnRDb2RlYz10fX0idW5kZWZpbmVkIiE9dHlwZW9mIHNlbGYmJiJEZWRpY2F0ZWRXb3JrZXJHbG9iYWxTY29wZSI9PT1zZWxmLmNvbnN0cnVjdG9yLm5hbWUmJnNlbGYuYWRkRXZlbnRMaXN0ZW5lcigicnRjdHJhbnNmb3JtIiwodD0+e2NvbnN0e3RyYW5zZm9ybWVyOmV9PXQse3N0cmVhbUlkOnIsc2tpcEZpbHRlcjpuLHBheWxvYWRNYXA6aX09ZS5vcHRpb25zLG89bmV3IFhnKHtwb3N0TWVzc2FnZTp0PT57c2VsZi5wb3N0TWVzc2FnZSh7c3RyZWFtSWQ6cixtc2c6dH0sW3QucGF5bG9hZC5idWZmZXJdKX0sc2tpcEZpbHRlcjpuLHBheWxvYWRNYXA6aX0pLHM9bmV3IFRyYW5zZm9ybVN0cmVhbSh7dHJhbnNmb3JtOm8udHJhbnNmb3JtLmJpbmQobyl9KTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCh0PT57bGV0e2RhdGE6ZX09dDtjb25zdHt0eXBlOm4sY29udGVudDppfT1lOyJzZXRDb2RlYyI9PT1uJiZyPT09ZS5zdHJlYW1JZCYmby5zZXRDb2RlYyhpKX0pKSxlLnJlYWRhYmxlLnBpcGVUaHJvdWdoKHMpLnBpcGVUbyh0LnRyYW5zZm9ybWVyLndyaXRhYmxlKX0pKX0oKTsK",BS=typeof window<"u"&&window.Blob&&new Blob([atob(uI)],{type:"text/javascript;charset=utf-8"});function ND(){let t;try{if(t=BS&&(fi||window.webkitURL).createObjectURL(BS),!t)throw"";return new Worker(t)}catch{return new Worker("data:application/javascript;base64,"+uI)}finally{!(typeof window<"u"&&navigator.userAgent.indexOf("Trident/")>0)&&t&&(fi||window.webkitlRL).revokeObjectURL(t)}}var mI=(t=>(t.RECONNECT="ice-reconnect",t.LEAVE="leave_room",t))(mI||{});const Rd=wo.NORMAL_MODE;class lo{constructor(e,i,s){m(this,"engineDestroyed",!1),m(this,"avSync",!0),m(this,"callId",void 0),m(this,"streamRTT",{}),m(this,"useCloudProxy",!1),m(this,"videoProfile",void 0),m(this,"audioProfileManager",void 0),m(this,"extensionManager",void 0),m(this,"userPriority",new Map),m(this,"expectedIDC",void 0),m(this,"autoPlayPolicy",void 0),m(this,"joinRoomConfig",void 0),m(this,"signalingManager",void 0),m(this,"peerConnection",void 0),m(this,"pubSubLock",new Ni("pubSubLock")),m(this,"pcKillSwitch",I({ctor_sdpsemantics_add:!0,ctor_encodedinsetablestream_add:!0,sld_rtcpfb_rrtr_add:!0,sld_ext_sdesmid_remove:!0,sld_fmtp_sps_add:!0,sld_fmtp_bitrate_add:!0,sld_fmtp_opus_add:!0,sld_iceoption_renomination:!0},ae("PC_KILLSWITCH"))),m(this,"visibility",!0),m(this,"rtsLimiter",{e2e:new Lm(Rd),e2s:new Lm(Rd),boradcast:new Lm(Rd),conf:void 0,rtsMode:Rd}),m(this,"serverConfig",void 0),m(this,"mediaParams",void 0),m(this,"subscribeFallbackOption",void 0),m(this,"joinRoomParams",void 0),m(this,"isPreConnection",!1),m(this,"_handler",void 0),m(this,"monitor",void 0),m(this,"enableFallbackHandler",!!ae("ENABLE_FALLBACK_HANDLER")),m(this,"enableStandardHandler",!!ae("ENABLE_STANDARD_HANDLER")),m(this,"_businessId",void 0),m(this,"_userStreamConfig",new Map),m(this,"_localAudioTrackDumpConfig",{[V.STREAM_INDEX_MAIN]:{callback:void 0,frameSize:void 0},[V.STREAM_INDEX_SCREEN]:{callback:void 0,frameSize:void 0}}),m(this,"_remoteAudioTrackDumpConfig",{[V.STREAM_INDEX_MAIN]:new Map,[V.STREAM_INDEX_SCREEN]:new Map}),m(this,"_targetCodec",void 0),m(this,"_targetScreenCodec",void 0),m(this,"earMonitorSettings",{[V.STREAM_INDEX_MAIN]:{position:It.NONE,volume:100},[V.STREAM_INDEX_SCREEN]:{position:It.NONE,volume:100}}),m(this,"localVideoTrack",void 0),m(this,"localAudioTrack",void 0),m(this,"publicAudioVolume",new Map),m(this,"_receiveSEIWorker",void 0),this.id=e,this.appId=i,this.monitor=ke(e),this.expectedIDC=s?.expectedIDC,this.autoPlayPolicy=s?.autoPlayPolicy,this.audioProfileManager=new uO(i),this.extensionManager=new PD(e),this.joinRoomConfig=new _i(e),this.signalingManager=new LD(this),this.videoProfile=new ED(this)}set businessId(e){var i;this._businessId=e,(i=this.monitor)===null||i===void 0||i.set({rtc_business_id:e})}get businessId(){return this._businessId}set handler(e){var i;e&&this.resetPubSubLock("ice-reconnect"),(i=this._handler)===null||i===void 0||i.destroy(),this._handler=e}get handler(){return this._handler}get role(){return this.visibility?xh.NORMAL_USER:xh.SILENT_USER}setTargetCodec(e){if(!e)return;const i=pc(e);i&&(this._targetCodec=i)}setTargetScreenCodec(e){if(!e)return;const i=pc(e);i&&(this._targetScreenCodec=i)}getTargetCodec(){return this._targetCodec}getTargetScreenCodec(){return this._targetScreenCodec}resetPubSubLock(e){this.pubSubLock.closeReason=e,this.pubSubLock=new Ni("pubSubLock")}setUserStreamConf(e,i,s){const o=this._userStreamConfig.get(e)||{},r=o[i]||{};o[i]=I(I({},r),s),this._userStreamConfig.set(e,o)}getRemoteMirrorType(e,i){var s;return!((s=this._userStreamConfig.get(e))===null||s===void 0||(s=s[i])===null||s===void 0||!s.mirrorType)}get rtsMode(){return this.rtsLimiter.rtsMode}setRTSMode(e){this.rtsLimiter.e2e.setLimitMode(e),this.rtsLimiter.boradcast.setLimitMode(e),this.rtsLimiter.e2s.setLimitMode(e),this.rtsLimiter.rtsMode=e}setRtsQpsConf(e){this.rtsLimiter.e2e.setQPS(e?.rts_qps_interval,e?.rts_e2e_qps_value),this.rtsLimiter.boradcast.setQPS(e?.rts_qps_interval,e?.rts_broadcast_qps_value),this.rtsLimiter.e2s.setQPS(e?.rts_qps_interval,e?.rts_e2s_qps_value),this.rtsLimiter.conf=e}get receiveSEIWorker(){return this._receiveSEIWorker||(this._receiveSEIWorker=new ND),this._receiveSEIWorker}updatePCKillSwitch(e){this.pcKillSwitch=I(I({},this.pcKillSwitch),e)}destroy(){this.engineDestroyed=!0,this.signalingManager.destroy(),this.userPriority.clear(),this.avSync=!0,this._localAudioTrackDumpConfig={[V.STREAM_INDEX_MAIN]:{callback:void 0,frameSize:void 0},[V.STREAM_INDEX_SCREEN]:{callback:void 0,frameSize:void 0}},this._remoteAudioTrackDumpConfig[V.STREAM_INDEX_MAIN].clear(),this._remoteAudioTrackDumpConfig[V.STREAM_INDEX_SCREEN].clear(),this.extensionManager.destroy(),this.earMonitorSettings={[V.STREAM_INDEX_MAIN]:{position:It.NONE,volume:100},[V.STREAM_INDEX_SCREEN]:{position:It.NONE,volume:100}},this.publicAudioVolume.clear()}}function Hi(t,e,i){const s=i.value;return i.value=async function(){var o,r;const n=await this._ctx.pubSubLock.lock();((o=this._ctx.handler)===null||o===void 0?void 0:o.name)!=="chrome"&&((r=this._ctx.handler)===null||r===void 0?void 0:r.name)!=="standard"||n();try{const{closeReason:p}=this._ctx.pubSubLock;if(p)throw new G(C.UNEXPECTED_ERROR,p);for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return await s.apply(this,c)}finally{var l,u;((l=this._ctx.handler)===null||l===void 0?void 0:l.name)!=="chrome"&&((u=this._ctx.handler)===null||u===void 0?void 0:u.name)!=="standard"&&n()}},i}function Ye(t,e,i){const s=i.value;return i.value=async function(){var o;if((o=this._room)!==null&&o!==void 0&&o.config.isRTSOnlyRoom())throw new G(C.NOT_ALLOWED_IN_RTS_ROOM,"Engine.".concat(e,"() is not allowed in RTS room"));for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return await s.apply(this,n)},i}m(lo,"videoPayloadMap",void 0);class kD{constructor(e,i){m(this,"_removeHandler",void 0),m(this,"_remotePauseHandler",void 0),m(this,"_prePts",void 0),m(this,"_stallList",void 0),m(this,"_videoInWaiting",!1),m(this,"_videoInWaitingCallback",!1),m(this,"_videoInWaiting100ms",!1),m(this,"_isPaused",void 0),m(this,"_pauseStart",0),m(this,"_pauseDuration",0),m(this,"_requestVideoFrameCallbackTimer",void 0),m(this,"_logger",void 0),m(this,"_player",void 0),m(this,"_recentVideoInfo",void 0),m(this,"_stallTimeThreshold",void 0),m(this,"_openVideoStall100ms",de.VIDEO_STALL_100MS);const s=e?1500:Dt||Te?550:500;this._stallTimeThreshold={report:s,callback:Math.max(de.VIDEO_STALL_DATA,s)},this._logger=new ue("VideoStallObserver",1,i)}start(e){if(this._logger.print("start","invoke"),this._player=e,Df())e.domElement&&(this._requestVideoFrameCallbackTimer=e.domElement.requestVideoFrameCallback(this._onVideoRefresh.bind(this)),this._removeHandler=()=>{var s;this._requestVideoFrameCallbackTimer&&((s=e.domElement)===null||s===void 0||s.cancelVideoFrameCallback(this._requestVideoFrameCallbackTimer))});else{const s=o=>this._onVideoTimeupdate(o,e);e.on("playback_event",s),this._removeHandler=()=>e.off("playback_event",s)}const i=s=>this._onVideoPause(s);e.on("playback_event",i),this._remotePauseHandler=()=>e.off("playback_event",i)}getRecentRenderInfo4Report(){const e={};return this._recentVideoInfo&&Object.keys(this._recentVideoInfo).forEach((i=>{var s;const o=i.replace(/[a-z]{1}[A-Z]{1}/g,(r=>"".concat(r[0],"_").concat(r[1].toLowerCase())));e["video_".concat(o)]=(s=this._recentVideoInfo)===null||s===void 0?void 0:s[i]})),e}stop(){var e,i;this._logger.print("stop","invoke"),delete this._player,(e=this._removeHandler)===null||e===void 0||e.call(this),delete this._removeHandler,(i=this._remotePauseHandler)===null||i===void 0||i.call(this),delete this._remotePauseHandler,delete this._stallList,delete this._prePts,delete this._recentVideoInfo,this._videoInWaiting=!1,this._videoInWaitingCallback=!1,this._videoInWaiting100ms=!1}destroy(){this.stop()}getStallInfo(e){let{interval:i,frameRateReceived:s,frameRateDecoded:o,bitrate:r}=e;const n={pts:0,report:{stallCount:0,stallDuration:0,list:[]},callback:{stallCount:0,stallDuration:0},pauseDuration:this._getPauseDuration()};return this._stallList&&((Dt||Te)&&(r===0||(o||1/0)<=1||(s||1/0)<=1)||this._stallList.length===0?(n.report.stallDuration=n.callback.stallDuration=2e3,n.report.stallCount=n.callback.stallCount=this._videoInWaiting?0:1,this._openVideoStall100ms&&(n.stall100ms={count:this._videoInWaiting100ms?0:1,duration:2e3}),this._videoInWaiting=!0,this._videoInWaitingCallback=!0,this._videoInWaiting100ms=!0):this._stallList.forEach(((a,c)=>{let d=a.timeUpdateInterval;c===0&&this._videoInWaiting&&(d=Math.round(a.timeUpdateInterval%i));const l=a.timeUpdateInterval>this._stallTimeThreshold.report;l&&(n.report.list.push(a.timeUpdateInterval),n.report.stallDuration+=d,this._videoInWaiting||n.report.stallCount++),this._videoInWaiting=l,a.timeUpdateInterval>this._stallTimeThreshold.callback?(n.callback.stallDuration+=d,this._videoInWaitingCallback||n.callback.stallCount++,this._videoInWaitingCallback=!0):this._videoInWaitingCallback=!1,this._openVideoStall100ms&&(n.stall100ms||(n.stall100ms={count:0,duration:0}),a.timeUpdateInterval>100?(n.stall100ms.duration+=d,this._videoInWaiting100ms||n.stall100ms.count++,this._videoInWaiting100ms=!0):this._videoInWaiting100ms=!1),n.pts=a.playTime})),this._stallList=[]),n}_getPauseDuration(){let e=this._pauseDuration;if(this._pauseDuration=0,this._isPaused){const i=ee(),s=i-(this._pauseStart||0);s>500&&(this._pauseStart=i,e+=s)}return e}_onVideoPause(e){if(e.eventName==="pause")this._isPaused=!0,this._pauseStart=ee();else if(e.eventName==="play"&&this._isPaused){this._isPaused=!1;const i=ee()-this._pauseStart;i>500&&(this._pauseDuration+=i)}}_onVideoTimeupdate(e,i){if(e.eventName==="timeupdate"){const s=i.domElement;if(!s||s.currentTime===0)return;if(this._prePts===void 0)return void(this._prePts=s.currentTime);if(this._stallList||(this._stallList=[]),s.currentTime>this._prePts){const o=s.currentTime-this._prePts;this._stallList.push({playTime:s.currentTime,timeUpdateInterval:Math.round(1e3*o)})}this._prePts=s.currentTime}}_onVideoRefresh(e,i){var s;if(this._stallList||(this._stallList=[]),this._prePts){const o=i.presentationTime-this._prePts;this._stallList.push({playTime:i.presentationTime,timeUpdateInterval:Math.round(o)})}this._recentVideoInfo=i,this._prePts=i.presentationTime,(s=this._player)===null||s===void 0||(s=s.domElement)===null||s===void 0||s.requestVideoFrameCallback(this._onVideoRefresh.bind(this))}}class Rt{constructor(e){m(this,"_audioStallTimer",void 0),m(this,"_preSample",void 0),m(this,"_isStallInPreCallbackEnd",!1),m(this,"_isStallInPreReportEnd",!1),m(this,"_stallList",[]),this._stream=e}static setAudioStallConfig(e){Rt.interval=(e?.audio_stall_interval||200)/2,Rt.ratio=e?.audio_stall_ratio||.6}start(e,i){this.stop(),de.AUDIO_STALL&&Rt.interval>0&&typeof e=="number"&&typeof i=="number"&&(this._preSample={ts:ee(),concealedSamples:e,totalSamplesReceived:i},this._startStallCountInterval())}stop(){this._stallList=[],this._audioStallTimer&&(clearTimeout(this._audioStallTimer),delete this._audioStallTimer)}destroy(){this.stop()}async getAudioStallInfo(){const e={stats_count:this._stallList.filter((r=>!!r.get_stats_cost)).length,stall_list:[...this._stallList]};try{await this._audioStallCount()}catch{}const i=$S(this._stallList,2,this._isStallInPreReportEnd);this._isStallInPreReportEnd=i.isStallInEnd;const s=de.AUDIO_STALL_DATA/Rt.interval,o=$S(this._stallList,s,this._isStallInPreCallbackEnd);return this._isStallInPreCallbackEnd=o.isStallInEnd,this.stop(),this._startStallCountInterval(),{report:{stall_count:i.stall_count,stall_duration:i.stall_duration,list:i.list},callback:{stall_count:o.stall_count,stall_duration:o.stall_duration,list:o.list},extra:e}}_startStallCountInterval(){const e=async()=>{clearTimeout(this._audioStallTimer),delete this._audioStallTimer,await this._audioStallCount(),this._audioStallTimer||(this._audioStallTimer=setTimeout(e,Rt.interval))};this._audioStallTimer=setTimeout(e,Rt.interval)}async _audioStallCount(){if(!this._preSample||ee()-this._preSample.ts<.5*Rt.interval)return;const{hasAudio:e,subAudio:i,virtual:s,virtualOccupy:o,removeTrack:r,audioTrack:n}=this._stream;if(r||!n)return clearTimeout(this._audioStallTimer),void delete this._audioStallTimer;const a=e&&i;if(!a||s&&!o)this._preSample.ts=ee(),this._stallList.push({reason:a?"virtual: ".concat(s,", virtualOccupy: ").concat(o):"hasAudio: ".concat(e,", subAudio: ").concat(i)});else{const d=ee();let l,u,p=0;try{var c;const b=await((c=this._stream.audioTransceiver)===null||c===void 0?void 0:c.receiver.getStats());b?.forEach((S=>{S.type==="inbound-rtp"&&(l=S),p++}))}catch(b){u=b.message||JSON.stringify(b)}const h=ee(),_=ee(),y=_-this._preSample.ts;if(l){const{concealedSamples:b,totalSamplesReceived:S}=l,v=b-this._preSample.concealedSamples,f=S-this._preSample.totalSamplesReceived,g=v>=0&&f>=0&&v>=Rt.ratio*f;this._stallList.push({concealed:v,received:f,diff:y,start:this._preSample.ts,end:_,get_stats_cost:h-d,get_stats_start:d,get_stats_end:h,is_stall:g}),this._preSample.concealedSamples=b,this._preSample.totalSamplesReceived=S,this._preSample.ts=_}else this._stallList.push({diff:y,start:this._preSample.ts,end:_,get_stats_cost:h-d,get_stats_start:d,get_stats_end:h,reason:p?u||"no inbound-rtp":"no report"})}}}m(Rt,"interval",100),m(Rt,"ratio",.6);const $S=(t,e,i)=>{var s;const o={stall_count:0,stall_duration:0,isStallInEnd:!1,list:[]};let r=0,n=0;for(let a=0;a<t.length;a++){const c=t[a];c.is_stall&&(r++,n+=c.diff||0);const d=a===t.length-1;if(!c.is_stall||d){let l=r>=e;const u=a+e-r-1;if(!l&&r>2){let p=0;t.slice(a+1,u+1).forEach((h=>{h.is_stall&&(p+=h.diff||0)})),l=n+p>Rt.interval*e*Rt.ratio,l&&(a=u,n+=p)}l&&(o.stall_count++,o.stall_duration+=n,o.list.push(n)),d&&(o.isStallInEnd=l),r=n=0}}return((s=t[0])===null||s===void 0?void 0:s.is_stall)===!0&&i&&o.stall_count>0&&o.stall_count--,o},xD=new ue("InternalEventBus",1);var ki=(t=>(t.ON_IOS_INTERRUPTION_START="ON_IOS_INTERRUPTION_START",t.ON_IOS_INTERRUPTION_END="ON_IOS_INTERRUPTION_END",t.ON_IOS_LOCAL_TRACK_MUTE="ON_IOS_LOCAL_TRACK_MUTE",t.ON_IOS_LOCAL_TRACK_UNMUTE="ON_IOS_LOCAL_TRACK_UNMUTE",t))(ki||{});class MD extends Ai.EventEmitter{emit(e){xD.info(e);for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return super.emit(e,...s)}}const is=new MD;var hI="data:application/javascript;base64,Y2xhc3MgRHVtcEF1ZGlvRGF0YSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvciB7CiAgcHJvY2VzcyhpbnB1dHMpIHsKICAgIHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgIGRhdGE6IGlucHV0c1swXSwKICAgICAgY2hhbm5lbENvdW50OiBpbnB1dHNbMF0ubGVuZ3RoLAogICAgICBzYW1wbGVSYXRlLAogICAgfSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCnJlZ2lzdGVyUHJvY2Vzc29yKCdkdW1wLWF1ZGlvLWRhdGEnLCBEdW1wQXVkaW9EYXRhKTsK";const Fn=new ue("AudioContext",1);class wD{constructor(){m(this,"isWorkletReady",void 0),m(this,"_audioContextInstance",void 0),m(this,"_previousState",""),m(this,"_currentState",""),m(this,"_contextStuckAt",0);let e=0;xe()||setInterval((()=>{if(this._audioContextInstance){const i=this._audioContextInstance.currentTime;this._contextStuckAt?this._contextStuckAt!==i&&(this._contextStuckAt=0,Fn.info("currentTime resume"),Zy("currentTime resume","")):i&&e===i&&(this._contextStuckAt=i,Fn.warn("currentTime stuck",this._contextStuckAt),this._audioContextInstance.suspend(),this._audioContextInstance.resume(),Zy("AudioContext currentTime stuck",this._contextStuckAt)),e=i}}),3e3)}getAudioContextInstance(){if(!this._audioContextInstance){const e=window.AudioContext||window.webkitAudioContext;this._audioContextInstance=new e;try{this.isWorkletReady=this._audioContextInstance.audioWorklet.addModule(hI),this.isWorkletReady.catch((i=>{No("initial AudioWorklet error in promise",-1,"".concat(i.name,"-").concat(i.message)),Fn.error("isWorkletReady",i),this.isWorkletReady=null}))}catch(i){No("initial AudioWorklet error in catch",-1,"".concat(i.name,"-").concat(i.message)),Fn.error("isWorkletReady",i),this.isWorkletReady=null}this._audioContextInstance.onstatechange=()=>{var i,s,o;Fn.warn("state change",(i=this._audioContextInstance)===null||i===void 0?void 0:i.state),this._previousState=this._currentState,this._currentState=((s=this._audioContextInstance)===null||s===void 0?void 0:s.state)||"",((o=this._audioContextInstance)===null||o===void 0?void 0:o.state)==="interrupted"&&this._audioContextInstance.resume(),(yo||mc)&&(this._previousState==="running"&&this._currentState==="interrupted"&&is.emit(ki.ON_IOS_INTERRUPTION_START),this._previousState==="interrupted"&&this._currentState==="running"&&is.emit(ki.ON_IOS_INTERRUPTION_END))}}return this._audioContextInstance}}class Yp{constructor(e){m(this,"_ctx",void 0),m(this,"_analyserNode",void 0),m(this,"_audioSource",void 0),m(this,"currentTrackId",void 0),this.currentTrackId=e.id;const i=oi.getAudioContextInstance();if(e instanceof MediaStreamTrack){const o=new MediaStream;o.addTrack(e),this._audioSource=i.createMediaStreamSource(o)}else this._audioSource=i.createMediaElementSource(e),this._audioSource.connect(i.destination);const s=i.createAnalyser();this._audioSource.connect(s),this._analyserNode=s,this._ctx=i}getAudioLevel(){var e;((e=this._ctx)===null||e===void 0?void 0:e.state)==="suspended"&&this._ctx.resume();const i=new Uint8Array(2048);this._analyserNode.getByteTimeDomainData(i);let s=0;i.forEach((r=>s=Math.max(s,Math.abs(r-128))));const o=s/128*255;return o>2?o:0}async resume(){var e;await((e=this._ctx)===null||e===void 0?void 0:e.resume())}destroy(){this._audioSource.disconnect(),this._analyserNode.disconnect()}}class Hp extends Ai.EventEmitter{constructor(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:oi.getAudioContextInstance(),o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:oi.isWorkletReady;var r;super(),m(this,"_ctx",void 0),m(this,"_worklet",void 0),m(this,"_source",void 0),m(this,"_buffers",[]),m(this,"_bufferLength",0),m(this,"_sampleRate",void 0),m(this,"_channelCount",void 0),m(this,"_frameSize",void 0),e instanceof MediaStreamTrack?this._channelCount=(r=e.getSettings().channelCount)!==null&&r!==void 0?r:1:this._channelCount=e.channelCount,this._ctx=s,this._frameSize=i,o?.then((()=>{this._worklet=new AudioWorkletNode(this._ctx,"dump-audio-data"),e instanceof MediaStreamTrack?this._source=this._ctx.createMediaStreamSource(new MediaStream([e])):this._source=e,this._source.connect(this._worklet),this._initWorkletEventListener(this._worklet)})).catch()}_initWorkletEventListener(e){e.port.onmessage=this._handleWorkletMessage.bind(this)}_handleWorkletMessage(e){const{data:i,sampleRate:s}=e.data;if(this._bufferLength>=this._frameSize||this._sampleRate!==s){if(this._sampleRate){const o=this._channelCount===1||i.length===1?1:2;this.emit("data",{channels:[...this._buffers],sampleRate:this._sampleRate,channelCount:o})}this._sampleRate=s,this._buffers=new Array(this._channelCount).fill(0).map((()=>new Float32Array(this._frameSize))),this._bufferLength=0}for(let o=0;o<this._channelCount;o++)this._buffers[o].set(i[o],this._bufferLength);this._bufferLength=this._bufferLength+i[0].length}setFrameSize(e){this._frameSize=e}destroy(){var e,i,s;this.removeAllListeners("data"),this._worklet&&((e=this._source)===null||e===void 0||e.disconnect(this._worklet)),(i=this._worklet)===null||i===void 0||i.disconnect(),(s=this._worklet)===null||s===void 0||s.port.close(),this._buffers=[],delete this._source,delete this._worklet}}const oi=new wD,Fp=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=document.createElement(t);return e.id&&(i.id=e.id),e.classList&&e.classList.forEach((s=>{i.classList.add(s)})),e.style&&Object.assign(i.style,e.style),e.attributes&&Object.entries(e.attributes).forEach((s=>{let[o,r]=s;o==="muted"?i.muted=!0:i.setAttribute(o,r)})),i};class KD extends Vt{constructor(){var e;super(),m(this,"deviceMap",{audioinput:new Map,audiooutput:new Map,videoinput:new Map}),m(this,"checkDeviceChangeTimer",null),m(this,"isSupportedPermissionsQuery",!1),m(this,"isGrantedMicrophonePermission",!1),m(this,"isGrantedCameraPermission",!1),this.isSupportedPermissionsQuery=!xe()&&!((e=navigator)===null||e===void 0||(e=e.permissions)===null||e===void 0||!e.query),this._handleDeviceChange=this._handleDeviceChange.bind(this),!xe()&&this.initListener().then((()=>{this.updateDeviceListInSilent()}))}async refreshDevices(){let e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"audio";if(!navigator.mediaDevices)return;if(Te)try{e=i==="audio"?await navigator.mediaDevices.getUserMedia({audio:!0}):await navigator.mediaDevices.getUserMedia({video:!0})}catch{}const s=await navigator.mediaDevices.enumerateDevices();e&&e.getTracks().forEach((o=>o.stop())),s.forEach((o=>{var r;o.deviceId&&((r=this.deviceMap[o.kind])===null||r===void 0||r.set(o.deviceId,o))}))}async initListener(){var e,i;if(((e=navigator.mediaDevices)===null||e===void 0?void 0:e.ondevicechange)!==void 0&&typeof((i=navigator.mediaDevices)===null||i===void 0?void 0:i.addEventListener)=="function"?navigator.mediaDevices.addEventListener("devicechange",(()=>{this._handleDeviceChange(),setTimeout((()=>{this._handleDeviceChange()}),300)})):this.checkDeviceChangeTimer=window.setInterval((()=>{this._handleDeviceChange()}),3e3),this.isSupportedPermissionsQuery){try{const s=await navigator.permissions.query({name:"microphone"});this.isGrantedMicrophonePermission=s.state==="granted",s.addEventListener("change",(()=>{this.isGrantedMicrophonePermission=s.state==="granted"}))}catch{}try{const s=await navigator.permissions.query({name:"camera"});this.isGrantedCameraPermission=s.state==="granted",s.addEventListener("change",(()=>{this.isGrantedCameraPermission=s.state==="granted"}))}catch{}}}async _handleDeviceChange(){if(!navigator.mediaDevices)return;let e;Te&&(e=await navigator.mediaDevices.getUserMedia({audio:!0}));let i=await navigator.mediaDevices.enumerateDevices();i=i.filter((o=>!!o.deviceId)),e&&e.getTracks().forEach((o=>o.stop()));const s=Array.from([...this.deviceMap.audioinput.values(),...this.deviceMap.videoinput.values(),...this.deviceMap.audiooutput.values()]);(Hd||mc)&&!s.length&&i.length&&i.forEach((o=>{var r;(r=this.deviceMap[o.kind])===null||r===void 0||r.set(o.deviceId,o)})),i.forEach((o=>{const r=this.deviceMap[o.kind].get(o.deviceId);this.deviceMap[o.kind].set(o.deviceId,o),r||(o.kind.includes("video")?this.emit(Y.onVideoDeviceStateChanged,{mediaDeviceInfo:o,deviceState:"active"}):o.kind.includes("audio")&&this.emit(Y.onAudioDeviceStateChanged,{mediaDeviceInfo:o,deviceState:"active"}))})),s.forEach((o=>{i.find((r=>r.deviceId===o.deviceId&&r.kind===o.kind))||(this.deviceMap[o.kind].delete(o.deviceId),o.kind.includes("video")?this.emit(Y.onVideoDeviceStateChanged,{mediaDeviceInfo:o,deviceState:"inactive"}):o.kind.includes("audio")&&this.emit(Y.onAudioDeviceStateChanged,{mediaDeviceInfo:o,deviceState:"inactive"}))}))}async getUserMedia(e){const i=await navigator.mediaDevices.getUserMedia(e);return e!=null&&e.audio&&(this.isGrantedMicrophonePermission=!0),e!=null&&e.video&&(this.isGrantedCameraPermission=!0),e!=null&&e.video?this.refreshDevices("video"):this.refreshDevices("audio"),i}async checkPermissionsByDevices(){const e={audio:!1,video:!1};if(!navigator.mediaDevices)return e;const i=await navigator.mediaDevices.enumerateDevices();return e.audio=i.filter((s=>s.kind==="audioinput"&&s.label&&s.deviceId)).length>0,e.video=i.filter((s=>s.kind==="videoinput"&&s.label&&s.deviceId)).length>0,e}async getPermissions(){var e;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{audio:s,video:o}=i;const{force:r}=i;s||o||(s=!0,o=!0);const n={audio:!1,video:!1,reason:void 0};if(!r)if(this.isSupportedPermissionsQuery){if(s&&o){if(this.isGrantedMicrophonePermission&&this.isGrantedCameraPermission)return n.audio=!0,n.video=!0,n}else if(s&&this.isGrantedMicrophonePermission||o&&this.isGrantedCameraPermission)return n.audio=this.isGrantedMicrophonePermission,n.video=this.isGrantedCameraPermission,n}else{const d=await this.checkPermissionsByDevices();if(s&&o){if(d.audio&&d.video)return d}else if(s&&d.audio||o&&d.video)return d}if((e=navigator.mediaDevices)!==null&&e!==void 0&&e.getUserMedia)try{const d=await navigator.mediaDevices.getUserMedia({audio:s,video:o});d&&(d.getTracks().forEach((l=>l.stop())),s&&(n.audio=!0,this.isGrantedMicrophonePermission=!0),o&&(n.video=!0,this.isGrantedCameraPermission=!0))}catch(d){if(n.reason=d,this.isSupportedPermissionsQuery){var a,c;s&&(n.audio=((a=await navigator.permissions.query({name:"microphone"}).catch((()=>{})))===null||a===void 0?void 0:a.state)==="granted"),o&&(n.video=((c=await navigator.permissions.query({name:"camera"}).catch((()=>{})))===null||c===void 0?void 0:c.state)==="granted")}}return s?await this.refreshDevices("audio"):await this.refreshDevices("video"),n}async updateDeviceListInSilent(){this.isGrantedCameraPermission&&this.isGrantedMicrophonePermission&&this.refreshDevices("audio")}async enumerateDevices(){return await this.getPermissions(),await this.refreshDevices(),Array.from([...this.deviceMap.audioinput.values(),...this.deviceMap.videoinput.values(),...this.deviceMap.audiooutput.values()])}async enumerateAudioCaptureDevices(){return await this.getPermissions({audio:!0}),await this.refreshDevices(),Array.from(this.deviceMap.audioinput.values())}async enumerateVideoCaptureDevices(){return await this.getPermissions({video:!0}),await this.refreshDevices("video"),Array.from(this.deviceMap.videoinput.values())}async enumerateAudioPlaybackDevices(){return await this.getPermissions({audio:!0}),await this.refreshDevices("audio"),Array.from(this.deviceMap.audiooutput.values())}async getAudioPlaybackDeviceById(e){return(await this.enumerateAudioPlaybackDevices()).find((i=>i.deviceId===e))}}const _t=new KD;Qc&&(window.__rtc_dd__=_t);const fr=new ue("VideoSnapshot",1),YD=t=>{const e=t?.domElement;if(e&&!e.paused&&e.readyState===4)return e},pI=async(t,e)=>{const i=document.createElement("canvas"),s=i.getContext("2d");if(!s)throw new Error("canvas.getContext error");const o=(a,c,d)=>(c=c||a.width,d=d||a.height,i.width=c,i.height=d,s.setTransform(1,0,0,1,0,0),s.drawImage(a,0,0,c,d),s.getImageData(0,0,c,d)),r=Date.now(),n=YD(e);if(n){fr.info("takeSnapshot","VideoPlayer already set.");const a=await o(n,n.videoWidth,n.videoHeight);return fr.info("takeSnapshot","success, cost ".concat(Date.now()-r,"ms")),a}if(window.ImageCapture){const a=new window.ImageCapture(t);if(a.track.readyState==="live"&&a.track.enabled&&!a.track.muted){fr.info("takeSnapshot","use ImageCapture");const c=await o(await a.grabFrame());return fr.info("takeSnapshot","success, cost ".concat(Date.now()-r,"ms")),c}}return fr.info("takeSnapshot","use temp video"),new Promise(((a,c)=>{const d=new MediaStream([t]),l=document.createElement("video");l.setAttribute("playsinline",""),l.muted=!0,document.body.appendChild(l),l.onplaying=()=>{const u=o(l,l.videoWidth,l.videoHeight);fr.info("takeSnapshot","success, cost ".concat(Date.now()-r,"ms")),a(u),d.removeTrack(t),l.srcObject=null,l.load()},l.onerror=c,l.srcObject=d,l.play()}))},Ft=Symbol("default");var Mh=(t=>(t.START_STALL_OBSERVE="start_stall_observe",t.STOP_STALL_OBSERVE="stop_stall_observe",t))(Mh||{});class $o extends sT{constructor(e,i,s){super(e,i,I(I({},s),{},{mediaType:tn.VIDEO})),m(this,"resolution",void 0),m(this,"videoPlayers",new Map),this.resolution={width:0,height:0}}intersection(){const e={};return this.videoPlayers.forEach(((i,s)=>{e[s.toString()]=i.isIntersecting})),e}async updateVideoCaptureConfig(e){this.logger.info("updateVideoEncoderConfig","update localVideoTrack: ",e);const i=I({},e);delete i.contentHint,Te&&this.trackInfo.streamIndex===He.MAIN&&(i.frameRate={ideal:30,max:30}),await this.originTrack.applyConstraints(i);const s=this.originTrack.getSettings();(s.width&&s.width!==this.resolution.width||s.height&&s.height!==this.resolution.height)&&(this.resolution={width:s.width,height:s.height},this.emit("resolution-change",this.resolution))}setContentHint(e){"contentHint"in this.originTrack&&["text","motion","detail"].includes(e)&&(this.originTrack.contentHint=e)}setTrack(e,i){this._originTrack=e,this.trackInfo=I(I({},this.trackInfo),i),this.isTrackReady=this.generatePreProcessingTrack()}setPlayer(e,i,s,o){var r;const n=(r=e.playerId)!==null&&r!==void 0?r:Ft;let a=this.videoPlayers.get(n);return e.player!==a&&(a=e.player,this.videoPlayers.set(n,a),o(a,this.isPublic,this.streamIndex)),this.mirror(!!i),this.dummy||s===oo.PLAY_MANUALLY||this.play(n),a.domElement}setUserId(e){this.trackInfo.streamUserId=e,this.videoPlayers.forEach((i=>{i.userId=e}))}snapshot(){let e;for(const i of this.videoPlayers.values())if(i.played){e=i;break}return pI(this.preprocessingTrack,e)}setRenderMode(e,i){var s;return(s=this.videoPlayers.get(e))===null||s===void 0?void 0:s.setRenderMode(i)}mirror(e){this.videoPlayers.forEach((i=>{i.mirror(e)}))}removePlayerTrack(){this.videoPlayers.forEach(((e,i)=>{var s;(s=this.videoPlayers.get(i))===null||s===void 0||s.removeTrack()}))}play(e){const i=this.videoPlayers.get(e);return i!=null&&i.played?i.manuallyPlay():i?.playVideo(this)}playAll(){this.videoPlayers.forEach(((e,i)=>{this.play(i)}))}manuallyPlay(e){var i;return(i=this.videoPlayers.get(e))===null||i===void 0?void 0:i.manuallyPlay()}pause(e){var i;(i=this.videoPlayers.get(e))===null||i===void 0||i.manuallyPause()}stop(e){var i;return(i=this.videoPlayers.get(e))===null||i===void 0?void 0:i.stop()}stopAll(){return this.videoPlayers.forEach(((e,i)=>{this.stop(i)}))}removePlayer(e){this.videoPlayers.delete(e)}destroy(){this.videoPlayers.forEach(((e,i)=>{this.stop(i),e.removeAllListeners(),this.videoPlayers.delete(i)})),super.destroy()}}class HD extends oT{constructor(e,i,s,o){super(e,i,I(I({},o),{},{mediaType:tn.VIDEO})),m(this,"videoPlayers",new Map),m(this,"_stream",void 0),m(this,"_observingPlayer",void 0),this._stream=s}get observingPlayerId(){var e;return(e=this._observingPlayer)===null||e===void 0?void 0:e.playerId}getSizeByPlayer(){let e=0,i=0;return this.videoPlayers.forEach((s=>{var o;(o=s.domElement)!==null&&o!==void 0&&o.videoWidth&&s.domElement.videoHeight&&(e=s.domElement.videoWidth,i=s.domElement.videoHeight)})),{width:e,height:i}}intersection(){const e={};return this.videoPlayers.forEach(((i,s)=>{e[s.toString()]=i.isIntersecting})),e}setPlayer(e,i,s,o){var r,n;const a=(r=i.playerId)!==null&&r!==void 0?r:Ft;let c=this.videoPlayers.get(a);if(i.player!==c){var d;c=i.player,!qi(this.streamIndex)&&c.mirror(this._ctx.getRemoteMirrorType((d=this.trackInfo.streamUserId)!==null&&d!==void 0?d:"",this.streamIndex)),this.videoPlayers.set(a,c),this._handlePlayerStallEvent(c),o(c,this.isPublic,this.streamIndex)}return this.dummy||this.play(a),(n=c)===null||n===void 0?void 0:n.domElement}mirror(e){this.videoPlayers.forEach((i=>{i.mirror(e)}))}dangerousGetPlayer(e){return this.videoPlayers.get(e)}snapshot(){let e;for(const i of this.videoPlayers.values())if(i.played){e=i;break}return pI(this.preprocessingTrack,e)}stop(e){var i;(i=this.videoPlayers.get(e))===null||i===void 0||i.stop()}stopAll(){this.videoPlayers.forEach(((e,i)=>{this.stop(i)}))}play(e){if(this._ctx.autoPlayPolicy===oo.PLAY_MANUALLY)return;const i=this.videoPlayers.get(e);return i?.playVideo(this)}manuallyPlay(e){const i=this.videoPlayers.get(e);return i!=null&&i.played?i.manuallyPlay():i?.playVideo(this)}pause(e){var i;return(i=this.videoPlayers.get(e))===null||i===void 0?void 0:i.manuallyPause()}_handlePlayerStallEvent(e){e.on("start_stall_observe",(()=>{!this._observingPlayer&&e&&(this._observingPlayer=e,this._stream.startVideoStallObserve(this._observingPlayer))})),e.on("stop_stall_observe",(()=>{this._observingPlayer===e&&(this._stream.stopVideoStallObserve(),this._observingPlayer=void 0,this.videoPlayers.forEach((i=>{!this._observingPlayer&&i.played&&(this._observingPlayer=i,this._stream.startVideoStallObserve(i))})))}))}removePlayer(e){this.videoPlayers.delete(e)}destroy(){this.videoPlayers.forEach(((e,i)=>{this.stop(i),e.removeAllListeners(),this.videoPlayers.delete(i)})),super.destroy()}}const FD=["cap","ch","em","ex","ic","lh","rcap","rch","rem","rex","ric","rlh","vh","vw","vmax","vmin","vb","vi","cqw","cqh","cqi","cqb","cqmin","cqmax","px","cm","mm","Q","in","pc","pt"],OD=["deg","grad","rad","turn"];function Da(t){var e,i;if(!t.match(/[0-9]$/)||((e=(i=t.match(/\./g))===null||i===void 0?void 0:i.length)!==null&&e!==void 0?e:0)>1)return null;const s=parseFloat(t);return Number.isNaN(s)?null:s}function bI(t){if(!t.endsWith("%"))return null;const e=Da(t.slice(0,-1));return e===null?null:e/100}function JD(t){for(const e of FD){if(!t.endsWith(e))continue;const i=Da(t.slice(0,-1*e.length));if(i)return{value:i,unit:e}}return null}function UD(t){for(const e of OD){if(!t.endsWith(e))continue;const i=Da(t.slice(0,-1*e.length));if(i)return{value:i,unit:e}}return null}function Wm(t){let e=bI(t);return e!==null?e:(e=Da(t),e!==null&&e>=0&&e<=1?e:null)}function On(t){let e=bI(t);return e===null&&(e=Da(t)),e}function AD(t){let e=t;for(;e;){if(document.documentElement===e)return!0;e=e.parentElement}return!1}function yI(t){var e,i,s,o,r,n,a,c,d,l,u,p,h,_,y,b,S,v;if(!t)return!0;if(xe())return!1;const f=getComputedStyle(t),{display:g,visibility:Z,contentVisibility:R,opacity:T,filter:X}=f;if(g&&g==="none"||Z&&(Z==="hidden"||Z==="collapse")||R&&R==="hidden"||!T)return!1;const L=Wm(T);if(L!==null&&L<1)return!1;const W=Wm((e=(i=X.match(/opacity\((\S+)\)/))===null||i===void 0?void 0:i[1])!==null&&e!==void 0?e:"");if(W!==null&&W!==1)return!1;const M=JD((s=(o=X.match(/blur\((\S+)\)/))===null||o===void 0?void 0:o[1])!==null&&s!==void 0?s:"");if(M!==null&&M.value!==0)return!1;const k=On((r=(n=X.match(/brightness\((\S+)\)/))===null||n===void 0?void 0:n[1])!==null&&r!==void 0?r:"");if(k!==null&&(k>1||k<1))return!1;const U=On((a=(c=X.match(/contrast\((\S+)\)/))===null||c===void 0?void 0:c[1])!==null&&a!==void 0?a:"");if(U!==null&&(U>1||U<1))return!1;const D=Wm((d=(l=X.match(/grayscale\((\S+)\)/))===null||l===void 0?void 0:l[1])!==null&&d!==void 0?d:"");if(D!==null&&D>0)return!1;const ie=UD((u=(p=X.match(/hue-rotate\((\S+)\)/))===null||p===void 0?void 0:p[1])!==null&&u!==void 0?u:"");if(ie!==null&&(ie.value>0||ie.value<-0))return!1;const B=On((h=(_=X.match(/invert\((\S+)\)/))===null||_===void 0?void 0:_[1])!==null&&h!==void 0?h:"");if(B!==null&&B>0)return!1;const $=On((y=(b=X.match(/saturate\((\S+)\)/))===null||b===void 0?void 0:b[1])!==null&&y!==void 0?y:"");if($!==null&&($<1||$>1))return!1;const te=On((S=(v=X.match(/sepia\((\S+)\)/))===null||v===void 0?void 0:v[1])!==null&&S!==void 0?S:"");return!(te!==null&&te>0)&&yI(t.parentElement)}function DD(t){let{lt:e,rb:i}=t;const s=i.x-e.x,o=i.y-e.y;if(s===0||o===0)return[];const r=.05*s/2,n=.05*o/2,a=(s-2*r)/4,c=(o-2*n)/4,d=[];for(let l=r+e.x;l<=i.x;l+=a)for(let u=n+e.y;u<=i.y;u+=c)d.push({x:l,y:u});return d}function zD(t){const{left:e,right:i,top:s,bottom:o}=t.getBoundingClientRect();return DD({lt:{x:e,y:s},rb:{x:i,y:o}}).reduce(((r,n)=>{const a=document.elementFromPoint(n.x,n.y);return a&&a!==t&&(r+=1),r}),0)<6}function QD(t){const{left:e,right:i,top:s,bottom:o}=t.getBoundingClientRect(),{clientWidth:r,clientHeight:n}=document.body,a=i-e-10,c=o-s-10;return!(i-r>=a)&&!(0-e>=a)&&!(o-n>=c)&&!(0-s>=c)}function jD(t){const{left:e,right:i,top:s,bottom:o}=t.getBoundingClientRect(),{clientWidth:r,clientHeight:n}=document.body,a=i-e,c=o-s,d=r>n?n:r;return!(a<50||c<50)&&!(a/d<.1||c/d<.1)}function BD(t){const e=[];return AD(t)?(yI(t)||e.push(Ro.PLAYER_INVISIBLE_BY_STYLE),zD(t)||e.push(Ro.PLAYER_INVISIBLE_BY_COVERED),QD(t)||e.push(Ro.PLAYER_INVISIBLE_BY_POSITION),jD(t)||e.push(Ro.PLAYER_INVISIBLE_BY_SIZE),e.length>0?e:[Ro.PLAYER_VISIBLE]):[Ro.PLAYER_INVISIBLE_BY_UNMOUNT]}const Xc=["play","playing","pause","ended","error","seeking","seeked","waiting","canplay","canplaythrough","durationchange","volumechange","loadedmetadata","loadeddata","loadstart","timeupdate"],$D={playsinline:"","webkit-playsinline":""},qD={playsinline:"","webkit-playsinline":"","x5-playsinline":"","x5-video-player-type":"h5","x-webkit-airplay":"allow",preload:"",muted:""};class Fs extends Ai.EventEmitter{constructor(e,i,s){super(),m(this,"_containerDom",void 0),m(this,"_videoDom",void 0),m(this,"userId",void 0),m(this,"renderMode",void 0),m(this,"mirrorType",yi.MIRROR_TYPE_NONE),m(this,"isScreen",void 0),m(this,"isLocal",void 0),m(this,"played",!1),m(this,"_needLoad",!1),m(this,"_emitPlayFailed",!1),m(this,"_videoContainer",void 0),m(this,"_safari15VideoTimer",void 0),m(this,"_monitor",void 0),m(this,"logger",void 0),m(this,"_onLocalTrackMute",void 0),m(this,"_onInterruptionEnd",void 0),m(this,"_needResume",!1),m(this,"_rotate",0),m(this,"_rotateDom",void 0),m(this,"_resizeObserver",void 0),m(this,"_hasManuallyPaused",!1),m(this,"isIntersecting",void 0),m(this,"intersectionObserver",void 0),m(this,"hasStartPlaying",!1),m(this,"emitVideoEvent",(c=>{var d,l;const u={type:"video",rawEvent:c,readyState:((d=this._videoDom)===null||d===void 0?void 0:d.readyState)||0,userId:this.userId,eventName:c.type,currentTime:((l=this._videoDom)===null||l===void 0?void 0:l.currentTime)||0,isScreen:this.isScreen};switch(this.emit("playback_event",u),c.type){case"canplay":this.refreshRenderSize("the video started playing."),this._internalPlay();break;case"loadeddata":this._internalPlay();break;case"playing":this.logger.info("VideoPlayerPlaying","[userId-".concat(this.userId,"] video element playing"));break;case"pause":this.logger.info("VideoPlayerPause","[userId-".concat(this.userId,"] video element pause")),this._needResume?(this.logger.info("VideoPlayerPause","[userId-".concat(this.userId,"] video element resume")),this._internalPlay(),this._needResume=!1):this._hasManuallyPaused||(this.logger.info("VideoPlayerPause","[userId-".concat(this.userId,"] video element resume")),this._internalPlay())}})),m(this,"_internalPlay",(()=>{var c,d;if(ye(this.engineId,"video _internalPlay",{paused:(c=this._videoDom)===null||c===void 0?void 0:c.paused,hasManuallyPaused:this._hasManuallyPaused}),this._hasManuallyPaused||(d=this._videoDom)===null||d===void 0||!d.paused)return;const l=this._videoDom.play();l!=null&&l.then&&l.then((()=>{var u;this.isLocal&&Cw&&!this._needLoad&&((u=this._videoDom)===null||u===void 0||u.load(),this._needLoad=!0)})).catch((u=>{var p,h,_,y;this._emitPlayFailed||(u.name!=="AbortError"?(this._emitPlayFailed=!0,(p=this._monitor)===null||p===void 0||p.report("rtc_error",{message:"video autoplay failed, userId: ".concat(this.userId,", ").concat(u.name),error_code:At.AUTOPLAY_FAILED}),this.emit("playback_event",{type:"video",rawEvent:u,readyState:((h=this._videoDom)===null||h===void 0?void 0:h.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:((_=this._videoDom)===null||_===void 0?void 0:_.currentTime)||0,isScreen:this.isScreen})):(y=this._monitor)===null||y===void 0||y.report("rtc_error",{message:"video autoplay failed, userId: ".concat(this.userId,", ").concat(u.name),error_code:At.AUTOPLAY_FAILED}))}))})),this.engineId=e,this.playerId=i;const o=s.renderDom;this._monitor=ke(e),this.logger=new ue("Player",0,e);const{userId:r}=s,n=s.isScreen?Zo.RENDER_MODE_FIT:Zo.RENDER_MODE_HIDDEN;this.renderMode=s.renderMode!==void 0?s.renderMode:n,this._rotate=Number(s.rotation||0);const a=typeof o=="string"?document.getElementById(o):o;if(!a)throw new G(C.CANT_FIND_DOM,"can't find dom");this._videoContainer=document.createElement("div"),this._videoContainer.style.width="100%",this._videoContainer.style.height="100%",this._videoContainer.style.position="relative",this._videoContainer.style.overflow="hidden",this._containerDom=a,this.userId=r,this.isLocal=!!s.isLocal,this.isScreen=!!s.isScreen,this._initVideo(),!this.isLocal||$r?.[0]!==15&&Dc!==15||(this._safari15VideoTimer=setTimeout((()=>{try{this._videoContainer.style.display="block",setTimeout((()=>{this._videoContainer.style.display="flex"}),500)}catch{}}),1e3))}_initVideo(){this._videoDom||(this._videoDom=Fp("video",{style:{width:"100%",height:"100%"},attributes:qD}),this._videoDom.id="".concat(this.userId,"_").concat(Ts()),this.setRenderMode(this.renderMode),this.mirror(this.mirrorType===yi.MIRROR_TYPE_RENDER)),this._containerDom.appendChild(this._videoContainer),[90,270].indexOf(this._rotate)>-1?(this._rotateDom=this._createRotationDiv(),this._rotateDom.appendChild(this._videoDom),this._videoContainer.appendChild(this._rotateDom)):(this._rotate===180&&(this._videoContainer.style.transform="rotate(180deg)"),this._videoContainer.appendChild(this._videoDom)),this._initInterSectionObserver(),this._initListeners(),this._onLocalTrackMute=()=>{this._needResume=!0},this._onInterruptionEnd=()=>{this.logger.warn("resume player after iOS interruption"),this._internalPlay()},is.on(ki.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),is.on(ki.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),is.on(ki.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd)}_initInterSectionObserver(){!this.intersectionObserver&&typeof IntersectionObserver<"u"&&this._videoDom&&(this.intersectionObserver=new IntersectionObserver((e=>{e[0]&&(this.isIntersecting=e[0].isIntersecting)}),{}),this.intersectionObserver.observe(this._videoDom))}_closeIntersectionObserver(){this.intersectionObserver&&this._videoDom&&(this.intersectionObserver.disconnect(),this.intersectionObserver.unobserve(this._videoDom),delete this.intersectionObserver)}_createRotationDiv(){const e=document.createElement("div");return e.style.transform="rotate(".concat(this._rotate,"deg)"),this._rotate!==180&&(e.style.position="absolute",this.refreshRenderSize("init"),window.ResizeObserver&&(this._resizeObserver=new ResizeObserver((()=>{this.refreshRenderSize("the container size has changed.")})),this._resizeObserver.observe(this._containerDom))),e}refreshRenderSize(e){if(this._rotateDom){var i,s;this.logger.print("refreshRenderSize","Because ".concat(e));const o=Number(window.getComputedStyle(this._containerDom).width.replace("px","")),r=Number(window.getComputedStyle(this._containerDom).height.replace("px","")),n=(i=this._videoDom)===null||i===void 0?void 0:i.videoWidth,a=(s=this._videoDom)===null||s===void 0?void 0:s.videoHeight;if(o&&r&&a&&n){let c,d;if(this.renderMode===Zo.RENDER_MODE_FILL)c=r,d=o;else{const l=this.renderMode===Zo.RENDER_MODE_HIDDEN?Math.max(o/a,r/n):Math.min(o/a,r/n);c=n*l,d=a*l}this._rotateDom.style.width="".concat(c,"px"),this._rotateDom.style.height="".concat(d,"px"),this._rotateDom.style.left="".concat((o-c)/2,"px"),this._rotateDom.style.top="".concat((r-d)/2,"px")}}}_initListeners(){this._videoDom&&Xc.forEach((e=>{var i;(i=this._videoDom)===null||i===void 0||i.addEventListener(e,this.emitVideoEvent)}))}_removeListeners(){this._videoDom&&Xc.forEach((e=>{var i;(i=this._videoDom)===null||i===void 0||i.removeEventListener(e,this.emitVideoEvent)}))}getPlayerVisibility(){return BD(this._videoDom)}setRenderMode(e){this.renderMode=e,this._videoDom&&(this.renderMode===Zo.RENDER_MODE_FIT?this._videoDom.style.objectFit="contain":this.renderMode===Zo.RENDER_MODE_FILL?this._videoDom.style.objectFit="fill":this._videoDom.style.objectFit="cover")}async playVideo(e){var i,s;let o=this._videoDom;if(this.logger.info("playVideo","play video track: ".concat(this.userId)),o&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById((i=e.preprocessingTrack)===null||i===void 0?void 0:i.id)){try{ye(this.engineId,"playVideo","play video repeatedly",0,this.userId)}catch{}return}o||(this._initVideo(),o=this._videoDom),this.logger.info("playVideo","play video by dom: ".concat((s=o)===null||s===void 0?void 0:s.id));const r=new MediaStream;r.addTrack(e.preprocessingTrack),o.srcObject=r,o&&!this._containerDom.contains(this._videoContainer)&&this._containerDom.appendChild(this._videoContainer),o&&!this._videoContainer.contains(o)&&this._videoContainer.appendChild(o),setTimeout((()=>this._internalPlay())),de.VIDEO_STALL&&this.emit(Mh.START_STALL_OBSERVE),this.played=!0,this.hasStartPlaying=!1}updateSrcObject(e){const i=e.preprocessingTrack;if(!i||!this._videoDom)return;const s=new MediaStream;s.addTrack(i),this._videoDom.srcObject=s}removeTrack(){var e;const i=(e=this._videoDom)===null||e===void 0?void 0:e.srcObject;if(i){const s=i.getVideoTracks();s!=null&&s.length&&s.forEach((o=>{i.removeTrack(o)}))}}manuallyPlay(){if(this.logger.info("Invoke VideoPlayer.manuallyPlay",this.userId,this.isScreen),this._emitPlayFailed=!1,this._hasManuallyPaused=!1,!this._videoDom)throw new G(C.INVALID_PARAMS,"Player not found");return this._videoDom.readyState!==0||Ur?this._videoDom.play():Promise.resolve()}manuallyPause(){if(this.logger.print("Invoke VideoPlayer.manuallyPause",this.userId,this.isScreen),this.played){if(this._hasManuallyPaused=!0,!this._videoDom)throw new G(C.INVALID_PARAMS,"Player not found");return this._videoDom.pause()}}mirror(e){this.logger.info("mirror","".concat(this.userId," set mirror: ").concat(e)),this.mirrorType=e?yi.MIRROR_TYPE_RENDER:yi.MIRROR_TYPE_NONE,this._videoDom&&(this._videoDom.style.transform=e?"rotateY(180deg)":"")}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];const{_containerDom:i}=this;var s,o;this.logger.info("stop","stop video track: ".concat(this.userId," ").concat(this.playerId.toString())),this._videoDom&&(e||(this._videoDom.srcObject=null),i!=null&&i.contains(this._videoContainer)&&i.removeChild(this._videoContainer),(s=this._videoContainer)===null||s===void 0||s.childNodes.forEach((r=>{r!==this._videoDom&&r!==this._rotateDom||this._videoContainer.removeChild(r)})),(o=this._rotateDom)!==null&&o!==void 0&&o.contains(this._videoDom)&&this._rotateDom.removeChild(this._videoDom)),this._hasManuallyPaused=!1,this.played=!1,this.hasStartPlaying=!1,de.VIDEO_STALL&&this.emit(Mh.STOP_STALL_OBSERVE),this._closeIntersectionObserver()}destroy(){var e;let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.logger.info("destroy","video player: ".concat(this.userId)),this.stop(i),(e=this._resizeObserver)===null||e===void 0||e.disconnect(),super.removeAllListeners(),this._removeListeners(),is.off(ki.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),is.off(ki.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),is.off(ki.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd),this._videoDom&&delete this._videoDom,this._safari15VideoTimer&&(window.clearInterval(this._safari15VideoTimer),this._safari15VideoTimer=void 0)}get domElement(){return this._videoDom}}class Cc extends Ai.EventEmitter{constructor(e,i){let{divId:s,muted:o,isScreen:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{divId:void 0,muted:!1,isScreen:!1};if(super(),m(this,"_containerDom",void 0),m(this,"_audioDom",void 0),m(this,"_fakeAudioDom",void 0),m(this,"userId",void 0),m(this,"muted",!1),m(this,"_emitPlayFailed",!1),m(this,"played",!1),m(this,"isScreen",void 0),m(this,"_wechatTimer",void 0),m(this,"_edgeTimer",void 0),m(this,"_monitor",void 0),m(this,"logger",void 0),m(this,"_pasued",!0),m(this,"hasStartPlaying",!1),m(this,"emitAudioEvent",(n=>{var a,c;const d={type:"audio",rawEvent:n,readyState:((a=this._audioDom)===null||a===void 0?void 0:a.readyState)||0,userId:this.userId,eventName:n.type,currentTime:((c=this._audioDom)===null||c===void 0?void 0:c.currentTime)||0};var l;n.type==="playing"&&this.logger.info("AudioPlayerPlaying","[userId-".concat(this.userId,"] audio element playing")),n.type==="pause"&&(this.logger.info("AudioPlayerPause","[userId-".concat(this.userId,"] audio element pause")),!this._pasued&&(l=this._audioDom)!==null&&l!==void 0&&(l=l.srcObject)!==null&&l!==void 0&&l.active&&this._internalPlay()),as&&Ur&&(n.type==="canplay"?(clearTimeout(this._wechatTimer),this._wechatTimer=setTimeout((()=>{this._autoPlayError("wechat")}),500)):n.type==="playing"&&clearTimeout(this._wechatTimer)),Hd&&Vw&&n.type==="error"&&(clearTimeout(this._edgeTimer),this._edgeTimer=setTimeout((()=>{var u;((u=this._audioDom)===null||u===void 0?void 0:u.currentTime)===0&&this._autoPlayError("edge")}),500)),this.emit("playback_event",d)})),m(this,"_internalPlay",(()=>{var n,a;if(ye(this.engineId,"audio _internalPlay",{paused:(n=this._audioDom)===null||n===void 0?void 0:n.paused,userId:this.userId,screen:this.isScreen}),(a=this._audioDom)!==null&&a!==void 0&&a.paused)try{var c;let l=this._audioDom.play();const u=oi.getAudioContextInstance();if(u.state==="suspended"){const p=u.resume(),h=setTimeout((()=>{var _;u.state==="suspended"&&(this._autoPlayError("AudioContext cannot resume"),(_=this._monitor)===null||_===void 0||_.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(this.userId,": Cannot resume the AudioContext - timeout"),error_code:At.AUTOPLAY_FAILED})),clearTimeout(h)}));p.catch((_=>{var y;this._autoPlayError("AudioContext cannot resume"),(y=this._monitor)===null||y===void 0||y.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(this.userId,": Cannot resume the AudioContext - rejected by: [").concat(_?.name,"]").concat(_?.message),error_code:At.AUTOPLAY_FAILED})})).finally((()=>{clearTimeout(h)}))}(c=l)!==null&&c!==void 0&&c.then&&(as&&Hd&&(l=l.then((()=>new Promise((p=>{setTimeout((async()=>{var h;(h=this._audioDom)===null||h===void 0||h.pause(),this._audioDom.volume=1,await this._audioDom.play(),p()}),500)}))))),l.then((()=>{ye(this.engineId,"_internalPlay successfully",{userId:this.userId,screen:this.isScreen}),this._pasued=!1})).catch((p=>{var h;this._autoPlayError(p),(h=this._monitor)===null||h===void 0||h.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(this.userId,": ").concat(p.message," ").concat(p.name),error_code:At.AUTOPLAY_FAILED})})))}catch(l){var d;this._autoPlayError(l),(d=this._monitor)===null||d===void 0||d.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(this.userId,": ").concat(l.message," ").concat(l.name),error_code:At.AUTOPLAY_FAILED})}})),this.engineId=e,s){const n=document.getElementById(s);if(!n)throw new G(C.CANT_FIND_DOM,"can't find dom");this._containerDom=n}else this._containerDom=document.body;this.userId=i,this.muted=o,this.isScreen=r,this._monitor=ke(e),this.logger=new ue("Player",0,e),this._initAudio()}_initAudio(){this._audioDom||(this._audioDom=Fp("audio",{style:{display:"none"},attributes:$D}),this._audioDom.volume=this.muted?0:1,this._audioDom.muted=this.muted,this._audioDom.id="".concat(this.userId,"_").concat(Ts()),this._containerDom.appendChild(this._audioDom)),this._initListeners()}_initListeners(){this._audioDom&&Xc.forEach((e=>{var i;(i=this._audioDom)===null||i===void 0||i.addEventListener(e,this.emitAudioEvent)}))}_removeListeners(){this._audioDom&&(Xc.forEach((e=>{var i;(i=this._audioDom)===null||i===void 0||i.removeEventListener(e,this.emitAudioEvent)})),this._audioDom.removeEventListener("canplay",this._internalPlay),this._audioDom.removeEventListener("loadeddata",this._internalPlay))}async playAudio(e){var i,s,o;this.logger.info("playAudio","play audio track: ".concat(this.userId));let r=this._audioDom;if(r&&r.srcObject instanceof MediaStream&&r.srcObject.getTrackById((i=e.preprocessingTrack)===null||i===void 0?void 0:i.id))return;r||(this._initAudio(),r=this._audioDom);const n=new MediaStream;e instanceof Op&&(this._fakeAudioDom=new Audio,this._fakeAudioDom.muted=!0,this._fakeAudioDom.srcObject=new MediaStream([e.originTrack])),n.addTrack(e.preprocessingTrack),as&&Hd&&(this._audioDom.volume=0),r.srcObject=n,(s=r)===null||s===void 0||s.addEventListener("canplay",this._internalPlay),(o=r)===null||o===void 0||o.addEventListener("loadeddata",this._internalPlay),setTimeout((()=>this._internalPlay())),this.played=!0,this.hasStartPlaying=!1}_autoPlayError(e){var i,s;this._emitPlayFailed||(this._emitPlayFailed=!0,this.emit("playback_event",{type:"audio",rawEvent:e,readyState:((i=this._audioDom)===null||i===void 0?void 0:i.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:((s=this._audioDom)===null||s===void 0?void 0:s.currentTime)||0}))}pause(){if(!this._audioDom)throw new G(C.INVALID_PARAMS,"Player not found");this._pasued=!0,this._audioDom.pause(),this.hasStartPlaying=!1}manuallyPause(){return this.pause()}manuallyPlay(){var e;if(this.logger.info("Invoke AudioPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._audioDom)throw new G(C.INVALID_PARAMS,"Player not found");if(!this.played)return Promise.resolve();this._audioDom.volume=1,this._audioDom.muted=!1,(e=this._fakeAudioDom)===null||e===void 0||e.play();const i=[],s=this._audioDom.play();s!=null&&s.then&&i.push(s);const o=oi.getAudioContextInstance();if(o.state==="suspended"){const n=o.resume();n!=null&&n.then&&i.push(n)}const r=i.length>0?Promise.all(i):Promise.resolve(s);return r.then((()=>{this._pasued=!1})),r}async setPlaybackDevice(e){this.logger.info("setPlaybackDevice","setPlaybackDevice: ".concat(e)),(await _t.enumerateAudioPlaybackDevices()).map((i=>i.deviceId)).includes(e)&&this._audioDom&&this._audioDom.setSinkId&&await this._audioDom.setSinkId(e)}stop(){const{_containerDom:e}=this;this.logger.info("stopAudio","stop audio track: ".concat(this.userId)),this._audioDom&&(this._audioDom.srcObject=null,e!=null&&e.contains(this._audioDom)&&e.removeChild(this._audioDom)),this._fakeAudioDom&&(this._fakeAudioDom.srcObject=null,this._fakeAudioDom=void 0),this.played=!1,this.hasStartPlaying=!1}get domElement(){return this._audioDom}destroy(){this.logger.info("destroy","audio player: ".concat(this.userId)),this.stop(),super.removeAllListeners(),this._removeListeners(),this._audioDom&&(this._audioDom.srcObject=null,delete this._audioDom),this._edgeTimer&&clearTimeout(this._edgeTimer)}}class _I{constructor(){m(this,"_ac",void 0),m(this,"_sourceNode",void 0),m(this,"_gainNode",void 0),m(this,"_destNode",void 0),this._ac=oi.getAudioContextInstance(),this._gainNode=this._ac.createGain(),this._destNode=this._ac.createMediaStreamDestination(),this._gainNode.connect(this._destNode)}setVolume(e){this._gainNode.gain.value=e/100}getVolume(){return Math.round(100*this._gainNode.gain.value)}updateInputTrack(e){this._sourceNode&&(this._sourceNode.mediaStream.getTracks().forEach((s=>{s.stop()})),delete this._sourceNode);const i=new MediaStream;i.addTrack(e),this._sourceNode=this._ac.createMediaStreamSource(i),this._sourceNode.connect(this._gainNode)}getOutputTrack(){return this._destNode.stream.getTracks()[0]}destroy(){var e,i;(e=this._sourceNode)===null||e===void 0||e.mediaStream.getTracks().forEach((s=>{s.stop()})),Dc!==13&&this._destNode.stream.getTracks().forEach((s=>{s.stop()})),(i=this._sourceNode)===null||i===void 0||i.disconnect(),this._gainNode.disconnect(),delete this._sourceNode}}class Uo extends sT{constructor(e,i,s){super(e,i,I(I({},s),{},{mediaType:tn.AUDIO})),m(this,"audioCaptureConfig",void 0),m(this,"_ap",void 0),m(this,"mixedAudioTrack",void 0),m(this,"mixType",Ti.PLAYOUT_AND_PUBLISH),m(this,"_audioFetchMap",new Map),m(this,"_audioDataFetcher",void 0),m(this,"_localPlaybackTrack",void 0),m(this,"notSupportedWebAudio",!1)}get withWebAudio(){return!!this._ap}getAudioLevel(){var e;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ac.MICROPHONE;const s=i===ac.AUDIOMIXING&&this.mixType!==Ti.PLAYOUT&&(e=this.mixedAudioTrack)!==null&&e!==void 0?e:this.preprocessingTrack;let o=this._audioFetchMap.get(i);var r;return o&&o.currentTrackId===s.id||((r=o)===null||r===void 0||r.destroy(),o=new Yp(s),this._audioFetchMap.set(i,o)),o.getAudioLevel()}async updateAudioCaptureConfig(){this.audioCaptureConfig&&(this.logger.print("updateAudioCaptureConfig","update localAudioTrack: ",this.audioCaptureConfig),await this.originTrack.applyConstraints(this.audioCaptureConfig))}setVolume(e){const i=!ae("SKIP_WEB_AUDIO_IN_TRACK")&&(Bf()||ae("ENFORCE_WEB_AUDIO_SUPPORTED"));i||(this.notSupportedWebAudio=!0);const s=!this.withWebAudio&&e!==100;try{i&&s&&(this.logger.print("Create AudioProcess"),this._ap=new _I,this._ap.updateInputTrack(this.originTrack),this.mediaTrack=this._ap.getOutputTrack())}catch{this.logger.warn("WebAudio may not supported, quired return"),this.notSupportedWebAudio=!0}var o;this.notSupportedWebAudio||(o=this._ap)===null||o===void 0||o.setVolume(e),i&&s&&this.emit("needReplaceTrack",this)}getVolume(){return this._ap?this._ap.getVolume():100}setUserId(e){this.trackInfo.streamUserId=e}setDataFetcher(e,i){this.logger.info("setDataFetcher","frameSize %s",e),oi.isWorkletReady!==null?this._audioDataFetcher?this._audioDataFetcher.setFrameSize(e):(this._audioDataFetcher=new Hp(this.preprocessingTrack,e),this._audioDataFetcher.on("data",i)):this.logger.info("setDataFetcher","audioContextManager.isWorkletReady is null")}stopDataFetcher(){var e,i;(e=this._audioDataFetcher)===null||e===void 0||e.removeAllListeners("data"),(i=this._audioDataFetcher)===null||i===void 0||i.destroy(),this._audioDataFetcher=void 0}play(e){var i,s;this._localPlaybackTrack&&this.stop();const o=e===It.AFTER_CAPTURE?this.originTrack:e===It.AFTER_PROCESS?this.preprocessingTrack:void 0;if(!o)return void this.logger.error("play()","no target track for %s",e);this._localPlaybackTrack=new Op(this._ctx,o.clone(),I({},this.trackInfo));const r=this._ctx.earMonitorSettings[(i=this.streamIndex)!==null&&i!==void 0?i:V.STREAM_INDEX_MAIN].volume;this.setPlaybackVolume(r);const n=new Cc(this._ctx.id,(s=this.trackInfo.streamUserId)!==null&&s!==void 0?s:"",{isScreen:this.streamIndex===V.STREAM_INDEX_SCREEN,muted:!1});return n.on("playback_event",(a=>{var c;a.eventName==="autoplay-error"&&this.emit("autoplay-error",{kind:"audio",streamIndex:(c=this.streamIndex)!==null&&c!==void 0?c:V.STREAM_INDEX_MAIN,mediaType:tn.AUDIO})})),this._localPlaybackTrack.setPlayer(n),this._localPlaybackTrack.play()}stop(){var e;(e=this._localPlaybackTrack)===null||e===void 0||e.destroy(),this._localPlaybackTrack=void 0}setPlaybackVolume(e){var i;return(i=this._localPlaybackTrack)===null||i===void 0?void 0:i.setVolume(e)}destroy(){var e,i;this._audioFetchMap.forEach((s=>s.destroy())),this._audioFetchMap.clear(),(e=this._ap)===null||e===void 0||e.destroy(),(i=this._audioDataFetcher)===null||i===void 0||i.destroy(),this._audioDataFetcher=void 0,this.stop(),super.destroy()}}class Op extends oT{constructor(e,i,s){super(e,i,I(I({},s),{},{mediaType:tn.AUDIO})),m(this,"_ap",void 0),m(this,"_audioPlayer",void 0),m(this,"_audioLevelFetcher",void 0),m(this,"_audioDataFetcher",void 0),m(this,"notSupportedWebAudio",!1)}get withWebAudio(){return!!this._ap}getAudioLevel(){return this._audioLevelFetcher||(this._audioLevelFetcher=new Yp(this.originTrack)),this._audioLevelFetcher.getAudioLevel()}setVolume(e){const i=!ae("SKIP_WEB_AUDIO_IN_TRACK")&&(Bf()||ae("ENFORCE_WEB_AUDIO_SUPPORTED"));i||(this.notSupportedWebAudio=!0);const s=!this.withWebAudio&&e!==100;try{i&&s&&(this.logger.print("Create AudioProcess"),this._ap=new _I,this._ap.updateInputTrack(this.originTrack),this.mediaTrack=this._ap.getOutputTrack())}catch{this.logger.warn("WebAudio may not supported, quite return"),this.notSupportedWebAudio=!0}if(this.notSupportedWebAudio){var o;const a=(o=this._audioPlayer)===null||o===void 0?void 0:o.domElement;a&&(a.volume=Math.min(e/100,1))}else{var r;(r=this._ap)===null||r===void 0||r.setVolume(e)}var n;i&&s&&(this.emit("needReplaceTrack",this),(n=this._audioPlayer)===null||n===void 0||n.playAudio(this))}getVolume(){var e,i;return this.notSupportedWebAudio?100*((e=(i=this._audioPlayer)===null||i===void 0||(i=i.domElement)===null||i===void 0?void 0:i.volume)!==null&&e!==void 0?e:1):this._ap?this._ap.getVolume():100}setPlaybackDevice(e){var i;return(i=this._audioPlayer)===null||i===void 0?void 0:i.setPlaybackDevice(e)}setPlayer(e){this._audioPlayer=e,this._wechatAutoplayWorkaround(e)}havePlayer(){return!!this._audioPlayer}bindPlayerEvent(e){var i;this._audioPlayer&&e(this._audioPlayer,this.isPublic,(i=this.streamIndex)!==null&&i!==void 0?i:V.STREAM_INDEX_MAIN)}pause(){var e;return(e=this._audioPlayer)===null||e===void 0?void 0:e.pause()}play(){var e;return(e=this._audioPlayer)===null||e===void 0?void 0:e.playAudio(this)}manuallyPlay(){var e,i,s;return(e=this._audioPlayer)!==null&&e!==void 0&&e.played?(i=this._audioPlayer)===null||i===void 0?void 0:i.manuallyPlay():(s=this._audioPlayer)===null||s===void 0?void 0:s.playAudio(this)}manuallyPause(){var e;return(e=this._audioPlayer)===null||e===void 0?void 0:e.manuallyPause()}stop(){var e;return(e=this._audioPlayer)===null||e===void 0?void 0:e.stop()}setDataFetcher(e,i){this.logger.info("setDataFetcher","frameSize %s",e),oi.isWorkletReady!==null?this._audioDataFetcher?this._audioDataFetcher.setFrameSize(e):(this._audioDataFetcher=new Hp(this.originTrack,e),this._audioDataFetcher.on("data",i)):this.logger.warn("setDataFetcher","audioContextManager.isWorkletReady is null")}stopDataFetcher(){var e;this.logger.info("stopDataFetcher"),(e=this._audioDataFetcher)===null||e===void 0||e.destroy(),this._audioDataFetcher=void 0}destroy(){var e,i,s;(e=this._audioLevelFetcher)===null||e===void 0||e.destroy(),(i=this._audioDataFetcher)===null||i===void 0||i.destroy(),this._audioDataFetcher=void 0,this._ap&&this._ap.destroy(),(s=this._audioPlayer)===null||s===void 0||s.destroy(),this._audioPlayer=void 0,super.destroy()}_wechatAutoplayWorkaround(e){if(Ur){let i;e.on("playback_event",(s=>{const o=oi.getAudioContextInstance();s.eventName==="autoplay-error"?o&&o.state==="running"&&(i=o.createMediaStreamSource(new MediaStream([this.originTrack])),i.connect(o.destination),ye(this._ctx.id,"wechatAutoplayWorkaround.connect",{userId:this.trackInfo.streamUserId,streamIndex:this.streamIndex,contextState:o.state,trackInfo:this.trackInfo})):s.eventName==="playing"&&i&&(i.disconnect(),i=void 0,ye(this._ctx.id,"wechatAutoplayWorkaround.disconnect",{userId:this.trackInfo.streamUserId,streamIndex:this.streamIndex,contextState:o.state,trackInfo:this.trackInfo}))}))}}}const e3=new ue("VERTC",0);let wh,Jn=null;const t3=()=>!!SI();function SI(){if(Jn)return Jn;try{Jn=window.require("electron");const{ipcRenderer:t}=Jn;return wh={getSources:e=>t.invoke("DESKTOP_CAPTURER_GET_SOURCES",e)},Jn}catch{return null}}async function vI(t,e,i){let s;return e||(e={width:1920,height:1080,frameRate:15}),s=i?{audio:{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",maxHeight:e.height,maxWidth:e.width,maxFrameRate:e.frameRate}}}:{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:e.height,maxWidth:e.width,maxFrameRate:e.frameRate}}},e3.info("getUserMediaConfig",JSON.stringify(s)),await navigator.mediaDevices.getUserMedia(s)}async function gI(t){let e=["window","screen"];if(t==="window"&&(e=["window"]),t==="screen"&&(e=["screen"]),!SI())throw new G(C.ERR_ELECTRON_IS_NULL,"Unable to get Electron object");let i=null;try{i=wh.getSources({types:e})}catch{i=null}i&&i.then||(i=new Promise(((s,o)=>{wh.getSources({types:e},((r,n)=>{r?o(r):s(n)}))})));try{return await i}catch(s){throw new G(C.ERR_ELECTRON_IS_NULL,s.toString())}}function i3(t){return new Promise(((e,i)=>{const s=document.createElement("div");s.innerText="share screen",s.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const r=document.createElement("div");r.innerText="Web Screensharing wants to share the contents of your screen. Choose what you'd like to share.",r.setAttribute("style","height: 12%;");const n=document.createElement("div");n.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");const c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=()=>{document.body.removeChild(d);const l=new Error("NotAllowedError");l.name="NotAllowedError",i(l)},a.appendChild(c),o.appendChild(r),o.appendChild(n),o.appendChild(a);const d=document.createElement("div");d.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),d.appendChild(s),d.appendChild(o),document.body.appendChild(d),t.map((l=>{if(l.id){const u=document.createElement("div");u.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;"),u.innerHTML=`<div style='height: 120px; display: table-cell; vertical-align: middle;'> 
          <img style='width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);' src=
          `.concat(l.thumbnail.toDataURL(),`
           />
          </div>
          <span style='	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'>
          `).concat(l.name,`
          </span>`),u.onclick=()=>{document.body.removeChild(d),e(l.id)},n.appendChild(u)}}))}))}async function s3(t,e){const i=await gI(),s=await i3(i);return await vI(s,t,e)}async function o3(t,e){const i=new $o(t,e,{streamIndex:He.MAIN,sourceType:Ne.INTERNAL,isDummy:!0});return await i.isTrackReady,i}async function r3(t,e){const i=new $o(t,e,{isDummy:!0,streamIndex:He.SCREEN,sourceType:Ne.INTERNAL});return await i.isTrackReady,i}async function Xd(t,e){var i;let s;const o=((i=(e=e||t.videoProfile.getCaptureConfig()).deviceId)===null||i===void 0?void 0:i.exact)||"default",r=Wt(),n=new ue("TrackFactory",0,t.id);try{var a,c,d;n.info("createCameraVideoTrack","constraints:",e),(a=t.monitor)===null||a===void 0||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o,capture_session_id:r});const h=ee();Te&&(e.frameRate={ideal:30,max:30}),s=await _t.getUserMedia({video:e}),(c=t.monitor)===null||c===void 0||c.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,media_device_name:((d=s.getVideoTracks()[0])===null||d===void 0?void 0:d.label)||"",reason:"success",elapse:ee()-h,capture_session_id:r})}catch(h){var l;throw(l=t.monitor)===null||l===void 0||l.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:h.code,reason:h.name+h.message,capture_session_id:r}),new G(C.GET_VIDEO_TRACK_FAILED,"throw error from getUserMedia. [".concat(h.name||"unknown name","]: ").concat(h.message||"unknown message","."),h)}const u=s.getVideoTracks()[0],p=new $o(t,u,{streamIndex:He.MAIN,sourceType:Ne.INTERNAL,captureSessionId:r});return await p.isTrackReady,p}async function Kh(t,e){var i;let s;new ue("TrackFactory",0,t.id).info("createMicrophoneAudioTrack","constraints:",e);const o=((i=e.deviceId)===null||i===void 0?void 0:i.exact)||"default",r=Wt();try{var n,a,c;(n=t.monitor)===null||n===void 0||n.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_begin",media_device_id:o,event_session_id:r});const p=ee();t.extensionManager.getPluginByName(zr.PRE_PROCESSING,"RTCAIAnsExtension")&&(e.autoGainControl=!0,e.noiseSuppression=!1),s=await _t.getUserMedia({audio:e}),(a=t.monitor)===null||a===void 0||a.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_result",media_device_id:o,media_device_name:((c=s.getAudioTracks()[0])===null||c===void 0?void 0:c.label)||"",reason:"success",elapse:ee()-p,event_session_id:r})}catch(p){var d;throw(d=t.monitor)===null||d===void 0||d.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_end",media_device_id:o,error_code:p.code,reason:p.name+p.message,event_session_id:r}),new G(C.GET_AUDIO_TRACK_FAILED,"throw error from getUserMedia. [".concat(p.name||"unknown name","]: ").concat(p.message||"unknown message","."),p)}const l=s.getAudioTracks()[0],u=new Uo(t,l,{streamIndex:He.MAIN,sourceType:Ne.INTERNAL,captureSessionId:r});return await u.isTrackReady,u}async function n3(t,e,i){var s,o;let r;new ue("TrackFactory",0,t.id).print("createCameraAndMicrophoneTrack","audioConstraints:",e,"videoConstraints:",i);const n=((s=e.deviceId)===null||s===void 0?void 0:s.exact)||"default",a=((o=i.deviceId)===null||o===void 0?void 0:o.exact)||"default",c=Wt(),d=Wt();try{var l,u,p,h,_,y;(l=t.monitor)===null||l===void 0||l.report("rtc_video_capture_event",{event_type:"start",media_device_id:a,capture_session_id:c}),(u=t.monitor)===null||u===void 0||u.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_begin",media_device_id:n,event_session_id:d});const R=ee();Te&&(i.frameRate={ideal:30,max:30}),t.extensionManager.getPluginByName(zr.PRE_PROCESSING,"RTCAIAnsExtension")&&(e.autoGainControl=!0,e.noiseSuppression=!1),r=await _t.getUserMedia({audio:e,video:i}),(p=t.monitor)===null||p===void 0||p.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:a,media_device_name:((h=r.getVideoTracks()[0])===null||h===void 0?void 0:h.label)||"",reason:"success",elapse:ee()-R,capture_session_id:c}),(_=t.monitor)===null||_===void 0||_.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_result",media_device_id:n,media_device_name:((y=r.getAudioTracks()[0])===null||y===void 0?void 0:y.label)||"",reason:"success",elapse:ee()-R,event_session_id:d})}catch(R){var b,S;throw(b=t.monitor)===null||b===void 0||b.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:a,error_code:R.code,reason:R.name+R.message,capture_session_id:c}),(S=t.monitor)===null||S===void 0||S.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_end",media_device_id:n,error_code:R.code,reason:R.name+R.message,event_session_id:d}),new G(C.GET_VIDEO_TRACK_FAILED,"throw error from getUserMedia. [".concat(R.name||"unknown name","]: ").concat(R.message||"unknown message","."),R)}const v=r.getVideoTracks()[0],f=new $o(t,v,{streamIndex:He.MAIN,sourceType:Ne.INTERNAL,captureSessionId:c}),g=r.getAudioTracks()[0],Z=new Uo(t,g,{streamIndex:He.MAIN,sourceType:Ne.INTERNAL,captureSessionId:d});return await Promise.all([f.isTrackReady,Z.isTrackReady]),{videoTrack:f,audioTrack:Z}}async function a3(t,e){const i=new ue("TrackFactory",0,t.id);let s,o=t.videoProfile.getScreenEncodeConfig();i.info("createScreenTracks","screenConfig: %o, constraints: %o",e,o);const r=Wt(),{enableAudio:n=!1,displaySurface:a,systemAudio:c,surfaceSwitching:d,selfBrowserSurface:l,sourceId:u}=e,p={};a&&["monitor","browser","window"].includes(a)&&(o?o.displaySurface=a:o={displaySurface:a}),c&&["include","exclude"].includes(c)&&(p.systemAudio=c),d&&["include","exclude"].includes(d)&&(p.surfaceSwitching=d),l&&["include","exclude"].includes(l)&&(p.selfBrowserSurface=l);try{var h,_,y,b;(h=t.monitor)===null||h===void 0||h.report("rtc_video_capture_event",{event_type:"start",media_device_id:"screen",capture_session_id:r});const Z=ee();s=t3()?u?await vI(u,o,n):await s3(o,n):await navigator.mediaDevices.getDisplayMedia(I({video:!(!o||SK)||o,audio:!!n&&{channelCount:2,noiseSuppression:!1,echoCancellation:!0,autoGainControl:!1}},p)),(_=t.monitor)===null||_===void 0||_.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:"screen",media_device_name:"".concat(((y=s.getVideoTracks()[0])===null||y===void 0?void 0:y.label)||"",", ").concat(((b=s.getAudioTracks()[0])===null||b===void 0?void 0:b.label)||""),reason:"success",elapse:ee()-Z,capture_session_id:r})}catch(Z){var S;throw(S=t.monitor)===null||S===void 0||S.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:"screen",error_code:Z.code,reason:Z.name+Z.message,capture_session_id:r}),new G(C.GET_SCREEN_TRACK_FAILED,"throw error from getDisplayMedia",Z)}const v=s.getVideoTracks()[0],f=new $o(t,v,{streamIndex:He.SCREEN,sourceType:Ne.INTERNAL,captureSessionId:r}),g=s.getAudioTracks()[0];if(s.getAudioTracks().length){const Z=new Uo(t,g,{streamIndex:He.SCREEN,sourceType:Ne.INTERNAL,captureSessionId:r});return await Promise.all([f.isTrackReady,Z.isTrackReady]),[f,Z]}return await f.isTrackReady,[f,void 0]}function d3(t,e,i,s){return new HD(t,e,i,I({},s))}function fI(t,e,i){return new Op(t,e,I({},i))}async function c3(t,e){const i=new $o(t,e,{streamIndex:He.MAIN,sourceType:Ne.EXTERNAL});return await i.isTrackReady,i}async function l3(t,e){const i=new Uo(t,e,{streamIndex:He.MAIN,sourceType:Ne.EXTERNAL});return await i.isTrackReady,i}async function u3(t,e){const i=new $o(t,e,{sourceType:Ne.EXTERNAL,streamIndex:He.SCREEN});return await i.isTrackReady,i}async function m3(t,e){const i=new Uo(t,e,{sourceType:Ne.EXTERNAL,streamIndex:He.SCREEN});return await i.isTrackReady,i}const ZI="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciB0PSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e307ZnVuY3Rpb24gZSh0KXtyZXR1cm4gdCYmdC5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwiZGVmYXVsdCIpP3QuZGVmYXVsdDp0fWZ1bmN0aW9uIHIodCl7aWYodC5fX2VzTW9kdWxlKXJldHVybiB0O3ZhciBlPXQuZGVmYXVsdDtpZigiZnVuY3Rpb24iPT10eXBlb2YgZSl7dmFyIHI9ZnVuY3Rpb24gdCgpe2lmKHRoaXMgaW5zdGFuY2VvZiB0KXt2YXIgcj1bbnVsbF07cmV0dXJuIHIucHVzaC5hcHBseShyLGFyZ3VtZW50cyksbmV3KEZ1bmN0aW9uLmJpbmQuYXBwbHkoZSxyKSl9cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfTtyLnByb3RvdHlwZT1lLnByb3RvdHlwZX1lbHNlIHI9e307cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxPYmplY3Qua2V5cyh0KS5mb3JFYWNoKChmdW5jdGlvbihlKXt2YXIgbj1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsZSxuLmdldD9uOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0W2VdfX0pfSkpLHJ9dmFyIG49e2V4cG9ydHM6e319LGk9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuTWF0aD09PU1hdGgmJnR9LG89aSgib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXMmJmdsb2JhbFRoaXMpfHxpKCJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3cpfHxpKCJvYmplY3QiPT10eXBlb2Ygc2VsZiYmc2VsZil8fGkoIm9iamVjdCI9PXR5cGVvZiB0JiZ0KXx8aSgib2JqZWN0Ij09dHlwZW9mIHQmJnQpfHxmdW5jdGlvbigpe3JldHVybiB0aGlzfSgpfHxGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpLHM9ZnVuY3Rpb24odCl7dHJ5e3JldHVybiEhdCgpfWNhdGNoKGUpe3JldHVybiEwfX0sYT0hcygoZnVuY3Rpb24oKXt2YXIgdD1mdW5jdGlvbigpe30uYmluZCgpO3JldHVybiJmdW5jdGlvbiIhPXR5cGVvZiB0fHx0Lmhhc093blByb3BlcnR5KCJwcm90b3R5cGUiKX0pKSxjPWEsdT1GdW5jdGlvbi5wcm90b3R5cGUsbD11LmFwcGx5LGg9dS5jYWxsLGY9Im9iamVjdCI9PXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmFwcGx5fHwoYz9oLmJpbmQobCk6ZnVuY3Rpb24oKXtyZXR1cm4gaC5hcHBseShsLGFyZ3VtZW50cyl9KSxkPWEscD1GdW5jdGlvbi5wcm90b3R5cGUsXz1wLmNhbGwsZz1kJiZwLmJpbmQuYmluZChfLF8pLG09ZD9nOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBfLmFwcGx5KHQsYXJndW1lbnRzKX19LHk9bSx2PXkoe30udG9TdHJpbmcpLGI9eSgiIi5zbGljZSksdz1mdW5jdGlvbih0KXtyZXR1cm4gYih2KHQpLDgsLTEpfSxTPXcsaz1tLE89ZnVuY3Rpb24odCl7aWYoIkZ1bmN0aW9uIj09PVModCkpcmV0dXJuIGsodCl9LHg9Im9iamVjdCI9PXR5cGVvZiBkb2N1bWVudCYmZG9jdW1lbnQuYWxsLEU9dm9pZCAwPT09eCYmdm9pZCAwIT09eD9mdW5jdGlvbih0KXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdHx8dD09PXh9OmZ1bmN0aW9uKHQpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiB0fSxBPXt9LEM9IXMoKGZ1bmN0aW9uKCl7cmV0dXJuIDchPT1PYmplY3QuZGVmaW5lUHJvcGVydHkoe30sMSx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSlbMV19KSksST1hLFQ9RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsTD1JP1QuYmluZChUKTpmdW5jdGlvbigpe3JldHVybiBULmFwcGx5KFQsYXJndW1lbnRzKX0sQj17fSxOPXt9LnByb3BlcnR5SXNFbnVtZXJhYmxlLFI9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcix6PVImJiFOLmNhbGwoezE6Mn0sMSk7Qi5mPXo/ZnVuY3Rpb24odCl7dmFyIGU9Uih0aGlzLHQpO3JldHVybiEhZSYmZS5lbnVtZXJhYmxlfTpOO3ZhciBELFAsTT1mdW5jdGlvbih0LGUpe3JldHVybntlbnVtZXJhYmxlOiEoMSZ0KSxjb25maWd1cmFibGU6ISgyJnQpLHdyaXRhYmxlOiEoNCZ0KSx2YWx1ZTplfX0sRj1zLGo9dyxVPU9iamVjdCxIPW0oIiIuc3BsaXQpLEs9RigoZnVuY3Rpb24oKXtyZXR1cm4hVSgieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApfSkpP2Z1bmN0aW9uKHQpe3JldHVybiJTdHJpbmciPT09aih0KT9IKHQsIiIpOlUodCl9OlUsSj1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dH0sVz1KLFo9VHlwZUVycm9yLEc9ZnVuY3Rpb24odCl7aWYoVyh0KSl0aHJvdyBuZXcgWigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIit0KTtyZXR1cm4gdH0sVj1LLCQ9RyxYPWZ1bmN0aW9uKHQpe3JldHVybiBWKCQodCkpfSxZPUUscT1mdW5jdGlvbih0KXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIHQ/bnVsbCE9PXQ6WSh0KX0sUT17fSx0dD1RLGV0PW8scnQ9RSxudD1mdW5jdGlvbih0KXtyZXR1cm4gcnQodCk/dDp2b2lkIDB9LGl0PWZ1bmN0aW9uKHQsZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj9udCh0dFt0XSl8fG50KGV0W3RdKTp0dFt0XSYmdHRbdF1bZV18fGV0W3RdJiZldFt0XVtlXX0sb3Q9bSh7fS5pc1Byb3RvdHlwZU9mKSxzdD1vLm5hdmlnYXRvcixhdD1zdCYmc3QudXNlckFnZW50LGN0PW8sdXQ9YXQ/U3RyaW5nKGF0KToiIixsdD1jdC5wcm9jZXNzLGh0PWN0LkRlbm8sZnQ9bHQmJmx0LnZlcnNpb25zfHxodCYmaHQudmVyc2lvbixkdD1mdCYmZnQudjg7ZHQmJihQPShEPWR0LnNwbGl0KCIuIikpWzBdPjAmJkRbMF08ND8xOisoRFswXStEWzFdKSksIVAmJnV0JiYoIShEPXV0Lm1hdGNoKC9FZGdlXC8oXGQrKS8pKXx8RFsxXT49NzQpJiYoRD11dC5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pKSYmKFA9K0RbMV0pO3ZhciBwdD1QLF90PXB0LGd0PXMsbXQ9by5TdHJpbmcseXQ9ISFPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzJiYhZ3QoKGZ1bmN0aW9uKCl7dmFyIHQ9U3ltYm9sKCJzeW1ib2wgZGV0ZWN0aW9uIik7cmV0dXJuIW10KHQpfHwhKE9iamVjdCh0KWluc3RhbmNlb2YgU3ltYm9sKXx8IVN5bWJvbC5zaGFtJiZfdCYmX3Q8NDF9KSksdnQ9eXQmJiFTeW1ib2wuc2hhbSYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3IsYnQ9aXQsd3Q9RSxTdD1vdCxrdD1PYmplY3QsT3Q9dnQ/ZnVuY3Rpb24odCl7cmV0dXJuInN5bWJvbCI9PXR5cGVvZiB0fTpmdW5jdGlvbih0KXt2YXIgZT1idCgiU3ltYm9sIik7cmV0dXJuIHd0KGUpJiZTdChlLnByb3RvdHlwZSxrdCh0KSl9LHh0PVN0cmluZyxFdD1mdW5jdGlvbih0KXt0cnl7cmV0dXJuIHh0KHQpfWNhdGNoKGUpe3JldHVybiJPYmplY3QifX0sQXQ9RSxDdD1FdCxJdD1UeXBlRXJyb3IsVHQ9ZnVuY3Rpb24odCl7aWYoQXQodCkpcmV0dXJuIHQ7dGhyb3cgbmV3IEl0KEN0KHQpKyIgaXMgbm90IGEgZnVuY3Rpb24iKX0sTHQ9VHQsQnQ9SixOdD1MLFJ0PUUsenQ9cSxEdD1UeXBlRXJyb3IsUHQ9e2V4cG9ydHM6e319LE10PW8sRnQ9T2JqZWN0LmRlZmluZVByb3BlcnR5LGp0PW8sVXQ9ZnVuY3Rpb24odCxlKXt0cnl7RnQoTXQsdCx7dmFsdWU6ZSxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KX1jYXRjaChyKXtNdFt0XT1lfXJldHVybiBlfSxIdD0iX19jb3JlLWpzX3NoYXJlZF9fIixLdD1QdC5leHBvcnRzPWp0W0h0XXx8VXQoSHQse30pOyhLdC52ZXJzaW9uc3x8KEt0LnZlcnNpb25zPVtdKSkucHVzaCh7dmVyc2lvbjoiMy4zOS4wIixtb2RlOiJwdXJlIixjb3B5cmlnaHQ6IsKpIDIwMTQtMjAyNCBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSIsbGljZW5zZToiaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvYmxvYi92My4zOS4wL0xJQ0VOU0UiLHNvdXJjZToiaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMifSk7dmFyIEp0PVB0LmV4cG9ydHMsV3Q9SnQsWnQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gV3RbdF18fChXdFt0XT1lfHx7fSl9LEd0PUcsVnQ9T2JqZWN0LCR0PWZ1bmN0aW9uKHQpe3JldHVybiBWdChHdCh0KSl9LFh0PSR0LFl0PW0oe30uaGFzT3duUHJvcGVydHkpLHF0PU9iamVjdC5oYXNPd258fGZ1bmN0aW9uKHQsZSl7cmV0dXJuIFl0KFh0KHQpLGUpfSxRdD1tLHRlPTAsZWU9TWF0aC5yYW5kb20oKSxyZT1RdCgxLi50b1N0cmluZyksbmU9ZnVuY3Rpb24odCl7cmV0dXJuIlN5bWJvbCgiKyh2b2lkIDA9PT10PyIiOnQpKyIpXyIrcmUoKyt0ZStlZSwzNil9LGllPVp0LG9lPXF0LHNlPW5lLGFlPXl0LGNlPXZ0LHVlPW8uU3ltYm9sLGxlPWllKCJ3a3MiKSxoZT1jZT91ZS5mb3J8fHVlOnVlJiZ1ZS53aXRob3V0U2V0dGVyfHxzZSxmZT1mdW5jdGlvbih0KXtyZXR1cm4gb2UobGUsdCl8fChsZVt0XT1hZSYmb2UodWUsdCk/dWVbdF06aGUoIlN5bWJvbC4iK3QpKSxsZVt0XX0sZGU9TCxwZT1xLF9lPU90LGdlPWZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlXTtyZXR1cm4gQnQocik/dm9pZCAwOkx0KHIpfSxtZT1mdW5jdGlvbih0LGUpe3ZhciByLG47aWYoInN0cmluZyI9PT1lJiZSdChyPXQudG9TdHJpbmcpJiYhenQobj1OdChyLHQpKSlyZXR1cm4gbjtpZihSdChyPXQudmFsdWVPZikmJiF6dChuPU50KHIsdCkpKXJldHVybiBuO2lmKCJzdHJpbmciIT09ZSYmUnQocj10LnRvU3RyaW5nKSYmIXp0KG49TnQocix0KSkpcmV0dXJuIG47dGhyb3cgbmV3IER0KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX0seWU9VHlwZUVycm9yLHZlPWZlKCJ0b1ByaW1pdGl2ZSIpLGJlPWZ1bmN0aW9uKHQsZSl7aWYoIXBlKHQpfHxfZSh0KSlyZXR1cm4gdDt2YXIgcixuPWdlKHQsdmUpO2lmKG4pe2lmKHZvaWQgMD09PWUmJihlPSJkZWZhdWx0Iikscj1kZShuLHQsZSksIXBlKHIpfHxfZShyKSlyZXR1cm4gcjt0aHJvdyBuZXcgeWUoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpfXJldHVybiB2b2lkIDA9PT1lJiYoZT0ibnVtYmVyIiksbWUodCxlKX0sd2U9T3QsU2U9ZnVuY3Rpb24odCl7dmFyIGU9YmUodCwic3RyaW5nIik7cmV0dXJuIHdlKGUpP2U6ZSsiIn0sa2U9cSxPZT1vLmRvY3VtZW50LHhlPWtlKE9lKSYma2UoT2UuY3JlYXRlRWxlbWVudCksRWU9ZnVuY3Rpb24odCl7cmV0dXJuIHhlP09lLmNyZWF0ZUVsZW1lbnQodCk6e319LEFlPUVlLENlPSFDJiYhcygoZnVuY3Rpb24oKXtyZXR1cm4gNyE9PU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBZSgiZGl2IiksImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KS5hfSkpLEllPUMsVGU9TCxMZT1CLEJlPU0sTmU9WCxSZT1TZSx6ZT1xdCxEZT1DZSxQZT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO0EuZj1JZT9QZTpmdW5jdGlvbih0LGUpe2lmKHQ9TmUodCksZT1SZShlKSxEZSl0cnl7cmV0dXJuIFBlKHQsZSl9Y2F0Y2gocil7fWlmKHplKHQsZSkpcmV0dXJuIEJlKCFUZShMZS5mLHQsZSksdFtlXSl9O3ZhciBNZT1zLEZlPUUsamU9LyN8XC5wcm90b3R5cGVcLi8sVWU9ZnVuY3Rpb24odCxlKXt2YXIgcj1LZVtIZSh0KV07cmV0dXJuIHI9PT1XZXx8ciE9PUplJiYoRmUoZSk/TWUoZSk6ISFlKX0sSGU9VWUubm9ybWFsaXplPWZ1bmN0aW9uKHQpe3JldHVybiBTdHJpbmcodCkucmVwbGFjZShqZSwiLiIpLnRvTG93ZXJDYXNlKCl9LEtlPVVlLmRhdGE9e30sSmU9VWUuTkFUSVZFPSJOIixXZT1VZS5QT0xZRklMTD0iUCIsWmU9VWUsR2U9VHQsVmU9YSwkZT1PKE8uYmluZCksWGU9ZnVuY3Rpb24odCxlKXtyZXR1cm4gR2UodCksdm9pZCAwPT09ZT90OlZlPyRlKHQsZSk6ZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShlLGFyZ3VtZW50cyl9fSxZZT17fSxxZT1DJiZzKChmdW5jdGlvbigpe3JldHVybiA0MiE9PU9iamVjdC5kZWZpbmVQcm9wZXJ0eSgoZnVuY3Rpb24oKXt9KSwicHJvdG90eXBlIix7dmFsdWU6NDIsd3JpdGFibGU6ITF9KS5wcm90b3R5cGV9KSksUWU9cSx0cj1TdHJpbmcsZXI9VHlwZUVycm9yLHJyPWZ1bmN0aW9uKHQpe2lmKFFlKHQpKXJldHVybiB0O3Rocm93IG5ldyBlcih0cih0KSsiIGlzIG5vdCBhbiBvYmplY3QiKX0sbnI9Qyxpcj1DZSxvcj1xZSxzcj1ycixhcj1TZSxjcj1UeXBlRXJyb3IsdXI9T2JqZWN0LmRlZmluZVByb3BlcnR5LGxyPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsaHI9ImVudW1lcmFibGUiLGZyPSJjb25maWd1cmFibGUiLGRyPSJ3cml0YWJsZSI7WWUuZj1ucj9vcj9mdW5jdGlvbih0LGUscil7aWYoc3IodCksZT1hcihlKSxzcihyKSwiZnVuY3Rpb24iPT10eXBlb2YgdCYmInByb3RvdHlwZSI9PT1lJiYidmFsdWUiaW4gciYmZHIgaW4gciYmIXJbZHJdKXt2YXIgbj1scih0LGUpO24mJm5bZHJdJiYodFtlXT1yLnZhbHVlLHI9e2NvbmZpZ3VyYWJsZTpmciBpbiByP3JbZnJdOm5bZnJdLGVudW1lcmFibGU6aHIgaW4gcj9yW2hyXTpuW2hyXSx3cml0YWJsZTohMX0pfXJldHVybiB1cih0LGUscil9OnVyOmZ1bmN0aW9uKHQsZSxyKXtpZihzcih0KSxlPWFyKGUpLHNyKHIpLGlyKXRyeXtyZXR1cm4gdXIodCxlLHIpfWNhdGNoKG4pe31pZigiZ2V0ImluIHJ8fCJzZXQiaW4gcil0aHJvdyBuZXcgY3IoIkFjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIik7cmV0dXJuInZhbHVlImluIHImJih0W2VdPXIudmFsdWUpLHR9O3ZhciBwcj1ZZSxfcj1NLGdyPUM/ZnVuY3Rpb24odCxlLHIpe3JldHVybiBwci5mKHQsZSxfcigxLHIpKX06ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0W2VdPXIsdH0sbXI9byx5cj1mLHZyPU8sYnI9RSx3cj1BLmYsU3I9WmUsa3I9USxPcj1YZSx4cj1ncixFcj1xdCxBcj1mdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbihyLG4saSl7aWYodGhpcyBpbnN0YW5jZW9mIGUpe3N3aXRjaChhcmd1bWVudHMubGVuZ3RoKXtjYXNlIDA6cmV0dXJuIG5ldyB0O2Nhc2UgMTpyZXR1cm4gbmV3IHQocik7Y2FzZSAyOnJldHVybiBuZXcgdChyLG4pfXJldHVybiBuZXcgdChyLG4saSl9cmV0dXJuIHlyKHQsdGhpcyxhcmd1bWVudHMpfTtyZXR1cm4gZS5wcm90b3R5cGU9dC5wcm90b3R5cGUsZX0sQ3I9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYyx1LGwsaD10LnRhcmdldCxmPXQuZ2xvYmFsLGQ9dC5zdGF0LHA9dC5wcm90byxfPWY/bXI6ZD9tcltoXTptcltoXSYmbXJbaF0ucHJvdG90eXBlLGc9Zj9rcjprcltoXXx8eHIoa3IsaCx7fSlbaF0sbT1nLnByb3RvdHlwZTtmb3IobyBpbiBlKW49IShyPVNyKGY/bzpoKyhkPyIuIjoiIyIpK28sdC5mb3JjZWQpKSYmXyYmRXIoXyxvKSxhPWdbb10sbiYmKGM9dC5kb250Q2FsbEdldFNldD8obD13cihfLG8pKSYmbC52YWx1ZTpfW29dKSxzPW4mJmM/YzplW29dLChyfHxwfHx0eXBlb2YgYSE9dHlwZW9mIHMpJiYodT10LmJpbmQmJm4/T3Iocyxtcik6dC53cmFwJiZuP0FyKHMpOnAmJmJyKHMpP3ZyKHMpOnMsKHQuc2hhbXx8cyYmcy5zaGFtfHxhJiZhLnNoYW0pJiZ4cih1LCJzaGFtIiwhMCkseHIoZyxvLHUpLHAmJihFcihrcixpPWgrIlByb3RvdHlwZSIpfHx4cihrcixpLHt9KSx4cihrcltpXSxvLHMpLHQucmVhbCYmbSYmKHJ8fCFtW29dKSYmeHIobSxvLHMpKSl9LElyPUNyLFRyPUMsTHI9WWUuZjtJcih7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOk9iamVjdC5kZWZpbmVQcm9wZXJ0eSE9PUxyLHNoYW06IVRyfSx7ZGVmaW5lUHJvcGVydHk6THJ9KTt2YXIgQnI9US5PYmplY3QsTnI9bi5leHBvcnRzPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gQnIuZGVmaW5lUHJvcGVydHkodCxlLHIpfTtCci5kZWZpbmVQcm9wZXJ0eS5zaGFtJiYoTnIuc2hhbT0hMCk7dmFyIFJyPWUobi5leHBvcnRzKSx6cj13LERyPUFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKHQpe3JldHVybiJBcnJheSI9PT16cih0KX0sUHI9TWF0aC5jZWlsLE1yPU1hdGguZmxvb3IsRnI9TWF0aC50cnVuY3x8ZnVuY3Rpb24odCl7dmFyIGU9K3Q7cmV0dXJuKGU+MD9NcjpQcikoZSl9LGpyPWZ1bmN0aW9uKHQpe3ZhciBlPSt0O3JldHVybiBlIT1lfHwwPT09ZT8wOkZyKGUpfSxVcj1qcixIcj1NYXRoLm1pbixLcj1mdW5jdGlvbih0KXt2YXIgZT1Vcih0KTtyZXR1cm4gZT4wP0hyKGUsOTAwNzE5OTI1NDc0MDk5MSk6MH0sSnI9ZnVuY3Rpb24odCl7cmV0dXJuIEtyKHQubGVuZ3RoKX0sV3I9VHlwZUVycm9yLFpyPWZ1bmN0aW9uKHQpe2lmKHQ+OTAwNzE5OTI1NDc0MDk5MSl0aHJvdyBXcigiTWF4aW11bSBhbGxvd2VkIGluZGV4IGV4Y2VlZGVkIik7cmV0dXJuIHR9LEdyPUMsVnI9WWUsJHI9TSxYcj1mdW5jdGlvbih0LGUscil7R3I/VnIuZih0LGUsJHIoMCxyKSk6dFtlXT1yfSxZcj17fTtZcltmZSgidG9TdHJpbmdUYWciKV09InoiO3ZhciBxcj0iW29iamVjdCB6XSI9PT1TdHJpbmcoWXIpLFFyPXFyLHRuPUUsZW49dyxybj1mZSgidG9TdHJpbmdUYWciKSxubj1PYmplY3Qsb249IkFyZ3VtZW50cyI9PT1lbihmdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHN9KCkpLHNuPVFyP2VuOmZ1bmN0aW9uKHQpe3ZhciBlLHIsbjtyZXR1cm4gdm9pZCAwPT09dD8iVW5kZWZpbmVkIjpudWxsPT09dD8iTnVsbCI6InN0cmluZyI9PXR5cGVvZihyPWZ1bmN0aW9uKHQsZSl7dHJ5e3JldHVybiB0W2VdfWNhdGNoKHIpe319KGU9bm4odCkscm4pKT9yOm9uP2VuKGUpOiJPYmplY3QiPT09KG49ZW4oZSkpJiZ0bihlLmNhbGxlZSk/IkFyZ3VtZW50cyI6bn0sYW49RSxjbj1KdCx1bj1tKEZ1bmN0aW9uLnRvU3RyaW5nKTthbihjbi5pbnNwZWN0U291cmNlKXx8KGNuLmluc3BlY3RTb3VyY2U9ZnVuY3Rpb24odCl7cmV0dXJuIHVuKHQpfSk7dmFyIGxuPWNuLmluc3BlY3RTb3VyY2UsaG49bSxmbj1zLGRuPUUscG49c24sX249bG4sZ249ZnVuY3Rpb24oKXt9LG1uPWl0KCJSZWZsZWN0IiwiY29uc3RydWN0IikseW49L15ccyooPzpjbGFzc3xmdW5jdGlvbilcYi8sdm49aG4oeW4uZXhlYyksYm49IXluLnRlc3QoZ24pLHduPWZ1bmN0aW9uKHQpe2lmKCFkbih0KSlyZXR1cm4hMTt0cnl7cmV0dXJuIG1uKGduLFtdLHQpLCEwfWNhdGNoKGUpe3JldHVybiExfX0sU249ZnVuY3Rpb24odCl7aWYoIWRuKHQpKXJldHVybiExO3N3aXRjaChwbih0KSl7Y2FzZSJBc3luY0Z1bmN0aW9uIjpjYXNlIkdlbmVyYXRvckZ1bmN0aW9uIjpjYXNlIkFzeW5jR2VuZXJhdG9yRnVuY3Rpb24iOnJldHVybiExfXRyeXtyZXR1cm4gYm58fCEhdm4oeW4sX24odCkpfWNhdGNoKGUpe3JldHVybiEwfX07U24uc2hhbT0hMDt2YXIga249IW1ufHxmbigoZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gd24od24uY2FsbCl8fCF3bihPYmplY3QpfHwhd24oKGZ1bmN0aW9uKCl7dD0hMH0pKXx8dH0pKT9Tbjp3bixPbj1Ecix4bj1rbixFbj1xLEFuPWZlKCJzcGVjaWVzIiksQ249QXJyYXksSW49ZnVuY3Rpb24odCl7dmFyIGU7cmV0dXJuIE9uKHQpJiYoZT10LmNvbnN0cnVjdG9yLCh4bihlKSYmKGU9PT1Dbnx8T24oZS5wcm90b3R5cGUpKXx8RW4oZSkmJm51bGw9PT0oZT1lW0FuXSkpJiYoZT12b2lkIDApKSx2b2lkIDA9PT1lP0NuOmV9LFRuPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyhJbih0KSkoMD09PWU/MDplKX0sTG49cyxCbj1wdCxObj1mZSgic3BlY2llcyIpLFJuPWZ1bmN0aW9uKHQpe3JldHVybiBCbj49NTF8fCFMbigoZnVuY3Rpb24oKXt2YXIgZT1bXTtyZXR1cm4oZS5jb25zdHJ1Y3Rvcj17fSlbTm5dPWZ1bmN0aW9uKCl7cmV0dXJue2ZvbzoxfX0sMSE9PWVbdF0oQm9vbGVhbikuZm9vfSkpfSx6bj1DcixEbj1zLFBuPURyLE1uPXEsRm49JHQsam49SnIsVW49WnIsSG49WHIsS249VG4sSm49Um4sV249cHQsWm49ZmUoImlzQ29uY2F0U3ByZWFkYWJsZSIpLEduPVduPj01MXx8IURuKChmdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0W1puXT0hMSx0LmNvbmNhdCgpWzBdIT09dH0pKSxWbj1mdW5jdGlvbih0KXtpZighTW4odCkpcmV0dXJuITE7dmFyIGU9dFtabl07cmV0dXJuIHZvaWQgMCE9PWU/ISFlOlBuKHQpfTt6bih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsYXJpdHk6MSxmb3JjZWQ6IUdufHwhSm4oImNvbmNhdCIpfSx7Y29uY2F0OmZ1bmN0aW9uKHQpe3ZhciBlLHIsbixpLG8scz1Gbih0aGlzKSxhPUtuKHMsMCksYz0wO2ZvcihlPS0xLG49YXJndW1lbnRzLmxlbmd0aDtlPG47ZSsrKWlmKFZuKG89LTE9PT1lP3M6YXJndW1lbnRzW2VdKSlmb3IoaT1qbihvKSxVbihjK2kpLHI9MDtyPGk7cisrLGMrKylyIGluIG8mJkhuKGEsYyxvW3JdKTtlbHNlIFVuKGMrMSksSG4oYSxjKyssbyk7cmV0dXJuIGEubGVuZ3RoPWMsYX19KTt2YXIgJG49c24sWG49U3RyaW5nLFluPWZ1bmN0aW9uKHQpe2lmKCJTeW1ib2wiPT09JG4odCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNvbnZlcnQgYSBTeW1ib2wgdmFsdWUgdG8gYSBzdHJpbmciKTtyZXR1cm4gWG4odCl9LHFuPXt9LFFuPWpyLHRpPU1hdGgubWF4LGVpPU1hdGgubWluLHJpPVgsbmk9ZnVuY3Rpb24odCxlKXt2YXIgcj1Rbih0KTtyZXR1cm4gcjwwP3RpKHIrZSwwKTplaShyLGUpfSxpaT1KcixvaT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyLG4pe3ZhciBpPXJpKGUpLG89aWkoaSk7aWYoMD09PW8pcmV0dXJuIXQmJi0xO3ZhciBzLGE9bmkobixvKTtpZih0JiZyIT1yKXtmb3IoO28+YTspaWYoKHM9aVthKytdKSE9cylyZXR1cm4hMH1lbHNlIGZvcig7bz5hO2ErKylpZigodHx8YSBpbiBpKSYmaVthXT09PXIpcmV0dXJuIHR8fGF8fDA7cmV0dXJuIXQmJi0xfX0sc2k9e2luY2x1ZGVzOm9pKCEwKSxpbmRleE9mOm9pKCExKX0sYWk9e30sY2k9cXQsdWk9WCxsaT1zaS5pbmRleE9mLGhpPWFpLGZpPW0oW10ucHVzaCksZGk9ZnVuY3Rpb24odCxlKXt2YXIgcixuPXVpKHQpLGk9MCxvPVtdO2ZvcihyIGluIG4pIWNpKGhpLHIpJiZjaShuLHIpJiZmaShvLHIpO2Zvcig7ZS5sZW5ndGg+aTspY2kobixyPWVbaSsrXSkmJih+bGkobyxyKXx8ZmkobyxyKSk7cmV0dXJuIG99LHBpPVsiY29uc3RydWN0b3IiLCJoYXNPd25Qcm9wZXJ0eSIsImlzUHJvdG90eXBlT2YiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInRvTG9jYWxlU3RyaW5nIiwidG9TdHJpbmciLCJ2YWx1ZU9mIl0sX2k9ZGksZ2k9cGksbWk9T2JqZWN0LmtleXN8fGZ1bmN0aW9uKHQpe3JldHVybiBfaSh0LGdpKX0seWk9Qyx2aT1xZSxiaT1ZZSx3aT1ycixTaT1YLGtpPW1pO3FuLmY9eWkmJiF2aT9PYmplY3QuZGVmaW5lUHJvcGVydGllczpmdW5jdGlvbih0LGUpe3dpKHQpO2Zvcih2YXIgcixuPVNpKGUpLGk9a2koZSksbz1pLmxlbmd0aCxzPTA7bz5zOyliaS5mKHQscj1pW3MrK10sbltyXSk7cmV0dXJuIHR9O3ZhciBPaSx4aT1pdCgiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiKSxFaT1uZSxBaT1adCgia2V5cyIpLENpPWZ1bmN0aW9uKHQpe3JldHVybiBBaVt0XXx8KEFpW3RdPUVpKHQpKX0sSWk9cnIsVGk9cW4sTGk9cGksQmk9YWksTmk9eGksUmk9RWUsemk9InByb3RvdHlwZSIsRGk9InNjcmlwdCIsUGk9Q2koIklFX1BST1RPIiksTWk9ZnVuY3Rpb24oKXt9LEZpPWZ1bmN0aW9uKHQpe3JldHVybiI8IitEaSsiPiIrdCsiPC8iK0RpKyI+In0samk9ZnVuY3Rpb24odCl7dC53cml0ZShGaSgiIikpLHQuY2xvc2UoKTt2YXIgZT10LnBhcmVudFdpbmRvdy5PYmplY3Q7cmV0dXJuIHQ9bnVsbCxlfSxVaT1mdW5jdGlvbigpe3RyeXtPaT1uZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKX1jYXRjaChpKXt9dmFyIHQsZSxyO1VpPSJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQuZG9tYWluJiZPaT9qaShPaSk6KGU9UmkoImlmcmFtZSIpLHI9ImphdmEiK0RpKyI6IixlLnN0eWxlLmRpc3BsYXk9Im5vbmUiLE5pLmFwcGVuZENoaWxkKGUpLGUuc3JjPVN0cmluZyhyKSwodD1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQpLm9wZW4oKSx0LndyaXRlKEZpKCJkb2N1bWVudC5GPU9iamVjdCIpKSx0LmNsb3NlKCksdC5GKTpqaShPaSk7Zm9yKHZhciBuPUxpLmxlbmd0aDtuLS07KWRlbGV0ZSBVaVt6aV1bTGlbbl1dO3JldHVybiBVaSgpfTtCaVtQaV09ITA7dmFyIEhpPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKHQsZSl7dmFyIHI7cmV0dXJuIG51bGwhPT10PyhNaVt6aV09SWkodCkscj1uZXcgTWksTWlbemldPW51bGwscltQaV09dCk6cj1VaSgpLHZvaWQgMD09PWU/cjpUaS5mKHIsZSl9LEtpPXt9LEppPWRpLFdpPXBpLmNvbmNhdCgibGVuZ3RoIiwicHJvdG90eXBlIik7S2kuZj1PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc3x8ZnVuY3Rpb24odCl7cmV0dXJuIEppKHQsV2kpfTt2YXIgWmk9e30sR2k9bShbXS5zbGljZSksVmk9dywkaT1YLFhpPUtpLmYsWWk9R2kscWk9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyYmT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM/T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KTpbXTtaaS5mPWZ1bmN0aW9uKHQpe3JldHVybiBxaSYmIldpbmRvdyI9PT1WaSh0KT9mdW5jdGlvbih0KXt0cnl7cmV0dXJuIFhpKHQpfWNhdGNoKGUpe3JldHVybiBZaShxaSl9fSh0KTpYaSgkaSh0KSl9O3ZhciBRaT17fTtRaS5mPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7dmFyIHRvPWdyLGVvPWZ1bmN0aW9uKHQsZSxyLG4pe3JldHVybiBuJiZuLmVudW1lcmFibGU/dFtlXT1yOnRvKHQsZSxyKSx0fSxybz1ZZSxubz17fSxpbz1mZTtuby5mPWlvO3ZhciBvbyxzbyxhbyxjbz1RLHVvPXF0LGxvPW5vLGhvPVllLmYsZm89ZnVuY3Rpb24odCl7dmFyIGU9Y28uU3ltYm9sfHwoY28uU3ltYm9sPXt9KTt1byhlLHQpfHxobyhlLHQse3ZhbHVlOmxvLmYodCl9KX0scG89TCxfbz1pdCxnbz1mZSxtbz1lbyx5bz1mdW5jdGlvbigpe3ZhciB0PV9vKCJTeW1ib2wiKSxlPXQmJnQucHJvdG90eXBlLHI9ZSYmZS52YWx1ZU9mLG49Z28oInRvUHJpbWl0aXZlIik7ZSYmIWVbbl0mJm1vKGUsbiwoZnVuY3Rpb24odCl7cmV0dXJuIHBvKHIsdGhpcyl9KSx7YXJpdHk6MX0pfSx2bz1zbixibz1xcj97fS50b1N0cmluZzpmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0ICIrdm8odGhpcykrIl0ifSx3bz1xcixTbz1ZZS5mLGtvPWdyLE9vPXF0LHhvPWJvLEVvPWZlKCJ0b1N0cmluZ1RhZyIpLEFvPWZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPXI/dDp0JiZ0LnByb3RvdHlwZTtpJiYoT28oaSxFbyl8fFNvKGksRW8se2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTplfSksbiYmIXdvJiZrbyhpLCJ0b1N0cmluZyIseG8pKX0sQ289RSxJbz1vLldlYWtNYXAsVG89Q28oSW8pJiYvbmF0aXZlIGNvZGUvLnRlc3QoU3RyaW5nKElvKSksTG89byxCbz1xLE5vPWdyLFJvPXF0LHpvPUp0LERvPUNpLFBvPWFpLE1vPSJPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCIsRm89TG8uVHlwZUVycm9yLGpvPUxvLldlYWtNYXA7aWYoVG98fHpvLnN0YXRlKXt2YXIgVW89em8uc3RhdGV8fCh6by5zdGF0ZT1uZXcgam8pO1VvLmdldD1Vby5nZXQsVW8uaGFzPVVvLmhhcyxVby5zZXQ9VW8uc2V0LG9vPWZ1bmN0aW9uKHQsZSl7aWYoVW8uaGFzKHQpKXRocm93IG5ldyBGbyhNbyk7cmV0dXJuIGUuZmFjYWRlPXQsVW8uc2V0KHQsZSksZX0sc289ZnVuY3Rpb24odCl7cmV0dXJuIFVvLmdldCh0KXx8e319LGFvPWZ1bmN0aW9uKHQpe3JldHVybiBVby5oYXModCl9fWVsc2V7dmFyIEhvPURvKCJzdGF0ZSIpO1BvW0hvXT0hMCxvbz1mdW5jdGlvbih0LGUpe2lmKFJvKHQsSG8pKXRocm93IG5ldyBGbyhNbyk7cmV0dXJuIGUuZmFjYWRlPXQsTm8odCxIbyxlKSxlfSxzbz1mdW5jdGlvbih0KXtyZXR1cm4gUm8odCxIbyk/dFtIb106e319LGFvPWZ1bmN0aW9uKHQpe3JldHVybiBSbyh0LEhvKX19dmFyIEtvPXtzZXQ6b28sZ2V0OnNvLGhhczphbyxlbmZvcmNlOmZ1bmN0aW9uKHQpe3JldHVybiBhbyh0KT9zbyh0KTpvbyh0LHt9KX0sZ2V0dGVyRm9yOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcjtpZighQm8oZSl8fChyPXNvKGUpKS50eXBlIT09dCl0aHJvdyBuZXcgRm8oIkluY29tcGF0aWJsZSByZWNlaXZlciwgIit0KyIgcmVxdWlyZWQiKTtyZXR1cm4gcn19fSxKbz1YZSxXbz1LLFpvPSR0LEdvPUpyLFZvPVRuLCRvPW0oW10ucHVzaCksWG89ZnVuY3Rpb24odCl7dmFyIGU9MT09PXQscj0yPT09dCxuPTM9PT10LGk9ND09PXQsbz02PT09dCxzPTc9PT10LGE9NT09PXR8fG87cmV0dXJuIGZ1bmN0aW9uKGMsdSxsLGgpe2Zvcih2YXIgZixkLHA9Wm8oYyksXz1XbyhwKSxnPUdvKF8pLG09Sm8odSxsKSx5PTAsdj1ofHxWbyxiPWU/dihjLGcpOnJ8fHM/dihjLDApOnZvaWQgMDtnPnk7eSsrKWlmKChhfHx5IGluIF8pJiYoZD1tKGY9X1t5XSx5LHApLHQpKWlmKGUpYlt5XT1kO2Vsc2UgaWYoZClzd2l0Y2godCl7Y2FzZSAzOnJldHVybiEwO2Nhc2UgNTpyZXR1cm4gZjtjYXNlIDY6cmV0dXJuIHk7Y2FzZSAyOiRvKGIsZil9ZWxzZSBzd2l0Y2godCl7Y2FzZSA0OnJldHVybiExO2Nhc2UgNzokbyhiLGYpfXJldHVybiBvPy0xOm58fGk/aTpifX0sWW89e2ZvckVhY2g6WG8oMCksbWFwOlhvKDEpLGZpbHRlcjpYbygyKSxzb21lOlhvKDMpLGV2ZXJ5OlhvKDQpLGZpbmQ6WG8oNSksZmluZEluZGV4OlhvKDYpLGZpbHRlclJlamVjdDpYbyg3KX0scW89Q3IsUW89byx0cz1MLGVzPW0scnM9Qyxucz15dCxpcz1zLG9zPXF0LHNzPW90LGFzPXJyLGNzPVgsdXM9U2UsbHM9WW4saHM9TSxmcz1IaSxkcz1taSxwcz1LaSxfcz1aaSxncz1RaSxtcz1BLHlzPVllLHZzPXFuLGJzPUIsd3M9ZW8sU3M9ZnVuY3Rpb24odCxlLHIpe3JldHVybiByby5mKHQsZSxyKX0sa3M9WnQsT3M9YWkseHM9bmUsRXM9ZmUsQXM9bm8sQ3M9Zm8sSXM9eW8sVHM9QW8sTHM9S28sQnM9WW8uZm9yRWFjaCxOcz1DaSgiaGlkZGVuIiksUnM9IlN5bWJvbCIsenM9InByb3RvdHlwZSIsRHM9THMuc2V0LFBzPUxzLmdldHRlckZvcihScyksTXM9T2JqZWN0W3pzXSxGcz1Rby5TeW1ib2wsanM9RnMmJkZzW3pzXSxVcz1Rby5SYW5nZUVycm9yLEhzPVFvLlR5cGVFcnJvcixLcz1Rby5RT2JqZWN0LEpzPW1zLmYsV3M9eXMuZixacz1fcy5mLEdzPWJzLmYsVnM9ZXMoW10ucHVzaCksJHM9a3MoInN5bWJvbHMiKSxYcz1rcygib3Atc3ltYm9scyIpLFlzPWtzKCJ3a3MiKSxxcz0hS3N8fCFLc1t6c118fCFLc1t6c10uZmluZENoaWxkLFFzPWZ1bmN0aW9uKHQsZSxyKXt2YXIgbj1KcyhNcyxlKTtuJiZkZWxldGUgTXNbZV0sV3ModCxlLHIpLG4mJnQhPT1NcyYmV3MoTXMsZSxuKX0sdGE9cnMmJmlzKChmdW5jdGlvbigpe3JldHVybiA3IT09ZnMoV3Moe30sImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gV3ModGhpcywiYSIse3ZhbHVlOjd9KS5hfX0pKS5hfSkpP1FzOldzLGVhPWZ1bmN0aW9uKHQsZSl7dmFyIHI9JHNbdF09ZnMoanMpO3JldHVybiBEcyhyLHt0eXBlOlJzLHRhZzp0LGRlc2NyaXB0aW9uOmV9KSxyc3x8KHIuZGVzY3JpcHRpb249ZSkscn0scmE9ZnVuY3Rpb24odCxlLHIpe3Q9PT1NcyYmcmEoWHMsZSxyKSxhcyh0KTt2YXIgbj11cyhlKTtyZXR1cm4gYXMociksb3MoJHMsbik/KHIuZW51bWVyYWJsZT8ob3ModCxOcykmJnRbTnNdW25dJiYodFtOc11bbl09ITEpLHI9ZnMocix7ZW51bWVyYWJsZTpocygwLCExKX0pKToob3ModCxOcyl8fFdzKHQsTnMsaHMoMSxmcyhudWxsKSkpLHRbTnNdW25dPSEwKSx0YSh0LG4scikpOldzKHQsbixyKX0sbmE9ZnVuY3Rpb24odCxlKXthcyh0KTt2YXIgcj1jcyhlKSxuPWRzKHIpLmNvbmNhdChhYShyKSk7cmV0dXJuIEJzKG4sKGZ1bmN0aW9uKGUpe3JzJiYhdHMoaWEscixlKXx8cmEodCxlLHJbZV0pfSkpLHR9LGlhPWZ1bmN0aW9uKHQpe3ZhciBlPXVzKHQpLHI9dHMoR3MsdGhpcyxlKTtyZXR1cm4hKHRoaXM9PT1NcyYmb3MoJHMsZSkmJiFvcyhYcyxlKSkmJighKHJ8fCFvcyh0aGlzLGUpfHwhb3MoJHMsZSl8fG9zKHRoaXMsTnMpJiZ0aGlzW05zXVtlXSl8fHIpfSxvYT1mdW5jdGlvbih0LGUpe3ZhciByPWNzKHQpLG49dXMoZSk7aWYociE9PU1zfHwhb3MoJHMsbil8fG9zKFhzLG4pKXt2YXIgaT1KcyhyLG4pO3JldHVybiFpfHwhb3MoJHMsbil8fG9zKHIsTnMpJiZyW05zXVtuXXx8KGkuZW51bWVyYWJsZT0hMCksaX19LHNhPWZ1bmN0aW9uKHQpe3ZhciBlPVpzKGNzKHQpKSxyPVtdO3JldHVybiBCcyhlLChmdW5jdGlvbih0KXtvcygkcyx0KXx8b3MoT3MsdCl8fFZzKHIsdCl9KSkscn0sYWE9ZnVuY3Rpb24odCl7dmFyIGU9dD09PU1zLHI9WnMoZT9Yczpjcyh0KSksbj1bXTtyZXR1cm4gQnMociwoZnVuY3Rpb24odCl7IW9zKCRzLHQpfHxlJiYhb3MoTXMsdCl8fFZzKG4sJHNbdF0pfSkpLG59O25zfHwoRnM9ZnVuY3Rpb24oKXtpZihzcyhqcyx0aGlzKSl0aHJvdyBuZXcgSHMoIlN5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvciIpO3ZhciB0PWFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9scyhhcmd1bWVudHNbMF0pOnZvaWQgMCxlPXhzKHQpLHI9ZnVuY3Rpb24odCl7dmFyIG49dm9pZCAwPT09dGhpcz9Rbzp0aGlzO249PT1NcyYmdHMocixYcyx0KSxvcyhuLE5zKSYmb3MobltOc10sZSkmJihuW05zXVtlXT0hMSk7dmFyIGk9aHMoMSx0KTt0cnl7dGEobixlLGkpfWNhdGNoKG8pe2lmKCEobyBpbnN0YW5jZW9mIFVzKSl0aHJvdyBvO1FzKG4sZSxpKX19O3JldHVybiBycyYmcXMmJnRhKE1zLGUse2NvbmZpZ3VyYWJsZTohMCxzZXQ6cn0pLGVhKGUsdCl9LHdzKGpzPUZzW3pzXSwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiBQcyh0aGlzKS50YWd9KSksd3MoRnMsIndpdGhvdXRTZXR0ZXIiLChmdW5jdGlvbih0KXtyZXR1cm4gZWEoeHModCksdCl9KSksYnMuZj1pYSx5cy5mPXJhLHZzLmY9bmEsbXMuZj1vYSxwcy5mPV9zLmY9c2EsZ3MuZj1hYSxBcy5mPWZ1bmN0aW9uKHQpe3JldHVybiBlYShFcyh0KSx0KX0scnMmJlNzKGpzLCJkZXNjcmlwdGlvbiIse2NvbmZpZ3VyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gUHModGhpcykuZGVzY3JpcHRpb259fSkpLHFvKHtnbG9iYWw6ITAsY29uc3RydWN0b3I6ITAsd3JhcDohMCxmb3JjZWQ6IW5zLHNoYW06IW5zfSx7U3ltYm9sOkZzfSksQnMoZHMoWXMpLChmdW5jdGlvbih0KXtDcyh0KX0pKSxxbyh7dGFyZ2V0OlJzLHN0YXQ6ITAsZm9yY2VkOiFuc30se3VzZVNldHRlcjpmdW5jdGlvbigpe3FzPSEwfSx1c2VTaW1wbGU6ZnVuY3Rpb24oKXtxcz0hMX19KSxxbyh7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOiFucyxzaGFtOiFyc30se2NyZWF0ZTpmdW5jdGlvbih0LGUpe3JldHVybiB2b2lkIDA9PT1lP2ZzKHQpOm5hKGZzKHQpLGUpfSxkZWZpbmVQcm9wZXJ0eTpyYSxkZWZpbmVQcm9wZXJ0aWVzOm5hLGdldE93blByb3BlcnR5RGVzY3JpcHRvcjpvYX0pLHFvKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6IW5zfSx7Z2V0T3duUHJvcGVydHlOYW1lczpzYX0pLElzKCksVHMoRnMsUnMpLE9zW05zXT0hMDt2YXIgY2E9eXQmJiEhU3ltYm9sLmZvciYmISFTeW1ib2wua2V5Rm9yLHVhPUNyLGxhPWl0LGhhPXF0LGZhPVluLGRhPVp0LHBhPWNhLF9hPWRhKCJzdHJpbmctdG8tc3ltYm9sLXJlZ2lzdHJ5IiksZ2E9ZGEoInN5bWJvbC10by1zdHJpbmctcmVnaXN0cnkiKTt1YSh7dGFyZ2V0OiJTeW1ib2wiLHN0YXQ6ITAsZm9yY2VkOiFwYX0se2ZvcjpmdW5jdGlvbih0KXt2YXIgZT1mYSh0KTtpZihoYShfYSxlKSlyZXR1cm4gX2FbZV07dmFyIHI9bGEoIlN5bWJvbCIpKGUpO3JldHVybiBfYVtlXT1yLGdhW3JdPWUscn19KTt2YXIgbWE9Q3IseWE9cXQsdmE9T3QsYmE9RXQsd2E9Y2EsU2E9WnQoInN5bWJvbC10by1zdHJpbmctcmVnaXN0cnkiKTttYSh7dGFyZ2V0OiJTeW1ib2wiLHN0YXQ6ITAsZm9yY2VkOiF3YX0se2tleUZvcjpmdW5jdGlvbih0KXtpZighdmEodCkpdGhyb3cgbmV3IFR5cGVFcnJvcihiYSh0KSsiIGlzIG5vdCBhIHN5bWJvbCIpO2lmKHlhKFNhLHQpKXJldHVybiBTYVt0XX19KTt2YXIga2E9RHIsT2E9RSx4YT13LEVhPVluLEFhPW0oW10ucHVzaCksQ2E9Q3IsSWE9aXQsVGE9ZixMYT1MLEJhPW0sTmE9cyxSYT1FLHphPU90LERhPUdpLFBhPWZ1bmN0aW9uKHQpe2lmKE9hKHQpKXJldHVybiB0O2lmKGthKHQpKXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rKyl7dmFyIGk9dFtuXTsic3RyaW5nIj09dHlwZW9mIGk/QWEocixpKToibnVtYmVyIiE9dHlwZW9mIGkmJiJOdW1iZXIiIT09eGEoaSkmJiJTdHJpbmciIT09eGEoaSl8fEFhKHIsRWEoaSkpfXZhciBvPXIubGVuZ3RoLHM9ITA7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7aWYocylyZXR1cm4gcz0hMSxlO2lmKGthKHRoaXMpKXJldHVybiBlO2Zvcih2YXIgbj0wO248bztuKyspaWYocltuXT09PXQpcmV0dXJuIGV9fX0sTWE9eXQsRmE9U3RyaW5nLGphPUlhKCJKU09OIiwic3RyaW5naWZ5IiksVWE9QmEoLy4vLmV4ZWMpLEhhPUJhKCIiLmNoYXJBdCksS2E9QmEoIiIuY2hhckNvZGVBdCksSmE9QmEoIiIucmVwbGFjZSksV2E9QmEoMS4udG9TdHJpbmcpLFphPS9bXHVEODAwLVx1REZGRl0vZyxHYT0vXltcdUQ4MDAtXHVEQkZGXSQvLFZhPS9eW1x1REMwMC1cdURGRkZdJC8sJGE9IU1hfHxOYSgoZnVuY3Rpb24oKXt2YXIgdD1JYSgiU3ltYm9sIikoInN0cmluZ2lmeSBkZXRlY3Rpb24iKTtyZXR1cm4iW251bGxdIiE9PWphKFt0XSl8fCJ7fSIhPT1qYSh7YTp0fSl8fCJ7fSIhPT1qYShPYmplY3QodCkpfSkpLFhhPU5hKChmdW5jdGlvbigpe3JldHVybiciXFx1ZGYwNlxcdWQ4MzQiJyE9PWphKCJcdWRmMDZcdWQ4MzQiKXx8JyJcXHVkZWFkIichPT1qYSgiXHVkZWFkIil9KSksWWE9ZnVuY3Rpb24odCxlKXt2YXIgcj1EYShhcmd1bWVudHMpLG49UGEoZSk7aWYoUmEobil8fHZvaWQgMCE9PXQmJiF6YSh0KSlyZXR1cm4gclsxXT1mdW5jdGlvbih0LGUpe2lmKFJhKG4pJiYoZT1MYShuLHRoaXMsRmEodCksZSkpLCF6YShlKSlyZXR1cm4gZX0sVGEoamEsbnVsbCxyKX0scWE9ZnVuY3Rpb24odCxlLHIpe3ZhciBuPUhhKHIsZS0xKSxpPUhhKHIsZSsxKTtyZXR1cm4gVWEoR2EsdCkmJiFVYShWYSxpKXx8VWEoVmEsdCkmJiFVYShHYSxuKT8iXFx1IitXYShLYSh0LDApLDE2KTp0fTtqYSYmQ2Eoe3RhcmdldDoiSlNPTiIsc3RhdDohMCxhcml0eTozLGZvcmNlZDokYXx8WGF9LHtzdHJpbmdpZnk6ZnVuY3Rpb24odCxlLHIpe3ZhciBuPURhKGFyZ3VtZW50cyksaT1UYSgkYT9ZYTpqYSxudWxsLG4pO3JldHVybiBYYSYmInN0cmluZyI9PXR5cGVvZiBpP0phKGksWmEscWEpOml9fSk7dmFyIFFhPVFpLHRjPSR0O0NyKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6IXl0fHxzKChmdW5jdGlvbigpe1FhLmYoMSl9KSl9LHtnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6ZnVuY3Rpb24odCl7dmFyIGU9UWEuZjtyZXR1cm4gZT9lKHRjKHQpKTpbXX19KSxmbygiYXN5bmNJdGVyYXRvciIpLGZvKCJoYXNJbnN0YW5jZSIpLGZvKCJpc0NvbmNhdFNwcmVhZGFibGUiKSxmbygiaXRlcmF0b3IiKSxmbygibWF0Y2giKSxmbygibWF0Y2hBbGwiKSxmbygicmVwbGFjZSIpLGZvKCJzZWFyY2giKSxmbygic3BlY2llcyIpLGZvKCJzcGxpdCIpO3ZhciBlYz15bztmbygidG9QcmltaXRpdmUiKSxlYygpO3ZhciByYz1pdCxuYz1BbztmbygidG9TdHJpbmdUYWciKSxuYyhyYygiU3ltYm9sIiksIlN5bWJvbCIpLGZvKCJ1bnNjb3BhYmxlcyIpLEFvKG8uSlNPTiwiSlNPTiIsITApO3ZhciBpYyxvYyxzYyxhYz1RLlN5bWJvbCxjYz17fSx1Yz1DLGxjPXF0LGhjPUZ1bmN0aW9uLnByb3RvdHlwZSxmYz11YyYmT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixkYz1sYyhoYywibmFtZSIpLHBjPXtFWElTVFM6ZGMsUFJPUEVSOmRjJiYic29tZXRoaW5nIj09PWZ1bmN0aW9uKCl7fS5uYW1lLENPTkZJR1VSQUJMRTpkYyYmKCF1Y3x8dWMmJmZjKGhjLCJuYW1lIikuY29uZmlndXJhYmxlKX0sX2M9IXMoKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gdC5wcm90b3R5cGUuY29uc3RydWN0b3I9bnVsbCxPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IHQpIT09dC5wcm90b3R5cGV9KSksZ2M9cXQsbWM9RSx5Yz0kdCx2Yz1fYyxiYz1DaSgiSUVfUFJPVE8iKSx3Yz1PYmplY3QsU2M9d2MucHJvdG90eXBlLGtjPXZjP3djLmdldFByb3RvdHlwZU9mOmZ1bmN0aW9uKHQpe3ZhciBlPXljKHQpO2lmKGdjKGUsYmMpKXJldHVybiBlW2JjXTt2YXIgcj1lLmNvbnN0cnVjdG9yO3JldHVybiBtYyhyKSYmZSBpbnN0YW5jZW9mIHI/ci5wcm90b3R5cGU6ZSBpbnN0YW5jZW9mIHdjP1NjOm51bGx9LE9jPXMseGM9RSxFYz1xLEFjPUhpLENjPWtjLEljPWVvLFRjPWZlKCJpdGVyYXRvciIpLExjPSExO1tdLmtleXMmJigibmV4dCJpbihzYz1bXS5rZXlzKCkpPyhvYz1DYyhDYyhzYykpKSE9PU9iamVjdC5wcm90b3R5cGUmJihpYz1vYyk6TGM9ITApO3ZhciBCYz0hRWMoaWMpfHxPYygoZnVuY3Rpb24oKXt2YXIgdD17fTtyZXR1cm4gaWNbVGNdLmNhbGwodCkhPT10fSkpO3hjKChpYz1CYz97fTpBYyhpYykpW1RjXSl8fEljKGljLFRjLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBOYz17SXRlcmF0b3JQcm90b3R5cGU6aWMsQlVHR1lfU0FGQVJJX0lURVJBVE9SUzpMY30sUmM9TmMuSXRlcmF0b3JQcm90b3R5cGUsemM9SGksRGM9TSxQYz1BbyxNYz1jYyxGYz1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxqYz1DcixVYz1MLEhjPXBjLEtjPWZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPWUrIiBJdGVyYXRvciI7cmV0dXJuIHQucHJvdG90eXBlPXpjKFJjLHtuZXh0OkRjKCshbixyKX0pLFBjKHQsaSwhMSwhMCksTWNbaV09RmMsdH0sSmM9a2MsV2M9QW8sWmM9ZW8sR2M9Y2MsVmM9TmMsJGM9SGMuUFJPUEVSLFhjPVZjLkJVR0dZX1NBRkFSSV9JVEVSQVRPUlMsWWM9ZmUoIml0ZXJhdG9yIikscWM9ImtleXMiLFFjPSJ2YWx1ZXMiLHR1PSJlbnRyaWVzIixldT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxydT1mdW5jdGlvbih0LGUscixuLGksbyxzKXtLYyhyLGUsbik7dmFyIGEsYyx1LGw9ZnVuY3Rpb24odCl7aWYodD09PWkmJl8pcmV0dXJuIF87aWYoIVhjJiZ0JiZ0IGluIGQpcmV0dXJuIGRbdF07c3dpdGNoKHQpe2Nhc2UgcWM6Y2FzZSBRYzpjYXNlIHR1OnJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgcih0aGlzLHQpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHIodGhpcyl9fSxoPWUrIiBJdGVyYXRvciIsZj0hMSxkPXQucHJvdG90eXBlLHA9ZFtZY118fGRbIkBAaXRlcmF0b3IiXXx8aSYmZFtpXSxfPSFYYyYmcHx8bChpKSxnPSJBcnJheSI9PT1lJiZkLmVudHJpZXN8fHA7aWYoZyYmKGE9SmMoZy5jYWxsKG5ldyB0KSkpIT09T2JqZWN0LnByb3RvdHlwZSYmYS5uZXh0JiYoV2MoYSxoLCEwLCEwKSxHY1toXT1ldSksJGMmJmk9PT1RYyYmcCYmcC5uYW1lIT09UWMmJihmPSEwLF89ZnVuY3Rpb24oKXtyZXR1cm4gVWMocCx0aGlzKX0pLGkpaWYoYz17dmFsdWVzOmwoUWMpLGtleXM6bz9fOmwocWMpLGVudHJpZXM6bCh0dSl9LHMpZm9yKHUgaW4gYykoWGN8fGZ8fCEodSBpbiBkKSkmJlpjKGQsdSxjW3VdKTtlbHNlIGpjKHt0YXJnZXQ6ZSxwcm90bzohMCxmb3JjZWQ6WGN8fGZ9LGMpO3JldHVybiBzJiZkW1ljXSE9PV8mJlpjKGQsWWMsXyx7bmFtZTppfSksR2NbZV09XyxjfSxudT1mdW5jdGlvbih0LGUpe3JldHVybnt2YWx1ZTp0LGRvbmU6ZX19LGl1PVgsb3U9Y2Msc3U9S287WWUuZjt2YXIgYXU9cnUsY3U9bnUsdXU9IkFycmF5IEl0ZXJhdG9yIixsdT1zdS5zZXQsaHU9c3UuZ2V0dGVyRm9yKHV1KTthdShBcnJheSwiQXJyYXkiLChmdW5jdGlvbih0LGUpe2x1KHRoaXMse3R5cGU6dXUsdGFyZ2V0Oml1KHQpLGluZGV4OjAsa2luZDplfSl9KSwoZnVuY3Rpb24oKXt2YXIgdD1odSh0aGlzKSxlPXQudGFyZ2V0LHI9dC5pbmRleCsrO2lmKCFlfHxyPj1lLmxlbmd0aClyZXR1cm4gdC50YXJnZXQ9bnVsbCxjdSh2b2lkIDAsITApO3N3aXRjaCh0LmtpbmQpe2Nhc2Uia2V5cyI6cmV0dXJuIGN1KHIsITEpO2Nhc2UidmFsdWVzIjpyZXR1cm4gY3UoZVtyXSwhMSl9cmV0dXJuIGN1KFtyLGVbcl1dLCExKX0pLCJ2YWx1ZXMiKSxvdS5Bcmd1bWVudHM9b3UuQXJyYXk7dmFyIGZ1PXtDU1NSdWxlTGlzdDowLENTU1N0eWxlRGVjbGFyYXRpb246MCxDU1NWYWx1ZUxpc3Q6MCxDbGllbnRSZWN0TGlzdDowLERPTVJlY3RMaXN0OjAsRE9NU3RyaW5nTGlzdDowLERPTVRva2VuTGlzdDoxLERhdGFUcmFuc2Zlckl0ZW1MaXN0OjAsRmlsZUxpc3Q6MCxIVE1MQWxsQ29sbGVjdGlvbjowLEhUTUxDb2xsZWN0aW9uOjAsSFRNTEZvcm1FbGVtZW50OjAsSFRNTFNlbGVjdEVsZW1lbnQ6MCxNZWRpYUxpc3Q6MCxNaW1lVHlwZUFycmF5OjAsTmFtZWROb2RlTWFwOjAsTm9kZUxpc3Q6MSxQYWludFJlcXVlc3RMaXN0OjAsUGx1Z2luOjAsUGx1Z2luQXJyYXk6MCxTVkdMZW5ndGhMaXN0OjAsU1ZHTnVtYmVyTGlzdDowLFNWR1BhdGhTZWdMaXN0OjAsU1ZHUG9pbnRMaXN0OjAsU1ZHU3RyaW5nTGlzdDowLFNWR1RyYW5zZm9ybUxpc3Q6MCxTb3VyY2VCdWZmZXJMaXN0OjAsU3R5bGVTaGVldExpc3Q6MCxUZXh0VHJhY2tDdWVMaXN0OjAsVGV4dFRyYWNrTGlzdDowLFRvdWNoTGlzdDowfSxkdT1vLHB1PUFvLF91PWNjO2Zvcih2YXIgZ3UgaW4gZnUpcHUoZHVbZ3VdLGd1KSxfdVtndV09X3UuQXJyYXk7dmFyIG11PWFjLHl1PWZlLHZ1PVllLmYsYnU9eXUoIm1ldGFkYXRhIiksd3U9RnVuY3Rpb24ucHJvdG90eXBlO3ZvaWQgMD09PXd1W2J1XSYmdnUod3UsYnUse3ZhbHVlOm51bGx9KSxmbygiYXN5bmNEaXNwb3NlIiksZm8oImRpc3Bvc2UiKSxmbygibWV0YWRhdGEiKTt2YXIgU3U9bXUsa3U9bSxPdT1pdCgiU3ltYm9sIikseHU9T3Uua2V5Rm9yLEV1PWt1KE91LnByb3RvdHlwZS52YWx1ZU9mKSxBdT1PdS5pc1JlZ2lzdGVyZWRTeW1ib2x8fGZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gdm9pZCAwIT09eHUoRXUodCkpfWNhdGNoKGUpe3JldHVybiExfX07Q3Ioe3RhcmdldDoiU3ltYm9sIixzdGF0OiEwfSx7aXNSZWdpc3RlcmVkU3ltYm9sOkF1fSk7Zm9yKHZhciBDdT1adCxJdT1pdCxUdT1tLEx1PU90LEJ1PWZlLE51PUl1KCJTeW1ib2wiKSxSdT1OdS5pc1dlbGxLbm93blN5bWJvbCx6dT1JdSgiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlOYW1lcyIpLER1PVR1KE51LnByb3RvdHlwZS52YWx1ZU9mKSxQdT1DdSgid2tzIiksTXU9MCxGdT16dShOdSksanU9RnUubGVuZ3RoO011PGp1O011KyspdHJ5e3ZhciBVdT1GdVtNdV07THUoTnVbVXVdKSYmQnUoVXUpfWNhdGNoKCRnKXt9dmFyIEh1PWZ1bmN0aW9uKHQpe2lmKFJ1JiZSdSh0KSlyZXR1cm4hMDt0cnl7Zm9yKHZhciBlPUR1KHQpLHI9MCxuPXp1KFB1KSxpPW4ubGVuZ3RoO3I8aTtyKyspaWYoUHVbbltyXV09PWUpcmV0dXJuITB9Y2F0Y2goJGcpe31yZXR1cm4hMX07Q3Ioe3RhcmdldDoiU3ltYm9sIixzdGF0OiEwLGZvcmNlZDohMH0se2lzV2VsbEtub3duU3ltYm9sOkh1fSksZm8oImN1c3RvbU1hdGNoZXIiKSxmbygib2JzZXJ2YWJsZSIpLENyKHt0YXJnZXQ6IlN5bWJvbCIsc3RhdDohMCxuYW1lOiJpc1JlZ2lzdGVyZWRTeW1ib2wifSx7aXNSZWdpc3RlcmVkOkF1fSksQ3Ioe3RhcmdldDoiU3ltYm9sIixzdGF0OiEwLG5hbWU6ImlzV2VsbEtub3duU3ltYm9sIixmb3JjZWQ6ITB9LHtpc1dlbGxLbm93bjpIdX0pLGZvKCJtYXRjaGVyIiksZm8oIm1ldGFkYXRhS2V5IiksZm8oInBhdHRlcm5NYXRjaCIpLGZvKCJyZXBsYWNlQWxsIik7dmFyIEt1PWUoU3UpLEp1PW0sV3U9anIsWnU9WW4sR3U9RyxWdT1KdSgiIi5jaGFyQXQpLCR1PUp1KCIiLmNoYXJDb2RlQXQpLFh1PUp1KCIiLnNsaWNlKSxZdT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXt2YXIgbixpLG89WnUoR3UoZSkpLHM9V3UociksYT1vLmxlbmd0aDtyZXR1cm4gczwwfHxzPj1hP3Q/IiI6dm9pZCAwOihuPSR1KG8scykpPDU1Mjk2fHxuPjU2MzE5fHxzKzE9PT1hfHwoaT0kdShvLHMrMSkpPDU2MzIwfHxpPjU3MzQzP3Q/VnUobyxzKTpuOnQ/WHUobyxzLHMrMik6aS01NjMyMCsobi01NTI5Njw8MTApKzY1NTM2fX0scXU9e2NvZGVBdDpZdSghMSksY2hhckF0Oll1KCEwKX0uY2hhckF0LFF1PVluLHRsPUtvLGVsPXJ1LHJsPW51LG5sPSJTdHJpbmcgSXRlcmF0b3IiLGlsPXRsLnNldCxvbD10bC5nZXR0ZXJGb3IobmwpO2VsKFN0cmluZywiU3RyaW5nIiwoZnVuY3Rpb24odCl7aWwodGhpcyx7dHlwZTpubCxzdHJpbmc6UXUodCksaW5kZXg6MH0pfSksKGZ1bmN0aW9uKCl7dmFyIHQsZT1vbCh0aGlzKSxyPWUuc3RyaW5nLG49ZS5pbmRleDtyZXR1cm4gbj49ci5sZW5ndGg/cmwodm9pZCAwLCEwKToodD1xdShyLG4pLGUuaW5kZXgrPXQubGVuZ3RoLHJsKHQsITEpKX0pKTt2YXIgc2w9ZShuby5mKCJpdGVyYXRvciIpKTtmdW5jdGlvbiBhbCh0KXtyZXR1cm4oYWw9ImZ1bmN0aW9uIj09dHlwZW9mIEt1JiYic3ltYm9sIj09dHlwZW9mIHNsP2Z1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdH06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBLdSYmdC5jb25zdHJ1Y3Rvcj09PUt1JiZ0IT09S3UucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiB0fSkodCl9dmFyIGNsPWUobm8uZigidG9QcmltaXRpdmUiKSk7ZnVuY3Rpb24gdWwodCl7dmFyIGU9ZnVuY3Rpb24odCxlKXtpZigib2JqZWN0IiE9YWwodCl8fCF0KXJldHVybiB0O3ZhciByPXRbY2xdO2lmKHZvaWQgMCE9PXIpe3ZhciBuPXIuY2FsbCh0LGV8fCJkZWZhdWx0Iik7aWYoIm9iamVjdCIhPWFsKG4pKXJldHVybiBuO3Rocm93IG5ldyBUeXBlRXJyb3IoIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuIil9cmV0dXJuKCJzdHJpbmciPT09ZT9TdHJpbmc6TnVtYmVyKSh0KX0odCwic3RyaW5nIik7cmV0dXJuInN5bWJvbCI9PWFsKGUpP2U6ZSsiIn1mdW5jdGlvbiBsbCh0LGUscil7cmV0dXJuKGU9dWwoZSkpaW4gdD9Scih0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTp0W2VdPXIsdH12YXIgaGwsZmw9KHQ9Pih0LkgyNjQ9IkgyNjQiLHQuVlA4PSJWUDgiLHQuSDI2NT0iSDI2NSIsdCkpKGZsfHx7fSksZGw9byxwbD1RLF9sPWZ1bmN0aW9uKHQsZSl7dmFyIHI9cGxbdCsiUHJvdG90eXBlIl0sbj1yJiZyW2VdO2lmKG4pcmV0dXJuIG47dmFyIGk9ZGxbdF0sbz1pJiZpLnByb3RvdHlwZTtyZXR1cm4gbyYmb1tlXX0sZ2w9cSxtbD13LHlsPWZlKCJtYXRjaCIpLHZsPXJyLGJsPUwsd2w9cXQsU2w9b3Qsa2w9ZnVuY3Rpb24oKXt2YXIgdD12bCh0aGlzKSxlPSIiO3JldHVybiB0Lmhhc0luZGljZXMmJihlKz0iZCIpLHQuZ2xvYmFsJiYoZSs9ImciKSx0Lmlnbm9yZUNhc2UmJihlKz0iaSIpLHQubXVsdGlsaW5lJiYoZSs9Im0iKSx0LmRvdEFsbCYmKGUrPSJzIiksdC51bmljb2RlJiYoZSs9InUiKSx0LnVuaWNvZGVTZXRzJiYoZSs9InYiKSx0LnN0aWNreSYmKGUrPSJ5IiksZX0sT2w9UmVnRXhwLnByb3RvdHlwZSx4bD1uZXcgVWludDhBcnJheSgxNik7ZnVuY3Rpb24gRWwoKXtpZighaGwmJiEoaGw9InVuZGVmaW5lZCIhPXR5cGVvZiBjcnlwdG8mJmNyeXB0by5nZXRSYW5kb21WYWx1ZXMmJmNyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChjcnlwdG8pfHwidW5kZWZpbmVkIiE9dHlwZW9mIG1zQ3J5cHRvJiYiZnVuY3Rpb24iPT10eXBlb2YgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzJiZtc0NyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChtc0NyeXB0bykpKXRocm93IG5ldyBFcnJvcigiY3J5cHRvLmdldFJhbmRvbVZhbHVlcygpIG5vdCBzdXBwb3J0ZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQjZ2V0cmFuZG9tdmFsdWVzLW5vdC1zdXBwb3J0ZWQiKTtyZXR1cm4gaGwoeGwpfXZhciBBbD0vXig/OlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9fDAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCkkL2k7Zm9yKHZhciBDbD1bXSxJbD0wO0lsPDI1NjsrK0lsKUNsLnB1c2goKElsKzI1NikudG9TdHJpbmcoMTYpLnN1YnN0cigxKSk7ZnVuY3Rpb24gVGwodCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjAscj0oQ2xbdFtlKzBdXStDbFt0W2UrMV1dK0NsW3RbZSsyXV0rQ2xbdFtlKzNdXSsiLSIrQ2xbdFtlKzRdXStDbFt0W2UrNV1dKyItIitDbFt0W2UrNl1dK0NsW3RbZSs3XV0rIi0iK0NsW3RbZSs4XV0rQ2xbdFtlKzldXSsiLSIrQ2xbdFtlKzEwXV0rQ2xbdFtlKzExXV0rQ2xbdFtlKzEyXV0rQ2xbdFtlKzEzXV0rQ2xbdFtlKzE0XV0rQ2xbdFtlKzE1XV0pLnRvTG93ZXJDYXNlKCk7aWYoIWZ1bmN0aW9uKHQpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdCYmQWwudGVzdCh0KX0ocikpdGhyb3cgVHlwZUVycm9yKCJTdHJpbmdpZmllZCBVVUlEIGlzIGludmFsaWQiKTtyZXR1cm4gcn1mdW5jdGlvbiBMbCh0LGUscil7dmFyIG49KHQ9dHx8e30pLnJhbmRvbXx8KHQucm5nfHxFbCkoKTtpZihuWzZdPTE1Jm5bNl18NjQsbls4XT02MyZuWzhdfDEyOCxlKXtyPXJ8fDA7Zm9yKHZhciBpPTA7aTwxNjsrK2kpZVtyK2ldPW5baV07cmV0dXJuIGV9cmV0dXJuIFRsKG4pfWNvbnN0IEJsPSgpPT4idW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdztmdW5jdGlvbiBObCh0KXtyZXR1cm4gbnVsbD09dD8idW5kZWZpbmVkIHwgbnVsbCI6InN0cmluZyI9PXR5cGVvZiB0P3Q6SlNPTi5zdHJpbmdpZnkoe2NvbnRlbnRIaW50OnQuY29udGVudEhpbnQsZW5hYmxlZDp0LmVuYWJsZWQsaWQ6dC5pZCxraW5kOnQua2luZCxsYWJlbDp0LmxhYmVsLG11dGVkOnQubXV0ZWQscmVhZHlTdGF0ZTp0LnJlYWR5U3RhdGV9KX1mdW5jdGlvbiBSbCh0KXtyZXR1cm4gbnVsbD09dD8idW5kZWZpbmVkIHwgbnVsbCI6InN0cmluZyI9PXR5cGVvZiB0P3Q6SlNPTi5zdHJpbmdpZnkoe3RyYWNrOk5sKHQudHJhY2spfSl9ZnVuY3Rpb24gemwodCl7cmV0dXJuIG51bGw9PXQ/InVuZGVmaW5lZCB8IG51bGwiOiJzdHJpbmciPT10eXBlb2YgdD90OkpTT04uc3RyaW5naWZ5KHt0cmFjazpObCh0LnRyYWNrKX0pfWNvbnN0IERsPSJAYnl0ZWQvdmUtcnRjIixQbD0iQGJ5dGVkL3ZlLXJ0Yy1jYWNoZS1zaXplIjt2YXIgTWw9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7bGwodGhpcywic3RvcmVLZXkiLHZvaWQgMCksbGwodGhpcywibG9nTGV2ZWwiLHZvaWQgMCksbGwodGhpcywiTG9nZmlsZVNpemUiLHZvaWQgMCksbGwodGhpcywiZGIiLHZvaWQgMCksbGwodGhpcywibG9nSWQiLHZvaWQgMCksbGwodGhpcywiY2FjaGVMb2ciLHZvaWQgMCksbGwodGhpcywiY2FjaGVkU2l6ZSIsdm9pZCAwKSxsbCh0aGlzLCJwcmVDYWNoZVRpbWUiLHZvaWQgMCksbGwodGhpcywidGltZXIiLHZvaWQgMCksbGwodGhpcywiX2dldFNpemUiLCh0PT5uZXcgQmxvYih0KS5zaXplLzEwNDg1NzYpKSx0aGlzLnN0b3JlS2V5PSIiLHRoaXMubG9nSWQ9MSx0aGlzLmNhY2hlTG9nPSIiLHRoaXMubG9nTGV2ZWw9Im5vbmUiLHRoaXMuTG9nZmlsZVNpemU9MTAwLHRoaXMuX2NyZWF0ZVN0b3JlKCl9X2NyZWF0ZVN0b3JlKCl7aWYoQmwoKXx8IXdpbmRvdy5pbmRleGVkREIpcmV0dXJuO2NvbnN0IHQ9aW5kZXhlZERCLm9wZW4oIkBieXRlZC92ZS1ydGMiKTt0Lm9udXBncmFkZW5lZWRlZD0oKT0+e3QucmVzdWx0LmNyZWF0ZU9iamVjdFN0b3JlKERsKTt0cnl7bG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oUGwpfWNhdGNoKCRnKXt9fSx0Lm9uZXJyb3I9dD0+e30sdC5vbnN1Y2Nlc3M9KCk9Pnt0aGlzLmRiPXQucmVzdWx0LHRoaXMuX2dldENhY2hlZFNpemUoKX19X2dldENhY2hlZFNpemUoKXt0cnl7Y29uc3QgdD1sb2NhbFN0b3JhZ2UuZ2V0SXRlbShQbCk7dD90aGlzLmNhY2hlZFNpemU9TnVtYmVyKHQpOnRoaXMudmFsdWVzKCkudGhlbigodD0+e3RoaXMuY2FjaGVkU2l6ZT10aGlzLl9nZXRTaXplKHQpLHRoaXMuX3NldENhY2hlZFNpemUoKX0pKX1jYXRjaCgkZyl7fX1fc2V0Q2FjaGVkU2l6ZSgpe3RyeXtsb2NhbFN0b3JhZ2Uuc2V0SXRlbShQbCwiIi5jb25jYXQodGhpcy5jYWNoZWRTaXplKSl9Y2F0Y2goJGcpe319X2dldFN0b3JlKHQpe2lmKHRoaXMuZGIpcmV0dXJuIHRoaXMuZGIudHJhbnNhY3Rpb24oRGwsdCkub2JqZWN0U3RvcmUoRGwpfXNldCh0KXtyZXR1cm4gbmV3IFByb21pc2UoKChlLHIpPT57aWYoIm5vbmUiPT09dGhpcy5sb2dMZXZlbClyZXR1cm4gZSgpO2lmKHQmJnRoaXMucHJlQ2FjaGVUaW1lJiZ0aGlzLnByZUNhY2hlVGltZS1EYXRlLm5vdygpPDFlMylyZXR1cm4gdGhpcy5jYWNoZUxvZys9IlxuXG4iLmNvbmNhdCh0aGlzLmxvZ0lkLCI6ICIpLmNvbmNhdCh0KSx0aGlzLmxvZ0lkKyssdGhpcy50aW1lcnx8KHRoaXMudGltZXI9c2V0VGltZW91dCgoKCk9Pnt0aGlzLnNldCgiIil9KSwxZTMtKHRoaXMucHJlQ2FjaGVUaW1lLURhdGUubm93KCkpKSksZSgpO2NsZWFyVGltZW91dCh0aGlzLnRpbWVyKSx0aGlzLnRpbWVyPW51bGw7Y29uc3Qgbj10aGlzLl9nZXRTdG9yZSgicmVhZHdyaXRlIik7aWYoIW4pcmV0dXJuIHIoImdldCBzdG9yZSBmYWlsIik7dGhpcy5jYWNoZWRTaXplJiZ0aGlzLmNhY2hlZFNpemU+dGhpcy5Mb2dmaWxlU2l6ZSYmdGhpcy5rZXlFYXJsaWVzdCgpLnRoZW4oKHQ9Pnt0aGlzLmdldCh0KS50aGVuKChlPT57dGhpcy5kZWwodCkudGhlbigoKCk9Pnt0aGlzLmNhY2hlZFNpemU9dGhpcy5jYWNoZWRTaXplLXRoaXMuX2dldFNpemUoWyIiLmNvbmNhdChlKV0pLHRoaXMuX3NldENhY2hlZFNpemUoKX0pKX0pKX0pKTtjb25zdCBpPW4uZ2V0KHRoaXMuc3RvcmVLZXkpO2kub25zdWNjZXNzPSgpPT57dHJ5e2NvbnN0IHI9IiIuY29uY2F0KGkucmVzdWx0fHwiIikuY29uY2F0KHRoaXMuY2FjaGVMb2cpLG89dD8iIi5jb25jYXQocj8iXG5cbiI6IiIpLmNvbmNhdCh0aGlzLmxvZ0lkLCI6ICIpLmNvbmNhdCh0KToiIjtuLnB1dCgiIi5jb25jYXQocikuY29uY2F0KG8pLHRoaXMuc3RvcmVLZXkpLHQmJnRoaXMubG9nSWQrKyx0aGlzLmNhY2hlTG9nPSIiLHRoaXMuY2FjaGVkU2l6ZT0odGhpcy5jYWNoZWRTaXplfHwwKSt0aGlzLl9nZXRTaXplKFsiIi5jb25jYXQodGhpcy5jYWNoZUxvZykuY29uY2F0KG8pXSksdGhpcy5fc2V0Q2FjaGVkU2l6ZSgpLHRoaXMucHJlQ2FjaGVUaW1lPURhdGUubm93KCksZSgpfWNhdGNoKG8pe2lmKCF0KXJldHVybiByKG8pO3RoaXMuY2FjaGVMb2crPSJcblxuIi5jb25jYXQodGhpcy5sb2dJZCwiOiAiKS5jb25jYXQodCksdGhpcy5sb2dJZCsrLHIobyl9fSxpLm9uZXJyb3I9ZT0+e2lmKCF0KXJldHVybiByKGUpO3RoaXMuY2FjaGVMb2crPSJcblxuIi5jb25jYXQodGhpcy5sb2dJZCwiOiAiKS5jb25jYXQodCksdGhpcy5sb2dJZCsrLHIoZSl9fSkpfWdldCh0KXtyZXR1cm4gbmV3IFByb21pc2UoKChlLHIpPT57Y29uc3Qgbj10aGlzLl9nZXRTdG9yZSgicmVhZG9ubHkiKTtpZighbilyZXR1cm4gcigpO2NvbnN0IGk9bi5nZXQodCk7aS5vbnN1Y2Nlc3M9KCk9PntlKGkucmVzdWx0KX0saS5vbmVycm9yPXQ9PntyKHQpfX0pKX1kZWwoKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06dGhpcy5zdG9yZUtleTtyZXR1cm4gbmV3IFByb21pc2UoKChlLHIpPT57Y29uc3Qgbj10aGlzLl9nZXRTdG9yZSgicmVhZHdyaXRlIik7aWYoIW4pcmV0dXJuIHIoKTtjb25zdCBpPW4uZGVsZXRlKHQpO2kub25zdWNjZXNzPSgpPT5lKGkucmVzdWx0KSxpLm9uZXJyb3I9dD0+cih0KX0pKX1rZXlFYXJsaWVzdCgpe3JldHVybiB0aGlzLmtleXMoKS50aGVuKCh0PT57bGV0IGUscj1EYXRlLm5vdygpO3JldHVybiB0LmZvckVhY2goKHQ9PntpZighdHx8IXQubGVuZ3RoKXJldHVybjtjb25zdCBuPXQuc3BsaXQoIi0iKVswXTtOdW1iZXIobik8ciYmKHI9TnVtYmVyKG4pLGU9dCl9KSksZX0pKX1rZXlzKCl7cmV0dXJuIG5ldyBQcm9taXNlKCgodCxlKT0+e2NvbnN0IHI9dGhpcy5fZ2V0U3RvcmUoInJlYWRvbmx5Iik7aWYoIXIpcmV0dXJuIGUoKTtpZihyLmdldEFsbEtleXMpe2NvbnN0IG49ci5nZXRBbGxLZXlzKCk7cmV0dXJuIG4ub25zdWNjZXNzPSgpPT57dChuLnJlc3VsdCl9LHZvaWQobi5vbmVycm9yPSgpPT57ZSgpfSl9Y29uc3Qgbj1bXTtyLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt0aGlzLnJlc3VsdCYmKG4ucHVzaCh0aGlzLnJlc3VsdC5rZXkpLHRoaXMucmVzdWx0LmNvbnRpbnVlKCkpfSxyLnRyYW5zYWN0aW9uLm9uY29tcGxldGU9KCk9PnQobil9KSl9dmFsdWVzKCl7cmV0dXJuIG5ldyBQcm9taXNlKCgodCxlKT0+e2NvbnN0IHI9dGhpcy5fZ2V0U3RvcmUoInJlYWRvbmx5Iik7aWYoIXIpcmV0dXJuIGUoKTtpZihyLmdldEFsbCl7Y29uc3Qgbj1yLmdldEFsbCgpO3JldHVybiBuLm9uc3VjY2Vzcz0oKT0+e3Qobi5yZXN1bHQpfSx2b2lkKG4ub25lcnJvcj0oKT0+e2UoKX0pfWNvbnN0IG49W107ci5vcGVuQ3Vyc29yKCkub25zdWNjZXNzPWZ1bmN0aW9uKCl7dGhpcy5yZXN1bHQmJihuLnB1c2godGhpcy5yZXN1bHQudmFsdWUpLHRoaXMucmVzdWx0LmNvbnRpbnVlKCkpfSxyLnRyYW5zYWN0aW9uLm9uY29tcGxldGU9KCk9PnQobil9KSl9ZG93bmxvYWQodCl7dD10fHx0aGlzLnN0b3JlS2V5LHRoaXMuZ2V0KHQpLnRoZW4oKGU9Pntjb25zdCByPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTtyLmRvd25sb2FkPSIiLmNvbmNhdCh0LCIudHh0Iiksci5ocmVmPSJkYXRhOnRleHQvcGFpbnQ7dXRmLTgsIi5jb25jYXQoZXx8IiIpLHIuY2xpY2soKX0pKX19O2NsYXNzIEZse2NvbnN0cnVjdG9yKCl7bGwodGhpcywiX2FsbCIse30pfW9uKHQsZSl7Y29uc3Qgcj10aGlzLl9hbGxbdF07cj9yLnB1c2goZSk6dGhpcy5fYWxsW3RdPVtlXX1vbmNlKHQsZSl7dmFyIHI9dGhpcztjb25zdCBuPWZ1bmN0aW9uKCl7ZSguLi5hcmd1bWVudHMpLHIub2ZmKHQsbil9O3RoaXMub24odCxuKX1vZmYodCxlKXtjb25zdCByPXRoaXMuX2FsbFt0XTtudWxsPT1yfHxyLnNwbGljZShyLmluZGV4T2YoZSk+Pj4wLDEpfWVtaXQodCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO2NvbnN0IGk9dGhpcy5fYWxsW3RdO251bGw9PWl8fGkuc2xpY2UoKS5mb3JFYWNoKCh0PT50KC4uLnIpKSl9c2FmZUVtaXQodCl7dHJ5e2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGU+MT9lLTE6MCksbj0xO248ZTtuKyspcltuLTFdPWFyZ3VtZW50c1tuXTtyZXR1cm4gdGhpcy5lbWl0KHQsLi4ucil9Y2F0Y2goJGcpe2NvbnNvbGUuZXJyb3IoJGcpfX1kZXN0cm95KCl7dGhpcy5fYWxsPXt9fX1jb25zdCBqbD1bIlVQTE9BRF9DT05TT0xFX0xFTkdUSF9DVVQiLCJVUExPQURfUkVQT1JUX0xJTUlUIl07Y29uc3QgVWw9bmV3IGNsYXNzIGV4dGVuZHMgRmx7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLGxsKHRoaXMsImNvbmZpZyIse1VQTE9BRF9DT05TT0xFX09OOiExLFVQTE9BRF9DT05TT0xFX0xFTkdUSF9DVVQ6MjAwLFVQTE9BRF9SRVBPUlRfTElNSVQ6NDVlNCxFTkFCTEVfUkVQT1JUX0lEQl9CVUZGRVI6ITF9KX1zZXRQYXJhbWV0ZXIodCxlKXtpZihmdW5jdGlvbih0KXtyZXR1cm4gamwuaW5jbHVkZXModCl9KHQpKXRyeXtjb25zdCByPU51bWJlcihlKTtpZihOdW1iZXIuaXNOYU4ocikpcmV0dXJuO3RoaXMuY29uZmlnW3RdPXJ9Y2F0Y2gocil7cmV0dXJuIHZvaWQgY29uc29sZS53YXJuKCJDYW5ub3QgY29udmVydCBjb3JlIGxpYiBwYXJhbWV0ZXIgIi5jb25jYXQodCwiOiIpLmNvbmNhdChlLCIgaW50byBudW1iZXIiKSl9ZWxzZSB0aGlzLmNvbmZpZ1t0XT1lO3RoaXMuZW1pdCh0LHRoaXMuY29uZmlnW3RdKX1nZXRQYXJhbWV0ZXIodCl7cmV0dXJuIHRoaXMuY29uZmlnW3RdfWdldEtleXMoKXtyZXR1cm4gT2JqZWN0LmtleXModGhpcy5jb25maWcpfX07dmFyIEhsPSR0LEtsPW1pO0NyKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6cygoZnVuY3Rpb24oKXtLbCgxKX0pKX0se2tleXM6ZnVuY3Rpb24odCl7cmV0dXJuIEtsKEhsKHQpKX19KTt2YXIgSmw9ZShRLk9iamVjdC5rZXlzKSxXbD1lKFEuT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyksWmw9WW8uZmlsdGVyO0NyKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6IVJuKCJmaWx0ZXIiKX0se2ZpbHRlcjpmdW5jdGlvbih0KXtyZXR1cm4gWmwodGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KTt2YXIgR2w9X2woIkFycmF5IiwiZmlsdGVyIiksVmw9b3QsJGw9R2wsWGw9QXJyYXkucHJvdG90eXBlLFlsPWUoKGZ1bmN0aW9uKHQpe3ZhciBlPXQuZmlsdGVyO3JldHVybiB0PT09WGx8fFZsKFhsLHQpJiZlPT09WGwuZmlsdGVyPyRsOmV9KSkscWw9e2V4cG9ydHM6e319LFFsPUNyLHRoPXMsZWg9WCxyaD1BLmYsbmg9QztRbCh7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOiFuaHx8dGgoKGZ1bmN0aW9uKCl7cmgoMSl9KSksc2hhbTohbmh9LHtnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gcmgoZWgodCksZSl9fSk7dmFyIGloPVEuT2JqZWN0LG9oPXFsLmV4cG9ydHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gaWguZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSl9O2loLmdldE93blByb3BlcnR5RGVzY3JpcHRvci5zaGFtJiYob2guc2hhbT0hMCk7dmFyIHNoPWUocWwuZXhwb3J0cyksYWg9QyxjaD1Ecix1aD1UeXBlRXJyb3IsbGg9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixoaD1haCYmIWZ1bmN0aW9uKCl7aWYodm9pZCAwIT09dGhpcylyZXR1cm4hMDt0cnl7T2JqZWN0LmRlZmluZVByb3BlcnR5KFtdLCJsZW5ndGgiLHt3cml0YWJsZTohMX0pLmxlbmd0aD0xfWNhdGNoKCRnKXtyZXR1cm4gJGcgaW5zdGFuY2VvZiBUeXBlRXJyb3J9fSgpLGZoPSR0LGRoPUpyLHBoPWhoP2Z1bmN0aW9uKHQsZSl7aWYoY2godCkmJiFsaCh0LCJsZW5ndGgiKS53cml0YWJsZSl0aHJvdyBuZXcgdWgoIkNhbm5vdCBzZXQgcmVhZCBvbmx5IC5sZW5ndGgiKTtyZXR1cm4gdC5sZW5ndGg9ZX06ZnVuY3Rpb24odCxlKXtyZXR1cm4gdC5sZW5ndGg9ZX0sX2g9WnI7Q3Ioe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGFyaXR5OjEsZm9yY2VkOnMoKGZ1bmN0aW9uKCl7cmV0dXJuIDQyOTQ5NjcyOTchPT1bXS5wdXNoLmNhbGwoe2xlbmd0aDo0Mjk0OTY3Mjk2fSwxKX0pKXx8IWZ1bmN0aW9uKCl7dHJ5e09iamVjdC5kZWZpbmVQcm9wZXJ0eShbXSwibGVuZ3RoIix7d3JpdGFibGU6ITF9KS5wdXNoKCl9Y2F0Y2goJGcpe3JldHVybiAkZyBpbnN0YW5jZW9mIFR5cGVFcnJvcn19KCl9LHtwdXNoOmZ1bmN0aW9uKHQpe3ZhciBlPWZoKHRoaXMpLHI9ZGgoZSksbj1hcmd1bWVudHMubGVuZ3RoO19oKHIrbik7Zm9yKHZhciBpPTA7aTxuO2krKyllW3JdPWFyZ3VtZW50c1tpXSxyKys7cmV0dXJuIHBoKGUscikscn19KTt2YXIgZ2g9X2woIkFycmF5IiwicHVzaCIpLG1oPW90LHloPWdoLHZoPUFycmF5LnByb3RvdHlwZSxiaD1lKChmdW5jdGlvbih0KXt2YXIgZT10LnB1c2g7cmV0dXJuIHQ9PT12aHx8bWgodmgsdCkmJmU9PT12aC5wdXNoP3loOmV9KSksd2g9cyxTaD1Zby5mb3JFYWNoLGtoPWZ1bmN0aW9uKHQsZSl7dmFyIHI9W11bdF07cmV0dXJuISFyJiZ3aCgoZnVuY3Rpb24oKXtyLmNhbGwobnVsbCxlfHxmdW5jdGlvbigpe3JldHVybiAxfSwxKX0pKX0oImZvckVhY2giKT9bXS5mb3JFYWNoOmZ1bmN0aW9uKHQpe3JldHVybiBTaCh0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfTtDcih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOltdLmZvckVhY2ghPT1raH0se2ZvckVhY2g6a2h9KTt2YXIgT2g9X2woIkFycmF5IiwiZm9yRWFjaCIpLHhoPXNuLEVoPXF0LEFoPW90LENoPU9oLEloPUFycmF5LnByb3RvdHlwZSxUaD17RE9NVG9rZW5MaXN0OiEwLE5vZGVMaXN0OiEwfSxMaD1lKChmdW5jdGlvbih0KXt2YXIgZT10LmZvckVhY2g7cmV0dXJuIHQ9PT1JaHx8QWgoSWgsdCkmJmU9PT1JaC5mb3JFYWNofHxFaChUaCx4aCh0KSk/Q2g6ZX0pKSxCaD1pdCxOaD1LaSxSaD1RaSx6aD1ycixEaD1tKFtdLmNvbmNhdCksUGg9QmgoIlJlZmxlY3QiLCJvd25LZXlzIil8fGZ1bmN0aW9uKHQpe3ZhciBlPU5oLmYoemgodCkpLHI9UmguZjtyZXR1cm4gcj9EaChlLHIodCkpOmV9LE1oPVgsRmg9QSxqaD1YcjtDcih7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsc2hhbTohQ30se2dldE93blByb3BlcnR5RGVzY3JpcHRvcnM6ZnVuY3Rpb24odCl7Zm9yKHZhciBlLHIsbj1NaCh0KSxpPUZoLmYsbz1QaChuKSxzPXt9LGE9MDtvLmxlbmd0aD5hOyl2b2lkIDAhPT0ocj1pKG4sZT1vW2ErK10pKSYmamgocyxlLHIpO3JldHVybiBzfX0pO3ZhciBVaD1lKFEuT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpLEhoPXtleHBvcnRzOnt9fSxLaD1DcixKaD1DLFdoPXFuLmY7S2goe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDpPYmplY3QuZGVmaW5lUHJvcGVydGllcyE9PVdoLHNoYW06IUpofSx7ZGVmaW5lUHJvcGVydGllczpXaH0pO3ZhciBaaD1RLk9iamVjdCxHaD1IaC5leHBvcnRzPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIFpoLmRlZmluZVByb3BlcnRpZXModCxlKX07WmguZGVmaW5lUHJvcGVydGllcy5zaGFtJiYoR2guc2hhbT0hMCk7dmFyIFZoPWUoSGguZXhwb3J0cyk7ZnVuY3Rpb24gJGgodCxlKXt2YXIgcj1KbCh0KTtpZihXbCl7dmFyIG49V2wodCk7ZSYmKG49WWwobikuY2FsbChuLChmdW5jdGlvbihlKXtyZXR1cm4gc2godCxlKS5lbnVtZXJhYmxlfSkpKSxiaChyKS5hcHBseShyLG4pfXJldHVybiByfWZ1bmN0aW9uIFhoKHQpe2Zvcih2YXIgZT0xO2U8YXJndW1lbnRzLmxlbmd0aDtlKyspe3ZhciByLG4saT1udWxsIT1hcmd1bWVudHNbZV0/YXJndW1lbnRzW2VdOnt9O2UlMj9MaChyPSRoKE9iamVjdChpKSwhMCkpLmNhbGwociwoZnVuY3Rpb24oZSl7bGwodCxlLGlbZV0pfSkpOlVoP1ZoKHQsVWgoaSkpOkxoKG49JGgoT2JqZWN0KGkpKSkuY2FsbChuLChmdW5jdGlvbihlKXtScih0LGUsc2goaSxlKSl9KSl9cmV0dXJuIHR9dmFyIFloPURyLHFoPUpyLFFoPVpyLHRmPVhlLGVmPWZ1bmN0aW9uKHQsZSxyLG4saSxvLHMsYSl7Zm9yKHZhciBjLHUsbD1pLGg9MCxmPSEhcyYmdGYocyxhKTtoPG47KWggaW4gciYmKGM9Zj9mKHJbaF0saCxlKTpyW2hdLG8+MCYmWWgoYyk/KHU9cWgoYyksbD1lZih0LGUsYyx1LGwsby0xKS0xKTooUWgobCsxKSx0W2xdPWMpLGwrKyksaCsrO3JldHVybiBsfSxyZj1lZixuZj0kdCxvZj1KcixzZj1qcixhZj1UbjtDcih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITB9LHtmbGF0OmZ1bmN0aW9uKCl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD9hcmd1bWVudHNbMF06dm9pZCAwLGU9bmYodGhpcykscj1vZihlKSxuPWFmKGUsMCk7cmV0dXJuIG4ubGVuZ3RoPXJmKG4sZSxlLHIsMCx2b2lkIDA9PT10PzE6c2YodCkpLG59fSk7dmFyIGNmPV9sKCJBcnJheSIsImZsYXQiKSx1Zj1vdCxsZj1jZixoZj1BcnJheS5wcm90b3R5cGUsZmY9ZSgoZnVuY3Rpb24odCl7dmFyIGU9dC5mbGF0O3JldHVybiB0PT09aGZ8fHVmKGhmLHQpJiZlPT09aGYuZmxhdD9sZjplfSkpLGRmPXt9OyFmdW5jdGlvbih0KXt2YXIgZT0idW5kZWZpbmVkIiE9dHlwZW9mIFVpbnQ4QXJyYXkmJiJ1bmRlZmluZWQiIT10eXBlb2YgVWludDE2QXJyYXkmJiJ1bmRlZmluZWQiIT10eXBlb2YgSW50MzJBcnJheTtmdW5jdGlvbiByKHQsZSl7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LGUpfXQuYXNzaWduPWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7ZS5sZW5ndGg7KXt2YXIgbj1lLnNoaWZ0KCk7aWYobil7aWYoIm9iamVjdCIhPXR5cGVvZiBuKXRocm93IG5ldyBUeXBlRXJyb3IobisibXVzdCBiZSBub24tb2JqZWN0Iik7Zm9yKHZhciBpIGluIG4pcihuLGkpJiYodFtpXT1uW2ldKX19cmV0dXJuIHR9LHQuc2hyaW5rQnVmPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQubGVuZ3RoPT09ZT90OnQuc3ViYXJyYXk/dC5zdWJhcnJheSgwLGUpOih0Lmxlbmd0aD1lLHQpfTt2YXIgbj17YXJyYXlTZXQ6ZnVuY3Rpb24odCxlLHIsbixpKXtpZihlLnN1YmFycmF5JiZ0LnN1YmFycmF5KXQuc2V0KGUuc3ViYXJyYXkocixyK24pLGkpO2Vsc2UgZm9yKHZhciBvPTA7bzxuO28rKyl0W2krb109ZVtyK29dfSxmbGF0dGVuQ2h1bmtzOmZ1bmN0aW9uKHQpe3ZhciBlLHIsbixpLG8scztmb3Iobj0wLGU9MCxyPXQubGVuZ3RoO2U8cjtlKyspbis9dFtlXS5sZW5ndGg7Zm9yKHM9bmV3IFVpbnQ4QXJyYXkobiksaT0wLGU9MCxyPXQubGVuZ3RoO2U8cjtlKyspbz10W2VdLHMuc2V0KG8saSksaSs9by5sZW5ndGg7cmV0dXJuIHN9fSxpPXthcnJheVNldDpmdW5jdGlvbih0LGUscixuLGkpe2Zvcih2YXIgbz0wO288bjtvKyspdFtpK29dPWVbcitvXX0sZmxhdHRlbkNodW5rczpmdW5jdGlvbih0KXtyZXR1cm5bXS5jb25jYXQuYXBwbHkoW10sdCl9fTt0LnNldFR5cGVkPWZ1bmN0aW9uKGUpe2U/KHQuQnVmOD1VaW50OEFycmF5LHQuQnVmMTY9VWludDE2QXJyYXksdC5CdWYzMj1JbnQzMkFycmF5LHQuYXNzaWduKHQsbikpOih0LkJ1Zjg9QXJyYXksdC5CdWYxNj1BcnJheSx0LkJ1ZjMyPUFycmF5LHQuYXNzaWduKHQsaSkpfSx0LnNldFR5cGVkKGUpfShkZik7dmFyIHBmPXt9LF9mPXt9LGdmPXt9LG1mPWRmO2Z1bmN0aW9uIHlmKHQpe2Zvcih2YXIgZT10Lmxlbmd0aDstLWU+PTA7KXRbZV09MH12YXIgdmY9MjU2LGJmPTI4Nix3Zj0zMCxTZj0xNSxrZj1bMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwXSxPZj1bMCwwLDAsMCwxLDEsMiwyLDMsMyw0LDQsNSw1LDYsNiw3LDcsOCw4LDksOSwxMCwxMCwxMSwxMSwxMiwxMiwxMywxM10seGY9WzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMiwzLDddLEVmPVsxNiwxNywxOCwwLDgsNyw5LDYsMTAsNSwxMSw0LDEyLDMsMTMsMiwxNCwxLDE1XSxBZj1uZXcgQXJyYXkoNTc2KTt5ZihBZik7dmFyIENmPW5ldyBBcnJheSg2MCk7eWYoQ2YpO3ZhciBJZj1uZXcgQXJyYXkoNTEyKTt5ZihJZik7dmFyIFRmPW5ldyBBcnJheSgyNTYpO3lmKFRmKTt2YXIgTGY9bmV3IEFycmF5KDI5KTt5ZihMZik7dmFyIEJmLE5mLFJmLHpmPW5ldyBBcnJheSh3Zik7ZnVuY3Rpb24gRGYodCxlLHIsbixpKXt0aGlzLnN0YXRpY190cmVlPXQsdGhpcy5leHRyYV9iaXRzPWUsdGhpcy5leHRyYV9iYXNlPXIsdGhpcy5lbGVtcz1uLHRoaXMubWF4X2xlbmd0aD1pLHRoaXMuaGFzX3N0cmVlPXQmJnQubGVuZ3RofWZ1bmN0aW9uIFBmKHQsZSl7dGhpcy5keW5fdHJlZT10LHRoaXMubWF4X2NvZGU9MCx0aGlzLnN0YXRfZGVzYz1lfWZ1bmN0aW9uIE1mKHQpe3JldHVybiB0PDI1Nj9JZlt0XTpJZlsyNTYrKHQ+Pj43KV19ZnVuY3Rpb24gRmYodCxlKXt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTV9ZnVuY3Rpb24gamYodCxlLHIpe3QuYmlfdmFsaWQ+MTYtcj8odC5iaV9idWZ8PWU8PHQuYmlfdmFsaWQmNjU1MzUsRmYodCx0LmJpX2J1ZiksdC5iaV9idWY9ZT4+MTYtdC5iaV92YWxpZCx0LmJpX3ZhbGlkKz1yLTE2KToodC5iaV9idWZ8PWU8PHQuYmlfdmFsaWQmNjU1MzUsdC5iaV92YWxpZCs9cil9ZnVuY3Rpb24gVWYodCxlLHIpe2pmKHQsclsyKmVdLHJbMiplKzFdKX1mdW5jdGlvbiBIZih0LGUpe3ZhciByPTA7ZG97cnw9MSZ0LHQ+Pj49MSxyPDw9MX13aGlsZSgtLWU+MCk7cmV0dXJuIHI+Pj4xfWZ1bmN0aW9uIEtmKHQsZSxyKXt2YXIgbixpLG89bmV3IEFycmF5KDE2KSxzPTA7Zm9yKG49MTtuPD1TZjtuKyspb1tuXT1zPXMrcltuLTFdPDwxO2ZvcihpPTA7aTw9ZTtpKyspe3ZhciBhPXRbMippKzFdOzAhPT1hJiYodFsyKmldPUhmKG9bYV0rKyxhKSl9fWZ1bmN0aW9uIEpmKHQpe3ZhciBlO2ZvcihlPTA7ZTxiZjtlKyspdC5keW5fbHRyZWVbMiplXT0wO2ZvcihlPTA7ZTx3ZjtlKyspdC5keW5fZHRyZWVbMiplXT0wO2ZvcihlPTA7ZTwxOTtlKyspdC5ibF90cmVlWzIqZV09MDt0LmR5bl9sdHJlZVs1MTJdPTEsdC5vcHRfbGVuPXQuc3RhdGljX2xlbj0wLHQubGFzdF9saXQ9dC5tYXRjaGVzPTB9ZnVuY3Rpb24gV2YodCl7dC5iaV92YWxpZD44P0ZmKHQsdC5iaV9idWYpOnQuYmlfdmFsaWQ+MCYmKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPXQuYmlfYnVmKSx0LmJpX2J1Zj0wLHQuYmlfdmFsaWQ9MH1mdW5jdGlvbiBaZih0LGUscixuKXt2YXIgaT0yKmUsbz0yKnI7cmV0dXJuIHRbaV08dFtvXXx8dFtpXT09PXRbb10mJm5bZV08PW5bcl19ZnVuY3Rpb24gR2YodCxlLHIpe2Zvcih2YXIgbj10LmhlYXBbcl0saT1yPDwxO2k8PXQuaGVhcF9sZW4mJihpPHQuaGVhcF9sZW4mJlpmKGUsdC5oZWFwW2krMV0sdC5oZWFwW2ldLHQuZGVwdGgpJiZpKyssIVpmKGUsbix0LmhlYXBbaV0sdC5kZXB0aCkpOyl0LmhlYXBbcl09dC5oZWFwW2ldLHI9aSxpPDw9MTt0LmhlYXBbcl09bn1mdW5jdGlvbiBWZih0LGUscil7dmFyIG4saSxvLHMsYT0wO2lmKDAhPT10Lmxhc3RfbGl0KWRve249dC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqYV08PDh8dC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqYSsxXSxpPXQucGVuZGluZ19idWZbdC5sX2J1ZithXSxhKyssMD09PW4/VWYodCxpLGUpOihVZih0LChvPVRmW2ldKSt2ZisxLGUpLDAhPT0ocz1rZltvXSkmJmpmKHQsaS09TGZbb10scyksVWYodCxvPU1mKC0tbiksciksMCE9PShzPU9mW29dKSYmamYodCxuLT16ZltvXSxzKSl9d2hpbGUoYTx0Lmxhc3RfbGl0KTtVZih0LDI1NixlKX1mdW5jdGlvbiAkZih0LGUpe3ZhciByLG4saSxvPWUuZHluX3RyZWUscz1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxhPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxjPWUuc3RhdF9kZXNjLmVsZW1zLHU9LTE7Zm9yKHQuaGVhcF9sZW49MCx0LmhlYXBfbWF4PTU3MyxyPTA7cjxjO3IrKykwIT09b1syKnJdPyh0LmhlYXBbKyt0LmhlYXBfbGVuXT11PXIsdC5kZXB0aFtyXT0wKTpvWzIqcisxXT0wO2Zvcig7dC5oZWFwX2xlbjwyOylvWzIqKGk9dC5oZWFwWysrdC5oZWFwX2xlbl09dTwyPysrdTowKV09MSx0LmRlcHRoW2ldPTAsdC5vcHRfbGVuLS0sYSYmKHQuc3RhdGljX2xlbi09c1syKmkrMV0pO2ZvcihlLm1heF9jb2RlPXUscj10LmhlYXBfbGVuPj4xO3I+PTE7ci0tKUdmKHQsbyxyKTtpPWM7ZG97cj10LmhlYXBbMV0sdC5oZWFwWzFdPXQuaGVhcFt0LmhlYXBfbGVuLS1dLEdmKHQsbywxKSxuPXQuaGVhcFsxXSx0LmhlYXBbLS10LmhlYXBfbWF4XT1yLHQuaGVhcFstLXQuaGVhcF9tYXhdPW4sb1syKmldPW9bMipyXStvWzIqbl0sdC5kZXB0aFtpXT0odC5kZXB0aFtyXT49dC5kZXB0aFtuXT90LmRlcHRoW3JdOnQuZGVwdGhbbl0pKzEsb1syKnIrMV09b1syKm4rMV09aSx0LmhlYXBbMV09aSsrLEdmKHQsbywxKX13aGlsZSh0LmhlYXBfbGVuPj0yKTt0LmhlYXBbLS10LmhlYXBfbWF4XT10LmhlYXBbMV0sZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYz1lLmR5bl90cmVlLHU9ZS5tYXhfY29kZSxsPWUuc3RhdF9kZXNjLnN0YXRpY190cmVlLGg9ZS5zdGF0X2Rlc2MuaGFzX3N0cmVlLGY9ZS5zdGF0X2Rlc2MuZXh0cmFfYml0cyxkPWUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UscD1lLnN0YXRfZGVzYy5tYXhfbGVuZ3RoLF89MDtmb3Iobz0wO288PVNmO28rKyl0LmJsX2NvdW50W29dPTA7Zm9yKGNbMip0LmhlYXBbdC5oZWFwX21heF0rMV09MCxyPXQuaGVhcF9tYXgrMTtyPDU3MztyKyspKG89Y1syKmNbMioobj10LmhlYXBbcl0pKzFdKzFdKzEpPnAmJihvPXAsXysrKSxjWzIqbisxXT1vLG4+dXx8KHQuYmxfY291bnRbb10rKyxzPTAsbj49ZCYmKHM9ZltuLWRdKSxhPWNbMipuXSx0Lm9wdF9sZW4rPWEqKG8rcyksaCYmKHQuc3RhdGljX2xlbis9YSoobFsyKm4rMV0rcykpKTtpZigwIT09Xyl7ZG97Zm9yKG89cC0xOzA9PT10LmJsX2NvdW50W29dOylvLS07dC5ibF9jb3VudFtvXS0tLHQuYmxfY291bnRbbysxXSs9Mix0LmJsX2NvdW50W3BdLS0sXy09Mn13aGlsZShfPjApO2ZvcihvPXA7MCE9PW87by0tKWZvcihuPXQuYmxfY291bnRbb107MCE9PW47KShpPXQuaGVhcFstLXJdKT51fHwoY1syKmkrMV0hPT1vJiYodC5vcHRfbGVuKz0oby1jWzIqaSsxXSkqY1syKmldLGNbMippKzFdPW8pLG4tLSl9fSh0LGUpLEtmKG8sdSx0LmJsX2NvdW50KX1mdW5jdGlvbiBYZih0LGUscil7dmFyIG4saSxvPS0xLHM9ZVsxXSxhPTAsYz03LHU9NDtmb3IoMD09PXMmJihjPTEzOCx1PTMpLGVbMioocisxKSsxXT02NTUzNSxuPTA7bjw9cjtuKyspaT1zLHM9ZVsyKihuKzEpKzFdLCsrYTxjJiZpPT09c3x8KGE8dT90LmJsX3RyZWVbMippXSs9YTowIT09aT8oaSE9PW8mJnQuYmxfdHJlZVsyKmldKyssdC5ibF90cmVlWzMyXSsrKTphPD0xMD90LmJsX3RyZWVbMzRdKys6dC5ibF90cmVlWzM2XSsrLGE9MCxvPWksMD09PXM/KGM9MTM4LHU9Myk6aT09PXM/KGM9Nix1PTMpOihjPTcsdT00KSl9ZnVuY3Rpb24gWWYodCxlLHIpe3ZhciBuLGksbz0tMSxzPWVbMV0sYT0wLGM9Nyx1PTQ7Zm9yKDA9PT1zJiYoYz0xMzgsdT0zKSxuPTA7bjw9cjtuKyspaWYoaT1zLHM9ZVsyKihuKzEpKzFdLCEoKythPGMmJmk9PT1zKSl7aWYoYTx1KWRve1VmKHQsaSx0LmJsX3RyZWUpfXdoaWxlKDAhPS0tYSk7ZWxzZSAwIT09aT8oaSE9PW8mJihVZih0LGksdC5ibF90cmVlKSxhLS0pLFVmKHQsMTYsdC5ibF90cmVlKSxqZih0LGEtMywyKSk6YTw9MTA/KFVmKHQsMTcsdC5ibF90cmVlKSxqZih0LGEtMywzKSk6KFVmKHQsMTgsdC5ibF90cmVlKSxqZih0LGEtMTEsNykpO2E9MCxvPWksMD09PXM/KGM9MTM4LHU9Myk6aT09PXM/KGM9Nix1PTMpOihjPTcsdT00KX19eWYoemYpO3ZhciBxZj0hMTtmdW5jdGlvbiBRZih0LGUscixuKXtqZih0LDArKG4/MTowKSwzKSxmdW5jdGlvbih0LGUscixuKXtXZih0KSxuJiYoRmYodCxyKSxGZih0LH5yKSksbWYuYXJyYXlTZXQodC5wZW5kaW5nX2J1Zix0LndpbmRvdyxlLHIsdC5wZW5kaW5nKSx0LnBlbmRpbmcrPXJ9KHQsZSxyLCEwKX1nZi5fdHJfaW5pdD1mdW5jdGlvbih0KXtxZnx8KCFmdW5jdGlvbigpe3ZhciB0LGUscixuLGksbz1uZXcgQXJyYXkoMTYpO2ZvcihyPTAsbj0wO248Mjg7bisrKWZvcihMZltuXT1yLHQ9MDt0PDE8PGtmW25dO3QrKylUZltyKytdPW47Zm9yKFRmW3ItMV09bixpPTAsbj0wO248MTY7bisrKWZvcih6ZltuXT1pLHQ9MDt0PDE8PE9mW25dO3QrKylJZltpKytdPW47Zm9yKGk+Pj03O248d2Y7bisrKWZvcih6ZltuXT1pPDw3LHQ9MDt0PDE8PE9mW25dLTc7dCsrKUlmWzI1NitpKytdPW47Zm9yKGU9MDtlPD1TZjtlKyspb1tlXT0wO2Zvcih0PTA7dDw9MTQzOylBZlsyKnQrMV09OCx0Kyssb1s4XSsrO2Zvcig7dDw9MjU1OylBZlsyKnQrMV09OSx0Kyssb1s5XSsrO2Zvcig7dDw9Mjc5OylBZlsyKnQrMV09Nyx0Kyssb1s3XSsrO2Zvcig7dDw9Mjg3OylBZlsyKnQrMV09OCx0Kyssb1s4XSsrO2ZvcihLZihBZiwyODcsbyksdD0wO3Q8d2Y7dCsrKUNmWzIqdCsxXT01LENmWzIqdF09SGYodCw1KTtCZj1uZXcgRGYoQWYsa2YsMjU3LGJmLFNmKSxOZj1uZXcgRGYoQ2YsT2YsMCx3ZixTZiksUmY9bmV3IERmKG5ldyBBcnJheSgwKSx4ZiwwLDE5LDcpfSgpLHFmPSEwKSx0LmxfZGVzYz1uZXcgUGYodC5keW5fbHRyZWUsQmYpLHQuZF9kZXNjPW5ldyBQZih0LmR5bl9kdHJlZSxOZiksdC5ibF9kZXNjPW5ldyBQZih0LmJsX3RyZWUsUmYpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wLEpmKHQpfSxnZi5fdHJfc3RvcmVkX2Jsb2NrPVFmLGdmLl90cl9mbHVzaF9ibG9jaz1mdW5jdGlvbih0LGUscixuKXt2YXIgaSxvLHM9MDt0LmxldmVsPjA/KDI9PT10LnN0cm0uZGF0YV90eXBlJiYodC5zdHJtLmRhdGFfdHlwZT1mdW5jdGlvbih0KXt2YXIgZSxyPTQwOTM2MjQ0NDc7Zm9yKGU9MDtlPD0zMTtlKysscj4+Pj0xKWlmKDEmciYmMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIDA7aWYoMCE9PXQuZHluX2x0cmVlWzE4XXx8MCE9PXQuZHluX2x0cmVlWzIwXXx8MCE9PXQuZHluX2x0cmVlWzI2XSlyZXR1cm4gMTtmb3IoZT0zMjtlPHZmO2UrKylpZigwIT09dC5keW5fbHRyZWVbMiplXSlyZXR1cm4gMTtyZXR1cm4gMH0odCkpLCRmKHQsdC5sX2Rlc2MpLCRmKHQsdC5kX2Rlc2MpLHM9ZnVuY3Rpb24odCl7dmFyIGU7Zm9yKFhmKHQsdC5keW5fbHRyZWUsdC5sX2Rlc2MubWF4X2NvZGUpLFhmKHQsdC5keW5fZHRyZWUsdC5kX2Rlc2MubWF4X2NvZGUpLCRmKHQsdC5ibF9kZXNjKSxlPTE4O2U+PTMmJjA9PT10LmJsX3RyZWVbMipFZltlXSsxXTtlLS0pO3JldHVybiB0Lm9wdF9sZW4rPTMqKGUrMSkrNSs1KzQsZX0odCksaT10Lm9wdF9sZW4rMys3Pj4+Mywobz10LnN0YXRpY19sZW4rMys3Pj4+Myk8PWkmJihpPW8pKTppPW89cis1LHIrNDw9aSYmLTEhPT1lP1FmKHQsZSxyLG4pOjQ9PT10LnN0cmF0ZWd5fHxvPT09aT8oamYodCwyKyhuPzE6MCksMyksVmYodCxBZixDZikpOihqZih0LDQrKG4/MTowKSwzKSxmdW5jdGlvbih0LGUscixuKXt2YXIgaTtmb3IoamYodCxlLTI1Nyw1KSxqZih0LHItMSw1KSxqZih0LG4tNCw0KSxpPTA7aTxuO2krKylqZih0LHQuYmxfdHJlZVsyKkVmW2ldKzFdLDMpO1lmKHQsdC5keW5fbHRyZWUsZS0xKSxZZih0LHQuZHluX2R0cmVlLHItMSl9KHQsdC5sX2Rlc2MubWF4X2NvZGUrMSx0LmRfZGVzYy5tYXhfY29kZSsxLHMrMSksVmYodCx0LmR5bl9sdHJlZSx0LmR5bl9kdHJlZSkpLEpmKHQpLG4mJldmKHQpfSxnZi5fdHJfdGFsbHk9ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0LnBlbmRpbmdfYnVmW3QuZF9idWYrMip0Lmxhc3RfbGl0XT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqdC5sYXN0X2xpdCsxXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QubF9idWYrdC5sYXN0X2xpdF09MjU1JnIsdC5sYXN0X2xpdCsrLDA9PT1lP3QuZHluX2x0cmVlWzIqcl0rKzoodC5tYXRjaGVzKyssZS0tLHQuZHluX2x0cmVlWzIqKFRmW3JdK3ZmKzEpXSsrLHQuZHluX2R0cmVlWzIqTWYoZSldKyspLHQubGFzdF9saXQ9PT10LmxpdF9idWZzaXplLTF9LGdmLl90cl9hbGlnbj1mdW5jdGlvbih0KXtqZih0LDIsMyksVWYodCwyNTYsQWYpLGZ1bmN0aW9uKHQpezE2PT09dC5iaV92YWxpZD8oRmYodCx0LmJpX2J1ZiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTApOnQuYmlfdmFsaWQ+PTgmJih0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmdC5iaV9idWYsdC5iaV9idWY+Pj04LHQuYmlfdmFsaWQtPTgpfSh0KX07dmFyIHRkPWZ1bmN0aW9uKHQsZSxyLG4pe2Zvcih2YXIgaT02NTUzNSZ0LG89dD4+PjE2JjY1NTM1LHM9MDswIT09cjspe3ItPXM9cj4yZTM/MmUzOnI7ZG97bz1vKyhpPWkrZVtuKytdfDApfDB9d2hpbGUoLS1zKTtpJT02NTUyMSxvJT02NTUyMX1yZXR1cm4gaXxvPDwxNn07dmFyIGVkPWZ1bmN0aW9uKCl7Zm9yKHZhciB0LGU9W10scj0wO3I8MjU2O3IrKyl7dD1yO2Zvcih2YXIgbj0wO248ODtuKyspdD0xJnQ/Mzk4ODI5MjM4NF50Pj4+MTp0Pj4+MTtlW3JdPXR9cmV0dXJuIGV9KCk7dmFyIHJkLG5kPWZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPWVkLG89bityO3RePS0xO2Zvcih2YXIgcz1uO3M8bztzKyspdD10Pj4+OF5pWzI1NSYodF5lW3NdKV07cmV0dXJufnR9LGlkPXsyOiJuZWVkIGRpY3Rpb25hcnkiLDE6InN0cmVhbSBlbmQiLDA6IiIsIi0xIjoiZmlsZSBlcnJvciIsIi0yIjoic3RyZWFtIGVycm9yIiwiLTMiOiJkYXRhIGVycm9yIiwiLTQiOiJpbnN1ZmZpY2llbnQgbWVtb3J5IiwiLTUiOiJidWZmZXIgZXJyb3IiLCItNiI6ImluY29tcGF0aWJsZSB2ZXJzaW9uIn0sb2Q9ZGYsc2Q9Z2YsYWQ9dGQsY2Q9bmQsdWQ9aWQsbGQ9LTIsaGQ9MjU4LGZkPTI2MixkZD0xMDMscGQ9MTEzLF9kPTY2NjtmdW5jdGlvbiBnZCh0LGUpe3JldHVybiB0Lm1zZz11ZFtlXSxlfWZ1bmN0aW9uIG1kKHQpe3JldHVybih0PDwxKS0odD40Pzk6MCl9ZnVuY3Rpb24geWQodCl7Zm9yKHZhciBlPXQubGVuZ3RoOy0tZT49MDspdFtlXT0wfWZ1bmN0aW9uIHZkKHQpe3ZhciBlPXQuc3RhdGUscj1lLnBlbmRpbmc7cj50LmF2YWlsX291dCYmKHI9dC5hdmFpbF9vdXQpLDAhPT1yJiYob2QuYXJyYXlTZXQodC5vdXRwdXQsZS5wZW5kaW5nX2J1ZixlLnBlbmRpbmdfb3V0LHIsdC5uZXh0X291dCksdC5uZXh0X291dCs9cixlLnBlbmRpbmdfb3V0Kz1yLHQudG90YWxfb3V0Kz1yLHQuYXZhaWxfb3V0LT1yLGUucGVuZGluZy09ciwwPT09ZS5wZW5kaW5nJiYoZS5wZW5kaW5nX291dD0wKSl9ZnVuY3Rpb24gYmQodCxlKXtzZC5fdHJfZmx1c2hfYmxvY2sodCx0LmJsb2NrX3N0YXJ0Pj0wP3QuYmxvY2tfc3RhcnQ6LTEsdC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LGUpLHQuYmxvY2tfc3RhcnQ9dC5zdHJzdGFydCx2ZCh0LnN0cm0pfWZ1bmN0aW9uIHdkKHQsZSl7dC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109ZX1mdW5jdGlvbiBTZCh0LGUpe3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZX1mdW5jdGlvbiBrZCh0LGUpe3ZhciByLG4saT10Lm1heF9jaGFpbl9sZW5ndGgsbz10LnN0cnN0YXJ0LHM9dC5wcmV2X2xlbmd0aCxhPXQubmljZV9tYXRjaCxjPXQuc3Ryc3RhcnQ+dC53X3NpemUtZmQ/dC5zdHJzdGFydC0odC53X3NpemUtZmQpOjAsdT10LndpbmRvdyxsPXQud19tYXNrLGg9dC5wcmV2LGY9dC5zdHJzdGFydCtoZCxkPXVbbytzLTFdLHA9dVtvK3NdO3QucHJldl9sZW5ndGg+PXQuZ29vZF9tYXRjaCYmKGk+Pj0yKSxhPnQubG9va2FoZWFkJiYoYT10Lmxvb2thaGVhZCk7ZG97aWYodVsocj1lKStzXT09PXAmJnVbcitzLTFdPT09ZCYmdVtyXT09PXVbb10mJnVbKytyXT09PXVbbysxXSl7bys9MixyKys7ZG97fXdoaWxlKHVbKytvXT09PXVbKytyXSYmdVsrK29dPT09dVsrK3JdJiZ1Wysrb109PT11Wysrcl0mJnVbKytvXT09PXVbKytyXSYmdVsrK29dPT09dVsrK3JdJiZ1Wysrb109PT11Wysrcl0mJnVbKytvXT09PXVbKytyXSYmdVsrK29dPT09dVsrK3JdJiZvPGYpO2lmKG49aGQtKGYtbyksbz1mLWhkLG4+cyl7aWYodC5tYXRjaF9zdGFydD1lLHM9bixuPj1hKWJyZWFrO2Q9dVtvK3MtMV0scD11W28rc119fX13aGlsZSgoZT1oW2UmbF0pPmMmJjAhPS0taSk7cmV0dXJuIHM8PXQubG9va2FoZWFkP3M6dC5sb29rYWhlYWR9ZnVuY3Rpb24gT2QodCl7dmFyIGUscixuLGksbyxzLGEsYyx1LGwsaD10Lndfc2l6ZTtkb3tpZihpPXQud2luZG93X3NpemUtdC5sb29rYWhlYWQtdC5zdHJzdGFydCx0LnN0cnN0YXJ0Pj1oKyhoLWZkKSl7b2QuYXJyYXlTZXQodC53aW5kb3csdC53aW5kb3csaCxoLDApLHQubWF0Y2hfc3RhcnQtPWgsdC5zdHJzdGFydC09aCx0LmJsb2NrX3N0YXJ0LT1oLGU9cj10Lmhhc2hfc2l6ZTtkb3tuPXQuaGVhZFstLWVdLHQuaGVhZFtlXT1uPj1oP24taDowfXdoaWxlKC0tcik7ZT1yPWg7ZG97bj10LnByZXZbLS1lXSx0LnByZXZbZV09bj49aD9uLWg6MH13aGlsZSgtLXIpO2krPWh9aWYoMD09PXQuc3RybS5hdmFpbF9pbilicmVhaztpZihzPXQuc3RybSxhPXQud2luZG93LGM9dC5zdHJzdGFydCt0Lmxvb2thaGVhZCx1PWksbD12b2lkIDAsKGw9cy5hdmFpbF9pbik+dSYmKGw9dSkscj0wPT09bD8wOihzLmF2YWlsX2luLT1sLG9kLmFycmF5U2V0KGEscy5pbnB1dCxzLm5leHRfaW4sbCxjKSwxPT09cy5zdGF0ZS53cmFwP3MuYWRsZXI9YWQocy5hZGxlcixhLGwsYyk6Mj09PXMuc3RhdGUud3JhcCYmKHMuYWRsZXI9Y2Qocy5hZGxlcixhLGwsYykpLHMubmV4dF9pbis9bCxzLnRvdGFsX2luKz1sLGwpLHQubG9va2FoZWFkKz1yLHQubG9va2FoZWFkK3QuaW5zZXJ0Pj0zKWZvcihvPXQuc3Ryc3RhcnQtdC5pbnNlcnQsdC5pbnNfaD10LndpbmRvd1tvXSx0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbbysxXSkmdC5oYXNoX21hc2s7dC5pbnNlcnQmJih0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbbyszLTFdKSZ0Lmhhc2hfbWFzayx0LnByZXZbbyZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT1vLG8rKyx0Lmluc2VydC0tLCEodC5sb29rYWhlYWQrdC5pbnNlcnQ8MykpOyk7fXdoaWxlKHQubG9va2FoZWFkPGZkJiYwIT09dC5zdHJtLmF2YWlsX2luKX1mdW5jdGlvbiB4ZCh0LGUpe2Zvcih2YXIgcixuOzspe2lmKHQubG9va2FoZWFkPGZkKXtpZihPZCh0KSx0Lmxvb2thaGVhZDxmZCYmMD09PWUpcmV0dXJuIDE7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHI9MCx0Lmxvb2thaGVhZD49MyYmKHQuaW5zX2g9KHQuaW5zX2g8PHQuaGFzaF9zaGlmdF50LndpbmRvd1t0LnN0cnN0YXJ0KzMtMV0pJnQuaGFzaF9tYXNrLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksMCE9PXImJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtZmQmJih0Lm1hdGNoX2xlbmd0aD1rZCh0LHIpKSx0Lm1hdGNoX2xlbmd0aD49MylpZihuPXNkLl90cl90YWxseSh0LHQuc3Ryc3RhcnQtdC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aC0zKSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg8PXQubWF4X2xhenlfbWF0Y2gmJnQubG9va2FoZWFkPj0zKXt0Lm1hdGNoX2xlbmd0aC0tO2Rve3Quc3Ryc3RhcnQrKyx0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbdC5zdHJzdGFydCszLTFdKSZ0Lmhhc2hfbWFzayxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnR9d2hpbGUoMCE9LS10Lm1hdGNoX2xlbmd0aCk7dC5zdHJzdGFydCsrfWVsc2UgdC5zdHJzdGFydCs9dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg9MCx0Lmluc19oPXQud2luZG93W3Quc3Ryc3RhcnRdLHQuaW5zX2g9KHQuaW5zX2g8PHQuaGFzaF9zaGlmdF50LndpbmRvd1t0LnN0cnN0YXJ0KzFdKSZ0Lmhhc2hfbWFzaztlbHNlIG49c2QuX3RyX3RhbGx5KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0Kys7aWYobiYmKGJkKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gMX1yZXR1cm4gdC5pbnNlcnQ9dC5zdHJzdGFydDwyP3Quc3Ryc3RhcnQ6Miw0PT09ZT8oYmQodCwhMCksMD09PXQuc3RybS5hdmFpbF9vdXQ/Mzo0KTp0Lmxhc3RfbGl0JiYoYmQodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpPzE6Mn1mdW5jdGlvbiBFZCh0LGUpe2Zvcih2YXIgcixuLGk7Oyl7aWYodC5sb29rYWhlYWQ8ZmQpe2lmKE9kKHQpLHQubG9va2FoZWFkPGZkJiYwPT09ZSlyZXR1cm4gMTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj0zJiYodC5pbnNfaD0odC5pbnNfaDw8dC5oYXNoX3NoaWZ0XnQud2luZG93W3Quc3Ryc3RhcnQrMy0xXSkmdC5oYXNoX21hc2sscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0KSx0LnByZXZfbGVuZ3RoPXQubWF0Y2hfbGVuZ3RoLHQucHJldl9tYXRjaD10Lm1hdGNoX3N0YXJ0LHQubWF0Y2hfbGVuZ3RoPTIsMCE9PXImJnQucHJldl9sZW5ndGg8dC5tYXhfbGF6eV9tYXRjaCYmdC5zdHJzdGFydC1yPD10Lndfc2l6ZS1mZCYmKHQubWF0Y2hfbGVuZ3RoPWtkKHQsciksdC5tYXRjaF9sZW5ndGg8PTUmJigxPT09dC5zdHJhdGVneXx8Mz09PXQubWF0Y2hfbGVuZ3RoJiZ0LnN0cnN0YXJ0LXQubWF0Y2hfc3RhcnQ+NDA5NikmJih0Lm1hdGNoX2xlbmd0aD0yKSksdC5wcmV2X2xlbmd0aD49MyYmdC5tYXRjaF9sZW5ndGg8PXQucHJldl9sZW5ndGgpe2k9dC5zdHJzdGFydCt0Lmxvb2thaGVhZC0zLG49c2QuX3RyX3RhbGx5KHQsdC5zdHJzdGFydC0xLXQucHJldl9tYXRjaCx0LnByZXZfbGVuZ3RoLTMpLHQubG9va2FoZWFkLT10LnByZXZfbGVuZ3RoLTEsdC5wcmV2X2xlbmd0aC09Mjtkb3srK3Quc3Ryc3RhcnQ8PWkmJih0Lmluc19oPSh0Lmluc19oPDx0Lmhhc2hfc2hpZnRedC53aW5kb3dbdC5zdHJzdGFydCszLTFdKSZ0Lmhhc2hfbWFzayxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpfXdoaWxlKDAhPS0tdC5wcmV2X2xlbmd0aCk7aWYodC5tYXRjaF9hdmFpbGFibGU9MCx0Lm1hdGNoX2xlbmd0aD0yLHQuc3Ryc3RhcnQrKyxuJiYoYmQodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxfWVsc2UgaWYodC5tYXRjaF9hdmFpbGFibGUpe2lmKChuPXNkLl90cl90YWxseSh0LDAsdC53aW5kb3dbdC5zdHJzdGFydC0xXSkpJiZiZCh0LCExKSx0LnN0cnN0YXJ0KyssdC5sb29rYWhlYWQtLSwwPT09dC5zdHJtLmF2YWlsX291dClyZXR1cm4gMX1lbHNlIHQubWF0Y2hfYXZhaWxhYmxlPTEsdC5zdHJzdGFydCsrLHQubG9va2FoZWFkLS19cmV0dXJuIHQubWF0Y2hfYXZhaWxhYmxlJiYobj1zZC5fdHJfdGFsbHkodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLHQubWF0Y2hfYXZhaWxhYmxlPTApLHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8Mj90LnN0cnN0YXJ0OjIsND09PWU/KGJkKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0PzM6NCk6dC5sYXN0X2xpdCYmKGJkKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT8xOjJ9ZnVuY3Rpb24gQWQodCxlLHIsbixpKXt0aGlzLmdvb2RfbGVuZ3RoPXQsdGhpcy5tYXhfbGF6eT1lLHRoaXMubmljZV9sZW5ndGg9cix0aGlzLm1heF9jaGFpbj1uLHRoaXMuZnVuYz1pfWZ1bmN0aW9uIENkKCl7dGhpcy5zdHJtPW51bGwsdGhpcy5zdGF0dXM9MCx0aGlzLnBlbmRpbmdfYnVmPW51bGwsdGhpcy5wZW5kaW5nX2J1Zl9zaXplPTAsdGhpcy5wZW5kaW5nX291dD0wLHRoaXMucGVuZGluZz0wLHRoaXMud3JhcD0wLHRoaXMuZ3poZWFkPW51bGwsdGhpcy5nemluZGV4PTAsdGhpcy5tZXRob2Q9OCx0aGlzLmxhc3RfZmx1c2g9LTEsdGhpcy53X3NpemU9MCx0aGlzLndfYml0cz0wLHRoaXMud19tYXNrPTAsdGhpcy53aW5kb3c9bnVsbCx0aGlzLndpbmRvd19zaXplPTAsdGhpcy5wcmV2PW51bGwsdGhpcy5oZWFkPW51bGwsdGhpcy5pbnNfaD0wLHRoaXMuaGFzaF9zaXplPTAsdGhpcy5oYXNoX2JpdHM9MCx0aGlzLmhhc2hfbWFzaz0wLHRoaXMuaGFzaF9zaGlmdD0wLHRoaXMuYmxvY2tfc3RhcnQ9MCx0aGlzLm1hdGNoX2xlbmd0aD0wLHRoaXMucHJldl9tYXRjaD0wLHRoaXMubWF0Y2hfYXZhaWxhYmxlPTAsdGhpcy5zdHJzdGFydD0wLHRoaXMubWF0Y2hfc3RhcnQ9MCx0aGlzLmxvb2thaGVhZD0wLHRoaXMucHJldl9sZW5ndGg9MCx0aGlzLm1heF9jaGFpbl9sZW5ndGg9MCx0aGlzLm1heF9sYXp5X21hdGNoPTAsdGhpcy5sZXZlbD0wLHRoaXMuc3RyYXRlZ3k9MCx0aGlzLmdvb2RfbWF0Y2g9MCx0aGlzLm5pY2VfbWF0Y2g9MCx0aGlzLmR5bl9sdHJlZT1uZXcgb2QuQnVmMTYoMTE0NiksdGhpcy5keW5fZHRyZWU9bmV3IG9kLkJ1ZjE2KDEyMiksdGhpcy5ibF90cmVlPW5ldyBvZC5CdWYxNig3OCkseWQodGhpcy5keW5fbHRyZWUpLHlkKHRoaXMuZHluX2R0cmVlKSx5ZCh0aGlzLmJsX3RyZWUpLHRoaXMubF9kZXNjPW51bGwsdGhpcy5kX2Rlc2M9bnVsbCx0aGlzLmJsX2Rlc2M9bnVsbCx0aGlzLmJsX2NvdW50PW5ldyBvZC5CdWYxNigxNiksdGhpcy5oZWFwPW5ldyBvZC5CdWYxNig1NzMpLHlkKHRoaXMuaGVhcCksdGhpcy5oZWFwX2xlbj0wLHRoaXMuaGVhcF9tYXg9MCx0aGlzLmRlcHRoPW5ldyBvZC5CdWYxNig1NzMpLHlkKHRoaXMuZGVwdGgpLHRoaXMubF9idWY9MCx0aGlzLmxpdF9idWZzaXplPTAsdGhpcy5sYXN0X2xpdD0wLHRoaXMuZF9idWY9MCx0aGlzLm9wdF9sZW49MCx0aGlzLnN0YXRpY19sZW49MCx0aGlzLm1hdGNoZXM9MCx0aGlzLmluc2VydD0wLHRoaXMuYmlfYnVmPTAsdGhpcy5iaV92YWxpZD0wfWZ1bmN0aW9uIElkKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPyh0LnRvdGFsX2luPXQudG90YWxfb3V0PTAsdC5kYXRhX3R5cGU9MiwoZT10LnN0YXRlKS5wZW5kaW5nPTAsZS5wZW5kaW5nX291dD0wLGUud3JhcDwwJiYoZS53cmFwPS1lLndyYXApLGUuc3RhdHVzPWUud3JhcD80MjpwZCx0LmFkbGVyPTI9PT1lLndyYXA/MDoxLGUubGFzdF9mbHVzaD0wLHNkLl90cl9pbml0KGUpLDApOmdkKHQsbGQpfWZ1bmN0aW9uIFRkKHQpe3ZhciBlLHI9SWQodCk7cmV0dXJuIDA9PT1yJiYoKGU9dC5zdGF0ZSkud2luZG93X3NpemU9MiplLndfc2l6ZSx5ZChlLmhlYWQpLGUubWF4X2xhenlfbWF0Y2g9cmRbZS5sZXZlbF0ubWF4X2xhenksZS5nb29kX21hdGNoPXJkW2UubGV2ZWxdLmdvb2RfbGVuZ3RoLGUubmljZV9tYXRjaD1yZFtlLmxldmVsXS5uaWNlX2xlbmd0aCxlLm1heF9jaGFpbl9sZW5ndGg9cmRbZS5sZXZlbF0ubWF4X2NoYWluLGUuc3Ryc3RhcnQ9MCxlLmJsb2NrX3N0YXJ0PTAsZS5sb29rYWhlYWQ9MCxlLmluc2VydD0wLGUubWF0Y2hfbGVuZ3RoPWUucHJldl9sZW5ndGg9MixlLm1hdGNoX2F2YWlsYWJsZT0wLGUuaW5zX2g9MCkscn1mdW5jdGlvbiBMZCh0LGUscixuLGksbyl7aWYoIXQpcmV0dXJuIGxkO3ZhciBzPTE7aWYoLTE9PT1lJiYoZT02KSxuPDA/KHM9MCxuPS1uKTpuPjE1JiYocz0yLG4tPTE2KSxpPDF8fGk+OXx8OCE9PXJ8fG48OHx8bj4xNXx8ZTwwfHxlPjl8fG88MHx8bz40KXJldHVybiBnZCh0LGxkKTs4PT09biYmKG49OSk7dmFyIGE9bmV3IENkO3JldHVybiB0LnN0YXRlPWEsYS5zdHJtPXQsYS53cmFwPXMsYS5nemhlYWQ9bnVsbCxhLndfYml0cz1uLGEud19zaXplPTE8PGEud19iaXRzLGEud19tYXNrPWEud19zaXplLTEsYS5oYXNoX2JpdHM9aSs3LGEuaGFzaF9zaXplPTE8PGEuaGFzaF9iaXRzLGEuaGFzaF9tYXNrPWEuaGFzaF9zaXplLTEsYS5oYXNoX3NoaWZ0PX5+KChhLmhhc2hfYml0cyszLTEpLzMpLGEud2luZG93PW5ldyBvZC5CdWY4KDIqYS53X3NpemUpLGEuaGVhZD1uZXcgb2QuQnVmMTYoYS5oYXNoX3NpemUpLGEucHJldj1uZXcgb2QuQnVmMTYoYS53X3NpemUpLGEubGl0X2J1ZnNpemU9MTw8aSs2LGEucGVuZGluZ19idWZfc2l6ZT00KmEubGl0X2J1ZnNpemUsYS5wZW5kaW5nX2J1Zj1uZXcgb2QuQnVmOChhLnBlbmRpbmdfYnVmX3NpemUpLGEuZF9idWY9MSphLmxpdF9idWZzaXplLGEubF9idWY9MyphLmxpdF9idWZzaXplLGEubGV2ZWw9ZSxhLnN0cmF0ZWd5PW8sYS5tZXRob2Q9cixUZCh0KX1yZD1bbmV3IEFkKDAsMCwwLDAsKGZ1bmN0aW9uKHQsZSl7dmFyIHI9NjU1MzU7Zm9yKHI+dC5wZW5kaW5nX2J1Zl9zaXplLTUmJihyPXQucGVuZGluZ19idWZfc2l6ZS01KTs7KXtpZih0Lmxvb2thaGVhZDw9MSl7aWYoT2QodCksMD09PXQubG9va2FoZWFkJiYwPT09ZSlyZXR1cm4gMTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9dC5zdHJzdGFydCs9dC5sb29rYWhlYWQsdC5sb29rYWhlYWQ9MDt2YXIgbj10LmJsb2NrX3N0YXJ0K3I7aWYoKDA9PT10LnN0cnN0YXJ0fHx0LnN0cnN0YXJ0Pj1uKSYmKHQubG9va2FoZWFkPXQuc3Ryc3RhcnQtbix0LnN0cnN0YXJ0PW4sYmQodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxO2lmKHQuc3Ryc3RhcnQtdC5ibG9ja19zdGFydD49dC53X3NpemUtZmQmJihiZCh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIDF9cmV0dXJuIHQuaW5zZXJ0PTAsND09PWU/KGJkKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0PzM6NCk6KHQuc3Ryc3RhcnQ+dC5ibG9ja19zdGFydCYmKGJkKHQsITEpLHQuc3RybS5hdmFpbF9vdXQpLDEpfSkpLG5ldyBBZCg0LDQsOCw0LHhkKSxuZXcgQWQoNCw1LDE2LDgseGQpLG5ldyBBZCg0LDYsMzIsMzIseGQpLG5ldyBBZCg0LDQsMTYsMTYsRWQpLG5ldyBBZCg4LDE2LDMyLDMyLEVkKSxuZXcgQWQoOCwxNiwxMjgsMTI4LEVkKSxuZXcgQWQoOCwzMiwxMjgsMjU2LEVkKSxuZXcgQWQoMzIsMTI4LDI1OCwxMDI0LEVkKSxuZXcgQWQoMzIsMjU4LDI1OCw0MDk2LEVkKV0sX2YuZGVmbGF0ZUluaXQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gTGQodCxlLDgsMTUsOCwwKX0sX2YuZGVmbGF0ZUluaXQyPUxkLF9mLmRlZmxhdGVSZXNldD1UZCxfZi5kZWZsYXRlUmVzZXRLZWVwPUlkLF9mLmRlZmxhdGVTZXRIZWFkZXI9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCYmdC5zdGF0ZT8yIT09dC5zdGF0ZS53cmFwP2xkOih0LnN0YXRlLmd6aGVhZD1lLDApOmxkfSxfZi5kZWZsYXRlPWZ1bmN0aW9uKHQsZSl7dmFyIHIsbixpLG87aWYoIXR8fCF0LnN0YXRlfHxlPjV8fGU8MClyZXR1cm4gdD9nZCh0LGxkKTpsZDtpZihuPXQuc3RhdGUsIXQub3V0cHV0fHwhdC5pbnB1dCYmMCE9PXQuYXZhaWxfaW58fG4uc3RhdHVzPT09X2QmJjQhPT1lKXJldHVybiBnZCh0LDA9PT10LmF2YWlsX291dD8tNTpsZCk7aWYobi5zdHJtPXQscj1uLmxhc3RfZmx1c2gsbi5sYXN0X2ZsdXNoPWUsNDI9PT1uLnN0YXR1cylpZigyPT09bi53cmFwKXQuYWRsZXI9MCx3ZChuLDMxKSx3ZChuLDEzOSksd2Qobiw4KSxuLmd6aGVhZD8od2Qobiwobi5nemhlYWQudGV4dD8xOjApKyhuLmd6aGVhZC5oY3JjPzI6MCkrKG4uZ3poZWFkLmV4dHJhPzQ6MCkrKG4uZ3poZWFkLm5hbWU/ODowKSsobi5nemhlYWQuY29tbWVudD8xNjowKSksd2QobiwyNTUmbi5nemhlYWQudGltZSksd2QobixuLmd6aGVhZC50aW1lPj44JjI1NSksd2QobixuLmd6aGVhZC50aW1lPj4xNiYyNTUpLHdkKG4sbi5nemhlYWQudGltZT4+MjQmMjU1KSx3ZChuLDk9PT1uLmxldmVsPzI6bi5zdHJhdGVneT49Mnx8bi5sZXZlbDwyPzQ6MCksd2QobiwyNTUmbi5nemhlYWQub3MpLG4uZ3poZWFkLmV4dHJhJiZuLmd6aGVhZC5leHRyYS5sZW5ndGgmJih3ZChuLDI1NSZuLmd6aGVhZC5leHRyYS5sZW5ndGgpLHdkKG4sbi5nemhlYWQuZXh0cmEubGVuZ3RoPj44JjI1NSkpLG4uZ3poZWFkLmhjcmMmJih0LmFkbGVyPWNkKHQuYWRsZXIsbi5wZW5kaW5nX2J1ZixuLnBlbmRpbmcsMCkpLG4uZ3ppbmRleD0wLG4uc3RhdHVzPTY5KTood2QobiwwKSx3ZChuLDApLHdkKG4sMCksd2QobiwwKSx3ZChuLDApLHdkKG4sOT09PW4ubGV2ZWw/MjpuLnN0cmF0ZWd5Pj0yfHxuLmxldmVsPDI/NDowKSx3ZChuLDMpLG4uc3RhdHVzPXBkKTtlbHNle3ZhciBzPTgrKG4ud19iaXRzLTg8PDQpPDw4O3N8PShuLnN0cmF0ZWd5Pj0yfHxuLmxldmVsPDI/MDpuLmxldmVsPDY/MTo2PT09bi5sZXZlbD8yOjMpPDw2LDAhPT1uLnN0cnN0YXJ0JiYoc3w9MzIpLHMrPTMxLXMlMzEsbi5zdGF0dXM9cGQsU2QobixzKSwwIT09bi5zdHJzdGFydCYmKFNkKG4sdC5hZGxlcj4+PjE2KSxTZChuLDY1NTM1JnQuYWRsZXIpKSx0LmFkbGVyPTF9aWYoNjk9PT1uLnN0YXR1cylpZihuLmd6aGVhZC5leHRyYSl7Zm9yKGk9bi5wZW5kaW5nO24uZ3ppbmRleDwoNjU1MzUmbi5nemhlYWQuZXh0cmEubGVuZ3RoKSYmKG4ucGVuZGluZyE9PW4ucGVuZGluZ19idWZfc2l6ZXx8KG4uZ3poZWFkLmhjcmMmJm4ucGVuZGluZz5pJiYodC5hZGxlcj1jZCh0LmFkbGVyLG4ucGVuZGluZ19idWYsbi5wZW5kaW5nLWksaSkpLHZkKHQpLGk9bi5wZW5kaW5nLG4ucGVuZGluZyE9PW4ucGVuZGluZ19idWZfc2l6ZSkpOyl3ZChuLDI1NSZuLmd6aGVhZC5leHRyYVtuLmd6aW5kZXhdKSxuLmd6aW5kZXgrKztuLmd6aGVhZC5oY3JjJiZuLnBlbmRpbmc+aSYmKHQuYWRsZXI9Y2QodC5hZGxlcixuLnBlbmRpbmdfYnVmLG4ucGVuZGluZy1pLGkpKSxuLmd6aW5kZXg9PT1uLmd6aGVhZC5leHRyYS5sZW5ndGgmJihuLmd6aW5kZXg9MCxuLnN0YXR1cz03Myl9ZWxzZSBuLnN0YXR1cz03MztpZig3Mz09PW4uc3RhdHVzKWlmKG4uZ3poZWFkLm5hbWUpe2k9bi5wZW5kaW5nO2Rve2lmKG4ucGVuZGluZz09PW4ucGVuZGluZ19idWZfc2l6ZSYmKG4uZ3poZWFkLmhjcmMmJm4ucGVuZGluZz5pJiYodC5hZGxlcj1jZCh0LmFkbGVyLG4ucGVuZGluZ19idWYsbi5wZW5kaW5nLWksaSkpLHZkKHQpLGk9bi5wZW5kaW5nLG4ucGVuZGluZz09PW4ucGVuZGluZ19idWZfc2l6ZSkpe289MTticmVha31vPW4uZ3ppbmRleDxuLmd6aGVhZC5uYW1lLmxlbmd0aD8yNTUmbi5nemhlYWQubmFtZS5jaGFyQ29kZUF0KG4uZ3ppbmRleCsrKTowLHdkKG4sbyl9d2hpbGUoMCE9PW8pO24uZ3poZWFkLmhjcmMmJm4ucGVuZGluZz5pJiYodC5hZGxlcj1jZCh0LmFkbGVyLG4ucGVuZGluZ19idWYsbi5wZW5kaW5nLWksaSkpLDA9PT1vJiYobi5nemluZGV4PTAsbi5zdGF0dXM9OTEpfWVsc2Ugbi5zdGF0dXM9OTE7aWYoOTE9PT1uLnN0YXR1cylpZihuLmd6aGVhZC5jb21tZW50KXtpPW4ucGVuZGluZztkb3tpZihuLnBlbmRpbmc9PT1uLnBlbmRpbmdfYnVmX3NpemUmJihuLmd6aGVhZC5oY3JjJiZuLnBlbmRpbmc+aSYmKHQuYWRsZXI9Y2QodC5hZGxlcixuLnBlbmRpbmdfYnVmLG4ucGVuZGluZy1pLGkpKSx2ZCh0KSxpPW4ucGVuZGluZyxuLnBlbmRpbmc9PT1uLnBlbmRpbmdfYnVmX3NpemUpKXtvPTE7YnJlYWt9bz1uLmd6aW5kZXg8bi5nemhlYWQuY29tbWVudC5sZW5ndGg/MjU1Jm4uZ3poZWFkLmNvbW1lbnQuY2hhckNvZGVBdChuLmd6aW5kZXgrKyk6MCx3ZChuLG8pfXdoaWxlKDAhPT1vKTtuLmd6aGVhZC5oY3JjJiZuLnBlbmRpbmc+aSYmKHQuYWRsZXI9Y2QodC5hZGxlcixuLnBlbmRpbmdfYnVmLG4ucGVuZGluZy1pLGkpKSwwPT09byYmKG4uc3RhdHVzPWRkKX1lbHNlIG4uc3RhdHVzPWRkO2lmKG4uc3RhdHVzPT09ZGQmJihuLmd6aGVhZC5oY3JjPyhuLnBlbmRpbmcrMj5uLnBlbmRpbmdfYnVmX3NpemUmJnZkKHQpLG4ucGVuZGluZysyPD1uLnBlbmRpbmdfYnVmX3NpemUmJih3ZChuLDI1NSZ0LmFkbGVyKSx3ZChuLHQuYWRsZXI+PjgmMjU1KSx0LmFkbGVyPTAsbi5zdGF0dXM9cGQpKTpuLnN0YXR1cz1wZCksMCE9PW4ucGVuZGluZyl7aWYodmQodCksMD09PXQuYXZhaWxfb3V0KXJldHVybiBuLmxhc3RfZmx1c2g9LTEsMH1lbHNlIGlmKDA9PT10LmF2YWlsX2luJiZtZChlKTw9bWQocikmJjQhPT1lKXJldHVybiBnZCh0LC01KTtpZihuLnN0YXR1cz09PV9kJiYwIT09dC5hdmFpbF9pbilyZXR1cm4gZ2QodCwtNSk7aWYoMCE9PXQuYXZhaWxfaW58fDAhPT1uLmxvb2thaGVhZHx8MCE9PWUmJm4uc3RhdHVzIT09X2Qpe3ZhciBhPTI9PT1uLnN0cmF0ZWd5P2Z1bmN0aW9uKHQsZSl7Zm9yKHZhciByOzspe2lmKDA9PT10Lmxvb2thaGVhZCYmKE9kKHQpLDA9PT10Lmxvb2thaGVhZCkpe2lmKDA9PT1lKXJldHVybiAxO2JyZWFrfWlmKHQubWF0Y2hfbGVuZ3RoPTAscj1zZC5fdHJfdGFsbHkodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyxyJiYoYmQodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxfXJldHVybiB0Lmluc2VydD0wLDQ9PT1lPyhiZCh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD8zOjQpOnQubGFzdF9saXQmJihiZCh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCk/MToyfShuLGUpOjM9PT1uLnN0cmF0ZWd5P2Z1bmN0aW9uKHQsZSl7Zm9yKHZhciByLG4saSxvLHM9dC53aW5kb3c7Oyl7aWYodC5sb29rYWhlYWQ8PWhkKXtpZihPZCh0KSx0Lmxvb2thaGVhZDw9aGQmJjA9PT1lKXJldHVybiAxO2lmKDA9PT10Lmxvb2thaGVhZClicmVha31pZih0Lm1hdGNoX2xlbmd0aD0wLHQubG9va2FoZWFkPj0zJiZ0LnN0cnN0YXJ0PjAmJihuPXNbaT10LnN0cnN0YXJ0LTFdKT09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSl7bz10LnN0cnN0YXJ0K2hkO2Rve313aGlsZShuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZpPG8pO3QubWF0Y2hfbGVuZ3RoPWhkLShvLWkpLHQubWF0Y2hfbGVuZ3RoPnQubG9va2FoZWFkJiYodC5tYXRjaF9sZW5ndGg9dC5sb29rYWhlYWQpfWlmKHQubWF0Y2hfbGVuZ3RoPj0zPyhyPXNkLl90cl90YWxseSh0LDEsdC5tYXRjaF9sZW5ndGgtMyksdC5sb29rYWhlYWQtPXQubWF0Y2hfbGVuZ3RoLHQuc3Ryc3RhcnQrPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPTApOihyPXNkLl90cl90YWxseSh0LDAsdC53aW5kb3dbdC5zdHJzdGFydF0pLHQubG9va2FoZWFkLS0sdC5zdHJzdGFydCsrKSxyJiYoYmQodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiAxfXJldHVybiB0Lmluc2VydD0wLDQ9PT1lPyhiZCh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD8zOjQpOnQubGFzdF9saXQmJihiZCh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCk/MToyfShuLGUpOnJkW24ubGV2ZWxdLmZ1bmMobixlKTtpZigzIT09YSYmNCE9PWF8fChuLnN0YXR1cz1fZCksMT09PWF8fDM9PT1hKXJldHVybiAwPT09dC5hdmFpbF9vdXQmJihuLmxhc3RfZmx1c2g9LTEpLDA7aWYoMj09PWEmJigxPT09ZT9zZC5fdHJfYWxpZ24obik6NSE9PWUmJihzZC5fdHJfc3RvcmVkX2Jsb2NrKG4sMCwwLCExKSwzPT09ZSYmKHlkKG4uaGVhZCksMD09PW4ubG9va2FoZWFkJiYobi5zdHJzdGFydD0wLG4uYmxvY2tfc3RhcnQ9MCxuLmluc2VydD0wKSkpLHZkKHQpLDA9PT10LmF2YWlsX291dCkpcmV0dXJuIG4ubGFzdF9mbHVzaD0tMSwwfXJldHVybiA0IT09ZT8wOm4ud3JhcDw9MD8xOigyPT09bi53cmFwPyh3ZChuLDI1NSZ0LmFkbGVyKSx3ZChuLHQuYWRsZXI+PjgmMjU1KSx3ZChuLHQuYWRsZXI+PjE2JjI1NSksd2Qobix0LmFkbGVyPj4yNCYyNTUpLHdkKG4sMjU1JnQudG90YWxfaW4pLHdkKG4sdC50b3RhbF9pbj4+OCYyNTUpLHdkKG4sdC50b3RhbF9pbj4+MTYmMjU1KSx3ZChuLHQudG90YWxfaW4+PjI0JjI1NSkpOihTZChuLHQuYWRsZXI+Pj4xNiksU2Qobiw2NTUzNSZ0LmFkbGVyKSksdmQodCksbi53cmFwPjAmJihuLndyYXA9LW4ud3JhcCksMCE9PW4ucGVuZGluZz8wOjEpfSxfZi5kZWZsYXRlRW5kPWZ1bmN0aW9uKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPzQyIT09KGU9dC5zdGF0ZS5zdGF0dXMpJiY2OSE9PWUmJjczIT09ZSYmOTEhPT1lJiZlIT09ZGQmJmUhPT1wZCYmZSE9PV9kP2dkKHQsbGQpOih0LnN0YXRlPW51bGwsZT09PXBkP2dkKHQsLTMpOjApOmxkfSxfZi5kZWZsYXRlU2V0RGljdGlvbmFyeT1mdW5jdGlvbih0LGUpe3ZhciByLG4saSxvLHMsYSxjLHUsbD1lLmxlbmd0aDtpZighdHx8IXQuc3RhdGUpcmV0dXJuIGxkO2lmKDI9PT0obz0ocj10LnN0YXRlKS53cmFwKXx8MT09PW8mJjQyIT09ci5zdGF0dXN8fHIubG9va2FoZWFkKXJldHVybiBsZDtmb3IoMT09PW8mJih0LmFkbGVyPWFkKHQuYWRsZXIsZSxsLDApKSxyLndyYXA9MCxsPj1yLndfc2l6ZSYmKDA9PT1vJiYoeWQoci5oZWFkKSxyLnN0cnN0YXJ0PTAsci5ibG9ja19zdGFydD0wLHIuaW5zZXJ0PTApLHU9bmV3IG9kLkJ1Zjgoci53X3NpemUpLG9kLmFycmF5U2V0KHUsZSxsLXIud19zaXplLHIud19zaXplLDApLGU9dSxsPXIud19zaXplKSxzPXQuYXZhaWxfaW4sYT10Lm5leHRfaW4sYz10LmlucHV0LHQuYXZhaWxfaW49bCx0Lm5leHRfaW49MCx0LmlucHV0PWUsT2Qocik7ci5sb29rYWhlYWQ+PTM7KXtuPXIuc3Ryc3RhcnQsaT1yLmxvb2thaGVhZC0yO2Rve3IuaW5zX2g9KHIuaW5zX2g8PHIuaGFzaF9zaGlmdF5yLndpbmRvd1tuKzMtMV0pJnIuaGFzaF9tYXNrLHIucHJldltuJnIud19tYXNrXT1yLmhlYWRbci5pbnNfaF0sci5oZWFkW3IuaW5zX2hdPW4sbisrfXdoaWxlKC0taSk7ci5zdHJzdGFydD1uLHIubG9va2FoZWFkPTIsT2Qocil9cmV0dXJuIHIuc3Ryc3RhcnQrPXIubG9va2FoZWFkLHIuYmxvY2tfc3RhcnQ9ci5zdHJzdGFydCxyLmluc2VydD1yLmxvb2thaGVhZCxyLmxvb2thaGVhZD0wLHIubWF0Y2hfbGVuZ3RoPXIucHJldl9sZW5ndGg9MixyLm1hdGNoX2F2YWlsYWJsZT0wLHQubmV4dF9pbj1hLHQuaW5wdXQ9Yyx0LmF2YWlsX2luPXMsci53cmFwPW8sMH0sX2YuZGVmbGF0ZUluZm89InBha28gZGVmbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkiO3ZhciBCZD17fSxOZD1kZixSZD0hMCx6ZD0hMDt0cnl7U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLFswXSl9Y2F0Y2goWGcpe1JkPSExfXRyeXtTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbmV3IFVpbnQ4QXJyYXkoMSkpfWNhdGNoKFhnKXt6ZD0hMX1mb3IodmFyIERkPW5ldyBOZC5CdWY4KDI1NiksUGQ9MDtQZDwyNTY7UGQrKylEZFtQZF09UGQ+PTI1Mj82OlBkPj0yNDg/NTpQZD49MjQwPzQ6UGQ+PTIyND8zOlBkPj0xOTI/MjoxO2Z1bmN0aW9uIE1kKHQsZSl7aWYoZTw2NTUzNCYmKHQuc3ViYXJyYXkmJnpkfHwhdC5zdWJhcnJheSYmUmQpKXJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsTmQuc2hyaW5rQnVmKHQsZSkpO2Zvcih2YXIgcj0iIixuPTA7bjxlO24rKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbbl0pO3JldHVybiByfURkWzI1NF09RGRbMjU0XT0xLEJkLnN0cmluZzJidWY9ZnVuY3Rpb24odCl7dmFyIGUscixuLGksbyxzPXQubGVuZ3RoLGE9MDtmb3IoaT0wO2k8cztpKyspNTUyOTY9PSg2NDUxMiYocj10LmNoYXJDb2RlQXQoaSkpKSYmaSsxPHMmJjU2MzIwPT0oNjQ1MTImKG49dC5jaGFyQ29kZUF0KGkrMSkpKSYmKHI9NjU1MzYrKHItNTUyOTY8PDEwKSsobi01NjMyMCksaSsrKSxhKz1yPDEyOD8xOnI8MjA0OD8yOnI8NjU1MzY/Mzo0O2ZvcihlPW5ldyBOZC5CdWY4KGEpLG89MCxpPTA7bzxhO2krKyk1NTI5Nj09KDY0NTEyJihyPXQuY2hhckNvZGVBdChpKSkpJiZpKzE8cyYmNTYzMjA9PSg2NDUxMiYobj10LmNoYXJDb2RlQXQoaSsxKSkpJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspLHI8MTI4P2VbbysrXT1yOnI8MjA0OD8oZVtvKytdPTE5MnxyPj4+NixlW28rK109MTI4fDYzJnIpOnI8NjU1MzY/KGVbbysrXT0yMjR8cj4+PjEyLGVbbysrXT0xMjh8cj4+PjYmNjMsZVtvKytdPTEyOHw2MyZyKTooZVtvKytdPTI0MHxyPj4+MTgsZVtvKytdPTEyOHxyPj4+MTImNjMsZVtvKytdPTEyOHxyPj4+NiY2MyxlW28rK109MTI4fDYzJnIpO3JldHVybiBlfSxCZC5idWYyYmluc3RyaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBNZCh0LHQubGVuZ3RoKX0sQmQuYmluc3RyaW5nMmJ1Zj1mdW5jdGlvbih0KXtmb3IodmFyIGU9bmV3IE5kLkJ1ZjgodC5sZW5ndGgpLHI9MCxuPWUubGVuZ3RoO3I8bjtyKyspZVtyXT10LmNoYXJDb2RlQXQocik7cmV0dXJuIGV9LEJkLmJ1ZjJzdHJpbmc9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzPWV8fHQubGVuZ3RoLGE9bmV3IEFycmF5KDIqcyk7Zm9yKG49MCxyPTA7cjxzOylpZigoaT10W3IrK10pPDEyOClhW24rK109aTtlbHNlIGlmKChvPURkW2ldKT40KWFbbisrXT02NTUzMyxyKz1vLTE7ZWxzZXtmb3IoaSY9Mj09PW8/MzE6Mz09PW8/MTU6NztvPjEmJnI8czspaT1pPDw2fDYzJnRbcisrXSxvLS07bz4xP2FbbisrXT02NTUzMzppPDY1NTM2P2FbbisrXT1pOihpLT02NTUzNixhW24rK109NTUyOTZ8aT4+MTAmMTAyMyxhW24rK109NTYzMjB8MTAyMyZpKX1yZXR1cm4gTWQoYSxuKX0sQmQudXRmOGJvcmRlcj1mdW5jdGlvbih0LGUpe3ZhciByO2ZvcigoZT1lfHx0Lmxlbmd0aCk+dC5sZW5ndGgmJihlPXQubGVuZ3RoKSxyPWUtMTtyPj0wJiYxMjg9PSgxOTImdFtyXSk7KXItLTtyZXR1cm4gcjwwfHwwPT09cj9lOnIrRGRbdFtyXV0+ZT9yOmV9O3ZhciBGZD1mdW5jdGlvbigpe3RoaXMuaW5wdXQ9bnVsbCx0aGlzLm5leHRfaW49MCx0aGlzLmF2YWlsX2luPTAsdGhpcy50b3RhbF9pbj0wLHRoaXMub3V0cHV0PW51bGwsdGhpcy5uZXh0X291dD0wLHRoaXMuYXZhaWxfb3V0PTAsdGhpcy50b3RhbF9vdXQ9MCx0aGlzLm1zZz0iIix0aGlzLnN0YXRlPW51bGwsdGhpcy5kYXRhX3R5cGU9Mix0aGlzLmFkbGVyPTB9LGpkPV9mLFVkPWRmLEhkPUJkLEtkPWlkLEpkPUZkLFdkPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7ZnVuY3Rpb24gWmQodCl7aWYoISh0aGlzIGluc3RhbmNlb2YgWmQpKXJldHVybiBuZXcgWmQodCk7dGhpcy5vcHRpb25zPVVkLmFzc2lnbih7bGV2ZWw6LTEsbWV0aG9kOjgsY2h1bmtTaXplOjE2Mzg0LHdpbmRvd0JpdHM6MTUsbWVtTGV2ZWw6OCxzdHJhdGVneTowLHRvOiIifSx0fHx7fSk7dmFyIGU9dGhpcy5vcHRpb25zO2UucmF3JiZlLndpbmRvd0JpdHM+MD9lLndpbmRvd0JpdHM9LWUud2luZG93Qml0czplLmd6aXAmJmUud2luZG93Qml0cz4wJiZlLndpbmRvd0JpdHM8MTYmJihlLndpbmRvd0JpdHMrPTE2KSx0aGlzLmVycj0wLHRoaXMubXNnPSIiLHRoaXMuZW5kZWQ9ITEsdGhpcy5jaHVua3M9W10sdGhpcy5zdHJtPW5ldyBKZCx0aGlzLnN0cm0uYXZhaWxfb3V0PTA7dmFyIHI9amQuZGVmbGF0ZUluaXQyKHRoaXMuc3RybSxlLmxldmVsLGUubWV0aG9kLGUud2luZG93Qml0cyxlLm1lbUxldmVsLGUuc3RyYXRlZ3kpO2lmKDAhPT1yKXRocm93IG5ldyBFcnJvcihLZFtyXSk7aWYoZS5oZWFkZXImJmpkLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLGUuaGVhZGVyKSxlLmRpY3Rpb25hcnkpe3ZhciBuO2lmKG49InN0cmluZyI9PXR5cGVvZiBlLmRpY3Rpb25hcnk/SGQuc3RyaW5nMmJ1ZihlLmRpY3Rpb25hcnkpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT1XZC5jYWxsKGUuZGljdGlvbmFyeSk/bmV3IFVpbnQ4QXJyYXkoZS5kaWN0aW9uYXJ5KTplLmRpY3Rpb25hcnksMCE9PShyPWpkLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSxuKSkpdGhyb3cgbmV3IEVycm9yKEtkW3JdKTt0aGlzLl9kaWN0X3NldD0hMH19ZnVuY3Rpb24gR2QodCxlKXt2YXIgcj1uZXcgWmQoZSk7aWYoci5wdXNoKHQsITApLHIuZXJyKXRocm93IHIubXNnfHxLZFtyLmVycl07cmV0dXJuIHIucmVzdWx0fVpkLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKHQsZSl7dmFyIHIsbixpPXRoaXMuc3RybSxvPXRoaXMub3B0aW9ucy5jaHVua1NpemU7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtuPWU9PT1+fmU/ZTohMD09PWU/NDowLCJzdHJpbmciPT10eXBlb2YgdD9pLmlucHV0PUhkLnN0cmluZzJidWYodCk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PVdkLmNhbGwodCk/aS5pbnB1dD1uZXcgVWludDhBcnJheSh0KTppLmlucHV0PXQsaS5uZXh0X2luPTAsaS5hdmFpbF9pbj1pLmlucHV0Lmxlbmd0aDtkb3tpZigwPT09aS5hdmFpbF9vdXQmJihpLm91dHB1dD1uZXcgVWQuQnVmOChvKSxpLm5leHRfb3V0PTAsaS5hdmFpbF9vdXQ9byksMSE9PShyPWpkLmRlZmxhdGUoaSxuKSkmJjAhPT1yKXJldHVybiB0aGlzLm9uRW5kKHIpLHRoaXMuZW5kZWQ9ITAsITE7MCE9PWkuYXZhaWxfb3V0JiYoMCE9PWkuYXZhaWxfaW58fDQhPT1uJiYyIT09bil8fCgic3RyaW5nIj09PXRoaXMub3B0aW9ucy50bz90aGlzLm9uRGF0YShIZC5idWYyYmluc3RyaW5nKFVkLnNocmlua0J1ZihpLm91dHB1dCxpLm5leHRfb3V0KSkpOnRoaXMub25EYXRhKFVkLnNocmlua0J1ZihpLm91dHB1dCxpLm5leHRfb3V0KSkpfXdoaWxlKChpLmF2YWlsX2luPjB8fDA9PT1pLmF2YWlsX291dCkmJjEhPT1yKTtyZXR1cm4gND09PW4/KHI9amQuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLHRoaXMub25FbmQociksdGhpcy5lbmRlZD0hMCwwPT09cik6MiE9PW58fCh0aGlzLm9uRW5kKDApLGkuYXZhaWxfb3V0PTAsITApfSxaZC5wcm90b3R5cGUub25EYXRhPWZ1bmN0aW9uKHQpe3RoaXMuY2h1bmtzLnB1c2godCl9LFpkLnByb3RvdHlwZS5vbkVuZD1mdW5jdGlvbih0KXswPT09dCYmKCJzdHJpbmciPT09dGhpcy5vcHRpb25zLnRvP3RoaXMucmVzdWx0PXRoaXMuY2h1bmtzLmpvaW4oIiIpOnRoaXMucmVzdWx0PVVkLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9LHBmLkRlZmxhdGU9WmQscGYuZGVmbGF0ZT1HZCxwZi5kZWZsYXRlUmF3PWZ1bmN0aW9uKHQsZSl7cmV0dXJuKGU9ZXx8e30pLnJhdz0hMCxHZCh0LGUpfSxwZi5nemlwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuKGU9ZXx8e30pLmd6aXA9ITAsR2QodCxlKX07dmFyIFZkPXt9LCRkPW90LFhkPWZ1bmN0aW9uKHQpe3ZhciBlPXQuZmxhZ3M7cmV0dXJuIHZvaWQgMCE9PWV8fCJmbGFncyJpbiBPbHx8d2wodCwiZmxhZ3MiKXx8IVNsKE9sLHQpP2U6Ymwoa2wsdCl9LFlkPVJlZ0V4cC5wcm90b3R5cGUscWQ9ZSgoZnVuY3Rpb24odCl7cmV0dXJuIHQ9PT1ZZHx8JGQoWWQsdCk/WGQodCk6dC5mbGFnc30pKSxRZD17fSx0cD1kZixlcD0xNSxycD1bMyw0LDUsNiw3LDgsOSwxMCwxMSwxMywxNSwxNywxOSwyMywyNywzMSwzNSw0Myw1MSw1OSw2Nyw4Myw5OSwxMTUsMTMxLDE2MywxOTUsMjI3LDI1OCwwLDBdLG5wPVsxNiwxNiwxNiwxNiwxNiwxNiwxNiwxNiwxNywxNywxNywxNywxOCwxOCwxOCwxOCwxOSwxOSwxOSwxOSwyMCwyMCwyMCwyMCwyMSwyMSwyMSwyMSwxNiw3Miw3OF0saXA9WzEsMiwzLDQsNSw3LDksMTMsMTcsMjUsMzMsNDksNjUsOTcsMTI5LDE5MywyNTcsMzg1LDUxMyw3NjksMTAyNSwxNTM3LDIwNDksMzA3Myw0MDk3LDYxNDUsODE5MywxMjI4OSwxNjM4NSwyNDU3NywwLDBdLG9wPVsxNiwxNiwxNiwxNiwxNywxNywxOCwxOCwxOSwxOSwyMCwyMCwyMSwyMSwyMiwyMiwyMywyMywyNCwyNCwyNSwyNSwyNiwyNiwyNywyNywyOCwyOCwyOSwyOSw2NCw2NF0sc3A9ZGYsYXA9dGQsY3A9bmQsdXA9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYyx1LGwsaCxmLGQscCxfLGcsbSx5LHYsYix3LFMsayxPLHgsRTtyPXQuc3RhdGUsbj10Lm5leHRfaW4seD10LmlucHV0LGk9bisodC5hdmFpbF9pbi01KSxvPXQubmV4dF9vdXQsRT10Lm91dHB1dCxzPW8tKGUtdC5hdmFpbF9vdXQpLGE9bysodC5hdmFpbF9vdXQtMjU3KSxjPXIuZG1heCx1PXIud3NpemUsbD1yLndoYXZlLGg9ci53bmV4dCxmPXIud2luZG93LGQ9ci5ob2xkLHA9ci5iaXRzLF89ci5sZW5jb2RlLGc9ci5kaXN0Y29kZSxtPSgxPDxyLmxlbmJpdHMpLTEseT0oMTw8ci5kaXN0Yml0cyktMTt0OmRve3A8MTUmJihkKz14W24rK108PHAscCs9OCxkKz14W24rK108PHAscCs9OCksdj1fW2QmbV07ZTpmb3IoOzspe2lmKGQ+Pj49Yj12Pj4+MjQscC09YiwwPT09KGI9dj4+PjE2JjI1NSkpRVtvKytdPTY1NTM1JnY7ZWxzZXtpZighKDE2JmIpKXtpZig2NCZiKXtpZigzMiZiKXtyLm1vZGU9MTI7YnJlYWsgdH10Lm1zZz0iaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIixyLm1vZGU9MzA7YnJlYWsgdH12PV9bKDY1NTM1JnYpKyhkJigxPDxiKS0xKV07Y29udGludWUgZX1mb3Iodz02NTUzNSZ2LChiJj0xNSkmJihwPGImJihkKz14W24rK108PHAscCs9OCksdys9ZCYoMTw8YiktMSxkPj4+PWIscC09YikscDwxNSYmKGQrPXhbbisrXTw8cCxwKz04LGQrPXhbbisrXTw8cCxwKz04KSx2PWdbZCZ5XTs7KXtpZihkPj4+PWI9dj4+PjI0LHAtPWIsMTYmKGI9dj4+PjE2JjI1NSkpe2lmKFM9NjU1MzUmdixwPChiJj0xNSkmJihkKz14W24rK108PHAsKHArPTgpPGImJihkKz14W24rK108PHAscCs9OCkpLChTKz1kJigxPDxiKS0xKT5jKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLHIubW9kZT0zMDticmVhayB0fWlmKGQ+Pj49YixwLT1iLFM+KGI9by1zKSl7aWYoKGI9Uy1iKT5sJiZyLnNhbmUpe3QubXNnPSJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsci5tb2RlPTMwO2JyZWFrIHR9aWYoaz0wLE89ZiwwPT09aCl7aWYoays9dS1iLGI8dyl7dy09Yjtkb3tFW28rK109ZltrKytdfXdoaWxlKC0tYik7az1vLVMsTz1FfX1lbHNlIGlmKGg8Yil7aWYoays9dStoLWIsKGItPWgpPHcpe3ctPWI7ZG97RVtvKytdPWZbaysrXX13aGlsZSgtLWIpO2lmKGs9MCxoPHcpe3ctPWI9aDtkb3tFW28rK109ZltrKytdfXdoaWxlKC0tYik7az1vLVMsTz1FfX19ZWxzZSBpZihrKz1oLWIsYjx3KXt3LT1iO2Rve0VbbysrXT1mW2srK119d2hpbGUoLS1iKTtrPW8tUyxPPUV9Zm9yKDt3PjI7KUVbbysrXT1PW2srK10sRVtvKytdPU9baysrXSxFW28rK109T1trKytdLHctPTM7dyYmKEVbbysrXT1PW2srK10sdz4xJiYoRVtvKytdPU9baysrXSkpfWVsc2V7az1vLVM7ZG97RVtvKytdPUVbaysrXSxFW28rK109RVtrKytdLEVbbysrXT1FW2srK10sdy09M313aGlsZSh3PjIpO3cmJihFW28rK109RVtrKytdLHc+MSYmKEVbbysrXT1FW2srK10pKX1icmVha31pZig2NCZiKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZSBjb2RlIixyLm1vZGU9MzA7YnJlYWsgdH12PWdbKDY1NTM1JnYpKyhkJigxPDxiKS0xKV19fWJyZWFrfX13aGlsZShuPGkmJm88YSk7bi09dz1wPj4zLGQmPSgxPDwocC09dzw8MykpLTEsdC5uZXh0X2luPW4sdC5uZXh0X291dD1vLHQuYXZhaWxfaW49bjxpP2ktbis1OjUtKG4taSksdC5hdmFpbF9vdXQ9bzxhP2EtbysyNTc6MjU3LShvLWEpLHIuaG9sZD1kLHIuYml0cz1wfSxscD1mdW5jdGlvbih0LGUscixuLGksbyxzLGEpe3ZhciBjLHUsbCxoLGYsZCxwLF8sZyxtPWEuYml0cyx5PTAsdj0wLGI9MCx3PTAsUz0wLGs9MCxPPTAseD0wLEU9MCxBPTAsQz1udWxsLEk9MCxUPW5ldyB0cC5CdWYxNigxNiksTD1uZXcgdHAuQnVmMTYoMTYpLEI9bnVsbCxOPTA7Zm9yKHk9MDt5PD1lcDt5KyspVFt5XT0wO2Zvcih2PTA7djxuO3YrKylUW2Vbcit2XV0rKztmb3IoUz1tLHc9ZXA7dz49MSYmMD09PVRbd107dy0tKTtpZihTPncmJihTPXcpLDA9PT13KXJldHVybiBpW28rK109MjA5NzE1MjAsaVtvKytdPTIwOTcxNTIwLGEuYml0cz0xLDA7Zm9yKGI9MTtiPHcmJjA9PT1UW2JdO2IrKyk7Zm9yKFM8YiYmKFM9YikseD0xLHk9MTt5PD1lcDt5KyspaWYoeDw8PTEsKHgtPVRbeV0pPDApcmV0dXJuLTE7aWYoeD4wJiYoMD09PXR8fDEhPT13KSlyZXR1cm4tMTtmb3IoTFsxXT0wLHk9MTt5PGVwO3krKylMW3krMV09TFt5XStUW3ldO2Zvcih2PTA7djxuO3YrKykwIT09ZVtyK3ZdJiYoc1tMW2Vbcit2XV0rK109dik7aWYoMD09PXQ/KEM9Qj1zLGQ9MTkpOjE9PT10PyhDPXJwLEktPTI1NyxCPW5wLE4tPTI1NyxkPTI1Nik6KEM9aXAsQj1vcCxkPS0xKSxBPTAsdj0wLHk9YixmPW8saz1TLE89MCxsPS0xLGg9KEU9MTw8UyktMSwxPT09dCYmRT44NTJ8fDI9PT10JiZFPjU5MilyZXR1cm4gMTtmb3IoOzspe3A9eS1PLHNbdl08ZD8oXz0wLGc9c1t2XSk6c1t2XT5kPyhfPUJbTitzW3ZdXSxnPUNbSStzW3ZdXSk6KF89OTYsZz0wKSxjPTE8PHktTyxiPXU9MTw8aztkb3tpW2YrKEE+Pk8pKyh1LT1jKV09cDw8MjR8Xzw8MTZ8Z313aGlsZSgwIT09dSk7Zm9yKGM9MTw8eS0xO0EmYzspYz4+PTE7aWYoMCE9PWM/KEEmPWMtMSxBKz1jKTpBPTAsdisrLDA9PS0tVFt5XSl7aWYoeT09PXcpYnJlYWs7eT1lW3Irc1t2XV19aWYoeT5TJiYoQSZoKSE9PWwpe2ZvcigwPT09TyYmKE89UyksZis9Yix4PTE8PChrPXktTyk7aytPPHcmJiEoKHgtPVRbaytPXSk8PTApOylrKysseDw8PTE7aWYoRSs9MTw8aywxPT09dCYmRT44NTJ8fDI9PT10JiZFPjU5MilyZXR1cm4gMTtpW2w9QSZoXT1TPDwyNHxrPDwxNnxmLW99fXJldHVybiAwIT09QSYmKGlbZitBXT15LU88PDI0fDY0PDwxNiksYS5iaXRzPVMsMH0saHA9LTIsZnA9MTIsZHA9MzA7ZnVuY3Rpb24gcHAodCl7cmV0dXJuKHQ+Pj4yNCYyNTUpKyh0Pj4+OCY2NTI4MCkrKCg2NTI4MCZ0KTw8OCkrKCgyNTUmdCk8PDI0KX1mdW5jdGlvbiBfcCgpe3RoaXMubW9kZT0wLHRoaXMubGFzdD0hMSx0aGlzLndyYXA9MCx0aGlzLmhhdmVkaWN0PSExLHRoaXMuZmxhZ3M9MCx0aGlzLmRtYXg9MCx0aGlzLmNoZWNrPTAsdGhpcy50b3RhbD0wLHRoaXMuaGVhZD1udWxsLHRoaXMud2JpdHM9MCx0aGlzLndzaXplPTAsdGhpcy53aGF2ZT0wLHRoaXMud25leHQ9MCx0aGlzLndpbmRvdz1udWxsLHRoaXMuaG9sZD0wLHRoaXMuYml0cz0wLHRoaXMubGVuZ3RoPTAsdGhpcy5vZmZzZXQ9MCx0aGlzLmV4dHJhPTAsdGhpcy5sZW5jb2RlPW51bGwsdGhpcy5kaXN0Y29kZT1udWxsLHRoaXMubGVuYml0cz0wLHRoaXMuZGlzdGJpdHM9MCx0aGlzLm5jb2RlPTAsdGhpcy5ubGVuPTAsdGhpcy5uZGlzdD0wLHRoaXMuaGF2ZT0wLHRoaXMubmV4dD1udWxsLHRoaXMubGVucz1uZXcgc3AuQnVmMTYoMzIwKSx0aGlzLndvcms9bmV3IHNwLkJ1ZjE2KDI4OCksdGhpcy5sZW5keW49bnVsbCx0aGlzLmRpc3RkeW49bnVsbCx0aGlzLnNhbmU9MCx0aGlzLmJhY2s9MCx0aGlzLndhcz0wfWZ1bmN0aW9uIGdwKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPyhlPXQuc3RhdGUsdC50b3RhbF9pbj10LnRvdGFsX291dD1lLnRvdGFsPTAsdC5tc2c9IiIsZS53cmFwJiYodC5hZGxlcj0xJmUud3JhcCksZS5tb2RlPTEsZS5sYXN0PTAsZS5oYXZlZGljdD0wLGUuZG1heD0zMjc2OCxlLmhlYWQ9bnVsbCxlLmhvbGQ9MCxlLmJpdHM9MCxlLmxlbmNvZGU9ZS5sZW5keW49bmV3IHNwLkJ1ZjMyKDg1MiksZS5kaXN0Y29kZT1lLmRpc3RkeW49bmV3IHNwLkJ1ZjMyKDU5MiksZS5zYW5lPTEsZS5iYWNrPS0xLDApOmhwfWZ1bmN0aW9uIG1wKHQpe3ZhciBlO3JldHVybiB0JiZ0LnN0YXRlPygoZT10LnN0YXRlKS53c2l6ZT0wLGUud2hhdmU9MCxlLnduZXh0PTAsZ3AodCkpOmhwfWZ1bmN0aW9uIHlwKHQsZSl7dmFyIHIsbjtyZXR1cm4gdCYmdC5zdGF0ZT8obj10LnN0YXRlLGU8MD8ocj0wLGU9LWUpOihyPTErKGU+PjQpLGU8NDgmJihlJj0xNSkpLGUmJihlPDh8fGU+MTUpP2hwOihudWxsIT09bi53aW5kb3cmJm4ud2JpdHMhPT1lJiYobi53aW5kb3c9bnVsbCksbi53cmFwPXIsbi53Yml0cz1lLG1wKHQpKSk6aHB9ZnVuY3Rpb24gdnAodCxlKXt2YXIgcixuO3JldHVybiB0PyhuPW5ldyBfcCx0LnN0YXRlPW4sbi53aW5kb3c9bnVsbCwwIT09KHI9eXAodCxlKSkmJih0LnN0YXRlPW51bGwpLHIpOmhwfXZhciBicCx3cCxTcD0hMDtmdW5jdGlvbiBrcCh0KXtpZihTcCl7dmFyIGU7Zm9yKGJwPW5ldyBzcC5CdWYzMig1MTIpLHdwPW5ldyBzcC5CdWYzMigzMiksZT0wO2U8MTQ0Oyl0LmxlbnNbZSsrXT04O2Zvcig7ZTwyNTY7KXQubGVuc1tlKytdPTk7Zm9yKDtlPDI4MDspdC5sZW5zW2UrK109Nztmb3IoO2U8Mjg4Oyl0LmxlbnNbZSsrXT04O2ZvcihscCgxLHQubGVucywwLDI4OCxicCwwLHQud29yayx7Yml0czo5fSksZT0wO2U8MzI7KXQubGVuc1tlKytdPTU7bHAoMix0LmxlbnMsMCwzMix3cCwwLHQud29yayx7Yml0czo1fSksU3A9ITF9dC5sZW5jb2RlPWJwLHQubGVuYml0cz05LHQuZGlzdGNvZGU9d3AsdC5kaXN0Yml0cz01fWZ1bmN0aW9uIE9wKHQsZSxyLG4pe3ZhciBpLG89dC5zdGF0ZTtyZXR1cm4gbnVsbD09PW8ud2luZG93JiYoby53c2l6ZT0xPDxvLndiaXRzLG8ud25leHQ9MCxvLndoYXZlPTAsby53aW5kb3c9bmV3IHNwLkJ1Zjgoby53c2l6ZSkpLG4+PW8ud3NpemU/KHNwLmFycmF5U2V0KG8ud2luZG93LGUsci1vLndzaXplLG8ud3NpemUsMCksby53bmV4dD0wLG8ud2hhdmU9by53c2l6ZSk6KChpPW8ud3NpemUtby53bmV4dCk+biYmKGk9biksc3AuYXJyYXlTZXQoby53aW5kb3csZSxyLW4saSxvLnduZXh0KSwobi09aSk/KHNwLmFycmF5U2V0KG8ud2luZG93LGUsci1uLG4sMCksby53bmV4dD1uLG8ud2hhdmU9by53c2l6ZSk6KG8ud25leHQrPWksby53bmV4dD09PW8ud3NpemUmJihvLnduZXh0PTApLG8ud2hhdmU8by53c2l6ZSYmKG8ud2hhdmUrPWkpKSksMH1RZC5pbmZsYXRlUmVzZXQ9bXAsUWQuaW5mbGF0ZVJlc2V0Mj15cCxRZC5pbmZsYXRlUmVzZXRLZWVwPWdwLFFkLmluZmxhdGVJbml0PWZ1bmN0aW9uKHQpe3JldHVybiB2cCh0LDE1KX0sUWQuaW5mbGF0ZUluaXQyPXZwLFFkLmluZmxhdGU9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGEsYyx1LGwsaCxmLGQscCxfLGcsbSx5LHYsYix3LFMsayxPLHgsRT0wLEE9bmV3IHNwLkJ1ZjgoNCksQz1bMTYsMTcsMTgsMCw4LDcsOSw2LDEwLDUsMTEsNCwxMiwzLDEzLDIsMTQsMSwxNV07aWYoIXR8fCF0LnN0YXRlfHwhdC5vdXRwdXR8fCF0LmlucHV0JiYwIT09dC5hdmFpbF9pbilyZXR1cm4gaHA7KHI9dC5zdGF0ZSkubW9kZT09PWZwJiYoci5tb2RlPTEzKSxzPXQubmV4dF9vdXQsaT10Lm91dHB1dCxjPXQuYXZhaWxfb3V0LG89dC5uZXh0X2luLG49dC5pbnB1dCxhPXQuYXZhaWxfaW4sdT1yLmhvbGQsbD1yLmJpdHMsaD1hLGY9YyxrPTA7dDpmb3IoOzspc3dpdGNoKHIubW9kZSl7Y2FzZSAxOmlmKDA9PT1yLndyYXApe3IubW9kZT0xMzticmVha31mb3IoO2w8MTY7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZigyJnIud3JhcCYmMzU2MTU9PT11KXtyLmNoZWNrPTAsQVswXT0yNTUmdSxBWzFdPXU+Pj44JjI1NSxyLmNoZWNrPWNwKHIuY2hlY2ssQSwyLDApLHU9MCxsPTAsci5tb2RlPTI7YnJlYWt9aWYoci5mbGFncz0wLHIuaGVhZCYmKHIuaGVhZC5kb25lPSExKSwhKDEmci53cmFwKXx8KCgoMjU1JnUpPDw4KSsodT4+OCkpJTMxKXt0Lm1zZz0iaW5jb3JyZWN0IGhlYWRlciBjaGVjayIsci5tb2RlPWRwO2JyZWFrfWlmKDghPSgxNSZ1KSl7dC5tc2c9InVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIixyLm1vZGU9ZHA7YnJlYWt9aWYobC09NCxTPTgrKDE1Jih1Pj4+PTQpKSwwPT09ci53Yml0cylyLndiaXRzPVM7ZWxzZSBpZihTPnIud2JpdHMpe3QubXNnPSJpbnZhbGlkIHdpbmRvdyBzaXplIixyLm1vZGU9ZHA7YnJlYWt9ci5kbWF4PTE8PFMsdC5hZGxlcj1yLmNoZWNrPTEsci5tb2RlPTUxMiZ1PzEwOmZwLHU9MCxsPTA7YnJlYWs7Y2FzZSAyOmZvcig7bDwxNjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWlmKHIuZmxhZ3M9dSw4IT0oMjU1JnFkKHIpKSl7dC5tc2c9InVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIixyLm1vZGU9ZHA7YnJlYWt9aWYoNTczNDQmcWQocikpe3QubXNnPSJ1bmtub3duIGhlYWRlciBmbGFncyBzZXQiLHIubW9kZT1kcDticmVha31yLmhlYWQmJihyLmhlYWQudGV4dD11Pj44JjEpLDUxMiZxZChyKSYmKEFbMF09MjU1JnUsQVsxXT11Pj4+OCYyNTUsci5jaGVjaz1jcChyLmNoZWNrLEEsMiwwKSksdT0wLGw9MCxyLm1vZGU9MztjYXNlIDM6Zm9yKDtsPDMyOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5oZWFkJiYoci5oZWFkLnRpbWU9dSksNTEyJnFkKHIpJiYoQVswXT0yNTUmdSxBWzFdPXU+Pj44JjI1NSxBWzJdPXU+Pj4xNiYyNTUsQVszXT11Pj4+MjQmMjU1LHIuY2hlY2s9Y3Aoci5jaGVjayxBLDQsMCkpLHU9MCxsPTAsci5tb2RlPTQ7Y2FzZSA0OmZvcig7bDwxNjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fXIuaGVhZCYmKHIuaGVhZC54ZmxhZ3M9MjU1JnUsci5oZWFkLm9zPXU+PjgpLDUxMiZxZChyKSYmKEFbMF09MjU1JnUsQVsxXT11Pj4+OCYyNTUsci5jaGVjaz1jcChyLmNoZWNrLEEsMiwwKSksdT0wLGw9MCxyLm1vZGU9NTtjYXNlIDU6aWYoMTAyNCZxZChyKSl7Zm9yKDtsPDE2Oyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5sZW5ndGg9dSxyLmhlYWQmJihyLmhlYWQuZXh0cmFfbGVuPXUpLDUxMiZxZChyKSYmKEFbMF09MjU1JnUsQVsxXT11Pj4+OCYyNTUsci5jaGVjaz1jcChyLmNoZWNrLEEsMiwwKSksdT0wLGw9MH1lbHNlIHIuaGVhZCYmKHIuaGVhZC5leHRyYT1udWxsKTtyLm1vZGU9NjtjYXNlIDY6aWYoMTAyNCZxZChyKSYmKChkPXIubGVuZ3RoKT5hJiYoZD1hKSxkJiYoci5oZWFkJiYoUz1yLmhlYWQuZXh0cmFfbGVuLXIubGVuZ3RoLHIuaGVhZC5leHRyYXx8KHIuaGVhZC5leHRyYT1uZXcgQXJyYXkoci5oZWFkLmV4dHJhX2xlbikpLHNwLmFycmF5U2V0KHIuaGVhZC5leHRyYSxuLG8sZCxTKSksNTEyJnFkKHIpJiYoci5jaGVjaz1jcChyLmNoZWNrLG4sZCxvKSksYS09ZCxvKz1kLHIubGVuZ3RoLT1kKSxyLmxlbmd0aCkpYnJlYWsgdDtyLmxlbmd0aD0wLHIubW9kZT03O2Nhc2UgNzppZigyMDQ4JnFkKHIpKXtpZigwPT09YSlicmVhayB0O2Q9MDtkb3tTPW5bbytkKytdLHIuaGVhZCYmUyYmci5sZW5ndGg8NjU1MzYmJihyLmhlYWQubmFtZSs9U3RyaW5nLmZyb21DaGFyQ29kZShTKSl9d2hpbGUoUyYmZDxhKTtpZig1MTImcWQocikmJihyLmNoZWNrPWNwKHIuY2hlY2ssbixkLG8pKSxhLT1kLG8rPWQsUylicmVhayB0fWVsc2Ugci5oZWFkJiYoci5oZWFkLm5hbWU9bnVsbCk7ci5sZW5ndGg9MCxyLm1vZGU9ODtjYXNlIDg6aWYoNDA5NiZxZChyKSl7aWYoMD09PWEpYnJlYWsgdDtkPTA7ZG97Uz1uW28rZCsrXSxyLmhlYWQmJlMmJnIubGVuZ3RoPDY1NTM2JiYoci5oZWFkLmNvbW1lbnQrPVN0cmluZy5mcm9tQ2hhckNvZGUoUykpfXdoaWxlKFMmJmQ8YSk7aWYoNTEyJnFkKHIpJiYoci5jaGVjaz1jcChyLmNoZWNrLG4sZCxvKSksYS09ZCxvKz1kLFMpYnJlYWsgdH1lbHNlIHIuaGVhZCYmKHIuaGVhZC5jb21tZW50PW51bGwpO3IubW9kZT05O2Nhc2UgOTppZig1MTImcWQocikpe2Zvcig7bDwxNjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWlmKHUhPT0oNjU1MzUmci5jaGVjaykpe3QubXNnPSJoZWFkZXIgY3JjIG1pc21hdGNoIixyLm1vZGU9ZHA7YnJlYWt9dT0wLGw9MH1yLmhlYWQmJihyLmhlYWQuaGNyYz1xZChyKT4+OSYxLHIuaGVhZC5kb25lPSEwKSx0LmFkbGVyPXIuY2hlY2s9MCxyLm1vZGU9ZnA7YnJlYWs7Y2FzZSAxMDpmb3IoO2w8MzI7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH10LmFkbGVyPXIuY2hlY2s9cHAodSksdT0wLGw9MCxyLm1vZGU9MTE7Y2FzZSAxMTppZigwPT09ci5oYXZlZGljdClyZXR1cm4gdC5uZXh0X291dD1zLHQuYXZhaWxfb3V0PWMsdC5uZXh0X2luPW8sdC5hdmFpbF9pbj1hLHIuaG9sZD11LHIuYml0cz1sLDI7dC5hZGxlcj1yLmNoZWNrPTEsci5tb2RlPWZwO2Nhc2UgZnA6aWYoNT09PWV8fDY9PT1lKWJyZWFrIHQ7Y2FzZSAxMzppZihyLmxhc3Qpe3U+Pj49NyZsLGwtPTcmbCxyLm1vZGU9Mjc7YnJlYWt9Zm9yKDtsPDM7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1zd2l0Y2goci5sYXN0PTEmdSxsLT0xLDMmKHU+Pj49MSkpe2Nhc2UgMDpyLm1vZGU9MTQ7YnJlYWs7Y2FzZSAxOmlmKGtwKHIpLHIubW9kZT0yMCw2PT09ZSl7dT4+Pj0yLGwtPTI7YnJlYWsgdH1icmVhaztjYXNlIDI6ci5tb2RlPTE3O2JyZWFrO2Nhc2UgMzp0Lm1zZz0iaW52YWxpZCBibG9jayB0eXBlIixyLm1vZGU9ZHB9dT4+Pj0yLGwtPTI7YnJlYWs7Y2FzZSAxNDpmb3IodT4+Pj03JmwsbC09NyZsO2w8MzI7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZigoNjU1MzUmdSkhPSh1Pj4+MTZeNjU1MzUpKXt0Lm1zZz0iaW52YWxpZCBzdG9yZWQgYmxvY2sgbGVuZ3RocyIsci5tb2RlPWRwO2JyZWFrfWlmKHIubGVuZ3RoPTY1NTM1JnUsdT0wLGw9MCxyLm1vZGU9MTUsNj09PWUpYnJlYWsgdDtjYXNlIDE1OnIubW9kZT0xNjtjYXNlIDE2OmlmKGQ9ci5sZW5ndGgpe2lmKGQ+YSYmKGQ9YSksZD5jJiYoZD1jKSwwPT09ZClicmVhayB0O3NwLmFycmF5U2V0KGksbixvLGQscyksYS09ZCxvKz1kLGMtPWQscys9ZCxyLmxlbmd0aC09ZDticmVha31yLm1vZGU9ZnA7YnJlYWs7Y2FzZSAxNzpmb3IoO2w8MTQ7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZihyLm5sZW49MjU3KygzMSZ1KSx1Pj4+PTUsbC09NSxyLm5kaXN0PTErKDMxJnUpLHU+Pj49NSxsLT01LHIubmNvZGU9NCsoMTUmdSksdT4+Pj00LGwtPTQsci5ubGVuPjI4Nnx8ci5uZGlzdD4zMCl7dC5tc2c9InRvbyBtYW55IGxlbmd0aCBvciBkaXN0YW5jZSBzeW1ib2xzIixyLm1vZGU9ZHA7YnJlYWt9ci5oYXZlPTAsci5tb2RlPTE4O2Nhc2UgMTg6Zm9yKDtyLmhhdmU8ci5uY29kZTspe2Zvcig7bDwzOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5sZW5zW0Nbci5oYXZlKytdXT03JnUsdT4+Pj0zLGwtPTN9Zm9yKDtyLmhhdmU8MTk7KXIubGVuc1tDW3IuaGF2ZSsrXV09MDtpZihyLmxlbmNvZGU9ci5sZW5keW4sci5sZW5iaXRzPTcsTz17Yml0czpyLmxlbmJpdHN9LGs9bHAoMCxyLmxlbnMsMCwxOSxyLmxlbmNvZGUsMCxyLndvcmssTyksci5sZW5iaXRzPU8uYml0cyxrKXt0Lm1zZz0iaW52YWxpZCBjb2RlIGxlbmd0aHMgc2V0IixyLm1vZGU9ZHA7YnJlYWt9ci5oYXZlPTAsci5tb2RlPTE5O2Nhc2UgMTk6Zm9yKDtyLmhhdmU8ci5ubGVuK3IubmRpc3Q7KXtmb3IoO209KEU9ci5sZW5jb2RlW3UmKDE8PHIubGVuYml0cyktMV0pPj4+MTYmMjU1LHk9NjU1MzUmRSwhKChnPUU+Pj4yNCk8PWwpOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9aWYoeTwxNil1Pj4+PWcsbC09ZyxyLmxlbnNbci5oYXZlKytdPXk7ZWxzZXtpZigxNj09PXkpe2Zvcih4PWcrMjtsPHg7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1pZih1Pj4+PWcsbC09ZywwPT09ci5oYXZlKXt0Lm1zZz0iaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCIsci5tb2RlPWRwO2JyZWFrfVM9ci5sZW5zW3IuaGF2ZS0xXSxkPTMrKDMmdSksdT4+Pj0yLGwtPTJ9ZWxzZSBpZigxNz09PXkpe2Zvcih4PWcrMztsPHg7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH1sLT1nLFM9MCxkPTMrKDcmKHU+Pj49ZykpLHU+Pj49MyxsLT0zfWVsc2V7Zm9yKHg9Zys3O2w8eDspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWwtPWcsUz0wLGQ9MTErKDEyNyYodT4+Pj1nKSksdT4+Pj03LGwtPTd9aWYoci5oYXZlK2Q+ci5ubGVuK3IubmRpc3Qpe3QubXNnPSJpbnZhbGlkIGJpdCBsZW5ndGggcmVwZWF0IixyLm1vZGU9ZHA7YnJlYWt9Zm9yKDtkLS07KXIubGVuc1tyLmhhdmUrK109U319aWYoci5tb2RlPT09ZHApYnJlYWs7aWYoMD09PXIubGVuc1syNTZdKXt0Lm1zZz0iaW52YWxpZCBjb2RlIC0tIG1pc3NpbmcgZW5kLW9mLWJsb2NrIixyLm1vZGU9ZHA7YnJlYWt9aWYoci5sZW5iaXRzPTksTz17Yml0czpyLmxlbmJpdHN9LGs9bHAoMSxyLmxlbnMsMCxyLm5sZW4sci5sZW5jb2RlLDAsci53b3JrLE8pLHIubGVuYml0cz1PLmJpdHMsayl7dC5tc2c9ImludmFsaWQgbGl0ZXJhbC9sZW5ndGhzIHNldCIsci5tb2RlPWRwO2JyZWFrfWlmKHIuZGlzdGJpdHM9NixyLmRpc3Rjb2RlPXIuZGlzdGR5bixPPXtiaXRzOnIuZGlzdGJpdHN9LGs9bHAoMixyLmxlbnMsci5ubGVuLHIubmRpc3Qsci5kaXN0Y29kZSwwLHIud29yayxPKSxyLmRpc3RiaXRzPU8uYml0cyxrKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZXMgc2V0IixyLm1vZGU9ZHA7YnJlYWt9aWYoci5tb2RlPTIwLDY9PT1lKWJyZWFrIHQ7Y2FzZSAyMDpyLm1vZGU9MjE7Y2FzZSAyMTppZihhPj02JiZjPj0yNTgpe3QubmV4dF9vdXQ9cyx0LmF2YWlsX291dD1jLHQubmV4dF9pbj1vLHQuYXZhaWxfaW49YSxyLmhvbGQ9dSxyLmJpdHM9bCx1cCh0LGYpLHM9dC5uZXh0X291dCxpPXQub3V0cHV0LGM9dC5hdmFpbF9vdXQsbz10Lm5leHRfaW4sbj10LmlucHV0LGE9dC5hdmFpbF9pbix1PXIuaG9sZCxsPXIuYml0cyxyLm1vZGU9PT1mcCYmKHIuYmFjaz0tMSk7YnJlYWt9Zm9yKHIuYmFjaz0wO209KEU9ci5sZW5jb2RlW3UmKDE8PHIubGVuYml0cyktMV0pPj4+MTYmMjU1LHk9NjU1MzUmRSwhKChnPUU+Pj4yNCk8PWwpOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9aWYobSYmISgyNDAmbSkpe2Zvcih2PWcsYj1tLHc9eTttPShFPXIubGVuY29kZVt3KygodSYoMTw8ditiKS0xKT4+dildKT4+PjE2JjI1NSx5PTY1NTM1JkUsISh2KyhnPUU+Pj4yNCk8PWwpOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9dT4+Pj12LGwtPXYsci5iYWNrKz12fWlmKHU+Pj49ZyxsLT1nLHIuYmFjays9ZyxyLmxlbmd0aD15LDA9PT1tKXtyLm1vZGU9MjY7YnJlYWt9aWYoMzImbSl7ci5iYWNrPS0xLHIubW9kZT1mcDticmVha31pZig2NCZtKXt0Lm1zZz0iaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIixyLm1vZGU9ZHA7YnJlYWt9ci5leHRyYT0xNSZtLHIubW9kZT0yMjtjYXNlIDIyOmlmKHIuZXh0cmEpe2Zvcih4PXIuZXh0cmE7bDx4Oyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9ci5sZW5ndGgrPXUmKDE8PHIuZXh0cmEpLTEsdT4+Pj1yLmV4dHJhLGwtPXIuZXh0cmEsci5iYWNrKz1yLmV4dHJhfXIud2FzPXIubGVuZ3RoLHIubW9kZT0yMztjYXNlIDIzOmZvcig7bT0oRT1yLmRpc3Rjb2RlW3UmKDE8PHIuZGlzdGJpdHMpLTFdKT4+PjE2JjI1NSx5PTY1NTM1JkUsISgoZz1FPj4+MjQpPD1sKTspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fWlmKCEoMjQwJm0pKXtmb3Iodj1nLGI9bSx3PXk7bT0oRT1yLmRpc3Rjb2RlW3crKCh1JigxPDx2K2IpLTEpPj52KV0pPj4+MTYmMjU1LHk9NjU1MzUmRSwhKHYrKGc9RT4+PjI0KTw9bCk7KXtpZigwPT09YSlicmVhayB0O2EtLSx1Kz1uW28rK108PGwsbCs9OH11Pj4+PXYsbC09dixyLmJhY2srPXZ9aWYodT4+Pj1nLGwtPWcsci5iYWNrKz1nLDY0Jm0pe3QubXNnPSJpbnZhbGlkIGRpc3RhbmNlIGNvZGUiLHIubW9kZT1kcDticmVha31yLm9mZnNldD15LHIuZXh0cmE9MTUmbSxyLm1vZGU9MjQ7Y2FzZSAyNDppZihyLmV4dHJhKXtmb3IoeD1yLmV4dHJhO2w8eDspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHUrPW5bbysrXTw8bCxsKz04fXIub2Zmc2V0Kz11JigxPDxyLmV4dHJhKS0xLHU+Pj49ci5leHRyYSxsLT1yLmV4dHJhLHIuYmFjays9ci5leHRyYX1pZihyLm9mZnNldD5yLmRtYXgpe3QubXNnPSJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsci5tb2RlPWRwO2JyZWFrfXIubW9kZT0yNTtjYXNlIDI1OmlmKDA9PT1jKWJyZWFrIHQ7aWYoZD1mLWMsci5vZmZzZXQ+ZCl7aWYoKGQ9ci5vZmZzZXQtZCk+ci53aGF2ZSYmci5zYW5lKXt0Lm1zZz0iaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLHIubW9kZT1kcDticmVha31kPnIud25leHQ/KGQtPXIud25leHQscD1yLndzaXplLWQpOnA9ci53bmV4dC1kLGQ+ci5sZW5ndGgmJihkPXIubGVuZ3RoKSxfPXIud2luZG93fWVsc2UgXz1pLHA9cy1yLm9mZnNldCxkPXIubGVuZ3RoO2Q+YyYmKGQ9YyksYy09ZCxyLmxlbmd0aC09ZDtkb3tpW3MrK109X1twKytdfXdoaWxlKC0tZCk7MD09PXIubGVuZ3RoJiYoci5tb2RlPTIxKTticmVhaztjYXNlIDI2OmlmKDA9PT1jKWJyZWFrIHQ7aVtzKytdPXIubGVuZ3RoLGMtLSxyLm1vZGU9MjE7YnJlYWs7Y2FzZSAyNzppZihyLndyYXApe2Zvcig7bDwzMjspe2lmKDA9PT1hKWJyZWFrIHQ7YS0tLHV8PW5bbysrXTw8bCxsKz04fWlmKGYtPWMsdC50b3RhbF9vdXQrPWYsci50b3RhbCs9ZixmJiYodC5hZGxlcj1yLmNoZWNrPXFkKHIpP2NwKHIuY2hlY2ssaSxmLHMtZik6YXAoci5jaGVjayxpLGYscy1mKSksZj1jLChxZChyKT91OnBwKHUpKSE9PXIuY2hlY2spe3QubXNnPSJpbmNvcnJlY3QgZGF0YSBjaGVjayIsci5tb2RlPWRwO2JyZWFrfXU9MCxsPTB9ci5tb2RlPTI4O2Nhc2UgMjg6aWYoci53cmFwJiZxZChyKSl7Zm9yKDtsPDMyOyl7aWYoMD09PWEpYnJlYWsgdDthLS0sdSs9bltvKytdPDxsLGwrPTh9aWYodSE9PSg0Mjk0OTY3Mjk1JnIudG90YWwpKXt0Lm1zZz0iaW5jb3JyZWN0IGxlbmd0aCBjaGVjayIsci5tb2RlPWRwO2JyZWFrfXU9MCxsPTB9ci5tb2RlPTI5O2Nhc2UgMjk6az0xO2JyZWFrIHQ7Y2FzZSBkcDprPS0zO2JyZWFrIHQ7Y2FzZSAzMTpyZXR1cm4tNDtkZWZhdWx0OnJldHVybiBocH1yZXR1cm4gdC5uZXh0X291dD1zLHQuYXZhaWxfb3V0PWMsdC5uZXh0X2luPW8sdC5hdmFpbF9pbj1hLHIuaG9sZD11LHIuYml0cz1sLChyLndzaXplfHxmIT09dC5hdmFpbF9vdXQmJnIubW9kZTxkcCYmKHIubW9kZTwyN3x8NCE9PWUpKSYmT3AodCx0Lm91dHB1dCx0Lm5leHRfb3V0LGYtdC5hdmFpbF9vdXQpLGgtPXQuYXZhaWxfaW4sZi09dC5hdmFpbF9vdXQsdC50b3RhbF9pbis9aCx0LnRvdGFsX291dCs9ZixyLnRvdGFsKz1mLHIud3JhcCYmZiYmKHQuYWRsZXI9ci5jaGVjaz1xZChyKT9jcChyLmNoZWNrLGksZix0Lm5leHRfb3V0LWYpOmFwKHIuY2hlY2ssaSxmLHQubmV4dF9vdXQtZikpLHQuZGF0YV90eXBlPXIuYml0cysoci5sYXN0PzY0OjApKyhyLm1vZGU9PT1mcD8xMjg6MCkrKDIwPT09ci5tb2RlfHwxNT09PXIubW9kZT8yNTY6MCksKDA9PT1oJiYwPT09Znx8ND09PWUpJiYwPT09ayYmKGs9LTUpLGt9LFFkLmluZmxhdGVFbmQ9ZnVuY3Rpb24odCl7aWYoIXR8fCF0LnN0YXRlKXJldHVybiBocDt2YXIgZT10LnN0YXRlO3JldHVybiBlLndpbmRvdyYmKGUud2luZG93PW51bGwpLHQuc3RhdGU9bnVsbCwwfSxRZC5pbmZsYXRlR2V0SGVhZGVyPWZ1bmN0aW9uKHQsZSl7dmFyIHI7cmV0dXJuIHQmJnQuc3RhdGUmJjImKHI9dC5zdGF0ZSkud3JhcD8oci5oZWFkPWUsZS5kb25lPSExLDApOmhwfSxRZC5pbmZsYXRlU2V0RGljdGlvbmFyeT1mdW5jdGlvbih0LGUpe3ZhciByLG49ZS5sZW5ndGg7cmV0dXJuIHQmJnQuc3RhdGU/MCE9PShyPXQuc3RhdGUpLndyYXAmJjExIT09ci5tb2RlP2hwOjExPT09ci5tb2RlJiZhcCgxLGUsbiwwKSE9PXIuY2hlY2s/LTM6T3AodCxlLG4sbik/KHIubW9kZT0zMSwtNCk6KHIuaGF2ZWRpY3Q9MSwwKTpocH0sUWQuaW5mbGF0ZUluZm89InBha28gaW5mbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkiO3ZhciB4cD17Wl9OT19GTFVTSDowLFpfUEFSVElBTF9GTFVTSDoxLFpfU1lOQ19GTFVTSDoyLFpfRlVMTF9GTFVTSDozLFpfRklOSVNIOjQsWl9CTE9DSzo1LFpfVFJFRVM6NixaX09LOjAsWl9TVFJFQU1fRU5EOjEsWl9ORUVEX0RJQ1Q6MixaX0VSUk5POi0xLFpfU1RSRUFNX0VSUk9SOi0yLFpfREFUQV9FUlJPUjotMyxaX0JVRl9FUlJPUjotNSxaX05PX0NPTVBSRVNTSU9OOjAsWl9CRVNUX1NQRUVEOjEsWl9CRVNUX0NPTVBSRVNTSU9OOjksWl9ERUZBVUxUX0NPTVBSRVNTSU9OOi0xLFpfRklMVEVSRUQ6MSxaX0hVRkZNQU5fT05MWToyLFpfUkxFOjMsWl9GSVhFRDo0LFpfREVGQVVMVF9TVFJBVEVHWTowLFpfQklOQVJZOjAsWl9URVhUOjEsWl9VTktOT1dOOjIsWl9ERUZMQVRFRDo4fTt2YXIgRXA9UWQsQXA9ZGYsQ3A9QmQsSXA9eHAsVHA9aWQsTHA9RmQsQnA9ZnVuY3Rpb24oKXt0aGlzLnRleHQ9MCx0aGlzLnRpbWU9MCx0aGlzLnhmbGFncz0wLHRoaXMub3M9MCx0aGlzLmV4dHJhPW51bGwsdGhpcy5leHRyYV9sZW49MCx0aGlzLm5hbWU9IiIsdGhpcy5jb21tZW50PSIiLHRoaXMuaGNyYz0wLHRoaXMuZG9uZT0hMX0sTnA9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBScCh0KXtpZighKHRoaXMgaW5zdGFuY2VvZiBScCkpcmV0dXJuIG5ldyBScCh0KTt0aGlzLm9wdGlvbnM9QXAuYXNzaWduKHtjaHVua1NpemU6MTYzODQsd2luZG93Qml0czowLHRvOiIifSx0fHx7fSk7dmFyIGU9dGhpcy5vcHRpb25zO2UucmF3JiZlLndpbmRvd0JpdHM+PTAmJmUud2luZG93Qml0czwxNiYmKGUud2luZG93Qml0cz0tZS53aW5kb3dCaXRzLDA9PT1lLndpbmRvd0JpdHMmJihlLndpbmRvd0JpdHM9LTE1KSksIShlLndpbmRvd0JpdHM+PTAmJmUud2luZG93Qml0czwxNil8fHQmJnQud2luZG93Qml0c3x8KGUud2luZG93Qml0cys9MzIpLGUud2luZG93Qml0cz4xNSYmZS53aW5kb3dCaXRzPDQ4JiYoMTUmZS53aW5kb3dCaXRzfHwoZS53aW5kb3dCaXRzfD0xNSkpLHRoaXMuZXJyPTAsdGhpcy5tc2c9IiIsdGhpcy5lbmRlZD0hMSx0aGlzLmNodW5rcz1bXSx0aGlzLnN0cm09bmV3IExwLHRoaXMuc3RybS5hdmFpbF9vdXQ9MDt2YXIgcj1FcC5pbmZsYXRlSW5pdDIodGhpcy5zdHJtLGUud2luZG93Qml0cyk7aWYociE9PUlwLlpfT0spdGhyb3cgbmV3IEVycm9yKFRwW3JdKTtpZih0aGlzLmhlYWRlcj1uZXcgQnAsRXAuaW5mbGF0ZUdldEhlYWRlcih0aGlzLnN0cm0sdGhpcy5oZWFkZXIpLGUuZGljdGlvbmFyeSYmKCJzdHJpbmciPT10eXBlb2YgZS5kaWN0aW9uYXJ5P2UuZGljdGlvbmFyeT1DcC5zdHJpbmcyYnVmKGUuZGljdGlvbmFyeSk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PU5wLmNhbGwoZS5kaWN0aW9uYXJ5KSYmKGUuZGljdGlvbmFyeT1uZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpKSxlLnJhdyYmKHI9RXAuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLGUuZGljdGlvbmFyeSkpIT09SXAuWl9PSykpdGhyb3cgbmV3IEVycm9yKFRwW3JdKX1mdW5jdGlvbiB6cCh0LGUpe3ZhciByPW5ldyBScChlKTtpZihyLnB1c2godCwhMCksci5lcnIpdGhyb3cgci5tc2d8fFRwW3IuZXJyXTtyZXR1cm4gci5yZXN1bHR9UnAucHJvdG90eXBlLnB1c2g9ZnVuY3Rpb24odCxlKXt2YXIgcixuLGksbyxzLGE9dGhpcy5zdHJtLGM9dGhpcy5vcHRpb25zLmNodW5rU2l6ZSx1PXRoaXMub3B0aW9ucy5kaWN0aW9uYXJ5LGw9ITE7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtuPWU9PT1+fmU/ZTohMD09PWU/SXAuWl9GSU5JU0g6SXAuWl9OT19GTFVTSCwic3RyaW5nIj09dHlwZW9mIHQ/YS5pbnB1dD1DcC5iaW5zdHJpbmcyYnVmKHQpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT1OcC5jYWxsKHQpP2EuaW5wdXQ9bmV3IFVpbnQ4QXJyYXkodCk6YS5pbnB1dD10LGEubmV4dF9pbj0wLGEuYXZhaWxfaW49YS5pbnB1dC5sZW5ndGg7ZG97aWYoMD09PWEuYXZhaWxfb3V0JiYoYS5vdXRwdXQ9bmV3IEFwLkJ1ZjgoYyksYS5uZXh0X291dD0wLGEuYXZhaWxfb3V0PWMpLChyPUVwLmluZmxhdGUoYSxJcC5aX05PX0ZMVVNIKSk9PT1JcC5aX05FRURfRElDVCYmdSYmKHI9RXAuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLHUpKSxyPT09SXAuWl9CVUZfRVJST1ImJiEwPT09bCYmKHI9SXAuWl9PSyxsPSExKSxyIT09SXAuWl9TVFJFQU1fRU5EJiZyIT09SXAuWl9PSylyZXR1cm4gdGhpcy5vbkVuZChyKSx0aGlzLmVuZGVkPSEwLCExO2EubmV4dF9vdXQmJigwIT09YS5hdmFpbF9vdXQmJnIhPT1JcC5aX1NUUkVBTV9FTkQmJigwIT09YS5hdmFpbF9pbnx8biE9PUlwLlpfRklOSVNIJiZuIT09SXAuWl9TWU5DX0ZMVVNIKXx8KCJzdHJpbmciPT09dGhpcy5vcHRpb25zLnRvPyhpPUNwLnV0Zjhib3JkZXIoYS5vdXRwdXQsYS5uZXh0X291dCksbz1hLm5leHRfb3V0LWkscz1DcC5idWYyc3RyaW5nKGEub3V0cHV0LGkpLGEubmV4dF9vdXQ9byxhLmF2YWlsX291dD1jLW8sbyYmQXAuYXJyYXlTZXQoYS5vdXRwdXQsYS5vdXRwdXQsaSxvLDApLHRoaXMub25EYXRhKHMpKTp0aGlzLm9uRGF0YShBcC5zaHJpbmtCdWYoYS5vdXRwdXQsYS5uZXh0X291dCkpKSksMD09PWEuYXZhaWxfaW4mJjA9PT1hLmF2YWlsX291dCYmKGw9ITApfXdoaWxlKChhLmF2YWlsX2luPjB8fDA9PT1hLmF2YWlsX291dCkmJnIhPT1JcC5aX1NUUkVBTV9FTkQpO3JldHVybiByPT09SXAuWl9TVFJFQU1fRU5EJiYobj1JcC5aX0ZJTklTSCksbj09PUlwLlpfRklOSVNIPyhyPUVwLmluZmxhdGVFbmQodGhpcy5zdHJtKSx0aGlzLm9uRW5kKHIpLHRoaXMuZW5kZWQ9ITAscj09PUlwLlpfT0spOm4hPT1JcC5aX1NZTkNfRkxVU0h8fCh0aGlzLm9uRW5kKElwLlpfT0spLGEuYXZhaWxfb3V0PTAsITApfSxScC5wcm90b3R5cGUub25EYXRhPWZ1bmN0aW9uKHQpe3RoaXMuY2h1bmtzLnB1c2godCl9LFJwLnByb3RvdHlwZS5vbkVuZD1mdW5jdGlvbih0KXt0PT09SXAuWl9PSyYmKCJzdHJpbmciPT09dGhpcy5vcHRpb25zLnRvP3RoaXMucmVzdWx0PXRoaXMuY2h1bmtzLmpvaW4oIiIpOnRoaXMucmVzdWx0PUFwLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9LFZkLkluZmxhdGU9UnAsVmQuaW5mbGF0ZT16cCxWZC5pbmZsYXRlUmF3PWZ1bmN0aW9uKHQsZSl7cmV0dXJuKGU9ZXx8e30pLnJhdz0hMCx6cCh0LGUpfSxWZC51bmd6aXA9enA7dmFyIERwPXt9OygwLGRmLmFzc2lnbikoRHAscGYsVmQseHApO3ZhciBQcD1lKERwKTtsZXQgTXA9MTtjb25zdCBGcD0iX19ydGNfdW1kX25hbWVfXyIsanA9KCk9PndpbmRvdy5pbmRleGVkREJ8fHdpbmRvdy5tb3pJbmRleGVkREJ8fHdpbmRvdy53ZWJraXRJbmRleGVkREJ8fHdpbmRvdy5tc0luZGV4ZWREQjtjbGFzcyBVcHtjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJzdG9yZU5hbWUiLHZvaWQgMCksbGwodGhpcywicGVuZGluZ0xpc3QiLFtdKSx0aGlzLnN0b3JlTmFtZT10LCFCbCgpJiZqcCgpJiZ0aGlzLl9jaGVja0FuZENyZWF0ZVN0b3JlKHQpfWFzeW5jIF9jaGVja0FuZENyZWF0ZVN0b3JlKHQsZSl7Y29uc3Qgcj1hd2FpdCBVcC5fcHJvbWlzZUxvY2subG9jaygpO2lmKGpwKCkuZGF0YWJhc2VzKXtsZXQgdDthd2FpdCBuZXcgUHJvbWlzZSgoZT0+e2NvbnN0IHI9KCk9PmpwKCkuZGF0YWJhc2VzKCkuZmluYWxseShlKTt0PXNldEludGVydmFsKHIsMTAwKSxyKCl9KSkuZmluYWxseSgoKCk9PmNsZWFySW50ZXJ2YWwodCkpKX1yZXR1cm4gbmV3IFByb21pc2UoKG49PntVcC5kYiYmKFVwLmRiLmNsb3NlKCksZGVsZXRlIFVwLmRiKTtjb25zdCBpPWU/anAoKS5vcGVuKEZwLGUpOmpwKCkub3BlbihGcCk7aS5vbnVwZ3JhZGVuZWVkZWQ9KCk9PntpLnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZSh0KX0saS5vbmVycm9yPSgpPT57Y29uc29sZS5lcnJvcigiSW5kZXhlZERCSW50ZXJmYWNlIGVycm9yIixpLmVycm9yKX0saS5vbnN1Y2Nlc3M9KCk9Pntjb25zdCBlPWkucmVzdWx0O1VwLmRiPWU7dHJ5e1VwLmRiLnRyYW5zYWN0aW9uKHRoaXMuc3RvcmVOYW1lLCJyZWFkb25seSIpLHRoaXMucGVuZGluZ0xpc3QuZm9yRWFjaCgoYXN5bmMgdD0+e2xldHt0eE1vZGU6ZSxwZW5kUmVzb2x2ZTpyLHBlbmRSZWplY3Q6bn09dDt0cnl7cihhd2FpdCB0aGlzLl9nZXRTdG9yZShlKSl9Y2F0Y2goaSl7bigpfX0pKSxuKCl9Y2F0Y2gobyl7bih0aGlzLl9jaGVja0FuZENyZWF0ZVN0b3JlKHQsZS52ZXJzaW9uKzEpKX1maW5hbGx5e3IoKX19fSkpfWFzeW5jIF9nZXRTdG9yZSh0KXtjb25zdCBlPWF3YWl0IFVwLl9wcm9taXNlTG9jay5sb2NrKCk7cmV0dXJuIG5ldyBQcm9taXNlKCgocixuKT0+e2lmKCFVcC5kYilyZXR1cm4gdGhpcy5wZW5kaW5nTGlzdC5wdXNoKHt0eE1vZGU6dCxwZW5kUmVzb2x2ZTpyLHBlbmRSZWplY3Q6bn0pLHZvaWQgZSgpO3RyeXtyKFVwLmRiLnRyYW5zYWN0aW9uKHRoaXMuc3RvcmVOYW1lLHQpLm9iamVjdFN0b3JlKHRoaXMuc3RvcmVOYW1lKSl9Y2F0Y2goaSl7cmV0dXJuIHZvaWQgdGhpcy5wZW5kaW5nTGlzdC5wdXNoKHt0eE1vZGU6dCxwZW5kUmVzb2x2ZTpyLHBlbmRSZWplY3Q6bn0pfWZpbmFsbHl7ZSgpfX0pKX1hc3luYyBwdXQyU3RyaW5nKHQsZSl7bGV0IHI7dHJ5e3I9SlNPTi5zdHJpbmdpZnkodCl9Y2F0Y2gobil7cj10fXJldHVybiBhd2FpdCB0aGlzLnB1dChyLGUpfWFzeW5jIGdldDRTdHJpbmcodCl7Y29uc3QgZT1hd2FpdCB0aGlzLmdldCh0KTtsZXQgcjt0cnl7cj1KU09OLnBhcnNlKGUpfWNhdGNoKG4pe3I9ZX1yZXR1cm4gcn1hc3luYyBwdXQodCxlKXtjb25zdCByPWF3YWl0IHRoaXMuX2dldFN0b3JlKCJyZWFkd3JpdGUiKTtyZXR1cm4gbmV3IFByb21pc2UoKChuLGkpPT57Y29uc3Qgbz1yLnB1dCh0LGUpO28ub25zdWNjZXNzPSgpPT57bigpfSxvLm9uZXJyb3I9dD0+e2kodCl9fSkpfWFzeW5jIGdldCh0KXtjb25zdCBlPWF3YWl0IHRoaXMuX2dldFN0b3JlKCJyZWFkb25seSIpO3JldHVybiBuZXcgUHJvbWlzZSgoKHIsbik9Pntjb25zdCBpPWUuZ2V0KHQpO2kub25zdWNjZXNzPSgpPT57cihpLnJlc3VsdCl9LGkub25lcnJvcj10PT57bih0KX19KSl9YXN5bmMgZGVsKHQpe2NvbnN0IGU9YXdhaXQgdGhpcy5fZ2V0U3RvcmUoInJlYWR3cml0ZSIpO3JldHVybiBuZXcgUHJvbWlzZSgoKHIsbik9Pntjb25zdCBpPWUuZGVsZXRlKHQpO2kub25zdWNjZXNzPSgpPT57cigpfSxpLm9uZXJyb3I9dD0+e24odCl9fSkpfX1sbChVcCwiZGIiLHZvaWQgMCksbGwoVXAsInN0YXRlIiwiaW5pdCIpLGxsKFVwLCJfcHJvbWlzZUxvY2siLG5ldyBjbGFzc3tjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJsb2NraW5nUHJvbWlzZSIsUHJvbWlzZS5yZXNvbHZlKCkpLGxsKHRoaXMsImxvY2tzIiwwKSxsbCh0aGlzLCJuYW1lIiwiIiksbGwodGhpcywibG9ja0lkIix2b2lkIDApLHRoaXMubG9ja0lkPU1wKyssdCYmKHRoaXMubmFtZT10KX1nZXQgaXNMb2NrZWQoKXtyZXR1cm4gdGhpcy5sb2Nrcz4wfWxvY2soKXtsZXQgdDt0aGlzLmxvY2tzKz0xO2NvbnN0IGU9bmV3IFByb21pc2UoKGU9Pnt0PSgpPT57dGhpcy5sb2Nrcy09MSxlKCl9fSkpLHI9dGhpcy5sb2NraW5nUHJvbWlzZS50aGVuKCgoKT0+dCkpO3JldHVybiB0aGlzLmxvY2tpbmdQcm9taXNlPXRoaXMubG9ja2luZ1Byb21pc2UudGhlbigoKCk9PmUpKSxyfX0oImlEQiIpKTt2YXIgSHA9c2kuaW5jbHVkZXM7Q3Ioe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDpzKChmdW5jdGlvbigpe3JldHVybiFBcnJheSgxKS5pbmNsdWRlcygpfSkpfSx7aW5jbHVkZXM6ZnVuY3Rpb24odCl7cmV0dXJuIEhwKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIEtwPV9sKCJBcnJheSIsImluY2x1ZGVzIiksSnA9ZnVuY3Rpb24odCl7dmFyIGU7cmV0dXJuIGdsKHQpJiYodm9pZCAwIT09KGU9dFt5bF0pPyEhZToiUmVnRXhwIj09PW1sKHQpKX0sV3A9VHlwZUVycm9yLFpwPWZlKCJtYXRjaCIpLEdwPUNyLFZwPWZ1bmN0aW9uKHQpe2lmKEpwKHQpKXRocm93IG5ldyBXcCgiVGhlIG1ldGhvZCBkb2Vzbid0IGFjY2VwdCByZWd1bGFyIGV4cHJlc3Npb25zIik7cmV0dXJuIHR9LCRwPUcsWHA9WW4sWXA9ZnVuY3Rpb24odCl7dmFyIGU9Ly4vO3RyeXsiLy4vIlt0XShlKX1jYXRjaChyKXt0cnl7cmV0dXJuIGVbWnBdPSExLCIvLi8iW3RdKGUpfWNhdGNoKG4pe319cmV0dXJuITF9LHFwPW0oIiIuaW5kZXhPZik7R3Aoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6IVlwKCJpbmNsdWRlcyIpfSx7aW5jbHVkZXM6ZnVuY3Rpb24odCl7cmV0dXJuISF+cXAoWHAoJHAodGhpcykpLFhwKFZwKHQpKSxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIFFwPV9sKCJTdHJpbmciLCJpbmNsdWRlcyIpLHRfPW90LGVfPUtwLHJfPVFwLG5fPUFycmF5LnByb3RvdHlwZSxpXz1TdHJpbmcucHJvdG90eXBlLG9fPWUoKGZ1bmN0aW9uKHQpe3ZhciBlPXQuaW5jbHVkZXM7cmV0dXJuIHQ9PT1uX3x8dF8obl8sdCkmJmU9PT1uXy5pbmNsdWRlcz9lXzoic3RyaW5nIj09dHlwZW9mIHR8fHQ9PT1pX3x8dF8oaV8sdCkmJmU9PT1pXy5pbmNsdWRlcz9yXzplfSkpO2Z1bmN0aW9uIHNfKHQsZSl7aWYobnVsbD09dClyZXR1cm57fTt2YXIgcixuLGk9ZnVuY3Rpb24odCxlKXtpZihudWxsPT10KXJldHVybnt9O3ZhciByPXt9O2Zvcih2YXIgbiBpbiB0KWlmKHt9Lmhhc093blByb3BlcnR5LmNhbGwodCxuKSl7aWYob18oZSkuY2FsbChlLG4pKWNvbnRpbnVlO3Jbbl09dFtuXX1yZXR1cm4gcn0odCxlKTtpZihXbCl7dmFyIG89V2wodCk7Zm9yKG49MDtuPG8ubGVuZ3RoO24rKylyPW9bbl0sb18oZSkuY2FsbChlLHIpfHx7fS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHQscikmJihpW3JdPXRbcl0pfXJldHVybiBpfWNvbnN0IGFfPVsibWVzc2FnZSJdO3ZhciBjXyx1XyxsXz1uZXcgY2xhc3N7Y29uc3RydWN0b3IoKXtsbCh0aGlzLCJuYW1lIiwiTG9uZ1N0cmluZ1JlcG9ydG9yIiksbGwodGhpcywiaW5CdWZmZXIiLFtdKSxsbCh0aGlzLCJvdXRCdWZmZXIiLFtdKX1wdXNoKHQpe3QubWVzc2FnZSYmdGhpcy5pbkJ1ZmZlci5wdXNoKFhoKFhoKHt9LHQpLHt9LHttZXNzYWdlOntpZDpMbCgpLnNsaWNlKDAsMyksaW5kZXg6MCxlbmQ6ITAsbXNnOnQubWVzc2FnZX19KSl9c3BsaWNlKHQpe2NvbnN0IGU9W107bGV0IHI9MDtmb3IoO3RoaXMub3V0QnVmZmVyLmxlbmd0aDspe2NvbnN0IG49SlNPTi5zdHJpbmdpZnkodGhpcy5vdXRCdWZmZXJbMF0pLmxlbmd0aDtpZighKG48dCkpYnJlYWs7dC09bixyKz1uLGUucHVzaCh0aGlzLm91dEJ1ZmZlci5zaGlmdCgpKX1mb3IoO3RoaXMuaW5CdWZmZXJbMF0mJnQ+MDspe2NvbnN0IG49dGhpcy5pbkJ1ZmZlclswXSx7bWVzc2FnZTppfT1uLG89WGgoWGgoe30sc18obixhXykpLHt9LHttZXNzYWdlOlhoKFhoKHt9LGkpLHt9LHttc2c6IiJ9KX0pLHM9SlNPTi5zdHJpbmdpZnkobykubGVuZ3RoLGE9dC1zLGM9WGgoe30sbyk7aWYoYT5pLm1zZy5sZW5ndGgpYy5tZXNzYWdlLm1zZz1pLm1zZyx0aGlzLmluQnVmZmVyLnNoaWZ0KCk7ZWxzZXtpZighKGE+PTEwKSlicmVhazt7Y29uc3QgdD1pLm1zZy5zbGljZSgwLGEpO2MubWVzc2FnZS5tc2c9dCxjLm1lc3NhZ2UuZW5kPSExLHRoaXMuaW5CdWZmZXJbMF0ubWVzc2FnZS5tc2c9aS5tc2cuc2xpY2UoYSksdGhpcy5pbkJ1ZmZlclswXS5tZXNzYWdlLmluZGV4Kyt9fWNvbnN0IHU9SlNPTi5zdHJpbmdpZnkoYy5tZXNzYWdlKSxsPXUubGVuZ3RoO3QtPWwrcyxyKz1sK3MsZS5wdXNoKFhoKFhoKHt9LGMpLHt9LHttZXNzYWdlOnV9KSl9cmV0dXJue3BheWxvYWQ6ZSxwYXlsb2FkU2l6ZTpyfX11bnNoaWZ0KHQpe3RoaXMub3V0QnVmZmVyPXQuY29uY2F0KHRoaXMub3V0QnVmZmVyKX1nZXQoKXtyZXR1cm5bLi4udGhpcy5vdXRCdWZmZXIsLi4udGhpcy5pbkJ1ZmZlci5tYXAoKHQ9PlhoKFhoKHt9LHQpLHt9LHttZXNzYWdlOkpTT04uc3RyaW5naWZ5KHQubWVzc2FnZSl9KSkpXX1zZXQodCl7dC5mb3JFYWNoKCh0PT57IWZ1bmN0aW9uKHQpe3JldHVybiB2b2lkIDAhPT10LnJlcG9ydF9pZH0odCk/KHQubWVzc2FnZXx8KHQubWVzc2FnZT0iIiksdGhpcy5pbkJ1ZmZlci5wdXNoKFhoKFhoKHt9LHQpLHt9LHttZXNzYWdlOkpTT04ucGFyc2UodC5tZXNzYWdlKX0pKSk6dGhpcy5vdXRCdWZmZXIucHVzaCh0KX0pKSx0aGlzLm91dEJ1ZmZlcj1bXS5jb25jYXQodGhpcy5vdXRCdWZmZXIpLHRoaXMuaW5CdWZmZXI9W10uY29uY2F0KHRoaXMuaW5CdWZmZXIpfWlzRW1wdHkoKXtyZXR1cm4gMD09PXRoaXMuaW5CdWZmZXIubGVuZ3RoJiYwPT09dGhpcy5vdXRCdWZmZXIubGVuZ3RofX07Y29uc3QgaF89NWU1LGZfPXtwcm9kdWN0X2xpbmU6InJ0YyIscmVwb3J0X3ZlcnNpb246IjUiLG9zOiJ3ZWIiLHVzZXJfYWdlbnQ6QmwoKT8iIjpudWxsPT09KGNfPW5hdmlnYXRvcil8fHZvaWQgMD09PWNfP3ZvaWQgMDpjXy51c2VyQWdlbnQscGxhdGZvcm06IndlYiIscHJvZHVjdDoid2VicnRjIixhcHBfc3RhdGU6ImFjdGl2ZSJ9LGRfPSJMb2dSZXBvcnRvciIscF89InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJih3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluY2x1ZGVzKCJfcnRjX2RlYnVnXyIpfHwobnVsbD09PSh1Xz13aW5kb3cubG9jYWxTdG9yYWdlKXx8dm9pZCAwPT09dV8/dm9pZCAwOnVfLmdldEl0ZW0oIl9ydGNfZGVidWdfIikpKTtjbGFzcyBfX3tjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJfYnVmZmVyIix2b2lkIDApLHRoaXMuX2J1ZmZlcj1uZXcgVXAodCl9YXN5bmMgc2V0KHQsZSl7YXdhaXQgdGhpcy5fYnVmZmVyLnB1dDJTdHJpbmcodCxlKX1hc3luYyBnZXQodCl7dmFyIGU7bGV0IHI9W107dHJ5e3I9YXdhaXQgdGhpcy5fYnVmZmVyLmdldDRTdHJpbmcodCl9Y2F0Y2gobil7fXJldHVybiBudWxsIT09KGU9cikmJnZvaWQgMCE9PWU/ZTpbXX19dmFyIGdfPW5ldyBjbGFzc3tjb25zdHJ1Y3Rvcigpe2xsKHRoaXMsInJlcG9ydENvbW1vbiIsZl8pLGxsKHRoaXMsInJlcG9ydElkcyIsbmV3IE1hcCksbGwodGhpcywiZGF0YUJ1ZmZlciIsW10pLGxsKHRoaXMsInJlcG9ydG9yTGlzdCIsW10pLGxsKHRoaXMsImRiQnVmZmVyIix2b2lkIDApLGxsKHRoaXMsInBvc3RpbmciLCExKSxsbCh0aGlzLCJzdWNTZW5kVGltZXIiLHZvaWQgMCksbGwodGhpcywicHJlU3VjVGltZSIsMCksbGwodGhpcywiZXJyU2VuZFRpbWVyIix2b2lkIDApLGxsKHRoaXMsImVyclNlbmREZWxheSIsMTAwKSxsbCh0aGlzLCJfbG9nU2VydmVyVXJsIix2b2lkIDApLGxsKHRoaXMsIl9yZXRyeUNvdW50IiwwKSxsbCh0aGlzLCJfcmVwb3J0TGltaXQiLGhfKSxsbCh0aGlzLCJfZGlzYWJsZVRpbWVvdXQiLCExKSxCbCgpfHwod2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsKCgpPT57Y2xlYXJUaW1lb3V0KHRoaXMuZXJyU2VuZFRpbWVyKSxjbGVhclRpbWVvdXQodGhpcy5zdWNTZW5kVGltZXIpLHRoaXMuc2VuZCh2b2lkIDAsITApfSkpLGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInZpc2liaWxpdHljaGFuZ2UiLCgoKT0+eyJ2aXNpYmxlIj09PWRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZT90aGlzLnNldENvbW1vblN0YXRzKHthcHBfc3RhdGU6ImFjdGl2ZSJ9KToiaGlkZGVuIj09PWRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSYmdGhpcy5zZXRDb21tb25TdGF0cyh7YXBwX3N0YXRlOiJiYWNrZ3JvdW5kIn0pfSkpLHBfJiYod2luZG93Ll9fcnRjX2RlYnVnX3JlcG9ydG9yX189dGhpcykpLFVsLm9uKCJVUExPQURfUkVQT1JUX0xJTUlUIiwodD0+e3RoaXMuc2V0UmVwb3J0TGltaXQodCl9KSksVWwub24oIkVOQUJMRV9SRVBPUlRfSURCX0JVRkZFUiIsKHQ9Pnt0JiZ0aGlzLmVuYWJsZUluZGV4ZWREQkJ1ZmZlcigpfSkpLHNldFRpbWVvdXQoKCgpPT57dGhpcy5yZXBvcnRvckxpc3QucHVzaCh4XyksdGhpcy5yZXBvcnRvckxpc3QucHVzaChsXyl9KSl9c2V0VXJsKHQpe3RoaXMuX2xvZ1NlcnZlclVybD10fXNldENvbW1vblN0YXRzKHQpe3RoaXMucmVwb3J0Q29tbW9uPU9iamVjdC5hc3NpZ24odGhpcy5yZXBvcnRDb21tb24sdCl9Z2V0Q29tbW9uU3RhdHMoKXtyZXR1cm4gdGhpcy5yZXBvcnRDb21tb259c2V0UmVwb3J0TGltaXQodCl7dGhpcy5fcmVwb3J0TGltaXQ9TWF0aC5tYXgodCw1ZTQpLHRoaXMuX3JlcG9ydExpbWl0PU1hdGgubWluKHQsNWU1KX1nZXRSZXBvcnRJZCh0KXt2YXIgZTt0PW51bGwhPT0oZT10KSYmdm9pZCAwIT09ZT9lOiJfX2dsb2JhbF9fIix0aGlzLnJlcG9ydElkcy5oYXModCl8fHRoaXMucmVwb3J0SWRzLnNldCh0LDApO2xldCByPXRoaXMucmVwb3J0SWRzLmdldCh0KTtyZXR1cm4gdm9pZCAwPT09ciYmKHZfKCJubyByZXBvcnRJZCBpbiByZXBvcnRJZCBtYXAgd2l0aCBlbmdpbmUtc2Vzc2lvbi1pZCAiLmNvbmNhdCh0KSwwLHt9KSxyPTApLHRoaXMucmVwb3J0SWRzLnNldCh0LHIrMSkscn1wdXNoKHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdJiZhcmd1bWVudHNbMV0pdGhpcy5zZW5kKHQpO2Vsc2V7dmFyIGU7Y29uc3Qgcj1udWxsIT09KGU9dC5lbmdpbmVfc2Vzc2lvbl9pZCkmJnZvaWQgMCE9PWU/ZToiX19nbG9iYWxfXyI7dGhpcy5yZXBvcnRJZHMuaGFzKHIpfHx0aGlzLnJlcG9ydElkcy5zZXQociwwKSx0aGlzLmRhdGFCdWZmZXIucHVzaCh0KSwhdGhpcy5wb3N0aW5nJiYhdGhpcy5lcnJTZW5kVGltZXImJkRhdGUubm93KCktdGhpcy5wcmVTdWNUaW1lPjJlMyYmKGNsZWFyVGltZW91dCh0aGlzLnN1Y1NlbmRUaW1lciksdGhpcy5zZW5kKCkpfX1lbmFibGVJbmRleGVkREJCdWZmZXIoKXt0aGlzLmRiQnVmZmVyfHwodGhpcy5kYkJ1ZmZlcj1uZXcgX18oIlJlcG9ydG9yREJCdWZmZXIiKSx0aGlzLmRiQnVmZmVyLmdldChkXykudGhlbigodD0+e3QuZm9yRWFjaCgodD0+e3RoaXMucHVzaCh0KX0pKX0pKSx0aGlzLnJlcG9ydG9yTGlzdC5mb3JFYWNoKCh0PT57dmFyIGU7bnVsbD09PShlPXRoaXMuZGJCdWZmZXIpfHx2b2lkIDA9PT1lfHxlLmdldCh0Lm5hbWUpLnRoZW4oKGU9Pnt0LnNldChlKX0pKX0pKSl9YmFja3VwKCl7dHJ5e3ZhciB0O251bGw9PT0odD10aGlzLmRiQnVmZmVyKXx8dm9pZCAwPT09dHx8dC5zZXQoWy4uLnRoaXMuZGF0YUJ1ZmZlcl0sZF8pLHRoaXMucmVwb3J0b3JMaXN0LmZvckVhY2goKHQ9Pnt2YXIgZTtudWxsPT09KGU9dGhpcy5kYkJ1ZmZlcil8fHZvaWQgMD09PWV8fGUuc2V0KFsuLi50LmdldCgpXSx0Lm5hbWUpfSkpfWNhdGNoKGUpe3ZfKCJFcnJvciB3aGVuIHNhdmUgbG9nIGludG8gSURCIiwtMSxlKX19dW5zaGlmdCh0KXt0aGlzLmRhdGFCdWZmZXI9dFswXS5jb25jYXQodGhpcy5kYXRhQnVmZmVyKSx0aGlzLnJlcG9ydG9yTGlzdC5mb3JFYWNoKCgoZSxyKT0+e3ZhciBuO2UudW5zaGlmdChudWxsIT09KG49dFtyKzFdKSYmdm9pZCAwIT09bj9uOltdKX0pKX1fc3BsaWNlKCl7bGV0IHQ9ZnVuY3Rpb24odCxlKXtsZXQgcj0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWlmKHIrPUpTT04uc3RyaW5naWZ5KHRbbl0pLmxlbmd0aCxyPmUpcmV0dXJuIG47cmV0dXJuIHQubGVuZ3RofSh0aGlzLmRhdGFCdWZmZXIsdGhpcy5fcmVwb3J0TGltaXQpOzA9PT10JiZ0aGlzLmRhdGFCdWZmZXIubGVuZ3RoPjAmJih0aGlzLl9yZXBvcnRMaW1pdD1KU09OLnN0cmluZ2lmeSh0aGlzLmRhdGFCdWZmZXJbMF0pLmxlbmd0aCsxMCx0PTEsdl8oInVwZGF0ZSByZXBvcnQgbGltaXQgdG8gIi5jb25jYXQodGhpcy5fcmVwb3J0TGltaXQpLDAsbnVsbCkpO2NvbnN0IGU9dGhpcy5kYXRhQnVmZmVyLnNwbGljZSgwLHQpLHI9SlNPTi5zdHJpbmdpZnkoZSkubGVuZ3RoLG49W2VdO2xldCBpPXRoaXMuX3JlcG9ydExpbWl0LXI7cmV0dXJuIHRoaXMucmVwb3J0b3JMaXN0LmZvckVhY2goKHQ9Pntjb25zdHtwYXlsb2FkOmUscGF5bG9hZFNpemU6cn09dC5zcGxpY2UoaSk7ZS5mb3JFYWNoKCh0PT57dmFyIGUscixuO3ZvaWQgMD09PXQucmVwb3J0X2lkJiYodC5yZXBvcnRfaWQ9dGhpcy5nZXRSZXBvcnRJZCh0LmVuZ2luZV9zZXNzaW9uX2lkKSwhQmwoKSYmd2luZG93Ll9fb25SVENSZXBvcnQmJihudWxsPT09KGU9KHI9d2luZG93KS5fX29uUlRDUmVwb3J0KXx8dm9pZCAwPT09ZXx8ZS5jYWxsKHIsbnVsbCE9PShuPXQuZW5naW5lX3Nlc3Npb25faWQpJiZ2b2lkIDAhPT1uP246Imdsb2JhbCIsdCx0aGlzLmdldENvbW1vblN0YXRzKCkpKSl9KSksbi5wdXNoKGUpLGktPXJ9KSksbn1hc3luYyBzZW5kKHQsZSl7dGhpcy5iYWNrdXAoKTtjb25zdCByPXRoaXMucmVwb3J0b3JMaXN0LnJlZHVjZSgoKHQsZSk9PnQmJmUuaXNFbXB0eSgpKSwhMCk7aWYoIXQmJiF0aGlzLmRhdGFCdWZmZXIubGVuZ3RoJiZyfHwhdGhpcy5fbG9nU2VydmVyVXJsKXJldHVybjt0fHwodGhpcy5wb3N0aW5nPSEwKTtsZXQgbj1bXTt0fHwobj10aGlzLl9zcGxpY2UoKSk7Y29uc3QgaT1wXyxvPXtkYXRhOnR8fGZmKG4pLmNhbGwobiksaGVhZGVyOlhoKFhoKHt9LHRoaXMucmVwb3J0Q29tbW9uKSx7fSx7aHR0cF9yZXRyeV9jb3VudDp0aGlzLl9yZXRyeUNvdW50fSksZnJvbToid2ViIixvczoid2ViIix2ZXJzaW9uOiIxIn0scz17bWV0aG9kOiJQT1NUIixib2R5Omk/SlNPTi5zdHJpbmdpZnkobyk6UHAuZ3ppcChKU09OLnN0cmluZ2lmeShvKSl9O2lmKCF0aGlzLl9kaXNhYmxlVGltZW91dCl0cnl7Y29uc3QgdD1uZXcgQWJvcnRDb250cm9sbGVyO3Muc2lnbmFsPXQuc2lnbmFsLHNldFRpbWVvdXQoKCgpPT57dC5hYm9ydCgpfSksMWU0KX1jYXRjaChsKXtjb25zb2xlLndhcm4oIkFib3J0Q29udHJvbGxlciBpcyBub3Qgc3VwcG9ydGVkIiksdGhpcy5fZGlzYWJsZVRpbWVvdXQ9ITB9aXx8KHMuaGVhZGVycz17IkNvbnRlbnQtRW5jb2RpbmciOiJnemlwIiwiQ29udGVudC1UeXBlIjoiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04In0pO2xldCBhLGMsdT1udWxsO3RyeXthPWF3YWl0IGZldGNoKHRoaXMuX2xvZ1NlcnZlclVybCxzKSwyMDAhPT1hLnN0YXR1cyYmMzA0IT09YS5zdGF0dXN8fCh1PUpTT04ucGFyc2UoYXdhaXQgYS50ZXh0KCkpKX1jYXRjaChoKXtjPWh9dHx8KHRoaXMucG9zdGluZz0hMSksdSYmMD09PXUuU3RhdHVzQ29kZT90fHxlfHx0aGlzLnN1Y1NlbmQoKTooc2V0VGltZW91dCgoKCk9Pnt2YXIgdCxlLHI7dl8oInJlcG9ydG9yIHBvc3QgZXJyb3IsIHJlc0pTT046Ii5jb25jYXQobnVsbD09PSh0PXUpfHx2b2lkIDA9PT10P3ZvaWQgMDp0LnRvU3RyaW5nKCksIiBlcnI6IikuY29uY2F0KGMpLG51bGwhPT0oZT1udWxsPT09KHI9YSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuc3RhdHVzKSYmdm9pZCAwIT09ZT9lOi0xLGMpfSksMCksdD90aGlzLnNlbmQodCk6KHRoaXMudW5zaGlmdChuKSxlP3RoaXMuc2VuZCgpOnRoaXMuZXJyU2VuZCgpKSl9X2dldERhdGFCdWZmZXJUb3RhbFNpemUoKXtyZXR1cm4gdGhpcy5kYXRhQnVmZmVyLnJlZHVjZSgoKHQsZSk9PnQrSlNPTi5zdHJpbmdpZnkoZSkubGVuZ3RoKSwwKX1zdWNTZW5kKCl7dGhpcy5lcnJTZW5kRGVsYXk9MTAwLHRoaXMuX3JldHJ5Q291bnQ9MCx0aGlzLnByZVN1Y1RpbWU9RGF0ZS5ub3coKTtjb25zdCB0PXRoaXMuX2dldERhdGFCdWZmZXJUb3RhbFNpemUoKT4xZTY/MWUzOjJlMzt0aGlzLnN1Y1NlbmRUaW1lcj1zZXRUaW1lb3V0KCgoKT0+dGhpcy5zZW5kKCkpLHQpfWVyclNlbmQoKXt0aGlzLmVyclNlbmRUaW1lcj1zZXRUaW1lb3V0KCgoKT0+e3RoaXMuc2VuZCgpLGRlbGV0ZSB0aGlzLmVyclNlbmRUaW1lcn0pLHRoaXMuZXJyU2VuZERlbGF5KSx0aGlzLmVyclNlbmREZWxheSo9Mix0aGlzLl9yZXRyeUNvdW50Kyt9fTtjbGFzcyBtX3tjb25zdHJ1Y3Rvcih0KXtsbCh0aGlzLCJfcHJlVGltZSIsRGF0ZS5ub3coKSksbGwodGhpcywiX29uZTJvbmVOdW0iLDApLGxsKHRoaXMsIl9vbmUybWFueU51bSIsMCksbGwodGhpcywiX29uZTJvbmVNc2dDYWNoZSIsbmV3IE1hcCksbGwodGhpcywiX29uZTJtYW55TXNnQ2FjaGUiLG5ldyBNYXApLGxsKHRoaXMsInJvb21JZCIsIiIpLGxsKHRoaXMsInVzZXJJZCIsIiIpLGxsKHRoaXMsInJ0c1Nlc3Npb25JZCIsIiIpLGxsKHRoaXMsImxvZ2dlciIsdm9pZCAwKSxsbCh0aGlzLCJzZXJ2ZXJVcmwiLCJzZXJ2ZXIiKSx0aGlzLmlkPXQsdGhpcy5sb2dnZXI9bmV3IERfKCJNZXNzYWdlUmVwb3J0b3IiLDEpfW5lZWRSZXBvcnQodCl7cmV0dXJuISFtXy5jb25maWcmJihEYXRlLm5vdygpLXRoaXMuX3ByZVRpbWU+PTM2ZTUmJih0aGlzLl9wcmVUaW1lPURhdGUubm93KCksdGhpcy5fb25lMm9uZU51bT0wLHRoaXMuX29uZTJtYW55TnVtPTApLCJvbmUyb25lIj09PXQmJnRoaXMuX29uZTJvbmVOdW08bV8uY29uZmlnLm1heF9vbmUyb25lX2ZwdF9wZXJfaG91ciYmTWF0aC5yYW5kb20oKTw9bV8uY29uZmlnLm9uZTJvbmVfZnB0X3JhdGlvLzEwMHx8Im9uZTJtYW55Ij09PXQmJnRoaXMuX29uZTJtYW55TnVtPG1fLmNvbmZpZy5tYXhfb25lMm1hbnlfZnB0X3Blcl9ob3VyJiZNYXRoLnJhbmRvbSgpPD1tXy5jb25maWcub25lMm1hbnlfZnB0X3JhdGlvLzEwMCl9Y2FjaGVQMlBNc2codCl7dmFyIGU7dGhpcy5fb25lMm9uZU1zZ0NhY2hlLnNldCh0Lm1zZ19pZCxYaCh7Y29uZmlnX3ZlcnNpb246KG51bGw9PT0oZT1tXy5jb25maWcpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLnZlcnNpb24pfHwiIn0sdCkpfXVwZGF0ZVAyUE1zZyh0LGUpe2NvbnN0IHI9dGhpcy5fb25lMm9uZU1zZ0NhY2hlLmdldCh0KTtyJiZ0aGlzLl9vbmUyb25lTXNnQ2FjaGUuc2V0KHQsWGgoWGgoe30sciksZSkpfWNhY2hlQ3VzdG9tTXNnKHQpe3ZhciBlO3RoaXMuX29uZTJtYW55TXNnQ2FjaGUuc2V0KHQubXNnX2lkLFhoKHtjb25maWdfdmVyc2lvbjoobnVsbD09PShlPW1fLmNvbmZpZyl8fHZvaWQgMD09PWU/dm9pZCAwOmUudmVyc2lvbil8fCIifSx0KSl9dXBkYXRlT25lMk1hbnlNc2codCxlKXtjb25zdCByPXRoaXMuX29uZTJtYW55TXNnQ2FjaGUuZ2V0KHQpO3ImJnRoaXMuX29uZTJtYW55TXNnQ2FjaGUuc2V0KHQsWGgoWGgoe30sciksZSkpfXJlcG9ydFAyUE1zZyh0KXtjb25zdCBlPXRoaXMuX29uZTJvbmVNc2dDYWNoZS5nZXQodCk7dmFyIHI7ZSYmKHRoaXMubG9nZ2VyLmluZm8oInJlcG9ydFAyUE1zZyIsZS50eXBlLEpTT04uc3RyaW5naWZ5KGUpKSxudWxsPT09KHI9d18odGhpcy5pZCkpfHx2b2lkIDA9PT1yfHxyLnJlcG9ydCgicnRzX21lc3NhZ2UiLGUpKX1yZXBvcnRPbmUyTWFueU1zZyh0KXtjb25zdCBlPXRoaXMuX29uZTJtYW55TXNnQ2FjaGUuZ2V0KHQpO3ZhciByO2UmJih0aGlzLmxvZ2dlci5pbmZvKCJyZXBvcnRPbmUyTWFueU1zZyIsZS50eXBlLEpTT04uc3RyaW5naWZ5KGUpKSxudWxsPT09KHI9d18odGhpcy5pZCkpfHx2b2lkIDA9PT1yfHxyLnJlcG9ydCgicnRzX21lc3NhZ2UiLGUpKX1yZXBvcnRNc2dSZWN2KHQpe3ZhciBlLHI7dC5jb25maWdfdmVyc2lvbj0obnVsbD09PShlPW1fLmNvbmZpZyl8fHZvaWQgMD09PWU/dm9pZCAwOmUudmVyc2lvbil8fCIiLHRoaXMubG9nZ2VyLmluZm8oInJlcG9ydE1zZ1JlY3YiLHQudHlwZSxKU09OLnN0cmluZ2lmeSh0KSksbnVsbD09PShyPXdfKHRoaXMuaWQpKXx8dm9pZCAwPT09cnx8ci5yZXBvcnQoInJ0c19tZXNzYWdlIix0KX1kZXN0cm95KCl7dGhpcy5fb25lMm1hbnlOdW09MCx0aGlzLl9vbmUyb25lTnVtPTAsdGhpcy5fb25lMm1hbnlNc2dDYWNoZS5jbGVhcigpLHRoaXMuX29uZTJvbmVNc2dDYWNoZS5jbGVhcigpLHRoaXMuX3ByZVRpbWU9RGF0ZS5ub3coKSx0aGlzLnJvb21JZD0iIix0aGlzLnVzZXJJZD0iIix0aGlzLnJ0c1Nlc3Npb25JZD0iIn19bGwobV8sImNvbmZpZyIsdm9pZCAwKTtjb25zdCB5Xz1uZXcgY2xhc3N7Y29uc3RydWN0b3IodCl7bGwodGhpcywibW9kaWZ5SWRzIix7cHJlX2Nvbm5lY3Rpb246ITF9KSx0aGlzLmlkPXR9cmVwb3J0KHQsZSxyKXtjb25zdCBuPVhoKFhoKFhoKHtldmVudF9rZXk6dCxydGNfdGltZXN0YW1wOkRhdGUubm93KCl9LHRoaXMubW9kaWZ5SWRzKSxlKSx7fSx7cmVwb3J0X2lkOmdfLmdldFJlcG9ydElkKHRoaXMubW9kaWZ5SWRzLmVuZ2luZV9zZXNzaW9uX2lkKX0pO3ZhciBpLG87KCJvYmplY3QiPT10eXBlb2YgciYmT2JqZWN0LmtleXMocikubGVuZ3RoPjAmJihuLmNvbW1vbl9leHRyYV9pbmZvPUpTT04uc3RyaW5naWZ5KHIpKSxPYmplY3Qua2V5cyhuKS5mb3JFYWNoKCh0PT57dm9pZCAwIT09blt0XSYmIiIhPT1uW3RdfHxkZWxldGUgblt0XX0pKSwhQmwoKSYmd2luZG93Ll9fb25SVENSZXBvcnQpJiYobnVsbD09PShpPShvPXdpbmRvdykuX19vblJUQ1JlcG9ydCl8fHZvaWQgMD09PWl8fGkuY2FsbChvLHRoaXMubW9kaWZ5SWRzLmVuZ2luZV9zZXNzaW9uX2lkLG4sZ18uZ2V0Q29tbW9uU3RhdHMoKSkpOyJVVCIhPT17fS5WSVRFX1RFU1QmJmdfLnB1c2gobil9cmVwb3J0TG9nKHQpe2NvbnN0IGU9WGgoWGgoe2V2ZW50X2tleToicnRjX2ludm9rZV9zdGF0dXMiLHNka19hcGlfbmFtZToiY29uc29sZV9sb2ciLHJ0Y190aW1lc3RhbXA6RGF0ZS5ub3coKX0sdGhpcy5tb2RpZnlJZHMpLHt9LHttZXNzYWdlOnR9KTt4Xy5wdXNoKGUpfXJlcG9ydExvbmdTdHJpbmcodCxlKXtjb25zdCByPVhoKFhoKHtldmVudF9rZXk6InJ0Y19pbnZva2Vfc3RhdHVzIixzZGtfYXBpX25hbWU6InNka19sb25nX3N0cmluZ18iLmNvbmNhdCh0KSxydGNfdGltZXN0YW1wOkRhdGUubm93KCl9LHRoaXMubW9kaWZ5SWRzKSx7fSx7bWVzc2FnZTplfSk7bF8ucHVzaChyKX1zZXQodCl7dGhpcy5tb2RpZnlJZHM9T2JqZWN0LmFzc2lnbih0aGlzLm1vZGlmeUlkcyx0KX1kZXN0cm95KCl7fX0oImdsb2JhbCIpLHZfPSh0LGUscik9Pnt5Xy5yZXBvcnQoInJ0Y19lcnJvciIse21lc3NhZ2U6dCxlcnJvcl9jb2RlOmV9LHIpfTtjb25zdCBiXz1uZXcgTWFwLHdfPXQ9PmJfLmdldCh0KSxTXz0idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmxvY2F0aW9uLnNlYXJjaC5pbmNsdWRlcygiX3J0Y191cGxvYWRfY29uc29sZV8iKTtmdW5jdGlvbiBrXyh0LGUpe3JldHVybiB0Lm1hcCgodD0+e2xldCByPSIiO3RyeXtpZigic3RyaW5nIj09dHlwZW9mIHQpcmV0dXJuIHQ7aWYodm9pZCAwPT09dClyZXR1cm4idW5kZWZpbmVkIjtpZihudWxsPT09dClyZXR1cm4ibnVsbCI7aWYodCBpbnN0YW5jZW9mIE1lZGlhU3RyZWFtVHJhY2spcmV0dXJuIE5sKHQpO2lmKHQgaW5zdGFuY2VvZiBNZWRpYVN0cmVhbSlyZXR1cm4gbnVsbD09KGk9dCk/InVuZGVmaW5lZCB8IG51bGwiOiJzdHJpbmciPT10eXBlb2YgaT9pOkpTT04uc3RyaW5naWZ5KHtpZDppLmlkLGFjdGl2ZTppLmFjdGl2ZX0pO2lmKHQgaW5zdGFuY2VvZiBSVENSdHBTZW5kZXIpcmV0dXJuIFJsKHQpO2lmKHQgaW5zdGFuY2VvZiBSVENSdHBSZWNlaXZlcilyZXR1cm4gemwodCk7aWYodCBpbnN0YW5jZW9mIFJUQ1J0cFRyYW5zY2VpdmVyKXJldHVybiBudWxsPT0obj10KT8idW5kZWZpbmVkIHwgbnVsbCI6InN0cmluZyI9PXR5cGVvZiBuP246SlNPTi5zdHJpbmdpZnkoe2N1cnJlbnREaXJlY3Rpb246bi5jdXJyZW50RGlyZWN0aW9uLGRpcmVjdGlvbjpuLmRpcmVjdGlvbixtaWQ6bi5taWQsc3RvcHBlZDpuLnN0b3BwZWQscmVjZWl2ZXI6emwobi5yZWNlaXZlciksc2VuZGVyOlJsKG4uc2VuZGVyKX0pO3I9SlNPTi5zdHJpbmdpZnkodCl9Y2F0Y2gobyl7cj10LnRvU3RyaW5nKCl9dmFyIG4saTtyZXR1cm4gciYmci5sZW5ndGg+PWUmJihyPXIuc2xpY2UoMCxlKSkscn0pKS5qb2luKCIsICIpfXZhciBPXyx4Xz1uZXcgY2xhc3N7Y29uc3RydWN0b3IoKXtsbCh0aGlzLCJuYW1lIiwiQ29uc29sZVJlcG9ydG9yIiksbGwodGhpcywiX3V1aWQiLCIiLmNvbmNhdChNYXRoLmZsb29yKDg5OSpNYXRoLnJhbmRvbSgpKSsxMDApKSxsbCh0aGlzLCJfY29uc29sZVJlcG9ydElkIiwwKSxsbCh0aGlzLCJfZW5naW5lUmVwb3J0SWRNYXAiLG5ldyBNYXApLGxsKHRoaXMsIl9lbmFibGVkIiwiTlVMTCIpLGxsKHRoaXMsIl9jb25zb2xlQ3V0TGVuZ3RoIixVbC5nZXRQYXJhbWV0ZXIoIlVQTE9BRF9DT05TT0xFX0xFTkdUSF9DVVQiKSksbGwodGhpcywiYnVmZmVyIixbXSksU18mJnNldFRpbWVvdXQoKCgpPT57dGhpcy5zd2l0Y2hPbigpfSksMCksVWwub24oIlVQTE9BRF9DT05TT0xFX09OIiwodD0+e3Q/dGhpcy5zd2l0Y2hPbigpOnRoaXMudHVybk9mZigpfSkpLFVsLm9uKCJVUExPQURfQ09OU09MRV9MRU5HVEhfQ1VUIiwodD0+e3RoaXMuX2NvbnNvbGVDdXRMZW5ndGg9dH0pKX1nZXQgZW5hYmxlZCgpe3JldHVybiJPRkYiIT09dGhpcy5fZW5hYmxlZH1zd2l0Y2hPbigpeyJOVUxMIj09PXRoaXMuX2VuYWJsZWQmJihjb25zb2xlLmxvZygiW0xvZ2dlclJlcG9ydG9yLmNvbnN0cnVjdG9yXSBjb25zb2xlIHVwbG9hZCBzd2l0Y2ggT04iKSx0aGlzLl9lbmFibGVkPSJPTiIpfXR1cm5PZmYoKXsiTlVMTCI9PT10aGlzLl9lbmFibGVkJiYoY29uc29sZS5sb2coIltMb2dnZXJSZXBvcnRvci5jb25zdHJ1Y3Rvcl0gY29uc29sZSB1cGxvYWQgc3dpdGNoIE9GRiIpLHRoaXMuX2VuYWJsZWQ9Ik9GRiIsdGhpcy5idWZmZXI9W10pfWdldEVuZ2luZUNvbnNvbGVJZCh0KXt2YXIgZTtjb25zdCByPW51bGwhPT0oZT10aGlzLl9lbmdpbmVSZXBvcnRJZE1hcC5nZXQodCkpJiZ2b2lkIDAhPT1lP2U6MDtyZXR1cm4gdGhpcy5fZW5naW5lUmVwb3J0SWRNYXAuc2V0KHQscisxKSxyfXJlcG9ydCh0LGUscixuLGksbyxzLGEsYyl7aWYoIk9GRiI9PT10aGlzLl9lbmFibGVkKXJldHVybjtjb25zdCB1PXdfKGUpLGw9dGhpcy5fY29uc29sZVJlcG9ydElkKyssaD10aGlzLmdldEVuZ2luZUNvbnNvbGVJZChlKSxmPWtfKGMsdGhpcy5fY29uc29sZUN1dExlbmd0aCksZD1bLi4uY10scD0iIi5jb25jYXQoYSkucmVwbGFjZSgvJW98JXMvZ2ksKCgpPT5rXyhbZC5zaGlmdCgpXSx0aGlzLl9jb25zb2xlQ3V0TGVuZ3RoKSkpLF89IlsiLmNvbmNhdCh0aGlzLl91dWlkLCItIikuY29uY2F0KGwsIl1bIikuY29uY2F0KGUsIi0iKS5jb25jYXQoaCwiXS0iKS5jb25jYXQociwiLSIpLmNvbmNhdCh0LCJbIikuY29uY2F0KG4sIl0iKS5jb25jYXQoaSwiWyIpLmNvbmNhdChvLCIuIikuY29uY2F0KHMsIl0gIikuY29uY2F0KHAsIiAiKS5jb25jYXQoZik7dmFyIGc7dT91LnJlcG9ydExvZyhfKTooZz1fLHlfLnJlcG9ydExvZyhnKSl9cHVzaCh0KXsiT0ZGIiE9PXRoaXMuX2VuYWJsZWQmJnRoaXMuYnVmZmVyLnB1c2godCl9c3BsaWNlKHQpe2lmKCJPTiIhPT10aGlzLl9lbmFibGVkKXJldHVybntwYXlsb2FkOltdLHBheWxvYWRTaXplOjB9O2NvbnN0e2luZGV4OmUsc2l6ZTpyfT1mdW5jdGlvbih0LGUpe2xldCByPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspe2NvbnN0IGk9SlNPTi5zdHJpbmdpZnkodFtuXSkubGVuZ3RoO2lmKHIrPWkscj5lKXJldHVybntpbmRleDpuLHNpemU6ci1pfX1yZXR1cm57aW5kZXg6dC5sZW5ndGgsc2l6ZTpyfX0odGhpcy5idWZmZXIsdCk7cmV0dXJue3BheWxvYWQ6dGhpcy5idWZmZXIuc3BsaWNlKDAsZSkscGF5bG9hZFNpemU6cn19dW5zaGlmdCh0KXt0aGlzLmJ1ZmZlcj10LmNvbmNhdCh0aGlzLmJ1ZmZlcil9Z2V0KCl7cmV0dXJuIHRoaXMuYnVmZmVyfXNldCh0KXt0aGlzLmJ1ZmZlcj10LmNvbmNhdCh0aGlzLmJ1ZmZlcil9aXNFbXB0eSgpe3JldHVybiJPRkYiPT09dGhpcy5fZW5hYmxlZHx8MD09PXRoaXMuYnVmZmVyLmxlbmd0aH19O2NvbnN0IEVfPSJbVkVSVENdIixBXz0iIzAwNTBiMyIsQ189e0RFQlVHOiJyZ2JhKDAsIDAsIDAsIDApIiwiIElORk8iOiJyZ2JhKDkzLCAxNzMsIDIyNiwgMCkiLCIgV0FSTiI6InJnYmEoMjU1LCAxMTksIDAsIDAuMykiLEVSUk9SOiJyZ2JhKDI1NSwgMCwgMCwgMC4zKSIsIiBTVUNDIjoicmdiYSgwLCAxMTksIDAsIDAuMykifSxJXz0idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guaW5jbHVkZXMoIl9ydGNfZGVidWdfIil8fChudWxsPT09KE9fPXdpbmRvdy5sb2NhbFN0b3JhZ2UpfHx2b2lkIDA9PT1PXz92b2lkIDA6T18uZ2V0SXRlbSgiX3J0Y19kZWJ1Z18iKSkpO2NvbnN0IFRfPSgpPT57Y29uc3QgdD1uZXcgRGF0ZTtyZXR1cm4iIi5jb25jYXQodC50b1RpbWVTdHJpbmcoKS5zcGxpdCgiICIpWzBdLCI6IikuY29uY2F0KHQuZ2V0TWlsbGlzZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgzLCIwIikpfTt2YXIgTF8sQl8sTl8sUl8sel8sRF89Y2xhc3N7Y29uc3RydWN0b3IodCxlKXtsZXQgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06Imdsb2JhbCI7bGwodGhpcywiaW5kZW50Iix2b2lkIDApLGxsKHRoaXMsIm1vZHVsZSIsdm9pZCAwKSxsbCh0aGlzLCJfZW5naW5lSWQiLHZvaWQgMCksdGhpcy5tb2R1bGU9dCx0aGlzLmluZGVudD1lLHRoaXMuX2VuZ2luZUlkPXJ9X3ByaW50KHQsZSl7Zm9yKHZhciByPWFyZ3VtZW50cy5sZW5ndGgsbj1uZXcgQXJyYXkocj4yP3ItMjowKSxpPTI7aTxyO2krKyluW2ktMl09YXJndW1lbnRzW2ldO2NvbnN0IG89bi5zaGlmdCgpO3RyeXtjb25zdCB0PVsuLi5uXSxyPSIiLmNvbmNhdChvKS5yZXBsYWNlKC8lby9naSwoKCk9Pntjb25zdCBlPXQuc2hpZnQoKTtyZXR1cm4gSlNPTi5zdHJpbmdpZnkoZSl9KSk7TWwuc2V0KCIiLmNvbmNhdChFXywiWyIpLmNvbmNhdCh0aGlzLm1vZHVsZSwiLiIpLmNvbmNhdChlLCJdICIpLmNvbmNhdChyLCIgIikuY29uY2F0KHQubWFwKCh0PT5KU09OLnN0cmluZ2lmeSh0KSkpLmpvaW4oIiwgIikpKX1jYXRjaCgkZyl7fWxldCBzPSIiO2ZvcihsZXQgYz0wO2M8dGhpcy5pbmRlbnQ7YysrKXMrPSIgICAgIjtjb25zdCBhPVRfKCk7eF8ucmVwb3J0KEVfLHRoaXMuX2VuZ2luZUlkLGEsdCxzLHRoaXMubW9kdWxlLGUsbyxuKSxJXyYmY29uc29sZS5sb2coIiVjIi5jb25jYXQoYSwiLSIpLmNvbmNhdChFXywiJWNbIikuY29uY2F0KHQsIl0lYyIpLmNvbmNhdChzLCJbIikuY29uY2F0KHRoaXMubW9kdWxlLCIuIikuY29uY2F0KGUsIl0gIikuY29uY2F0KG8pLCJjb2xvcjoiLmNvbmNhdChBXywiOyIpLCJiYWNrZ3JvdW5kLWNvbG9yOiIuY29uY2F0KENfW3RdLCI7IiksImNvbG9yOiIuY29uY2F0KEFfLCI7IiksLi4ubil9cHJpbnQodCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO3RoaXMuX3ByaW50KCIgSU5GTyIsdCwuLi5yKX1kZWJ1Zyh0KXtmb3IodmFyIGU9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheShlPjE/ZS0xOjApLG49MTtuPGU7bisrKXJbbi0xXT1hcmd1bWVudHNbbl07dGhpcy5fcHJpbnQoIkRFQlVHIix0LC4uLnIpfWluZm8odCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO3RoaXMuX3ByaW50KCIgSU5GTyIsdCwuLi5yKX13YXJuKHQpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGU+MT9lLTE6MCksbj0xO248ZTtuKyspcltuLTFdPWFyZ3VtZW50c1tuXTt0aGlzLl9wcmludCgiIFdBUk4iLHQsLi4ucil9ZXJyb3IodCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO3RoaXMuX3ByaW50KCJFUlJPUiIsdCwuLi5yKX1zdWNjZXNzKHQpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGU+MT9lLTE6MCksbj0xO248ZTtuKyspcltuLTFdPWFyZ3VtZW50c1tuXTt0aGlzLl9wcmludCgiIFNVQ0MiLHQsLi4ucil9fTtjb25zdCBQXz0oKT0+InVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3csTV89UF8oKT8iIjp3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtmdW5jdGlvbiBGXygpe2xldCB0PSJub25lIjtyZXR1cm4gUF8oKXx8KG51bGwhPT1NXy5tYXRjaCgiRmlyZWZveCIpP3Q9Im1vemlsbGEiOm51bGwhPT1NXy5tYXRjaCgiQ2hyb21lIik/KHQ9ImNocm9tZS1zdGFibGUiLG51bGwhPT1NXy5tYXRjaCgiRWxlY3Ryb24iKSYmKHQ9ImVsZWN0cm9uIikpOihudWxsIT09TV8ubWF0Y2goIlNhZmFyaSIpfHxudWxsIT09TV8ubWF0Y2goIkFwcGxlV2ViS2l0IikpJiYodD0ic2FmYXJpIikpLHR9Rl8oKTtjb25zdCBqXz0ic2FmYXJpIj09PUZfKCksVV89ImNocm9tZS1zdGFibGUiPT09Rl8oKTshUF8oKSYmTV8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygibW9iaWxlIik7Y29uc3QgSF89IVBfKCkmJiEhLyhpUGhvbmV8aVBhZHxpUG9kKS9pLmV4ZWMoTV8pLEtfPSFQXygpJiYvQW5kcm9pZC9pLnRlc3QoTV8pO2xldCBKXz0iMCI7Y29uc3QgV189IVBfKCkmJihudWxsPT09KExfPU1fLm1hdGNoKC92ZXJzaW9uXC8oXGQrKS9pKSl8fHZvaWQgMD09PUxfP3ZvaWQgMDpMX1sxXSk7dmFyIFpfO2pfJiZXXyYmKEpfPW51bGw9PT0oWl89bmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvdmVyc2lvblwvKFxkK1wuXGQrKS9pKSl8fHZvaWQgMD09PVpfP3ZvaWQgMDpaX1sxXSk7IVBfKCkmJihudWxsPT09KEJfPU1fLm1hdGNoKC9GaXJlZm94XC8oXGQrKS9pKSl8fHZvaWQgMD09PUJffHxCX1sxXSk7Y29uc3QgR189Sl8sVl89bnVsbCE9PShOXz0hUF8oKSYmKG51bGw9PT0oUl89TV8ubWF0Y2goLyAoW1xkX10rKSBsaWtlIE1hYyBPUyBYL2kpKXx8dm9pZCAwPT09Ul98fG51bGw9PT0oUl89Ul9bMV0pfHx2b2lkIDA9PT1SXz92b2lkIDA6Ul8uc3BsaXQoIl8iKS5tYXAoKHQ9PnBhcnNlSW50KHQpKSkpKSYmdm9pZCAwIT09Tl8/Tl86W107IVBfKCkmJihudWxsPT09KHpfPU1fLm1hdGNoKC9DaHJvbWVcLyhcZCspL2kpKXx8dm9pZCAwPT09el98fHpfWzFdKTtjb25zdCAkXz0iX19ydGNfcHJvZHVjdFBsYXRmb3JtX18iLFhfPSJSVENfREVWSUNFX0lEIixZXz0iUlRDX0FDQ0VTU19OT0RFIixxXz0iUlRDX0FDQ0VTU19VUkxTIixRXz0iRU5HSU5FX1dFQl9DT05GSUciLHRnPSJTRVJWRVJfQ09ORklHIjtjbGFzcyBlZ3tnZXQodCl7Y29uc3QgZT1sb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0KTtpZighZSlyZXR1cm4gbnVsbDt0cnl7Y29uc3Qgcj1KU09OLnBhcnNlKGUpO3JldHVybiByLnR0bD4wJiZEYXRlLm5vdygpLXIuc2F2ZVRpbWU+ci50dGw/KHRoaXMuZGVsZXRlKHQpLG51bGwpOnIubWVzc2FnZX1jYXRjaChyKXtyZXR1cm4gbnVsbH19c2V0KHQsZSl7Y29uc3Qgcj17dHRsOmFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTotMSxzYXZlVGltZTpEYXRlLm5vdygpLG1lc3NhZ2U6ZX07dHJ5e3JldHVybiBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0LEpTT04uc3RyaW5naWZ5KHIpKSwhMH1jYXRjaChuKXtyZXR1cm4hMX19Z2V0VHRsKHQpe2NvbnN0IGU9bG9jYWxTdG9yYWdlLmdldEl0ZW0odCk7aWYoIWUpcmV0dXJuIG51bGw7dHJ5e3JldHVybiBKU09OLnBhcnNlKGUpLnR0bH1jYXRjaChyKXtyZXR1cm4gbnVsbH19ZGVsZXRlKHQpe3RyeXtyZXR1cm4gbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odCksITB9Y2F0Y2goZSl7cmV0dXJuITF9fX12YXIgcmc9bmV3IGNsYXNzIGV4dGVuZHMgZWd7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLGxsKHRoaXMsIl9hY2Nlc3NWZXJzaW9uIiwidjIiKX1nZXREZXZpY2VJZCgpe2lmKFBfKCkpcmV0dXJuIiI7bGV0IHQ9dGhpcy5nZXQoWF8pO3JldHVybiB0JiYhL15bMC05YS1mXXs4fSgtWzAtOWEtZl17NH0pezN9LVswLTlhLWZdezEyfSQvLnRlc3QodCl8fCh0PWZ1bmN0aW9uKHQpe2xldCBlPSIiO2ZvcihsZXQgcj0wO3I8dDtyKyspZSs9TWF0aC5mbG9vcigxMCpNYXRoLnJhbmRvbSgpKTtyZXR1cm4gZX0oMTYpKSx0aGlzLnNldERldmljZUlkKHQpLHR9c2V0RGV2aWNlSWQodCl7dmFyIGU7cmV0dXJuIGU9e2RldmljZV9pZDp0fSxnXy5zZXRDb21tb25TdGF0cyhlKSx0aGlzLnNldChYXyx0KSx0fWdldEFjY2Vzc05vZGUodCl7cmV0dXJuIHRoaXMuZ2V0KCIiLmNvbmNhdChZXywiXyIpLmNvbmNhdCh0LCItIikuY29uY2F0KCRfLCItIikuY29uY2F0KHRoaXMuX2FjY2Vzc1ZlcnNpb24pKX1zZXRBY2Nlc3NOb2RlKHQsZSxyKXtyZXR1cm4gdGhpcy5zZXQoIiIuY29uY2F0KFlfLCJfIikuY29uY2F0KHQsIi0iKS5jb25jYXQoJF8sIi0iKS5jb25jYXQodGhpcy5fYWNjZXNzVmVyc2lvbiksZSwxZTMqcil9ZGVsZXRlQWNjZXNzTm9kZSh0LGUpe2xldCByPXRoaXMuZ2V0QWNjZXNzTm9kZSh0KTtjb25zdCBuPXRoaXMuZ2V0VHRsKCIiLmNvbmNhdChZXywiXyIpLmNvbmNhdCh0LCItIikuY29uY2F0KCRfKSk7QXJyYXkuaXNBcnJheShyKSYmci5sZW5ndGg+MCYmKHI9ci5maWx0ZXIoKHQ9PnQubWVkaWFJRCE9PWUubWVkaWFJRCYmdC5tc2dLZXkhPT1lLm1zZ0tleSkpLHIubGVuZ3RoPjA/dGhpcy5zZXRBY2Nlc3NOb2RlKHQscixufHwwKTp0aGlzLmNsZWFyQWNjZXNzTm9kZSh0KSl9Y2xlYXJBY2Nlc3NOb2RlKHQpe2lmKHQpdGhpcy5kZWxldGUoIiIuY29uY2F0KFlfLCJfIikuY29uY2F0KHQsIi0iKS5jb25jYXQoJF8pKTtlbHNlIGZvcihjb25zdCBlIGluIGxvY2FsU3RvcmFnZSllLnN0YXJ0c1dpdGgoWV8pJiZsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShlKX1nZXRBY2Nlc3NVcmxzKCl7cmV0dXJuIHRoaXMuZ2V0KCIiLmNvbmNhdChxXywiLSIpLmNvbmNhdCgkXykpfXNldEFjY2Vzc1VybHModCl7Y29uc3QgZT10Lm1hcCgodD0+e2xldHtob3N0OmUscGF0aDpyfT10O3JldHVybiJodHRwczovLyIuY29uY2F0KGUpLmNvbmNhdChyKX0pKTtyZXR1cm4gdGhpcy5zZXQoIiIuY29uY2F0KHFfLCItIikuY29uY2F0KCRfKSxlKX1jbGVhckFjY2Vzc1VybHMoKXt0aGlzLmRlbGV0ZSgiIi5jb25jYXQocV8sIi0iKS5jb25jYXQoJF8pKX1nZXRFbmdpbmVXZWJDb25maWcodCxlKXt2YXIgcjtjb25zdCBuPSIiLmNvbmNhdCh0LCJfIikuY29uY2F0KGUsIl8iKS5jb25jYXQodGhpcy5nZXREZXZpY2VJZCgpKSxpPXRoaXMuZ2V0KFFfKSxvPShudWxsPT1pfHxudWxsPT09KHI9aS5maW5kKCh0PT50LmtleT09PW4pKSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuY29uZmlnKXx8e307cmV0dXJuIE9iamVjdC5hc3NpZ24oe30sZnVuY3Rpb24odCl7aWYoIkRFVklDRV9JRCI9PT10KXJldHVybiByZy5nZXREZXZpY2VJZCgpO3JldHVybiBoZ1t0XX0oIkVOR0lORV9XRUJfQ09ORklHIiksbyl9c2V0RW5naW5lV2ViQ29uZmlnKHQsZSxyKXtpZighcilyZXR1cm47Y29uc3Qgbj0iIi5jb25jYXQodCwiXyIpLmNvbmNhdChlLCJfIikuY29uY2F0KHRoaXMuZ2V0RGV2aWNlSWQoKSk7bGV0IGk9dGhpcy5nZXQoUV8pfHxbXTtyZXR1cm4gaT1pLmZpbHRlcigodD0+dC5rZXkhPT1uKSksaS5wdXNoKHtrZXk6bixjb25maWc6cn0pLHRoaXMuc2V0KFFfLGkuc2xpY2UoLTUpKX1nZXRTZXJ2ZXJDb25maWcodCl7dmFyIGU7Y29uc3Qgcj0iIi5jb25jYXQodCksbj10aGlzLmdldCh0Zyk7cmV0dXJuKG51bGw9PW58fG51bGw9PT0oZT1uLmZpbmQoKHQ9PnQua2V5PT09cikpKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5jb25maWcpfHx7fX1zZXRTZXJ2ZXJDb25maWcodCxlKXtpZighZSlyZXR1cm47Y29uc3Qgcj0iIi5jb25jYXQodCk7bGV0IG49dGhpcy5nZXQodGcpfHxbXTtyZXR1cm4gbj1uLmZpbHRlcigodD0+dC5rZXkhPT1yKSksbi5wdXNoKHtrZXk6cixjb25maWc6ZX0pLHRoaXMuc2V0KHRnLG4uc2xpY2UoLTUpKX19O2NvbnN0IG5nPW5ldyBEXygiSm9pblJvb21Db25maWciLDApO2NsYXNzIGlne2NvbnN0cnVjdG9yKHQpe2xsKHRoaXMsIl91c2VUY3BBZnRlckpvaW5UaW1lb3V0IixpZy5ERUZBVUxUX0NPTkYudXNlVGNwQWZ0ZXJKb2luVGltZW91dCksbGwodGhpcywiX2pvaW5XaXRoVGNwT25seSIsaWcuREVGQVVMVF9DT05GLmpvaW5XaXRoVGNwT25seSksbGwodGhpcywiX2pvaW5XaXRoVGNwT25seURlbGF5IixpZy5ERUZBVUxUX0NPTkYuam9pbldpdGhUY3BPbmx5RGVsYXkpLGxsKHRoaXMsIl9ibGFja0Jyb3dzZXJSZWdleExpc3QiLFtdKSx0aGlzLl9lbmdpbmVJZD10LGxvY2F0aW9uLnNlYXJjaC5pbmRleE9mKCJfX3J0Y190Y3Bfb25seV9fIik+LTEmJih0aGlzLl9qb2luV2l0aFRjcE9ubHk9ITAsdGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXk9MCksdGhpcy5fcmVwb3J0KCl9c3RhdGljIHNldERlZmF1bENvbmYodCl7bGV0e3VzZVRjcEFmdGVySm9pblRpbWVvdXQ6ZSxqb2luV2l0aFRjcE9ubHk6cixqb2luV2l0aFRjcE9ubHlEZWxheTpufT10O3JldHVybiJib29sZWFuIj09dHlwZW9mIGUmJihpZy5ERUZBVUxUX0NPTkYudXNlVGNwQWZ0ZXJKb2luVGltZW91dD1lKSwiYm9vbGVhbiI9PXR5cGVvZiByJiYoaWcuREVGQVVMVF9DT05GLmpvaW5XaXRoVGNwT25seT1yKSwibnVtYmVyIj09dHlwZW9mIG4mJihpZy5ERUZBVUxUX0NPTkYuam9pbldpdGhUY3BPbmx5RGVsYXk9TWF0aC5tYXgoMCxuKSksaWcuREVGQVVMVF9DT05GfWdldCB1c2VUY3BBZnRlckpvaW5UaW1lb3V0KCl7cmV0dXJuIHRoaXMuX3VzZVRjcEFmdGVySm9pblRpbWVvdXR9Z2V0IHVzZVRjcEpvaW4oKXtyZXR1cm4gdGhpcy5fam9pbldpdGhUY3BPbmx5fWdldCB1c2VUY3BKb2luRGVsYXkoKXtyZXR1cm4gdGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXl9aXNCbGFja0Jyb3dlcigpe3JldHVybiB0aGlzLl9ibGFja0Jyb3dzZXJSZWdleExpc3QuZmluZCgodD0+bmV3IFJlZ0V4cCh0KS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSl9c2V0U2VydmVyQ29uZmlnKHQpe3ZhciBlLHIsbjtsZXQgaT0hMTsiYm9vbGVhbiI9PXR5cGVvZihudWxsPT10fHxudWxsPT09KGU9dC51c2VfdGNwX2FmdGVyX2pvaW5fdGltZW91dCl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZW5hYmxlKSYmKHRoaXMuX3VzZVRjcEFmdGVySm9pblRpbWVvdXQ9dC51c2VfdGNwX2FmdGVyX2pvaW5fdGltZW91dC5lbmFibGUsaT0hMCksImJvb2xlYW4iPT10eXBlb2YobnVsbD09dHx8bnVsbD09PShyPXQuam9pbl93aXRoX3RjcF9vbmx5KXx8dm9pZCAwPT09cj92b2lkIDA6ci5lbmFibGUpJiYodGhpcy5fam9pbldpdGhUY3BPbmx5PXQuam9pbl93aXRoX3RjcF9vbmx5LmVuYWJsZSxpPSEwKSwibnVtYmVyIj09dHlwZW9mKG51bGw9PXR8fG51bGw9PT0obj10LmpvaW5fd2l0aF90Y3Bfb25seSl8fHZvaWQgMD09PW4/dm9pZCAwOm4uZGVsYXlfbXMpJiYodGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXk9dC5qb2luX3dpdGhfdGNwX29ubHkuZGVsYXlfbXMsaT0hMCksdCYmQXJyYXkuaXNBcnJheSh0LmJsYWNrX2Jyb3dzZXJfcmVnZXhfbGlzdCkmJih0aGlzLl9ibGFja0Jyb3dzZXJSZWdleExpc3Q9dC5ibGFja19icm93c2VyX3JlZ2V4X2xpc3QsaT0hMCksaSYmdGhpcy5fcmVwb3J0KCl9dG9TdHJpbmcoKXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkoe3VzZV90Y3BfYWZ0ZXJfam9pbl90aW1lb3V0OnRoaXMuX3VzZVRjcEFmdGVySm9pblRpbWVvdXQsam9pbl93aXRoX3RjcF9vbmx5OnRoaXMuX2pvaW5XaXRoVGNwT25seSxqb2luX3dpdGhfdGNwX29ubHlfZGVsYXk6dGhpcy5fam9pbldpdGhUY3BPbmx5RGVsYXksYmxhY2tfYnJvd3Nlcl9yZWdleF9saXN0OnRoaXMuX2JsYWNrQnJvd3NlclJlZ2V4TGlzdH0pfV9yZXBvcnQoKXtuZy5wcmludCgiX3JlcG9ydCIsdGhpcy50b1N0cmluZygpKSxmdW5jdGlvbih0LGUscil7dmFyIG47bGV0IGk9YXJndW1lbnRzLmxlbmd0aD4zJiZ2b2lkIDAhPT1hcmd1bWVudHNbM10/YXJndW1lbnRzWzNdOjAsbz1hcmd1bWVudHMubGVuZ3RoPjQmJnZvaWQgMCE9PWFyZ3VtZW50c1s0XT9hcmd1bWVudHNbNF06IiIscz1hcmd1bWVudHMubGVuZ3RoPjU/YXJndW1lbnRzWzVdOnZvaWQgMDtudWxsPT09KG49d18odCkpfHx2b2lkIDA9PT1ufHxuLnJlcG9ydCgicnRjX2ludm9rZV9zdGF0dXMiLHtzZGtfYXBpX25hbWU6ZSxtZXNzYWdlOnIsZXJyb3JfY29kZTppLHN0cmVhbV9pZDpvLGVsYXBzZTowfSxzKX0odGhpcy5fZW5naW5lSWQsIndlYl9qb2luX3Jvb21fY29uZmlnIix0aGlzLnRvU3RyaW5nKCkpfX1sbChpZywiREVGQVVMVF9DT05GIix7dXNlVGNwQWZ0ZXJKb2luVGltZW91dDohMCxqb2luV2l0aFRjcE9ubHk6ITEsam9pbldpdGhUY3BPbmx5RGVsYXk6NWUzfSk7dmFyIG9nPSh0PT4odFt0Lk5PTkU9MF09Ik5PTkUiLHQpKShvZ3x8e30pLHNnPW87Q3Ioe2dsb2JhbDohMCxmb3JjZWQ6c2cuZ2xvYmFsVGhpcyE9PXNnfSx7Z2xvYmFsVGhpczpzZ30pO3ZhciBhZyxjZz1lKG8pO0tfJiZVX3x8SF8mJlZfWzBdLGpfJiYoKG51bGw9PUdfP3ZvaWQgMDpHXy5pbmNsdWRlcygiMTYuMSIpKXx8KG51bGw9PUdfP3ZvaWQgMDpHXy5pbmNsdWRlcygiMTYuMiIpKXx8bnVsbD09R198fEdfLmluY2x1ZGVzKCIxNi4zIikpO2NvbnN0IHVnPSJfX3J0Y19hY2Nlc3NEb21haW5zX18iLnNwbGl0KCIsIik7Y29uc3QgbGc9Il9fcnRjX2NvbmZpZ0RvbWFpbnNfXyIuc3BsaXQoIiwiKSxoZz17VkVSU0lPTjoiX19QTEFDRUhPTERFUl9WRVJTSU9OX18iLElDRV9DT05GSUdfUkVRVUVTVF9VUkxTX0lOVEVSTkFMOnVnLm1hcCgoZnVuY3Rpb24oKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06IiI7cmV0dXJuIHQ/KC9eaHR0cHM/OlwvXC8uKy8udGVzdCh0KXx8KHQ9Imh0dHBzOi8vIi5jb25jYXQodCkpLCIiLmNvbmNhdCh0LCIvZGlzcGF0Y2gvdjEvQWNjZXNzSW5mbz9BY3Rpb249R2V0QWNjZXNzSW5mbyIpKToiIn0pKSxJQ0VfQ09ORklHX1JFUVVFU1RfVVJMUzpbXSxFWFBFQ1RFRF9BRERSOiIiLExPR19TRVJWRVJfVVJMOiJfX3J0Y19kb21lc3RpY0xvZ1NlcnZlclVybF9fIixDT05GSUdfUkVRVUVTVF9ET01BSU5TOmxnLERFVklDRV9JRDoiIixPVkVSU0VBOiExLFBMQVRGT1JNOiIiLFBST0RVQ1Q6IiIsRk9SQ0VfRU5BQkxFRF9SRVBPUlRfQ0FMTEJBQ0tTOltdLFNLSVBfV0VCX0FVRElPX0lOX1RSQUNLOiExLEVORk9SQ0VfV0VCX0FVRElPX1NVUFBPUlRFRDohMSxBVURJT19TVEFMTDohMCxWSURFT19TVEFMTDohMCxWSURFT19TVEFMTF8xMDBNUzohMSxTVEFUU19TQ0FMTEJBQ0tfU1VQUE9SVDohMCxKT0lOX1JPT01fQ09ORklHOmlnLkRFRkFVTFRfQ09ORixTSUdOQUxfQ09NUFJFU1NJT046ITAsU0lHTkFMX0NST1BfSk9JTlJPT006ITAsVklERU9fU1RBTExfREFUQTo1MDAsQVVESU9fU1RBTExfREFUQToyMDAsSU9TX1NBRkFSSV9PUklFTlRBVElPTjohMSxCTEFDS19GUkFNRV9MSUZFVElNRTo2ZTQsRkFMTEJBQ0tfRU5DT0RFX0NPREVDOiIiLFNFSV9USU1FX09VVDoyZTMsU0VJX0NPVU5UX0ZQUzoxLFBSRV9JQ0U6ITEsU1RBVFNfTE9PUF9JTlRFUlZBTDoxZTMsSElEREVOX1NUQVRTOiExLFVQTE9BRF9SRU1PVEVfU1RBVFM6b2cuTk9ORSxTREtfQ09ERUNfTkVHT1RJQVRJT046ITAsQVVESU9fQ09ERUM6Ik9QVVMiLERJU0FCTEVfRU5DT0RFRF9UUkFOU0ZPUk06ITEsU0tJUF9TRUlfRklMVEVSOiExLEFSRUFfQ09ERToiIixESVNBQkxFX0NPTVBVVEVfUFJFU1NVUkU6ITEsU0VORF9NRVNTQUdFX1NZTkM6ITEsSDI2NF9IV19FTkNPREVSOiExLEdQVV9VUkw6IiIsVFVSTl9PTl9KT0lOX1JPT01fRkFJTFVSRV9DQUxMQkFDSzohMSxFTkFCTEVfRkFMTEJBQ0tfSEFORExFUjohMSxFTkFCTEVfU1RBTkRBUkRfSEFORExFUjohMSxQQ19LSUxMU1dJVENIOnt9LEVOQUJMRV9QTEFZX0FGVEVSX0NMSUNLOiExLEFVVE9QTEFZX1dPUktBUk9VTkQ6ITAsRU5HSU5FX1dFQl9DT05GSUc6e319OyJ1bmRlZmluZWQiPT10eXBlb2Ygd2luZG93fHxudWxsPT09KGFnPXdpbmRvdyl8fHZvaWQgMD09PWFnfHxudWxsPT09KGFnPWFnLlJUQ1BlZXJDb25uZWN0aW9uKXx8dm9pZCAwPT09YWd8fGFnLnByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbjt2YXIgZmcsZGcscGc9e2V4cG9ydHM6e319LF9nPW5ldyBQcm94eSh7fSx7Z2V0KHQsZSl7dGhyb3cgbmV3IEVycm9yKGBNb2R1bGUgIiIgaGFzIGJlZW4gZXh0ZXJuYWxpemVkIGZvciBicm93c2VyIGNvbXBhdGliaWxpdHkuIENhbm5vdCBhY2Nlc3MgIi4ke2V9IiBpbiBjbGllbnQgY29kZS4gIFNlZSBodHRwOi8vdml0ZWpzLmRldi9ndWlkZS90cm91Ymxlc2hvb3RpbmcuaHRtbCNtb2R1bGUtZXh0ZXJuYWxpemVkLWZvci1icm93c2VyLWNvbXBhdGliaWxpdHkgZm9yIG1vcmUgZGV0YWlscy5gKX19KSxnZz1yKE9iamVjdC5mcmVlemUoe19fcHJvdG9fXzpudWxsLGRlZmF1bHQ6X2d9KSk7ZnVuY3Rpb24gbWcoKXtyZXR1cm4gZmd8fChmZz0xLHBnLmV4cG9ydHM9KGU9ZXx8ZnVuY3Rpb24oZSxyKXt2YXIgbjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmNyeXB0byYmKG49d2luZG93LmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLmNyeXB0byYmKG49c2VsZi5jcnlwdG8pLHZvaWQgMCE9PWNnJiZjZy5jcnlwdG8mJihuPWNnLmNyeXB0byksIW4mJiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZ3aW5kb3cubXNDcnlwdG8mJihuPXdpbmRvdy5tc0NyeXB0byksIW4mJnZvaWQgMCE9PXQmJnQuY3J5cHRvJiYobj10LmNyeXB0byksIW4pdHJ5e249Z2d9Y2F0Y2goZyl7fXZhciBpPWZ1bmN0aW9uKCl7aWYobil7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4uZ2V0UmFuZG9tVmFsdWVzKXRyeXtyZXR1cm4gbi5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQzMkFycmF5KDEpKVswXX1jYXRjaChnKXt9aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4ucmFuZG9tQnl0ZXMpdHJ5e3JldHVybiBuLnJhbmRvbUJ5dGVzKDQpLnJlYWRJbnQzMkxFKCl9Y2F0Y2goZyl7fX10aHJvdyBuZXcgRXJyb3IoIk5hdGl2ZSBjcnlwdG8gbW9kdWxlIGNvdWxkIG5vdCBiZSB1c2VkIHRvIGdldCBzZWN1cmUgcmFuZG9tIG51bWJlci4iKX0sbz1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt9cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByO3JldHVybiB0LnByb3RvdHlwZT1lLHI9bmV3IHQsdC5wcm90b3R5cGU9bnVsbCxyfX0oKSxzPXt9LGE9cy5saWI9e30sYz1hLkJhc2U9e2V4dGVuZDpmdW5jdGlvbih0KXt2YXIgZT1vKHRoaXMpO3JldHVybiB0JiZlLm1peEluKHQpLGUuaGFzT3duUHJvcGVydHkoImluaXQiKSYmdGhpcy5pbml0IT09ZS5pbml0fHwoZS5pbml0PWZ1bmN0aW9uKCl7ZS4kc3VwZXIuaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSxlLmluaXQucHJvdG90eXBlPWUsZS4kc3VwZXI9dGhpcyxlfSxjcmVhdGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmV4dGVuZCgpO3JldHVybiB0LmluaXQuYXBwbHkodCxhcmd1bWVudHMpLHR9LGluaXQ6ZnVuY3Rpb24oKXt9LG1peEluOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSBpbiB0KXQuaGFzT3duUHJvcGVydHkoZSkmJih0aGlzW2VdPXRbZV0pO3QuaGFzT3duUHJvcGVydHkoInRvU3RyaW5nIikmJih0aGlzLnRvU3RyaW5nPXQudG9TdHJpbmcpfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmluaXQucHJvdG90eXBlLmV4dGVuZCh0aGlzKX19LHU9YS5Xb3JkQXJyYXk9Yy5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxlKXt0PXRoaXMud29yZHM9dHx8W10sdGhpcy5zaWdCeXRlcz1lIT1yP2U6NCp0Lmxlbmd0aH0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fGgpLnN0cmluZ2lmeSh0aGlzKX0sY29uY2F0OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMud29yZHMscj10LndvcmRzLG49dGhpcy5zaWdCeXRlcyxpPXQuc2lnQnl0ZXM7aWYodGhpcy5jbGFtcCgpLG4lNClmb3IodmFyIG89MDtvPGk7bysrKXt2YXIgcz1yW28+Pj4yXT4+PjI0LW8lNCo4JjI1NTtlW24rbz4+PjJdfD1zPDwyNC0obitvKSU0Kjh9ZWxzZSBmb3IodmFyIGE9MDthPGk7YSs9NCllW24rYT4+PjJdPXJbYT4+PjJdO3JldHVybiB0aGlzLnNpZ0J5dGVzKz1pLHRoaXN9LGNsYW1wOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy53b3JkcyxyPXRoaXMuc2lnQnl0ZXM7dFtyPj4+Ml0mPTQyOTQ5NjcyOTU8PDMyLXIlNCo4LHQubGVuZ3RoPWUuY2VpbChyLzQpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWMuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC53b3Jkcz10aGlzLndvcmRzLnNsaWNlKDApLHR9LHJhbmRvbTpmdW5jdGlvbih0KXtmb3IodmFyIGU9W10scj0wO3I8dDtyKz00KWUucHVzaChpKCkpO3JldHVybiBuZXcgdS5pbml0KGUsdCl9fSksbD1zLmVuYz17fSxoPWwuSGV4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBvPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaCgobz4+PjQpLnRvU3RyaW5nKDE2KSksbi5wdXNoKCgxNSZvKS50b1N0cmluZygxNikpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rPTIpcltuPj4+M118PXBhcnNlSW50KHQuc3Vic3RyKG4sMiksMTYpPDwyNC1uJTgqNDtyZXR1cm4gbmV3IHUuaW5pdChyLGUvMil9fSxmPWwuTGF0aW4xPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBvPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKG8pKX1yZXR1cm4gbi5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQubGVuZ3RoLHI9W10sbj0wO248ZTtuKyspcltuPj4+Ml18PSgyNTUmdC5jaGFyQ29kZUF0KG4pKTw8MjQtbiU0Kjg7cmV0dXJuIG5ldyB1LmluaXQocixlKX19LGQ9bC5VdGY4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dHJ5e3JldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKGYuc3RyaW5naWZ5KHQpKSl9Y2F0Y2goZSl7dGhyb3cgbmV3IEVycm9yKCJNYWxmb3JtZWQgVVRGLTggZGF0YSIpfX0scGFyc2U6ZnVuY3Rpb24odCl7cmV0dXJuIGYucGFyc2UodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHQpKSl9fSxwPWEuQnVmZmVyZWRCbG9ja0FsZ29yaXRobT1jLmV4dGVuZCh7cmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhPW5ldyB1LmluaXQsdGhpcy5fbkRhdGFCeXRlcz0wfSxfYXBwZW5kOmZ1bmN0aW9uKHQpeyJzdHJpbmciPT10eXBlb2YgdCYmKHQ9ZC5wYXJzZSh0KSksdGhpcy5fZGF0YS5jb25jYXQodCksdGhpcy5fbkRhdGFCeXRlcys9dC5zaWdCeXRlc30sX3Byb2Nlc3M6ZnVuY3Rpb24odCl7dmFyIHIsbj10aGlzLl9kYXRhLGk9bi53b3JkcyxvPW4uc2lnQnl0ZXMscz10aGlzLmJsb2NrU2l6ZSxhPW8vKDQqcyksYz0oYT10P2UuY2VpbChhKTplLm1heCgoMHxhKS10aGlzLl9taW5CdWZmZXJTaXplLDApKSpzLGw9ZS5taW4oNCpjLG8pO2lmKGMpe2Zvcih2YXIgaD0wO2g8YztoKz1zKXRoaXMuX2RvUHJvY2Vzc0Jsb2NrKGksaCk7cj1pLnNwbGljZSgwLGMpLG4uc2lnQnl0ZXMtPWx9cmV0dXJuIG5ldyB1LmluaXQocixsKX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1jLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLHR9LF9taW5CdWZmZXJTaXplOjB9KTthLkhhc2hlcj1wLmV4dGVuZCh7Y2ZnOmMuZXh0ZW5kKCksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3AucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX0sYmxvY2tTaXplOjE2LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscil7cmV0dXJuIG5ldyB0LmluaXQocikuZmluYWxpemUoZSl9fSxfY3JlYXRlSG1hY0hlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IF8uSE1BQy5pbml0KHQscikuZmluYWxpemUoZSl9fX0pO3ZhciBfPXMuYWxnbz17fTtyZXR1cm4gc30oTWF0aCksZSkpLHBnLmV4cG9ydHM7dmFyIGV9ZGc9bWcoKSxmdW5jdGlvbigpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBBcnJheUJ1ZmZlcil7dmFyIHQ9ZGcubGliLldvcmRBcnJheSxlPXQuaW5pdCxyPXQuaW5pdD1mdW5jdGlvbih0KXtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJih0PW5ldyBVaW50OEFycmF5KHQpKSwodCBpbnN0YW5jZW9mIEludDhBcnJheXx8InVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OENsYW1wZWRBcnJheSYmdCBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHx0IGluc3RhbmNlb2YgSW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgSW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSYmKHQ9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0LHQuYnl0ZUxlbmd0aCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtmb3IodmFyIHI9dC5ieXRlTGVuZ3RoLG49W10saT0wO2k8cjtpKyspbltpPj4+Ml18PXRbaV08PDI0LWklNCo4O2UuY2FsbCh0aGlzLG4scil9ZWxzZSBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07ci5wcm90b3R5cGU9dH19KCksZGcubGliLldvcmRBcnJheTt2YXIgeWcsdmc9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGJnKCl7cmV0dXJuIHlnfHwoeWc9MSxmdW5jdGlvbih0KXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLldvcmRBcnJheTtmdW5jdGlvbiBuKHQsZSxuKXtmb3IodmFyIGk9W10sbz0wLHM9MDtzPGU7cysrKWlmKHMlNCl7dmFyIGE9blt0LmNoYXJDb2RlQXQocy0xKV08PHMlNCoyfG5bdC5jaGFyQ29kZUF0KHMpXT4+PjYtcyU0KjI7aVtvPj4+Ml18PWE8PDI0LW8lNCo4LG8rK31yZXR1cm4gci5jcmVhdGUoaSxvKX1lLmVuYy5CYXNlNjQ9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPXRoaXMuX21hcDt0LmNsYW1wKCk7Zm9yKHZhciBpPVtdLG89MDtvPHI7bys9Mylmb3IodmFyIHM9KGVbbz4+PjJdPj4+MjQtbyU0KjgmMjU1KTw8MTZ8KGVbbysxPj4+Ml0+Pj4yNC0obysxKSU0KjgmMjU1KTw8OHxlW28rMj4+PjJdPj4+MjQtKG8rMiklNCo4JjI1NSxhPTA7YTw0JiZvKy43NSphPHI7YSsrKWkucHVzaChuLmNoYXJBdChzPj4+NiooMy1hKSY2MykpO3ZhciBjPW4uY2hhckF0KDY0KTtpZihjKWZvcig7aS5sZW5ndGglNDspaS5wdXNoKGMpO3JldHVybiBpLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZT10Lmxlbmd0aCxyPXRoaXMuX21hcCxpPXRoaXMuX3JldmVyc2VNYXA7aWYoIWkpe2k9dGhpcy5fcmV2ZXJzZU1hcD1bXTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylpW3IuY2hhckNvZGVBdChvKV09b312YXIgcz1yLmNoYXJBdCg2NCk7aWYocyl7dmFyIGE9dC5pbmRleE9mKHMpOy0xIT09YSYmKGU9YSl9cmV0dXJuIG4odCxlLGkpfSxfbWFwOiJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSJ9fSgpLHQuZW5jLkJhc2U2NH0obWcoKSl9KHZnKSksdmcuZXhwb3J0c312YXIgd2csU2c9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGtnKCl7cmV0dXJuIHdnfHwod2c9MSxmdW5jdGlvbih0KXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uV29yZEFycmF5LG89bi5IYXNoZXIscz1yLmFsZ28sYT1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9MDt0PDY0O3QrKylhW3RdPTQyOTQ5NjcyOTYqZS5hYnMoZS5zaW4odCsxKSl8MH0oKTt2YXIgYz1zLk1ENT1vLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBpLmluaXQoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OF0pfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9MDtyPDE2O3IrKyl7dmFyIG49ZStyLGk9dFtuXTt0W25dPTE2NzExOTM1JihpPDw4fGk+Pj4yNCl8NDI3ODI1NTM2MCYoaTw8MjR8aT4+PjgpfXZhciBvPXRoaXMuX2hhc2gud29yZHMscz10W2UrMF0sYz10W2UrMV0sZD10W2UrMl0scD10W2UrM10sXz10W2UrNF0sZz10W2UrNV0sbT10W2UrNl0seT10W2UrN10sdj10W2UrOF0sYj10W2UrOV0sdz10W2UrMTBdLFM9dFtlKzExXSxrPXRbZSsxMl0sTz10W2UrMTNdLHg9dFtlKzE0XSxFPXRbZSsxNV0sQT1vWzBdLEM9b1sxXSxJPW9bMl0sVD1vWzNdO0E9dShBLEMsSSxULHMsNyxhWzBdKSxUPXUoVCxBLEMsSSxjLDEyLGFbMV0pLEk9dShJLFQsQSxDLGQsMTcsYVsyXSksQz11KEMsSSxULEEscCwyMixhWzNdKSxBPXUoQSxDLEksVCxfLDcsYVs0XSksVD11KFQsQSxDLEksZywxMixhWzVdKSxJPXUoSSxULEEsQyxtLDE3LGFbNl0pLEM9dShDLEksVCxBLHksMjIsYVs3XSksQT11KEEsQyxJLFQsdiw3LGFbOF0pLFQ9dShULEEsQyxJLGIsMTIsYVs5XSksST11KEksVCxBLEMsdywxNyxhWzEwXSksQz11KEMsSSxULEEsUywyMixhWzExXSksQT11KEEsQyxJLFQsayw3LGFbMTJdKSxUPXUoVCxBLEMsSSxPLDEyLGFbMTNdKSxJPXUoSSxULEEsQyx4LDE3LGFbMTRdKSxBPWwoQSxDPXUoQyxJLFQsQSxFLDIyLGFbMTVdKSxJLFQsYyw1LGFbMTZdKSxUPWwoVCxBLEMsSSxtLDksYVsxN10pLEk9bChJLFQsQSxDLFMsMTQsYVsxOF0pLEM9bChDLEksVCxBLHMsMjAsYVsxOV0pLEE9bChBLEMsSSxULGcsNSxhWzIwXSksVD1sKFQsQSxDLEksdyw5LGFbMjFdKSxJPWwoSSxULEEsQyxFLDE0LGFbMjJdKSxDPWwoQyxJLFQsQSxfLDIwLGFbMjNdKSxBPWwoQSxDLEksVCxiLDUsYVsyNF0pLFQ9bChULEEsQyxJLHgsOSxhWzI1XSksST1sKEksVCxBLEMscCwxNCxhWzI2XSksQz1sKEMsSSxULEEsdiwyMCxhWzI3XSksQT1sKEEsQyxJLFQsTyw1LGFbMjhdKSxUPWwoVCxBLEMsSSxkLDksYVsyOV0pLEk9bChJLFQsQSxDLHksMTQsYVszMF0pLEE9aChBLEM9bChDLEksVCxBLGssMjAsYVszMV0pLEksVCxnLDQsYVszMl0pLFQ9aChULEEsQyxJLHYsMTEsYVszM10pLEk9aChJLFQsQSxDLFMsMTYsYVszNF0pLEM9aChDLEksVCxBLHgsMjMsYVszNV0pLEE9aChBLEMsSSxULGMsNCxhWzM2XSksVD1oKFQsQSxDLEksXywxMSxhWzM3XSksST1oKEksVCxBLEMseSwxNixhWzM4XSksQz1oKEMsSSxULEEsdywyMyxhWzM5XSksQT1oKEEsQyxJLFQsTyw0LGFbNDBdKSxUPWgoVCxBLEMsSSxzLDExLGFbNDFdKSxJPWgoSSxULEEsQyxwLDE2LGFbNDJdKSxDPWgoQyxJLFQsQSxtLDIzLGFbNDNdKSxBPWgoQSxDLEksVCxiLDQsYVs0NF0pLFQ9aChULEEsQyxJLGssMTEsYVs0NV0pLEk9aChJLFQsQSxDLEUsMTYsYVs0Nl0pLEE9ZihBLEM9aChDLEksVCxBLGQsMjMsYVs0N10pLEksVCxzLDYsYVs0OF0pLFQ9ZihULEEsQyxJLHksMTAsYVs0OV0pLEk9ZihJLFQsQSxDLHgsMTUsYVs1MF0pLEM9ZihDLEksVCxBLGcsMjEsYVs1MV0pLEE9ZihBLEMsSSxULGssNixhWzUyXSksVD1mKFQsQSxDLEkscCwxMCxhWzUzXSksST1mKEksVCxBLEMsdywxNSxhWzU0XSksQz1mKEMsSSxULEEsYywyMSxhWzU1XSksQT1mKEEsQyxJLFQsdiw2LGFbNTZdKSxUPWYoVCxBLEMsSSxFLDEwLGFbNTddKSxJPWYoSSxULEEsQyxtLDE1LGFbNThdKSxDPWYoQyxJLFQsQSxPLDIxLGFbNTldKSxBPWYoQSxDLEksVCxfLDYsYVs2MF0pLFQ9ZihULEEsQyxJLFMsMTAsYVs2MV0pLEk9ZihJLFQsQSxDLGQsMTUsYVs2Ml0pLEM9ZihDLEksVCxBLGIsMjEsYVs2M10pLG9bMF09b1swXStBfDAsb1sxXT1vWzFdK0N8MCxvWzJdPW9bMl0rSXwwLG9bM109b1szXStUfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxyPXQud29yZHMsbj04KnRoaXMuX25EYXRhQnl0ZXMsaT04KnQuc2lnQnl0ZXM7cltpPj4+NV18PTEyODw8MjQtaSUzMjt2YXIgbz1lLmZsb29yKG4vNDI5NDk2NzI5Nikscz1uO3JbMTUrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKG88PDh8bz4+PjI0KXw0Mjc4MjU1MzYwJihvPDwyNHxvPj4+OCksclsxNCsoaSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYoczw8OHxzPj4+MjQpfDQyNzgyNTUzNjAmKHM8PDI0fHM+Pj44KSx0LnNpZ0J5dGVzPTQqKHIubGVuZ3RoKzEpLHRoaXMuX3Byb2Nlc3MoKTtmb3IodmFyIGE9dGhpcy5faGFzaCxjPWEud29yZHMsdT0wO3U8NDt1Kyspe3ZhciBsPWNbdV07Y1t1XT0xNjcxMTkzNSYobDw8OHxsPj4+MjQpfDQyNzgyNTUzNjAmKGw8PDI0fGw+Pj44KX1yZXR1cm4gYX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1vLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ZnVuY3Rpb24gdSh0LGUscixuLGksbyxzKXt2YXIgYT10KyhlJnJ8fmUmbikraStzO3JldHVybihhPDxvfGE+Pj4zMi1vKStlfWZ1bmN0aW9uIGwodCxlLHIsbixpLG8scyl7dmFyIGE9dCsoZSZufHImfm4pK2krcztyZXR1cm4oYTw8b3xhPj4+MzItbykrZX1mdW5jdGlvbiBoKHQsZSxyLG4saSxvLHMpe3ZhciBhPXQrKGVecl5uKStpK3M7cmV0dXJuKGE8PG98YT4+PjMyLW8pK2V9ZnVuY3Rpb24gZih0LGUscixuLGksbyxzKXt2YXIgYT10KyhyXihlfH5uKSkraStzO3JldHVybihhPDxvfGE+Pj4zMi1vKStlfXIuTUQ1PW8uX2NyZWF0ZUhlbHBlcihjKSxyLkhtYWNNRDU9by5fY3JlYXRlSG1hY0hlbHBlcihjKX0oTWF0aCksdC5NRDV9KG1nKCkpfShTZykpLFNnLmV4cG9ydHN9dmFyIE9nLHhnPXtleHBvcnRzOnt9fSxFZz17ZXhwb3J0czp7fX07ZnVuY3Rpb24gQWcoKXtyZXR1cm4gT2d8fChPZz0xLGZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gcj0oZT10KS5saWIsbj1yLldvcmRBcnJheSxpPXIuSGFzaGVyLG89ZS5hbGdvLHM9W10sYT1vLlNIQTE9aS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgbi5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzgsMzI4NTM3NzUyMF0pfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy5faGFzaC53b3JkcyxuPXJbMF0saT1yWzFdLG89clsyXSxhPXJbM10sYz1yWzRdLHU9MDt1PDgwO3UrKyl7aWYodTwxNilzW3VdPTB8dFtlK3VdO2Vsc2V7dmFyIGw9c1t1LTNdXnNbdS04XV5zW3UtMTRdXnNbdS0xNl07c1t1XT1sPDwxfGw+Pj4zMX12YXIgaD0objw8NXxuPj4+MjcpK2Mrc1t1XTtoKz11PDIwPzE1MTg1MDAyNDkrKGkmb3x+aSZhKTp1PDQwPzE4NTk3NzUzOTMrKGleb15hKTp1PDYwPyhpJm98aSZhfG8mYSktMTg5NDAwNzU4ODooaV5vXmEpLTg5OTQ5NzUxNCxjPWEsYT1vLG89aTw8MzB8aT4+PjIsaT1uLG49aH1yWzBdPXJbMF0rbnwwLHJbMV09clsxXStpfDAsclsyXT1yWzJdK298MCxyWzNdPXJbM10rYXwwLHJbNF09cls0XStjfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxlPXQud29yZHMscj04KnRoaXMuX25EYXRhQnl0ZXMsbj04KnQuc2lnQnl0ZXM7cmV0dXJuIGVbbj4+PjVdfD0xMjg8PDI0LW4lMzIsZVsxNCsobis2ND4+Pjk8PDQpXT1NYXRoLmZsb29yKHIvNDI5NDk2NzI5NiksZVsxNSsobis2ND4+Pjk8PDQpXT1yLHQuc2lnQnl0ZXM9NCplLmxlbmd0aCx0aGlzLl9wcm9jZXNzKCksdGhpcy5faGFzaH0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1pLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSksZS5TSEExPWkuX2NyZWF0ZUhlbHBlcihhKSxlLkhtYWNTSEExPWkuX2NyZWF0ZUhtYWNIZWxwZXIoYSksdC5TSEExO3ZhciBlLHIsbixpLG8scyxhfShtZygpKX0oRWcpKSxFZy5leHBvcnRzfXZhciBDZyxJZyxUZz17ZXhwb3J0czp7fX07ZnVuY3Rpb24gTGcoKXtyZXR1cm4gSWd8fChJZz0xLGZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gcj0oZT10KS5saWIsbj1yLkJhc2UsaT1yLldvcmRBcnJheSxvPWUuYWxnbyxzPW8uTUQ1LGE9by5FdnBLREY9bi5leHRlbmQoe2NmZzpuLmV4dGVuZCh7a2V5U2l6ZTo0LGhhc2hlcjpzLGl0ZXJhdGlvbnM6MX0pLGluaXQ6ZnVuY3Rpb24odCl7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHQpfSxjb21wdXRlOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByLG49dGhpcy5jZmcsbz1uLmhhc2hlci5jcmVhdGUoKSxzPWkuY3JlYXRlKCksYT1zLndvcmRzLGM9bi5rZXlTaXplLHU9bi5pdGVyYXRpb25zO2EubGVuZ3RoPGM7KXtyJiZvLnVwZGF0ZShyKSxyPW8udXBkYXRlKHQpLmZpbmFsaXplKGUpLG8ucmVzZXQoKTtmb3IodmFyIGw9MTtsPHU7bCsrKXI9by5maW5hbGl6ZShyKSxvLnJlc2V0KCk7cy5jb25jYXQocil9cmV0dXJuIHMuc2lnQnl0ZXM9NCpjLHN9fSksZS5FdnBLREY9ZnVuY3Rpb24odCxlLHIpe3JldHVybiBhLmNyZWF0ZShyKS5jb21wdXRlKHQsZSl9LHQuRXZwS0RGO3ZhciBlLHIsbixpLG8scyxhfShtZygpLEFnKCksQ2d8fChDZz0xLGZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXt2YXIgZSxyLG47cj0oZT10KS5saWIuQmFzZSxuPWUuZW5jLlV0ZjgsZS5hbGdvLkhNQUM9ci5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxlKXt0PXRoaXMuX2hhc2hlcj1uZXcgdC5pbml0LCJzdHJpbmciPT10eXBlb2YgZSYmKGU9bi5wYXJzZShlKSk7dmFyIHI9dC5ibG9ja1NpemUsaT00KnI7ZS5zaWdCeXRlcz5pJiYoZT10LmZpbmFsaXplKGUpKSxlLmNsYW1wKCk7Zm9yKHZhciBvPXRoaXMuX29LZXk9ZS5jbG9uZSgpLHM9dGhpcy5faUtleT1lLmNsb25lKCksYT1vLndvcmRzLGM9cy53b3Jkcyx1PTA7dTxyO3UrKylhW3VdXj0xNTQ5NTU2ODI4LGNbdV1ePTkwOTUyMjQ4NjtvLnNpZ0J5dGVzPXMuc2lnQnl0ZXM9aSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5faGFzaGVyO3QucmVzZXQoKSx0LnVwZGF0ZSh0aGlzLl9pS2V5KX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9oYXNoZXIudXBkYXRlKHQpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2hhc2hlcixyPWUuZmluYWxpemUodCk7cmV0dXJuIGUucmVzZXQoKSxlLmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQocikpfX0pfShtZygpKX0oVGcpKSl9KHhnKSkseGcuZXhwb3J0c312YXIgQmcsTmc9e2V4cG9ydHM6e319O2Z1bmN0aW9uIFJnKCl7cmV0dXJuIEJnfHwoQmc9MSxmdW5jdGlvbih0KXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dC5saWIuQ2lwaGVyfHxmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLkJhc2Usbz1uLldvcmRBcnJheSxzPW4uQnVmZmVyZWRCbG9ja0FsZ29yaXRobSxhPXIuZW5jO2EuVXRmODt2YXIgYz1hLkJhc2U2NCx1PXIuYWxnby5FdnBLREYsbD1uLkNpcGhlcj1zLmV4dGVuZCh7Y2ZnOmkuZXh0ZW5kKCksY3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLHQsZSl9LGNyZWF0ZURlY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSx0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSxyKXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQociksdGhpcy5feGZvcm1Nb2RlPXQsdGhpcy5fa2V5PWUsdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3MucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHByb2Nlc3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2FwcGVuZCh0KSx0aGlzLl9wcm9jZXNzKCl9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxrZXlTaXplOjQsaXZTaXplOjQsX0VOQ19YRk9STV9NT0RFOjEsX0RFQ19YRk9STV9NT0RFOjIsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P3Y6bX1yZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmVuY3J5cHQoZSxyLG4saSl9LGRlY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmRlY3J5cHQoZSxyLG4saSl9fX19KCl9KTtuLlN0cmVhbUNpcGhlcj1sLmV4dGVuZCh7X2RvRmluYWxpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcHJvY2VzcyghMCl9LGJsb2NrU2l6ZToxfSk7dmFyIGg9ci5tb2RlPXt9LGY9bi5CbG9ja0NpcGhlck1vZGU9aS5leHRlbmQoe2NyZWF0ZUVuY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUodCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZSh0LGUpfSxpbml0OmZ1bmN0aW9uKHQsZSl7dGhpcy5fY2lwaGVyPXQsdGhpcy5faXY9ZX19KSxkPWguQ0JDPWZ1bmN0aW9uKCl7dmFyIHQ9Zi5leHRlbmQoKTtmdW5jdGlvbiByKHQscixuKXt2YXIgaSxvPXRoaXMuX2l2O28/KGk9byx0aGlzLl9pdj1lKTppPXRoaXMuX3ByZXZCbG9jaztmb3IodmFyIHM9MDtzPG47cysrKXRbcitzXV49aVtzXX1yZXR1cm4gdC5FbmNyeXB0b3I9dC5leHRlbmQoe3Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplO3IuY2FsbCh0aGlzLHQsZSxpKSxuLmVuY3J5cHRCbG9jayh0LGUpLHRoaXMuX3ByZXZCbG9jaz10LnNsaWNlKGUsZStpKX19KSx0LkRlY3J5cHRvcj10LmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemUsbz10LnNsaWNlKGUsZStpKTtuLmRlY3J5cHRCbG9jayh0LGUpLHIuY2FsbCh0aGlzLHQsZSxpKSx0aGlzLl9wcmV2QmxvY2s9b319KSx0fSgpLHA9KHIucGFkPXt9KS5Qa2NzNz17cGFkOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTQqZSxuPXItdC5zaWdCeXRlcyVyLGk9bjw8MjR8bjw8MTZ8bjw8OHxuLHM9W10sYT0wO2E8bjthKz00KXMucHVzaChpKTt2YXIgYz1vLmNyZWF0ZShzLG4pO3QuY29uY2F0KGMpfSx1bnBhZDpmdW5jdGlvbih0KXt2YXIgZT0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1lfX07bi5CbG9ja0NpcGhlcj1sLmV4dGVuZCh7Y2ZnOmwuY2ZnLmV4dGVuZCh7bW9kZTpkLHBhZGRpbmc6cH0pLHJlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ7bC5yZXNldC5jYWxsKHRoaXMpO3ZhciBlPXRoaXMuY2ZnLHI9ZS5pdixuPWUubW9kZTt0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFP3Q9bi5jcmVhdGVFbmNyeXB0b3I6KHQ9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlJiZ0aGlzLl9tb2RlLl9fY3JlYXRvcj09dD90aGlzLl9tb2RlLmluaXQodGhpcyxyJiZyLndvcmRzKToodGhpcy5fbW9kZT10LmNhbGwobix0aGlzLHImJnIud29yZHMpLHRoaXMuX21vZGUuX19jcmVhdG9yPXQpfSxfZG9Qcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayh0LGUpfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5jZmcucGFkZGluZztyZXR1cm4gdGhpcy5feGZvcm1Nb2RlPT10aGlzLl9FTkNfWEZPUk1fTU9ERT8oZS5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksdD10aGlzLl9wcm9jZXNzKCEwKSk6KHQ9dGhpcy5fcHJvY2VzcyghMCksZS51bnBhZCh0KSksdH0sYmxvY2tTaXplOjR9KTt2YXIgXz1uLkNpcGhlclBhcmFtcz1pLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0KXt0aGlzLm1peEluKHQpfSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19KSxnPShyLmZvcm1hdD17fSkuT3BlblNTTD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQuY2lwaGVydGV4dCxyPXQuc2FsdDtyZXR1cm4ocj9vLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdChlKTplKS50b1N0cmluZyhjKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGUscj1jLnBhcnNlKHQpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09blswXSYmMTcwMTA3NjgzMT09blsxXSYmKGU9by5jcmVhdGUobi5zbGljZSgyLDQpKSxuLnNwbGljZSgwLDQpLHIuc2lnQnl0ZXMtPTE2KSxfLmNyZWF0ZSh7Y2lwaGVydGV4dDpyLHNhbHQ6ZX0pfX0sbT1uLlNlcmlhbGl6YWJsZUNpcGhlcj1pLmV4dGVuZCh7Y2ZnOmkuZXh0ZW5kKHtmb3JtYXQ6Z30pLGVuY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7bj10aGlzLmNmZy5leHRlbmQobik7dmFyIGk9dC5jcmVhdGVFbmNyeXB0b3IocixuKSxvPWkuZmluYWxpemUoZSkscz1pLmNmZztyZXR1cm4gXy5jcmVhdGUoe2NpcGhlcnRleHQ6byxrZXk6cixpdjpzLml2LGFsZ29yaXRobTp0LG1vZGU6cy5tb2RlLHBhZGRpbmc6cy5wYWRkaW5nLGJsb2NrU2l6ZTp0LmJsb2NrU2l6ZSxmb3JtYXR0ZXI6bi5mb3JtYXR9KX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtyZXR1cm4gbj10aGlzLmNmZy5leHRlbmQobiksZT10aGlzLl9wYXJzZShlLG4uZm9ybWF0KSx0LmNyZWF0ZURlY3J5cHRvcihyLG4pLmZpbmFsaXplKGUuY2lwaGVydGV4dCl9LF9wYXJzZTpmdW5jdGlvbih0LGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD9lLnBhcnNlKHQsdGhpcyk6dH19KSx5PShyLmtkZj17fSkuT3BlblNTTD17ZXhlY3V0ZTpmdW5jdGlvbih0LGUscixuLGkpe2lmKG58fChuPW8ucmFuZG9tKDgpKSxpKXM9dS5jcmVhdGUoe2tleVNpemU6ZStyLGhhc2hlcjppfSkuY29tcHV0ZSh0LG4pO2Vsc2UgdmFyIHM9dS5jcmVhdGUoe2tleVNpemU6ZStyfSkuY29tcHV0ZSh0LG4pO3ZhciBhPW8uY3JlYXRlKHMud29yZHMuc2xpY2UoZSksNCpyKTtyZXR1cm4gcy5zaWdCeXRlcz00KmUsXy5jcmVhdGUoe2tleTpzLGl2OmEsc2FsdDpufSl9fSx2PW4uUGFzc3dvcmRCYXNlZENpcGhlcj1tLmV4dGVuZCh7Y2ZnOm0uY2ZnLmV4dGVuZCh7a2RmOnl9KSxlbmNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPShuPXRoaXMuY2ZnLmV4dGVuZChuKSkua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsbi5zYWx0LG4uaGFzaGVyKTtuLml2PWkuaXY7dmFyIG89bS5lbmNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbik7cmV0dXJuIG8ubWl4SW4oaSksb30sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpO3ZhciBpPW4ua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsZS5zYWx0LG4uaGFzaGVyKTtyZXR1cm4gbi5pdj1pLml2LG0uZGVjcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pfX0pfSgpfShtZygpLExnKCkpfShOZykpLE5nLmV4cG9ydHN9IWZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuQmxvY2tDaXBoZXIsbj1lLmFsZ28saT1bXSxvPVtdLHM9W10sYT1bXSxjPVtdLHU9W10sbD1bXSxoPVtdLGY9W10sZD1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8MjU2O2UrKyl0W2VdPWU8MTI4P2U8PDE6ZTw8MV4yODM7dmFyIHI9MCxuPTA7Zm9yKGU9MDtlPDI1NjtlKyspe3ZhciBwPW5ebjw8MV5uPDwyXm48PDNebjw8NDtwPXA+Pj44XjI1NSZwXjk5LGlbcl09cCxvW3BdPXI7dmFyIF89dFtyXSxnPXRbX10sbT10W2ddLHk9MjU3KnRbcF1eMTY4NDMwMDgqcDtzW3JdPXk8PDI0fHk+Pj44LGFbcl09eTw8MTZ8eT4+PjE2LGNbcl09eTw8OHx5Pj4+MjQsdVtyXT15LHk9MTY4NDMwMDkqbV42NTUzNypnXjI1NypfXjE2ODQzMDA4KnIsbFtwXT15PDwyNHx5Pj4+OCxoW3BdPXk8PDE2fHk+Pj4xNixmW3BdPXk8PDh8eT4+PjI0LGRbcF09eSxyPyhyPV9edFt0W3RbbV5fXV1dLG5ePXRbdFtuXV0pOnI9bj0xfX0oKTt2YXIgcD1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0sXz1uLkFFUz1yLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7Zm9yKHZhciB0PXRoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5LGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMvNCxuPTQqKCh0aGlzLl9uUm91bmRzPXIrNikrMSksbz10aGlzLl9rZXlTY2hlZHVsZT1bXSxzPTA7czxuO3MrKylzPHI/b1tzXT1lW3NdOih1PW9bcy0xXSxzJXI/cj42JiZzJXI9PTQmJih1PWlbdT4+PjI0XTw8MjR8aVt1Pj4+MTYmMjU1XTw8MTZ8aVt1Pj4+OCYyNTVdPDw4fGlbMjU1JnVdKToodT1pWyh1PXU8PDh8dT4+PjI0KT4+PjI0XTw8MjR8aVt1Pj4+MTYmMjU1XTw8MTZ8aVt1Pj4+OCYyNTVdPDw4fGlbMjU1JnVdLHVePXBbcy9yfDBdPDwyNCksb1tzXT1vW3Mtcl1edSk7Zm9yKHZhciBhPXRoaXMuX2ludktleVNjaGVkdWxlPVtdLGM9MDtjPG47YysrKXtpZihzPW4tYyxjJTQpdmFyIHU9b1tzXTtlbHNlIHU9b1tzLTRdO2FbY109Yzw0fHxzPD00P3U6bFtpW3U+Pj4yNF1dXmhbaVt1Pj4+MTYmMjU1XV1eZltpW3U+Pj44JjI1NV1dXmRbaVsyNTUmdV1dfX19LGVuY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5fa2V5U2NoZWR1bGUscyxhLGMsdSxpKX0sZGVjcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlKzFdO3RbZSsxXT10W2UrM10sdFtlKzNdPXIsdGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxsLGgsZixkLG8pLHI9dFtlKzFdLHRbZSsxXT10W2UrM10sdFtlKzNdPXJ9LF9kb0NyeXB0QmxvY2s6ZnVuY3Rpb24odCxlLHIsbixpLG8scyxhKXtmb3IodmFyIGM9dGhpcy5fblJvdW5kcyx1PXRbZV1eclswXSxsPXRbZSsxXV5yWzFdLGg9dFtlKzJdXnJbMl0sZj10W2UrM11eclszXSxkPTQscD0xO3A8YztwKyspe3ZhciBfPW5bdT4+PjI0XV5pW2w+Pj4xNiYyNTVdXm9baD4+PjgmMjU1XV5zWzI1NSZmXV5yW2QrK10sZz1uW2w+Pj4yNF1eaVtoPj4+MTYmMjU1XV5vW2Y+Pj44JjI1NV1ec1syNTUmdV1ecltkKytdLG09bltoPj4+MjRdXmlbZj4+PjE2JjI1NV1eb1t1Pj4+OCYyNTVdXnNbMjU1JmxdXnJbZCsrXSx5PW5bZj4+PjI0XV5pW3U+Pj4xNiYyNTVdXm9bbD4+PjgmMjU1XV5zWzI1NSZoXV5yW2QrK107dT1fLGw9ZyxoPW0sZj15fV89KGFbdT4+PjI0XTw8MjR8YVtsPj4+MTYmMjU1XTw8MTZ8YVtoPj4+OCYyNTVdPDw4fGFbMjU1JmZdKV5yW2QrK10sZz0oYVtsPj4+MjRdPDwyNHxhW2g+Pj4xNiYyNTVdPDwxNnxhW2Y+Pj44JjI1NV08PDh8YVsyNTUmdV0pXnJbZCsrXSxtPShhW2g+Pj4yNF08PDI0fGFbZj4+PjE2JjI1NV08PDE2fGFbdT4+PjgmMjU1XTw8OHxhWzI1NSZsXSlecltkKytdLHk9KGFbZj4+PjI0XTw8MjR8YVt1Pj4+MTYmMjU1XTw8MTZ8YVtsPj4+OCYyNTVdPDw4fGFbMjU1JmhdKV5yW2QrK10sdFtlXT1fLHRbZSsxXT1nLHRbZSsyXT1tLHRbZSszXT15fSxrZXlTaXplOjh9KTtlLkFFUz1yLl9jcmVhdGVIZWxwZXIoXyl9KCksdC5BRVN9KG1nKCksYmcoKSxrZygpLExnKCksUmcoKSl9KHtleHBvcnRzOnt9fSk7IWZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gdC5lbmMuSGV4fShtZygpKX0oe2V4cG9ydHM6e319KTshZnVuY3Rpb24odCl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB0Lm1vZGUuQ1RSPShlPXQubGliLkJsb2NrQ2lwaGVyTW9kZS5leHRlbmQoKSxyPWUuRW5jcnlwdG9yPWUuZXh0ZW5kKHtwcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgcj10aGlzLl9jaXBoZXIsbj1yLmJsb2NrU2l6ZSxpPXRoaXMuX2l2LG89dGhpcy5fY291bnRlcjtpJiYobz10aGlzLl9jb3VudGVyPWkuc2xpY2UoMCksdGhpcy5faXY9dm9pZCAwKTt2YXIgcz1vLnNsaWNlKDApO3IuZW5jcnlwdEJsb2NrKHMsMCksb1tuLTFdPW9bbi0xXSsxfDA7Zm9yKHZhciBhPTA7YTxuO2ErKyl0W2UrYV1ePXNbYV19fSksZS5EZWNyeXB0b3I9cixlKSx0Lm1vZGUuQ1RSO3ZhciBlLHJ9KG1nKCksUmcoKSl9KHtleHBvcnRzOnt9fSk7IWZ1bmN0aW9uKHQpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gdC5wYWQuTm9QYWRkaW5nPXtwYWQ6ZnVuY3Rpb24oKXt9LHVucGFkOmZ1bmN0aW9uKCl7fX0sdC5wYWQuTm9QYWRkaW5nfShtZygpLFJnKCkpfSh7ZXhwb3J0czp7fX0pO3ZhciB6Zz17fSxEZz17ZXhwb3J0czp7fX0sUGc9RGcuZXhwb3J0cz17djpbe25hbWU6InZlcnNpb24iLHJlZzovXihcZCopJC99XSxvOlt7bmFtZToib3JpZ2luIixyZWc6L14oXFMqKSAoXGQqKSAoXGQqKSAoXFMqKSBJUChcZCkgKFxTKikvLG5hbWVzOlsidXNlcm5hbWUiLCJzZXNzaW9uSWQiLCJzZXNzaW9uVmVyc2lvbiIsIm5ldFR5cGUiLCJpcFZlciIsImFkZHJlc3MiXSxmb3JtYXQ6IiVzICVzICVkICVzIElQJWQgJXMifV0sczpbe25hbWU6Im5hbWUifV0saTpbe25hbWU6ImRlc2NyaXB0aW9uIn1dLHU6W3tuYW1lOiJ1cmkifV0sZTpbe25hbWU6ImVtYWlsIn1dLHA6W3tuYW1lOiJwaG9uZSJ9XSx6Olt7bmFtZToidGltZXpvbmVzIn1dLHI6W3tuYW1lOiJyZXBlYXRzIn1dLHQ6W3tuYW1lOiJ0aW1pbmciLHJlZzovXihcZCopIChcZCopLyxuYW1lczpbInN0YXJ0Iiwic3RvcCJdLGZvcm1hdDoiJWQgJWQifV0sYzpbe25hbWU6ImNvbm5lY3Rpb24iLHJlZzovXklOIElQKFxkKSAoXFMqKS8sbmFtZXM6WyJ2ZXJzaW9uIiwiaXAiXSxmb3JtYXQ6IklOIElQJWQgJXMifV0sYjpbe3B1c2g6ImJhbmR3aWR0aCIscmVnOi9eKFRJQVN8QVN8Q1R8UlJ8UlMpOihcZCopLyxuYW1lczpbInR5cGUiLCJsaW1pdCJdLGZvcm1hdDoiJXM6JXMifV0sbTpbe3JlZzovXihcdyopIChcZCopIChbXHcvXSopKD86ICguKikpPy8sbmFtZXM6WyJ0eXBlIiwicG9ydCIsInByb3RvY29sIiwicGF5bG9hZHMiXSxmb3JtYXQ6IiVzICVkICVzICVzIn1dLGE6W3twdXNoOiJydHAiLHJlZzovXnJ0cG1hcDooXGQqKSAoW1x3XC0uXSopKD86XHMqXC8oXGQqKSg/OlxzKlwvKFxTKikpPyk/LyxuYW1lczpbInBheWxvYWQiLCJjb2RlYyIsInJhdGUiLCJlbmNvZGluZyJdLGZvcm1hdDpmdW5jdGlvbih0KXtyZXR1cm4gdC5lbmNvZGluZz8icnRwbWFwOiVkICVzLyVzLyVzIjp0LnJhdGU/InJ0cG1hcDolZCAlcy8lcyI6InJ0cG1hcDolZCAlcyJ9fSx7cHVzaDoiZm10cCIscmVnOi9eZm10cDooXGQqKSAoW1xTfCBdKikvLG5hbWVzOlsicGF5bG9hZCIsImNvbmZpZyJdLGZvcm1hdDoiZm10cDolZCAlcyJ9LHtuYW1lOiJjb250cm9sIixyZWc6L15jb250cm9sOiguKikvLGZvcm1hdDoiY29udHJvbDolcyJ9LHtuYW1lOiJydGNwIixyZWc6L15ydGNwOihcZCopKD86IChcUyopIElQKFxkKSAoXFMqKSk/LyxuYW1lczpbInBvcnQiLCJuZXRUeXBlIiwiaXBWZXIiLCJhZGRyZXNzIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiBudWxsIT10LmFkZHJlc3M/InJ0Y3A6JWQgJXMgSVAlZCAlcyI6InJ0Y3A6JWQifX0se3B1c2g6InJ0Y3BGYlRyckludCIscmVnOi9ecnRjcC1mYjooXCp8XGQqKSB0cnItaW50IChcZCopLyxuYW1lczpbInBheWxvYWQiLCJ2YWx1ZSJdLGZvcm1hdDoicnRjcC1mYjolcyB0cnItaW50ICVkIn0se3B1c2g6InJ0Y3BGYiIscmVnOi9ecnRjcC1mYjooXCp8XGQqKSAoW1x3LV9dKikoPzogKFtcdy1fXSopKT8vLG5hbWVzOlsicGF5bG9hZCIsInR5cGUiLCJzdWJ0eXBlIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiBudWxsIT10LnN1YnR5cGU/InJ0Y3AtZmI6JXMgJXMgJXMiOiJydGNwLWZiOiVzICVzIn19LHtwdXNoOiJleHQiLHJlZzovXmV4dG1hcDooXGQrKSg/OlwvKFx3KykpPyg/OiAodXJuOmlldGY6cGFyYW1zOnJ0cC1oZHJleHQ6ZW5jcnlwdCkpPyAoXFMqKSg/OiAoXFMqKSk/LyxuYW1lczpbInZhbHVlIiwiZGlyZWN0aW9uIiwiZW5jcnlwdC11cmkiLCJ1cmkiLCJjb25maWciXSxmb3JtYXQ6ZnVuY3Rpb24odCl7cmV0dXJuImV4dG1hcDolZCIrKHQuZGlyZWN0aW9uPyIvJXMiOiIldiIpKyh0WyJlbmNyeXB0LXVyaSJdPyIgJXMiOiIldiIpKyIgJXMiKyh0LmNvbmZpZz8iICVzIjoiIil9fSx7bmFtZToiZXh0bWFwQWxsb3dNaXhlZCIscmVnOi9eKGV4dG1hcC1hbGxvdy1taXhlZCkvfSx7cHVzaDoiY3J5cHRvIixyZWc6L15jcnlwdG86KFxkKikgKFtcd19dKikgKFxTKikoPzogKFxTKikpPy8sbmFtZXM6WyJpZCIsInN1aXRlIiwiY29uZmlnIiwic2Vzc2lvbkNvbmZpZyJdLGZvcm1hdDpmdW5jdGlvbih0KXtyZXR1cm4gbnVsbCE9dC5zZXNzaW9uQ29uZmlnPyJjcnlwdG86JWQgJXMgJXMgJXMiOiJjcnlwdG86JWQgJXMgJXMifX0se25hbWU6InNldHVwIixyZWc6L15zZXR1cDooXHcqKS8sZm9ybWF0OiJzZXR1cDolcyJ9LHtuYW1lOiJjb25uZWN0aW9uVHlwZSIscmVnOi9eY29ubmVjdGlvbjoobmV3fGV4aXN0aW5nKS8sZm9ybWF0OiJjb25uZWN0aW9uOiVzIn0se25hbWU6Im1pZCIscmVnOi9ebWlkOihbXlxzXSopLyxmb3JtYXQ6Im1pZDolcyJ9LHtuYW1lOiJtc2lkIixyZWc6L15tc2lkOiguKikvLGZvcm1hdDoibXNpZDolcyJ9LHtuYW1lOiJwdGltZSIscmVnOi9ecHRpbWU6KFxkKig/OlwuXGQqKSopLyxmb3JtYXQ6InB0aW1lOiVkIn0se25hbWU6Im1heHB0aW1lIixyZWc6L15tYXhwdGltZTooXGQqKD86XC5cZCopKikvLGZvcm1hdDoibWF4cHRpbWU6JWQifSx7bmFtZToiZGlyZWN0aW9uIixyZWc6L14oc2VuZHJlY3Z8cmVjdm9ubHl8c2VuZG9ubHl8aW5hY3RpdmUpL30se25hbWU6ImljZWxpdGUiLHJlZzovXihpY2UtbGl0ZSkvfSx7bmFtZToiaWNlVWZyYWciLHJlZzovXmljZS11ZnJhZzooXFMqKS8sZm9ybWF0OiJpY2UtdWZyYWc6JXMifSx7bmFtZToiaWNlUHdkIixyZWc6L15pY2UtcHdkOihcUyopLyxmb3JtYXQ6ImljZS1wd2Q6JXMifSx7bmFtZToiZmluZ2VycHJpbnQiLHJlZzovXmZpbmdlcnByaW50OihcUyopIChcUyopLyxuYW1lczpbInR5cGUiLCJoYXNoIl0sZm9ybWF0OiJmaW5nZXJwcmludDolcyAlcyJ9LHtwdXNoOiJjYW5kaWRhdGVzIixyZWc6L15jYW5kaWRhdGU6KFxTKikgKFxkKikgKFxTKikgKFxkKikgKFxTKikgKFxkKikgdHlwIChcUyopKD86IHJhZGRyIChcUyopIHJwb3J0IChcZCopKT8oPzogdGNwdHlwZSAoXFMqKSk/KD86IGdlbmVyYXRpb24gKFxkKikpPyg/OiBuZXR3b3JrLWlkIChcZCopKT8oPzogbmV0d29yay1jb3N0IChcZCopKT8vLG5hbWVzOlsiZm91bmRhdGlvbiIsImNvbXBvbmVudCIsInRyYW5zcG9ydCIsInByaW9yaXR5IiwiaXAiLCJwb3J0IiwidHlwZSIsInJhZGRyIiwicnBvcnQiLCJ0Y3B0eXBlIiwiZ2VuZXJhdGlvbiIsIm5ldHdvcmstaWQiLCJuZXR3b3JrLWNvc3QiXSxmb3JtYXQ6ZnVuY3Rpb24odCl7dmFyIGU9ImNhbmRpZGF0ZTolcyAlZCAlcyAlZCAlcyAlZCB0eXAgJXMiO3JldHVybiBlKz1udWxsIT10LnJhZGRyPyIgcmFkZHIgJXMgcnBvcnQgJWQiOiIldiV2IixlKz1udWxsIT10LnRjcHR5cGU/IiB0Y3B0eXBlICVzIjoiJXYiLG51bGwhPXQuZ2VuZXJhdGlvbiYmKGUrPSIgZ2VuZXJhdGlvbiAlZCIpLGUrPW51bGwhPXRbIm5ldHdvcmstaWQiXT8iIG5ldHdvcmstaWQgJWQiOiIldiIsZSs9bnVsbCE9dFsibmV0d29yay1jb3N0Il0/IiBuZXR3b3JrLWNvc3QgJWQiOiIldiJ9fSx7bmFtZToiZW5kT2ZDYW5kaWRhdGVzIixyZWc6L14oZW5kLW9mLWNhbmRpZGF0ZXMpL30se25hbWU6InJlbW90ZUNhbmRpZGF0ZXMiLHJlZzovXnJlbW90ZS1jYW5kaWRhdGVzOiguKikvLGZvcm1hdDoicmVtb3RlLWNhbmRpZGF0ZXM6JXMifSx7bmFtZToiaWNlT3B0aW9ucyIscmVnOi9eaWNlLW9wdGlvbnM6KFxTKikvLGZvcm1hdDoiaWNlLW9wdGlvbnM6JXMifSx7cHVzaDoic3NyY3MiLHJlZzovXnNzcmM6KFxkKikgKFtcd18tXSopKD86OiguKikpPy8sbmFtZXM6WyJpZCIsImF0dHJpYnV0ZSIsInZhbHVlIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3ZhciBlPSJzc3JjOiVkIjtyZXR1cm4gbnVsbCE9dC5hdHRyaWJ1dGUmJihlKz0iICVzIixudWxsIT10LnZhbHVlJiYoZSs9IjolcyIpKSxlfX0se3B1c2g6InNzcmNHcm91cHMiLHJlZzovXnNzcmMtZ3JvdXA6KFtceDIxXHgyM1x4MjRceDI1XHgyNlx4MjdceDJBXHgyQlx4MkRceDJFXHddKikgKC4qKS8sbmFtZXM6WyJzZW1hbnRpY3MiLCJzc3JjcyJdLGZvcm1hdDoic3NyYy1ncm91cDolcyAlcyJ9LHtuYW1lOiJtc2lkU2VtYW50aWMiLHJlZzovXm1zaWQtc2VtYW50aWM6XHM/KFx3KikgKFxTKikvLG5hbWVzOlsic2VtYW50aWMiLCJ0b2tlbiJdLGZvcm1hdDoibXNpZC1zZW1hbnRpYzogJXMgJXMifSx7cHVzaDoiZ3JvdXBzIixyZWc6L15ncm91cDooXHcqKSAoLiopLyxuYW1lczpbInR5cGUiLCJtaWRzIl0sZm9ybWF0OiJncm91cDolcyAlcyJ9LHtuYW1lOiJydGNwTXV4IixyZWc6L14ocnRjcC1tdXgpL30se25hbWU6InJ0Y3BSc2l6ZSIscmVnOi9eKHJ0Y3AtcnNpemUpL30se25hbWU6InNjdHBtYXAiLHJlZzovXnNjdHBtYXA6KFtcd18vXSopIChcUyopKD86IChcUyopKT8vLG5hbWVzOlsic2N0cG1hcE51bWJlciIsImFwcCIsIm1heE1lc3NhZ2VTaXplIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiBudWxsIT10Lm1heE1lc3NhZ2VTaXplPyJzY3RwbWFwOiVzICVzICVzIjoic2N0cG1hcDolcyAlcyJ9fSx7bmFtZToieEdvb2dsZUZsYWciLHJlZzovXngtZ29vZ2xlLWZsYWc6KFteXHNdKikvLGZvcm1hdDoieC1nb29nbGUtZmxhZzolcyJ9LHtwdXNoOiJyaWRzIixyZWc6L15yaWQ6KFtcZFx3XSspIChcdyspKD86IChbXFN8IF0qKSk/LyxuYW1lczpbImlkIiwiZGlyZWN0aW9uIiwicGFyYW1zIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiB0LnBhcmFtcz8icmlkOiVzICVzICVzIjoicmlkOiVzICVzIn19LHtwdXNoOiJpbWFnZWF0dHJzIixyZWc6bmV3IFJlZ0V4cCgiXmltYWdlYXR0cjooXFxkK3xcXCopW1xcc1xcdF0rKHNlbmR8cmVjdilbXFxzXFx0XSsoXFwqfFxcW1xcUytcXF0oPzpbXFxzXFx0XStcXFtcXFMrXFxdKSopKD86W1xcc1xcdF0rKHJlY3Z8c2VuZClbXFxzXFx0XSsoXFwqfFxcW1xcUytcXF0oPzpbXFxzXFx0XStcXFtcXFMrXFxdKSopKT8iKSxuYW1lczpbInB0IiwiZGlyMSIsImF0dHJzMSIsImRpcjIiLCJhdHRyczIiXSxmb3JtYXQ6ZnVuY3Rpb24odCl7cmV0dXJuImltYWdlYXR0cjolcyAlcyAlcyIrKHQuZGlyMj8iICVzICVzIjoiIil9fSx7bmFtZToic2ltdWxjYXN0IixyZWc6bmV3IFJlZ0V4cCgiXnNpbXVsY2FzdDooc2VuZHxyZWN2KSAoW2EtekEtWjAtOVxcLV9+OyxdKykoPzpcXHM/KHNlbmR8cmVjdikgKFthLXpBLVowLTlcXC1ffjssXSspKT8kIiksbmFtZXM6WyJkaXIxIiwibGlzdDEiLCJkaXIyIiwibGlzdDIiXSxmb3JtYXQ6ZnVuY3Rpb24odCl7cmV0dXJuInNpbXVsY2FzdDolcyAlcyIrKHQuZGlyMj8iICVzICVzIjoiIil9fSx7bmFtZToic2ltdWxjYXN0XzAzIixyZWc6L15zaW11bGNhc3Q6W1xzXHRdKyhbXFMrXHNcdF0rKSQvLG5hbWVzOlsidmFsdWUiXSxmb3JtYXQ6InNpbXVsY2FzdDogJXMifSx7bmFtZToiZnJhbWVyYXRlIixyZWc6L15mcmFtZXJhdGU6KFxkKyg/OiR8XC5cZCspKS8sZm9ybWF0OiJmcmFtZXJhdGU6JXMifSx7bmFtZToic291cmNlRmlsdGVyIixyZWc6L15zb3VyY2UtZmlsdGVyOiAqKGV4Y2x8aW5jbCkgKFxTKikgKElQNHxJUDZ8XCopIChcUyopICguKikvLG5hbWVzOlsiZmlsdGVyTW9kZSIsIm5ldFR5cGUiLCJhZGRyZXNzVHlwZXMiLCJkZXN0QWRkcmVzcyIsInNyY0xpc3QiXSxmb3JtYXQ6InNvdXJjZS1maWx0ZXI6ICVzICVzICVzICVzICVzIn0se25hbWU6ImJ1bmRsZU9ubHkiLHJlZzovXihidW5kbGUtb25seSkvfSx7bmFtZToibGFiZWwiLHJlZzovXmxhYmVsOiguKykvLGZvcm1hdDoibGFiZWw6JXMifSx7bmFtZToic2N0cFBvcnQiLHJlZzovXnNjdHAtcG9ydDooXGQrKSQvLGZvcm1hdDoic2N0cC1wb3J0OiVzIn0se25hbWU6Im1heE1lc3NhZ2VTaXplIixyZWc6L15tYXgtbWVzc2FnZS1zaXplOihcZCspJC8sZm9ybWF0OiJtYXgtbWVzc2FnZS1zaXplOiVzIn0se3B1c2g6InRzUmVmQ2xvY2tzIixyZWc6L150cy1yZWZjbGs6KFteXHM9XSopKD86PShcUyopKT8vLG5hbWVzOlsiY2xrc3JjIiwiY2xrc3JjRXh0Il0sZm9ybWF0OmZ1bmN0aW9uKHQpe3JldHVybiJ0cy1yZWZjbGs6JXMiKyhudWxsIT10LmNsa3NyY0V4dD8iPSVzIjoiIil9fSx7bmFtZToibWVkaWFDbGsiLHJlZzovXm1lZGlhY2xrOig/OmlkPShcUyopKT8gKihbXlxzPV0qKSg/Oj0oXFMqKSk/KD86ICpyYXRlPShcZCspXC8oXGQrKSk/LyxuYW1lczpbImlkIiwibWVkaWFDbG9ja05hbWUiLCJtZWRpYUNsb2NrVmFsdWUiLCJyYXRlTnVtZXJhdG9yIiwicmF0ZURlbm9taW5hdG9yIl0sZm9ybWF0OmZ1bmN0aW9uKHQpe3ZhciBlPSJtZWRpYWNsazoiO3JldHVybiBlKz1udWxsIT10LmlkPyJpZD0lcyAlcyI6IiV2JXMiLGUrPW51bGwhPXQubWVkaWFDbG9ja1ZhbHVlPyI9JXMiOiIiLGUrPW51bGwhPXQucmF0ZU51bWVyYXRvcj8iIHJhdGU9JXMiOiIiLGUrPW51bGwhPXQucmF0ZURlbm9taW5hdG9yPyIvJXMiOiIifX0se25hbWU6ImtleXdvcmRzIixyZWc6L15rZXl3ZHM6KC4rKSQvLGZvcm1hdDoia2V5d2RzOiVzIn0se25hbWU6ImNvbnRlbnQiLHJlZzovXmNvbnRlbnQ6KC4rKS8sZm9ybWF0OiJjb250ZW50OiVzIn0se25hbWU6ImJmY3BGbG9vckN0cmwiLHJlZzovXmZsb29yY3RybDooYy1vbmx5fHMtb25seXxjLXMpLyxmb3JtYXQ6ImZsb29yY3RybDolcyJ9LHtuYW1lOiJiZmNwQ29uZklkIixyZWc6L15jb25maWQ6KFxkKykvLGZvcm1hdDoiY29uZmlkOiVzIn0se25hbWU6ImJmY3BVc2VySWQiLHJlZzovXnVzZXJpZDooXGQrKS8sZm9ybWF0OiJ1c2VyaWQ6JXMifSx7bmFtZToiYmZjcEZsb29ySWQiLHJlZzovXmZsb29yaWQ6KC4rKSAoPzptLXN0cmVhbXxtc3RybSk6KC4rKS8sbmFtZXM6WyJpZCIsIm1TdHJlYW0iXSxmb3JtYXQ6ImZsb29yaWQ6JXMgbXN0cm06JXMifSx7cHVzaDoiaW52YWxpZCIsbmFtZXM6WyJ2YWx1ZSJdfV19O09iamVjdC5rZXlzKFBnKS5mb3JFYWNoKChmdW5jdGlvbih0KXtQZ1t0XS5mb3JFYWNoKChmdW5jdGlvbih0KXt0LnJlZ3x8KHQucmVnPS8oLiopLyksdC5mb3JtYXR8fCh0LmZvcm1hdD0iJXMiKX0pKX0pKTt2YXIgTWc9RGcuZXhwb3J0czshZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24odCl7cmV0dXJuIFN0cmluZyhOdW1iZXIodCkpPT09dD9OdW1iZXIodCk6dH0scj1mdW5jdGlvbih0LHIsbil7dmFyIGk9dC5uYW1lJiZ0Lm5hbWVzO3QucHVzaCYmIXJbdC5wdXNoXT9yW3QucHVzaF09W106aSYmIXJbdC5uYW1lXSYmKHJbdC5uYW1lXT17fSk7dmFyIG89dC5wdXNoP3t9Omk/clt0Lm5hbWVdOnI7IWZ1bmN0aW9uKHQscixuLGkpe2lmKGkmJiFuKXJbaV09ZSh0WzFdKTtlbHNlIGZvcih2YXIgbz0wO288bi5sZW5ndGg7bys9MSludWxsIT10W28rMV0mJihyW25bb11dPWUodFtvKzFdKSl9KG4ubWF0Y2godC5yZWcpLG8sdC5uYW1lcyx0Lm5hbWUpLHQucHVzaCYmclt0LnB1c2hdLnB1c2gobyl9LG49TWcsaT1SZWdFeHAucHJvdG90eXBlLnRlc3QuYmluZCgvXihbYS16XSk9KC4qKS8pO3QucGFyc2U9ZnVuY3Rpb24odCl7dmFyIGU9e30sbz1bXSxzPWU7cmV0dXJuIHQuc3BsaXQoLyhcclxufFxyfFxuKS8pLmZpbHRlcihpKS5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgZT10WzBdLGk9dC5zbGljZSgyKTsibSI9PT1lJiYoby5wdXNoKHtydHA6W10sZm10cDpbXX0pLHM9b1tvLmxlbmd0aC0xXSk7Zm9yKHZhciBhPTA7YTwobltlXXx8W10pLmxlbmd0aDthKz0xKXt2YXIgYz1uW2VdW2FdO2lmKGMucmVnLnRlc3QoaSkpcmV0dXJuIHIoYyxzLGkpfX0pKSxlLm1lZGlhPW8sZX07dmFyIG89ZnVuY3Rpb24odCxyKXt2YXIgbj1yLnNwbGl0KC89KC4rKS8sMik7cmV0dXJuIDI9PT1uLmxlbmd0aD90W25bMF1dPWUoblsxXSk6MT09PW4ubGVuZ3RoJiZyLmxlbmd0aD4xJiYodFtuWzBdXT12b2lkIDApLHR9O3QucGFyc2VQYXJhbXM9ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoLztccz8vKS5yZWR1Y2Uobyx7fSl9LHQucGFyc2VGbXRwQ29uZmlnPXQucGFyc2VQYXJhbXMsdC5wYXJzZVBheWxvYWRzPWZ1bmN0aW9uKHQpe3JldHVybiB0LnRvU3RyaW5nKCkuc3BsaXQoIiAiKS5tYXAoTnVtYmVyKX0sdC5wYXJzZVJlbW90ZUNhbmRpZGF0ZXM9ZnVuY3Rpb24odCl7Zm9yKHZhciByPVtdLG49dC5zcGxpdCgiICIpLm1hcChlKSxpPTA7aTxuLmxlbmd0aDtpKz0zKXIucHVzaCh7Y29tcG9uZW50Om5baV0saXA6bltpKzFdLHBvcnQ6bltpKzJdfSk7cmV0dXJuIHJ9LHQucGFyc2VJbWFnZUF0dHJpYnV0ZXM9ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoIiAiKS5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiB0LnN1YnN0cmluZygxLHQubGVuZ3RoLTEpLnNwbGl0KCIsIikucmVkdWNlKG8se30pfSkpfSx0LnBhcnNlU2ltdWxjYXN0U3RyZWFtTGlzdD1mdW5jdGlvbih0KXtyZXR1cm4gdC5zcGxpdCgiOyIpLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIHQuc3BsaXQoIiwiKS5tYXAoKGZ1bmN0aW9uKHQpe3ZhciByLG49ITE7cmV0dXJuIn4iIT09dFswXT9yPWUodCk6KHI9ZSh0LnN1YnN0cmluZygxLHQubGVuZ3RoKSksbj0hMCkse3NjaWQ6cixwYXVzZWQ6bn19KSl9KSl9fSh6Zyk7dmFyIEZnO25ldyBUZXh0RGVjb2RlcixuZXcgVGV4dEVuY29kZXIsInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJih3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluY2x1ZGVzKCJfcnRjX2RlYnVnXyIpfHxudWxsIT09KEZnPXdpbmRvdy5sb2NhbFN0b3JhZ2UpJiZ2b2lkIDAhPT1GZyYmRmcuZ2V0SXRlbSgiX3J0Y19kZWJ1Z18iKSk7Y29uc3Qgamc9e2dldE5BTFVuaXRzKHQpe2xldCBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdJiZhcmd1bWVudHNbMV07aWYodC5sZW5ndGgtdC5wb3NpdGlvbjw0KXJldHVybltdO2NvbnN0e3Bvc2l0aW9uOnJ9PXQ7cmV0dXJuIDE9PT10LmdldEludDMyKHIpfHwwPT09dC5nZXRJbnQxNihyKSYmMT09PXQuZ2V0SW50OChyKzIpP2pnLmdldEFubmV4Yk5hbHModCxlKTpqZy5nZXRBdmNjTmFscyh0LGUpfSxnZXRBbm5leGJOYWxzKHQsZSl7Y29uc3Qgcj1bXTtsZXQgbj1qZy5nZXRIZWFkZXJQb3NpdGlvbkFubmV4Qih0KSxpPW4ucG9zLG89aTtmb3IoO2k8dC5sZW5ndGgtNDspe2NvbnN0IHM9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIuc2xpY2UoaSxpK24uaGVhZGVyTGVuZ3RoKSk7bi5wb3M9PT10LnBvc2l0aW9uJiZ0LnNraXAobi5oZWFkZXJMZW5ndGgpLG49amcuZ2V0SGVhZGVyUG9zaXRpb25Bbm5leEIodCksbz1uLnBvcztjb25zdCBhPXtoZWFkZXI6cyxib2R5Om5ldyBVaW50OEFycmF5KHQuYnVmZmVyLnNsaWNlKGkrcy5ieXRlTGVuZ3RoLG8pKSx0eXBlOi0xfTtlP2pnLmFuYWx5c2VIMjY1TmFsKGEpOmpnLmFuYWx5c2VOYWwoYSksKGEudHlwZTw9OXx8ZSYmYS50eXBlPD00MCkmJjAhPT1hLnR5cGUmJnIucHVzaChhKSx0LnNraXAoby10LnBvc2l0aW9uKSxpPW99cmV0dXJuIHJ9LGdldEF2Y2NOYWxzKHQsZSl7Y29uc3Qgcj1bXTtmb3IoO3QucG9zaXRpb248dC5sZW5ndGgtNDspe2NvbnN0IG49dC5nZXRJbnQzMih0LnBvc2l0aW9uKTtpZighKHQubGVuZ3RoLXQucG9zaXRpb24+PW4pKWJyZWFrO3tjb25zdCBpPW5ldyBVaW50OEFycmF5KHQuYnVmZmVyLnNsaWNlKHQucG9zaXRpb24sdC5wb3NpdGlvbis0KSk7dC5za2lwKDQpO2NvbnN0IG89bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIuc2xpY2UodC5wb3NpdGlvbix0LnBvc2l0aW9uK24pKTt0LnNraXAobik7Y29uc3Qgcz17aGVhZGVyOmksYm9keTpvLHR5cGU6LTF9O2U/amcuYW5hbHlzZUgyNjVOYWwocyk6amcuYW5hbHlzZU5hbChzKSxzLnR5cGU8PTkmJjAhPT1zLnR5cGUmJnIucHVzaChzKX19cmV0dXJuIHJ9LGFuYWx5c2VOYWwodCl7Y29uc3QgZT0zMSZ0LmJvZHlbMF07c3dpdGNoKHQudHlwZT1lLGUpe2Nhc2UgMTp0Lm5kcj0hMDticmVhaztjYXNlIDU6dC5pZHI9ITA7YnJlYWs7Y2FzZSA2OnQuc2VpPSEwO2JyZWFrO2Nhc2UgNzp0LnNwcz0hMDticmVhaztjYXNlIDg6dC5wcHM9ITB9fSxhbmFseXNlSDI2NU5hbCh0KXtjb25zdCBlPSgxMjYmdC5ib2R5WzBdKT4+MTtzd2l0Y2godC50eXBlPWUsZSl7Y2FzZSAzOTpjYXNlIDQwOnQuc2VpPSEwfX0sZ2V0SGVhZGVyUG9zaXRpb25Bbm5leEIodCl7bGV0IGU9dC5wb3NpdGlvbixyPTA7Y29uc3Qgbj10Lmxlbmd0aDtmb3IoOzMhPT1yJiY0IT09ciYmZTxuLTQ7KTA9PT10LmdldEludDE2KGUpPzE9PT10LmdldEludDE2KGUrMik/cj00OjE9PT10LmdldEludDgoZSsyKT9yPTM6ZSsrOmUrKztyZXR1cm4gZT09PW4tNCYmKDA9PT10LmdldEludDE2KGUpPzE9PT10LmdldEludDE2KGUrMik/cj00OmU9bjooZSsrLDA9PT10LmdldEludDE2KGUpJiYxPT09dC5nZXRJbnQ4KGUpP3I9MzplPW4pKSx7cG9zOmUsaGVhZGVyTGVuZ3RoOnJ9fSxnZXRDb2RlY05hbWVGcm9tRnJhbWUodCxlKXtjb25zdHttaW1lVHlwZTpyLHBheWxvYWRUeXBlOm59PXQuZ2V0TWV0YWRhdGEoKTtyZXR1cm4gcj9mdW5jdGlvbih0KXtyZXR1cm4gdC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJoMjY1Iik/ZmwuSDI2NTp0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImgyNjQiKT9mbC5IMjY0OnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygidnA4Iik/ZmwuVlA4OnZvaWQgMH0ocik6biYmZT9lW25dOnZvaWQgMH0saXNIMjY1VmlkZW9GcmFtZSh0KXt2YXIgZTtyZXR1cm4oKG51bGw9PT0oZT10LmdldE1ldGFkYXRhKXx8dm9pZCAwPT09ZXx8bnVsbD09PShlPWUuY2FsbCh0KSl8fHZvaWQgMD09PWU/dm9pZCAwOmUubWltZVR5cGUpfHwiIikudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiaDI2NSIpfX0sVWc9bmV3IFVpbnQ4QXJyYXkoWzEwOSwxNjcsNTMsMTkwLDEwMyw5MCw3MiwxLDE3MCw4OSw2MywxNjQsMTk0LDE5OSwxOSw4NV0pLEhnPW5ldyBVaW50OEFycmF5KFsxMDksMTY3LDUzLDE5MCwxMDMsOTAsNzIsMSwxNzAsODksNjMsMTY0LDE5NCwxOTksMTksODRdKSxLZz1uZXcgVWludDhBcnJheShbMzEsMjM5LDMsNTAsMjQyLDEyMCw3Niw4NSwxNjksNDIsMTYxLDkxLDc1LDE4NiwyMl0pO2Z1bmN0aW9uIEpnKHQpe2NvbnN0IGU9W107Zm9yKDt0Pj0yNTU7KXQtPTI1NSxlLnB1c2goMjU1KTtyZXR1cm4gZS5wdXNoKHQpLG5ldyBVaW50OEFycmF5KGUpfWZ1bmN0aW9uIFdnKHQpe2xldCBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowLHI9MDtmb3IoOzI1NT09PXRbZV0mJmU8dC5ieXRlTGVuZ3RoOyllKysscis9MjU1O3JldHVybiBlPHQuYnl0ZUxlbmd0aCYmKHIrPXRbZSsrXSksW3IsZV19Y29uc3QgWmc9bmV3IFVpbnQ4QXJyYXkoWzgwLDFdKTtjbGFzcyBHZ3tzdGF0aWMgZ2VuZXJhdGVTRUkodCxlKXtsZXQgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXSYmYXJndW1lbnRzWzJdO2NvbnN0IG49bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDFdKSxpPWU/Wmc6bmV3IFVpbnQ4QXJyYXkoWzZdKSxvPW5ldyBVaW50OEFycmF5KFs1XSkscz1HZy5fX3V1aWR8fChyP1VnOkhnKSxhPUpnKHQuYnl0ZUxlbmd0aCtzLmJ5dGVMZW5ndGgpLGM9KHQ9Pntjb25zdCBlPVtdO2xldCByPTA7Zm9yKGNvbnN0IG4gb2YgdClyPj0yJiZuPD0zJiYoZS5wdXNoKDMpLHI9MCksMD09PW4/cisrOnI9MCxlLnB1c2gobik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGUpfSkodCk7cmV0dXJuIG5ldyBVaW50OEFycmF5KFsuLi5uLC4uLmksLi4ubywuLi5hLC4uLnMsLi4uYywxMjhdKX1zdGF0aWMgZGVjb2RlU0VJQm9keSh0LGUpe2NvbnN0IHI9KHQ9Pntjb25zdCBlPVtdO2ZvcihsZXQgcj0wO3I8dC5sZW5ndGg7cisrKXRbcl08PTMmJjA9PT10W3ItMV0mJjA9PT10W3ItMl18fGUucHVzaCh0W3JdKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoZSl9KSh0PXQuc2xpY2UoMCx0Lmxlbmd0aC0xKSk7aWYoci5ieXRlTGVuZ3RoPDIpcmV0dXJuO2xldCBuPTA7Y29uc3QgaT1lPzI6MTtpZig1IT09cltpXSYmMTAwIT09cltpXSlyZXR1cm47bis9MStpO2NvbnN0W28sc109V2cocixuKTtuPXM7bGV0IGE9Mjtjb25zdCBjPW4rbztyLmJ5dGVMZW5ndGg+PUhnLmJ5dGVMZW5ndGgmJm8+PUhnLmJ5dGVMZW5ndGgmJihyLnNsaWNlKG4sbitIZy5ieXRlTGVuZ3RoKS50b1N0cmluZygpPT09SGcudG9TdHJpbmcoKXx8ci5zbGljZShuLG4rS2cuYnl0ZUxlbmd0aCkudG9TdHJpbmcoKT09PUtnLnRvU3RyaW5nKCkpPyhuKz1IZy5ieXRlTGVuZ3RoLGE9MSk6ci5ieXRlTGVuZ3RoPj1IZy5ieXRlTGVuZ3RoJiZvPj1IZy5ieXRlTGVuZ3RoJiZyLnNsaWNlKG4sbitVZy5ieXRlTGVuZ3RoKS50b1N0cmluZygpPT09VWcudG9TdHJpbmcoKSYmKG4rPVVnLmJ5dGVMZW5ndGgsYT0wKTtyZXR1cm57dHlwZTphLHBheWxvYWQ6ci5zbGljZShuLGMpfX1zdGF0aWMgcGFyc2VJbnRlcm5hbFNFSSh0KXtjb25zdCBlPW5ldyBNYXA7bGV0IHI9MDtpZigwPT09dC50eXBlKXtmb3IoO3QucGF5bG9hZC5ieXRlTGVuZ3RoLXI+PTI7KXtjb25zdFtuLGldPVdnKHQucGF5bG9hZCxyKTtyPWk7Y29uc3RbbyxzXT1XZyh0LnBheWxvYWQscik7aWYocj1zLGUuZ2V0KG4pfHwhKG88PXQucGF5bG9hZC5ieXRlTGVuZ3RoLXIpKWJyZWFrO2Uuc2V0KG4sdC5wYXlsb2FkLnNsaWNlKHIscitvKSkscis9b31yZXR1cm4gZX19c3RhdGljIG1ha2VJbnRlcm5hbFNlaSh0KXtjb25zdCBlPVtdO2Zvcihjb25zdFtpLG9db2YgdCl7Y29uc3QgdD1KZyhpKSxyPUpnKG8uYnl0ZUxlbmd0aCk7ZS5wdXNoKHQscixvKX1jb25zdCByPWUucmVkdWNlKCgodCxlKT0+dCtlLmJ5dGVMZW5ndGgpLDApLG49bmV3IFVpbnQ4QXJyYXkocik7cmV0dXJuIGUucmVkdWNlKCgodCxlKT0+KG4uc2V0KGUsdCksdCtlLmJ5dGVMZW5ndGgpKSwwKSxufX1sbChHZywiX191dWlkIix2b2lkIDApO2NsYXNzIFZne2NvbnN0cnVjdG9yKHQpe2xsKHRoaXMsInNlaUxpc3QiLFtdKSxsbCh0aGlzLCJtYXhTRUlDb3VudCIsMSksbGwodGhpcywicGF5bG9hZE1hcCIsdm9pZCAwKSxsbCh0aGlzLCJjdXJyZW50Q29kZWMiLHZvaWQgMCksdGhpcy5tYXhTRUlDb3VudD10Lm1heFNFSUNvdW50LHRoaXMucGF5bG9hZE1hcD10LnBheWxvYWRNYXB9c2VuZFNFSVRyYW5zZm9ybSh0LGUpe3ZhciByO2NvbnN0e21heFNFSUNvdW50Om4sc2VpTGlzdDppfT10aGlzO2lmKG51bGwhPT0ocj1qZy5nZXRDb2RlY05hbWVGcm9tRnJhbWUodCx0aGlzLnBheWxvYWRNYXApKSYmdm9pZCAwIT09cnx8dGhpcy5jdXJyZW50Q29kZWMsIXRoaXMuc2VpTGlzdC5sZW5ndGgpcmV0dXJuIHZvaWQgZS5lbnF1ZXVlKHQpO2NvbnN0IG89W107bGV0IHM9MDtmb3IoY29uc3QgbCBvZiBpKXt2YXIgYTtpZihvLmxlbmd0aD49bilicmVhaztjb25zdCBlPW51bGwhPT0oYT1qZy5nZXRDb2RlY05hbWVGcm9tRnJhbWUodCx0aGlzLnBheWxvYWRNYXApKSYmdm9pZCAwIT09YT9hOnRoaXMuY3VycmVudENvZGVjO2lmKGUhPT1mbC5IMjY0JiZlIT09ZmwuSDI2NSljb250aW51ZTtjb25zdCByPUdnLmdlbmVyYXRlU0VJKGwuY29udGVudCxlPT09ZmwuSDI2NSk7cys9ci5ieXRlTGVuZ3RoLGwucmVwZWF0Q291bnQtLSxvLnB1c2gocil9dGhpcy5zZWlMaXN0PWkuZmlsdGVyKCh0PT50LnJlcGVhdENvdW50PjApKTtjb25zdCBjPW5ldyBVaW50OEFycmF5KHMrdC5kYXRhLmJ5dGVMZW5ndGgpO2Muc2V0KG5ldyBVaW50OEFycmF5KHQuZGF0YSkpO2xldCB1PXQuZGF0YS5ieXRlTGVuZ3RoO28uZm9yRWFjaCgodD0+e2Muc2V0KHQsdSksdSs9dC5ieXRlTGVuZ3RofSkpLHQuZGF0YT1jLmJ1ZmZlcixlLmVucXVldWUodCl9cHVzaFNFSSh0KXt0aGlzLnNlaUxpc3QucHVzaCh0KX1yZXZva2VTRUkodCl7Y29uc3QgZT10aGlzLnNlaUxpc3QuZmluZEluZGV4KChlPT5lLnV1aWQ9PT10KSk7cmV0dXJuLTEhPT1lJiYodGhpcy5zZWlMaXN0LnNwbGljZShlLDEpLCEwKX1zZXRDb2RlYyh0KXt0aGlzLmN1cnJlbnRDb2RlYz10fX0idW5kZWZpbmVkIiE9dHlwZW9mIHNlbGYmJiJEZWRpY2F0ZWRXb3JrZXJHbG9iYWxTY29wZSI9PT1zZWxmLmNvbnN0cnVjdG9yLm5hbWUmJnNlbGYuYWRkRXZlbnRMaXN0ZW5lcigicnRjdHJhbnNmb3JtIiwodD0+e2NvbnN0e3RyYW5zZm9ybWVyOmV9PXQse21heFNFSUNvdW50OnIscGF5bG9hZE1hcDpufT1lLm9wdGlvbnMsaT1uZXcgVmcoe21heFNFSUNvdW50OnIscGF5bG9hZE1hcDpufSksbz1uZXcgVHJhbnNmb3JtU3RyZWFtKHt0cmFuc2Zvcm06aS5zZW5kU0VJVHJhbnNmb3JtLmJpbmQoaSl9KTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCh0PT57bGV0e2RhdGE6ZX09dDtjb25zdHt0eXBlOnIsY29udGVudDpufT1lO2lmKCJwdXNoIj09PXIpaS5wdXNoU0VJKG4pO2Vsc2V7aWYoInJldm9rZSI9PT1yKXtjb25zdCB0PWkucmV2b2tlU0VJKG4pO3JldHVybiBzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJyZXZva2UtYWNrIixjb250ZW50Ont1dWlkOm4saXNOb3RTZW5kOnR9fSl9InNldENvZGVjIj09PXImJmkuc2V0Q29kZWMobil9fSkpLGUucmVhZGFibGUucGlwZVRocm91Z2gobykucGlwZVRvKGUud3JpdGFibGUpfSkpfSgpOwo=",qS=typeof window<"u"&&window.Blob&&new Blob([atob(ZI)],{type:"text/javascript;charset=utf-8"});function h3(){let t;try{if(t=qS&&(fi||window.webkitURL).createObjectURL(qS),!t)throw"";return new Worker(t)}catch{return new Worker("data:application/javascript;base64,"+ZI)}finally{!(typeof window<"u"&&navigator.userAgent.indexOf("Trident/")>0)&&t&&(fi||window.webkitlRL).revokeObjectURL(t)}}const hi={getNALUnits(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(t.length-t.position<4)return[];const{position:i}=t;return t.getInt32(i)===1||t.getInt16(i)===0&&t.getInt8(i+2)===1?hi.getAnnexbNals(t,e):hi.getAvccNals(t,e)},getAnnexbNals(t,e){const i=[];let s=hi.getHeaderPositionAnnexB(t),o=s.pos,r=o;for(;o<t.length-4;){const n=new Uint8Array(t.buffer.slice(o,o+s.headerLength));s.pos===t.position&&t.skip(s.headerLength),s=hi.getHeaderPositionAnnexB(t),r=s.pos;const a={header:n,body:new Uint8Array(t.buffer.slice(o+n.byteLength,r)),type:-1};e?hi.analyseH265Nal(a):hi.analyseNal(a),(a.type<=9||e&&a.type<=40)&&a.type!==0&&i.push(a),t.skip(r-t.position),o=r}return i},getAvccNals(t,e){const i=[];for(;t.position<t.length-4;){const s=t.getInt32(t.position);if(!(t.length-t.position>=s))break;{const o=new Uint8Array(t.buffer.slice(t.position,t.position+4));t.skip(4);const r=new Uint8Array(t.buffer.slice(t.position,t.position+s));t.skip(s);const n={header:o,body:r,type:-1};e?hi.analyseH265Nal(n):hi.analyseNal(n),n.type<=9&&n.type!==0&&i.push(n)}}return i},analyseNal(t){const e=31&t.body[0];switch(t.type=e,e){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:t.sei=!0;break;case 7:t.sps=!0;break;case 8:t.pps=!0}},analyseH265Nal(t){const e=(126&t.body[0])>>1;switch(t.type=e,e){case 39:case 40:t.sei=!0}},getHeaderPositionAnnexB(t){let e=t.position,i=0;const s=t.length;for(;i!==3&&i!==4&&e<s-4;)t.getInt16(e)===0?t.getInt16(e+2)===1?i=4:t.getInt8(e+2)===1?i=3:e++:e++;return e===s-4&&(t.getInt16(e)===0?t.getInt16(e+2)===1?i=4:e=s:(e++,t.getInt16(e)===0&&t.getInt8(e)===1?i=3:e=s)),{pos:e,headerLength:i}},getCodecNameFromFrame(t,e){const{mimeType:i,payloadType:s}=t.getMetadata();return i?hZ(i):s&&e?e[s]:void 0},isH265VideoFrame(t){var e;return(((e=t.getMetadata)===null||e===void 0||(e=e.call(t))===null||e===void 0?void 0:e.mimeType)||"").toLowerCase().includes("h265")}};class ui{constructor(e){m(this,"_position",0),m(this,"_dataview",void 0),this._dataview=new DataView(e)}get length(){return this.buffer.byteLength}get buffer(){return this._dataview.buffer}set position(e){this._position=e}get position(){return this._position}back(e){this.position-=e}getUint8(e){return this._dataview.getUint8(e)}getInt8(e){return this._dataview.getInt8(e)}getInt16(e){return this._dataview.getInt16(e)}getUint16(e){return this._dataview.getUint16(e)}getUint32(e){return this._dataview.getUint32(e)}getInt32(e){return this._dataview.getInt32(e)}skip(e){const i=Math.floor(e/4),s=e%4;for(let o=0;o<i;o++)ui.readByte(this,4);s>0&&ui.readByte(this,s)}static readByte(e,i,s){let o;switch(i){case 1:o=s?e.getInt8(e.position):e.getUint8(e.position);break;case 2:o=s?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(s)throw new Error("not supported for readByte 3");o=e.getUint8(e.position)<<16,o|=e.getUint8(e.position+1)<<8,o|=e.getUint8(e.position+2);break;case 4:o=s?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(s)throw new Error("not supported for readBody 8");o=e.getUint32(e.position)<<32,o|=e.getUint32(e.position+4);break;default:o=""}return e.position+=i,o}readUint8(){return ui.readByte(this,1)}readUint16(){return ui.readByte(this,2)}readUint24(){return ui.readByte(this,3)}readUint32(){return ui.readByte(this,4)}readUint64(){return ui.readByte(this,8)}readInt8(){return ui.readByte(this,1,!0)}readInt16(){return ui.readByte(this,2,!0)}readInt32(){return ui.readByte(this,4,!0)}writeUint32(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}class TI{constructor(e){m(this,"skipFilter",void 0),m(this,"postMessage",void 0),m(this,"currentCodec",void 0),m(this,"payloadMap",void 0),this.skipFilter=e.skipFilter,this.postMessage=e.postMessage,this.payloadMap=e.payloadMap}transform(e,i){var s;const o=(s=hi.getCodecNameFromFrame(e,this.payloadMap))!==null&&s!==void 0?s:this.currentCodec;if(o!==Xe.H264&&o!==Xe.H265)return void i.enqueue(e);hi.getNALUnits(new ui(e.data),o===Xe.H265).forEach((r=>{if(r.sei){const n=Rn.decodeSEIBody(r.body,o===Xe.H265);n&&(this.skipFilter||n.type===rT.external)&&this.postMessage(n)}})),i.enqueue(e)}setCodec(e){this.currentCodec=e}}typeof self<"u"&&self.constructor.name==="DedicatedWorkerGlobalScope"&&self.addEventListener("rtctransform",(t=>{const{transformer:e}=t,{streamId:i,skipFilter:s,payloadMap:o}=e.options,r=new TI({postMessage:a=>{self.postMessage({streamId:i,msg:a},[a.payload.buffer])},skipFilter:s,payloadMap:o}),n=new TransformStream({transform:r.transform.bind(r)});self.addEventListener("message",(a=>{let{data:c}=a;const{type:d,content:l}=c;d==="setCodec"&&i===c.streamId&&r.setCodec(l)})),e.readable.pipeThrough(n).pipeTo(t.transformer.writable)}));class II{constructor(e){m(this,"seiList",[]),m(this,"maxSEICount",1),m(this,"payloadMap",void 0),m(this,"currentCodec",void 0),this.maxSEICount=e.maxSEICount,this.payloadMap=e.payloadMap}sendSEITransform(e,i){var s;const{maxSEICount:o,seiList:r}=this;if((s=hi.getCodecNameFromFrame(e,this.payloadMap))!==null&&s!==void 0||this.currentCodec,!this.seiList.length)return void i.enqueue(e);const n=[];let a=0;for(const u of r){var c;if(n.length>=o)break;const p=(c=hi.getCodecNameFromFrame(e,this.payloadMap))!==null&&c!==void 0?c:this.currentCodec;if(p!==Xe.H264&&p!==Xe.H265)continue;const h=Rn.generateSEI(u.content,p===Xe.H265);a+=h.byteLength,u.repeatCount--,n.push(h)}this.seiList=r.filter((u=>u.repeatCount>0));const d=new Uint8Array(a+e.data.byteLength);d.set(new Uint8Array(e.data));let l=e.data.byteLength;n.forEach((u=>{d.set(u,l),l+=u.byteLength})),e.data=d.buffer,i.enqueue(e)}pushSEI(e){this.seiList.push(e)}revokeSEI(e){const i=this.seiList.findIndex((s=>s.uuid===e));return i!==-1&&(this.seiList.splice(i,1),!0)}setCodec(e){this.currentCodec=e}}typeof self<"u"&&self.constructor.name==="DedicatedWorkerGlobalScope"&&self.addEventListener("rtctransform",(t=>{const{transformer:e}=t,{maxSEICount:i,payloadMap:s}=e.options,o=new II({maxSEICount:i,payloadMap:s}),r=new TransformStream({transform:o.sendSEITransform.bind(o)});self.addEventListener("message",(n=>{let{data:a}=n;const{type:c,content:d}=a;if(c==="push")o.pushSEI(d);else{if(c==="revoke"){const l=o.revokeSEI(d);return self.postMessage({type:"revoke-ack",content:{uuid:d,isNotSend:l}})}c==="setCodec"&&o.setCodec(d)}})),e.readable.pipeThrough(r).pipeTo(e.writable)}));class RI extends Vt{constructor(e){super(),m(this,"isScreen",!1),m(this,"audioMid",void 0),m(this,"videoMid",void 0),m(this,"audioMLine",void 0),m(this,"videoMLine",void 0),m(this,"videoTransceiver",void 0),m(this,"audioTransceiver",void 0),m(this,"vendorHandler",void 0),m(this,"vendorCode",0),m(this,"engineId",void 0),m(this,"logger",void 0),m(this,"__seiHelper",Rn),m(this,"logName","StreamBase"),m(this,"isPublicStream",!1),this._ctx=e,this.engineId=e.id,this.logger=new ue(this.constructor.name,2,e.id)}stopReport(e){this.statsReport.stopReport(e)}destroy(){var e,i;delete this.audioMid,delete this.videoMid,this.statsReport.destroy(),(e=this.observer)===null||e===void 0||e.reset(),delete this.videoTransceiver,delete this.audioTransceiver,(i=this.vendorHandler)===null||i===void 0||i.destroy(),this.vendorCode=0,delete this.vendorHandler}}var Yt=(t=>(t[t.INIT=0]="INIT",t[t.SUB_ING=1]="SUB_ING",t[t.SUB_ED=2]="SUB_ED",t))(Yt||{});class un extends RI{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ln.STREAM_INDEX_MAIN;super(e),m(this,"id",void 0),m(this,"stream",void 0),m(this,"streamId",void 0),m(this,"videoTrack",void 0),m(this,"audioTrack",void 0),m(this,"subVideoDescriptions",[]),m(this,"observer",void 0),m(this,"statsReport",void 0),m(this,"pubAudio",!1),m(this,"pubVideo",!1),m(this,"blackFrameRenderInterval",void 0),m(this,"blackFrameLifetimeInterval",void 0),m(this,"pubAttributes",void 0),m(this,"pcSessionId",void 0),m(this,"maxSeiCount",1),m(this,"preReports",{audio:{},video:{}}),m(this,"remoteSdp",void 0),m(this,"_currentVideoCodec",void 0),m(this,"_changeCodecs",[]),m(this,"_videoCaps",[]),m(this,"_sendSEIHandler",void 0),m(this,"_trackMatchingTimer",void 0),m(this,"logName","LocalStream"),this.stream=new MediaStream,this.id=Wt(),this.pubAttributes={localaudio:!1,localvideo:!1,videostream:!1,audiostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[],videoType:Lt.NORMAL},this.isScreen=i===ln.STREAM_INDEX_SCREEN,this.statsReport=new cO(e,this),this.statsReport.on("stats-exception",(o=>this.emit("stats-exception",o)));const s=ae("SEI_COUNT_FPS");typeof s=="number"&&s<=10&&(this.maxSeiCount=s),this._trackMatchingTimer=setInterval(this._checkTrackMatching.bind(this),5e3)}get enableSimulcast(){return!this.isScreen&&this._ctx.videoProfile.getSimulcastMode()}get videoEncodeConfig(){return this.isScreen?[this._ctx.videoProfile.getScreenEncodeConfig()]:this._ctx.videoProfile.getVideoEncodeConfig()}get audioHasCapture(){return this.pubAttributes.localaudio}get audioHasPublish(){return this.pubAttributes.audiostream}get videoHasCapture(){return this.pubAttributes.localvideo}get videoHasPublish(){return this.pubAttributes.videostream}get isEmptyStream(){return!this.audioTrack&&!this.videoTrack}get initStreamId(){return this.stream.id}get currentVideoCodec(){return this._currentVideoCodec}set currentVideoCodec(e){var i;this._currentVideoCodec=e,e!==void 0&&((i=this._sendSEIHandler)===null||i===void 0||i.setCodec(e))}async getSelectedCodec(){var e;const i=this._changeCodecs.length>0?this._changeCodecs:this._videoCaps.length>0?this._videoCaps:await Ca(),s=this._ctx.videoProfile.getPreferCodec(this.isScreen),o=this.isScreen?this._ctx.getTargetScreenCodec():this._ctx.getTargetCodec();if(this.logger.info("getSelectedCodec","availableCodecs=".concat(i,", preferCodec=").concat(s,", targetCodec=").concat(o)),s&&s!==Tr.AUTO){if(s===Tr.H264&&i.includes(Xe.H264))return Xe.H264;if(s===Tr.VP8&&i.includes(Xe.VP8))return Xe.VP8;if(s===Tr.H265&&i.includes(Xe.H265))return Xe.H265}if((e=this._ctx.serverConfig)!==null&&e!==void 0&&e.videoCodec&&i.includes(this._ctx.serverConfig.videoCodec))return this._ctx.serverConfig.videoCodec;if(s===Tr.AUTO&&i.length>0)return i[0];if(o&&i.includes(o))return o;if(i.includes(Xe.H265))return Xe.H265;if(i.includes(Xe.H264))return Xe.H264;if(i.includes(Xe.VP8))return Xe.VP8;throw new Error("no available codec")}startReport(e,i){this.statsReport.setLocalStreamStatsEvtInterval(e,i)}getLocalStreamStats(){return this.statsReport.getLocalStats()}initVideoEncodedTransform(){if(ae("DISABLE_ENCODED_TRANSFORM"))return void this.logger.warn("initVideoEncodedTransform","DISABLE_ENCODED_TRANSFORM");if(!this.videoTransceiver||!this.videoTransceiver.sender)return void this.logger.warn("initVideoEncodedTransform","no sender found when trying to bind encodedTransform");const{sender:e}=this.videoTransceiver;if(this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add&&cs()){const{readable:s,writable:o}=e.createEncodedStreams();if(window.__createDecodeError__)s.pipeThrough(new TransformStream({transform:(r,n)=>{const a=r.data,c=new DataView(a,16);c.setInt16(4,10),c.setInt16(11,20),n.enqueue(r)}})).pipeTo(o);else{const r=new II({maxSEICount:this.maxSeiCount,payloadMap:lo.videoPayloadMap}),n=new TransformStream({transform:r.sendSEITransform.bind(r)});s.pipeThrough(n).pipeTo(o),this._sendSEIHandler=r}}else if(Qo()){const s=new h3;this.videoTransceiver.sender.transform=new RTCRtpScriptTransform(s,{maxSEICount:this.maxSeiCount,payloadMap:lo.videoPayloadMap}),this._sendSEIHandler={pushSEI:o=>{s.postMessage({type:"push",content:o},[o.content.buffer])},revokeSEI:async o=>(s.postMessage({type:"revoke",content:o}),new Promise((r=>{s.addEventListener("message",(n=>{let{data:a}=n;const{type:c,content:d}=a,{uuid:l,isNotSend:u}=d;c==="revoke-ack"&&l===o&&r(u)}))}))),setCodec:o=>{s.postMessage({type:"setCodec",content:o})}}}var i;this.currentVideoCodec!==void 0&&((i=this._sendSEIHandler)===null||i===void 0||i.setCodec(this.currentVideoCodec))}initAudioEncodedTransform(){if(ae("DISABLE_ENCODED_TRANSFORM"))return void this.logger.warn("initAudioEncodedTransform","DISABLE_ENCODED_TRANSFORM");if(!this.audioTransceiver||!this.audioTransceiver.sender)return void this.logger.warn("initAudioEncodedTransform","no sender found when trying to bind encodedTransform");if(!this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add)return void this.logger.warn("initAudioEncodedTransform","legacy EncodedTransform is not supported");if(!cs())return void this.logger.warn("initAudioEncodedTransform","legacy EncodedTransform is not supported");const{sender:e}=this.audioTransceiver,{readable:i,writable:s}=e.createEncodedStreams();i.pipeThrough(new TransformStream({transform:(o,r)=>{r.enqueue(o)}})).pipeTo(s)}clean(){ye(this.engineId,"localstream_clean","".concat(new Error().stack),0,this.streamId||""),super.destroy(),this.subVideoDescriptions=[],clearTimeout(this.blackFrameLifetimeInterval),clearInterval(this.blackFrameRenderInterval)}switchTrackEnableState(e,i){var s;let o;e==="audio"?o=this.audioTrack:e==="video"&&(o=this.videoTrack);const r=(s=o)===null||s===void 0?void 0:s.mediaTrack;return!(!r||r?.enabled===i)&&(r.enabled=i,!0)}resetStream(){this.stream=new MediaStream}genBlackFrame(e){var i,s;this.logger.info("genBlackFrame()");const o=e===Xe.H265?200:16,r=(i=this.videoEncodeConfig[0])!==null&&i!==void 0&&i.frameRate?Ze((s=this.videoEncodeConfig[0])===null||s===void 0?void 0:s.frameRate):15,n=Math.ceil(1e3/r),a=document.createElement("canvas"),c=a.getContext("2d");a.width=o,a.height=o;const d=l=>{l.fillRect(0,0,o,o)};return c&&(c.fillStyle="#000",d(c),this.blackFrameRenderInterval=window.setInterval((()=>{d(c)}),n),this.refreshBlackFrameLifetime()),a.captureStream(r).getVideoTracks()[0]}stopBlackFrame(){this.logger.info("stopBlackFrame()"),clearTimeout(this.blackFrameLifetimeInterval),clearInterval(this.blackFrameRenderInterval),delete this.blackFrameRenderInterval}refreshBlackFrameLifetime(){this.logger.info("refreshBlackFrameLifetime()"),this.blackFrameRenderInterval&&(clearTimeout(this.blackFrameLifetimeInterval),this.blackFrameLifetimeInterval=setTimeout((()=>{clearInterval(this.blackFrameRenderInterval),delete this.blackFrameRenderInterval,this.emit("black-frame-ended")}),de.BLACK_FRAME_LIFETIME))}setChangeCodecs(e){this._changeCodecs=e}setVideoCaps(e){if(!e)return;const i=mZ(e);this._videoCaps=i}sendSEIMessage(e){var i;this.logger.info("sendSEIMessage"),(i=this._sendSEIHandler)===null||i===void 0||i.pushSEI(e)}async revokeSEIMessage(e){var i;return this.logger.info("revokeSEIMessage"),this._sendSEIHandler?(i=this._sendSEIHandler)===null||i===void 0?void 0:i.revokeSEI(e):(this.logger.warn("revokeSEIMessage","no sei handler found"),!1)}destroy(){clearInterval(this._trackMatchingTimer),super.removeAllListeners(),super.destroy()}_checkTrackMatching(){var e,i,s,o;const r=(e=this.audioTrack)===null||e===void 0?void 0:e.preprocessingTrack.id,n=(i=this.videoTrack)===null||i===void 0?void 0:i.preprocessingTrack.id,a=(s=this.audioTransceiver)===null||s===void 0||(s=s.sender.track)===null||s===void 0?void 0:s.id,c=(o=this.videoTransceiver)===null||o===void 0||(o=o.sender.track)===null||o===void 0?void 0:o.id;var d,l;this.pubAudio&&r!==a&&(this.logger.error("_checkTrackMatching","audio track id: ".concat(r," not matching transceiver track id ").concat(a,", streamId: ").concat(this.streamId)),(d=this._ctx.monitor)===null||d===void 0||d.report("rtc_error",{message:"audio track id: ".concat(r," not matching transceiver track id ").concat(a),error_code:-1,stream_id:this.streamId})),this.pubVideo&&n!==c&&(this.logger.error("_checkTrackMatching","video track id: ".concat(n," not matching transceiver track id ").concat(c,", streamId: ").concat(this.streamId)),(l=this._ctx.monitor)===null||l===void 0||l.report("rtc_error",{message:"video track id: ".concat(n," not matching transceiver track id ").concat(c),error_code:-1,stream_id:this.streamId}))}}class Lc extends RI{constructor(e,i,s,o,r,n){super(e),m(this,"streamId",void 0),m(this,"userId",void 0),m(this,"isPublic",void 0),m(this,"hasVideo",void 0),m(this,"hasAudio",void 0),m(this,"_attributes",void 0),m(this,"streamState",void 0),m(this,"removeTrack",!1),m(this,"observer",void 0),m(this,"statsReport",void 0),m(this,"subVideo",void 0),m(this,"subAudio",void 0),m(this,"subMediaType",void 0),m(this,"subLayer",void 0),m(this,"_sequenceId",void 0),m(this,"stream",void 0),m(this,"videoTrack",void 0),m(this,"audioTrack",void 0),m(this,"recordedVideoFrames",void 0),m(this,"stillExist",void 0),m(this,"originalMediaType",void 0),m(this,"priority",void 0),m(this,"remoteSessionId",""),m(this,"originalStreamIndex",0),m(this,"virtual",void 0),m(this,"pcSessionId",void 0),m(this,"_virtualOccupy",void 0),m(this,"_videoStallObserver",void 0),m(this,"_audioStallObserver",void 0),m(this,"preReports",{audio:{},video:{}}),m(this,"_installInfo",void 0),m(this,"_receiveSEIHandler",void 0),m(this,"_seiWorkerHandler",void 0),this.virtual=!1,this._virtualOccupy=!1,this.userId=i,this.isScreen=o,this.isPublic=r,this.streamId=s,this.logName="RemoteStream-".concat(s),this.hasAudio=n.audiostream&&n.localaudio,this.hasVideo=n.videostream&&n.localvideo,this._attributes=n,this.vendorCode=n?.vendorCode||0,this.subVideo=!1,this.subAudio=!1,this._sequenceId=0,this.subMediaType=ti.NONE,this.subLayer={spatialLayer:0,spatialSubLayer:-1},this.streamState=0,this.statsReport=new lO(e,this),this.statsReport.on("stats-exception",(a=>this.emit("stats-exception",a))),this.enableVendorMode&&(this.pcSessionId=Wt())}get vendor(){return this._attributes.vendorCode}get audioHasCapture(){return this._attributes.localaudio}get audioHasPublish(){return this._attributes.audiostream}get videoHasCapture(){return this._attributes.localvideo}get videoHasPublish(){return this._attributes.videostream}get sequenceId(){return this._sequenceId||-1}set sequenceId(e){typeof e=="number"&&(this._sequenceId=e)}get enableVendorMode(){return typeof this.attributes.vendorCode=="number"&&this.attributes.vendorCode!==0}get hasSubscribed(){return this.streamState===2}get attributes(){return this._attributes}set attributes(e){this.hasVideo=e.localvideo&&e.videostream,this.hasAudio=e.localaudio&&e.audiostream,this._attributes=e,this.vendorCode=e.vendorCode||0}get virtualOccupy(){return this._virtualOccupy}set virtualOccupy(e){var i;if(this._virtualOccupy&&!e)(i=this.observer)===null||i===void 0||i.setPushTrack(!1);else if(!this._virtualOccupy&&e){var s;(s=this.observer)===null||s===void 0||s.setPushTrack(!0)}this._virtualOccupy=e}startReport(e,i){this.statsReport.setRemoteStreamStatsEvtInterval(e,i)}getRemoteStreamStats(){return this.statsReport.getRemoteStreamStats()}initVideoEncodedTransform(){if(ae("DISABLE_ENCODED_TRANSFORM"))this.logger.warn("initVideoEncodedTransform","DISABLE_ENCODED_TRANSFORM");else if(this.videoTransceiver&&this.videoTransceiver.receiver){if(this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add&&cs()){var e;(e=this._ctx.monitor)===null||e===void 0||e.report("rtc_invoke_status",{sdk_api_name:"initVideoEncodedTransform",message:"using legacy EncodedTransform",error_code:0,stream_id:this.streamId,elapse:0});const{receiver:s}=this.videoTransceiver,{readable:o,writable:r}=s.createEncodedStreams(),n=new TI({postMessage:c=>{this.safeEmit("onSEIMessage",c.payload)},skipFilter:!!ae("SKIP_SEI_FILTER"),payloadMap:lo.videoPayloadMap}),a=new TransformStream({transform:n.transform.bind(n)});o.pipeThrough(a).pipeTo(r),this._receiveSEIHandler=n}else if(Qo()){var i;(i=this._ctx.monitor)===null||i===void 0||i.report("rtc_invoke_status",{sdk_api_name:"initVideoEncodedTransform",message:"using standard EncodedTransform",error_code:0,stream_id:this.streamId,elapse:0});const s=this._ctx.receiveSEIWorker;this.videoTransceiver.receiver.transform=new RTCRtpScriptTransform(s,{streamId:this.streamId,skipFilter:!!ae("SKIP_SEI_FILTER"),payloadMap:lo.videoPayloadMap}),this._receiveSEIHandler={setCodec:o=>{s.postMessage({type:"setCodec",streamId:this.streamId,content:o})}},this._seiWorkerHandler=o=>{o.data.streamId===this.streamId&&this.safeEmit("onSEIMessage",o.data.msg.payload)},s.addEventListener("message",this._seiWorkerHandler)}}else this.logger.warn("no receiver found when trying to bind encodedTransform")}initAudioEncodedTransform(){if(ae("DISABLE_ENCODED_TRANSFORM"))return void this.logger.warn("initVideoEncodedTransform","DISABLE_ENCODED_TRANSFORM");if(!this.audioTransceiver||!this.audioTransceiver.receiver)return void this.logger.warn("no receiver found when trying to bind encodedTransform");if(!this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add)return void this.logger.warn("legacy EncodedTransform is not supported");if(!cs())return void this.logger.warn("legacy EncodedTransform is not supported");const{receiver:e}=this.audioTransceiver,{readable:i,writable:s}=e.createEncodedStreams();i.pipeThrough(new TransformStream({transform:(o,r)=>{o.data.byteLength<=1e3?r.enqueue(o):this.logger.print("too large audio frame",o.data.byteLength)}})).pipeTo(s)}ontrack(e){var i;try{ye(this.engineId,"Stream.ontrack",JSON.stringify({uid:this.userId,streamId:this.streamId,streams:e.streams.reduce(((o,r)=>o+xg(r)),""),transceiver:Kg(e.transceiver),track:Zi(e.track)}),0,this.streamId||"")}catch{}if(this.enableVendorMode||(i=e.streams)!==null&&i!==void 0&&(i=i[0])!==null&&i!==void 0&&(i=i.id)!==null&&i!==void 0&&i.includes(this.streamId)){var s;const{track:o}=e;o?.kind==="video"?this._setVideoTrack(o):((s=e.track)===null||s===void 0?void 0:s.kind)==="audio"&&this._setAudioTrack(o),this._setStream(e.streams[0])}this.safeEmit("ontrack",e)}startVideoStallObserve(e){this.logger.info("startVideoStallObserve","invoke",e.playerId),this._videoStallObserver||(this._videoStallObserver=new kD(this.isScreen,this.engineId)),this._videoStallObserver.start(e)}stopVideoStallObserve(){var e;this.logger.info("stopVideoStallObserve","invoke"),(e=this._videoStallObserver)===null||e===void 0||e.stop()}updateVideoStallInfo(e,i,s){let o;var r;if(s?(o=(r=this._videoStallObserver)===null||r===void 0?void 0:r.getStallInfo({interval:e.stats_interval||0,bitrate:e.bitrate,frameRateDecoded:e.frame_rate_decoded,frameRateReceived:e.frame_rate_received}),this._installInfo=o):o=this._installInfo,o){const a=Math.min(o.report.stallDuration,e.stats_interval||0);if(e.play_time=o.pts,e.stall_count=o.report.stallCount,e.is_screen?e.stuck_length=a:e.stall_duration=a,e.pause_duration=Math.min(a,o.pauseDuration),i.stallCount=o.callback.stallCount,i.stallDuration=o.callback.stallDuration,o.stall100ms){const c=Math.min(o.stall100ms.duration,e.stats_interval||0);e.stall_duration_100ms=c,e.stall_count_100ms=o.stall100ms.count,i.stallDuration100MS=c,i.stallCount100MS=o.stall100ms.count}var n;(o.report.stallCount!==0||o.report.stallDuration!==0)&&this.logger.print("video_stall_report",this.userId,(n=this.videoTrack)===null||n===void 0?void 0:n.observingPlayerId,JSON.stringify(o.report),s)}}getVideoRenderInfo(){var e;return((e=this._videoStallObserver)===null||e===void 0?void 0:e.getRecentRenderInfo4Report())||{}}stopAudioStallObserve(){var e;this.logger.info("stopAudioStallObserve","invoke"),(e=this._audioStallObserver)===null||e===void 0||e.stop()}async updateAudioStallInfo(e,i,s){if(this._audioStallObserver){const o=await this._audioStallObserver.getAudioStallInfo();return e.concealedSamples===e.interval_concealed_samples&&e.totalSamplesReceived===e.interval_samples_received?(e.stall_count=0,e.stall_duration=0,i.stallCount=0,i.stallDuration=0):(e.stall_count=o.report.stall_count,e.stall_duration=o.report.stall_duration,i.stallCount=o.callback.stall_count,i.stallDuration=o.callback.stall_duration),o.report.stall_count===0&&o.report.stall_duration===0||this.logger.print("audio_stall_report",this.userId,JSON.stringify(I(I({},o.report),{},{callbackList:o.callback.list}))),o.extra}this._audioStallObserver=new Rt(this),this._audioStallObserver.start(s.concealedSamples,s.totalSamplesReceived),this.logger.print("startAduioObserver","start")}resetStream(){var e,i;(e=this.audioTransceiver)===null||e===void 0||e.stop(),(i=this.videoTransceiver)===null||i===void 0||i.stop(),this.audioTransceiver=void 0,this.videoTransceiver=void 0}clean(){var e,i;this.logger.info("clean","exec stream.clean ".concat(this.streamId," ").concat(this.userId)),ye(this.engineId,"remotestream_clean","".concat(new Error().stack),0,this.streamId),super.destroy(),this.subAudio=!1,this.subVideo=!1,this.sequenceId=0,(e=this.videoTrack)===null||e===void 0||e.destroy(),this.videoTrack=void 0,(i=this.audioTrack)===null||i===void 0||i.destroy(),this.audioTrack=void 0,this.stream=void 0,this.recordedVideoFrames=void 0,delete this.priority,this._seiWorkerHandler&&this._ctx.receiveSEIWorker.removeEventListener("message",this._seiWorkerHandler)}destroy(){var e,i;this.clean(),(e=this._audioStallObserver)===null||e===void 0||e.destroy(),delete this._audioStallObserver,(i=this._videoStallObserver)===null||i===void 0||i.destroy(),delete this._videoStallObserver,this.attributes={audiostream:!1,localaudio:!1,localvideo:!1,videostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]},super.removeAllListeners()}resetHasSubscribed(){this.streamState=0}_setStream(e){this.stream=e,e.onaddtrack=i=>{i.track.kind==="video"?this._setVideoTrack(i.track):i.track.kind==="audio"&&this._setAudioTrack(i.track)}}_setAudioTrack(e){var i;if(((i=this.audioTrack)===null||i===void 0||(i=i.preprocessingTrack)===null||i===void 0?void 0:i.id)!==e.id){this.audioTrack=fI(this._ctx,e,{streamIndex:this.isPublic?He.PUBLIC:this.virtual?He.VIRTUAL:this.isScreen?He.SCREEN:He.MAIN,streamUserId:this.userId});const o=this._ctx._remoteAudioTrackDumpConfig[this.isScreen?ln.STREAM_INDEX_SCREEN:ln.STREAM_INDEX_MAIN].get(this.userId);var s;o!=null&&o.callback&&o!=null&&o.frameSize&&((s=this.audioTrack)===null||s===void 0||s.setDataFetcher(o.frameSize,(r=>{var n;this.audioHasCapture&&this.audioHasPublish&&((n=o.callback)===null||n===void 0||n.call(o,r))}))),this.emit("ontrack",this.audioTrack)}}_setVideoTrack(e){var i;((i=this.videoTrack)===null||i===void 0||(i=i.preprocessingTrack)===null||i===void 0?void 0:i.id)!==e.id&&(this.videoTrack=d3(this._ctx,e,this,{streamIndex:this.isPublic?He.PUBLIC:this.virtual?He.VIRTUAL:this.isScreen?He.SCREEN:He.MAIN,streamUserId:this.userId}),this.emit("ontrack",this.videoTrack))}}var A=(t=>(t.RESUBSCRIBE="resubscribe",t.STREAM_FAILED="stream_failed",t.SUBSCRIBE_PUSH_TRACK="subscribe_push_track",t.REMOVE_PUSH_TRACK="remove_push_track",t.VIDEO_FIRST_FRAME="video_first_frame",t.ON_USER_PUBLISH_STATE_CHANGE="on_user_publish_state_change",t.ON_USER_START_AUDIO_CAPTURE="on_user_start_audio_capture",t.ON_USER_STOP_AUDIO_CAPTURE="on_user_stop_audio_capture",t.ON_USER_START_VIDEO_CAPTURE="on_user_start_video_capture",t.ON_USER_STOP_VIDEO_CAPTURE="on_user_stop_video_capture",t.ON_SEI_MESSAGED_RECEIVED="on_sei_messaged_received",t.ON_PUBLISH_RESULT="on_publish_result",t.ON_SUBSCRIBE_RESULT="ON_SUBSCRIBE_RESULT",t.ON_UPDATE_TOKEN_SUCCESS="on_update_token_success",t.ON_REMOTE_STREAM_STATS="ON_REMOTE_STREAM_STATS",t.ON_LOCAL_STREAM_STATS="ON_LOCAL_STREAM_STATS",t.ON_USER_LEAVE="on_user_leave",t.ON_ROOM_ERROR="on_room_error",t.ON_NETWORK_QUALITY="on_network_quality",t.ON_SIMULCAST_SUBSCRIBE_FALLBACK="on_simulcast_subscribe_fallback",t.ON_REMOTE_VIDEO_SIZE_CHANGED="on_remote_video_size_changed",t.ON_SUBTITLE_STATE_CHANGED="ON_SUBTITLE_STATE_CHANGED",t.ON_SUBTITLE_MESSAGE_RECEIVED="ON_SUBTITLE_MESSAGE_RECEIVED",t.ON_VIDEO_STREAM_BANNED="ON_VIDEO_STREAM_BANNED",t.ON_AUDIO_STREAM_BANNED="ON_AUDIO_STREAM_BANNED",t.ON_FORWARD_STREAM_ERROR="ON_FORWARD_STREAM_ERROR",t.ON_REJOIN_WITH_TCP="ON_REJOIN_WITH_TCP",t.PUB_RETRY="PUB_RETRY",t.SUB_RETRY="SUB_RETRY",t.VIDEO_TYPE_CHANGE="VIDEO_TYPE_CHANGE",t.JOIN_SUCCESS="JOIN_SUCCESS",t.UPDATE_PUBLISH="UPDATE_PUBLISH",t.ON_LOCAL_STATS_EXCEPTION="ON_LOCAL_STATS_EXCEPTION",t.ON_REMOTE_STATS_EXCEPTION="ON_REMOTE_STATS_EXCEPTION",t))(A||{}),pi=(t=>(t[t.START=1]="START",t[t.START_SUCCESS=2]="START_SUCCESS",t[t.START_FAILED=3]="START_FAILED",t[t.UPDATE=4]="UPDATE",t[t.UPDATE_SUCCESS=5]="UPDATE_SUCCESS",t[t.UPDATE_FAILED=6]="UPDATE_FAILED",t[t.STOP=7]="STOP",t[t.STOP_SUCCESS=8]="STOP_SUCCESS",t[t.STOP_FAILED=9]="STOP_FAILED",t))(pi||{}),Ot=(t=>(t[t.PUB=0]="PUB",t[t.UNPUB=1]="UNPUB",t))(Ot||{});const ev=async(t,e,i,s)=>{try{var o,r,n,a;let u="",p=-1;const h=e==="video"?i==null||(o=i.videoTrack)===null||o===void 0?void 0:o.originTrack:i==null||(r=i.audioTrack)===null||r===void 0?void 0:r.originTrack,_=e==="video"?i==null||(n=i.videoTransceiver)===null||n===void 0?void 0:n.receiver:i==null||(a=i.audioTransceiver)===null||a===void 0?void 0:a.receiver;try{var c,d;const y=await((c=t.peerConnection)===null||c===void 0?void 0:c.getStatsWithLowFrequency(h,!0,_)),b=(y||[]).find((g=>g.type==="inbound-rtp")),S=await _?.getStats(),v=[];let f;var l;S?.forEach((g=>v.push(g.type))),y?.length===0&&v.length!==0&&(f=await((l=t.peerConnection)===null||l===void 0?void 0:l.getStatsWithLowFrequency(void 0,void 0,_))),u=JSON.stringify({type:e,reports:y.map((g=>g.type)),reports2:v,pc:((d=t.peerConnection)===null||d===void 0?void 0:d.getOriginRTCPeerConnection())||null,track:h?.id||null,bytes:b?.bytesReceived,framesReceived:b?.framesReceived,packetsReceived:b?.packetsReceived,allReports:f})}catch(y){p=-999,u=y.mseeage||JSON.stringify(y)}s?.report("rtc_invoke_status",{sdk_api_name:"first_frame_recv_timeout",error_code:p,message:u,stream_id:i?.streamId||"",stream_user_id:i?.userId,elapse:0})}catch{}},tv=async(t,e,i,s)=>{try{var o,r,n,a;let u="",p=-1;const h=e==="video"?i==null||(o=i.videoTrack)===null||o===void 0?void 0:o.preprocessingTrack:i==null||(r=i.audioTrack)===null||r===void 0?void 0:r.preprocessingTrack,_=e==="video"?i==null||(n=i.videoTransceiver)===null||n===void 0?void 0:n.sender:i==null||(a=i.audioTransceiver)===null||a===void 0?void 0:a.sender;try{var c,d;const y=await((c=t.peerConnection)===null||c===void 0?void 0:c.getStatsWithLowFrequency(h,!0,_)),b=(y||[]).find((g=>g.type==="outbound-rtp")),S=await _?.getStats(),v=[];let f;var l;S?.forEach((g=>v.push(g.type))),y.length===0&&v.length!==0&&(f=await((l=t.peerConnection)===null||l===void 0?void 0:l.getStatsWithLowFrequency(void 0,void 0,_))),u=JSON.stringify({type:e,reports:y.map((g=>g.type)),reports2:v,pc:((d=t.peerConnection)===null||d===void 0?void 0:d.getOriginRTCPeerConnection())||null,track:h?.id||null,bytes:b?.bytesSent,framesSent:b?.framesSent,packetsSent:b?.packetsSent,allReports:f})}catch(y){p=-999,u=y.mseeage||JSON.stringify(y)}s?.report("rtc_invoke_status",{sdk_api_name:"first_frame_send_timeout",error_code:p,message:u,stream_id:i?.streamId||"",stream_user_id:i?.userId,elapse:0})}catch{}};class XI extends Ai.EventEmitter{constructor(e,i){super(),m(this,"_audioEventSessionId",La()),m(this,"_videoEventSessionId",La()),m(this,"_stream",void 0),m(this,"_firstAudioFrameTimer",void 0),m(this,"_firstVideoFrameTimer",void 0),m(this,"_transportDelayInterval",void 0),m(this,"_transportDelay",void 0),m(this,"_firstVideoFrameInterval",void 0),m(this,"_firstAudioFrameInterval",void 0),m(this,"_isScreen",!1),m(this,"_audioFirstFrameState",0),m(this,"_videoFirstFrameState",0),m(this,"_timeout",1e4),m(this,"_currentAudioRecv",{startTime:0,eventSessionId:0,type:"login"}),m(this,"_currentVideoRecv",{startTime:0,eventSessionId:0,type:"login"}),m(this,"_login",!1),m(this,"_unMuteAudio",!1),m(this,"_enableAudio",!1),m(this,"_unMuteVideo",!1),m(this,"_enableVideo",!1),m(this,"_remoteUnmuteAudio",!1),m(this,"_remoteUnmuteVideo",!1),m(this,"_audioExternal",!1),m(this,"_pushAudio",!1),m(this,"_videoExternal",!1),m(this,"_pushVideo",!1),m(this,"_autoSubscribeVideo",!1),m(this,"_autoSubscribeAudio",!1),m(this,"_autoSubscribe",!1),m(this,"_publishVideo",!1),m(this,"_publishAudio",!1),m(this,"_subscribeAudio",!1),m(this,"_subscribeVideo",!1),m(this,"_subscribe",!1),m(this,"_pushTrack",!1),m(this,"_multiChatMode",!1),m(this,"_monitor",void 0),m(this,"logger",void 0),this._ctx=e,this._stream=i,this.getTransportDelay(),this._monitor=ke(i.engineId),this.logger=new ue("RecvFrameObserver",0,i.engineId)}async beginRecvFrame(e,i){await this.getTransportDelay();let s=this._transportDelay,o=!0;if(["login","unmute","subscribe","push_track"].indexOf(i)>=0&&(s=0,o=!1),e==="audio"){var r,n,a,c,d,l,u,p,h;o||this._audioEventSessionId++,this._currentAudioRecv={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:i};const T={media_type:e,event_type:"begin_recv",type:i,is_screen:!((r=this._stream)===null||r===void 0||!r.isScreen),start:(n=this._currentAudioRecv)===null||n===void 0?void 0:n.startTime,event_session_id:this._audioEventSessionId,stream_user_id:(a=this._stream)===null||a===void 0?void 0:a.userId,transport_delay:s,vendor_mode:((c=this._stream)===null||c===void 0?void 0:c.vendorCode)||0,pc_session_id:((d=this._stream)===null||d===void 0?void 0:d.pcSessionId)||((l=this._ctx.peerConnection)===null||l===void 0?void 0:l.getConnectionId()),remote_rtc_session_id:(u=this._stream)===null||u===void 0?void 0:u.remoteSessionId,is_public_stream:(p=this._stream)===null||p===void 0?void 0:p.isPublicStream};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=setTimeout((()=>{ev(this._ctx,"audio",this._stream,this._monitor),this.stopRecvFrame("audio","timeout"),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval)}),this._timeout),this.logger.info("rtcFirstFrameRecv",JSON.stringify(T)),(h=this._monitor)===null||h===void 0||h.report("rtc_first_frame",T),this._watchForFirstAudioFrameRecv(),this._audioFirstFrameState=1,this._login=!0,this._unMuteAudio=!0,this._enableAudio=!0,this._remoteUnmuteAudio=!0}else if(e==="video"){var _,y,b,S,v,f,g,Z,R;o||this._videoEventSessionId++,this._currentVideoRecv={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:i};const T={media_type:e,event_type:"begin_recv",type:i,is_screen:!((_=this._stream)===null||_===void 0||!_.isScreen),start:(y=this._currentVideoRecv)===null||y===void 0?void 0:y.startTime,event_session_id:this._videoEventSessionId,stream_user_id:(b=this._stream)===null||b===void 0?void 0:b.userId,transport_delay:s,vendor_mode:((S=this._stream)===null||S===void 0?void 0:S.vendorCode)||0,pc_session_id:((v=this._stream)===null||v===void 0?void 0:v.pcSessionId)||((f=this._ctx.peerConnection)===null||f===void 0?void 0:f.getConnectionId()),remote_rtc_session_id:(g=this._stream)===null||g===void 0?void 0:g.remoteSessionId,is_public_stream:(Z=this._stream)===null||Z===void 0?void 0:Z.isPublicStream};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=setTimeout((()=>{ev(this._ctx,"video",this._stream,this._monitor),this.stopRecvFrame("video","timeout"),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameRecv(),this.logger.info("rtcFirstFrameRecv",JSON.stringify(T)),(R=this._monitor)===null||R===void 0||R.report("rtc_first_frame",T),this._videoFirstFrameState=1,this._login=!0,this._unMuteVideo=!0,this._enableVideo=!0,this._remoteUnmuteVideo=!0}}stopRecvFrame(e,i){if(e==="audio"){var s,o,r,n,a,c,d,l,u,p;if(this._audioFirstFrameState!==1)return;const $={event_type:"recv_end",media_type:e,is_screen:!((s=this._stream)===null||s===void 0||!s.isScreen),start:(o=this._currentAudioRecv)===null||o===void 0?void 0:o.startTime,reason:i,result:!1,stream_user_id:(r=this._stream)===null||r===void 0?void 0:r.userId,event_session_id:this._audioEventSessionId,type:(n=this._currentAudioRecv)===null||n===void 0?void 0:n.type,vendor_mode:((a=this._stream)===null||a===void 0?void 0:a.vendorCode)||0,pc_session_id:((c=this._stream)===null||c===void 0?void 0:c.pcSessionId)||((d=this._ctx.peerConnection)===null||d===void 0?void 0:d.getConnectionId()),remote_rtc_session_id:(l=this._stream)===null||l===void 0?void 0:l.remoteSessionId,is_public_stream:(u=this._stream)===null||u===void 0?void 0:u.isPublicStream};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioRecv,this.logger.info("rtcFirstFrameRecv",JSON.stringify($)),(p=this._monitor)===null||p===void 0||p.report("rtc_first_frame",$),this._audioFirstFrameState=2}else if(e==="video"){var h,_,y,b,S,v,f,g,Z,R,T,X,L,W,M,k,U,D,ie,B;if(this._videoFirstFrameState!==1)return;const $={event_type:"recv_end",media_type:e,is_screen:!((h=this._stream)===null||h===void 0||!h.isScreen),start:(_=this._currentVideoRecv)===null||_===void 0?void 0:_.startTime,reason:i,result:!1,stream_user_id:(y=this._stream)===null||y===void 0?void 0:y.userId,event_session_id:this._videoEventSessionId,type:(b=this._currentVideoRecv)===null||b===void 0?void 0:b.type,vendor_mode:((S=this._stream)===null||S===void 0?void 0:S.vendorCode)||0,pc_session_id:((v=this._stream)===null||v===void 0?void 0:v.pcSessionId)||((f=this._ctx.peerConnection)===null||f===void 0?void 0:f.getConnectionId()),remote_rtc_session_id:(g=this._stream)===null||g===void 0?void 0:g.remoteSessionId,codec:(Z=this._stream)===null||Z===void 0||(Z=Z.getRemoteStreamStats())===null||Z===void 0||(Z=Z.videoStats)===null||Z===void 0?void 0:Z.codecType,stats_frame_size_width:(R=this._stream)===null||R===void 0||(R=R.getRemoteStreamStats())===null||R===void 0||(R=R.videoStats)===null||R===void 0?void 0:R.frame_size_width,stats_frame_size_height:(T=this._stream)===null||T===void 0||(T=T.getRemoteStreamStats())===null||T===void 0||(T=T.videoStats)===null||T===void 0?void 0:T.frame_size_height,stats_frame_rate_decode:(X=this._stream)===null||X===void 0||(X=X.getRemoteStreamStats())===null||X===void 0||(X=X.videoStats)===null||X===void 0?void 0:X.decoderOutputFrameRate,stats_frame_rate_receive:(L=this._stream)===null||L===void 0||(L=L.getRemoteStreamStats())===null||L===void 0||(L=L.videoStats)===null||L===void 0?void 0:L.receivedFrameRate,stats_frame_decoder_name:(W=this._stream)===null||W===void 0||(W=W.getRemoteStreamStats())===null||W===void 0||(W=W.videoStats)===null||W===void 0?void 0:W.decoderName,stats_gpu_url:de.GPU_URL||((M=Yi())===null||M===void 0?void 0:M.renderer),track_frame_size_width:(k=this._stream)===null||k===void 0||(k=k.videoTrack)===null||k===void 0||(k=k.originTrack.getSettings())===null||k===void 0?void 0:k.width,track_frame_size_height:(U=this._stream)===null||U===void 0||(U=U.videoTrack)===null||U===void 0||(U=U.originTrack.getSettings())===null||U===void 0?void 0:U.height,track_frame_rate:(D=this._stream)===null||D===void 0||(D=D.videoTrack)===null||D===void 0||(D=D.originTrack.getSettings())===null||D===void 0?void 0:D.frameRate,is_public_stream:(ie=this._stream)===null||ie===void 0?void 0:ie.isPublicStream};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoRecv,this.logger.info("rtcFirstFrameRecv",JSON.stringify($)),(B=this._monitor)===null||B===void 0||B.report("rtc_first_frame",$),this._videoFirstFrameState=2,setTimeout((()=>{var te,N,K,x,E,q,ce,se,oe,ne,w,J,re,j,le,pe,ge,Ce,Qe,vt;const Gi={event_type:"recv_end",media_type:e,is_screen:!((te=this._stream)===null||te===void 0||!te.isScreen),start:(N=this._currentVideoRecv)===null||N===void 0?void 0:N.startTime,reason:i,result:!1,stream_user_id:(K=this._stream)===null||K===void 0?void 0:K.userId,event_session_id:this._videoEventSessionId,type:(x=this._currentVideoRecv)===null||x===void 0?void 0:x.type,vendor_mode:((E=this._stream)===null||E===void 0?void 0:E.vendorCode)||0,pc_session_id:((q=this._stream)===null||q===void 0?void 0:q.pcSessionId)||((ce=this._ctx.peerConnection)===null||ce===void 0?void 0:ce.getConnectionId()),remote_rtc_session_id:(se=this._stream)===null||se===void 0?void 0:se.remoteSessionId,codec:(oe=this._stream)===null||oe===void 0||(oe=oe.getRemoteStreamStats())===null||oe===void 0||(oe=oe.videoStats)===null||oe===void 0?void 0:oe.codecType,stats_frame_size_width:(ne=this._stream)===null||ne===void 0||(ne=ne.getRemoteStreamStats())===null||ne===void 0||(ne=ne.videoStats)===null||ne===void 0?void 0:ne.frame_size_width,stats_frame_size_height:(w=this._stream)===null||w===void 0||(w=w.getRemoteStreamStats())===null||w===void 0||(w=w.videoStats)===null||w===void 0?void 0:w.frame_size_height,stats_frame_rate_decode:(J=this._stream)===null||J===void 0||(J=J.getRemoteStreamStats())===null||J===void 0||(J=J.videoStats)===null||J===void 0?void 0:J.decoderOutputFrameRate,stats_frame_rate_receive:(re=this._stream)===null||re===void 0||(re=re.getRemoteStreamStats())===null||re===void 0||(re=re.videoStats)===null||re===void 0?void 0:re.receivedFrameRate,stats_frame_decoder_name:(j=this._stream)===null||j===void 0||(j=j.getRemoteStreamStats())===null||j===void 0||(j=j.videoStats)===null||j===void 0?void 0:j.decoderName,stats_gpu_url:de.GPU_URL||((le=Yi())===null||le===void 0?void 0:le.renderer),track_frame_size_width:(pe=this._stream)===null||pe===void 0||(pe=pe.videoTrack)===null||pe===void 0||(pe=pe.originTrack.getSettings())===null||pe===void 0?void 0:pe.width,track_frame_size_height:(ge=this._stream)===null||ge===void 0||(ge=ge.videoTrack)===null||ge===void 0||(ge=ge.originTrack.getSettings())===null||ge===void 0?void 0:ge.height,track_frame_rate:(Ce=this._stream)===null||Ce===void 0||(Ce=Ce.videoTrack)===null||Ce===void 0||(Ce=Ce.originTrack.getSettings())===null||Ce===void 0?void 0:Ce.frameRate,is_public_stream:(Qe=this._stream)===null||Qe===void 0?void 0:Qe.isPublicStream};this.logger.info("rtc_first_frame_statistics",JSON.stringify(Gi)),(vt=this._monitor)===null||vt===void 0||vt.report("rtc_first_frame_statistics",Gi)}),8e3)}}async recvFrameFinish(e){await this.getTransportDelay();let i=this._transportDelay;if(e==="audio"){var s,o,r,n,a,c,d,l;if(this._audioFirstFrameState!==1||!this._currentAudioRecv)return;const{type:U,startTime:D}=this._currentAudioRecv;["login","unmute","subscribe","push_track"].indexOf(U)>=0&&(i=0);const ie={event_type:"recv_end",media_type:e,start:D,result:!0,is_screen:!((s=this._stream)===null||s===void 0||!s.isScreen),stream_user_id:(o=this._stream)===null||o===void 0?void 0:o.userId,event_session_id:this._audioEventSessionId,type:U,transport_delay:i,vendor_mode:((r=this._stream)===null||r===void 0?void 0:r.vendorCode)||0,pc_session_id:((n=this._stream)===null||n===void 0?void 0:n.pcSessionId)||((a=this._ctx.peerConnection)===null||a===void 0?void 0:a.getConnectionId()),remote_rtc_session_id:(c=this._stream)===null||c===void 0?void 0:c.remoteSessionId,is_public_stream:(d=this._stream)===null||d===void 0?void 0:d.isPublicStream};delete this._currentAudioRecv,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameRecv",JSON.stringify(ie)),(l=this._monitor)===null||l===void 0||l.report("rtc_first_frame",ie),this.emit("recvAudioFirstFrame"),this._audioFirstFrameState=3}else if(e==="video"){var u,p,h,_,y,b,S,v,f,g,Z,R,T,X,L,W,M,k;if(this._videoFirstFrameState!==1||!this._currentVideoRecv)return;const{type:U,startTime:D}=this._currentVideoRecv;["login","unmute","subscribe","push_track"].indexOf(U)>=0&&(i=0);const ie={event_type:"recv_end",media_type:e,is_screen:!((u=this._stream)===null||u===void 0||!u.isScreen),start:D,result:!0,stream_user_id:(p=this._stream)===null||p===void 0?void 0:p.userId,event_session_id:this._videoEventSessionId,type:U,transport_delay:i,vendor_mode:((h=this._stream)===null||h===void 0?void 0:h.vendorCode)||0,pc_session_id:((_=this._stream)===null||_===void 0?void 0:_.pcSessionId)||((y=this._ctx.peerConnection)===null||y===void 0?void 0:y.getConnectionId()),remote_rtc_session_id:(b=this._stream)===null||b===void 0?void 0:b.remoteSessionId,codec:(S=this._stream)===null||S===void 0||(S=S.getRemoteStreamStats())===null||S===void 0||(S=S.videoStats)===null||S===void 0?void 0:S.codecType,stats_frame_size_width:(v=this._stream)===null||v===void 0||(v=v.getRemoteStreamStats())===null||v===void 0||(v=v.videoStats)===null||v===void 0?void 0:v.frameSizeWidth,stats_frame_size_height:(f=this._stream)===null||f===void 0||(f=f.getRemoteStreamStats())===null||f===void 0||(f=f.videoStats)===null||f===void 0?void 0:f.frameSizeHeight,stats_frame_rate_decode:(g=this._stream)===null||g===void 0||(g=g.getRemoteStreamStats())===null||g===void 0||(g=g.videoStats)===null||g===void 0?void 0:g.decoderOutputFrameRate,stats_frame_rate_receive:(Z=this._stream)===null||Z===void 0||(Z=Z.getRemoteStreamStats())===null||Z===void 0||(Z=Z.videoStats)===null||Z===void 0?void 0:Z.receivedFrameRate,stats_frame_decoder_name:(R=this._stream)===null||R===void 0||(R=R.getRemoteStreamStats())===null||R===void 0||(R=R.videoStats)===null||R===void 0?void 0:R.decoderName,stats_gpu_url:de.GPU_URL||((T=Yi())===null||T===void 0?void 0:T.renderer),track_frame_size_width:(X=this._stream)===null||X===void 0||(X=X.videoTrack)===null||X===void 0||(X=X.originTrack.getSettings())===null||X===void 0?void 0:X.width,track_frame_size_height:(L=this._stream)===null||L===void 0||(L=L.videoTrack)===null||L===void 0||(L=L.originTrack.getSettings())===null||L===void 0?void 0:L.height,track_frame_rate:(W=this._stream)===null||W===void 0||(W=W.videoTrack)===null||W===void 0||(W=W.originTrack.getSettings())===null||W===void 0?void 0:W.frameRate,is_public_stream:(M=this._stream)===null||M===void 0?void 0:M.isPublicStream};delete this._currentVideoRecv,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameRecv",JSON.stringify(ie)),(k=this._monitor)===null||k===void 0||k.report("rtc_first_frame",ie),this.emit("recvVideoFirstFrame"),this._videoFirstFrameState=3,setTimeout((()=>{var B,$,te,N,K,x,E,q,ce,se,oe,ne,w,J,re,j,le,pe;const ge={event_type:"recv_end",media_type:e,is_screen:!((B=this._stream)===null||B===void 0||!B.isScreen),start:D,result:!0,stream_user_id:($=this._stream)===null||$===void 0?void 0:$.userId,event_session_id:this._videoEventSessionId,type:U,transport_delay:i,vendor_mode:((te=this._stream)===null||te===void 0?void 0:te.vendorCode)||0,pc_session_id:((N=this._stream)===null||N===void 0?void 0:N.pcSessionId)||((K=this._ctx.peerConnection)===null||K===void 0?void 0:K.getConnectionId()),remote_rtc_session_id:(x=this._stream)===null||x===void 0?void 0:x.remoteSessionId,codec:(E=this._stream)===null||E===void 0||(E=E.getRemoteStreamStats())===null||E===void 0||(E=E.videoStats)===null||E===void 0?void 0:E.codecType,stats_frame_size_width:(q=this._stream)===null||q===void 0||(q=q.getRemoteStreamStats())===null||q===void 0||(q=q.videoStats)===null||q===void 0?void 0:q.frameSizeWidth,stats_frame_size_height:(ce=this._stream)===null||ce===void 0||(ce=ce.getRemoteStreamStats())===null||ce===void 0||(ce=ce.videoStats)===null||ce===void 0?void 0:ce.frameSizeHeight,stats_frame_rate_decode:(se=this._stream)===null||se===void 0||(se=se.getRemoteStreamStats())===null||se===void 0||(se=se.videoStats)===null||se===void 0?void 0:se.decoderOutputFrameRate,stats_frame_rate_receive:(oe=this._stream)===null||oe===void 0||(oe=oe.getRemoteStreamStats())===null||oe===void 0||(oe=oe.videoStats)===null||oe===void 0?void 0:oe.receivedFrameRate,stats_frame_decoder_name:(ne=this._stream)===null||ne===void 0||(ne=ne.getRemoteStreamStats())===null||ne===void 0||(ne=ne.videoStats)===null||ne===void 0?void 0:ne.decoderName,stats_gpu_url:de.GPU_URL||((w=Yi())===null||w===void 0?void 0:w.renderer),track_frame_size_width:(J=this._stream)===null||J===void 0||(J=J.videoTrack)===null||J===void 0||(J=J.originTrack.getSettings())===null||J===void 0?void 0:J.width,track_frame_size_height:(re=this._stream)===null||re===void 0||(re=re.videoTrack)===null||re===void 0||(re=re.originTrack.getSettings())===null||re===void 0?void 0:re.height,track_frame_rate:(j=this._stream)===null||j===void 0||(j=j.videoTrack)===null||j===void 0||(j=j.originTrack.getSettings())===null||j===void 0?void 0:j.frameRate,is_public_stream:(le=this._stream)===null||le===void 0?void 0:le.isPublicStream};this.logger.info("rtc_first_frame_statistics",JSON.stringify(ge)),(pe=this._monitor)===null||pe===void 0||pe.report("rtc_first_frame_statistics",ge)}),8e3)}}setLogin(e){var i,s,o,r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{audio:!0,video:!0};this._login!==e&&(this._login=e,e&&(i=this._stream)!==null&&i!==void 0&&i.hasAudio&&n.audio&&this.beginRecvFrame("audio","login"),e&&(s=this._stream)!==null&&s!==void 0&&s.hasVideo&&n.video&&this.beginRecvFrame("video","login"),!e&&(o=this._stream)!==null&&o!==void 0&&o.hasAudio&&this.stopRecvFrame("audio","leave_room"),!e&&(r=this._stream)!==null&&r!==void 0&&r.hasVideo&&this.stopRecvFrame("video","leave_room"))}setUnmuteAudio(e){var i,s,o;if(this._unMuteAudio===e)return;this._unMuteAudio=e;const r=!((i=this._stream)===null||i===void 0||!i.hasAudio);(s=this._stream)!==null&&s!==void 0&&s.audioHasCapture&&(o=this._stream)!==null&&o!==void 0&&o.audioHasPublish&&(this._unMuteAudio&&r?this.beginRecvFrame("audio","unmute"):r&&this.stopRecvFrame("audio","mute"))}setRemoteUnmuteAudio(e){this._remoteUnmuteAudio!==e&&(this._remoteUnmuteAudio=e,this._remoteUnmuteAudio?this.beginRecvFrame("audio","remote_unmute"):this.stopRecvFrame("audio","remote_mute"))}setEnableAudio(e){this._enableAudio!==e&&(this._enableAudio=e,this._enableAudio?this.beginRecvFrame("audio","enable"):this.stopRecvFrame("audio","disable"))}setUnmuteVideo(e){var i,s,o;if(this._unMuteVideo===e)return;this._unMuteVideo=e;const r=!((i=this._stream)===null||i===void 0||!i.hasVideo);(s=this._stream)!==null&&s!==void 0&&s.videoHasCapture&&(o=this._stream)!==null&&o!==void 0&&o.videoHasPublish&&(this._unMuteVideo&&r?this.beginRecvFrame("video","unmute"):r&&this.stopRecvFrame("video","mute"))}setRemoteUnmuteVideo(e){this._remoteUnmuteVideo!==e&&(this._remoteUnmuteVideo=e,this._remoteUnmuteVideo?this.beginRecvFrame("video","remote_unmute"):this.stopRecvFrame("video","remote_mute"))}setEnableVideo(e){this._enableVideo!==e&&(this._enableVideo=e,this._enableVideo?this.beginRecvFrame("video","enable"):this.stopRecvFrame("video","disable"))}setExternalAudioSource(e){this._audioExternal=e}setPushAudio(e){var i;this._audioExternal&&this._pushAudio!==e&&(this._pushAudio=e),this._pushAudio&&this.beginRecvFrame("audio","push"),!e&&(i=this._stream)!==null&&i!==void 0&&i.hasAudio&&this.stopRecvFrame("audio","stop_push")}setExternalVideoSource(e){this._videoExternal=e}setPushVideo(e){var i;this._videoExternal&&this._pushVideo!==e&&(this._pushVideo=e),this._pushVideo&&this.beginRecvFrame("video","push"),!e&&(i=this._stream)!==null&&i!==void 0&&i.hasVideo&&this.stopRecvFrame("video","stop_push")}setPublishVideo(e){var i;this._publishVideo!==e&&(this._publishVideo=e),this._publishVideo&&this.beginRecvFrame("video","publish"),!e&&(i=this._stream)!==null&&i!==void 0&&i.hasVideo&&this.stopRecvFrame("video","unpublish")}setPublishAudio(e){var i;this._publishAudio!==e&&(this._publishAudio=e),this._publishAudio&&this.beginRecvFrame("audio","publish"),!e&&(i=this._stream)!==null&&i!==void 0&&i.hasAudio&&this.stopRecvFrame("audio","unpublish")}setAutoSubscribe(e){this._autoSubscribe=e}setAutoSubscribeVideo(e){this._autoSubscribeVideo=e}setAutoSubscribeAudio(e){this._autoSubscribeAudio=e}setSubscribeAudio(e){var i,s;this._autoSubscribeAudio||this._subscribeAudio===e||(this._subscribe=e,e&&(s=this._stream)!==null&&s!==void 0&&s.hasAudio&&this.beginRecvFrame("audio","subscribe")),!e&&(i=this._stream)!==null&&i!==void 0&&i.hasAudio&&this.stopRecvFrame("audio","unsubscribe")}setSubscribeVideo(e){var i,s;this._autoSubscribeVideo||this._subscribeVideo===e||(this._subscribeVideo=e,e&&(s=this._stream)!==null&&s!==void 0&&s.hasVideo&&this.beginRecvFrame("video","subscribe")),!e&&(i=this._stream)!==null&&i!==void 0&&i.hasVideo&&this.stopRecvFrame("video","unsubscribe")}setPushTrack(e){var i;this._pushTrack!==e&&(this._pushTrack=e,e&&!this._isScreen&&this.beginRecvFrame("audio","push_track"),!e&&(i=this._stream)!==null&&i!==void 0&&i.hasAudio&&this.stopRecvFrame("audio","remove_track"))}setMultiChatMode(e){this._multiChatMode=e}setTimeout(e){this._timeout=e}_watchForFirstVideoFrameRecv(){let e=-1,i=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval((async()=>{var s,o,r;const n=(s=(o=this._stream)===null||o===void 0||(o=o.vendorHandler)===null||o===void 0?void 0:o.peer)!==null&&s!==void 0?s:this._ctx.peerConnection;if(n&&(r=this._stream)!==null&&r!==void 0&&(r=r.videoTrack)!==null&&r!==void 0&&r.preprocessingTrack){var a,c;const d=(a=this._stream.videoTransceiver)===null||a===void 0?void 0:a.receiver,l=(await n.getStatsWithLowFrequency((c=this._stream)===null||c===void 0||(c=c.videoTrack)===null||c===void 0?void 0:c.preprocessingTrack,!0,d)).find((u=>u.type==="inbound-rtp"));if(l&&(l.framesReceived>e||l.packetsReceived>i)){if(e===-1&&i===-1)return e=l.framesReceived,void(i=l.packetsReceived);this.recvFrameFinish("video"),window.clearInterval(this._firstVideoFrameInterval)}}}),200)}_watchForFirstAudioFrameRecv(){let e=-1,i=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval((async()=>{var s,o,r;const n=(s=(o=this._stream)===null||o===void 0||(o=o.vendorHandler)===null||o===void 0?void 0:o.peer)!==null&&s!==void 0?s:this._ctx.peerConnection;if(n&&(r=this._stream)!==null&&r!==void 0&&(r=r.audioTrack)!==null&&r!==void 0&&r.originTrack){var a;const c=(await n.getStatsWithLowFrequency((a=this._stream)===null||a===void 0||(a=a.audioTrack)===null||a===void 0?void 0:a.originTrack)).find((d=>d.type==="inbound-rtp"));if(c&&(c.totalSamplesReceived>e||c.packetsReceived>i)){if(e===-1&&i===-1)return e=c.totalSamplesReceived,void(i=c.packetsReceived);this.recvFrameFinish("audio"),window.clearInterval(this._firstAudioFrameInterval)}}}),200)}async getTransportDelay(){await this.getTransportDelayIntl(),window.clearInterval(this._transportDelayInterval),this._transportDelayInterval=window.setInterval((async()=>{await this.getTransportDelayIntl()}),2e3)}async getTransportDelayIntl(){const e=this._ctx.peerConnection;if(e){var i;const s=(i=this._stream)===null||i===void 0||(i=i.videoTransceiver)===null||i===void 0?void 0:i.receiver,o=await e.getStatsWithLowFrequency(void 0,!0,s),r=o.find((a=>a.type==="transport"&&a.dtlsState==="connected")),n=o.find((a=>a.type==="candidate-pair"&&a.state==="succeeded"&&a.id===r?.selectedCandidatePairId));n&&(this._transportDelay=Math.round(1e3*n.currentRoundTripTime/2))}}setDisconnect(){this.stopRecvFrame("audio","connection_lost"),this.stopRecvFrame("video","connection_lost"),this.reset()}reset(){this._currentAudioRecv={startTime:0,eventSessionId:0,type:"login"},this._currentVideoRecv={startTime:0,eventSessionId:0,type:"login"},this._login=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._remoteUnmuteAudio=!1,this._remoteUnmuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoSubscribeVideo=!1,this._autoSubscribeAudio=!1,this._autoSubscribe=!1,this._subscribeAudio=!1,this._subscribeVideo=!1,this._subscribe=!1,this._pushTrack=!1,this._multiChatMode=!1,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._transportDelayInterval&&window.clearInterval(this._transportDelayInterval)}get audioFirstFrameReceived(){return this._audioFirstFrameState===3}get FirstFrameReceived(){return this._audioFirstFrameState===3}}class Yh{constructor(e,i){m(this,"_audioEventSessionId",La()),m(this,"_videoEventSessionId",La()),m(this,"_pcSessionId",void 0),m(this,"_firstAudioFrameTimer",void 0),m(this,"_firstVideoFrameTimer",void 0),m(this,"_stream",void 0),m(this,"_firstVideoFrameInterval",void 0),m(this,"_firstAudioFrameInterval",void 0),m(this,"_currentAudioSend",{startTime:0,eventSessionId:0,type:"login"}),m(this,"_currentVideoSend",{startTime:0,eventSessionId:0,type:"login"}),m(this,"_login",!1),m(this,"_publisher",!1),m(this,"_unMuteAudio",!1),m(this,"_enableAudio",!1),m(this,"_unMuteVideo",!1),m(this,"_enableVideo",!1),m(this,"_audioExternal",!1),m(this,"_pushAudio",!1),m(this,"_videoExternal",!1),m(this,"_pushVideo",!1),m(this,"_autoPublish",!1),m(this,"_publish",!1),m(this,"_timeout",1e4),m(this,"_audioFirstFrameState",0),m(this,"_videoFirstFrameState",0),m(this,"_monitor",void 0),m(this,"logger",void 0),this._ctx=e,this._stream=i,this._monitor=ke(i.engineId),this.logger=new ue("SendFrameObserver",0,i.engineId)}beginSendFrame(e,i){if(e==="audio"){var s,o,r,n,a,c,d;this._audioEventSessionId++,this._currentAudioSend={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:i};const S={event_type:"begin_send",media_type:e,is_screen:!((s=this._stream)===null||s===void 0||!s.isScreen),type:i,start:this._currentAudioSend.startTime,event_session_id:this._audioEventSessionId,vendor_mode:((o=this._stream)===null||o===void 0?void 0:o.vendorCode)||0,pc_session_id:((r=this._stream)===null||r===void 0?void 0:r.pcSessionId)||((n=this._ctx.peerConnection)===null||n===void 0?void 0:n.getConnectionId()),capture_session_id:(a=this._stream)===null||a===void 0||(a=a.audioTrack)===null||a===void 0?void 0:a.captureSessionId,is_public_stream:(c=this._stream)===null||c===void 0?void 0:c.isPublicStream};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=setTimeout((()=>{tv(this._ctx,"audio",this._stream,this._monitor),this.stopSendFrame("audio","timeout"),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval)}),this._timeout),this.logger.info("rtcFirstFrameSend",JSON.stringify(S)),(d=this._monitor)===null||d===void 0||d.report("rtc_first_frame",S),this._watchForFirstAudioFrameSend(),this._audioFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteAudio=!0,this._pushAudio||(this._enableAudio=!0)}else if(e==="video"){var l,u,p,h,_,y,b;this._videoEventSessionId++,this._currentVideoSend={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:i};const S={event_type:"begin_send",media_type:e,is_screen:!((l=this._stream)===null||l===void 0||!l.isScreen),type:i,start:this._currentVideoSend.startTime,event_session_id:this._videoEventSessionId,vendor_mode:((u=this._stream)===null||u===void 0?void 0:u.vendorCode)||0,pc_session_id:((p=this._stream)===null||p===void 0?void 0:p.pcSessionId)||((h=this._ctx.peerConnection)===null||h===void 0?void 0:h.getConnectionId()),capture_session_id:(_=this._stream)===null||_===void 0||(_=_.videoTrack)===null||_===void 0?void 0:_.captureSessionId,is_public_stream:(y=this._stream)===null||y===void 0?void 0:y.isPublicStream};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=setTimeout((()=>{tv(this._ctx,"video",this._stream,this._monitor),this.stopSendFrame("video","timeout"),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameSend(),this.logger.info("rtcFirstFrameSend",JSON.stringify(S)),(b=this._monitor)===null||b===void 0||b.report("rtc_first_frame",S),this._videoFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteVideo=!0,this._pushVideo||(this._enableVideo=!0)}}stopSendFrame(e,i){if(e==="audio"){var s,o,r,n,a,c,d,l,u;if(this._audioFirstFrameState!==1)return;const B={event_type:"sent_end",media_type:e,is_screen:!((s=this._stream)===null||s===void 0||!s.isScreen),start:(o=this._currentAudioSend)===null||o===void 0?void 0:o.startTime,reason:i,result:!1,event_session_id:this._audioEventSessionId,type:(r=this._currentAudioSend)===null||r===void 0?void 0:r.type,vendor_mode:((n=this._stream)===null||n===void 0?void 0:n.vendorCode)||0,pc_session_id:((a=this._stream)===null||a===void 0?void 0:a.pcSessionId)||((c=this._ctx.peerConnection)===null||c===void 0?void 0:c.getConnectionId()),capture_session_id:(d=this._stream)===null||d===void 0||(d=d.audioTrack)===null||d===void 0?void 0:d.captureSessionId,is_public_stream:(l=this._stream)===null||l===void 0?void 0:l.isPublicStream};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioSend,this.logger.info("rtcFirstFrameSend",JSON.stringify(B)),(u=this._monitor)===null||u===void 0||u.report("rtc_first_frame",B),this._audioFirstFrameState=2}else if(e==="video"){var p,h,_,y,b,S,v,f,g,Z,R,T,X,L,W,M,k,U,D,ie;if(this._videoFirstFrameState!==1)return;const B={event_type:"sent_end",media_type:e,start:(p=this._currentVideoSend)===null||p===void 0?void 0:p.startTime,is_screen:!((h=this._stream)===null||h===void 0||!h.isScreen),reason:i,result:!1,event_session_id:this._videoEventSessionId,type:(_=this._currentVideoSend)===null||_===void 0?void 0:_.type,vendor_mode:((y=this._stream)===null||y===void 0?void 0:y.vendorCode)||0,pc_session_id:((b=this._stream)===null||b===void 0?void 0:b.pcSessionId)||((S=this._ctx.peerConnection)===null||S===void 0?void 0:S.getConnectionId()),capture_session_id:(v=this._stream)===null||v===void 0||(v=v.videoTrack)===null||v===void 0?void 0:v.captureSessionId,codec:(f=this._stream)===null||f===void 0?void 0:f.currentVideoCodec,track_frame_size_width:(g=this._stream)===null||g===void 0||(g=g.videoTrack)===null||g===void 0||(g=g.originTrack)===null||g===void 0?void 0:g.getSettings().width,track_frame_size_height:(Z=this._stream)===null||Z===void 0||(Z=Z.videoTrack)===null||Z===void 0||(Z=Z.originTrack)===null||Z===void 0?void 0:Z.getSettings().height,track_frame_rate:(R=this._stream)===null||R===void 0||(R=R.videoTrack)===null||R===void 0||(R=R.originTrack)===null||R===void 0?void 0:R.getSettings().frameRate,stats_frame_size_width:(T=this._stream)===null||T===void 0||(T=T.getLocalStreamStats())===null||T===void 0||(T=T.videoStats)===null||T===void 0?void 0:T.frame_size_width,stats_frame_size_height:(X=this._stream)===null||X===void 0||(X=X.getLocalStreamStats())===null||X===void 0||(X=X.videoStats)===null||X===void 0?void 0:X.frame_size_height,stats_frame_rate_input:(L=this._stream)===null||L===void 0||(L=L.getLocalStreamStats())===null||L===void 0||(L=L.videoStats)===null||L===void 0?void 0:L.inputFrameRate,stats_frame_rate_sent:(W=this._stream)===null||W===void 0||(W=W.getLocalStreamStats())===null||W===void 0||(W=W.videoStats)===null||W===void 0?void 0:W.sentFrameRate,stats_frame_rate_encode:(M=this._stream)===null||M===void 0||(M=M.getLocalStreamStats())===null||M===void 0||(M=M.videoStats)===null||M===void 0?void 0:M.encoderOutputFrameRate,stats_frame_encoder_name:(k=this._stream)===null||k===void 0||(k=k.getLocalStreamStats())===null||k===void 0||(k=k.videoStats)===null||k===void 0?void 0:k.encoderName,stats_is_hardware_encoder_enabled:de.H264_HW_ENCODER,stats_gpu_url:de.GPU_URL||((U=Yi())===null||U===void 0?void 0:U.renderer),is_public_stream:(D=this._stream)===null||D===void 0?void 0:D.isPublicStream};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoSend,this.logger.info("rtcFirstFrameSend",JSON.stringify(B)),(ie=this._monitor)===null||ie===void 0||ie.report("rtc_first_frame",B),this._videoFirstFrameState=2,setTimeout((()=>{var $,te,N,K,x,E,q,ce,se,oe,ne,w,J,re,j,le,pe,ge,Ce,Qe;const vt={event_type:"sent_end",media_type:e,start:($=this._currentVideoSend)===null||$===void 0?void 0:$.startTime,is_screen:!((te=this._stream)===null||te===void 0||!te.isScreen),reason:i,result:!1,event_session_id:this._videoEventSessionId,type:(N=this._currentVideoSend)===null||N===void 0?void 0:N.type,vendor_mode:((K=this._stream)===null||K===void 0?void 0:K.vendorCode)||0,pc_session_id:((x=this._stream)===null||x===void 0?void 0:x.pcSessionId)||((E=this._ctx.peerConnection)===null||E===void 0?void 0:E.getConnectionId()),capture_session_id:(q=this._stream)===null||q===void 0||(q=q.videoTrack)===null||q===void 0?void 0:q.captureSessionId,codec:(ce=this._stream)===null||ce===void 0?void 0:ce.currentVideoCodec,track_frame_size_width:(se=this._stream)===null||se===void 0||(se=se.videoTrack)===null||se===void 0||(se=se.originTrack)===null||se===void 0?void 0:se.getSettings().width,track_frame_size_height:(oe=this._stream)===null||oe===void 0||(oe=oe.videoTrack)===null||oe===void 0||(oe=oe.originTrack)===null||oe===void 0?void 0:oe.getSettings().height,track_frame_rate:(ne=this._stream)===null||ne===void 0||(ne=ne.videoTrack)===null||ne===void 0||(ne=ne.originTrack)===null||ne===void 0?void 0:ne.getSettings().frameRate,stats_frame_size_width:(w=this._stream)===null||w===void 0||(w=w.getLocalStreamStats())===null||w===void 0||(w=w.videoStats)===null||w===void 0?void 0:w.frame_size_width,stats_frame_size_height:(J=this._stream)===null||J===void 0||(J=J.getLocalStreamStats())===null||J===void 0||(J=J.videoStats)===null||J===void 0?void 0:J.frame_size_height,stats_frame_rate_input:(re=this._stream)===null||re===void 0||(re=re.getLocalStreamStats())===null||re===void 0||(re=re.videoStats)===null||re===void 0?void 0:re.inputFrameRate,stats_frame_rate_sent:(j=this._stream)===null||j===void 0||(j=j.getLocalStreamStats())===null||j===void 0||(j=j.videoStats)===null||j===void 0?void 0:j.sentFrameRate,stats_frame_rate_encode:(le=this._stream)===null||le===void 0||(le=le.getLocalStreamStats())===null||le===void 0||(le=le.videoStats)===null||le===void 0?void 0:le.encoderOutputFrameRate,stats_frame_encoder_name:(pe=this._stream)===null||pe===void 0||(pe=pe.getLocalStreamStats())===null||pe===void 0||(pe=pe.videoStats)===null||pe===void 0?void 0:pe.encoderName,stats_is_hardware_encoder_enabled:de.H264_HW_ENCODER,stats_gpu_url:de.GPU_URL||((ge=Yi())===null||ge===void 0?void 0:ge.renderer),is_public_stream:(Ce=this._stream)===null||Ce===void 0?void 0:Ce.isPublicStream};this.logger.info("rtc_first_frame_statistics",JSON.stringify(vt)),(Qe=this._monitor)===null||Qe===void 0||Qe.report("rtc_first_frame_statistics",vt)}),8e3)}}sendFrameFinish(e){if(e==="audio"){var i,s,o,r,n,a,c;if(this._audioFirstFrameState!==1||!this._currentAudioSend)return;const{type:M,startTime:k}=this._currentAudioSend,U={event_type:"sent_end",media_type:e,is_screen:!((i=this._stream)===null||i===void 0||!i.isScreen),start:k,result:!0,event_session_id:this._audioEventSessionId,type:M,vendor_mode:((s=this._stream)===null||s===void 0?void 0:s.vendorCode)||0,pc_session_id:((o=this._stream)===null||o===void 0?void 0:o.pcSessionId)||((r=this._ctx.peerConnection)===null||r===void 0?void 0:r.getConnectionId()),capture_session_id:(n=this._stream)===null||n===void 0||(n=n.audioTrack)===null||n===void 0?void 0:n.captureSessionId,is_public_stream:(a=this._stream)===null||a===void 0?void 0:a.isPublicStream};delete this._currentAudioSend,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameSend",JSON.stringify(U)),(c=this._monitor)===null||c===void 0||c.report("rtc_first_frame",U),this._audioFirstFrameState=3}else if(e==="video"){var d,l,u,p,h,_,y,b,S,v,f,g,Z,R,T,X,L,W;if(this._videoFirstFrameState!==1||!this._currentVideoSend)return;const{type:M,startTime:k}=this._currentVideoSend,U={event_type:"sent_end",media_type:e,is_screen:!((d=this._stream)===null||d===void 0||!d.isScreen),start:k,result:!0,event_session_id:this._videoEventSessionId,type:M,vendor_mode:((l=this._stream)===null||l===void 0?void 0:l.vendorCode)||0,pc_session_id:((u=this._stream)===null||u===void 0?void 0:u.pcSessionId)||((p=this._ctx.peerConnection)===null||p===void 0?void 0:p.getConnectionId()),capture_session_id:(h=this._stream)===null||h===void 0||(h=h.videoTrack)===null||h===void 0?void 0:h.captureSessionId,codec:(_=this._stream)===null||_===void 0?void 0:_.currentVideoCodec,track_frame_size_width:(y=this._stream)===null||y===void 0||(y=y.videoTrack)===null||y===void 0||(y=y.originTrack)===null||y===void 0?void 0:y.getSettings().width,track_frame_size_height:(b=this._stream)===null||b===void 0||(b=b.videoTrack)===null||b===void 0||(b=b.originTrack)===null||b===void 0?void 0:b.getSettings().height,track_frame_rate:(S=this._stream)===null||S===void 0||(S=S.videoTrack)===null||S===void 0||(S=S.originTrack)===null||S===void 0?void 0:S.getSettings().frameRate,stats_frame_size_width:(v=this._stream)===null||v===void 0||(v=v.getLocalStreamStats())===null||v===void 0||(v=v.videoStats)===null||v===void 0?void 0:v._captureResolutionWidth,stats_frame_size_height:(f=this._stream)===null||f===void 0||(f=f.getLocalStreamStats())===null||f===void 0||(f=f.videoStats)===null||f===void 0?void 0:f._captureResolutionHeight,stats_frame_rate_input:(g=this._stream)===null||g===void 0||(g=g.getLocalStreamStats())===null||g===void 0||(g=g.videoStats)===null||g===void 0?void 0:g.inputFrameRate,stats_frame_rate_sent:(Z=this._stream)===null||Z===void 0||(Z=Z.getLocalStreamStats())===null||Z===void 0||(Z=Z.videoStats)===null||Z===void 0?void 0:Z.sentFrameRate,stats_frame_rate_encode:(R=this._stream)===null||R===void 0||(R=R.getLocalStreamStats())===null||R===void 0||(R=R.videoStats)===null||R===void 0?void 0:R.encoderOutputFrameRate,stats_frame_encoder_name:(T=this._stream)===null||T===void 0||(T=T.getLocalStreamStats())===null||T===void 0||(T=T.videoStats)===null||T===void 0?void 0:T.encoderName,stats_is_hardware_encoder_enabled:de.H264_HW_ENCODER,stats_gpu_url:de.GPU_URL||((X=Yi())===null||X===void 0?void 0:X.renderer),is_public_stream:(L=this._stream)===null||L===void 0?void 0:L.isPublicStream};delete this._currentVideoSend,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameSend",JSON.stringify(U)),(W=this._monitor)===null||W===void 0||W.report("rtc_first_frame",U),this._videoFirstFrameState=3,setTimeout((()=>{var D,ie,B,$,te,N,K,x,E,q,ce,se,oe,ne,w,J,re,j;const le={event_type:"sent_end",media_type:e,is_screen:!((D=this._stream)===null||D===void 0||!D.isScreen),start:k,result:!0,event_session_id:this._videoEventSessionId,type:M,vendor_mode:((ie=this._stream)===null||ie===void 0?void 0:ie.vendorCode)||0,pc_session_id:((B=this._stream)===null||B===void 0?void 0:B.pcSessionId)||(($=this._ctx.peerConnection)===null||$===void 0?void 0:$.getConnectionId()),capture_session_id:(te=this._stream)===null||te===void 0||(te=te.videoTrack)===null||te===void 0?void 0:te.captureSessionId,codec:(N=this._stream)===null||N===void 0?void 0:N.currentVideoCodec,track_frame_size_width:(K=this._stream)===null||K===void 0||(K=K.videoTrack)===null||K===void 0||(K=K.originTrack)===null||K===void 0?void 0:K.getSettings().width,track_frame_size_height:(x=this._stream)===null||x===void 0||(x=x.videoTrack)===null||x===void 0||(x=x.originTrack)===null||x===void 0?void 0:x.getSettings().height,track_frame_rate:(E=this._stream)===null||E===void 0||(E=E.videoTrack)===null||E===void 0||(E=E.originTrack)===null||E===void 0?void 0:E.getSettings().frameRate,stats_frame_size_width:(q=this._stream)===null||q===void 0||(q=q.getLocalStreamStats())===null||q===void 0||(q=q.videoStats)===null||q===void 0?void 0:q._captureResolutionWidth,stats_frame_size_height:(ce=this._stream)===null||ce===void 0||(ce=ce.getLocalStreamStats())===null||ce===void 0||(ce=ce.videoStats)===null||ce===void 0?void 0:ce._captureResolutionHeight,stats_frame_rate_input:(se=this._stream)===null||se===void 0||(se=se.getLocalStreamStats())===null||se===void 0||(se=se.videoStats)===null||se===void 0?void 0:se.inputFrameRate,stats_frame_rate_sent:(oe=this._stream)===null||oe===void 0||(oe=oe.getLocalStreamStats())===null||oe===void 0||(oe=oe.videoStats)===null||oe===void 0?void 0:oe.sentFrameRate,stats_frame_rate_encode:(ne=this._stream)===null||ne===void 0||(ne=ne.getLocalStreamStats())===null||ne===void 0||(ne=ne.videoStats)===null||ne===void 0?void 0:ne.encoderOutputFrameRate,stats_frame_encoder_name:(w=this._stream)===null||w===void 0||(w=w.getLocalStreamStats())===null||w===void 0||(w=w.videoStats)===null||w===void 0?void 0:w.encoderName,stats_is_hardware_encoder_enabled:de.H264_HW_ENCODER,stats_gpu_url:de.GPU_URL||((J=Yi())===null||J===void 0?void 0:J.renderer),is_public_stream:(re=this._stream)===null||re===void 0?void 0:re.isPublicStream};this.logger.info("rtc_first_frame_statistics",JSON.stringify(le)),(j=this._monitor)===null||j===void 0||j.report("rtc_first_frame_statistics",le)}),8e3)}}setLogin(e){if(this._login!==e){var i,s;this._login=e,e&&((i=this._stream)!==null&&i!==void 0&&i.videoTrack&&this._stream.pubVideo&&this.beginSendFrame("video","login"),(s=this._stream)!==null&&s!==void 0&&s.audioTrack&&this._stream.pubAudio&&this.beginSendFrame("audio","login")),!e&&this._audioSending&&this.stopSendFrame("audio","leave_room"),!e&&this._videoSending&&this.stopSendFrame("video","leave_room")}}setPublish(e){if(this._publish!==e){var i,s;this._publish=e,e&&(!((i=this._stream)===null||i===void 0)&&i.videoTrack&&this._stream.pubVideo&&this.beginSendFrame("video","publish"),!((s=this._stream)===null||s===void 0)&&s.audioTrack&&this._stream.pubAudio&&this.beginSendFrame("audio","publish")),!e&&this._audioSending&&this.stopSendFrame("audio","unpublish"),!e&&this._videoSending&&this.stopSendFrame("video","unpublish")}}setUnmuteAudio(e){var i;this._unMuteAudio!==e&&(this._unMuteAudio=e,(i=this._stream)!==null&&i!==void 0&&i.audioHasCapture&&(e&&this.beginSendFrame("audio","unmute"),!e&&this._audioSending&&this.stopSendFrame("audio","mute")))}setEnableAudio(e){var i;this._enableAudio!==e&&(i=this._stream)!==null&&i!==void 0&&i.pubAudio&&(this._enableAudio=e,e&&this.beginSendFrame("audio","enable"),!e&&this._audioSending&&this.stopSendFrame("audio","disable"))}setUnmuteVideo(e){var i;this._unMuteVideo!==e&&(this._unMuteVideo=e,(i=this._stream)!==null&&i!==void 0&&i.videoHasCapture&&(e&&this.beginSendFrame("video","unmute"),!e&&this._videoSending&&this.stopSendFrame("video","mute")))}setEnableVideo(e){var i;this._enableVideo!==e&&(i=this._stream)!==null&&i!==void 0&&i.pubVideo&&(this._enableVideo=e,e&&this.beginSendFrame("video","enable"),!e&&this._videoSending&&this.stopSendFrame("video","disable"))}setPushAudio(e){this._pushAudio!==e&&(this._pushAudio=e,e&&this.beginSendFrame("audio","push"),!e&&this._audioSending&&this.stopSendFrame("audio","stop_push"))}setPushVideo(e){this._pushVideo!==e&&(this._pushVideo=e,e&&this.beginSendFrame("video","push"),!e&&this._videoSending&&this.stopSendFrame("video","stop_push"))}setAutoPublish(e){this._autoPublish=e}setPublisher(e){this._publisher!==e&&(this._publisher=e,!e&&this._audioSending&&this.stopSendFrame("audio","audience"),!e&&this._videoSending&&this.stopSendFrame("video","audience"))}setDisconnect(){this._audioSending&&this.stopSendFrame("audio","connection_lost"),this._videoSending&&this.stopSendFrame("video","connection_lost"),this.reset()}setTimeout(e){this._timeout=e}setPCSessionId(e){this._pcSessionId=e}async _getFirstVideoFrameStats(){var e,i,s,o;const r=(e=this._stream)===null||e===void 0||(e=e.videoTrack)===null||e===void 0?void 0:e.preprocessingTrack,n=(i=this._stream)===null||i===void 0||(i=i.videoTransceiver)===null||i===void 0?void 0:i.sender,a=(s=(o=this._stream)===null||o===void 0||(o=o.vendorHandler)===null||o===void 0?void 0:o.peer)!==null&&s!==void 0?s:this._ctx.peerConnection;if(a&&r)return(await a.getStatsWithLowFrequency(r,!0,n)).filter((c=>c.type==="outbound-rtp"))}async _getFirstAudioFrameStats(){var e,i,s,o;const r=(e=this._stream)===null||e===void 0||(e=e.audioTrack)===null||e===void 0?void 0:e.preprocessingTrack,n=(i=this._stream)===null||i===void 0||(i=i.audioTransceiver)===null||i===void 0?void 0:i.sender,a=(s=(o=this._stream)===null||o===void 0||(o=o.vendorHandler)===null||o===void 0?void 0:o.peer)!==null&&s!==void 0?s:this._ctx.peerConnection;if(a&&r)return(await a.getStatsWithLowFrequency(r,!0,n)).find((c=>c.type==="outbound-rtp"))}_watchForFirstVideoFrameSend(){let e=-1,i=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval((async()=>{const s=await this._getFirstVideoFrameStats();let o=0,r=0;if(s?.map((n=>{o+=n.framesSent,r+=n.packetsSent})),s&&s.length>0&&(o>e||r>i)){if(e===-1&&i===-1)return e=o,void(i=r);this.sendFrameFinish("video"),window.clearInterval(this._firstVideoFrameInterval)}}),100)}_watchForFirstAudioFrameSend(){let e=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval((async()=>{const i=await this._getFirstAudioFrameStats();if(i&&i.packetsSent>e){if(e===-1)return void(e=i.packetsSent);this.sendFrameFinish("audio"),window.clearInterval(this._firstAudioFrameInterval)}}),100)}reset(){this._login=!1,this._publisher=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoPublish=!1,this._publish=!1,this._audioFirstFrameState=0,this._videoFirstFrameState=0,this._currentAudioSend={startTime:0,eventSessionId:0,type:"login"},this._currentVideoSend={startTime:0,eventSessionId:0,type:"login"},window.clearTimeout(this._firstAudioFrameTimer),window.clearTimeout(this._firstVideoFrameTimer),window.clearInterval(this._firstAudioFrameInterval),window.clearInterval(this._firstVideoFrameInterval)}destroy(){this.reset(),delete this._stream}get _audioSending(){return this._audioFirstFrameState===1}get _videoSending(){return this._videoFirstFrameState===1}}const p3={audio:{delay:1200,stallRadio:.3},video:{delay:1200,stallRadio:.6},screen_audio:{delay:1600,stallRadio:.8},screen_video:{delay:1600,stallRadio:.8}};class b3{constructor(e){m(this,"_preUplinkStats",new Map),m(this,"_preDownlinkStats",new Map),m(this,"_timer",void 0),m(this,"_delayTimer",void 0),m(this,"reportor",void 0),this._ctx=e}updateUplinkStats(e,i){const{audioStats:s,videoStats:o,isScreen:r}=e;if(s.sendKBitrate>0&&s.rtt){const n=r?"screen_audio":"audio",{rtt:a,_fractionLost:c,_retransmittedRate:d}=s,l=this._getQosLevel(a,c||0,d||0),u=this._preUplinkStats.get(n)||[l];this._preUplinkStats.set(n,[...u,l].slice(-2))}if(o.sentKBitrate>0&&o.rtt){const n=r?"screen_video":"video";let{_fractionLost:a}=o;const{rtt:c,_sendBandWidth:d,_retransmittedRate:l}=o;d===0&&(a=Math.max(.65,a));const u=this._getQosLevel(c,a||0,l||0),p=this._getUplinkVideoQoE(e,i),h=this._getVideoUplinkNetworkQuality(u,p),_=this._preUplinkStats.get(n)||[h];this._preUplinkStats.set(n,[..._,h].slice(-2))}this._startNetworkQualityReport()}updateDownlinkStats(e,i){if(!i)return;const{audioActive:s,videoActive:o}=this._getStreamActiveState(i),{audioStats:r,videoStats:n,isScreen:a,userId:c}=e;let d,l,u=!0,p=!0;if(s)if(r.receivedKBitrate===0)u=!1;else{const{rtt:y,audioLossRate:b,stallDuration:S,statsInterval:v,e2eDelay:f}=r,g=S/v,Z=a?"screen_audio":"audio",R=this._getQosLevel(y,b||0,n._retransmittedRate||0),T=this._getDownlinkQoE(Z,g,f);d=this._getNetworkQuality(R,T)}if(o)if(n.receivedKBitrate===0||n.rtt===0)p=!1;else{const{rtt:y,videoLossRate:b,stallDuration:S,statsInterval:v,e2eDelay:f,_retransmittedRate:g}=n,Z=S/v,R=a?"screen_video":"video",T=this._getQosLevel(y,b||0,g||0),X=this._getDownlinkQoE(R,Z,f);l=this._getNetworkQuality(T,X)}const h="".concat(c).concat(a?"_screen":"");if(!u&&!p)return void this._preDownlinkStats.delete(h);const _=d&&l?Math.ceil((d+l)/2):d||l;if(_){const y=this._preDownlinkStats.get(h)||[_];this._preDownlinkStats.set(h,[...y,_].slice(-2)),this._startNetworkQualityReport()}}destroy(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._delayTimer&&(window.clearTimeout(this._delayTimer),delete this._delayTimer),this._preUplinkStats.clear(),this._preDownlinkStats.clear()}_startNetworkQualityReport(){this._delayTimer||this._timer||(this._preUplinkStats.size>0||this._preDownlinkStats.size>0)&&(this._delayTimer=setTimeout((()=>{delete this._delayTimer,this._reportNetworkQuality(),this._timer=window.setInterval((()=>{this._reportNetworkQuality()}),2e3)}),300))}_reportNetworkQuality(){var e;let i,s;if(["connected","connecting"].includes((e=this._ctx.handler)===null||e===void 0?void 0:e.getConnectionState())){const o=this._getBetterQualityAndRemoveOldest("audio","up"),r=this._getBetterQualityAndRemoveOldest("video","up");i=o&&r?Math.ceil((o+r)/2):o||r||this._getBetterQualityAndRemoveOldest("screen_video","up")||this._getBetterQualityAndRemoveOldest("screen_audio","up")||To.EXCELLENT;const n=Array.from(this._preDownlinkStats.keys()).map((a=>this._getBetterQualityAndRemoveOldest(a,"down"))).filter((a=>a));s=Math.ceil(n.reduce(((a,c)=>c+a),0)/n.length)||To.UNKNOWN}else i=s=To.DOWN;navigator.onLine||(i=To.DOWN,s=To.DOWN),typeof this.reportor=="function"&&this.reportor(i,s)}_getNetworkQuality(e,i){return i===1?Math.max(e-2,1):i===2?e:Math.min(e+1,5)}_getVideoUplinkNetworkQuality(e,i){return i===1||i===0?e:Math.min(i===2?e+1:e+2,5)}_getQosLevel(e,i,s){let o;return o=(!e||e<=250)&&i<=.15?1:(!e||e<=500)&&i<=.3?2:(!e||e<=750)&&i<=.45?3:(!e||e<=1e3)&&i<=.6?4:5,s>.5?o=Math.max(o,4):s>.35?o=Math.max(o,3):s>.15&&(o=Math.max(o,2)),o}_getUplinkQoE(e,i){let s=0;switch(e){case"audio":case"video":s=i<.05?1:i<.1?2:3;break;case"screen_video":case"screen_audio":s=i<.04?1:i<.08?2:3}return s}_getUplinkVideoQoE(e,i){var s;const o=(e==null||(s=e.videoStats)===null||s===void 0?void 0:s.rid)||"0";if(!i)return 0;const r=i.pubAttributes.videoDescriptions[o],n=e.videoStats,a=n.encodedFrameWidth*n.encodedFrameHeight/(r.width*r.height),c=n.sentFrameRate/r.framerate;let d=0,l=0;return typeof a!="number"||Number.isNaN(a)||(d=a>=.9?1:a<.9&&a>=.8?2:3),typeof c!="number"||Number.isNaN(c)||(l=c>=.8?1:c<.8&&c>=.6?2:3),Math.max(0,d,l)}_getDownlinkQoE(e,i,s){const o=p3[e];return i>o.stallRadio||s>o.delay||i>o.stallRadio/2&&s>o.delay/2?3:(i>o.stallRadio/2||o.delay,2)}_getBetterQualityAndRemoveOldest(e,i){let s=To.UNKNOWN;const o=i==="up"?this._preUplinkStats:this._preDownlinkStats,r=o.get(e);if(r){const n=r.filter((a=>a));n.length>0&&(s=Math.min(...n)),r.shift(),r.length===0&&o.delete(e)}return s}_getStreamActiveState(e){let{subMediaType:i,_attributes:s,subVideo:o,subAudio:r}=e;return{audioActive:r&&Be(i)&&s.localaudio&&s.audiostream,videoActive:o&&Ve(i)&&s.localvideo&&s.videostream}}}class y3{constructor(e){m(this,"_timer",void 0),m(this,"_remoteVideoSizeCache",{}),m(this,"_remoteScreenSizeCache",{}),m(this,"onchange",void 0),this._room=e,this._start()}destroy(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._remoteVideoSizeCache={},this._remoteScreenSizeCache={}}_start(){this._timer||(this._timer=window.setInterval((()=>{const e={},i={};this._room.remoteStreams.forEach(((s,o)=>{s.forEach((r=>{var n;const a=(n=r.videoTrack)===null||n===void 0?void 0:n.preprocessingTrack;if(a){const l=r.isScreen?this._remoteScreenSizeCache:this._remoteVideoSizeCache,{width:u=0,height:p=0}=l[o]||{};let h=0,_=0;if(Te){var c,d;({width:h,height:_}=(c=r==null||(d=r.videoTrack)===null||d===void 0?void 0:d.getSizeByPlayer())!==null&&c!==void 0?c:{width:0,height:0})}else{const y=a.getSettings();h=y.width||0,_=y.height||0}p===_&&u===h||typeof this.onchange=="function"&&this.onchange(o,r.isScreen,h,_),delete l[o],(r.isScreen?i:e)[o]={width:h,height:_}}}))})),Object.keys(this._remoteVideoSizeCache).forEach((s=>{typeof this.onchange=="function"&&this.onchange(s,!1,0,0)})),Object.keys(this._remoteScreenSizeCache).forEach((s=>{typeof this.onchange=="function"&&this.onchange(s,!0,0,0)})),this._remoteVideoSizeCache=e,this._remoteScreenSizeCache=i}),1e3))}}const _3=Array.from(new TextEncoder().encode("subt")),S3={1:C.SUBTITLE_ERR_POSTPROCESS,2:C.SUBTITLE_ERR_CONNECTION_ERROR,3:C.SUBTITLE_ERR_PROCESS_ERROR},Cd=new ue("SubtitleTool",1),v3=t=>{if(t.extraInfo)try{const i=JSON.parse(t.extraInfo);i.source_language&&["zh","en","ja"].indexOf(i.source_language)}catch{}else{var e;const i=((e=navigator.language)===null||e===void 0?void 0:e.substring(0,2))||"";["zh","en","ja"].indexOf(i)>-1&&(t.extraInfo=JSON.stringify({source_language:i}))}};class el{constructor(e,i){m(this,"_taskId",void 0),m(this,"_sourceLanguage","zh"),m(this,"_updating",!1),m(this,"onEvent",void 0),m(this,"onMessage",void 0),m(this,"_preConfig",void 0),m(this,"_timer",void 0),this._ctx=e,this._roomConf=i;const{extraInfo:s}=i.userInfo;if(s)try{const o=JSON.parse(s);o.source_language&&(this._sourceLanguage=o.source_language)}catch{}}async start(e){Cd.info("start","Invoke config: %o",e),_e(e.mode,"mode",[Ms.ASR_ONLY,Ms.ASR_AND_TRANSLATION]);const i=Array.isArray(e.targetLanguage)?e.targetLanguage:[e.targetLanguage||""];if(e.mode===Ms.ASR_AND_TRANSLATION&&i.findIndex((s=>f3.indexOf(s)===-1))>-1)throw new G(C.INVALID_PARAMS,"Invalid targetLanguage.");if(this._taskId)throw new G(C.SUBTITLE_ALREADY_ON,"Already turned on subtitle");this._preConfig={targetLanguage:i,mode:e.mode},this._taskId=(Date.now().toString()+this._roomConf.roomId+this._roomConf.userId).substring(0,20),await this._sendSubtitleSignalingWithRetry(e,this._taskId)}async update(e){if(Cd.info("update","Invoke config: %o",e),!this._taskId)throw new G(C.SUBTITLE_NOT_TURNED_ON,"Start subtitle first.");this._sourceLanguage=e.sourceLanguage,this._updating=!0;try{await this._ctx.signalingManager.sendSignaling("controlMessage",this._genChangeSubtitleLanguageSignaling(e,this._taskId))}catch(i){throw this._updating=!1,i}}stop(){Cd.info("stop","Invoke"),this._taskId&&this._ctx.signalingManager.sendSignaling("controlMessage",{type:"subtitle",action:"stopped",appId:this._ctx.appId,roomId:this._roomConf.roomId,userId:this._roomConf.userId,taskId:this._taskId}).finally((()=>{var e;delete this._taskId,(e=this.onEvent)===null||e===void 0||e.call(this,{event:Rr.STOPPED}),this._clearTimer()}))}async reconnect(){this._taskId&&this._preConfig&&(await this._ctx.signalingManager.sendSignaling("controlMessage",{type:"subtitle",action:"stopped",appId:this._ctx.appId,roomId:this._roomConf.roomId,userId:this._roomConf.userId,taskId:this._taskId}),delete this._taskId,this.start(this._preConfig))}getConfig(){return this._preConfig}destroy(){Cd.info("destroy","Invoke"),this.stop(),delete this._preConfig,delete this._taskId}onResult(e){const{error:i,errorMessage:s,eventType:o}=e.body;if(i!==0){var r;const c=new G(S3[i]||C.SUBTITLE_ERR_UNKNOWN,s||"");(r=this.onEvent)===null||r===void 0||r.call(this,{event:Rr.ERROR,errorCode:c.code,errorMessage:c.message}),this._clearTimer()}else if(o==="SubtitleStarted"){var n;(n=this.onEvent)===null||n===void 0||n.call(this,{event:Rr.STARTED}),this._clearTimer()}else if(this._updating&&o==="LanguageChanged"){var a;this._updating=!1,(a=this.onEvent)===null||a===void 0||a.call(this,{event:Rr.UPDATED})}}onMessageRecv(e){if(arguments.length>1&&arguments[1]!==void 0&&arguments[1]||this._taskId&&this._preConfig){const s=g3(e);if(!s||s.length===0)return!1;if(this._taskId&&this._preConfig){const{mode:o,targetLanguage:r}=this._preConfig,n=[];var i;s.forEach((a=>{if(o===Ms.ASR_ONLY)a.mode===o&&n.push(a);else{const c=r.includes(a.language);(c||a.mode===Ms.ASR_ONLY)&&n.push(a),a.mode===Ms.ASR_ONLY&&c&&n.push(I(I({},a),{},{mode:Ms.ASR_AND_TRANSLATION}))}})),n.length>0&&((i=this.onMessage)===null||i===void 0||i.call(this,n))}return!0}return!1}async _sendSubtitleSignalingWithRetry(e,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;await this._ctx.signalingManager.sendSignaling("controlMessage",this._genSubtitleSignaling(e,i)),this._timer=self.setTimeout((()=>{var o;s===2?((o=this.onEvent)===null||o===void 0||o.call(this,{event:Rr.ERROR,errorCode:C.TIME_OUT,errorMessage:"start subtitle timeout."}),delete this._timer,this.stop()):this._sendSubtitleSignalingWithRetry(e,i,s+1)}),el.retryIntervel)}_genSubtitleSignaling(e,i){return{taskId:i,type:"subtitle",action:"started",roomId:this._roomConf.roomId,appId:this._ctx.appId,userId:this._roomConf.userId,subtitleMeta:{subtitleConfig:{mode:e.mode,usersConfig:[{userId:this._roomConf.userId,targetLanguages:Array.isArray(e.targetLanguage)?e.targetLanguage:[e.targetLanguage||""]}]},vendorConfig:{type:0}}}}_genChangeSubtitleLanguageSignaling(e,i){return{taskId:i,type:"subtitle",action:"subtitleUpdated",roomId:this._roomConf.roomId,appId:this._ctx.appId,userId:this._roomConf.userId,subtitleMeta:{protocol:1,languageConfig:{sourceLanguages:[{userId:this._roomConf.userId,languageCode:[e.sourceLanguage]}]}}}}_clearTimer(){this._timer&&(self.clearTimeout(this._timer),delete this._timer)}}m(el,"retryIntervel",3e4);const g3=t=>{let{message:e}=t;if(e instanceof ArrayBuffer&&e.byteLength>8)try{const i=new DataView(e,0);let s=0;if(_3.every((o=>i.getUint8(s++)===o))){const o=i.getUint32(s);if(s+=4,o===i.byteLength-8){const r=$e.ab2str(e.slice(8)),{data:n,type:a}=JSON.parse(r);if(a==="subtitle")return n}}}catch{}return!1},f3=["zh","zh-Hant","tn","vi","iu","it","id","hi","en","ho","he","es","el","uk","ur","tk","tr","ti","ty","tl","to","th","ta","te","sl","sk","ss","eo","sm","sg","st","sv","ja","tw","qu","pt","pa","no","nb","nr","my","bn","mn","mh","mk","ml","mr","ms","lu","ro","lt","lv","lo","kj","hr","kn","ki","cs","ca","nl","ko","ht","gu","ka","kl","km","lg","kg","fi","fj","fr","ru","ng","de","tt","da","ts","cv","fa","bs","pl","bi","nd","ba","bg","az","ar","af","sq","ab","os","ee","et","ay","lzh","am","ckb","cy","gl","ha","hy","ig","kmr","ln","nso","ny","om","sn","so","sr","sw","xh","yo","zu"];class Z3{constructor(e,i){m(this,"roomId",void 0),m(this,"userInfo",void 0),m(this,"userId",void 0),m(this,"sessionId",Wt()),m(this,"token",void 0),m(this,"rtcVid",void 0),m(this,"joinPromise",void 0),m(this,"startJoinTimestamp",void 0),m(this,"_liveControlMessage",void 0),m(this,"_userStreamMap",new Map),m(this,"_roomConfig",{isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:Xt.communication}),m(this,"_vendorConfig",{enableMultiVendor:!1,vendorCode:0}),m(this,"_roomAttr",{multiChatMode:!1,bigRoomMode:!1}),m(this,"_tokenPublishPrivilegeExpired",!1),m(this,"_tokenSubscribePrivilegeExpired",!1),m(this,"_streamQueueMap",new Map),m(this,"_monitor",void 0),this._ctx=i,this.roomId=e.roomId,this.userInfo=e.userInfo,this.userId=e.userInfo.userId,this.token=e.token,this._monitor=ke(i.id)}async checkJoinRoom(){await this.joinPromise}get vendorConfig(){return this._vendorConfig}setVendorConfig(e){this._vendorConfig=e}updateRoomAttributes(e){this._roomAttr=I(I({},this._roomAttr),e)}setLiveControlMessage(e){this._liveControlMessage=e}getLiveControlMessage(){return this._liveControlMessage}isMultiChatMode(){return this._roomAttr.multiChatMode}updateRoomConfig(e){return this._roomConfig=Zh(this._roomConfig,e),this._roomConfig}get isAutoPublish(){return!this.isRTSOnlyRoom()&&this._roomConfig.isAutoPublish}get isAutoSubscribeAudio(){return!this.isRTSOnlyRoom()&&this._roomConfig.isAutoSubscribeAudio}get isAutoSubscribeVideo(){return!this.isRTSOnlyRoom()&&this._roomConfig.isAutoSubscribeVideo}get remoteVideoConfig(){return this._roomConfig.remoteVideoConfig}get roomProfileType(){return this._roomConfig.roomProfileType||Xt.communication}isRTSOnlyRoom(){return this._roomConfig.roomMode===kg.ROOM_MODE_RTS_ONLY}get rtsOnlySignalHeader(){return this.isRTSOnlyRoom()?{functionType:Lo.C2RTM}:void 0}updateUserPubInfo(e){const i=this._userStreamMap.get(e.clientId)||{};e.screen?(i.screenAudio=e.attributes.audiostream,i.screenVideo=e.attributes.videostream):(i.audio=e.attributes.audiostream,i.video=e.attributes.videostream),this._userStreamMap.set(e.clientId,i)}getUserPubInfo(e){return I({audio:!1,video:!1,screenAudio:!1,screenVideo:!1},this._userStreamMap.get(e)||{})}resetUserPubInfo(){this._userStreamMap.clear()}get tokenPublishPrivilegeExpired(){return this._tokenPublishPrivilegeExpired}get tokenSubscribePrivilegeExpired(){return this._tokenSubscribePrivilegeExpired}setTokenPublishPrivilegeExpired(e){this._tokenPublishPrivilegeExpired=e}setTokenSubscribePrivilegeExpired(e){this._tokenSubscribePrivilegeExpired=e}getStayRoomDuration(){return this.startJoinTimestamp?ee()-this.startJoinTimestamp:0}getStreamQueueLock(e){let i=this._streamQueueMap.get(e);return i||(i=new Ni(e),this._streamQueueMap.set(e,i)),i}report(e,i,s){var o;(o=this._monitor)===null||o===void 0||o.report(e,I({room_id:this.roomId,user_id:this.userId,rtc_session_id:this.sessionId,rtc_vid:this.rtcVid},i),s)}}const Vr=(t,e,i)=>{i.info(t,"userId: %o, subAudio: %o, subVideo: %o, audioMid: %o, videoMid: %o, sequenceId: %o",e.userId,e.subAudio,e.subVideo,e.audioMid,e.videoMid,e.sequenceId)};function me(t,e,i){const s=i.value;return i.value=async function(){if(!this._ctx.signalingManager.isConnected())throw new G(C.NOT_CONNECTED_YET,"error in ".concat(e,": try again after connect"));try{await(this._roomConf||this.config).checkJoinRoom()}catch{throw new G(C.JOIN_ROOM_FAILED,"error in ".concat(e,": try again after joined"))}for(var o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return s.apply(this,r)},i}function je(t,e,i){const s=i.value;return i.value=async function(){const o=this._roomConf,r=this._logger;for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];const d=a[0];if(d==null||!d.streamId)return s?.apply(this,a);const{streamId:l}=d;r.info("streamQueue","lock stream %o, task %o",l.slice(-5),e);const u=await o.getStreamQueueLock(l).lock();try{return await s?.apply(this,a)}finally{r.info("streamQueue","unlock stream %o, task %o",l.slice(-5),e),u()}},i}var T3=Object.defineProperty,I3=Object.getOwnPropertyDescriptor,Un=(t,e,i,s)=>{for(var o,r=I3(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&T3(e,i,r),r};class Er extends Vt{constructor(e,i){super(),m(this,"_forwardDstRooms",new Map),m(this,"forwardStreamState","stopped"),this._ctx=e,this._roomConf=i}async startForwardStream2Rooms(e){if(this.forwardStreamState==="running"||this.forwardStreamState==="paused")throw new G(C.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke startForwardStreamToRooms in state: ".concat(this.forwardStreamState));const i=await this._sendForwardStreamSignaling("start",this._roomConf.roomId,e);this._updateDstRooms(e,i);const s=this._transformForwardStreamResult(i);return this.forwardStreamState="running",s}async updateForwardStream2Rooms(e){if(this.forwardStreamState==="stopped")throw new G(C.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke updateForwardStreamToRooms in state: ".concat(this.forwardStreamState));let i=this._mockForwardStreamResult(e);return this.forwardStreamState==="running"&&(i=await this._sendForwardStreamSignaling("update",this._roomConf.roomId,e)),this._updateDstRooms(e,i),this._transformForwardStreamResult(i)}async stopForwardStream2Rooms(){if(this.forwardStreamState==="stopped")throw new G(C.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke stopForwardStreamToRooms in state: ".concat(this.forwardStreamState));let e=this._mockForwardStreamResult([]);if(this.forwardStreamState==="running"&&(e=await this._sendForwardStreamSignaling("stop",this._roomConf.roomId)),this._updateDstRooms([],e),[...this._forwardDstRooms.keys()].length>0)throw new G(C.UNEXPECTED_ERROR,"stopforwardstream failed: ".concat(JSON.stringify(e)));const i=this._transformForwardStreamResult(e);return this.forwardStreamState="stopped",i}async pauseForwardStream2AllRooms(){if(this.forwardStreamState==="paused"||this.forwardStreamState==="stopped")throw new G(C.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke pauseForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));const e=await this._sendForwardStreamSignaling("stop",this._roomConf.roomId),i=this._transformForwardStreamResult(e);return this.forwardStreamState="paused",i}async resumeForwardStream2AllRooms(){if(!(arguments.length>0&&arguments[0]!==void 0&&arguments[0])&&["running","stopped"].includes(this.forwardStreamState))throw new G(C.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke resumeForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));const e=this._getDstRooms(),i=await this._sendForwardStreamSignaling("start",this._roomConf.roomId,e);this._updateDstRooms(e,i);const s=this._transformForwardStreamResult(i);return this.forwardStreamState="running",s}resumeFromReconnect(){this.forwardStreamState==="running"&&this.resumeForwardStream2AllRooms(!0).then((e=>{e.forEach((i=>{i.state===Io.FORWARD_STREAM_STATE_FAILURE&&this.safeEmit(A.ON_FORWARD_STREAM_ERROR,i)}))}))}onForwardDstRoomUserKick(e){const i=[{dstRoomId:e.dstRoomId,code:200,forwardStreamType:"stop"}];this._updateDstRooms([],i),this.safeEmit(A.ON_FORWARD_STREAM_ERROR,{roomId:e.dstRoomId,state:Io.FORWARD_STREAM_STATE_FAILURE,error:Xr.FORWARD_STREAM_ERROR_REMOTE_KICKED})}destoy(){super.removeAllListeners(),this._forwardDstRooms.clear(),this.forwardStreamState="stopped"}_mockForwardStreamResult(e){const i=[];return this._forwardDstRooms.forEach(((s,o)=>{i.push({dstRoomId:o,forwardStreamType:"stop",code:200})})),e.forEach((s=>{const o=i.findIndex((r=>r.dstRoomId===s.roomId));o===-1?i.push({dstRoomId:s.roomId,forwardStreamType:"start",code:s.roomId===this._roomConf.roomId?400:200}):i[o].forwardStreamType="update"})),i}_transformForwardStreamResult(e){e||(e=[]);const i=[];for(const{dstRoomId:s,code:o}of e){const r={roomId:s,state:Io.FORWARD_STREAM_STATE_SUCCESS,error:Xr.FORWARD_STREAM_ERROR_OK};o===200||(o===400?(r.state=Io.FORWARD_STREAM_STATE_FAILURE,r.error=Xr.FORWARD_STREAM_ERROR_REMOTE_KICKED):o>=700&&o<800?(r.state=Io.FORWARD_STREAM_STATE_FAILURE,r.error=Xr.FORWARD_STREAM_ERROR_INVALID_TOKEN):(r.state=Io.FORWARD_STREAM_STATE_FAILURE,r.error=Xr.FORWARD_STREAM_ERROR_RESPONSE)),i.push(r)}return i}_updateDstRooms(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.length===0&&this._forwardDstRooms.clear(),i.forEach((s=>{let{dstRoomId:o,code:r,forwardStreamType:n}=s;if(r===200)if(n==="stop")this._forwardDstRooms.delete(o);else{var a;const c=e.find((l=>l.roomId===o));if(!c&&!this._forwardDstRooms.has(o))throw new G(C.UNEXPECTED_ERROR,"unknow roomid ".concat(o," in signaling return"));let d=(a=this._forwardDstRooms.get(o))!==null&&a!==void 0?a:{token:void 0};d=Object.assign(d,c),this._forwardDstRooms.set(o,d)}else this._forwardDstRooms.has(o)&&this._forwardDstRooms.delete(o)}))}_getDstRooms(){const e=[];return this._forwardDstRooms.forEach(((i,s)=>{e.push({roomId:s,token:i.token})})),e}async _sendForwardStreamSignaling(e,i,s){const o="".concat(La());if(e!=="stop"){const l=s.map((u=>u.roomId));this._roomConf.report("rtc_forward_stream",{type:"begin",dst_rooms:"{ ".concat(l.map((u=>'"'.concat(u,'"'))).join(",")," }"),event_session_id:o})}const r={forwardStreamType:e,roomId:i};(e==="start"||e==="update")&&(r.dstRoomInfos=s?.map((l=>({dstRoomId:l.roomId,dstToken:$e.token2auth(this._ctx.appId,l.roomId,this._roomConf.userId,l.token)}))));const n=await this._ctx.signalingManager.sendSignaling("forwardStream",r),a=[];if(n?.code!==200)throw e!=="stop"&&(s?.forEach((l=>{a.push({dst_room_id:l.roomId,result:"server error ".concat(n?.code)})})),this._roomConf.report("rtc_forward_stream",{type:"end",dst_rooms:JSON.stringify(a),event_session_id:o})),new G(C.UNEXPECTED_ERROR,"server side internal error, error code: ".concat(n));var c,d;return e!=="stop"&&((c=n.forwardStreamResults)===null||c===void 0||c.forEach((l=>{a.push({dst_room_id:l.dstRoomId,result:"dst room lost"})})),(d=n.forwardStreamResults)===null||d===void 0||d.forEach((l=>{const u=a.find((p=>p.dst_room_id===l.dstRoomId));u&&(l.code===200?l.forwardStreamType==="update"?u.result="update":u.result="success":u.result="server error ".concat(l.code))})),this._roomConf.report("rtc_forward_stream",{type:"end",dst_rooms:JSON.stringify(a),event_session_id:o})),n.forwardStreamResults}}Un([me],Er.prototype,"startForwardStream2Rooms"),Un([me],Er.prototype,"updateForwardStream2Rooms"),Un([me],Er.prototype,"stopForwardStream2Rooms"),Un([me],Er.prototype,"pauseForwardStream2AllRooms"),Un([me],Er.prototype,"resumeForwardStream2AllRooms");const iv=cs()||Qo();class CI extends Aa{constructor(e,i){super(e,i),m(this,"_peerConnectionId",Ts()),m(this,"peerConnectionMode",1),m(this,"name","vendor"),m(this,"direction","up"),m(this,"stream",void 0),i.on("ice_state",(s=>{this._report("rtc_ice_state",{pc_session_id:this.peerConnectionId,direction:this.direction,error_code:0,ice_state:s.toUpperCase(),message:"",peer_connection_id:this.peerConnectionId,stream_id:"",stream_user_id:""})})),i.on("disconnect",(()=>{this.emit("disconnect")}))}async publish(e){this._context.videoProfile.closeSimulcast(),this.stream=e;const{videoDescriptions:i,subVideoDescriptions:s,audioTransceiverInit:o,videoTransceiverInit:r}=super.internalPublish(e);e.audioTransceiver=this._peerConnection.addTransceiver(o.track,o.init),e.videoTransceiver=this._peerConnection.addTransceiver(r.track,r.init),iv&&(e.initAudioEncodedTransform(),e.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:e?.vendorCode||0});const n=await this.peer.createOfferSdp(),a=ee(),c=z.parse(n);Array.isArray(c.media)&&(c.media=c.media.map((l=>{if(l.type==="video")(Dt||yo)&&Array.isArray(l.ext)&&(l.ext=l.ext.filter((p=>{var h;return!(p!=null&&(h=p.uri)!==null&&h!==void 0&&h.includes("video-orientation"))}))),Dt||this.addBitrateLimit(l,this._context.videoProfile.getVideoEncodeConfig()[0].maxKbps);else if(l.type==="audio"){const p=l?.rtp.find((h=>h.codec==="opus"));if(p&&l.fmtp){var u;const h=l.fmtp.find((_=>_.payload===p.payload));h&&(u=this._context)!==null&&u!==void 0&&u.audioProfileManager&&(h.config=this._context.audioProfileManager.getOpusConfigStr(h.config))}}return l})));const d={type:"offer",sdp:z.write(c)};try{await this._peerConnection.setLocalDescription(d),this._report("rtc_set_description",{error_code:0,message:d.sdp||"",is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:ee()-a},{type:"offer"})}catch(l){throw this._report("rtc_set_description",{error_code:-1,message:l.message+d.sdp,is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:ee()-a},{type:"offer"}),l}return{partialSdp:d.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",videoDescriptions:i,subVideoDescriptions:s,audioTransceiverInit:o,videoTransceiverInit:r,peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId}}async subscribe(e){this.stream=e,this.direction="down",e.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),e.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}),iv&&(e.initAudioEncodedTransform(),e.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"down",stream_id:e.streamId,stream_user_id:e.userId,pc_session_id:this.peerConnectionId,vendor_mode:e.vendorCode||0});const i=await this.peer.createOfferSdp(),s=ee(),o=z.parse(i);Array.isArray(o.media)&&(o.media=o.media.map((n=>{if(n.type==="audio"){const a=n?.rtp.find((c=>c.codec==="opus"));if(a&&n!=null&&n.fmtp){const c=n?.fmtp.find((d=>d.payload===a.payload));c&&this._context&&(c.config+=";stereo=1;sprop-stereo=1")}}return n})));const r={type:"offer",sdp:z.write(o)};try{await this._peerConnection.setLocalDescription(r),this._report("rtc_set_description",{error_code:0,message:r.sdp||"",is_local:"1",direction:"down",stream_id:e.streamId,stream_user_id:e.userId,elapse:ee()-s},{type:"offer"})}catch(n){throw this._report("rtc_set_description",{error_code:-1,message:n.message+r.sdp,is_local:"1",direction:"down",stream_id:e.streamId,stream_user_id:e.userId,elapse:ee()-s},{type:"offer"}),n}return{partialSdp:r.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId}}async handleAck(e){if(e.action===Se.publish||e.action===Se.subscribe){const{signalingAck:n,videoMid:a,videoCodec:c}=e,{sdp:d}=n,l=z.parse(d);l.media=l.media.map((h=>(h.mid===a&&c&&Oo(h,c),h)));const u={sdp:z.write(l),type:"answer"},p=ee();try{var i,s;await this._peerConnection.setRemoteDescription(u),this._report("rtc_set_description",{error_code:0,message:u.sdp||"",is_local:"1",direction:"down",stream_id:((i=e.stream)===null||i===void 0?void 0:i.streamId)||"",stream_user_id:(s=e.stream)===null||s===void 0?void 0:s.userId,elapse:ee()-p},{type:"answer"})}catch(h){var o,r;throw this._report("rtc_set_description",{error_code:-1,message:h.message+u.sdp,is_local:"1",direction:"down",stream_id:((o=e.stream)===null||o===void 0?void 0:o.streamId)||"",stream_user_id:(r=e.stream)===null||r===void 0?void 0:r.userId,elapse:ee()-p},{type:"offer"}),h}typeof e.onSuccess=="function"&&e.onSuccess()}else e.action!==Se.unpublish&&e.action!==Se.unsubscribe||this.destroy();return""}destroy(){this.peer.destroy(),super.destroy()}async getDefaultSdp(){return{sdp:"",type:"offer",semantics:""}}connect(){throw new Error("Method not implemented.")}async rollback(){try{this._peerConnection.close()}catch{}}get peerConnectionId(){return this._peerConnectionId}set peerConnectionId(e){this._peerConnectionId=e}}var R3=Object.defineProperty,X3=Object.getOwnPropertyDescriptor,xs=(t,e,i,s)=>{for(var o,r=X3(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&R3(e,i,r),r};class _s extends Vt{constructor(e,i){super(),m(this,"_logger",void 0),m(this,"_pubBackOff",new Map),this._ctx=e,this._roomConf=i,this._logger=new ue("RoomPublisher",2,e.id)}async hasPublished(e){return!!e.audioMid&&!!e.videoMid}async publish(e){return this._publish(e)}async _publish(e){var i,s,o,r,n,a,c,d,l,u;this._logger.info("publish()","localStream: %o",e);const{videoTrack:p}=e,{audioTrack:h}=e,_=ee();let y,{handler:b}=this._ctx;this._roomConf.vendorConfig.enableMultiVendor?[b,y]=await this._getVendorPubSdpInfo(e):y=await this._ctx.handler.publish(e),this.emit("_test_pub_sdpInfo_",y);const{audioMid:S,videoMid:v}=y;e.pubAttributes={localaudio:!!h,localvideo:!!p,videostream:e.pubVideo,audiostream:e.pubAudio,extvideo:p?.sourceType===Ne.EXTERNAL,extaudio:h?.sourceType===Ne.EXTERNAL,videoDescriptions:y.videoDescriptions,videoType:Lt.NORMAL};const f={attributes:I({},e.pubAttributes),audio:!0,video:!0,screen:e.isScreen,audioMid:S,videoMid:v,sdpInfo:{msid:e.stream.id,type:y.type,sdp:y.partialSdp,semantics:y.semantics},peerConnectionMode:(i=y)===null||i===void 0?void 0:i.peerConnectionMode,supportMultiVendor:!0},g=!this._roomConf.vendorConfig.enableMultiVendor&&e.enableSimulcast&&((s=this._ctx.serverConfig)===null||s===void 0?void 0:s.simulcastOnDemand)&&((o=y.subVideoDescriptions)===null||o===void 0?void 0:o.length);let Z;(g||(r=this._ctx.serverConfig)!==null&&r!==void 0&&r.e2eFeedback)&&(f.attributes.subVideoDescriptions=y.subVideoDescriptions),(n=y)!==null&&n!==void 0&&n.peerConnectionId&&(f.peerConnectionId=y.peerConnectionId);try{this.emit("_test_pub_body_",f),Z=await this._ctx.signalingManager.sendSignaling("publish",f)}catch(k){var R,T;if(this._logger.error("_publish",Si(k)),(R=this._ctx.monitor)===null||R===void 0||R.report("rtc_error",{message:"[publisher._publish] ".concat(Si(k)),error_code:-1}),k instanceof Error?this._roomConf.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:_,message:"".concat(k.name,": ").concat(k.message)}):k instanceof G&&this._roomConf.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:_,message:"".concat(k.code,": ").concat(k.message)}),await((T=b)===null||T===void 0?void 0:T.rollback({msid:e.stream.id,stream:e,audioMid:S,videoMid:v})),k.code>=500&&k.code<600){this.emit("_test_pub_5xx_");const U=this._getPubBackOff(e.id);if(U.retryDuration<6e4)return this._logger.info("pubRetry",e.id,U.retryDuration),await new Promise((D=>setTimeout(D,U.interval))),U.retryDuration+=U.interval,U.interval=U.interval>4e3?8e3:2*U.interval,e.resetStream(),this.emit(A.PUB_RETRY,{screen:e.isScreen}),this._publish(e);this._logger.info("pubRetry","end"),this._pubBackOff.delete(e.id)}else if(k.code===403)throw new G(C.TOKEN_NO_PUBLISH_PERMISSION,k.message||"token no publish permission");throw k}var X,L;this._roomConf.report("rtc_recv_answer",{error_code:0,answer_type:(a=Z)===null||a===void 0?void 0:a.relayMessage.type,sequence_id:((c=Z)===null||c===void 0||(c=c.relayMessage)===null||c===void 0?void 0:c.sequenceId)||0,message:(d=Z)===null||d===void 0||(d=d.relayMessage)===null||d===void 0?void 0:d.sdp,direction:"up",stream_id:"",stream_user_id:"",pc_session_id:((l=b)===null||l===void 0?void 0:l.peerConnectionId)||""}),e.isScreen?e.setVideoCaps((X=Z.relayMessage.content)===null||X===void 0?void 0:X.screenCaps):e.setVideoCaps((L=Z.relayMessage.content)===null||L===void 0?void 0:L.videoCaps),Z.relayMessage.sdp=Pp(Z.relayMessage.sdp),e.streamId=Z.streamId;const W=await e.getSelectedCodec();e.currentVideoCodec=W;const M=new Promise(((k,U)=>{var D,ie,B,$,te;(D=b)===null||D===void 0||D.handleAck({action:Se.publish,streamId:Z.streamId,audioMid:S,videoMid:v,audioTransceiverInit:(ie=y)===null||ie===void 0?void 0:ie.audioTransceiverInit,videoTransceiverInit:(B=y)===null||B===void 0?void 0:B.videoTransceiverInit,signalingAck:{sdp:($=Z)===null||$===void 0||($=$.relayMessage)===null||$===void 0?void 0:$.sdp,sequenceId:(te=Z)===null||te===void 0||(te=te.relayMessage)===null||te===void 0?void 0:te.sequenceId},stream:e,videoCodec:W,onSuccess:()=>{this._logger.info("publish()","publish success"),k(0)},onFail:N=>{this._logger.info("publish()","publish fail"),U(N)}})}));!Te&&await M,this.emit("___afterHandleAckInPub"),(g&&this._ctx.videoProfile.getSimulcastMode()===Qs.VIDEO_ON_DEMAND||(u=this._ctx.serverConfig)!==null&&u!==void 0&&u.e2eFeedback)&&this.emit(ds.RSCP,[{StreamIds:[e.stream.id],Metadata:{VideoIndex:0}}],!0),e.videoMid=v,e.audioMid=S,e.subVideoDescriptions=y.subVideoDescriptions,e.remoteSdp=Z.relayMessage.sdp,this._roomConf.report("rtc_publish_stat",{result:"success",is_screen:"0",start:_,message:"unknown"})}async updatePubTrack(e){this._logger.info("updatePubTrack()","localStream: %o",e);const{videoTrack:i,audioTrack:s,pubAudio:o,pubVideo:r}=e,n=e.vendorHandler||this._ctx.handler;let a=s?.preprocessingTrack;const c=i?.preprocessingTrack;var d,l;if(r&&c?(e.stopBlackFrame(),await((d=e.videoTransceiver)===null||d===void 0?void 0:d.sender.replaceTrack(c)),this._updateVideoDescriptions(e)):await((l=e.videoTransceiver)===null||l===void 0?void 0:l.sender.replaceTrack(null)),o&&a){var u;const{mixType:b,mixedAudioTrack:S}=s;S&&b!==Ti.PLAYOUT&&a.enabled&&(a=S),await((u=e.audioTransceiver)===null||u===void 0?void 0:u.sender.replaceTrack(a))}else{var p;await((p=e.audioTransceiver)===null||p===void 0?void 0:p.sender.replaceTrack(null)),ye(this._ctx.id,"MediaClient.updatePubTrack(audio)","null")}await this._updatePublishCodec(e),this.emit("___onAfterReplaceTrack");try{ye(this._ctx.id,"MediaClient.updatePubTrack",JSON.stringify({audioStreamTrack:Zi(a),videoStreamTrack:Zi(c)}))}catch{}const h={localaudio:!!s,localvideo:!!i,videostream:r,audiostream:o,extvideo:i?.sourceType===Ne.EXTERNAL,extaudio:s?.sourceType===Ne.EXTERNAL,videoType:i?Lt.NORMAL:e.pubAttributes.videoType},_={};for(const[b,S]of Object.entries(h))S!==Reflect.get(e.pubAttributes,b)&&Reflect.set(_,b,S);if(!Object.keys(_).length)return;if(e.observer){const{observer:b}=e,{audiostream:S,videostream:v,localaudio:f,localvideo:g,extaudio:Z,extvideo:R}=_;g!==void 0?R!==void 0?b.setPushVideo(R):b.setEnableVideo(g):v!==void 0&&b.setUnmuteVideo(v),f!==void 0?Z!==void 0?b.setPushAudio(Z):b.setEnableAudio(f):S!==void 0&&b.setUnmuteAudio(S)}e.pubAttributes=I(I({},e.pubAttributes),h),e.pubAttributes.videostream||e.stopBlackFrame();const y={roomId:this._roomConf.roomId,streamId:e.streamId,attributes:_};await this._ctx.signalingManager.sendSignaling("updateStreamAttributes",y),this.emit("___onAfterUpdateSignaling"),Te&&await n?.setCurrentDescription()}async _updatePublishCodec(e){this._logger.info("updatePublishCodec()","localStream: %o",e);const{audioMid:i,videoMid:s,remoteSdp:o,streamId:r,currentVideoCodec:n}=e,a=await e.getSelectedCodec();if(this._logger.info("updatePublishCodec()","selectedCodec: %o",a),a!==n){if(e.currentVideoCodec=a,i&&s&&r&&o){var c;return(this._ctx.handler instanceof dI||this._ctx.handler instanceof cI)&&await((c=this._ctx.handler)===null||c===void 0?void 0:c._internalChangePubCodec()),new Promise(((d,l)=>{var u;(u=this._ctx.handler)===null||u===void 0||u.handleAck({action:Se.publish,streamId:r,audioMid:i,videoMid:s,signalingAck:{sdp:o,sequenceId:-1},videoCodec:a,onSuccess:d,onFail:l,stream:e})}))}{const d=["audioMid","videoMid","streamId","remoteSdp"].filter((l=>!Reflect.get(e,l)));this._logger.warn("updatePublishCodec()","fast return, because params: %o",d)}}else this._logger.warn("updatePublishCodec()","selectedCodec is equal to currentVideoCodec")}async unpublish(e){this._logger.info("unpublish()","localStream: %o",e);const i={roomId:this._roomConf.roomId,initStreamId:e.initStreamId,streamId:e.streamId};this._ctx.signalingManager.sendSignaling("unpublish",i).catch((()=>{}));const s=e.vendorHandler||this._ctx.handler;e.stopBlackFrame(),await s?.handleAck({action:Se.unpublish,audioMid:e.audioMid,videoMid:e.videoMid,stream:e,streamId:e.streamId})}async updatePubBlackFrame(e){var i;const s=await e.getSelectedCodec(),o=e.genBlackFrame(s);o&&((i=e.videoTransceiver)===null||i===void 0||(i=i.sender)===null||i===void 0||i.replaceTrack(o),e.pubAttributes.videoType=Lt.BLACK,this._ctx.signalingManager.sendSignaling("updateStreamAttributes",{roomId:this._roomConf.roomId,streamId:e.streamId,attributes:{videoType:Lt.BLACK}}),e.on("black-frame-ended",(()=>{var r;(r=e.videoTransceiver)===null||r===void 0||(r=r.sender)===null||r===void 0||r.replaceTrack(null),e.pubAttributes.videoType=Lt.NORMAL,this._ctx.signalingManager.sendSignaling("updateStreamAttributes",{roomId:this._roomConf.roomId,streamId:e.streamId,attributes:{videoType:Lt.NORMAL}})})))}async cleanStream(e){return this._logger.info("cleanStream()","localStream: %o",e),e?.clean()}async destroyStream(e){return this._logger.info("destroyStream()","localStream: %o",e),e?.destroy()}destroy(e){e.forEach((i=>{i&&(this.unpublish(i).catch((()=>{})),this.destroyStream(i).catch((()=>{})))})),this._pubBackOff.clear(),super.removeAllListeners()}async _updateVideoDescriptions(e){var i;const s=this._ctx.videoProfile.genVideoDescriptions(e),o=e.pubAttributes.videoDescriptions;if(o.length!==s.videoDescriptions.length)return;const r={};if(o.find(((c,d)=>{if(c.framerate!==s.videoDescriptions[d].framerate||c.maxkbps!==s.videoDescriptions[d].maxkbps||c.width!==s.videoDescriptions[d].width||c.height!==s.videoDescriptions[d].height)return r.videoDescriptions=s.videoDescriptions,!0})),(i=e.subVideoDescriptions)===null||i===void 0||i.find(((c,d)=>{if(c.framerate!==s.subVideoDescriptions[d].framerate||c.maxkbps!==s.subVideoDescriptions[d].maxkbps||c.width!==s.subVideoDescriptions[d].width||c.height!==s.subVideoDescriptions[d].height)return r.subVideoDescriptions=s.subVideoDescriptions,!0})),Object.keys(r).length>0){var n;this._ctx.signalingManager.sendSignaling("updateStreamAttributes",{roomId:this._roomConf.roomId,streamId:e.streamId,attributes:r});const c=(n=e.videoTransceiver)===null||n===void 0||(n=n.sender)===null||n===void 0?void 0:n.getParameters();var a;ye(this._ctx.id,"sender.getParameters",JSON.stringify(c),0,e.streamId),c&&Array.isArray(c?.encodings)&&(c.encodings=c.encodings.map(((d,l)=>((d.rid?d.rid:c.encodings.length===1?"0":void 0)===s.sendEncodings[l].rid&&(d.maxBitrate=s.sendEncodings[l].maxBitrate,d.maxFramerate=s.sendEncodings[l].maxFramerate,d.scaleResolutionDownBy=s.sendEncodings[l].scaleResolutionDownBy),d))),this._logger.info("sender.setParameters()",JSON.stringify(c.encodings)),ye(this._ctx.id,"sender.setParameters",JSON.stringify(c),0,e.streamId),(a=e.videoTransceiver)===null||a===void 0||a.sender.setParameters(c),ye(this._ctx.id,"Handler.updateScaleResolutionDownBy",JSON.stringify(c.encodings)))}}async _getVendorPubSdpInfo(e){const i=new Zc(this._ctx,"");e.vendorHandler=new CI(this._ctx,i),e.pcSessionId&&(e.vendorHandler.peerConnectionId=e.pcSessionId);const s=await e.vendorHandler.publish(e),o=e.vendorHandler;return o.on("ice_state",(r=>{this.emit(Fe.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:fe.CONNECTION_STATE_CONNECTING,connected:fe.CONNECTION_STATE_CONNECTED,disconnected:fe.CONNECTION_STATE_RECONNECTING}[r],userId:this._roomConf.userId})})),o.once("disconnect",(async()=>{var r;o.removeAllListeners(),((r=this._ctx.peerConnection)===null||r===void 0?void 0:r.getIceConnectionState())==="connected"?(await this.unpublish(e),await this.publish(e),e.vendorHandler&&e.statsReport.setVar(e.vendorHandler)):this._logger.info("vendor ice failed",e.streamId)})),[o,s]}_getPubBackOff(e){return this._pubBackOff.has(e)||this._pubBackOff.set(e,{interval:1e3,retryDuration:0}),this._pubBackOff.get(e)}}xs([je],_s.prototype,"hasPublished"),xs([je,Hi,me],_s.prototype,"publish"),xs([je,Hi,me],_s.prototype,"updatePubTrack"),xs([je,Hi,me],_s.prototype,"unpublish"),xs([je,me],_s.prototype,"updatePubBlackFrame"),xs([je],_s.prototype,"cleanStream"),xs([je],_s.prototype,"destroyStream"),xs([me],_s.prototype,"_updateVideoDescriptions");var C3=Object.defineProperty,L3=Object.getOwnPropertyDescriptor,jt=(t,e,i,s)=>{for(var o,r=L3(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&C3(e,i,r),r};class xt extends Vt{constructor(e,i){super(),m(this,"_logger",void 0),m(this,"_subBackOff",new Map),m(this,"_subResolves",{}),m(this,"_ontrackCallbackMap",new Map),this._ctx=e,this._roomConf=i,this._logger=new ue("RoomSubscriber",2,e.id)}async hasSubscribed(e){return e.streamState===Yt.SUB_ED}async subscribe(e,i,s){if(e.streamState!==Yt.SUB_ED)return this._subscribe(e,i,s);this._logger.warn("subscribe()","remoteStream ".concat(e.streamId," has been subscribed, silently return"))}async _subscribe(e,i,s){var o,r,n,a,c,d,l,u,p,h,_,y,b,S;this._logger.info("subscribe()","mediaType: %o",i),Vr("subscribe()",e,this._logger),e.streamState=Yt.SUB_ING;let v=!1,f=!1;if(Be(i)&&(f=!0),Ve(i)&&(v=!0),!v&&this._roomConf.isMultiChatMode())return void(e.streamState=Yt.INIT);const g=ee(),Z=e.subVideo,R=[];this._subResolves[e.streamId]||(this._subResolves[e.streamId]=[]),R.push(new Promise(((J,re)=>{this._subResolves[e.streamId].push(J);const j=setTimeout((()=>re(new G(C.TIME_OUT,"wait video timeout for userId: ".concat(e.userId)))),6e4),le=pe=>{pe.mediaType==="video"&&(this._logger.info("remoteStream ".concat(e.userId," received video track")),e.off("ontrack",le),clearTimeout(j),J(0))};e.on("ontrack",le)}))),this._roomConf.isMultiChatMode()||R.push(new Promise(((J,re)=>{this._subResolves[e.streamId].push(J);const j=setTimeout((()=>re(new G(C.TIME_OUT,"wait audio timeout for userId: ".concat(e.userId)))),6e4),le=pe=>{pe.mediaType==="audio"&&(this._logger.info("remoteStream ".concat(e.userId," received audio track")),e.off("ontrack",le),clearTimeout(j),J(0))};e.on("ontrack",le)})));const T=J=>{e.ontrack(J)};(o=this._ctx.handler)===null||o===void 0||o.on("ontrack",T),this._ontrackCallbackMap.set(e,T);let X,{handler:L}=this._ctx;(r=this._ctx.serverConfig)!==null&&r!==void 0&&r.forceUniHandler||!e.enableVendorMode?X=await this._ctx.handler.subscribe(e,{multiChatMode:this._roomConf.isMultiChatMode()}):[L,X]=await this._getVendorSubSdpInfo(e,T);const{audioMid:W,videoMid:M}=X;e.subVideo=v;const k={spatialLayer:s?.spatialLayer||0,temporalLayer:0,spatialSubLayer:s?.spatialSubLayer||-1},U={audio:!this._roomConf.isMultiChatMode(),video:!0,data:!0,screen:e.isScreen,browser:"chrome-stable",videoMid:M,audioMid:W,sdpInfo:{sdp:(n=X)===null||n===void 0?void 0:n.partialSdp,semantics:(a=X)===null||a===void 0?void 0:a.semantics,type:(c=X)===null||c===void 0?void 0:c.type},streamUserId:e.userId,streamId:e.streamId,config:{enableMediaType:{audio:!!this._roomConf.isMultiChatMode()||f,video:v},qualityLayer:k},extra:{enableSendRTT:!0},peerConnectionMode:(d=X)===null||d===void 0?void 0:d.peerConnectionMode,supportMultiVendor:!0};(l=X)!==null&&l!==void 0&&l.peerConnectionId&&(U.peerConnectionId=X.peerConnectionId);const{subscribeFallbackOption:D,userPriority:ie}=this._ctx;typeof D=="number"&&(U.config.fallbackOption=D),ie.has(e.userId)&&(U.config.priority=ie.get(e.userId)),(u=X)!==null&&u!==void 0&&u.allSsrc&&(U.extra.subscribeSSRC=X.allSsrc),this.emit("_test_before_ack_");const{signalingAck:B,audioTransceiverInit:$,videoTransceiverInit:te}=X;let N;B&&(e.videoMid=M,e.audioMid=W,await new Promise(((J,re)=>{var j;(j=L)===null||j===void 0||j.handleAck({action:Se.subscribe,streamId:e.streamId,audioMid:W,videoMid:M,audioTransceiverInit:$,videoTransceiverInit:te,signalingAck:B,stream:e,onSuccess:()=>{this._logger.info("ssrc","success"),J(0)},onFail:le=>{this._logger.info("ssrc","fail",le),re(le)}})})));try{this.emit("_test_sub_body_",U);const J=this._ctx.signalingManager.sendSignaling("subscribe",U);this.emit("_test_during_signaling_",U),N=await J}catch(J){var K,x;if((K=this._ctx.monitor)===null||K===void 0||K.report("rtc_error",{message:"[subscriber._subscribe] ".concat(Si(J)),error_code:-1}),e.streamState=Yt.INIT,J instanceof Error&&this._roomConf.report("rtc_subscribe_stat",{result:"fail",start:g,message:J.message,stream_user_id:e.userId}),J.code>=500&&J.code<600){this.emit("_test_sub_5xx_");const j=this._getSubBackOff(e.streamId);var E;if(j.retryDuration<6e4)return this._logger.info("subRetry",e.streamId,j.retryDuration),await new Promise((le=>setTimeout(le,j.interval))),j.retryDuration+=j.interval,j.interval=j.interval>4e3?8e3:2*j.interval,this.emit(A.SUB_RETRY,{screen:e.isScreen,userId:e.userId}),await((E=L)===null||E===void 0?void 0:E.handleAck({action:Se.unsubscribe,streamId:e.streamId,audioMid:W,videoMid:M,stream:e})),e.resetStream(),this._subscribe(e,i,s);this._logger.info("subRetry","end",e.streamId),this._subBackOff.delete(e.streamId)}e.subVideo=Z,await((x=L)===null||x===void 0?void 0:x.rollback({msid:e.streamId,stream:e}));const re={roomId:this._roomConf.roomId,streamId:e.streamId,userId:e.userId};throw await this._ctx.signalingManager.sendSignaling("unsubscribe",re).catch((()=>{})),e.streamState=Yt.INIT,J.code===403?new G(C.TOKEN_NO_SUBSCRIBE_PERMISSION,J.message||"token no subscribe permission"):J}if(!N.relayMessage)throw this._roomConf.report("rtc_error",{error_code:-1009,message:"relayMessage is null"}),new G(C.UNEXPECTED_ERROR,"unable to subscribe");N.relayMessage.sdp=Pp(N.relayMessage.sdp);const{audioMid:q,videoMid:ce}=(p=(h=N)===null||h===void 0?void 0:h.relayMessage)!==null&&p!==void 0?p:{},se={[W]:q,[M]:ce};this._logger.info("sub midmap",e.userId,se),e.videoMid=M,e.audioMid=W,e.subMediaType=i,e.streamState=Yt.SUB_ED,e.subLayer=k,this._roomConf.report("rtc_recv_answer",{error_code:0,answer_type:(_=N)===null||_===void 0||(_=_.relayMessage)===null||_===void 0?void 0:_.type,sequence_id:((y=N)===null||y===void 0||(y=y.relayMessage)===null||y===void 0?void 0:y.sequenceId)||0,message:(b=N)===null||b===void 0||(b=b.relayMessage)===null||b===void 0?void 0:b.sdp,direction:"down",stream_id:e.streamId,stream_user_id:e.userId,pc_session_id:((S=L)===null||S===void 0?void 0:S.peerConnectionId)||""});try{var oe;(oe=X)!==null&&oe!==void 0&&oe.signalingAck||await new Promise(((J,re)=>{var j,le,pe,ge,Ce;(j=L)===null||j===void 0||j.handleAck({action:Se.subscribe,streamId:e.streamId,audioMid:W,videoMid:M,audioTransceiverInit:(le=X)===null||le===void 0?void 0:le.audioTransceiverInit,videoTransceiverInit:(pe=X)===null||pe===void 0?void 0:pe.videoTransceiverInit,signalingAck:{sdp:(ge=N)===null||ge===void 0||(ge=ge.relayMessage)===null||ge===void 0?void 0:ge.sdp,sequenceId:(Ce=N)===null||Ce===void 0||(Ce=Ce.relayMessage)===null||Ce===void 0?void 0:Ce.sequenceId},stream:e,onSuccess:()=>{this._logger.info("sub ack","success"),J(0)},onFail:Qe=>{this._logger.info("sub ack","fail",Qe),re(Qe)}})})),await Promise.all(R)}catch(J){var ne,w;(ne=this._ctx.monitor)===null||ne===void 0||ne.report("rtc_error",{message:"[subscriber._subscribe] ".concat(Si(J)),error_code:-1}),J instanceof Error&&this._roomConf.report("rtc_subscribe_stat",{result:"fail",start:g,message:J.message,stream_user_id:e.userId});const re={roomId:this._roomConf.roomId,streamId:e.streamId,userId:e.userId};throw await this._ctx.signalingManager.sendSignaling("unsubscribe",re).catch((()=>{})),await((w=L)===null||w===void 0?void 0:w.handleAck({action:Se.unsubscribe,streamId:e.streamId,audioMid:W,videoMid:M,stream:e})),e.streamState=Yt.INIT,e.resetStream(),J}this._roomConf.isMultiChatMode()||(e.subAudio=f),this._roomConf.report("rtc_subscribe_stat",{result:"success",start:g,message:"unknown",stream_user_id:e.userId}),e.startReport((J=>this.emit("onRemoteStreamStats",J)),L)}async unsubscribe(e){return this._unsubscribe(e)}async _unsubscribe(e){var i,s;Vr("unsubscribe()",e,this._logger);const o={roomId:this._roomConf.roomId,streamId:e.streamId,userId:e.userId},r=e.vendorHandler||this._ctx.handler;this._ctx.signalingManager.sendSignaling("unsubscribe",o).catch((()=>{})),e.streamState=Yt.INIT,e.subVideo=!1,(i=e.observer)===null||i===void 0||i.setSubscribeVideo(!1),!this._roomConf.isMultiChatMode()&&((s=e.observer)===null||s===void 0||s.setSubscribeAudio(!1));const n=await r?.handleAck({action:Se.unsubscribe,streamId:e.streamId,audioMid:e.audioMid,videoMid:e.videoMid,stream:e});this._subResolves[n]&&this._subResolves[n].forEach((a=>a(0))),this._logger.info("unsubscribe","clean unsub ".concat(e.userId)),e.clean(),e.subMediaType=ti.NONE,this._removeOnTrackListener(e),e.statsReport.unsubscribe()}async unsubscribe4removeTrack(e,i,s){var o,r,n,a;if(Vr("unsubscribe4removeTrack()",e,this._logger),this._logger.info("unsubscribe4removeTrack()","sequenceId: ",i.sequenceId,"trackType: ",s),i.sequenceId<e.sequenceId)return void this._logger.warn("unsubscribe4removeTrack()","sequenceId return");const c=s+1,d=!!(c&Q.AUDIO),l=!!(c&Q.VIDEO);await((o=this._ctx.handler)===null||o===void 0?void 0:o.handleAck({action:Se.removetrack,streamId:e.streamId,audioMid:e.audioMid,videoMid:e.videoMid,stream:e})),(r=e.observer)===null||r===void 0||r.setPushTrack(!1),(n=e.observer)===null||n===void 0||n.setUnmuteAudio(!d),e.subAudio=!d,(a=e.observer)===null||a===void 0||a.setUnmuteVideo(!l),e.subVideo=!l,e.subMediaType=e.subMediaType-(e.subMediaType&c),e.virtual&&(e.clean(),e.resetHasSubscribed(),e.statsReport.unsubscribe())}async handleStreamFailed(e){const i=e.subMediaType,s=e.subLayer;await this._unsubscribe(e),await this._subscribe(e,i,s)}async handleRemoveStream(e){Vr("handleRemoveStream()",e,this._logger),e.subVideo=!1,e.streamState!==Yt.INIT&&(await this._unsubscribe(e),await this._cleanStream(e),this._destroyStream(e))}_removeOnTrackListener(e){const i=this._ontrackCallbackMap.get(e);if(i){const s=e.vendorHandler||this._ctx.handler;s?.off("ontrack",i),this._ontrackCallbackMap.delete(e)}}async _getVendorSubSdpInfo(e,i){const s=new Zc(this._ctx,"");e.vendorHandler=new CI(this._ctx,s),e.pcSessionId&&(e.vendorHandler.peerConnectionId=e.pcSessionId);const o=e.vendorHandler;o.on("ontrack",i);const r=await e.vendorHandler.subscribe(e);return o.on("ice_state",(n=>{this.emit(Fe.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:fe.CONNECTION_STATE_CONNECTING,connected:fe.CONNECTION_STATE_CONNECTED,disconnected:fe.CONNECTION_STATE_RECONNECTING}[n],userId:e.userId})})),o.once("disconnect",(async()=>{var n;if(o?.removeAllListeners(),((n=this._ctx.peerConnection)===null||n===void 0?void 0:n.getIceConnectionState())!=="connected")return void this._logger.info("vendor ice failed",e.streamId);const a=e.subMediaType;await this.unsubscribe(e),await this.subscribe(e,a),e.vendorHandler&&e.statsReport.setVar(e.vendorHandler),this.emit(A.RESUBSCRIBE,{stream:e})})),[o,r]}async subscribe4pushTrack(e,i){var s,o,r;this._logger.info("subscribe4pushTrack()","streamInfo: %o",i),Vr("subscribe4pushTrack()",e,this._logger),e.subAudio=!0;const n=await((s=this._ctx.handler)===null||s===void 0?void 0:s.subscribe(e,{multiChatMode:this._roomConf.isMultiChatMode()}));if(!n)throw new G(C.ADD_TRANSCEIVER_FAILED,"add transceiver failed");const{audioMid:a}=n,{videoMid:c}=n,d=[];d.push(new Promise(((u,p)=>{const h=setTimeout((()=>p(new G(C.TIME_OUT,"wait audio timeout for userId: ".concat(e.userId)))),6e4),_=y=>{y.mediaType==="audio"&&(this._logger.success("remoteStream ".concat(e.userId," received audio track")),e.off("ontrack",_),clearTimeout(h),u(0))};e.on("ontrack",_)})));const l=u=>{e.ontrack(u)};(o=this._ctx.handler)===null||o===void 0||o.on("ontrack",l),this._ontrackCallbackMap.set(e,l),await((r=this._ctx.handler)===null||r===void 0?void 0:r.handleAck({action:Se.pushtrack,streamId:e.streamId,audioMid:a,videoMid:c,stream:e,audioTransceiverInit:n?.audioTransceiverInit,videoTransceiverInit:n?.videoTransceiverInit,signalingAck:i?.message})),await Promise.all(d),e.videoMid=c,e.audioMid=a,e.startReport((u=>this.emit("onRemoteStreamStats",u)),this._ctx.handler)}async updateUserAttributes(e){this._logger.info("updateUserAttributes()","attributes: %o",e),await this._ctx.signalingManager.sendSignaling("updateUserAttributes",{roomId:this._roomConf.roomId,sessionId:this._roomConf.sessionId,attributes:e})}async updateSubTrackLayer(e,i){if(this._logger.info("updateSubTrack()","subLayer: %o",i),e.subLayer.spatialLayer===i.spatialLayer&&e.subLayer.spatialSubLayer===i.spatialSubLayer)return void this._logger.warn("updateSubTrack()","subLayer no change");const s={roomId:this._roomConf.roomId,streamList:[e.streamId],streamId:e.streamId,streamUserId:e.userId,config:{qualityLayer:i}};return await this._ctx.signalingManager.sendSignaling("updateSubscribe",s),this.emit("___afterUpdateSubscribeSend"),e.subLayer=i,e}async updateSubPriority(e,i){if(this._logger.info("updateSubPriority()","priority: %o",i),e.priority===i)return this._logger.warn("updateSubPriority()","priority no change"),e;const s={roomId:this._roomConf.roomId,streamList:[e.streamId],streamId:e.streamId,streamUserId:e.userId,config:{priority:i}};return await this._ctx.signalingManager.sendSignaling("updateSubscribe",s),e.priority=i,e}async updateSubMediaType(e,i){var s;let o=!1,r=!1;Be(i)&&(r=!0),Ve(i)&&(o=!0);const n={roomId:this._roomConf.roomId,streamList:[e.streamId],config:{enableMediaType:{video:o,audio:!!this._roomConf.isMultiChatMode()||r}}};var a;return await this._ctx.signalingManager.sendSignaling("updateSubscribe",n),this._roomConf.isMultiChatMode()||((a=e.observer)===null||a===void 0||a.setUnmuteAudio(r),e.subAudio=r),(s=e.observer)===null||s===void 0||s.setUnmuteVideo(o),e.subVideo=o,e.subMediaType=i,e}async cleanStream(e){return this._cleanStream(e)}async _cleanStream(e){this._logger.info("cleanStream()","stream: %o",e),e?.clean()}destroyStream(e){return this._destroyStream(e)}_destroyStream(e){this._logger.info("destroyStream()","stream: %o",e),e?.destroy()}destroy(e){var i;this._logger.info("destroy()","remoteStream: %o",e),e.forEach((s=>{this.unsubscribe(s).catch((()=>{})),this.destroyStream(s)})),this._subBackOff.clear(),this._ontrackCallbackMap.forEach(((s,o)=>{this._removeOnTrackListener(o),this._ontrackCallbackMap.delete(o)})),this._subResolves={},(i=this._ctx.handler)===null||i===void 0||i.removeAllListeners("ontrack"),super.removeAllListeners()}_getSubBackOff(e){return this._subBackOff.has(e)||this._subBackOff.set(e,{interval:1e3,retryDuration:0}),this._subBackOff.get(e)}}jt([je],xt.prototype,"hasSubscribed"),jt([je,Hi,me],xt.prototype,"subscribe"),jt([je,Hi,me],xt.prototype,"unsubscribe"),jt([je,Hi,me],xt.prototype,"unsubscribe4removeTrack"),jt([je],xt.prototype,"handleStreamFailed"),jt([je,me],xt.prototype,"handleRemoveStream"),jt([je,Hi,me],xt.prototype,"subscribe4pushTrack"),jt([je,me],xt.prototype,"updateUserAttributes"),jt([je,me],xt.prototype,"updateSubTrackLayer"),jt([je,me],xt.prototype,"updateSubPriority"),jt([je],xt.prototype,"updateSubMediaType"),jt([je],xt.prototype,"cleanStream"),jt([je],xt.prototype,"destroyStream");const sv={[Xt.communication]:[0],[Xt.chat]:[0],[Xt.chatRoom]:[1,"IES_chatroom"],[Xt.coHost]:[1,"IES_PK"],[Xt.meeting]:[16],[Xt.classRoom]:[0]};class Qr extends Vt{constructor(e,i){super(),m(this,"_logger",void 0),m(this,"_authorization",void 0),m(this,"_joinRoom5xxTimer",void 0),m(this,"_joinTask",void 0),m(this,"_sdpInfo",void 0),this._ctx=e,this._roomConf=i,this._logger=new ue("RoomJoin",2,e.id),this._logger.info("constructor","invoke")}join(){let e,i,s=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._roomConf.report("rtc_join_room_phase",{message:"call_roomjoin_join_api"}),this._logger.info("join()"),this._roomConf.report("rtc_join_room_phase",{message:"create_join_promise"});const o=new Promise(((r,n)=>{this._roomConf.report("rtc_join_room_phase",{message:"set_joinRsolve_joinReject"}),e=r,i=n;try{this._callJoinRoom(s).catch((a=>{this._roomConf.report("rtc_join_room_phase",{message:"_callJoinRoom_promise_reject",error:JSON.stringify(a)});const c=Array.isArray(a)&&a.length>0?a[0]:a;this._joinRoomFailed(c.message)}))}catch(a){this._roomConf.report("rtc_join_room_phase",{message:"_callJoinRoom_throw_error",error:JSON.stringify(a)});const c=Array.isArray(a)&&a.length>0?a[0]:a;this._joinRoomFailed(c.message)}}));return this._joinTask&&s?this._joinTask.startTime=ee():(this._roomConf.report("rtc_join_room_phase",{message:"reset_joinTask"}),this._joinTask={startTime:ee(),success:e,fail:i},this._roomConf.joinPromise=o),this._reportJoinRoomStart(),this._roomConf.report("rtc_join_room_phase",{message:"return_joinPromise"}),o}async updateToken(e){if(this._logger.info("updateToken()","newToken: %o",e),!this._ctx.appId||!this._roomConf.userId||!this._roomConf.roomId)return;const i={roomId:this._roomConf.roomId,userId:this._roomConf.userId,appId:this._ctx.appId,token:"Bearer ".concat(e)};try{await this._ctx.signalingManager.sendSignaling("updateToken",i)}catch{throw new G(C.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token")}}async leave(){this._logger.info("leave()"),this._stopJoinRoom5xxRetry(),this._joinRoomFailed("leave_room");const e={Authorization:this._authorization,roomId:this._roomConf.roomId,sessionId:this._roomConf.sessionId};if(await this._ready2join(),!this._ctx.signalingManager.isConnected())return Promise.reject(new G(C.NOT_CONNECTED_YET,"server not connected"));await this._ctx.signalingManager.sendSignaling("leaveRoom",e,this._roomConf.rtsOnlySignalHeader)}destroy(){this._logger.info("destroy()"),this._joinRoomFailed("leave_room"),this._authorization=void 0,this._stopJoinRoom5xxRetry(),this.removeAllListeners()}async _ready2join(){var e,i;if(this._roomConf.report("rtc_join_room_phase",{message:"into_ready2join"}),await this._ctx.signalingManager.connect(),this._roomConf.report("rtc_join_room_phase",{message:"connect to signaling server"}),this._sdpInfo||(this._sdpInfo=await((i=this._ctx.handler)===null||i===void 0?void 0:i.getDefaultSdp())),this._roomConf.report("rtc_join_room_phase",{message:"get sdpInfo"}),!Qr.supportedCodecs){const s=[];(await Ca()).forEach((o=>{const r=pY(o);r&&s.push(r)})),Qr.supportedCodecs=s}return lo.videoPayloadMap||(lo.videoPayloadMap=bY(this._sdpInfo.sdp)),(e=this._sdpInfo)!==null&&e!==void 0&&e.sdp&&(this._sdpInfo.sdp=VT(this._sdpInfo.sdp)),this._roomConf.report("rtc_join_room_phase",{message:"get supportedCodecs"}),{sdpInfo:this._sdpInfo,supportedCodecs:Qr.supportedCodecs}}async _callJoinRoom(e){try{var i,s,o,r,n,a,c,d,l,u;this._roomConf.report("rtc_join_room_phase",{message:"enter_callJoinRoom"}),this._logger.info("_callJoinRoom","invoke"),delete this._sdpInfo;const{appId:b,role:S,businessId:v,useCloudProxy:f,joinRoomParams:g,mediaParams:Z}=this._ctx,{sdpInfo:R,supportedCodecs:T}=await this._ready2join();this._roomConf.report("rtc_join_room_phase",{message:"finish_ready2join"});const X={Authorization:$e.token2auth(b,this._roomConf.roomId,this._roomConf.userId,this._roomConf.token),sessionId:this._roomConf.sessionId,timestamp:Date.now(),controlMessage:this._roomConf.getLiveControlMessage(),userAttributes:{extra_info:this._roomConf.userInfo.extraInfo,role:S},sdpInfo:R,params:{supportedCodecs:T,userAgent:window.navigator.userAgent,sdkVersion:de.VERSION,deviceId:We.getDeviceId(),appId:b,roomId:this._roomConf.roomId,userId:this._roomConf.userId,businessId:v,enableCloudProxy:f,channelProfile:sv[this._roomConf.roomProfileType]?"".concat(sv[this._roomConf.roomProfileType][0]):"0",SDKCodecNegotiation:ae("SDK_CODEC_NEGOTIATION"),sdkType:"rtc",joinRoomMode:this._roomConf.isRTSOnlyRoom()?2:1,deviceType:"web",rtsMode:this._ctx.rtsMode,mediaProcessingType:(i=de.MEDIA_PROCESSING_TYPE)!==null&&i!==void 0?i:0},options:{supportCheckTokenPrivilege:!0,supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0},accessParams:JSON.stringify({requireICEUfragV2:!0})};if(ae("AREA_CODE")==="AREA_CODE_US_OPCO"&&(X.params.mediaArea=JSON.stringify([{AreaList:["GEO:US_OPCO"],Attribute:"include"}])),this._roomConf.report("rtc_join_room_phase",{message:"get_request_body"}),g)for(const[U,D]of Object.entries(g))X.params[U]=D;Z&&(X.mediaParams=Z),ae("SIGNAL_CROP_JOINROOM")&&(s=X.sdpInfo)!==null&&s!==void 0&&s.sdp&&(X.sdpInfo.sdp=ZO(X.sdpInfo.sdp)),this._roomConf.report("rtc_join_room_phase",{message:"finish_request_body"}),Promise.resolve().then((()=>this.emit("onSendingJoinMessageHook"))),this._roomConf.report("rtc_join_room_phase",{message:"finish_onSendingJoinMessageHook"});const L=e?"reconnected":"joinRoom",W=await this._joinRoomWithRetry(L,X);this._roomConf.report("rtc_join_room_phase",{message:"got_joinRes"}),this._logger.success("join","send join message success");const{_abtest_vid:M}=W.config||{};let{engine_WEB:k}=W.config||{};var p,h,_;this._authorization=X.Authorization,We.setEngineWebConfig(this._ctx.appId,this._roomConf.roomId,k),k=Object.assign({},ae("ENGINE_WEB_CONFIG"),k),this._ctx.serverConfig={videoCodec:(o=k)===null||o===void 0?void 0:o.video_codec,audioRed:!((r=k)===null||r===void 0||!r.pub_audio_red),muteReplaceUnsub:!((n=W.config)===null||n===void 0||!n.mute_replace_unsub),simulcastOnDemand:((a=W.config)===null||a===void 0||(a=a.engine_VPM)===null||a===void 0||(a=a.ondemand)===null||a===void 0?void 0:a.enable)!==!1,forceUniHandler:((c=W.config)===null||c===void 0||(c=c.vendor_param)===null||c===void 0?void 0:c.vendor_stream_sub_mode)===1,e2eFeedback:(d=k)===null||d===void 0?void 0:d.e2e_feedback},ae("SDK_CODEC_NEGOTIATION")&&(this._ctx.setTargetCodec((p=W.config)===null||p===void 0?void 0:p.targetCodec),this._ctx.setTargetScreenCodec((h=W.config)===null||h===void 0?void 0:h.targetScreenCodec)),typeof((l=k)===null||l===void 0?void 0:l.av_sync)=="boolean"&&(this._ctx.avSync=k.av_sync),this._roomConf.rtcVid=M,W.vendorConfig&&this._roomConf.setVendorConfig(W.vendorConfig),Rt.setAudioStallConfig(k),(u=W.relayMessage)!==null&&u!==void 0&&u.sdp&&(W.relayMessage.sdp=Pp(W.relayMessage.sdp),(_=this._ctx.handler)===null||_===void 0||_.createAVMlineAnswerTpl(W.relayMessage.sdp)),this.emit(A.JOIN_SUCCESS,{joinRes:W,reconnect:e}),this._joinRoomSuccess(W)}catch(b){var y;(y=this._ctx.monitor)===null||y===void 0||y.report("rtc_error",{message:"[join._callJoinRoom] ".concat(Si(b)),error_code:-1}),this._roomConf.report("rtc_join_room_phase",{message:"_callJoinRoom_catch",error:JSON.stringify(b)});const S={461:C.ROOM_FORBIDDEN,462:C.USER_FORBIDDEN};b?.code>=700&&b?.code<800?this._joinRoomFailed("token_error",C.INVALID_TOKEN):S[b?.code]?this._joinRoomFailed(b?.message||S[b?.code],S[b?.code]):b?.code===C.TIME_OUT&&this._ctx.joinRoomConfig.useTcpAfterJoinTimeout?(this._logger.error("join",ut.JOIN_TIMEOUT),this.safeEmit(A.ON_REJOIN_WITH_TCP),this._ctx.signalingManager.reconnect(ut.JOIN_TIMEOUT,!0)):b.code===C.OPERATION_CANCEL&&this._ctx.signalingManager.isReconnecting()||this._joinRoomFailed(b?.message||"signaling_error")}}_joinRoomWithRetry(e,i,s){return new Promise(((o,r)=>{this._ctx.signalingManager.sendSignaling(e,i,this._roomConf.rtsOnlySignalHeader,1e4).then((n=>{this.emit("onJoinRoomAck",n),o(n)})).catch((n=>{if(s=s||new WT,n.code>=500&&n.code<600&&ee()-s.initTs<6e4){const a=s.getRetryDelay();return this._logger.warn("_joinRoomWithRetry","joinRoom failed(code: ".concat(n.code,"), will retry after ").concat(a,"ms")),void(this._joinRoom5xxTimer=setTimeout((()=>{delete this._joinRoom5xxTimer,this._joinRoomWithRetry(e,i,s).then(o).catch(r)}),a))}r(n)}))}))}_stopJoinRoom5xxRetry(){this._joinRoom5xxTimer&&(clearTimeout(this._joinRoom5xxTimer),delete this._joinRoom5xxTimer)}_reportJoinRoomStart(){this._roomConf.report("rtc_join_room_phase",{message:"enter _reportJoinRoomStart"}),this._joinTask&&(this.emit("__joinRoomStartReport"),this._roomConf.report("join_room",{type:"begin",start:this._joinTask.startTime,result:!1,reason:""},{enable_cloud_proxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC}))}_joinRoomSuccess(e){this._roomConf.report("rtc_join_room_phase",{message:"enter _joinRoomSuccess"}),this._joinTask&&(this._joinTask.success(e),this.emit("__joinRoomSuccessReport"),this._roomConf.report("join_room",{type:"end",start:this._joinTask.startTime,result:!0,reason:""},{enable_cloud_proxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC}),this._roomConf.report("rtc_join_room",{error_code:0,deviceModel:"web",deviceManufacturer:"web",elapse:ee()-this._joinTask.startTime}),delete this._joinTask,delete this._roomConf.joinPromise)}_joinRoomFailed(e,i){this._roomConf.report("rtc_join_room_phase",{message:"enter _joinRoomFailed"}),this._joinTask&&(this._joinTask.fail(new G(i||C.JOIN_ROOM_FAILED,e)),this.emit("__joinRoomFailedReport"),this._roomConf.report("join_room",{type:"end",start:this._joinTask.startTime,result:!1,reason:e},{enable_cloud_proxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC}),delete this._joinTask,delete this._roomConf.joinPromise)}}m(Qr,"supportedCodecs",void 0);var W3=Object.defineProperty,G3=Object.getOwnPropertyDescriptor,Gm=(t,e,i,s)=>{for(var o,r=G3(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&W3(e,i,r),r};class ec{constructor(e,i){m(this,"_logger",void 0),this._ctx=e,this._roomConf=i,this._logger=new ue("RoomMessage",2,e.id)}sendUserMessage(e,i){return this._ctx.signalingManager.sendP2PMessage({to:e,from:this._roomConf.userId,room:this._roomConf.roomId,app:this._ctx.appId,msg:i})}async sendRoomMessage(e,i){const s={clientId:this._roomConf.userId,binary:i,message:"",roomId:this._roomConf.roomId};return s.message=i?await $e.ab2b64str(e):e,this._ctx.signalingManager.sendSignaling("customMessage",s,this._roomConf.rtsOnlySignalHeader)}async controlMessage(e){this._logger.info("controlMessage()","params: %o",e);const i=e;e.type==="transcode"&&(i.roomId=this._roomConf.roomId),await this._ctx.signalingManager.sendSignaling("controlMessage",i)}}Gm([me],ec.prototype,"sendUserMessage"),Gm([me],ec.prototype,"sendRoomMessage"),Gm([me],ec.prototype,"controlMessage");var V3=Object.defineProperty,E3=Object.getOwnPropertyDescriptor,we=(t,e,i,s)=>{for(var o,r=E3(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&V3(e,i,r),r};const ov={audiostream:!0,extaudio:!1,extvideo:!1,localaudio:!0,localvideo:!1,videoDescriptions:[],videostream:!1,publishTime:0};class Pe extends Vt{constructor(e,i){super(),m(this,"_localStream",void 0),m(this,"_localScreenStream",void 0),m(this,"_remoteUsers",new Map),m(this,"_remoteStreams",new Map),m(this,"_remoteStreamStreamIdUserIdMap",{}),m(this,"_virtualStreams",[]),m(this,"_serverConfig",void 0),m(this,"_userDuplicateLoginTimerMap",new Map),m(this,"_networkQualityManager",void 0),m(this,"_videoSizeObserver",void 0),m(this,"_hasPublished",!1),m(this,"_subtitleTool",void 0),m(this,"_csrcUserIdMap",{}),m(this,"_publishOnDemandItem",void 0),m(this,"_onceTriggerBySignal",!1),m(this,"_pubTransceiverReady",!1),m(this,"_publishOnDemandBusy",!1),m(this,"logger",void 0),m(this,"_forwardStreamManager",void 0),m(this,"_publisher",void 0),m(this,"_subscriber",void 0),m(this,"_roomJoin",void 0),m(this,"_roomMessage",void 0),m(this,"_clearSignalListeners",void 0),this.config=e,this._ctx=i,this.logger=new ue("Room",1,i.id),this.logger.info("constructor","invoke"),this._publisher=new _s(i,e),this._addPublisherListeners(),this._subscriber=new xt(i,e),this._addSubscriberListeners(),this._roomJoin=new Qr(i,e),this._addJoinRoomHandler(),this._forwardStreamManager=new Er(i,e),this._addForwardStreamListeners(),this._roomMessage=new ec(i,e),this._networkQualityManager=new b3(i),this._networkQualityManager.reportor=this._reportNetworkQuality.bind(this),this._videoSizeObserver=new y3(this),this._videoSizeObserver.onchange=this._emitVideoSizeChange.bind(this),this._addSignalListeners()}get remoteUsers(){return this._remoteUsers}get remoteStreams(){return this._remoteStreams}get localStream(){return this._localStream}get localScreenStream(){return this._localScreenStream}get virtualStreams(){return this._virtualStreams}_addSignalListeners(){const e={[O.ON_ADD_STREAM]:this._onAddStream.bind(this),[O.ON_ADD_STREAM_LIST]:i=>{i&&Array.isArray(i.streamList)&&i.streamList.forEach((s=>this._onAddStream(s)))},[O.ON_REMOVE_STREAM]:this._onRemoveStream.bind(this),[O.ON_REMOVE_STREAM_LIST]:i=>{i&&Array.isArray(i.streamList)&&i.streamList.forEach((s=>this._onRemoveStream(s)))},[O.USER_CONNECTION]:this._onUserConnection.bind(this),[O.USER_CONNECTION_LIST]:i=>{i&&Array.isArray(i.userList)&&i.userList.forEach((s=>this._onUserConnection(s)))},[O.USER_DISCONNECTION]:this._onUserDisconnection.bind(this),[O.USER_DISCONNECTION_LIST]:i=>{i&&Array.isArray(i.userList)&&i.userList.forEach((s=>this._onUserDisconnection(s)))},[O.ON_UPDATE_ROOM_ATTRIBUTES]:this._onUpdateRoomAttributes.bind(this),[O.ON_UPDATE_USER_ATTRIBUTES]:this._onUpdateUserAttributes.bind(this),[O.ON_UPDATE_STREAM_ATTRIBUTES]:this._onUpdateStreamAttributes.bind(this),[O.ON_PUSH_TRACK]:this._onPushTrack.bind(this),[O.ON_REMOVE_TRACK]:this._onRemoveTrack.bind(this),[O.ON_CUSTOM_MESSAGE]:this._onCustomMessage.bind(this),[O.USER_MESSAGE_RECEIVED]:this._onUserMessageReceived.bind(this),[O.USER_BINARY_MESSAGE_RECEIVED]:this._onUserBinaryMessageReceived.bind(this),[O.POST_PROCESSING_MESSAGE]:this._onPostProcessingMessage.bind(this),[O.ON_USER_TOKEN_WILL_EXPIRE]:this._onUserTokenWillExpire.bind(this),[O.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE]:this._onUserTokePublishPrivilegeWillExpire.bind(this),[O.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED]:this._onUserTokenPublishPrivilegeDidExpire.bind(this),[O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE]:this._onUserTokeSubscribePrivilegeWillExpire.bind(this),[O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED]:this._onUserTokenSubscribePrivilegeDidExpire.bind(this),[O.STREAM_CONTROL_MESSAGE]:this._onStreamControlMessage.bind(this),[O.ENGINE_CONTROL_MESSAGE]:this._onEngineControlMessage.bind(this),[O.ON_STREAM_FAILED]:this._onStreamFailed.bind(this),[ds.RTT]:this._onRTT.bind(this),[ds.SSC]:this._onSSC.bind(this),[Fe.ON_CONNECTION_STATE_CHANGE]:this._onConnectionStateChange.bind(this),[O.ON_SPEAKER_CHANGE]:this._onMeetingSpeakerChange.bind(this),[O.ON_FORWARD_DST_ROOM_USER_KICK]:this._forwardStreamManager.onForwardDstRoomUserKick.bind(this._forwardStreamManager),[ds.RSCP]:this._onRSCP.bind(this)};Object.keys(e).forEach((i=>{this._ctx.signalingManager.on(i,e[i])})),this._clearSignalListeners=()=>{Object.keys(e).forEach((i=>{this._ctx.signalingManager.off(i,e[i])}))}}_addPublisherListeners(){this._publisher.on(A.PUB_RETRY,(e=>{this.emit(A.PUB_RETRY,e)})),this._publisher.on(ds.RSCP,this._onRSCP.bind(this)),this._publisher.on(Fe.ON_VENDOR_CONNECTION_STATE_CHANGE,(e=>this.emit(Fe.ON_VENDOR_CONNECTION_STATE_CHANGE,e)))}_addSubscriberListeners(){this._subscriber.on(Fe.ON_VENDOR_CONNECTION_STATE_CHANGE,(e=>this.emit(Fe.ON_VENDOR_CONNECTION_STATE_CHANGE,e))),this._subscriber.on("onRemoteStreamStats",(e=>{this._networkQualityManager.updateDownlinkStats(e,this._findRemoteStreamByScreen(e.userId,e.isScreen)),ae("HIDDEN_STATS")||(e=Kt(e)),this.emit(A.ON_REMOTE_STREAM_STATS,e)})),this._subscriber.on(A.RESUBSCRIBE,(e=>{this.emit(A.RESUBSCRIBE,e)})),this._subscriber.on(A.SUB_RETRY,(e=>{this.emit(A.SUB_RETRY,e)}))}_addJoinRoomHandler(){this._roomJoin.on(A.JOIN_SUCCESS,this._onJoinSucc.bind(this)),this._roomJoin.on(A.ON_REJOIN_WITH_TCP,(()=>{this.emit(A.ON_REJOIN_WITH_TCP)}))}_addForwardStreamListeners(){this._forwardStreamManager.on(A.ON_FORWARD_STREAM_ERROR,(e=>{this.safeEmit(A.ON_FORWARD_STREAM_ERROR,e)}))}_onLocalStreamStats(e){const i=e.isScreen?this._localScreenStream:this.localStream;this._networkQualityManager.updateUplinkStats(e,i),ae("HIDDEN_STATS")||(e=Kt(e)),this.emit(A.ON_LOCAL_STREAM_STATS,e)}async join(){this.logger.info("join()"),this.config.startJoinTimestamp=ee();try{var e;const s=await this._roomJoin.join();return this._ctx.callId=s.callId,(e=s.roomAttributes)!==null&&e!==void 0&&e.multiChatMode&&this._handleFFAudioTrack(),this._initSubtitleTool(),{users:s.clients,streams:s.streams}}catch(s){var i;if((i=this._ctx.monitor)===null||i===void 0||i.report("rtc_error",{message:"[room.join] ".concat(Si(s)),error_code:-1}),s.code!==C.OPERATION_CANCEL)throw s}}async hasScreenPublished(){return!!this._localScreenStream&&this._publisher.hasPublished(this._localScreenStream)}async hasPublished(){return!!this._localStream&&this._publisher.hasPublished(this._localStream)}async publishScreen(e,i,s,o){this.logger.info("publishScreen()"),this._localScreenStream||(this._localScreenStream=new un(this._ctx,V.STREAM_INDEX_SCREEN),this._localScreenStream.on("stats-exception",(y=>{this.emit(A.ON_LOCAL_STATS_EXCEPTION,I(I({},y),{},{isScreen:!0}))})),this.config.vendorConfig.enableMultiVendor&&(this._localScreenStream.pcSessionId=Wt()),this._localScreenStream.isScreen=!0,this._localScreenStream.observer=new Yh(this._ctx,this._localScreenStream));let r=!1,n=!1,a=!1,c=!1;!this._localScreenStream.videoTrack&&e?(e.sourceType===Ne.EXTERNAL&&(n=!0),r=!0):this._localScreenStream.videoTrack&&!e&&(r=!1),!this._localScreenStream.audioTrack&&i?(i.sourceType===Ne.EXTERNAL&&(c=!0),a=!0):this._localScreenStream.audioTrack&&!i&&(a=!1),this._localScreenStream.videoTrack=e,this._localScreenStream.audioTrack=i,s&&(Be(s)&&(this._localScreenStream.pubAudio=o===Ot.PUB),Ve(s)&&(this._localScreenStream.pubVideo=o===Ot.PUB),this.logger.info("publishScreen mediaType","pubAudio: %o, pubVideo: %o",this._localScreenStream.pubAudio,this._localScreenStream.pubVideo));const d=await this._publisher.hasPublished(this._localScreenStream);if(!this._localScreenStream.pubAudio&&!this._localScreenStream.pubVideo)return d?this.unpublishScreen():void 0;if(d){var l,u,p,h;n?(l=this._localScreenStream.observer)===null||l===void 0||l.setPushVideo(r):(u=this._localScreenStream.observer)===null||u===void 0||u.setEnableVideo(r),c?(p=this._localScreenStream.observer)===null||p===void 0||p.setPushAudio(a):(h=this._localScreenStream.observer)===null||h===void 0||h.setEnableAudio(a),await this.updatePubScreenTrack()}else{var _;(_=this._localScreenStream.observer)===null||_===void 0||_.setPublish(!0),await this._publisher.publish(this._localScreenStream)}this._localScreenStream.pubAudio||this._localScreenStream.pubVideo?this._ctx.handler&&this._localScreenStream.startReport(this._onLocalStreamStats.bind(this),this._localScreenStream.vendorHandler||this._ctx.handler):this._localScreenStream.stopReport("unpublish screen")}async updatePubScreenTrack(){this.logger.info("updatePubScreenTrack","Invoke updatePubScreenTrack"),this._localScreenStream&&await this._publisher.updatePubTrack(this._localScreenStream)}async unpublishScreen(){var e;this.logger.info("unpublish","Invoke unpublishScreen"),this._localScreenStream&&((e=this._localScreenStream.observer)===null||e===void 0||e.setPublish(!1),await this._publisher.unpublish(this._localScreenStream),this._localScreenStream.stopReport("unpublish screen"),await this._publisher.cleanStream(this._localScreenStream),this._localScreenStream=void 0)}async liveControlMessage(e){var i;this.logger.info("controlMessage","Invoke controlMessage"),(i=e.transcodeMeta)===null||i===void 0||i.layout.regions.forEach((s=>{s.roomID=this.config.roomId})),this.config.setLiveControlMessage(e.action==="stopped"?void 0:e);try{await this._roomMessage.controlMessage(e)}catch(s){if(e.action!=="stopped")throw s}}async publicStreamControlMessage(e){e.action==="stopped"&&delete e.publicStreamMeta,await this._roomMessage.controlMessage(e)}getLocalStreamStats(){var e;return(e=this.localStream)===null||e===void 0?void 0:e.getLocalStreamStats()}async updateUserAttributes(){this.logger.info("updateUserAttributes","Invoke updateUserAttributes"),await this._subscriber.updateUserAttributes({role:this._ctx.role})}async publish(e,i,s,o){let r=arguments.length>4&&arguments[4]!==void 0&&arguments[4];this.logger.info("publish","Invoke publish");let n=!1;this._localStream||(this._localStream=new un(this._ctx),this._localStream.on("stats-exception",(v=>{this.emit(A.ON_LOCAL_STATS_EXCEPTION,I(I({},v),{},{isScreen:!1}))})),this.config.vendorConfig.enableMultiVendor&&(this._localStream.pcSessionId=Wt()),this._localStream.observer=new Yh(this._ctx,this._localStream),n=!0,this._localStream.vendorCode=this.config.vendorConfig.vendorCode||0),this._localStream.videoTrack=e,this._localStream.audioTrack=i;const{pubAudio:a,pubVideo:c}=this._localStream;if(s&&(Be(s)&&(this._localStream.pubAudio=o===Ot.PUB),Ve(s)&&(this._localStream.pubVideo=o===Ot.PUB),this.logger.info("publish mediaType","pubAudio: %o, pubVideo: %o",this._localStream.pubAudio,this._localStream.pubVideo)),await this._publisher.hasPublished(this._localStream))try{this.emit("___onMediaServerClientPublish"),await this.updatePubTrack()}catch(v){throw this._localStream.pubAudio=a,this._localStream.pubVideo=c,v}else{if(!this._localStream.pubAudio&&!this._localStream.pubVideo)return;try{var d;if(r)(d=this._localStream.observer)===null||d===void 0||d.setLogin(!0);else if(n){var l,u;const v=!!this._localStream.videoTrack,f=!!this._localStream.audioTrack,g=((l=this._localStream.videoTrack)===null||l===void 0?void 0:l.sourceType)===Ne.EXTERNAL,Z=((u=this._localStream.audioTrack)===null||u===void 0?void 0:u.sourceType)===Ne.EXTERNAL;if(this.config.isAutoPublish&&!this._hasPublished){var p,h,_,y;v&&(g?(p=this._localStream.observer)===null||p===void 0||p.setPushVideo(!0):(h=this._localStream.observer)===null||h===void 0||h.setEnableVideo(!0)),f&&(Z?(_=this._localStream.observer)===null||_===void 0||_.setPushAudio(!0):(y=this._localStream.observer)===null||y===void 0||y.setEnableAudio(!0))}else{var b;(b=this._localStream.observer)===null||b===void 0||b.setPublish(!0)}}this.emit("___onMediaServerClientPublish"),await this._publisher.publish(this._localStream),this._hasPublished=!0,this.emit(A.ON_PUBLISH_RESULT,{isScreen:!1,state:es.PUBLISH_SUCC})}catch(v){var S;throw(S=this._ctx.monitor)===null||S===void 0||S.report("rtc_error",{message:"[room.publish] ".concat(Si(v)),error_code:-1}),this.emit(A.ON_PUBLISH_RESULT,{isScreen:!1,state:es.PUBLISH_FAIL,errorCode:v.code}),delete this._localStream,v}}this._localStream.pubAudio||this._localStream.pubVideo?this._ctx.handler&&this._localStream.startReport(this._onLocalStreamStats.bind(this),this._localStream.vendorHandler||this._ctx.handler):this._localStream.stopReport("unpublish")}async updatePubTrack(){if(this.logger.info("updatePubTrack","Invoke updatePubTrack"),this._localStream)try{await this._publisher.updatePubTrack(this._localStream)}catch(i){var e;throw(e=this._ctx.monitor)===null||e===void 0||e.report("rtc_error",{message:"[room.updatePubTrack] ".concat(Si(i)),error_code:-1}),i}}async unpublish(){if(this.logger.info("unpublish","Invoke unpublish"),this._localStream)try{await this._publisher.unpublish(this._localStream),this._localStream.stopReport("unpublish"),await this._publisher.cleanStream(this._localStream),this._localStream=void 0}catch(i){var e;throw(e=this._ctx.monitor)===null||e===void 0||e.report("rtc_error",{message:"[room.unpublish] ".concat(Si(i)),error_code:-1}),i}}async subscribe(e,i){if(this.logger.info("subscribe","remoteStream %o",e),await this._subscriber.hasSubscribed(e)){const r=e.subMediaType|i;return r!==e.subMediaType?await this._subscriber.updateSubMediaType(e,r):void 0}const s=this._ctx.videoProfile.getSubLayer(e,this.config.remoteVideoConfig);try{await this._subscriber.subscribe(e,i,s)}catch(r){var o;throw(o=this._ctx.monitor)===null||o===void 0||o.report("rtc_error",{message:"[room.subscribe] ".concat(Si(r)),error_code:-1}),r}}async updateSubVideoConfig(e){var i;const s=this._findRemoteStreamByScreen(e,!1);if(this.logger.info("updateSubVideoConfig","userId %s",e),!s||!await this._subscriber.hasSubscribed(s)||((i=s.attributes)===null||i===void 0||(i=i.videoDescriptions)===null||i===void 0?void 0:i.length)<=1)return;const o=this._ctx.videoProfile.getSubLayer(s);return o?(s.originalStreamIndex=o.spatialLayer,this._subscriber.updateSubTrackLayer(s,o)):void 0}async unsubscribe(e,i){this.logger.info("unsubscribe","Invoke unsubscribe");try{var s;if(!await this._subscriber.hasSubscribed(e))return;const r=e.subMediaType-(e.subMediaType&i);if(((s=this._ctx.serverConfig)===null||s===void 0||!s.muteReplaceUnsub)&&(r===ti.NONE||this.config.isMultiChatMode()&&r===Q.AUDIO))return await this._subscriber.unsubscribe(e);await this._subscriber.updateSubMediaType(e,r)}catch(r){var o;throw(o=this._ctx.monitor)===null||o===void 0||o.report("rtc_error",{message:"[room.unsubscribe] ".concat(Si(r)),error_code:-1}),r}}async startSubtitle(e){if(!this._subtitleTool)throw new G(C.INVOKED_BEFORE_JOIN_ROOM,"join first");await this._subtitleTool.start(e)}async updateSubtitleConfig(e){if(!this._subtitleTool)throw new G(C.INVOKED_BEFORE_JOIN_ROOM,"join first");await this._subtitleTool.update(e)}async stopSubtitle(){var e;(e=this._subtitleTool)===null||e===void 0||e.stop()}async startForwardStream2Rooms(e){return this._forwardStreamManager.startForwardStream2Rooms(e)}async updateForwardStream2Rooms(e){return this._forwardStreamManager.updateForwardStream2Rooms(e)}async stopForwardStream2Rooms(){return this._forwardStreamManager.stopForwardStream2Rooms()}async pauseForwardStream2AllRooms(){return this._forwardStreamManager.pauseForwardStream2AllRooms()}async resumeForwardStream2AllRooms(){return this._forwardStreamManager.resumeForwardStream2AllRooms()}async updateMediaParams(e){return this._ctx.signalingManager.sendSignaling("updateMediaParams",{roomId:this.config.roomId,mediaParams:e})}async leave(){var e;let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.logger.info("leave","Invoke leave"),(e=this._subtitleTool)===null||e===void 0||e.destroy(),delete this._subtitleTool;try{for(const r of this._remoteStreams.values())Array.isArray(r)&&r.forEach((n=>{var a;(a=n.observer)===null||a===void 0||a.setLogin(!1)}));var s;this._localStream&&((s=this._localStream.observer)===null||s===void 0||s.setLogin(!1)),await this._roomJoin.leave().catch((()=>{})),this.destroy(),this.config.report("rtc_leave_room",{error_code:0,message:"",elapse:this.config.getStayRoomDuration()})}catch(r){var o;if((o=this._ctx.monitor)===null||o===void 0||o.report("rtc_error",{message:"[room.leave] ".concat(Si(r)),error_code:-1}),r instanceof Error&&this.config.report("rtc_leave_room",{error_code:-1,message:r.message,elapse:this.config.getStayRoomDuration()}),i)throw r;this.destroy()}}updateRemoteUserPriority(e){var i;(i=this.remoteStreams.get(e))===null||i===void 0||i.forEach((s=>{const{userPriority:o}=this._ctx;s.hasSubscribed&&o.has(e)&&this._subscriber.updateSubPriority(s,o.get(e))}))}destroy(){var e,i,s;this.logger.info("destroy","Invoke destroy"),ye(this._ctx.id,"room_destroy","".concat(new Error().stack)),(e=this._subtitleTool)===null||e===void 0||e.destroy(),delete this._subtitleTool;const o=Bg(i=Array.from(this._remoteStreams.values())).call(i);this._subscriber.destroy(o),this._subscriber.destroy(this._virtualStreams),this._publisher.destroy([this.localStream,this.localScreenStream]),this._roomJoin.destroy(),(s=this._clearSignalListeners)===null||s===void 0||s.call(this),this._remoteUsers=new Map,this._remoteStreams=new Map,this._localStream&&(this._localStream=void 0),this._localScreenStream&&(this._localScreenStream=void 0),this._userDuplicateLoginTimerMap.forEach((r=>{clearTimeout(r)})),this._userDuplicateLoginTimerMap.clear(),this._networkQualityManager.destroy(),this._videoSizeObserver.destroy(),this._csrcUserIdMap={},this._virtualStreams=[],this._remoteStreamStreamIdUserIdMap={},this._forwardStreamManager.destoy()}async updateToken(e){if(this.logger.info("updateToken","Invoke updateToken"),this.config.token=e,!this.config.isRTSOnlyRoom())try{await this._roomJoin.updateToken(e)}catch(i){throw this.safeEmit(A.ON_ROOM_ERROR,{errorCode:C.UPDATE_TOKEN_WITH_INVALID_TOKEN}),i}}sendUserMessage(e,i){return this._ctx.rtsLimiter.e2e.check(i),this._roomMessage.sendUserMessage(e,i)}sendRoomMessage(e){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this._ctx.rtsLimiter.boradcast.check(e),this._roomMessage.sendRoomMessage(e,i)}async maybeFillBackFrame2Stream(e){var i;e.refreshBlackFrameLifetime(),(i=e.videoTransceiver)!==null&&i!==void 0&&i.sender.track||this._publisher.updatePubBlackFrame(e)}_onJoinSucc(e){var i,s;let{joinRes:o,reconnect:r}=e;this.logger.info("_onJoinSucc()","invoke. ".concat(r?"[reconnect]":"")),this.emit(A.JOIN_SUCCESS,r),this._serverConfig=o.config,this.config.updateRoomAttributes(o.roomAttributes);const n=[],a=[],c=[],d=[],l=[];this.config.isRTSOnlyRoom()&&Array.isArray(o.userInfos)&&(o.clientsDetail=o.userInfos.map((u=>({clientId:u.userId,clientJoinTime:u.userJoinTime})))),(i=o.clientsDetail)===null||i===void 0||i.forEach((u=>{if(u.attributes&&(u.attributes.serverMuteVideo&&this.safeEmit(A.ON_VIDEO_STREAM_BANNED,{uid:u.clientId,banned:u.attributes.serverMuteVideo===1}),u.attributes.serverMuteAudio&&this.safeEmit(A.ON_AUDIO_STREAM_BANNED,{uid:u.clientId,banned:u.attributes.serverMuteAudio===1})),u.clientId===o.clientId)return;const p=this._remoteUsers.get(u.clientId);p?p._stillExist=!0:n.push(u)}));for(const u of this._remoteUsers.values())u._stillExist||a.push({clientId:u.userId}),delete u._stillExist;(s=o.streams)===null||s===void 0||s.forEach((u=>{const p=this._findRemoteStreamByScreen(u.clientId,u.screen);this.config.updateUserPubInfo(u),p?(p.stillExist=!0,p.streamId=u.streamId,l.push(u)):d.push(u)}));for(const u of this._remoteStreams.values())Array.isArray(u)&&u.forEach((p=>{p.stillExist?delete p.stillExist:c.push({clientId:p.userId,streamId:p.streamId,message:_h.clientDisconnected})}));a.forEach((u=>this._onUserDisconnection(u))),n.forEach((u=>this._onUserConnection(u))),c.forEach((u=>this._onRemoveStream(u))),d.forEach((u=>this._onAddStream(u,{fromSignal:!1}))),l.forEach((u=>this._onUpdateStreamAttributes(u))),this.config.resetUserPubInfo(),r&&this._handleSendOrRecvStreamAfterReconnect(),this.emit("__joinSuccess")}_handleSendOrRecvStreamAfterReconnect(){var e;this._localStream&&(this._publisher.cleanStream(this._localStream).then((()=>{var i;this._localStream&&(this._localStream.vendorCode=this.config.vendorConfig.vendorCode||0,(i=this._localStream.observer)===null||i===void 0||i.setLogin(!0))})),this._publisher.publish(this._localStream).then((()=>{var i;this._ctx.handler&&((i=this._localStream)===null||i===void 0||i.startReport(this._onLocalStreamStats.bind(this),this._localStream.vendorHandler||this._ctx.handler)),this.emit(A.ON_PUBLISH_RESULT,{isScreen:!1,state:es.PUBLISH_SUCC,retry:!0})})).catch((i=>{this.logger.error("failed repub error:".concat(i)),this.emit(A.ON_PUBLISH_RESULT,{isScreen:!1,state:es.PUBLISH_FAIL,errorCode:i.code,retry:!0})}))),this._localScreenStream&&(this._publisher.cleanStream(this._localScreenStream).then((()=>{var i;this._localScreenStream&&((i=this._localScreenStream.observer)===null||i===void 0||i.setLogin(!0))})),this._publisher.publish(this._localScreenStream).then((()=>{var i;this._ctx.handler&&((i=this._localScreenStream)===null||i===void 0||i.startReport(this._onLocalStreamStats.bind(this),this._localScreenStream.vendorHandler||this._ctx.handler)),this.emit(A.ON_PUBLISH_RESULT,{isScreen:!0,state:es.PUBLISH_SUCC,retry:!0})})).catch((i=>{this.logger.error("failed repub screen stream error:".concat(i)),this.emit(A.ON_PUBLISH_RESULT,{isScreen:!0,state:es.PUBLISH_FAIL,errorCode:i.code,retry:!0})})));for(const i of this._remoteStreams.values())Array.isArray(i)&&i.forEach((async s=>{if(s.hasSubscribed){s.resetHasSubscribed();try{var o,r;this.logger.info("start resubscribe ".concat(s.userId," with ").concat(s.subMediaType)),Ve(s.subMediaType)&&((o=s.observer)===null||o===void 0||o.setSubscribeVideo(!0)),Be(s.subMediaType)&&((r=s.observer)===null||r===void 0||r.setSubscribeAudio(!0)),await this._subscriber.subscribe(s,s.subMediaType),this.logger.info("success resubscribe ".concat(s.userId," with ").concat(s.subMediaType)),this.safeEmit(A.RESUBSCRIBE,{stream:s}),this.emit(A.ON_SUBSCRIBE_RESULT,{state:Fr.SUBSCRIBE_SUCC,userId:s.userId,isScreen:s.isScreen,retry:!0})}catch(n){if(this.emit(A.ON_SUBSCRIBE_RESULT,{state:Fr.SUBSCRIBE_FAIL,userId:s.userId,isScreen:s.isScreen,errorCode:n.code,retry:!0}),this.logger.error("failed resubscribe ".concat(s.userId," with ").concat(s.subMediaType,", error:").concat(n)),n.code===C.NOT_CONNECTED_YET)return void(s.streamState=Yt.SUB_ED);await this._subscriber.cleanStream(s),s.resetHasSubscribed()}}}));(e=this._subtitleTool)===null||e===void 0||e.reconnect(),this._forwardStreamManager.resumeFromReconnect()}_handleFFAudioTrack(){var e,i;const s=(e=this._ctx.handler)===null||e===void 0?void 0:e.audioTrack4ff,o=(i=this._ctx.handler)===null||i===void 0?void 0:i.getTransceivers();if(s&&Array.isArray(o)){const r=o.find((n=>{var a;return(n==null||(a=n.receiver)===null||a===void 0?void 0:a.track)===s}));if(r){const n=new Lc(this._ctx,"ff-stream","ff-stream",!1,!1,ov);n.virtual=!0,n.audioTransceiver=r,n.audioMid="0",n.audioTrack=fI(this._ctx,s,{streamIndex:He.VIRTUAL}),this._virtualStreams.push(n),this.safeEmit(A.SUBSCRIBE_PUSH_TRACK,{stream:n})}}}_findRemoteStream(e,i){const s=this._remoteStreams.get(e);return Array.isArray(s)?s.find((o=>o.streamId===i)):null}_findRemoteStreamByScreen(e,i){const s=this._remoteStreams.get(e);return Array.isArray(s)?s.find((o=>o.isScreen===i)):null}_onAddStream(e){let{needEmit:i=!0,fromSignal:s=!0,virtual:o=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.clientId===this.config.userId)return;const{isAutoSubscribeAudio:r,isAutoSubscribeVideo:n}=this.config,a=this._findRemoteStreamByScreen(e.clientId,e.screen);if(a&&a.streamId!==e.streamId){var c;const l=(c=this._remoteStreams.get(e.clientId))===null||c===void 0?void 0:c.filter((u=>u.streamId!==a.streamId));this._subscriber.cleanStream(a),this._remoteStreams.set(e.clientId,l||[])}let d=this._findRemoteStream(e.clientId,e.streamId);if(this._remoteStreamStreamIdUserIdMap[e.streamId]=e.clientId,d)d.attributes=e.attributes;else if(d=new Lc(this._ctx,e.clientId,e.streamId,e.screen,!1,e.attributes),d.virtual=o,this._initStreamListeners(d),!o){const l=this._remoteStreams.get(e.clientId);l?l.push(d):this._remoteStreams.set(e.clientId,[d])}if(d.remoteSessionId=e.remoteSessionId||"",d.observer=new XI(this._ctx,d),!d.isScreen&&n&&(s&&d.hasVideo&&(d.attributes.extvideo?(d.observer.setExternalVideoSource(!0),d.observer.setPushVideo(!0)):(d.observer.setExternalVideoSource(!1),d.observer.setPublishVideo(!0))),s&&d.hasAudio&&r&&!this.config.isMultiChatMode()&&(d.attributes.extaudio?(d.observer.setExternalAudioSource(!0),d.observer.setPushAudio(!0)):(d.observer.setExternalAudioSource(!1),d.observer.setPublishAudio(!0))),i&&!s)){const{isAutoSubscribeAudio:l,isAutoSubscribeVideo:u}=this.config;d.observer.setLogin(!0,{audio:!!l&&!this.config.isMultiChatMode(),video:!!u})}return i&&this.safeEmit(O.ON_ADD_STREAM,{stream:d}),d}_onUserConnection(e){var i;if(e.clientId===this.config.userId)return;const s=this._userDuplicateLoginTimerMap.get(e.clientId);if(typeof s=="number")return this._userDuplicateLoginTimerMap.delete(e.clientId),void self.clearTimeout(s);const o={userId:e.clientId,extraInfo:(i=e.attributes)===null||i===void 0?void 0:i.extra_info};this._remoteUsers.set(e.clientId,I({},o)),this.safeEmit(O.USER_CONNECTION,{userInfo:o,publishState:this.config.getUserPubInfo(o.userId)}),e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(A.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:e.attributes.serverMuteVideo===1}),e.attributes.serverMuteAudio&&this.safeEmit(A.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:e.attributes.serverMuteAudio===1}))}_onUserDisconnection(e){let{clientId:i,tag:s,code:o,forbiddenTime:r}=e;if(i)if(i===this.config.userInfo.userId){let n=null;s===Ys.kickedByAdmin?n=C.KICKED_OUT:s===Ys.onUserTokenDidExpire?n=C.TOKEN_EXPIRED:s===Ys.userDuplicateLogin&&(n=C.DUPLICATE_LOGIN),o===tT.roomDismissByAdmin&&(n=C.ROOM_DISMISS),n&&this.safeEmit(A.ON_ROOM_ERROR,{errorCode:n,forbiddenTime:r})}else{let n=zn.DROPPED;s===Ys.userLeave?n=zn.QUIT:s===Ys.kickedByAdmin?n=zn.KICKED_BY_ADMIN:s===Ys.roleChanged&&(n=zn.SWITCH_TO_INVISIBLE);const a=()=>{var c;this._remoteUsers.delete(i);const d=[];(c=this._remoteStreams.get(i))===null||c===void 0||c.forEach((l=>{d.push(this._onRemoveStream({clientId:l.userId,streamId:l.streamId,message:_h.clientDisconnected}))})),this._remoteStreams.delete(i),Promise.all(d).finally((()=>{this.safeEmit(A.ON_USER_LEAVE,{userInfo:{userId:i},reason:n,tag:s})}))};if(s===Ys.userDuplicateLogin){const c=this._userDuplicateLoginTimerMap.get(i);c&&self.clearTimeout(c);const d=self.setTimeout(a,5e3);this._userDuplicateLoginTimerMap.set(i,d)}else a()}}async _onRemoveStream(e){if(e.clientId===this.config.userId)return;const i=this._remoteStreams.get(e.clientId);if(!i)return;const s=i.find((c=>c.streamId===e.streamId));if(!s)return;var o,r;s.hasVideo&&((o=s.observer)===null||o===void 0||o.setPublishVideo(!1)),s.hasAudio&&!this.config.isMultiChatMode()&&((r=s.observer)===null||r===void 0||r.setPublishAudio(!1));const n=i.filter((c=>c.streamId!==e.streamId));this._remoteStreams.set(e.clientId,n);const a={isScreen:s.isScreen,userId:s.userId,streamId:s.streamId,attributes:{audiostream:s.attributes.audiostream,videostream:s.attributes.videostream}};try{await this._subscriber.handleRemoveStream(s)}catch(c){console.error(c)}this.safeEmit(O.ON_REMOVE_STREAM,{stream:a,reason:e.message})}_onUpdateUserAttributes(e){e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(A.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:e.attributes.serverMuteVideo===1}),e.attributes.serverMuteAudio&&this.safeEmit(A.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:e.attributes.serverMuteAudio===1}))}_onUpdateRoomAttributes(e){var i;e.roomAttributes&&(this.config.updateRoomAttributes(e.roomAttributes),this._ctx&&(this._ctx.callId=e.roomAttributes.callId)),(i=e.roomAttributes)!==null&&i!==void 0&&i.multiChatMode&&this._handleFFAudioTrack()}_onUpdateStreamAttributes(e){const{isAutoSubscribeAudio:i,isAutoSubscribeVideo:s}=this.config,{clientId:o,streamId:r,attributes:n}=e,a=this._findRemoteStream(o,r);if(!a)return;const c=a.attributes,d=I(I({},c),n);let l=!1;const u=d.localaudio!==c.localaudio;let p=!1,h=!1;const _=d.localvideo!==c.localvideo;let y=!1,b=ti.NONE,S=ti.NONE;if(d.audiostream!==c.audiostream&&(l=d.localaudio,p=!!d.audiostream,d.audiostream?b|=Q.AUDIO:S|=Q.AUDIO),d.videostream!==c.videostream&&(h=d.localvideo,y=!!d.videostream,d.videostream?b|=Q.VIDEO:S|=Q.VIDEO),b&&this.safeEmit(A.ON_USER_PUBLISH_STATE_CHANGE,{userId:o,mediaType:b,isScreen:a.isScreen,pubState:Ot.PUB,remoteStream:a}),S&&this.safeEmit(A.ON_USER_PUBLISH_STATE_CHANGE,{userId:o,mediaType:S,isScreen:a.isScreen,pubState:Ot.UNPUB,remoteStream:a}),a.remoteSessionId=e.remoteSessionId||"",a.attributes=d,d.localaudio!==c.localaudio)if(d.localaudio){var v,f,g,Z;(i||a.subAudio)&&d.audiostream&&(d.extaudio?((v=a.observer)===null||v===void 0||v.setExternalAudioSource(!0),(f=a.observer)===null||f===void 0||f.setPushAudio(!0)):((g=a.observer)===null||g===void 0||g.setExternalAudioSource(!1),(Z=a.observer)===null||Z===void 0||Z.setEnableAudio(!0))),this.safeEmit(A.ON_USER_START_AUDIO_CAPTURE,{userId:o},a)}else{var R,T,X,L;d.extaudio?((R=a.observer)===null||R===void 0||R.setExternalAudioSource(!0),(T=a.observer)===null||T===void 0||T.setPushAudio(!1)):((X=a.observer)===null||X===void 0||X.setExternalAudioSource(!1),(L=a.observer)===null||L===void 0||L.setEnableAudio(!1)),!a.isScreen&&this.safeEmit(A.ON_USER_STOP_AUDIO_CAPTURE,{userId:o})}if(d.localvideo!==c.localvideo)if(d.localvideo){var W,M,k,U;(s||a.subVideo)&&d.videostream&&(d.extvideo?((W=a.observer)===null||W===void 0||W.setExternalVideoSource(!0),(M=a.observer)===null||M===void 0||M.setPushVideo(!0)):((k=a.observer)===null||k===void 0||k.setExternalVideoSource(!1),(U=a.observer)===null||U===void 0||U.setEnableVideo(!0))),this.safeEmit(A.ON_USER_START_VIDEO_CAPTURE,{userId:o})}else{var D,ie,B,$;d.extvideo?((D=a.observer)===null||D===void 0||D.setExternalVideoSource(!0),(ie=a.observer)===null||ie===void 0||ie.setPushVideo(!1)):((B=a.observer)===null||B===void 0||B.setExternalVideoSource(!1),($=a.observer)===null||$===void 0||$.setEnableVideo(!1)),!a.isScreen&&this.safeEmit(A.ON_USER_STOP_VIDEO_CAPTURE,{userId:o})}var te,N;l&&!u&&i&&((te=a.observer)===null||te===void 0||te.setRemoteUnmuteAudio(p)),h&&!_&&s&&((N=a.observer)===null||N===void 0||N.setRemoteUnmuteVideo(y)),typeof d.videoType=="number"&&d.videoType!==c.videoType&&this.safeEmit(A.VIDEO_TYPE_CHANGE,{userId:a.userId,isScreen:a.isScreen,type:d.videoType===Lt.BLACK?yh.BLACK:yh.NORMAL})}_onPushTrack(e){var i;if((i=e.streamId)===null||i===void 0||!i.startsWith("audio_mux"))return void this.config.report("rtc_error",{message:"onPushTrack, userId: ".concat(e.clientId,", ").concat(e.streamId),error_code:At.TRACK_ERROR});const s=this._onAddStream(I(I({},e),{},{attributes:ov}),{needEmit:!1,fromSignal:!1,virtual:!0});s&&this._subscriber.subscribe4pushTrack(s,e).then((()=>{this.safeEmit(A.SUBSCRIBE_PUSH_TRACK,{stream:s}),this._virtualStreams.push(s)})).catch((o=>{this.logger.error("subscribe","push track failed %o",o)}))}_onRemoveTrack(e){let{clientId:i,streamId:s,message:o,trackType:r}=e;this.logger.info("_onRemoveTrack","remove track: %o",i);const n=this._findRemoteStream(i,s);n&&(n.removeTrack=!0,this._subscriber.unsubscribe4removeTrack(n,o,r),this.emit(A.REMOVE_PUSH_TRACK,{stream:n,mediaType:r+1}))}_onMeetingSpeakerChange(e){if(Array.isArray(e?.speakerCsrcInfo)){const i={};e?.speakerCsrcInfo.forEach((s=>{let{csrc:o,userId:r,isScreen:n}=s;n||(i[o]=r)})),this._csrcUserIdMap=i}Array.isArray(e.muxStreamInUse)&&this._virtualStreams.forEach((i=>{var s;(s=e.muxStreamInUse)!==null&&s!==void 0&&s.includes(i.streamId)?i.virtualOccupy=!0:i.virtualOccupy=!1}))}getActiveSpeakerInMultiChatMode(){const e=[];return this._virtualStreams.forEach((i=>{var s;const o=(s=i.audioTransceiver)===null||s===void 0?void 0:s.receiver;if(o){const[r]=o.getContributingSources()||[];if(r){const{audioLevel:n,source:a}=r;this._csrcUserIdMap[a]&&e.push({userId:this._csrcUserIdMap[a],audioLevel:n})}}})),e.length&&en(e).call(e,((i,s)=>i.audioLevel-s.audioLevel)),e}_onReconnecting(){var e,i;for(const s of this._remoteStreams.values())Array.isArray(s)&&s.forEach((o=>{var r;(r=o.observer)===null||r===void 0||r.setDisconnect(),this._subscriber.cleanStream(o)}));this._virtualStreams.forEach((s=>{var o;this.emit(A.REMOVE_PUSH_TRACK,{stream:s,mediaType:Q.AUDIO}),(o=s.observer)===null||o===void 0||o.setDisconnect(),this._subscriber.cleanStream(s)})),this._virtualStreams=[],(e=this.localStream)===null||e===void 0||(e=e.observer)===null||e===void 0||e.setDisconnect(),this._publisher.cleanStream(this.localStream),(i=this.localScreenStream)===null||i===void 0||(i=i.observer)===null||i===void 0||i.setDisconnect(),this._publisher.cleanStream(this.localScreenStream)}_onConnectionStateChange(e){e.state===fe.CONNECTION_STATE_RECONNECTING?this._onReconnecting():e.state===fe.CONNECTION_STATE_RECONNECTED&&this._roomJoin.join(!0)}_initStreamListeners(e){e.on("ontrack",(i=>{i.track})),e.on("onSEIMessage",(i=>{this.emit(A.ON_SEI_MESSAGED_RECEIVED,{sei:i,remoteStreamKey:{userId:e.userId,roomId:this.config.roomId,streamIndex:e.isScreen?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN}})})),e.on("stats-exception",(i=>{this.emit(A.ON_REMOTE_STATS_EXCEPTION,I(I({},i),{},{userId:e.userId,isScreen:e.isScreen}))}))}_onCustomMessage(e){var i;(i=this._subtitleTool)!==null&&i!==void 0&&i.onMessageRecv(e)||this.safeEmit(O.ON_CUSTOM_MESSAGE,e)}_onUserMessageReceived(e){this.safeEmit(O.USER_MESSAGE_RECEIVED,{userId:e.from,message:e.msg})}_onUserBinaryMessageReceived(e){var i;const s={userId:e.from,message:e.msg};(i=this._subtitleTool)!==null&&i!==void 0&&i.onMessageRecv(s)||this.safeEmit(O.USER_BINARY_MESSAGE_RECEIVED,s)}_initSubtitleTool(){this._subtitleTool=new el(this._ctx,this.config),this._subtitleTool.onEvent=e=>{this.emit(A.ON_SUBTITLE_STATE_CHANGED,e)},this._subtitleTool.onMessage=e=>{this.emit(A.ON_SUBTITLE_MESSAGE_RECEIVED,e)}}_onPostProcessingMessage(e){if(!e.body)return;var i;if(e.type==="subtitleCallback")return void((i=this._subtitleTool)===null||i===void 0||i.onResult(e));const s=e.body,o=s.error||0;let r=pi.START;const n=["success","parameter error","subscription timeout","ffmpeg error","cdn error","publish error"];if(s.protocol==="2.0"){switch(s.eventType){case"TranscodeStarted":s.error!==0&&(r=pi.START_FAILED);break;case"TranscodeStateChanged":r=s.error!==0?pi.START_FAILED:pi.START_SUCCESS;break;case"TranscodeStopped":r=s.error!==0?pi.STOP_FAILED:pi.STOP_SUCCESS;break;case"TranscodeUpdated":r=s.error!==0?pi.UPDATE_FAILED:pi.UPDATE_SUCCESS}this.safeEmit(O.POST_PROCESSING_MESSAGE,{code:o,protocol:s.protocol,error:s.error,eventType:r,message:n[o]})}this.safeEmit(O.POST_PROCESSING_MESSAGE,{code:o,message:n[o],type:e.type})}_onUserTokenWillExpire(){this.safeEmit(O.ON_USER_TOKEN_WILL_EXPIRE,null)}_onUserTokePublishPrivilegeWillExpire(){this.safeEmit(O.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE,null)}_onUserTokenPublishPrivilegeDidExpire(){this.safeEmit(O.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED,null)}_onUserTokeSubscribePrivilegeWillExpire(){this.safeEmit(O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE,null)}_onUserTokenSubscribePrivilegeDidExpire(){this.safeEmit(O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED,null)}async _onStreamFailed(e){if(e.type==="publish"){var i,s;let o;if(((i=this.localStream)===null||i===void 0?void 0:i.streamId)===e.streamId?o=this.localStream:((s=this.localScreenStream)===null||s===void 0?void 0:s.streamId)===e.streamId&&(o=this.localScreenStream),!o)return;await this._publisher.unpublish(o).catch((()=>{})),await this._publisher.cleanStream(o),await this._publisher.publish(o).catch((()=>{}))}else if(e.type==="subscribe"){const o=this._remoteStreamStreamIdUserIdMap[e.streamId],r=this._findRemoteStream(o,e.streamId);r&&(await this._subscriber.handleStreamFailed(r),this.safeEmit(A.RESUBSCRIBE,{stream:r}))}}_onStreamControlMessage(e){var i,s;e.type===qZ.PushLimitWarn&&((i=this._localStream)!==null&&i!==void 0&&i.pubAudio||(s=this._localStream)!==null&&s!==void 0&&s.pubVideo||this.unpublish())}async _onPublishOnDemand(){var e,i,s;if(this._publishOnDemandItem&&!this._publishOnDemandBusy&&((e=this._serverConfig)===null||e===void 0||(e=e.engine_VPM)===null||e===void 0||(e=e.ondemand)===null||e===void 0?void 0:e.enable)!==!1){if((i=this._localStream)!==null&&i!==void 0&&i.videoTransceiver){this._publishOnDemandBusy=!0;const o=this._publishOnDemandItem;this._publishOnDemandItem=void 0;const r=[],n=this._localStream.stream.id,{sender:a}=this._localStream.videoTransceiver,c=a.getParameters();if(ye(this._ctx.id,"sender.getParameters",JSON.stringify(c),0,n),Array.isArray(c.encodings)&&Array.isArray(o)){const d={};this.logger.info("_onPublishOnDemand exec","usedDescriptions: %o",o),o.forEach((u=>{var p;if((p=u.StreamIds)!==null&&p!==void 0&&p.includes(n)){var h,_,y;const v=(h=(_=u.Metadata)===null||_===void 0?void 0:_.VideoIndex)!==null&&h!==void 0?h:0;let f=0;var b,S;(y=this._ctx.serverConfig)!==null&&y!==void 0&&y.e2eFeedback&&(f=Math.max(...Object.keys((b=(S=u.Metadata)===null||S===void 0?void 0:S.VideoKbpsHist)!==null&&b!==void 0?b:{}).map((g=>Number(g))),0)),d[v]={kbps:f}}}));const l=[...this._localStream.pubAttributes.videoDescriptions];c.encodings=c.encodings.map((u=>{if(u.rid){if(d[u.rid]){var p;u.active=!0;const y=(p=d[u.rid])===null||p===void 0?void 0:p.kbps;y&&(u.maxBitrate=1e3*zS(u.rid,y,l))}else u.active=!1;const _=Number(u.rid);r[_]=u.active}else{var h;const _=(h=d[0])===null||h===void 0?void 0:h.kbps;_&&(u.maxBitrate=1e3*zS(void 0,_,l))}return u})),this.config.report("rtc_invoke_status",{sdk_api_name:"onPublishOnDemand",message:JSON.stringify(c.encodings),error_code:0,stream_id:n,elapse:0}),this._ctx.videoProfile.activeSimStreams=r}this.logger.info("sender.setParameters()",JSON.stringify(c.encodings)),ye(this._ctx.id,"sender.setParameters",JSON.stringify(c),0,n),await a.setParameters(c),this._publishOnDemandBusy=!1}else if((s=this._localStream)===null||s===void 0||!s.videoTransceiver)return;this._onPublishOnDemand()}}_onRTT(e){const{StreamIds:i,Metadata:s}=e;if(i!=null&&i.length&&s){const o=i[0];this._ctx.streamRTT[o]={audio:s.audio_rtt,video:s.video_rtt}}}_onRSCP(e,i){e.find((s=>{var o,r;return s==null||(o=s.StreamIds)===null||o===void 0?void 0:o.includes((r=this._localStream)===null||r===void 0||(r=r.stream)===null||r===void 0?void 0:r.id)}))&&(i?this._pubTransceiverReady=!0:this._onceTriggerBySignal=!0,i&&this._onceTriggerBySignal||(this._publishOnDemandItem=e),this._pubTransceiverReady&&this._onPublishOnDemand())}_onSSC(e){const{StreamIds:i,Metadata:s}=e,o=i[0],r=this._remoteStreamStreamIdUserIdMap[o],n=this._findRemoteStream(r,o),a={userId:r,isScreen:!!n&&n.isScreen,beforeVideoIndex:s.ssc_items[0].prev_layer_id,afterVideoIndex:s.ssc_items[0].cur_layer_id,beforeEnable:s.ssc_items[0].prev_video_open!==0,afterEnable:s.ssc_items[0].cur_video_open!==0,reason:s.ssc_items[0].change_reason};this.emit(A.ON_SIMULCAST_SUBSCRIBE_FALLBACK,a)}_reportNetworkQuality(e,i){this.emit(A.ON_NETWORK_QUALITY,e,i)}_emitVideoSizeChange(e,i,s,o){this.emit(A.ON_REMOTE_VIDEO_SIZE_CHANGED,{roomId:this.config.roomId,userId:e,streamIndex:i?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN},{width:s,height:o})}async setAudioEncodeMaxBitrate(e,i){const s=e===V.STREAM_INDEX_MAIN?this.localStream:this.localScreenStream;if(s!=null&&s.pubAudio){var o;const n=(o=s.audioTransceiver)===null||o===void 0?void 0:o.sender.getParameters();var r;ye(this._ctx.id,"sender.getParameters",JSON.stringify(n),0,s.streamId),n!=null&&n.encodings.length&&(n.encodings[0].maxBitrate=1e3*i,ye(this._ctx.id,"sender.setParameters",JSON.stringify(n),0,s.streamId),await((r=s.audioTransceiver)===null||r===void 0?void 0:r.sender.setParameters(n)))}}_onEngineControlMessage(e){let{type:i,body:s}=e;if(i===eT.CHANGE_CODEC){if(!ae("SDK_CODEC_NEGOTIATION"))return void this.logger.info("_onEngineControlMessage","SDK_CODEC_NEGOTIATION is false, ignore");const{codec:a,media:c,streamId:d}=s;if(!c||c==="audio")return;const l=mZ(a);let u;var o,r,n;this.logger.info("_onEngineControlMessage","changeCodec to %s",a),d?(((o=this.localStream)===null||o===void 0?void 0:o.streamId)===d?u=this.localStream:((r=this.localScreenStream)===null||r===void 0?void 0:r.streamId)===d&&(u=this.localScreenStream),(n=u)===null||n===void 0||n.setChangeCodecs(l)):c==="video"?(u=this.localStream,this._ctx.setTargetCodec(l[0])):c==="screen"&&(u=this.localScreenStream,this._ctx.setTargetScreenCodec(l[0])),u&&this.emit(A.UPDATE_PUBLISH,{streamIndex:u.isScreen?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN})}}}we([me],Pe.prototype,"publishScreen"),we([me],Pe.prototype,"updatePubScreenTrack"),we([me],Pe.prototype,"unpublishScreen"),we([me],Pe.prototype,"liveControlMessage"),we([me],Pe.prototype,"publicStreamControlMessage"),we([me],Pe.prototype,"updateUserAttributes"),we([me],Pe.prototype,"publish"),we([me],Pe.prototype,"updatePubTrack"),we([me],Pe.prototype,"unpublish"),we([me],Pe.prototype,"subscribe"),we([me],Pe.prototype,"updateSubVideoConfig"),we([me],Pe.prototype,"unsubscribe"),we([me],Pe.prototype,"startSubtitle"),we([me],Pe.prototype,"stopSubtitle"),we([me],Pe.prototype,"startForwardStream2Rooms"),we([me],Pe.prototype,"updateForwardStream2Rooms"),we([me],Pe.prototype,"stopForwardStream2Rooms"),we([me],Pe.prototype,"pauseForwardStream2AllRooms"),we([me],Pe.prototype,"resumeForwardStream2AllRooms"),we([me],Pe.prototype,"updateMediaParams"),we([me],Pe.prototype,"updateRemoteUserPriority"),we([me],Pe.prototype,"updateToken"),we([me],Pe.prototype,"sendUserMessage"),we([me],Pe.prototype,"sendRoomMessage"),we([me],Pe.prototype,"maybeFillBackFrame2Stream");const rv=async(t,e)=>{const i=new Audio(fi.createObjectURL(new Blob([t],e)));try{return i.muted=!0,await i.play(),i.pause(),!0}catch{return!1}};var P3=Object.defineProperty,N3=Object.getOwnPropertyDescriptor,ft=(t,e,i,s)=>{for(var o,r=N3(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&P3(e,i,r),r};class yt{constructor(e,i){m(this,"_sharedAudioContext",new AudioContext),m(this,"_workletReady",void 0),m(this,"_audioDestination",this._sharedAudioContext.createMediaStreamDestination()),m(this,"_localGainNode",this._sharedAudioContext.createGain()),m(this,"_bufferGainNode",this._sharedAudioContext.createGain()),m(this,"_audioBufferSource",void 0),m(this,"_localSource",void 0),m(this,"_context",void 0),m(this,"_failedAudioList",[]),m(this,"_startingIds",new Map),m(this,"_revokeURLs",new Set),m(this,"_audioFetchMap",new Map),m(this,"_audioFetchConfig",new Map),m(this,"mixingMap",new Map),m(this,"resourcesCache",new Map),m(this,"volumeConfig",new Map),m(this,"cachedBuffer",[]),m(this,"id","AudioMixingManager"),this.engineId=i,this._context=e;try{var s,o;this._workletReady=(s=this._sharedAudioContext.audioWorklet)===null||s===void 0||(o=s.addModule)===null||o===void 0?void 0:o.call(s,hI),this._workletReady.catch((()=>{this._workletReady=null}))}catch{this._workletReady=null}this._localGainNode.gain.value=1}mixMediaStream(e){this._localSource&&this._localSource.disconnect(this._localGainNode),this._localSource=this._sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this._localGainNode).connect(this._audioDestination)}async startAudioMixing(e,i,s){if(this._startingIds.get(e)!==void 0)return void console.warn("AudioMixing task id: ".concat(e," is starting"));this._startingIds.set(e,e);const{playCount:o,type:r}=s;_e(r,"mixingType",aS(Ti));const n=this._context.getLocalAudioTrack();if(!n)return;const a=n.preprocessingTrack;a&&this.mixMediaStream(new MediaStream([a])),n.once("needReplaceTrack",(()=>{this.mixMediaStream(new MediaStream([n.preprocessingTrack]))}));const c=this.mixingMap.get(e);if(c!=null&&c.audioNode){c.audioNode.pause(),this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_STOPPED,error:Nt.AUDIO_MIXING_ERROR_OK});try{c.gainNode.disconnect(this._audioDestination),c.audioSource.disconnect(c.gainNode)}catch{}}let d;const l=this.resourcesCache.get(e);if(l&&l.filePath===i)d=l.getAudioNode();else{const _=await fetch(i,{mode:"cors"}).then((b=>{if(b.ok)return b.arrayBuffer();throw this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_FAILED,error:Nt.AUDIO_MIXING_ERROR_START_FAILED}),this._startingIds.delete(e),this.mixingMap.delete(e),new G(C.LOAD_RESOURCES_FAILED,b.statusText)}));let y;if(i.endsWith("mp3")?y={type:"audio/mpeg"}:i.endsWith("aac")&&(y={type:"audio/aac"}),!await rv(_,y))throw this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_FAILED,error:Nt.AUDIO_MIXING_ERROR_START_FAILED}),this._startingIds.delete(e),this.mixingMap.delete(e),new G(C.LOAD_RESOURCES_FAILED,"invalid audio resource");d=new Audio,d.crossOrigin="anonymous",d.src=fi.createObjectURL(new Blob([_],y))}if(o<=0)d.loop=!0;else if(o>0){let _=o;d.onended=()=>{--_>0?d.play():(this.mixingMap.delete(e),this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_FINISHED,error:Nt.AUDIO_MIXING_ERROR_OK}))}}try{await d.play()}catch(_){console.error(_),this._failedAudioList.push(d),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:V.STREAM_INDEX_MAIN,mediaType:Q.AUDIO})}this._startingIds.delete(e);const u=this._sharedAudioContext.createMediaElementSource(d),p=this._sharedAudioContext.createGain(),h=this.volumeConfig.get(e);if(p.gain.value=h?h/100:1,u.connect(p).connect(this._audioDestination),this.mixingMap.set(e,{audioSource:u,audioNode:d,gainNode:p,type:"file"}),r===Ti.PUBLISH)try{p.disconnect(this._sharedAudioContext.destination)}catch{}else p.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],s.type),this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_PLAYING,error:Nt.AUDIO_MIXING_ERROR_OK}),this.updateFetcher(e)}stopAudioMixing(e){const i=this.mixingMap.get(e);i&&i.type==="file"&&(this.mixingMap.delete(e),i.audioNode.pause(),i.audioSource.disconnect(i.gainNode),i.gainNode.disconnect(this._audioDestination),this.updateFetcher(e),this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_STOPPED,error:Nt.AUDIO_MIXING_ERROR_OK}))}pauseAudioMixing(e){const i=this.mixingMap.get(e);i&&(this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_PAUSED,error:Nt.AUDIO_MIXING_ERROR_OK}),i.audioNode.pause())}resumeAudioMixing(e){const i=this.mixingMap.get(e);i&&(this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_PLAYING,error:Nt.AUDIO_MIXING_ERROR_OK}),i.audioNode.play())}async preloadAudioMixing(e,i){this.stopAudioMixing(e);const s=await fetch(i,{mode:"cors"}).then((r=>{if(r.ok)return r.arrayBuffer();throw new G(C.LOAD_RESOURCES_FAILED,r.statusText)})).catch((r=>{throw this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_FAILED,error:Nt.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),r instanceof G?r:new G(C.LOAD_RESOURCES_FAILED,"Load resources failed",r)}));let o;if(i.endsWith("mp3")?o={type:"audio/mpeg"}:i.endsWith("aac")&&(o={type:"audio/aac"}),!await rv(s,o))throw this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_FAILED,error:Nt.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new G(C.LOAD_RESOURCES_FAILED,"Load resources failed");this._context.emitMessage({mixId:e,state:kt.AUDIO_MIXING_STATE_PRELOADED,error:Nt.AUDIO_MIXING_ERROR_OK}),this.resourcesCache.set(e,{getAudioNode:()=>{const r=fi.createObjectURL(new Blob([s],o));return this._revokeURLs.add(r),new Audio(r)},filePath:i,duration:0}),await new Promise((r=>{const n=fi.createObjectURL(new Blob([s],o)),a=new Audio(n);a.addEventListener("durationchange",(()=>{const c=this.resourcesCache.get(e);c&&(c.duration=a.duration,this.resourcesCache.set(e,c)),fi.revokeObjectURL(n),r(null)}))}))}unloadAudioMixing(e){this.resourcesCache.has(e)&&this.resourcesCache.delete(e)}getAudioMixingVolume(e){const i=this.mixingMap.get(e);return i?100*i.gainNode.gain.value:0}setAudioMixingVolume(e,i){i<0?i=0:i>400&&(i=400),this.volumeConfig.set(e,i);const s=this.mixingMap.get(e);s&&(s.gainNode.gain.value=Number(i)/100)}getAudioMixingDuration(e){const i=this.mixingMap.get(e),s=this.resourcesCache.get(e);return i||s?i?1e3*i.audioNode.duration:s?1e3*s.duration:0:0}getAudioMixingCurrentPosition(e){const i=this.mixingMap.get(e);return i?1e3*i.audioNode.currentTime:0}setAudioMixingPosition(e,i){const s=this.mixingMap.get(e);s&&(s.audioNode.currentTime=i/1e3,s.audioNode.play())}setAudioFrameCallback(e,i){var s;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4096;if(_e(o,"frameSize",[256,512,1024,2048,4096,8192,16384]),o=(s=o)!==null&&s!==void 0?s:4096,this._workletReady===null)throw new G(C.NOT_SUPPORTED,"Not support AudioWorklet");i?this._audioFetchConfig.set(e,{callback:i,frameSize:o}):this._audioFetchConfig.delete(e),this.updateFetcher(e)}updateFetcher(e){var i,s;const{callback:o,frameSize:r}=(i=this._audioFetchConfig.get(e))!==null&&i!==void 0?i:{},n=(s=this.mixingMap.get(e))===null||s===void 0?void 0:s.gainNode;if(n&&o&&r){let a=this._audioFetchMap.get(e);a?a.setFrameSize(r):a=new Hp(n,r,this._sharedAudioContext,this._workletReady),a.on("data",o),this._audioFetchMap.set(e,a)}else{const a=this._audioFetchMap.get(e);a?.removeAllListeners("data"),a?.destroy(),this._audioFetchMap.delete(e)}}enableAudioMixingBuffer(e){_e(e,"type",aS(Ti));const i=this._context.getLocalAudioTrack();if(!i)return;const s=i.preprocessingTrack;if(s&&this.mixMediaStream(new MediaStream([s])),e===Ti.PUBLISH)try{this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch{}else this._bufferGainNode.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],e),this._bufferGainNode.connect(this._audioDestination),this._context.emitMessage({mixId:-1,state:kt.AUDIO_MIXING_STATE_PCM_ENABLED,error:Nt.AUDIO_MIXING_ERROR_OK})}disableAudioMixingBuffer(){if(this.cachedBuffer=[],this._audioBufferSource){try{this._audioBufferSource.onended=null,this._audioBufferSource.disconnect(this._bufferGainNode),this._bufferGainNode.disconnect(this._audioDestination),this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch{}finally{this._audioBufferSource=void 0}this._context.updateLocalAudioTrack(),this._context.emitMessage({mixId:-1,state:kt.AUDIO_MIXING_STATE_PCM_DISABLED,error:Nt.AUDIO_MIXING_ERROR_OK})}}pushAudioMixingBuffer(e){if(!(this._audioBufferSource&&(this.cachedBuffer.push(e),this.cachedBuffer.length>0))){this._audioBufferSource=this._sharedAudioContext.createBufferSource(),this._audioBufferSource.buffer=e,this._audioBufferSource.connect(this._bufferGainNode);try{this._audioBufferSource.start()}catch{this._failedAudioList.push(this._audioBufferSource)}this._audioBufferSource.onended=()=>{var i;if((i=this._audioBufferSource)===null||i===void 0||i.disconnect(this._bufferGainNode),this._audioBufferSource=void 0,this.cachedBuffer.length){const s=this.cachedBuffer.shift();s&&this.pushAudioMixingBuffer(s)}}}}stopAll(){if(this._localSource)try{this._localSource.disconnect(this._localGainNode),delete this._localSource}catch{}this.mixingMap.forEach(((e,i)=>{this.stopAudioMixing(i)}))}get mixTrack(){return this._audioDestination.stream.getAudioTracks()[0]}get sharedAudioContext(){return this._sharedAudioContext}async resumeLocalPlay(){const e=[];for(const i of this._failedAudioList)try{i instanceof HTMLAudioElement?(i.muted=!1,await i.play()):i.start()}catch(s){e.push(i),console.error(s),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:V.STREAM_INDEX_MAIN,mediaType:Q.AUDIO});break}this._failedAudioList=e}destroy(){const{_sharedAudioContext:e}=this;e.state!=="closed"&&typeof e.close=="function"&&e.close(),this.cachedBuffer=[],this.mixingMap.clear(),this.resourcesCache.clear(),this.volumeConfig.clear(),this._startingIds=new Map,this._revokeURLs.forEach((i=>{fi.revokeObjectURL(i)}))}}ft([P(["id","filePath","options"])],yt.prototype,"startAudioMixing"),ft([P(["id"])],yt.prototype,"stopAudioMixing"),ft([P(["id"])],yt.prototype,"pauseAudioMixing"),ft([P(["id"])],yt.prototype,"resumeAudioMixing"),ft([P(["id"])],yt.prototype,"preloadAudioMixing"),ft([P(["id"])],yt.prototype,"unloadAudioMixing"),ft([P(["id"])],yt.prototype,"getAudioMixingVolume"),ft([P(["id","volume"])],yt.prototype,"setAudioMixingVolume"),ft([P(["id"])],yt.prototype,"getAudioMixingDuration"),ft([P(["id"])],yt.prototype,"getAudioMixingCurrentPosition"),ft([P(["id","position"])],yt.prototype,"setAudioMixingPosition"),ft([P(["id","callback","frameSize"])],yt.prototype,"setAudioFrameCallback"),ft([P(["type"])],yt.prototype,"enableAudioMixingBuffer"),ft([P()],yt.prototype,"disableAudioMixingBuffer"),ft([P(["buffer"])],yt.prototype,"pushAudioMixingBuffer");class k3 extends Ai.EventEmitter{constructor(e){super(),m(this,"_loginSessionId",null),m(this,"_userId",null),m(this,"_token",null),m(this,"_loginResolveCallback",void 0),m(this,"_loginRejectCallback",void 0),m(this,"_waitLoginToken",!1),m(this,"_serverParamsCache",void 0),m(this,"id",void 0),m(this,"logger",void 0),m(this,"_clearListeners",void 0),this._ctx=e,this.id=e.id,this.logger=new ue("RTSClient",1,e.id)}login(e,i){return new Promise(((s,o)=>{var r;if(this.logger.info("login","invoke login, token: %o, userId: %o",e,i),this._loginSessionId)throw new G(C.ALREADY_LOGIN,"Already logined");if(this._loginResolveCallback)throw new G(C.LOGIN_FAILED,"Is logging in, please try again later.");this._userId=i,this._token=e,(r=ke(this.id))===null||r===void 0||r.set({rtm_user_id:i}),this._loginResolveCallback=s,this._loginRejectCallback=o,this._ctx.signalingManager.connect().then((()=>{this._addSignalEventHandler(),this._login()}))}))}async logout(){if(!this._loginSessionId||!this._userId)throw new G(C.NOT_LOGIN,"login first");this._checkNotInLimitMode("logout"),await this._ctx.signalingManager.sendSignaling("logout",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId},{functionType:Lo.C2RTM}).catch((()=>{})),this._clearState()}async updateLoginToken(e){return this._checkNotInLimitMode("updateLoginToken"),this._token=e,new Promise(((i,s)=>{this._waitLoginToken?(this._loginResolveCallback=i,this._loginRejectCallback=s,this._login()):i()}))}async getPeerOnlineStatus(e){if(!this._loginSessionId||!this._userId)throw new G(C.NOT_LOGIN,"login first");this._checkNotInLimitMode("getPeerOnlineStatus");const i=await this._ctx.signalingManager.sendSignaling("getPeerOnlineStatus",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,peerUserId:e},{functionType:Lo.C2RTM});return i?.status}async sendUserMessageOutsideRoom(e,i){if(!this._loginSessionId||!this._userId)throw new G(C.NOT_LOGIN,"login first");return this._checkNotInLimitMode("sendUserMessageOutsideRoom"),this._ctx.rtsLimiter.e2e.check(i),this._ctx.signalingManager.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:e,room:"",msg:i})}async setRTSMessageLimit(e){e&&this._ctx.signalingManager.sendSignaling("RTSMessageLimit",{appId:this._ctx.appId,interval:e.rts_qps_interval,broadcast:e.rts_broadcast_qps_value,one2one:e.rts_e2e_qps_value,e2bs:e.rts_e2s_qps_value},{functionType:Lo.C2RTM}).catch((()=>{}))}async setServerParams(e,i){try{if(Le(e,"signature"),Le(i,"url"),!this._loginSessionId||!this._userId)throw new G(C.NOT_LOGIN,"login first");await this._ctx.signalingManager.sendSignaling("setServerParams",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,signature:e,url:i},{functionType:Lo.C2RTM}).catch((s=>{throw new G(C.UNEXPECTED_ERROR,s.msg)})),Je.setServerUrl(this.id,i),this._serverParamsCache={signature:e,url:i},this.emit("onServerParamsSetResult")}catch(s){throw this.emit("onServerParamsSetResult",s),s}}async sendServerMessage(e){if(!this._loginSessionId||!this._userId)throw new G(C.NOT_LOGIN,"login first");return this._checkNotInLimitMode("sendServerMessage"),this._ctx.rtsLimiter.e2s.check(e),this._ctx.signalingManager.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:"",room:"",type:Np.BUSINESS_SERVER,msg:e})}destroy(){this.logger.info("destroy","invoke."),super.removeAllListeners(),this._loginResolveCallback&&this._loginRejectCallback&&(this._loginRejectCallback(new G(C.LOGIN_FAILED,"logout")),delete this._loginResolveCallback,delete this._loginRejectCallback),this._clearState(),delete this._serverParamsCache}_login(){var e;if(!this._userId)return;const i=Ts();try{this._checkNotInLimitMode("login")}catch(o){var s;(s=this._loginRejectCallback)===null||s===void 0||s.call(this,o)}this._ctx.signalingManager.sendSignaling("login",{Token:$e.token2auth(this._ctx.appId,null,this._userId,this._token),timestamp:Date.now(),loginSessionId:i,params:{userAgent:window.navigator.userAgent,sdkVersion:de.VERSION,deviceId:We.getDeviceId(),appId:this._ctx.appId,userId:this._userId,deviceType:"web",rtsMode:this._ctx.rtsMode,mediaProcessingType:(e=de.MEDIA_PROCESSING_TYPE)!==null&&e!==void 0?e:0},accessParams:JSON.stringify({requireICEUfragV2:!0})},{functionType:Lo.C2RTM}).then((()=>{typeof this._loginResolveCallback=="function"&&this._loginResolveCallback(),this._loginSessionId=i,Je.setRtsSessionId(this.id,i),this._waitLoginToken=!1,this._serverParamsCache&&this.setServerParams(this._serverParamsCache.signature,this._serverParamsCache.url)})).catch((o=>{const{code:r,message:n}=o||{};let a,c;this._waitLoginToken=!1,r>=700&&r<800?r===708?(a=C.INVALID_PARAMS,c="Invalid userId"):(a=C.INVALID_TOKEN,c="Invalid token",this._waitLoginToken=!0,this._loginRejectCallback||this.emit("onRTMTokenError")):(a=C.LOGIN_FAILED,c="login failed"),typeof this._loginRejectCallback=="function"&&this._loginRejectCallback(new G(a,n||c))})).finally((()=>{delete this._loginResolveCallback,delete this._loginRejectCallback}))}_addSignalEventHandler(){const e=n=>{n.state===fe.CONNECTION_STATE_RECONNECTED&&this._login()},i=()=>this._clearState(),s=n=>{this.emit("onUserMessageReceivedOutsideRoom",{userId:n.from,message:n.msg})},o=n=>{this.emit("onUserBinaryMessageReceivedOutsideRoom",{userId:n.from,message:n.msg})},r=n=>{n.clientId!==this._userId||n.roomId||(this.emit("onUserDisconnection"),this._clearState())};this._ctx.signalingManager.on(Fe.ON_CONNECTION_STATE_CHANGE,e),this._ctx.signalingManager.on(Fe.ON_RECONNECT_FAILED,i),this._ctx.signalingManager.on(O.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,s),this._ctx.signalingManager.on(O.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,o),this._ctx.signalingManager.on(O.USER_DISCONNECTION,r),this._clearListeners=()=>{this._ctx.signalingManager.off(Fe.ON_CONNECTION_STATE_CHANGE,e),this._ctx.signalingManager.off(Fe.ON_RECONNECT_FAILED,i),this._ctx.signalingManager.off(O.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,s),this._ctx.signalingManager.off(O.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,o),this._ctx.signalingManager.off(O.USER_DISCONNECTION,r)}}_clearState(){var e;(e=this._clearListeners)===null||e===void 0||e.call(this),this._userId=null,this._token=null,this._loginSessionId=null,Je.setRtsSessionId(this.id,"")}_checkNotInLimitMode(e){if(this._ctx.rtsMode===wo.LIMIT_MODE)throw new G(C.NOT_ALLOWED_IN_RESTRICTED_MODE,"not allow to call ".concat(e," in rts restricted mode"))}}var st=(t=>(t.onWTNPushStateChanged="onWTNPushStateChanged",t.onWTNPlayStateChanged="onWTNPlayStateChanged",t.onWTNRemoteAudioStateChanged="onWTNRemoteAudioStateChanged",t.onWTNRemoteVideoStateChanged="onWTNRemoteVideoStateChanged",t.onWTNRemoteVideoStats="onWTNRemoteVideoStats",t.onWTNRemoteAudioStats="onWTNRemoteAudioStats",t.onWTNFirstRemoteVideoFrameDecoded="onWTNFirstRemoteVideoFrameDecoded",t.onWTNSEIMessageReceived="onWTNSEIMessageReceived",t.onWTNRemoteStatsException="onWTNRemoteStatsException",t.onWTNLocalStatsException="onWTNLocalStatsException",t))(st||{}),bi=(t=>(t[t.INIT=0]="INIT",t[t.START=1]="START",t[t.SUCCESS=2]="SUCCESS",t[t.STOP=3]="STOP",t[t.FAIL=4]="FAIL",t))(bi||{}),Ss=(t=>(t[t.PUSH_SUCCESS=0]="PUSH_SUCCESS",t[t.START_PUSH=1]="START_PUSH",t[t.STOP_PUSH=2]="STOP_PUSH",t[t.IN_RETRY=3]="IN_RETRY",t[t.RETRY_FAIL=4]="RETRY_FAIL",t[t.NO_PUSH_PERMISSION=5]="NO_PUSH_PERMISSION",t[t.STREAM_PUSH_BY_OTHER=6]="STREAM_PUSH_BY_OTHER",t))(Ss||{}),lt=(t=>(t[t.INIT=0]="INIT",t[t.START=1]="START",t[t.SUCCESS=2]="SUCCESS",t[t.STOP=3]="STOP",t[t.FAIL=4]="FAIL",t))(lt||{}),Mt=(t=>(t[t.PLAY_SUCCESS=0]="PLAY_SUCCESS",t[t.START_PLAY=1]="START_PLAY",t[t.STOP_PLAY=2]="STOP_PLAY",t[t.REMOTE_STOP=3]="REMOTE_STOP",t[t.REMOTE_FAILURE=4]="REMOTE_FAILURE",t[t.STREAM_BANNED=5]="STREAM_BANNED",t[t.NO_PLAY_PERMISSION=6]="NO_PLAY_PERMISSION",t[t.STREAM_NOT_EXIST=7]="STREAM_NOT_EXIST",t[t.IN_RETRY=8]="IN_RETRY",t[t.RETRY_FAIL=9]="RETRY_FAIL",t[t.INTERNAL=10]="INTERNAL",t[t.OVER_CLIENT_SUBSCRIBE_STREAM_LIMIT=1310]="OVER_CLIENT_SUBSCRIBE_STREAM_LIMIT",t[t.OVER_STREAM_SUBSCRIBE_USER_LIMIT=1311]="OVER_STREAM_SUBSCRIBE_USER_LIMIT",t[t.OVER_STREAM_SUBSCRIBE_REQUES_TLIMIT=1312]="OVER_STREAM_SUBSCRIBE_REQUES_TLIMIT",t))(Mt||{}),rs=(t=>(t[t.STOPED=0]="STOPED",t[t.STARTING=1]="STARTING",t[t.DECODING=2]="DECODING",t[t.FROZEN=3]="FROZEN",t[t.FAILED=4]="FAILED",t))(rs||{}),Ds=(t=>(t[t.INTERNAL=0]="INTERNAL",t[t.NETWORK_CONGESTION=1]="NETWORK_CONGESTION",t[t.NETWORK_RECOVERY=2]="NETWORK_RECOVERY",t[t.UNMUTE=3]="UNMUTE",t[t.MUTE=4]="MUTE",t[t.REMOTE_START=5]="REMOTE_START",t[t.REMOTE_STOP=6]="REMOTE_STOP",t))(Ds||{}),ns=(t=>(t[t.STOPED=0]="STOPED",t[t.STARTING=1]="STARTING",t[t.DECODING=2]="DECODING",t[t.FROZEN=3]="FROZEN",t[t.FAILED=4]="FAILED",t))(ns||{}),zs=(t=>(t[t.INTERNAL=0]="INTERNAL",t[t.NETWORK_CONGESTION=1]="NETWORK_CONGESTION",t[t.NETWORK_RECOVERY=2]="NETWORK_RECOVERY",t[t.UNMUTE=3]="UNMUTE",t[t.MUTE=4]="MUTE",t[t.REMOTE_START=5]="REMOTE_START",t[t.REMOTE_STOP=6]="REMOTE_STOP",t))(zs||{});const Wc={interval:1e3,retryDuration:0};class x3 extends un{constructor(e,i,s){let o=arguments.length>3&&arguments[3]!==void 0&&arguments[3];super(s,ln.STREAM_INDEX_MAIN),m(this,"_state",bi.INIT),m(this,"_stateChangeTs",ee()),m(this,"streamId",void 0),m(this,"Authorization",void 0),m(this,"_backOff",Wc),this.token=i,this.streamId=e,this.logName="WTNLocalStream-".concat(e),this.observer=new Yh(this._ctx,this),this.Authorization=$e.token2auth(s.appId,"",e,i),this._state=o?bi.FAIL:bi.INIT,this.isPublicStream=!0}setState(e,i){const s=this._state;if(s===e)return;this.logger.print("setState",e,i),this._state=e;const o=ee();this.safeEmit(st.onWTNPushStateChanged,{streamId:this.streamId,oldState:s,newState:e,reason:i,elapse:o-this._stateChangeTs}),this._stateChangeTs=o}getPushBackOff(){return this._backOff}updatePushBackOff(){this._backOff.retryDuration+=this._backOff.interval,this._backOff.interval=this._backOff.interval>4e3?8e3:2*this._backOff.interval}resetPushBackOff(){this._backOff=Wc}}class M3 extends Lc{constructor(e,i,s){let o=arguments.length>3&&arguments[3]!==void 0&&arguments[3];super(s,e,e,!1,!0,{audiostream:!0,localaudio:!0,videostream:!0,localvideo:!0,extaudio:!1,extvideo:!1,videoDescriptions:[]}),m(this,"_state",lt.INIT),m(this,"Authorization",void 0),m(this,"_stateChangeTs",ee()),m(this,"streamId",void 0),m(this,"_backOff",Wc),m(this,"_audioState",rs.STOPED),m(this,"_videoState",ns.STOPED),this.token=i,this.streamId=e,this.logName="WTNRemoteStream-".concat(e),this.observer=new XI(this._ctx,this),this._initObserverEvent(o),this.Authorization=$e.token2auth(s.appId,"",e,i),this._state=o?lt.FAIL:lt.INIT,this.isPublicStream=!0}setState(e,i){const s=this._state;if(s===e)return;this.logger.print("setState",e,i),this._state=e;const o=ee();this.safeEmit(st.onWTNPlayStateChanged,{streamId:this.streamId,oldState:s,newState:e,reason:i,elapse:o-this._stateChangeTs}),this._stateChangeTs=o}get state(){return this._state}getPushBackOff(){return this._backOff}updatePushBackOff(){this._backOff.retryDuration+=this._backOff.interval,this._backOff.interval=this._backOff.interval>4e3?8e3:2*this._backOff.interval}resetPushBackOff(){this._backOff=Wc}setVideoState(e,i){this._videoState!==e&&(e===ns.DECODING&&this.setVideoState(ns.STARTING,i),this.logger.print("setVideoState",e,i),this._videoState=e,this.safeEmit(st.onWTNRemoteVideoStateChanged,{streamId:this.streamId,state:e,reason:i}))}setAudioState(e,i){this._audioState!==e&&(e===rs.DECODING&&this.setAudioState(rs.STARTING,i),this.logger.print("setAudioState",e,i),this._audioState=e,this.safeEmit(st.onWTNRemoteAudioStateChanged,{streamId:this.streamId,state:e,reason:i}))}muteToSubMediaType(e,i){let s=!1;const o=Be(this.subMediaType),r=Ve(this.subMediaType);return typeof e=="boolean"&&o===e&&(this.subMediaType+=e?-Q.AUDIO:Q.AUDIO,s=!0),typeof i=="boolean"&&r===i&&(this.subMediaType+=i?-Q.VIDEO:Q.VIDEO,s=!0),s}getEnableMediaType(){return{audio:Be(this.subMediaType),video:Ve(this.subMediaType)}}_initObserverEvent(e){var i,s;(i=this.observer)===null||i===void 0||i.once("recvAudioFirstFrame",(()=>{this.setAudioState(rs.DECODING,e?Ds.NETWORK_RECOVERY:Ds.REMOTE_START)})),(s=this.observer)===null||s===void 0||s.once("recvVideoFirstFrame",(()=>{this.setVideoState(ns.DECODING,e?zs.NETWORK_RECOVERY:zs.REMOTE_START)}))}}const w3=["rid"];var K3=Object.defineProperty,Y3=Object.getOwnPropertyDescriptor,bt=(t,e,i,s)=>{for(var o,r=Y3(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&K3(e,i,r),r};class ct extends Vt{constructor(e){super(),m(this,"_reportName","WTNStream"),m(this,"_localStreams",new Map),m(this,"_remoteStreams",new Map),m(this,"_logger",void 0),m(this,"_monitor",void 0),m(this,"_ontrackCallbackMap",new Map),m(this,"_pushTaskMap",new Map),m(this,"_playTaskMap",new Map),m(this,"engineId",void 0),m(this,"_publicVideoPlayerConfig",new Map),m(this,"__onSEIMessageReceived",void 0),m(this,"__onRemoteStreamStats",void 0),m(this,"__onResubscribe",void 0),m(this,"__onPlayerEvents",void 0),m(this,"_clearSignalListeners",void 0),this._ctx=e,this._monitor=ke(e.id),this._logger=new ue("WTNStream",1,e.id),this.engineId=e.id,this._addSignalListeners()}async startPushWTN(e,i,s,o){var r;let n=arguments.length>4&&arguments[4]!==void 0&&arguments[4];if(s=!!s,o=!!o,this._logger.print("startPushWTN",e,i,s,o),ha(i),!gi(e)&&Le(e,"token"),this._localStreams.get(i))return;const a=new x3(i,e,this._ctx,n);a.on("stats-exception",(c=>{this._logger.print("wtn local stats exception",JSON.stringify(c)),this.safeEmit(st.onWTNLocalStatsException,I(I({},c),{},{streamId:i}))})),this._addLocalStreamEventHandler(a),a.setState(bi.START,Ss.START_PUSH),this._localStreams.set(i,a),await this._ctx.signalingManager.connect(),a.videoTrack=this._ctx.localVideoTrack,a.audioTrack=this._ctx.localAudioTrack,a.pubAudio=!o,a.pubVideo=!s,(r=a.observer)===null||r===void 0||r.setLogin(!0),await new Promise(((c,d)=>{n||this._pushTaskMap.set(i,{resolve:()=>{c(),a.startReport((()=>{}),this._ctx.handler)},reject:d}),this._sendStartPushStreamSignal(a).catch((l=>d(l)))}))}async stopPushWTN(e){var i;this._logger.print("stopPushWTN",e);const s=this._localStreams.get(e);s&&((i=s.observer)===null||i===void 0||i.setLogin(!1),s.setState(bi.STOP,Ss.STOP_PUSH),this._ctx.signalingManager.sendSignaling("stopPushStream",{appId:this._ctx.appId,streamId:e}).catch((()=>{})),await this._stopLocalStream(s))}async muteWTNLocalAudio(e,i){var s;this._logger.print("muteWTNLocalAudio",e,i);const o=this._localStreams.get(e);if(!o)throw new G(C.INVALID_PARAMS,"streamId not found");this._assertNotConnect(),o.pubAudio=!i,(s=o.observer)===null||s===void 0||s.setUnmuteAudio(!i),await this._updatePushStream(o)}async muteWTNLocalVideo(e,i){var s;this._logger.print("muteWTNLocalVideo",e,i);const o=this._localStreams.get(e);if(!o)throw new G(C.INVALID_PARAMS,"streamId not found");this._assertNotConnect(),(s=o.observer)===null||s===void 0||s.setUnmuteVideo(!i),o.pubVideo=!i,await this._updatePushStream(o)}sendWTNSEIMessage(e,i,s){this._logger.info("sendWTNSEIMessage()","streamId: %o, sei: %o, repeatCount: %o",e,i,s);const o=this._localStreams.get(e);if(!o||!o.pubVideo&&!o.pubAudio)return;if(!cs()&&!Qo())return As("Your browser does not support sending SEI"),!1;ko(s,"repeatCount",0,30);const r=typeof i=="string"?new Uint8Array($e.str2ab(i)):i;if(!i.length)return this._logger.warn("sei message must not be empty"),!1;if(r.byteLength>4096)return void this._logger.warn("sei size must not bigger than 4KB");as||this._maybeFillBackFrame2Stream(o);const n=Ts();o.sendSEIMessage({content:r,uuid:n,repeatCount:s+1}),setTimeout((async()=>{if(o){var a;await o.revokeSEIMessage(n)&&(console.error("[RTC WebSDK] sei timeout for message: %o",i),(a=this._monitor)===null||a===void 0||a.report("rtc_sdk_callback",{sdk_callback_name:"sendSEIMessage",message:"timeout for message: ".concat(i),error_code:400}))}}),ae("SEI_TIME_OUT"))}async startPlayWTN(e,i,s,o){var r;let n=arguments.length>4&&arguments[4]!==void 0&&arguments[4];s=!!s,o=!!o,this._logger.print("startPlayWTN",e,i,s,o),ha(i),!gi(e)&&Le(e,"token");let a=this._remoteStreams.get(i);if(a){if(a.state===lt.START||a.state===lt.SUCCESS)throw new G(C.REPEAT_PLAY,"repeat play public media stream");await this.stopPlayWTN(a.streamId)}a=new M3(i,e,this._ctx,n),a.on("stats-exception",(c=>{this._logger.print("wtn remote stats exception",JSON.stringify(c)),this.safeEmit(st.onWTNLocalStatsException,I(I({},c),{},{streamId:i}))})),this._addRemoteStreamEventHandler(a),a.setState(lt.START,Mt.START_PLAY),a.muteToSubMediaType(o,s),this._remoteStreams.set(i,a),(r=a.observer)===null||r===void 0||r.setLogin(!0,a.getEnableMediaType());try{await this._ctx.signalingManager.connect(),await new Promise(((c,d)=>{n||this._playTaskMap.set(i,{resolve:c,reject:d}),this._sendStartPullStreamSignal(a).catch((l=>d(l)))}))}catch(c){throw this._remoteStreams.delete(i),c}}async stopPlayWTN(e){var i,s;this._logger.print("stopPlayWTN",e);const o=this._remoteStreams.get(e);if(o)return o.setState(lt.STOP,Mt.STOP_PLAY),o.setAudioState(rs.STOPED,Ds.MUTE),o.setVideoState(ns.STOPED,zs.MUTE),(i=o.observer)===null||i===void 0||i.setLogin(!1),o==null||(s=o.audioTrack)===null||s===void 0||s.stop(),this._remoteStreams.delete(e),await this._ctx.signalingManager.connect(),this._unsubscribePublicStream(o)}async muteWTNRemoteAudio(e,i){this._logger.print("muteWTNRemoteAudio",e,i),this._assertNotConnect();const s=this._remoteStreams.get(e);if(!s)throw new G(C.INVALID_PARAMS,"streamId not found");var o;s.muteToSubMediaType(i,null)&&((o=s.observer)===null||o===void 0||o.setUnmuteAudio(!i),await this._updatePullStream(e,s),s.setAudioState(i?rs.STOPED:rs.DECODING,i?Ds.MUTE:Ds.UNMUTE))}async muteWTNRemoteVideo(e,i){this._logger.print("muteWTNRemoteVideo",e,i),this._assertNotConnect();const s=this._remoteStreams.get(e);if(!s)throw new G(C.INVALID_PARAMS,"streamId not found");var o;s.muteToSubMediaType(null,i)&&((o=s.observer)===null||o===void 0||o.setUnmuteVideo(!i),await this._updatePullStream(e,s),s.setVideoState(i?ns.STOPED:ns.DECODING,i?zs.MUTE:zs.UNMUTE))}setWTNRemoteVideoPlayer(e,i){var s;if(this._logger.print("setWTNRemoteVideoPlayer()","streamId: %o, videoPlayerOption: %o",e,i),(s=this._publicVideoPlayerConfig.get(e))===null||s===void 0||(s=s.player)===null||s===void 0||s.destroy(),!i.renderDom)return void this._publicVideoPlayerConfig.delete(e);const o=new Fs(this._ctx.id,Ft,I(I({},i),{},{isLocal:!1,userId:e})),r=I(I({},i),{},{player:o});return this._publicVideoPlayerConfig.set(e,r),this._updateVideoPlayerState(e),o.domElement}setWTNRemoteAudioPlaybackVolume(e,i){var s;Le(e,"publicStreamId"),i=Fd(i,"volume",0,400),this._ctx.publicAudioVolume.set(e,i),(s=this._remoteStreams.get(e))===null||s===void 0||(s=s.audioTrack)===null||s===void 0||s.setVolume(i)}__getRemoteStreams(){return this._remoteStreams}__getPublicStreamTrack(e,i){const s=this._remoteStreams.get(e);if(s)return i==="video"?s.videoTrack:s.audioTrack}async _updatePushTrack(){this._localStreams.size!==0&&(this._logger.info("_updatePushTrack()"),await this._ctx.signalingManager.connect(),this._localStreams.forEach((async e=>{var i;e.videoTrack=this._ctx.localVideoTrack,e.audioTrack=this._ctx.localAudioTrack,(i=e.observer)===null||i===void 0||i.setEnableVideo(!0),await this._updatePushStream(e)})))}getWTNVideoPlayerVisibility(e){var i;const s=(i=this._publicVideoPlayerConfig.get(e))===null||i===void 0?void 0:i.player;if(!s)return;const o=s.getPlayerVisibility();return{descriptor:{streamId:e,mediaType:Q.VIDEO},status:o}}destroy(){var e;this._remoteStreams.forEach((i=>{i.destroy()})),this._remoteStreams=new Map,this.removeAllListeners(),this._ontrackCallbackMap.clear(),this._publicVideoPlayerConfig.forEach((i=>{i.player.destroy()})),this._publicVideoPlayerConfig.clear(),(e=this._clearSignalListeners)===null||e===void 0||e.call(this)}async _sendStartPushStreamSignal(e){var i,s,o,r;this._logger.print("_sendStartPushStreamSignal()","streamId: %s",e.streamId);const{streamId:n,Authorization:a,pubAudio:c,pubVideo:d}=e,{handler:l}=this._ctx;await l?.getDefaultSdp();const u=await l.publish(e),p=await Ca(),{appId:h,businessId:_,useCloudProxy:y}=this._ctx,b={appId:h,streamId:n,Authorization:a,sdpInfo:{msid:e.stream.id,type:u.type,sdp:u.partialSdp,semantics:u.semantics},timestamp:Date.now(),params:{appId:h,businessId:_,userAgent:window.navigator.userAgent,sdkVersion:de.VERSION,deviceId:We.getDeviceId(),enableCloudProxy:y,channelProfile:"0",SDKCodecNegotiation:!0,supportedCodecs:p,sdkType:"rtc",joinRoomMode:1,deviceType:"web",rtsMode:this._ctx.rtsMode,mediaProcessingType:(i=de.MEDIA_PROCESSING_TYPE)!==null&&i!==void 0?i:0},options:{supportCheckTokenPrivilege:!0,supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0,enableStreamStatusCallback:!0},attributes:{localaudio:!!e.audioTrack,localvideo:!!e.videoTrack,videostream:d,audiostream:c,extvideo:((s=e.videoTrack)===null||s===void 0?void 0:s.sourceType)===Ne.EXTERNAL,extaudio:((o=e.audioTrack)===null||o===void 0?void 0:o.sourceType)===Ne.EXTERNAL,videoDescriptions:u.videoDescriptions.map((g=>bo(g,w3))),videoType:Lt.NORMAL},video:d,audio:c,screen:e.isScreen,accessParams:JSON.stringify({requireICEUfragV2:!0})};let S;try{this.emit("__onSendingPushStreamMessageHook"),S=await this._ctx.signalingManager.sendSignaling("startPushStream",b)}catch(g){if(await l?.rollback({msid:e.stream.id,stream:e,audioMid:u.audioMid,videoMid:u.videoMid}),g.code>=500&&g.code<600){const Z=e.getPushBackOff();if(Z.retryDuration<6e4)return this._logger.info("pushRetry","start msid: %s, retryDuration: %s",e.id,Z.retryDuration),await new Promise((R=>setTimeout(R,Z.interval))),e.updatePushBackOff(),e.resetStream(),e.setState(bi.START,Ss.IN_RETRY),this._sendStartPushStreamSignal(e);throw this._logger.info("pushRetry","end"),e.setState(bi.FAIL,Ss.RETRY_FAIL),await this._stopLocalStream(e),e.resetPushBackOff(),new G(C.WTN_PUSH_FAILED,g.message||"server error")}if(g.code===401)throw e.setState(bi.FAIL,Ss.NO_PUSH_PERMISSION),await this._stopLocalStream(e),new G(C.WTN_PUSH_FAILED,g.message||"token error");if(g.code===C.OPERATION_CANCEL&&this._ctx.signalingManager.isReconnecting())return;throw new G(C.WTN_PUSH_FAILED,g.message||"push error")}e.pubAttributes=b.attributes;const v=await e.getSelectedCodec();e.currentVideoCodec=v;const f=new Promise(((g,Z)=>{var R,T;l?.handleAck({action:Se.publish,streamId:n,audioMid:u.audioMid,videoMid:u.videoMid,audioTransceiverInit:u?.audioTransceiverInit,videoTransceiverInit:u?.videoTransceiverInit,signalingAck:{sdp:(R=S)===null||R===void 0||(R=R.relayMessage)===null||R===void 0?void 0:R.sdp,sequenceId:(T=S)===null||T===void 0||(T=T.relayMessage)===null||T===void 0?void 0:T.sequenceId},stream:e,videoCodec:v,onSuccess:()=>{this._logger.info("pushStream()","pushStream success"),e.setState(bi.SUCCESS,Ss.PUSH_SUCCESS),g(0)},onFail:X=>{this._logger.info("pushStream()","pushStream fail"),Z(X)}})}));!Te&&await f,(r=this._pushTaskMap.get(n))===null||r===void 0||r.resolve(),this._pushTaskMap.delete(n)}async _stopLocalStream(e){var i;e.stopBlackFrame(),await((i=this._ctx.handler)===null||i===void 0?void 0:i.handleAck({action:Se.unpublish,audioMid:e.audioMid,videoMid:e.videoMid,stream:e,streamId:e.streamId})),e.destroy(),this._localStreams.delete(e.streamId)}async _updatePushStream(e){var i,s,o,r;const{videoTrack:n,audioTrack:a,pubAudio:c,pubVideo:d}=e;let l=(i=e.audioTrack)===null||i===void 0?void 0:i.preprocessingTrack;const u=(s=e.videoTrack)===null||s===void 0?void 0:s.preprocessingTrack;var p,h;if(d&&u?(e.stopBlackFrame(),await((p=e.videoTransceiver)===null||p===void 0?void 0:p.sender.replaceTrack(u))):await((h=e.videoTransceiver)===null||h===void 0?void 0:h.sender.replaceTrack(null)),c&&l){var _;const{mixType:f,mixedAudioTrack:g}=e.audioTrack;g&&f!==Ti.PLAYOUT&&l.enabled&&(l=g),await((_=e.audioTransceiver)===null||_===void 0?void 0:_.sender.replaceTrack(l))}else{var y;await((y=e.audioTransceiver)===null||y===void 0?void 0:y.sender.replaceTrack(null))}const b={localaudio:!!a,localvideo:!!n,videostream:d,audiostream:c,extvideo:n?.sourceType===Ne.EXTERNAL,extaudio:a?.sourceType===Ne.EXTERNAL,videoType:n?Lt.NORMAL:e.pubAttributes.videoType},S={};for(const[f,g]of Object.entries(b))g!==Reflect.get(e.pubAttributes,f)&&Reflect.set(S,f,g);var v;Object.keys(S).length&&(e.pubAudio=(o=b.audiostream)!==null&&o!==void 0?o:e.pubAudio,e.pubVideo=(r=b.videostream)!==null&&r!==void 0?r:e.pubVideo,e.pubAttributes=I(I({},e.pubAttributes),b),e.pubAttributes.videostream||e.stopBlackFrame(),await this._ctx.signalingManager.sendSignaling("updatePushStream",{appId:this._ctx.appId,streamId:e.streamId,attributes:b}),Te&&await((v=this._ctx.handler)===null||v===void 0?void 0:v.setCurrentDescription()))}async _sendStartPullStreamSignal(e){var i,s,o,r,n;this._logger.print("startPullStream()","streamId:",e.streamId);const{streamId:a,Authorization:c}=e,{handler:d}=this._ctx,l=await d?.subscribe(e,{multiChatMode:!1});if(!l)throw new G(C.ADD_TRANSCEIVER_FAILED,"add transceiver failed");const u=ee(),{audioMid:p,videoMid:h}=l,{appId:_,businessId:y,useCloudProxy:b}=this._ctx,S=await Ca(),v={appId:_,streamId:a,Authorization:c,audio:!0,video:!0,screen:!1,timestamp:Date.now(),sdpInfo:{sdp:l.partialSdp,semantics:l.semantics,type:l.type},params:{appId:_,businessId:y,userAgent:window.navigator.userAgent,sdkVersion:de.VERSION,deviceId:We.getDeviceId(),enableCloudProxy:b,channelProfile:"0",SDKCodecNegotiation:!0,supportedCodecs:S,sdkType:"rtc",joinRoomMode:1,deviceType:"web",rtsMode:this._ctx.rtsMode,mediaProcessingType:(i=de.MEDIA_PROCESSING_TYPE)!==null&&i!==void 0?i:0},options:{supportCheckTokenPrivilege:!0,supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0,enableStreamStatusCallback:!0},config:{enableMediaType:e.getEnableMediaType(),qualityLayer:{spatialLayer:0,temporalLayer:0}},accessParams:JSON.stringify({requireICEUfragV2:!0}),extra:{enableSendRTT:!0}};let f;try{this.emit("__onSendingPullStreamMessageHook"),f=await this._ctx.signalingManager.sendSignaling("startPullStream",v)}catch(X){if(await d?.rollback({msid:a,stream:e}).catch((()=>{})),X.code===401)throw e.setState(lt.FAIL,Mt.NO_PLAY_PERMISSION),new G(C.WTN_PLAY_FAILED,X.message||"token error");if(X.code===433)throw e.setState(lt.FAIL,Mt.OVER_CLIENT_SUBSCRIBE_STREAM_LIMIT),new G(C.WTN_PLAY_FAILED,X.message||"over client subscribe stream limit");if(X.code===434)throw e.setState(lt.FAIL,Mt.OVER_STREAM_SUBSCRIBE_USER_LIMIT),new G(C.WTN_PLAY_FAILED,X.message||"over stream subscribe user limit");if(X.code===C.OPERATION_CANCEL&&this._ctx.signalingManager.isReconnecting())return;throw e.setState(lt.FAIL,Mt.INTERNAL),new G(C.WTN_PLAY_FAILED,X.message||"play wtn error")}const g=[];g.push(new Promise(((X,L)=>{const W=setTimeout((()=>L(new G(C.WTN_PLAY_FAILED,"wait video timeout for streamId: ".concat(a)))),6e4),M=k=>{k.mediaType==="video"&&(this._logger.success("remoteStream ".concat(e.userId," received video track")),e.off("ontrack",M),clearTimeout(W),X(0))};e.on("ontrack",M)}))),g.push(new Promise(((X,L)=>{const W=setTimeout((()=>L(new G(C.WTN_PLAY_FAILED,"wait audio timeout for streamId: ".concat(a)))),6e4),M=k=>{k.mediaType==="audio"&&(this._logger.success("remoteStream ".concat(e.userId," received audio track")),e.off("ontrack",M),clearTimeout(W),X(0))};e.on("ontrack",M)})));const Z=X=>{e.ontrack(X)};(s=this._ctx.handler)===null||s===void 0||s.on("ontrack",Z),this._ontrackCallbackMap.set(e,Z);const{sequenceId:R,sdp:T}=f.relayMessage;e.videoMid=h,e.audioMid=p,e.sequenceId=R,e.streamState=Yt.SUB_ED,await((o=this._ctx.handler)===null||o===void 0?void 0:o.handleAck({action:Se.subscribe,streamId:a,audioMid:p,videoMid:h,audioTransceiverInit:l.audioTransceiverInit,videoTransceiverInit:l.videoTransceiverInit,signalingAck:{sdp:T,sequenceId:R},stream:e})),await Promise.all(g),(r=this._monitor)===null||r===void 0||r.report("rtc_subscribe_stat",{result:"success",start:u,message:"unknown",stream_user_id:e.userId}),e.startReport((X=>{var L;X.publicStreamId=X.userId,delete X.userId,delete X.isScreen;const W=Kt(X);W.audioStats&&this.safeEmit(st.onWTNRemoteAudioStats,{streamId:e.streamId,audioStats:W.audioStats}),W.videoStats&&this.safeEmit(st.onWTNRemoteVideoStats,{streamId:e.streamId,videoStats:W.videoStats}),(L=this.__onRemoteStreamStats)===null||L===void 0||L.call(this,W)}),this._ctx.handler),this._updateVideoPlayerState(a),this._initAudioPlayer(a),e.subVideo=e.getEnableMediaType().video,e.subAudio=e.getEnableMediaType().audio,(n=this._playTaskMap.get(a))===null||n===void 0||n.resolve(),this._playTaskMap.delete(a)}async _unsubscribePublicStream(e){var i;Vr("_unsubscribePublicStream()",e,this._logger);const s={appId:this._ctx.appId,streamId:e.streamId};try{await this._ctx.signalingManager.sendSignaling("stopPullStream",s)}catch{}e.streamState=Yt.INIT,await((i=this._ctx.handler)===null||i===void 0?void 0:i.handleAck({action:Se.unsubscribe,streamId:e.streamId,audioMid:e.audioMid,videoMid:e.videoMid,stream:e})),e.subMediaType=ti.NONE,this._removeOnTrackListener(e),e.statsReport.unsubscribe(),e.destroy()}async _updatePullStream(e,i){const s=i.getEnableMediaType();await this._ctx.signalingManager.sendSignaling("updatePullStream",{appId:this._ctx.appId,streamId:e,config:{enableMediaType:s}}),i.subVideo=s.video,i.subAudio=s.audio}_removeOnTrackListener(e){const i=this._ontrackCallbackMap.get(e);if(i){const s=e.vendorHandler||this._ctx.handler;s?.off("ontrack",i),this._ontrackCallbackMap.delete(e)}}_addSignalListeners(){const e={[Fe.ON_CONNECTION_STATE_CHANGE]:i=>{i.state===fe.CONNECTION_STATE_RECONNECTED?(Array.from(this._remoteStreams.values()).forEach((s=>{const{streamId:o,token:r}=s,{audio:n,video:a}=s.getEnableMediaType();s.destroy(),this._remoteStreams.delete(o),this.startPlayWTN(r,o,!a,!n,!0).then((()=>{var c;(c=this.__onResubscribe)===null||c===void 0||c.call(this,{stream:s})}))})),Array.from(this._localStreams.values()).forEach((s=>{const{token:o,pubAudio:r,pubVideo:n}=s;s.destroy(),this._localStreams.delete(s.streamId),this.startPushWTN(o,s.streamId,!n,!r,!0)}))):i.state===fe.CONNECTION_STATE_DISCONNECTED&&(this._remoteStreams.forEach((s=>{s.setState(lt.FAIL,Mt.IN_RETRY),s.setAudioState(rs.FROZEN,Ds.NETWORK_CONGESTION),s.setVideoState(ns.FROZEN,zs.NETWORK_CONGESTION)})),this._localStreams.forEach((s=>{s.setState(bi.FAIL,Ss.IN_RETRY)})))},[O.ON_STREAM_PUSHED_BY_OTHER]:i=>{const s=this._localStreams.get(i.streamId);this._logger.print("_addSignalListeners","onStreamPushedByOther",i.streamId),s&&(s.setState(bi.FAIL,Ss.STREAM_PUSH_BY_OTHER),this._stopLocalStream(s))},[O.ON_STREAM_PULL_STATE_CHANGED]:async i=>{const s=this._remoteStreams.get(i.streamId);if(this._logger.print("_addSignalListeners","onStreamPullStateChanged",i),s)switch(i.code){case 0:s.setState(lt.SUCCESS,Mt.PLAY_SUCCESS);break;case 1:case 2:case 3:const r={1:Mt.STREAM_NOT_EXIST,2:Mt.REMOTE_STOP,3:Mt.REMOTE_FAILURE}[i.code];s.setAudioState(rs.STOPED,Ds.REMOTE_STOP),s.setVideoState(ns.STOPED,zs.REMOTE_STOP),s.setState(lt.FAIL,r);break;case 4:const n=s.getPushBackOff();var o;n.retryDuration<6e4?(this._logger.info("subRetry",s.streamId,n.retryDuration),s.setState(lt.START,Mt.IN_RETRY),await new Promise((a=>setTimeout(a,n.interval))),s.updatePushBackOff(),await((o=this._ctx)===null||o===void 0||(o=o.handler)===null||o===void 0?void 0:o.handleAck({action:Se.unsubscribe,streamId:s.streamId,audioMid:s.audioMid,videoMid:s.videoMid,stream:s})),s.clean(),await this._sendStartPullStreamSignal(s)):(s.setState(lt.FAIL,Mt.RETRY_FAIL),this._logger.info("subRetry","end",s.streamId),s.resetPushBackOff())}},[ds.RTT]:i=>{const{StreamIds:s,Metadata:o}=i;if(s!=null&&s.length&&o){const r=s[0];this._ctx.streamRTT[r]={audio:o.audio_rtt,video:o.video_rtt}}}};Object.keys(e).forEach((i=>{this._ctx.signalingManager.on(i,e[i])})),this._clearSignalListeners=()=>{Object.keys(e).forEach((i=>{this._ctx.signalingManager.off(i,e[i])}))}}_addLocalStreamEventHandler(e){e.on(st.onWTNPushStateChanged,(i=>{this.safeEmit(st.onWTNPushStateChanged,i)}))}_addRemoteStreamEventHandler(e){e.on(st.onWTNPlayStateChanged,(i=>{this.safeEmit(st.onWTNPlayStateChanged,i)})),e.on(st.onWTNRemoteAudioStateChanged,(i=>{this.safeEmit(st.onWTNRemoteAudioStateChanged,i)})),e.on(st.onWTNRemoteVideoStateChanged,(i=>{this.safeEmit(st.onWTNRemoteVideoStateChanged,i)})),e.on("onSEIMessage",(i=>{if(i instanceof Uint8Array){const o=aY(i);for(let r=0;r<o.seiCount;r++){var s;(s=this.__onSEIMessageReceived)===null||s===void 0||s.call(this,{sei:o.seis[r],publicStreamId:e.streamId}),this.safeEmit(st.onWTNSEIMessageReceived,{streamId:e.streamId,sei:o.seis[r]})}}}))}_updateVideoPlayerState(e){const i=this._remoteStreams.get(e);if(i){const r=this._publicVideoPlayerConfig.get(e);var s,o;r&&((s=i.videoTrack)===null||s===void 0||s.setPlayer(this._ctx.id,r,(o=this._ctx)===null||o===void 0?void 0:o.autoPlayPolicy,this._initPlayerEvents.bind(this)))}}_initAudioPlayer(e){const i=this._remoteStreams.get(e);if(i!=null&&i.audioTrack){var s,o;const r=new Cc(this._ctx.id,e,{muted:((s=this._ctx)===null||s===void 0?void 0:s.autoPlayPolicy)===oo.VIDEO_ONLY||((o=this._ctx)===null||o===void 0?void 0:o.autoPlayPolicy)===oo.PLAY_MANUALLY,isScreen:!1});i.audioTrack.setPlayer(r),i.audioTrack.bindPlayerEvent(this._initPlayerEvents.bind(this)),i.audioTrack.play()}}_initPlayerEvents(e){var i;let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:V.STREAM_INDEX_MAIN;(i=this.__onPlayerEvents)===null||i===void 0||i.call(this,e,s,o),e.on("playback_event",(r=>{const n=this._remoteStreams.get(e.userId);if(r.eventName==="loadeddata"){const a=()=>{n&&r.type==="video"&&this.safeEmit(st.onWTNFirstRemoteVideoFrameDecoded,{streamId:n.streamId})};n==null||!n.observer||n.observer.audioFirstFrameReceived?a():n.observer.once("recvVideoFirstFrame",a)}}))}async _maybeFillBackFrame2Stream(e){var i;if(e.refreshBlackFrameLifetime(),(i=e.videoTransceiver)===null||i===void 0||!i.sender.track){var s;const o=await e.getSelectedCodec(),r=e.genBlackFrame(o);if(!r)return;(s=e.videoTransceiver)===null||s===void 0||(s=s.sender)===null||s===void 0||s.replaceTrack(r),e.pubAttributes.videoType=Lt.BLACK,this._ctx.signalingManager.sendSignaling("updatePushStream",{streamId:e.streamId,appId:this._ctx.appId,attributes:{videoType:Lt.BLACK}}),e.on("black-frame-ended",(()=>{var n;(n=e.videoTransceiver)===null||n===void 0||(n=n.sender)===null||n===void 0||n.replaceTrack(null),e.pubAttributes.videoType=Lt.NORMAL,this._ctx.signalingManager.sendSignaling("updatePushStream",{streamId:e.streamId,appId:this._ctx.appId,attributes:{videoType:Lt.NORMAL}})}))}}safeEmit(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return wr(this._ctx.id,e,s),super.safeEmit(e,...s)}_assertNotConnect(){if(!this._ctx.signalingManager.isConnected())throw new G(C.NOT_CONNECTED_YET,"server not connected")}}bt([P()],ct.prototype,"startPushWTN"),bt([P()],ct.prototype,"stopPushWTN"),bt([P()],ct.prototype,"muteWTNLocalAudio"),bt([P()],ct.prototype,"muteWTNLocalVideo"),bt([P()],ct.prototype,"sendWTNSEIMessage"),bt([P()],ct.prototype,"startPlayWTN"),bt([P()],ct.prototype,"stopPlayWTN"),bt([P()],ct.prototype,"muteWTNRemoteAudio"),bt([P()],ct.prototype,"muteWTNRemoteVideo"),bt([P()],ct.prototype,"setWTNRemoteVideoPlayer"),bt([P()],ct.prototype,"setWTNRemoteAudioPlaybackVolume"),bt([P()],ct.prototype,"getWTNVideoPlayerVisibility"),bt([Hi],ct.prototype,"_sendStartPushStreamSignal"),bt([Hi],ct.prototype,"_stopLocalStream"),bt([Hi],ct.prototype,"_sendStartPullStreamSignal"),bt([Hi],ct.prototype,"_unsubscribePublicStream");const Ae=new ue("AudioDeviceManager",1);class H3 extends Ai.EventEmitter{constructor(e){super(),m(this,"_audioLevelFetcher",void 0),m(this,"_playbackDeviceTestTimer",void 0),m(this,"_audioElement",void 0),m(this,"_audioTrack",void 0),m(this,"_mediaRecorder",void 0),m(this,"_recoderTimer",void 0),m(this,"_isAudioPlaybackDeviceTesting",!1),m(this,"_isAudioDeviceRecordTesting",!1),m(this,"_audioCaptureAndRecoderResolve",void 0),m(this,"_onAutoplayFailed",void 0),m(this,"_audioPlaybackDeviceId",void 0),this._ctx=e}get audioTrack(){return this._audioTrack}async startAudioPlaybackDeviceTest(e,i){if(this._isAudioPlaybackDeviceTesting||this._isAudioDeviceRecordTesting)throw new G(C.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");this._isAudioPlaybackDeviceTesting=!0,Ae.info("startAudioPlaybackDeviceTest()","Invoke");try{await this._playAudioFile(e,{loop:!0})}catch(s){throw Ae.error("startAudioPlaybackDeviceTest()","error",s),this.stopAudioPlaybackDeviceTest(),s}this._startEmitAudioPlaybackDeviceTestVolume(i)}stopAudioPlaybackDeviceTest(){this._isAudioPlaybackDeviceTesting&&(Ae.info("stopAudioPlaybackDeviceTest()","Invoke"),this._isAudioPlaybackDeviceTesting=!1,this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}async startAudioDeviceRecordTest(e,i,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:3e4;if(!window.MediaRecorder)throw new G(C.NOT_SUPPORTED,"Your browser does not support MediaRecorder.");if(this._isAudioDeviceRecordTesting||this._isAudioPlaybackDeviceTesting)throw new G(C.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");this._isAudioDeviceRecordTesting=!0,Ae.info("startAudioDeviceRecordTest()","Invoke"),this._recoderTimer=setTimeout((()=>{Ae.info("startAudioDeviceRecordTest()","".concat(o,'ms automatic call method "stopAudioDeviceRecordAndPlayTest"')),this._stopAudioCaptureAndRecoder()}),o);try{this._onAutoplayFailed=i,await this._startAudioCaptureAndRecoder(e,s??100)}catch(r){throw this._isAudioDeviceRecordTesting=!1,delete this._onAutoplayFailed,r}delete this._audioCaptureAndRecoderResolve}stopAudioDeviceRecordAndPlayTest(){Ae.info("stopAudioDeviceRecordAndPlayTest()","Invoke"),this._recoderTimer!==void 0&&(clearTimeout(this._recoderTimer),delete this._recoderTimer),this._stopAudioCaptureAndRecoder()}stopAudioDevicePlayTest(){this._isAudioDeviceRecordTesting&&(Ae.info("stopAudioDevicePlayTest()","Invoke"),this._isAudioDeviceRecordTesting=!1,this._mediaRecorder&&(this._mediaRecorder.ondataavailable=null),this.stopAudioDeviceRecordAndPlayTest(),this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement()),delete this._onAutoplayFailed}getRecordTrack(){return this._audioTrack}async setSinkId(e){if(Ae.info("setSinkId()","Invoke"),HTMLAudioElement.prototype.setSinkId===void 0)throw new G(C.NOT_SUPPORTED,"setSinkId not supported by current browser");const i=await _t.getAudioPlaybackDeviceById(e);if(!i)throw new G(C.INVALID_DEVICE_ID,"audio playback device id ".concat(e," is invalid"));return this._audioPlaybackDeviceId=e,this._setAudioCtxSinkId(),i}getSinkId(){return this._audioPlaybackDeviceId}destroy(){Ae.info("destroy()","Invoke"),super.removeAllListeners(),this.stopAudioPlaybackDeviceTest(),this.stopAudioDevicePlayTest()}async _playAudioFile(e,i){return Ae.info("_playAudioFile()","Invoke url=".concat(e,"; loop=").concat(i.loop)),new Promise(((s,o)=>{const r=Fp("audio",{attributes:{src:e,crossOrigin:"anonymous"}});this._audioElement=r,r.loop=i.loop,this._audioLevelFetcher=new Yp(r),r.onplaying=()=>{r.onplaying=null,Ae.info("_playAudioFile()","onplaying"),s()},r.onerror=async n=>{var a;Ae.error("_playAudioFile()","onerror",n);const c=n.message||(r==null||(a=r.error)===null||a===void 0?void 0:a.message);o(new G(C.LOAD_RESOURCES_FAILED,"Failed to play recorded audio".concat(c?", reason: ".concat(c):".")))},this._setAudioCtxSinkId().then((()=>{var n,a;return(n=r.play())===null||n===void 0||(a=n.catch)===null||a===void 0?void 0:a.call(n,(c=>{Ae.warn("_playAudioFile()","autoplay error",c);const d="Failed to play recorded audio, ".concat(c.name,": ").concat(c.message);c.name==="NotAllowedError"&&this._onAutoplayFailed?this._onAutoplayFailed((()=>{var l;return Promise.all([(l=this._audioLevelFetcher)===null||l===void 0?void 0:l.resume(),r.play()])})):o(new G(C.LOAD_RESOURCES_FAILED,d))}))}))}))}_destroyAudioElement(){this._audioElement&&(Ae.info("_destroyAudioElement()","Invoke"),this._audioElement.onplaying=null,this._audioElement.onerror=null,this._audioElement.src="",delete this._audioElement,typeof this._audioCaptureAndRecoderResolve=="function"&&this._audioCaptureAndRecoderResolve())}_startEmitAudioPlaybackDeviceTestVolume(e){e=Math.max(e,100),this._audioElement&&(Ae.info("_startEmitAudioPlaybackDeviceTestVolume()","start timer(".concat(e,"ms)")),this._playbackDeviceTestTimer=self.setInterval((()=>{this._audioLevelFetcher&&this.emit("onAudioPlaybackDeviceTestVolume",this._audioLevelFetcher.getAudioLevel())}),e))}_stopEmitAudioPlaybackDeviceTestVolume(){var e;this._playbackDeviceTestTimer!==void 0&&(Ae.info("_stopEmitAudioPlaybackDeviceTestVolume()","stop timer"),self.clearInterval(this._playbackDeviceTestTimer),delete this._playbackDeviceTestTimer),(e=this._audioLevelFetcher)===null||e===void 0||e.destroy(),delete this._audioLevelFetcher}async _startAudioCaptureAndRecoder(e,i){this._audioTrack=await Kh(this._ctx,this._ctx.audioProfileManager.getConstraints()),this._audioTrack.setVolume(i+.01);const s=new MediaStream([this._audioTrack.preprocessingTrack]);return Ae.info("startAudioDeviceRecordTest()","create microphone track success!"),new Promise(((o,r)=>{let n;typeof MediaRecorder.isTypeSupported=="function"&&(n=["audio/webm","audio/mp4"].find((c=>MediaRecorder.isTypeSupported(c))),Ae.info("startAudioDeviceRecordTest()","use mimeType: ".concat(n))),this._mediaRecorder=new MediaRecorder(s,n?{mimeType:n}:void 0);const a=this._mediaRecorder.mimeType;this._mediaRecorder.ondataavailable=async c=>{if(this._isAudioDeviceRecordTesting){var d;Ae.info("startAudioDeviceRecordTest()","get recorded file(mimeType: ".concat(a,")."));const l=new Blob([c.data],{type:a});try{await this._playAudioFile(fi.createObjectURL(l),{loop:!1})}catch(u){return r(u)}this._startEmitAudioPlaybackDeviceTestVolume(e),(d=this._audioElement)===null||d===void 0||d.addEventListener("ended",(()=>{this.stopAudioDevicePlayTest(),o()})),this._audioCaptureAndRecoderResolve=o}else o()},this._mediaRecorder.onerror=c=>{r(new G(C.AUDIO_DEVICE_TEST_FAILED,c.message||"mediaRecorder error"))},this._audioCaptureAndRecoderResolve=o,this._mediaRecorder.start()}))}_stopAudioCaptureAndRecoder(){var e;this._mediaRecorder&&(this._mediaRecorder.state==="recording"&&this._mediaRecorder.stop(),delete this._mediaRecorder),(e=this._audioTrack)===null||e===void 0||e.destroy(),delete this._audioTrack}async _setAudioCtxSinkId(){let e=this._audioPlaybackDeviceId;if(e){e==="default"&&(e="");try{var i,s;(i=oi.getAudioContextInstance())===null||i===void 0||(s=i.setSinkId)===null||s===void 0||s.call(i,e),Ae.info("setSinkId","ctx.sinkId=".concat(e))}catch(o){Ae.error("setSinkId","failed, ".concat(o.name," - ").concat(o.message))}}}}const LI=()=>({url:"",video:{codec:Ng.H264,width:640,height:360,fps:15,gop:2,kBitRate:WI(640,360,15)},audio:{codec:"AAC",kBitRate:64,sampleRate:48e3,channels:2,AACProfile:aa.LC},layout:{regions:[],appData:"",backgroundColor:"#000000"}});function WI(t,e,i){return t*e<=288e3?i<=15?800:1200:t*e<=864e3?i<=15?1200:1800:t*e<=1152e3?i<=15?1600:2400:t*e<=2592e3?i<=15?2500:3750:i<=15?3300:5e3}function GI(t){if(typeof t!="string"||!/^rtmps?:\/\//.test(t))throw new G(C.INVALID_PARAMS,"Invalid rtmp address")}function VI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(t==null||!t.length)throw new G(C.INVALID_PARAMS,"regions should not be empty.");for(const e of t){if(typeof e.userId!="string")throw new G(C.INVALID_PARAMS,"region.userId(".concat(e.userId,") should be a string."));if(wt(e.userId),typeof e.isScreenStream!="boolean")throw new G(C.INVALID_PARAMS,"region.isScreenStream(".concat(e.isScreenStream,") should be a boolean."))}}function EI(t,e){var i,s;const o=(u,p)=>{const h=u.reduce(((y,b)=>y?.[b]),e),_=u.reduce(((y,b)=>y?.[b]),LI());return h&&p(h)?h:_},r=u=>u%2==0?u:u+1,n=r(o(["video","width"],(u=>u>=2&&u<=1920))),a=r(o(["video","height"],(u=>u>=2&&u<=1920))),c=o(["video","fps"],(u=>u>=1&&u<=60)),d=((i=e.video)===null||i===void 0?void 0:i.kBitRate)||0,l=o(["audio","sampleRate"],(u=>!![32e3,44100,48e3].find((p=>p===u||p/1e3===u))));return{type:"transcode",action:t,transcodeMeta:{transcode:{url:e.url},control:{protocol:"2.0"},audio:{codec:o(["audio","codec"],(u=>u==="AAC")),bitRate:1e3*o(["audio","kBitRate"],(u=>u>=32&&u<=192)),sampleRate:l<100?1e3*l:l,channels:o(["audio","channels"],(u=>[1,2].includes(u))),profile:o(["audio","AACProfile"],(u=>[aa.LC,aa.HEv1,aa.HEv2].includes(u)))},video:{codec:o(["video","codec"],(u=>["H264","H265"].includes(u))),fps:c,gop:o(["video","gop"],(u=>u>=1&&u<=5))*c,bitRate:1e3*(d>=16&&d<=1e4?d:WI(n,a,c)),width:n,height:a},layout:{canvas:{bgnd:o(["layout","backgroundColor"],(u=>/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(u)))},regions:((s=e.layout)===null||s===void 0||(s=s.regions)===null||s===void 0?void 0:s.map((u=>({alpha:!u.alpha||Number(u.alpha)>1||Number(u.alpha)<=0?1:Number(u.alpha),uid:u.userId,zorder:!u.zorder||Number(u.zorder)<0||Number(u.zorder)>100?0:Number(u.zorder),x:!u.x||Number(u.x)>=1||Number(u.x)<0?0:Number(u.x),y:!u.y||Number(u.y)>=1||Number(u.y)<0?0:Number(u.y),w:!u.w||Number(u.w)>1||Number(u.w)<=0?1:Number(u.w),h:!u.h||Number(u.h)>1||Number(u.h)<=0?1:Number(u.h),renderMode:u.renderMode&&[1,2,3].includes(u.renderMode)?u.renderMode:1,contentControl:u.contentControl&&[0,1,2].includes(u.contentControl)?u.contentControl:0,screen:!!u.isScreenStream}))))||[],app_data:o(["layout","appData"],(u=>typeof u=="string"))}}}}function F3(t){var e;GI(t.url),VI((e=t.layout)===null||e===void 0?void 0:e.regions)}function O3(t){var e;t.url&&GI(t.url),VI((e=t.layout)===null||e===void 0?void 0:e.regions)}function J3(t){return EI("started",t)}function U3(t){return EI("layoutChanged",t)}const Zr={getDefaultValue:LI,checkStartParams:F3,checkUpdateParams:O3,getStartParams:J3,getUpdateParams:U3};let Vm;const A3=t=>{Vm&&clearTimeout(Vm),Vm=setTimeout((()=>{for(const[e,i]of t)e!=null&&e.startsWith("mux")&&i.forEach((s=>{var o;(o=s.audioTrack)===null||o===void 0||o.pause()}));for(const[e,i]of t)e!=null&&e.startsWith("mux")&&i.forEach((s=>{var o;(o=s.audioTrack)===null||o===void 0||o.play()}))}),2e3)};var D3=he,z3=Xn,Q3=kc;D3({target:"Object",stat:!0},{fromEntries:function(t){var e={};return z3(t,(function(i,s){Q3(e,i,s)}),{AS_ENTRIES:!0}),e}});var j3=zt,B3=j3.Object.fromEntries,$3=B3,q3=$3,ez=q3,tz=ez,iz=tz,sz=iz,oz=sz,rz=oz,Ko=Ie(rz);const nz=["ele","fakeEle"],az=["orgTrack","mediaTrack","preprocessingTrack"],dz=["orgTrack","mediaTrack","preprocessingTrack"],nv=["currentTime","duration","ended","error","muted","networkState","paused","readyState","seekable","sinkId","src","volume"],cz=["currentTime","sampleRate","state","baseLatency","outputLatency","sinkId"],tc=["contentHint","enabled","id","kind","label","muted","readyState"],lz=["currentDirection","direction","mid","stopped"];let Ei;async function uz(t){const e=Date.now();let i=[];t._ctx.handler&&t._ctx.handler._peerConnection&&(i=await t._ctx.handler._peerConnection.getStats());const s=[];return i.forEach((o=>{s.push(o)})),{timestamp:e,stats:s}}function av(t){const e={};if(t instanceof MediaStream){e.id=t.id,e.active=t.active;const i=t.getTracks();e.tracks=i.map((s=>Ko(tc.map((o=>[o,s[o]])))))}return e}async function mz(t){const e=Date.now(),i=[];var s;t._videoPlayer&&i.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,ele:t._videoPlayer._videoDom}),t._screenPlayer&&i.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,ele:t._screenPlayer._videoDom}),t._remoteVideoPlayer&&t._remoteVideoPlayer.forEach(((r,n)=>{i.push({userId:n,mediaType:"video",isScreen:!1,isPublic:!1,ele:r?r._videoDom:void 0})})),t._remoteScreenPlayer&&((s=t._remoteScreenPlayer)===null||s===void 0||s.forEach(((r,n)=>{i.push({userId:n,mediaType:"video",isScreen:!0,isPublic:!1,ele:r?r._videoDom:void 0})}))),t._remoteAudioPlayer&&t._remoteAudioPlayer.forEach(((r,n)=>{i.push({userId:n,mediaType:"audio",isScreen:!1,isPublic:!1,ele:r?r._audioDom:void 0,fakeEle:r?r._fakeAudioDom:void 0})})),t._remoteScreenAudioPlayer&&t._remoteScreenAudioPlayer.forEach(((r,n)=>{i.push({userId:n,mediaType:"audio",isScreen:!0,isPublic:!1,ele:r?r._audioDom:void 0,fakeEle:r?r._fakeAudioDom:void 0})})),t._publicStreamVideoPlayer&&t._publicStreamVideoPlayer.forEach(((r,n)=>{i.push({userId:n,mediaType:"video",isScreen:!1,isPublic:!0,ele:r?r._videoDom:void 0})})),t._publicStreamAudioPlayer&&t._publicStreamAudioPlayer.forEach(((r,n)=>{i.push({userId:n,mediaType:"audio",isScreen:!1,isPublic:!0,ele:r?r._audioDom:void 0,fakeEle:r?r._fakeAudioDom:void 0})})),t._localVideoTrack&&t._localVideoTrack.videoPlayers&&t._localVideoTrack.videoPlayers.forEach(((r,n)=>{i.push({playerId:n.toString(),userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,ele:r._videoDom})})),t._localScreenTrack&&t._localScreenTrack.videoPlayers&&t._localScreenTrack.videoPlayers.forEach(((r,n)=>{i.push({playerId:n.toString(),userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,ele:r._videoDom})})),t._room&&t._room._remoteStreams&&t._room._remoteStreams.forEach(((r,n)=>{r.forEach((a=>{if(a.audioTrack){const c=a.audioTrack._audioPlayer;i.push({userId:n,mediaType:"audio",isScreen:a.isScreen,isPublic:!1,ele:c?c._audioDom:void 0,fakeEle:c?c._fakeAudioDom:void 0})}a.videoTrack&&a.videoTrack.videoPlayers&&a.videoTrack.videoPlayers.forEach(((c,d)=>{i.push({playerId:d.toString(),userId:n,mediaType:"video",isScreen:a.isScreen,isPublic:!1,ele:c?c._videoDom:void 0})}))}))}));let o=t._publicStreamManager;return o||(o=t._outsideRoom),o&&o.remoteStreams&&o.remoteStreams.forEach(((r,n)=>{if(r.audioTrack){const a=r.audioTrack._audioPlayer;i.push({userId:n,mediaType:"audio",isScreen:!1,isPublic:!0,ele:a?a._audioDom:void 0,fakeEle:a?a._fakeAudioDom:void 0})}r.videoTrack&&r.videoTrack.videoPlayers&&r.videoTrack.videoPlayers.forEach(((a,c)=>{i.push({playerId:c.toString(),userId:n,mediaType:"video",isScreen:!1,isPublic:!0,ele:a?a._videoDom:void 0})}))})),t&&t._room&&t._room._virtualStreams&&t._room._virtualStreams.forEach(((r,n)=>{if(r.audioTrack){const a=r.audioTrack._audioPlayer;i.push({userId:"virtualStream-".concat(n),mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!0,ele:a?a._audioDom:void 0,fakeEle:a?a._fakeAudioDom:void 0})}})),{timestamp:e,elementStats:i.map((r=>{let{ele:n,fakeEle:a}=r,c=bo(r,nz);const d=I({ele:I({srcObject:n?av(n.srcObject):void 0},Ko(nv.map((l=>[l,n[l]]))))},c);return a&&(d.fakeEle=I({srcObject:av(a.srcObject)},Ko(nv.map((l=>[l,a[l]]))))),d}))}}function PI(t){const e=[];let i=[];t&&t._room&&t._room._remoteStreams&&(i=t._room._remoteStreams.values());for(const s of i)s.forEach((o=>{o.audioTrack&&e.push(o.audioTrack)}));t._localAudioTrack&&e.push(t._localAudioTrack),t._localScreenAudioTrack&&e.push(t._localScreenAudioTrack);for(const s of e){if(s._audioLevelFetcher&&s._audioLevelFetcher._ctx)return s._audioLevelFetcher._ctx;if(s._ac)return s._ac;if(s._audioFetchMap&&Array.from(s._audioFetchMap.values()).length)return Array.from(s._audioFetchMap.values())[0]._ctx;if(s._ap&&s._ap._ac)return s._ap._ac}return null}async function hz(t){const e=Date.now(),i=PI(t),s={};return i?(cz.forEach((o=>{s[o]=i[o]})),{timestamp:e,acState:s}):{timestamp:e,acState:void 0}}function NI(t){const e=[];t._localAudioTrack&&e.push({userId:"__local__",mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:t._localAudioTrack._originTrack,mediaTrack:t._localAudioTrack._mediaTrack,preprocessingTrack:t._localAudioTrack._preProcessingTrack}),t._localScreenAudioTrack&&e.push({userId:"__local__",mediaType:"audio",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:t._localScreenAudioTrack._originTrack,mediaTrack:t._localScreenAudioTrack._mediaTrack,preprocessingTrack:t._localScreenAudioTrack._preProcessingTrack}),t._localVideoTrack&&e.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:t._localVideoTrack._originTrack,mediaTrack:t._localVideoTrack._mediaTrack,preprocessingTrack:t._localVideoTrack._preProcessingTrack}),t._localScreenVideoTrack&&e.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:t._localScreenVideoTrack._originTrack,mediaTrack:t._localScreenVideoTrack._mediaTrack,preprocessingTrack:t._localScreenVideoTrack._preProcessingTrack}),t._room&&t._room._remoteStreams&&t._room._remoteStreams.forEach(((s,o)=>{s.forEach((r=>{r.audioTrack&&e.push({userId:o,mediaType:"audio",isScreen:r.isScreen,isPublic:!1,isVirtual:!1,orgTrack:r.audioTrack._originTrack,mediaTrack:r.audioTrack._mediaTrack}),r.videoTrack&&e.push({userId:o,mediaType:"video",isScreen:r.isScreen,isPublic:!1,isVirtual:!1,orgTrack:r.videoTrack._originTrack,mediaTrack:r.videoTrack._mediaTrack})}))}));let i=t._publicStreamManager;return i||(i=t._outsideRoom),i&&i.remoteStreams&&i.remoteStreams.forEach(((s,o)=>{s.audioTrack&&e.push({userId:o,mediaType:"audio",isScreen:s.isScreen,isPublic:!0,isVirtual:!1,orgTrack:s.audioTrack._originTrack,mediaTrack:s.audioTrack._mediaTrack}),s.videoTrack&&e.push({userId:o,mediaType:"video",isScreen:s.isScreen,isPublic:!0,isVirtual:!1,orgTrack:s.videoTrack._originTrack,mediaTrack:s.videoTrack._mediaTrack})})),t&&t._room&&t._room._virtualStreams&&t._room._virtualStreams.forEach(((s,o)=>{s.audioTrack&&e.push({userId:"virtualStream-".concat(o),mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:s.audioTrack._originTrack,mediaTrack:s.audioTrack._mediaTrack}),s.videoTrack&&e.push({userId:"virtualStream-".concat(o),mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:s.videoTrack._originTrack,mediaTrack:s.videoTrack._mediaTrack})})),e}async function Em(t,e){if(!t)return;const i=new MediaStream;i.addTrack(t);const s=e.createMediaStreamSource(i),o=e.createAnalyser();s.connect(o),e.state==="suspended"&&(console.warn(e.state),e.resume());const r=new Uint8Array(2048);o.getByteTimeDomainData(r),await new Promise((d=>{setTimeout(d,50)})),o.getByteTimeDomainData(r),await new Promise((d=>{setTimeout(d,50)}));let n=0;r.forEach((d=>n=Math.max(n,Math.abs(d-128))));const a=n/128*256,c=a>2?a:0;return s.disconnect(),o.disconnect(),c}async function pz(t){const e=Date.now();if(Ei||(Ei=new AudioContext),Ei.state==="suspended"&&await new Promise((o=>{const r=setTimeout((()=>{console.warn("[RTC_AMBULANCE] AudioContext resume failed, try to find one in RTCEngine"),Ei=PI(t),Ei&&console.warn("[RTC_AMBULANCE] find AudioContext in RTCEngine success"),o()}),1e3);Ei.resume().then((()=>{clearTimeout(r),o()}),(()=>{clearTimeout(r),Ei=null,o()}))})),!Ei)return void console.error("[RTC_AMBULANCE] get volume is not supported");const i=NI(t),s=[];return await Promise.all(i.filter((o=>o.mediaType==="audio")).map((async o=>{let{orgTrack:r,mediaTrack:n,preprocessingTrack:a}=o;const c=I({},bo(o,az));await Promise.all([Em(r,Ei).then((d=>{c.orgTrackVolume=d})),Em(n,Ei).then((d=>{c.mediaTrackVolume=d})),Em(a,Ei).then((d=>{c.preprocessingTrackVolume=d}))]),s.push(c)}))),{timestamp:e,trackVolumes:s}}async function bz(t){return{timestamp:Date.now(),trackStates:NI(t).map((e=>{let{orgTrack:i,mediaTrack:s,preprocessingTrack:o}=e,r=bo(e,dz);return I({orgTrack:i?Ko(tc.map((n=>[n,i[n]]))):void 0,mediaTrack:s?Ko(tc.map((n=>[n,s[n]]))):void 0,preprocessingTrack:o?Ko(tc.map((n=>[n,o[n]]))):void 0},r)}))}}function dv(t){if(!t)return;const e={track:t.track?t.track.id:void 0,transport:{state:t.transport?t.transport.state:void 0}};return t.transport&&t.transport.iceTransport&&(e.iceTransport={state:t.transport.iceTransport.state,role:t.transport.iceTransport.role,gatheringState:t.transport.iceTransport.gatheringState,component:t.transport.iceTransport.component}),e}async function yz(t){const e=Date.now();let i=[];t._ctx._handler&&t._ctx._handler._peerConnection&&(i=t._ctx._handler._peerConnection.getTransceivers());const s=[];return i.forEach((o=>{const r=I({sender:dv(o.sender),receiver:dv(o.receiver)},Ko(lz.map((n=>[n,o[n]]))));s.push(r)})),{timestamp:e,tranceiverStates:s}}async function _z(t){const e={stats:[],mediaElementStates:[],audioContextStates:[],volumes:[],trackStates:[],tranceiverStates:[]},i=[];return await new Promise((s=>{let o,r=0;const n=()=>{i.push(uz(t).then((a=>{e.stats.push(a)})),mz(t).then((a=>{e.mediaElementStates.push(a)})),hz(t).then((a=>{e.audioContextStates.push(a)})),pz(t).then((a=>{e.volumes.push(a)})),bz(t).then((a=>{e.trackStates.push(a)})),yz(t).then((a=>{e.tranceiverStates.push(a)}))),r++,r>=10?Promise.all(i).then((()=>{s()})):(clearTimeout(o),o=setTimeout(n,500))};o=setTimeout(n,500)})),console.log("RTC_AMBULANCE",e),e}class Sz{constructor(){m(this,"containers",new WeakSet)}getContainerById(e){return document.getElementById(e)}registerContainer(e){var i;return typeof e=="string"&&(e=(i=this.getContainerById(e))!==null&&i!==void 0?i:void 0),!(!e||this.containers.has(e))&&(this.containers.add(e),!0)}unregisterContainer(e){var i;return typeof e=="string"&&(e=(i=this.getContainerById(e))!==null&&i!==void 0?i:void 0),!!e&&(this.containers.delete(e),!0)}}const vz=["videoStats","audioStats"];var Pm,gz=Object.defineProperty,fz=Object.getOwnPropertyDescriptor,F=(t,e,i,s)=>{for(var o,r=fz(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&gz(e,i,r),r};const Hh=(Pm=class extends Vt{constructor(t,e,i){var s;super(),s=this,m(this,"monitor",void 0),m(this,"logger",void 0),m(this,"_room",void 0),m(this,"_wtnStreamManager",void 0),m(this,"_appId",void 0),m(this,"_localImgVideoTrack",void 0),m(this,"_localImgScreenTrack",void 0),m(this,"_localScreenVideoTrack",void 0),m(this,"_localScreenAudioTrack",void 0),m(this,"_tempMixingAudioTrack",void 0),m(this,"_localAudioVolume",100),m(this,"_localScreenAudioVolume",100),m(this,"_remoteAudioVolume",new Map),m(this,"_remoteScreenAudioVolume",new Map),m(this,"_localVideoPlayerConfig",{[V.STREAM_INDEX_MAIN]:new Map,[V.STREAM_INDEX_SCREEN]:new Map}),m(this,"_remoteVideoPlayerConfig",{[V.STREAM_INDEX_MAIN]:new Map,[V.STREAM_INDEX_SCREEN]:new Map}),m(this,"_publicStreamIds",new Map),m(this,"_dummyMainImage",void 0),m(this,"_dummyScreenImage",void 0),m(this,"_trackSourceType",void 0),m(this,"_liveTranscodeConfig",void 0),m(this,"_startCloudProxyTimestamp",void 0),m(this,"_pauseAllSubscribeState",{audio:void 0,video:void 0,resumeAudioStreamIds:{},resumeVideoStreamIds:{}}),m(this,"_audioVolumeIndicationTimer",void 0),m(this,"_dummyMainTimer",void 0),m(this,"_dummyScreenTimer",void 0),m(this,"_audioPropertiesReportTimer",null),m(this,"_mirrorType",yi.MIRROR_TYPE_RENDER),m(this,"_audioMixingManager",void 0),m(this,"_pubLock",void 0),m(this,"_subLocks",void 0),m(this,"_audioCaptureLock",void 0),m(this,"_videoCaptureLock",void 0),m(this,"_screenCaptureLock",void 0),m(this,"_subScreenLocks",void 0),m(this,"_rtmClient",void 0),m(this,"_messageStatisticsObserver",void 0),m(this,"_waitForNewToken",!1),m(this,"_originIceConfigRequestUrls",void 0),m(this,"_originConfigServerUrls",void 0),m(this,"_originLogServerUrl",void 0),m(this,"_audioDeviceManager",void 0),m(this,"_config",void 0),m(this,"_playerVisibilityReportTimer",void 0),m(this,"_needClosePreTrack",!1),m(this,"_containerCollisionDetector",new Sz),m(this,"_ctx",void 0),m(this,"_removeDeviceEventHandler",void 0),m(this,"_updateMixAudioTrack",(async function(o){var r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ti.PLAYOUT_AND_PUBLISH;if(s.logger.info("_updateMixAudioTrack()"),!s._localAudioTrack)return void(o&&(s._tempMixingAudioTrack={track:o,type:n}));o?(s._localAudioTrack.mixType=n,s._localAudioTrack.mixedAudioTrack=o):(delete s._localAudioTrack.mixType,delete s._localAudioTrack.mixedAudioTrack),await((r=s._room)===null||r===void 0?void 0:r.hasPublished())&&await s._updatePublish(),s._wtnStreamManager._updatePushTrack()})),m(this,"_onVideoDeviceStateChange",(o=>{this.safeEmit(Y.onVideoDeviceStateChanged,o)})),m(this,"_onAudioDeviceStateChange",(o=>{this.safeEmit(Y.onAudioDeviceStateChanged,o)})),m(this,"_onAudioMixingMessage",(o=>{this.safeEmit(Y.onAudioMixingStateChanged,o)})),m(this,"_onAudioMixingAutoplayFailed",(o=>{this.safeEmit(Y.onAutoplayFailed,o)})),m(this,"_revokeAutoplayFailedWorkaround",void 0),this.id=e,this._appId=t,this.monitor=ke(e),this._ctx=new lo(e,t,i),this._pubLock=new Ni("pubLock"),this._subLocks=new Map,this._subScreenLocks=new Map,this._audioCaptureLock=new Ni("audioCap"),this._videoCaptureLock=new Ni("videoCap"),this._screenCaptureLock=new Ni("screenCap"),this._addDeviceEventHandler(),this._audioDeviceManager=new H3(this._ctx),this._addSignalingEventHandler(),this._wtnStreamManager=new ct(this._ctx),this._addWTNStreamEventHandler(),Qc&&(window.__rtc_engine__=this,window["__rtc_engine__".concat(Math.floor(100*Math.random()+1))]=this),this._trackSourceType={video:Pt.VIDEO_SOURCE_TYPE_INTERNAL,screenVideo:Pt.VIDEO_SOURCE_TYPE_INTERNAL,audio:Bt.AUDIO_SOURCE_TYPE_INTERNAL,screenAudio:Bt.AUDIO_SOURCE_TYPE_INTERNAL},this._config=i,this._rtmClient=new k3(this._ctx),this._handleRTMClient(this._rtmClient),this._handleAudioDeviceManager(),this._messageStatisticsObserver=new yw(e),this.logger=new ue("Engine",0,e),Je.createRTSMsgReportor(this.id),Hh.hasReportNativeDetector||(this.monitor.reportLongString("NativeDetector",JSON.stringify(jc)),Hh.hasReportNativeDetector=!0),this._playerVisibilityReportTimer=setInterval(this._checkPlayerVisibilityInterval.bind(this),3e4),this._initAutoplayFailedWorkaround()}get appId(){return this._appId}set appId(t){this._appId=t}async updateToken(t){if(this.logger.info("updateToken()","token: %s",t),Le(t,"token"),this._room&&this._waitForNewToken)return this._waitForNewToken=!1,this._room.config.token=t,await this._join(this._room);if(!this._room)throw new G(C.UPDATE_TOKEN_BEFORE_JOIN,"update token before join room");await this._room.updateToken(t);const e=[];if(this._room.config.tokenPublishPrivilegeExpired&&this._room.config.isAutoPublish&&this._ctx.visibility&&e.push(this._updatePublish({mediaType:Q.AUDIO_AND_VIDEO})),this._room.config.tokenSubscribePrivilegeExpired){const{isAutoSubscribeAudio:i,isAutoSubscribeVideo:s}=this._room.config,o=(i?Q.AUDIO:0)|(s?Q.VIDEO:0);o&&e.push(this._triedResumeAllRemoteStreams(o,!0))}await Promise.allSettled(e)}async setVideoCaptureDevice(t){if(this.logger.info("setVideoCaptureDevice()","deviceId: %s",t),Le(t,"deviceId"),!this._localVideoTrack)return void this._ctx.videoProfile.setCaptureDeviceId(t);if(Ur&&as&&this._localVideoTrack.originTrack.getSettings().deviceId===t)return;const e=this._ctx.videoProfile.getCaptureConfig(t);var i;as&&gs&&qt>=85&&qt<=91&&((i=this.localVideoTrack)===null||i===void 0||i.removePlayerTrack()),this._needClosePreTrack=this._needClosePreTrack||hK,this._needClosePreTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy(),delete this._localVideoTrack),this.logger.info("setVideoCaptureDevice()","start createCameraVideoTrack...");const s=await Xd(this._ctx,e).catch((r=>{if(this._localVideoTrack&&!this._localVideoTrack.dummy)return this.logger.warn("setVideoCaptureDevice()","createCameraVideoTrack failed, stop pre VideoTrack."),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy(),delete this._localVideoTrack,Xd(this._ctx,e).then((n=>(this._needClosePreTrack=!0,n))).catch((async()=>{this.logger.error("setVideoCaptureDevice()","createCameraVideoTrack failed, rollback.");const n=await Xd(this._ctx);throw this._switchTrack(n),r}));throw r}));this.logger.success("setVideoCaptureDevice()","createCameraVideoTrack success."),this._ctx.videoProfile.setCaptureDeviceId(t),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy());const o=this._ctx.videoProfile.getContentHint();o&&s.setContentHint(o),await this._switchTrack(s)}async setAudioCaptureDevice(t){var e;if(this.logger.info("setAudioCaptureDevice()","deviceId: %s",t),Le(t,"deviceId"),this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),!this._localAudioTrack)return;this._localAudioTrack.destroy(),this._removeLocalTrackEvents(this._localAudioTrack);const i=await Kh(this._ctx,this._ctx.audioProfileManager.getConstraints());this._initLocalTrackEvents(i),this._localAudioTrack=i,this._localAudioTrack.setVolume(this._localAudioVolume),this._wtnStreamManager._updatePushTrack(),this._room&&(e=this._room.localStream)!==null&&e!==void 0&&e.pubAudio&&await this._updatePublish()}_addDeviceEventHandler(){_t.on(Y.onVideoDeviceStateChanged,this._onVideoDeviceStateChange),_t.on(Y.onAudioDeviceStateChanged,this._onAudioDeviceStateChange),this._removeDeviceEventHandler=()=>{_t.off(Y.onVideoDeviceStateChanged,this._onVideoDeviceStateChange),_t.off(Y.onAudioDeviceStateChanged,this._onAudioDeviceStateChange)}}_addSignalingEventHandler(){const t=this._ctx.signalingManager;t.on(Fe.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),t.on(Fe.ON_RECONNECT_FAILED,(()=>{this.safeEmit(Y.onError,{errorCode:C.RECONNECT_FAILED})})),t.on(Fe.CONNECT_WITH_TCP,(()=>{this.safeEmit(Y.onIceConnectWithTcp)})),t.on(Fe.JOIN_ROOM_FAILED_PRIVATE_CALLBACK,(e=>{ae("TURN_ON_JOIN_ROOM_FAILURE_CALLBACK")&&this.safeEmit("onJoinRoomFailedPrivateCallback",e)}))}_addWTNStreamEventHandler(){this._wtnStreamManager.__onResubscribe=t=>{const e=t.stream;e&&(e.audioTrack&&this._updateAudioPlayerState(e),e.videoTrack&&this._updateVideoPlayerState(e))},this._wtnStreamManager.__onRemoteStreamStats=t=>{this.safeEmit(Y.onPublicStreamStats,t)},this._wtnStreamManager.__onSEIMessageReceived=t=>{this.safeEmit(Y.onPublicStreamSEIMessageReceived,t)},this._wtnStreamManager.__onPlayerEvents=(t,e,i)=>{this._initPlayerEvents(t,e,i)}}_addHandlerEventHandler(){var t,e,i,s,o,r,n,a,c,d,l,u,p,h,_,y,b,S,v,f,g,Z,R,T,X,L,W,M,k,U,D,ie,B,$,te,N,K,x,E,q,ce,se,oe,ne;(t=this._room)===null||t===void 0||t.on(O.ON_ADD_STREAM,this._onAddStream.bind(this)),(e=this._room)===null||e===void 0||e.on(O.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),(i=this._room)===null||i===void 0||i.on(O.USER_CONNECTION,this._onUserConnection.bind(this)),(s=this._room)===null||s===void 0||s.on(A.ON_USER_LEAVE,this._onUserLeave.bind(this)),(o=this._room)===null||o===void 0||o.on(A.ON_ROOM_ERROR,this._onRoomError.bind(this)),(r=this._room)===null||r===void 0||r.on(A.ON_NETWORK_QUALITY,this._onNetworkQuality.bind(this)),(n=this._room)===null||n===void 0||n.on(O.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),(a=this._room)===null||a===void 0||a.on(O.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),(c=this._room)===null||c===void 0||c.on(O.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),(d=this._room)===null||d===void 0||d.on(O.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),(l=this._room)===null||l===void 0||l.on(O.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE,this._onUserTokenPublishPrivilegeWillExpire.bind(this)),(u=this._room)===null||u===void 0||u.on(O.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED,this._onUserTokenPublishPrivilegeDidExpired.bind(this)),(p=this._room)===null||p===void 0||p.on(O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE,this._onUserTokenSubscribePrivilegeWillExpire.bind(this)),(h=this._room)===null||h===void 0||h.on(O.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED,this._onUserTokenSubscribePrivilegeDidExpired.bind(this)),(_=this._room)===null||_===void 0||_.on(O.POST_PROCESSING_MESSAGE,(w=>{var J;((J=w)==null?void 0:J.protocol)==="2.0"?this._onStreamMixingEvent({error:w.error,event:w.eventType,message:w.message}):w.type==="publicStreamCallback"?this._onPushPublicStreamResult(w):w.type==="transcodeStatusCallback"&&this._onLiveTranscodingResult(w)})),(y=this._room)===null||y===void 0||y.on(Fe.ON_VENDOR_CONNECTION_STATE_CHANGE,(w=>this.safeEmit(Y.onVendorConnectionStateChanged,w))),(b=this._room)===null||b===void 0||b.on(A.RESUBSCRIBE,this._onResubscribe.bind(this)),(S=this._room)===null||S===void 0||S.on(A.SUBSCRIBE_PUSH_TRACK,this._onSubscribePushTrack.bind(this)),(v=this._room)===null||v===void 0||v.on(A.REMOVE_PUSH_TRACK,this._onRemovePushTrack.bind(this)),(f=this._room)===null||f===void 0||f.on(A.ON_PUBLISH_RESULT,(w=>{var J,re,j;w.state===es.PUBLISH_SUCC&&((re=this._room)===null||re===void 0||re.config.setTokenPublishPrivilegeExpired(!1)),w.state===es.PUBLISH_FAIL&&w.errorCode===C.TOKEN_NO_PUBLISH_PERMISSION&&((j=this._room)===null||j===void 0||j.config.setTokenPublishPrivilegeExpired(!0));const le=!(w.retry||(J=this._room)===null||J===void 0||!J.config.isAutoPublish);le&&this.safeEmit(Y.onAutoPublishResult,w),this.safeEmit(Y.onPublishResult,{isScreen:w.isScreen,isAutoPublish:le,errorCode:w.errorCode})})),(g=this._room)===null||g===void 0||g.on(A.ON_SUBSCRIBE_RESULT,(w=>{var J;w.state===Fr.SUBSCRIBE_SUCC&&((J=this._room)===null||J===void 0||J.config.setTokenSubscribePrivilegeExpired(!1)),w.state===Fr.SUBSCRIBE_FAIL&&w.errorCode===C.TOKEN_NO_SUBSCRIBE_PERMISSION&&this._handleLoseSubscribePrivilege(),this.safeEmit(Y.onSubscribeResult,{userId:w.userId,isScreen:w.isScreen,isAutoSubscribe:!1,errorCode:w.errorCode})})),(Z=this._room)===null||Z===void 0||Z.on(A.ON_REMOTE_STREAM_STATS,(w=>{this.safeEmit(Y.onRemoteStreamStats,w)})),(R=this._room)===null||R===void 0||R.on(A.ON_LOCAL_STREAM_STATS,(w=>{this.safeEmit(Y.onLocalStreamStats,w)})),(T=this._room)===null||T===void 0||T.on(A.ON_SUBTITLE_STATE_CHANGED,(w=>{this.safeEmit(Y.onSubtitleStateChanged,w)})),(X=this._room)===null||X===void 0||X.on(A.ON_SUBTITLE_MESSAGE_RECEIVED,(w=>{this.safeEmit(Y.onSubtitleMessageReceived,w)})),(L=this._room)===null||L===void 0||L.on(A.ON_USER_PUBLISH_STATE_CHANGE,this._onUserPublishStateChange.bind(this)),(W=this._room)===null||W===void 0||W.on(A.ON_USER_START_AUDIO_CAPTURE,((w,J)=>{let{userId:re}=w;this._updateAudioPlayerState(J),this.safeEmit(Y.onUserStartAudioCapture,{userId:re})})),(M=this._room)===null||M===void 0||M.on(A.ON_USER_STOP_AUDIO_CAPTURE,(w=>{let{userId:J}=w;this.safeEmit(Y.onUserStopAudioCapture,{userId:J})})),(k=this._room)===null||k===void 0||k.on(A.ON_USER_START_VIDEO_CAPTURE,(w=>{let{userId:J}=w;this.safeEmit(Y.onUserStartVideoCapture,{userId:J})})),(U=this._room)===null||U===void 0||U.on(A.ON_USER_STOP_VIDEO_CAPTURE,(w=>{let{userId:J}=w;this.safeEmit(Y.onUserStopVideoCapture,{userId:J})})),(D=this._room)===null||D===void 0||D.on(A.ON_SEI_MESSAGED_RECEIVED,(w=>{this.safeEmit(Y.onSEIMessageReceived,w)})),(ie=this._room)===null||ie===void 0||ie.on(A.ON_REMOTE_VIDEO_SIZE_CHANGED,((w,J)=>{this.safeEmit(Y.onRemoteVideoSizeChanged,w,J)})),(B=this._room)===null||B===void 0||B.on(A.ON_SIMULCAST_SUBSCRIBE_FALLBACK,(w=>this.safeEmit(Y.onSimulcastSubscribeFallback,w))),($=this._room)===null||$===void 0||$.on(A.ON_VIDEO_STREAM_BANNED,(w=>{this.safeEmit(Y.onVideoStreamBanned,{uid:w.uid,banned:w.banned})})),(te=this._room)===null||te===void 0||te.on(A.ON_AUDIO_STREAM_BANNED,(w=>{this.safeEmit(Y.onAudioStreamBanned,{uid:w.uid,banned:w.banned})})),(N=this._room)===null||N===void 0||N.on(A.ON_FORWARD_STREAM_ERROR,(w=>{this.safeEmit(Y.onForwardStreamError,w)})),(K=this._room)===null||K===void 0||K.on(A.ON_REJOIN_WITH_TCP,(()=>{this.safeEmit(Y.onRejoinWithTcp)})),(x=this._room)===null||x===void 0||x.on(A.PUB_RETRY,(w=>{this.safeEmit(Y.onPublishRetry,w)})),(E=this._room)===null||E===void 0||E.on(A.SUB_RETRY,(w=>{this.safeEmit(Y.onSubscribeRetry,w)})),(q=this._room)===null||q===void 0||q.on(A.VIDEO_TYPE_CHANGE,(w=>{this.safeEmit(Y.onSEIStreamUpdate,w)})),(ce=this._room)===null||ce===void 0||ce.on(A.JOIN_SUCCESS,(w=>{this._ctx.isPreConnection||this.safeEmit(Y.onConnectionStateChanged,{state:w?fe.CONNECTION_STATE_RECONNECTED:fe.CONNECTION_STATE_CONNECTED})})),(se=this._room)===null||se===void 0||se.on(A.UPDATE_PUBLISH,(w=>{let{streamIndex:J}=w;J===V.STREAM_INDEX_MAIN?this._updatePublish():J===V.STREAM_INDEX_SCREEN&&this._updateScreenPublish()})),(oe=this._room)===null||oe===void 0||oe.on(A.ON_LOCAL_STATS_EXCEPTION,(w=>{this.logger.info("local stats exception",JSON.stringify(w)),this.safeEmit(Y.onLocalStatsException,I({},w))})),(ne=this._room)===null||ne===void 0||ne.on(A.ON_REMOTE_STATS_EXCEPTION,(w=>{this.logger.info("remote stats exception",JSON.stringify(w)),this.safeEmit(Y.onRemoteStatsException,I({},w))}))}safeEmit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];if(Aw(t)){if(t===Y.onRemoteStreamStats){const o=ae("UPLOAD_REMOTE_STATS"),r=ae("FORCE_ENABLED_REPORT_CALLBACKS").includes("onRemoteStreamStats"),n=i[0],{videoStats:a,audioStats:c}=n,d=bo(n,vz);i[0]=I({},d),(o&Q.VIDEO||r)&&(i[0].videoStats=a),(o&Q.AUDIO||r)&&(i[0].audioStats=c)}wr(this.id,t,i)}return super.safeEmit(t,...i)}_removeHandlerEventHandler(){var t;(t=this._room)===null||t===void 0||t.removeAllListeners()}async connect(){await this._ctx.signalingManager.connect()}async joinRoom(t,e,i,s){var o,r,n,a,c;if(this.logger.info("joinRoom()","token: %o roomId: %o, userInfo: %o, roomConfig: %o",t,e,i,s),gi(t)||Le(t,"token"),this._room)throw new G(C.REPEAT_JOIN,"Already joined");(o=this._ctx.monitor)===null||o===void 0||o.report("rtc_sdk_api_call",{sdk_api_name:"host",message:location.host,error_code:0}),ld(e),Ow(i);const d=new Z3({token:t,roomId:e,userInfo:i},this._ctx);return Jw(d.updateRoomConfig(s)),d.setLiveControlMessage(this._liveTranscodeConfig&&Zr.getStartParams(this._liveTranscodeConfig)),this._room=new Pe(d,this._ctx),this.monitor.set({rtc_session_id:this._room.config.sessionId}),this._addHandlerEventHandler(),this._ctx.useCloudProxy&&(this._startCloudProxyTimestamp=Date.now()),(r=this._localVideoTrack)===null||r===void 0||r.setUserId(i.userId),(n=this._localScreenVideoTrack)===null||n===void 0||n.setUserId(i.userId),(a=this._localAudioTrack)===null||a===void 0||a.setUserId(i.userId),(c=this._localScreenAudioTrack)===null||c===void 0||c.setUserId(i.userId),v3(i),await this._join(this._room)}async _join(t){try{var e;const i=await t.join();return this._waitForNewToken=!1,this._ctx.audioProfileManager.setRoomId(t.config.roomId),(e=this._room)!==null&&e!==void 0&&e.config.isAutoPublish&&(this._ctx.visibility?this._updatePublish({invokeByJoinRoom:!0,mediaType:Q.AUDIO_AND_VIDEO}).catch((s=>{this.logger.error("_join","_updatePublish failed",s)})):(this.safeEmit(Y.onAutoPublishResult,{isScreen:!1,state:es.PUBLISH_FAIL}),this.safeEmit(Y.onPublishResult,{isScreen:!1,isAutoPublish:!0,errorCode:C.NO_PUBLISH_PERMISSION}))),this.monitor.set({rtc_vid:t.config.rtcVid}),Je.setRoomId(this.id,t.config.roomId),Je.setUserId(this.id,t.config.userId),i}catch(i){throw i.code===C.INVALID_TOKEN?this._waitForNewToken=!0:(t.destroy(),this._room===t&&delete this._room),i}}async leaveRoom(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.logger.info("leaveRoom()");const e=this._room;delete this._room,this._ctx.resetPubSubLock(mI.LEAVE),this._ctx.callId=void 0,t?await e?.leave(t):e?.leave(t).catch(),this._removeHandlerEventHandler(),this._subLocks=new Map,this._subScreenLocks=new Map,this._ctx.audioProfileManager.setRoomId(),this._liveTranscodeConfig&&this.stopLiveTranscoding(),e?.destroy(),this._remoteVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((i=>{i.forEach((s=>{const{player:o,renderDom:r}=s;o?.destroy(),this._containerCollisionDetector.unregisterContainer(r)}))})),this._remoteVideoPlayerConfig[V.STREAM_INDEX_MAIN].clear(),this._remoteVideoPlayerConfig[V.STREAM_INDEX_SCREEN].forEach((i=>{i.forEach((s=>{const{player:o,renderDom:r}=s;o?.destroy(),this._containerCollisionDetector.unregisterContainer(r)}))})),this._remoteVideoPlayerConfig[V.STREAM_INDEX_SCREEN].clear(),this._publicStreamIds=new Map,Je.setRoomId(this.id,""),Je.setUserId(this.id,""),this.monitor.set({rtc_session_id:"",rtc_vid:""})}_destroyLocalTrack(){this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.destroy(),this._localAudioTrack=void 0),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy(),this._localVideoTrack=void 0),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.destroy(),this._localScreenAudioTrack=void 0),this._localScreenVideoTrack&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy(),this._localScreenVideoTrack=void 0),this._localImgVideoTrack&&(this._localImgVideoTrack.stop(),this._localImgVideoTrack=void 0),this._localImgScreenTrack&&(this._localImgScreenTrack.stop(),this._localImgScreenTrack=void 0)}destroy(){var t,e,i,s;this.logger.info("destroy()"),this.removeAllListeners(),this._removeHandlerEventHandler(),(t=this._removeDeviceEventHandler)===null||t===void 0||t.call(this),(e=this._revokeAutoplayFailedWorkaround)===null||e===void 0||e.call(this),(i=this._room)===null||i===void 0||i.destroy(),this._room=void 0,this._subLocks=new Map,this._subScreenLocks=new Map,this._audioCaptureLock=new Ni("audioCap"),this._videoCaptureLock=new Ni("videoCap"),this._screenCaptureLock=new Ni("screenCap"),this._pauseAllSubscribeState={audio:void 0,video:void 0,resumeVideoStreamIds:{},resumeAudioStreamIds:{}},this._messageStatisticsObserver.destroy(),this.monitor.destroy(),Je.destroyRTSMsgReportor(this.id),clearInterval(this._audioVolumeIndicationTimer),clearInterval(this._dummyMainTimer),clearInterval(this._dummyScreenTimer),this._audioVolumeIndicationTimer=void 0,this._stopAudioPropertiesReport(),this._destroyLocalTrack(),(s=this._audioMixingManager)===null||s===void 0||s.destroy(),this._rtmClient.destroy(),this._wtnStreamManager.destroy(),this._publicStreamIds=new Map,this._audioDeviceManager.destroy(),this._ctx.destroy(),this._localAudioVolume=100,this._localScreenAudioVolume=100,this._remoteAudioVolume.clear(),this._remoteScreenAudioVolume.clear(),clearInterval(this._playerVisibilityReportTimer),this._localVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((o=>{o.player.destroy()})),this._localVideoPlayerConfig[V.STREAM_INDEX_MAIN].clear(),this._localVideoPlayerConfig[V.STREAM_INDEX_SCREEN].forEach((o=>{o.player.destroy()})),this._localVideoPlayerConfig[V.STREAM_INDEX_SCREEN].clear(),this._remoteVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((o=>{o.forEach((r=>{r.player.destroy()}))})),this._remoteVideoPlayerConfig[V.STREAM_INDEX_MAIN].clear(),this._remoteVideoPlayerConfig[V.STREAM_INDEX_SCREEN].forEach((o=>{o.forEach((r=>{r.player.destroy()}))})),this._remoteVideoPlayerConfig[V.STREAM_INDEX_SCREEN].clear()}async publishStream(t){this.logger.info("publishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),Ve(t)&&!this._localVideoTrack&&this._localImgVideoTrack&&(this._localVideoTrack=await o3(this._ctx,this._localImgVideoTrack)),await this._updatePublish({mediaType:t},!0)}async unpublishStream(t,e){var i;if(this.logger.info("unpublishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e)return(i=this._room)===null||i===void 0?void 0:i.unpublish();await this._updatePublish({mediaType:t,pubState:Ot.UNPUB},!0)}async publishScreen(t){this.logger.info("publishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom();try{Ve(t)&&!this._localScreenVideoTrack&&this._localImgScreenTrack&&(this._localScreenVideoTrack=await r3(this._ctx,this._localImgScreenTrack)),await this._updateScreenPublish({mediaType:t,pubState:Ot.PUB})}catch(e){throw e instanceof G?e:new G(C.UNEXPECTED_ERROR,"unexpected error",e)}}async unpublishScreen(t){this.logger.info("unpublishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),await this._updateScreenPublish({mediaType:t,pubState:Ot.UNPUB})}async subscribeStream(t,e){return this.logger.info("subscribeStream()","userId: %o, mediaType: %o",t,e),this._subscribe(!1,t,e)}async _subscribe(t,e,i){var s;const o=i;if(i===Q.AUDIO&&(s=this._room)!==null&&s!==void 0&&s.config.isMultiChatMode())return void this.logger.warn("subscribeStream()","due to multiChatMode return");const r=this._room.remoteStreams.get(e),n=r?.find((y=>y.isScreen===t));if(!n)throw new G(C.STREAM_NOT_EXIST,"stream not exist");const a=this._pauseAllSubscribeState.audio,c=this._pauseAllSubscribeState.video;this._pauseAllSubscribeState.audio&&(i-=i&Q.AUDIO),this._pauseAllSubscribeState.video&&(i-=i&Q.VIDEO),this.logger.warn("subscribeStream()","due to pauseAll mediaType: %o",i);const{hasSubscribed:d}=n;n.originalMediaType=i;try{var l;await this._room.subscribe(n,i),Be(i)&&this._updateAudioPlayerState(n),Ve(i)&&this._updateVideoPlayerState(n);let y=0,b=0;if(a!==this._pauseAllSubscribeState.audio&&(this._pauseAllSubscribeState.audio?y|=Q.AUDIO:b|=Q.AUDIO),c!==this._pauseAllSubscribeState.video&&(this._pauseAllSubscribeState.video?y|=Q.VIDEO:b|=Q.VIDEO),y&&this.pauseAllSubscribedStream(y),b&&this.resumeAllSubscribedStream(b),Be(o)&&(this._pauseAllSubscribeState.resumeAudioStreamIds[n.streamId]=n.streamId),Ve(o)&&(this._pauseAllSubscribeState.resumeVideoStreamIds[n.streamId]=n.streamId),n.audioTrack||n.videoTrack){var u,p;const S=!(t||!((u=this._room)!==null&&u!==void 0&&u.config.isAutoSubscribeAudio||(p=this._room)!==null&&p!==void 0&&p.config.isAutoSubscribeVideo)),v={userId:e,isScreen:!1,state:Fr.SUBSCRIBE_SUCC};S&&this.safeEmit(Y.onAutoSubscribeResult,v),this.safeEmit(Y.onSubscribeResult,{userId:e,isScreen:t,isAutoSubscribe:S})}var h,_;((l=this._room)===null||l===void 0||!l.config.isMultiChatMode())&&!d&&Be(i)&&n.hasAudio&&((h=n.observer)===null||h===void 0||h.setSubscribeAudio(!0)),!d&&Ve(i)&&n.hasVideo&&((_=n.observer)===null||_===void 0||_.setSubscribeVideo(!0))}catch(y){throw y instanceof G&&y.code===C.TOKEN_NO_SUBSCRIBE_PERMISSION&&this._handleLoseSubscribePrivilege(),y}}async _handleLoseSubscribePrivilege(){var t;(t=this._room)===null||t===void 0||t.config.setTokenSubscribePrivilegeExpired(!0);try{await this._unSubscribeAllRemoteStreams()}catch{}}async unsubscribeStream(t,e){return this.logger.info("unsubscribeStream()","userId: %o, mediaType: %o",t,e),this._unsubscribe(!1,t,e)}async subscribeScreen(t,e){return this.logger.info("subscribeScreen() userId: %o, mediaType: %o",t,e),this._subscribe(!0,t,e)}async unsubscribeScreen(t,e){return this.logger.info("unsubscribeScreen() userId: %o, mediaType: %o",t,e),this._unsubscribe(!0,t,e)}_unsubscribe(t,e,i,s){var o;if(i===Q.AUDIO&&(o=this._room)!==null&&o!==void 0&&o.config.isMultiChatMode())return void this.logger.warn("subscribeStream()","due to multiChatMode return");const r=this._room.remoteStreams.get(e),n=r?.find((c=>c.isScreen===t));if(!n)throw new G(C.STREAM_NOT_EXIST,"stream not exist");var a;return as&&qt&&qt>=85&&qt<=91&&i!==Q.AUDIO&&((a=n.videoTrack)===null||a===void 0||a.stopAll()),this._room.unsubscribe(n,i).then((()=>{s||(Be(i)&&delete this._pauseAllSubscribeState.resumeAudioStreamIds[n.streamId],Ve(i)&&delete this._pauseAllSubscribeState.resumeVideoStreamIds[n.streamId])}))}async setRemoteVideoConfig(t,e){var i;return this.logger.info("setRemoteVideoConfig() userId: %o, remoteVideoConfig: %o",t,e),this._ctx.videoProfile.checkSimulcastApiVersion("old"),wt(t),Dw(e),this._ctx.videoProfile.setRemoteUserVideoConfig(t,e),(i=this._room)===null||i===void 0?void 0:i.updateSubVideoConfig(t).then((()=>{}))}async setRemoteSimulcastStreamType(t,e){var i;this.logger.info("setRemoteSimulcastStreamType()","userId: %s, streamType: %s",t,e),this._ctx.videoProfile.checkSimulcastApiVersion("new"),wt(t),_e(e,"SimulcastStreamType",[js.VIDEO_STREAM_HIGH,js.VIDEO_STREAM_MID,js.VIDEO_STREAM_LOW]),this._ctx.videoProfile.setRemoteUserVideoConfig(t,e),await((i=this._room)===null||i===void 0?void 0:i.updateSubVideoConfig(t))}async startVideoCapture(t){var e,i;if(this.logger.info("startVideoCapture()","deviceId: %s",t),gi(t)||Le(t,"deviceId"),t&&this._ctx.videoProfile.setCaptureDeviceId(t),this._trackSourceType.video===Pt.VIDEO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");if(this._localVideoTrack&&!this._localVideoTrack.dummy)throw new G(C.REPEAT_CAPTURE,"Has already capture");let s={};const o=await Xd(this._ctx),r=this._ctx.videoProfile.getContentHint();r&&o.setContentHint(r),this._initLocalTrackEvents(o),this._localVideoTrack=o,this._localVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((c=>{var d,l;(d=this._localVideoTrack)===null||d===void 0||d.setPlayer(c,this._mirrorType,(l=this._config)===null||l===void 0?void 0:l.autoPlayPolicy,this._initPlayerEvents.bind(this))})),s=o.originTrack.getSettings();const n={width:s.width,height:s.height};if(this._localVideoTrack.resolution=n,this._ctx.videoProfile.__autoResetVideoEncoderConfig(s),setTimeout((()=>this.safeEmit(Y.onLocalVideoSizeChanged,{streamIndex:V.STREAM_INDEX_MAIN,info:n}))),this._ctx.engineDestroyed)return this._destroyLocalTrack(),s;if(this._wtnStreamManager._updatePushTrack(),!this._room)return s;const{isAutoPublish:a}=this._room.config;return((e=this._room.localStream)!==null&&e!==void 0&&e.pubVideo||a)&&this._ctx.visibility&&this._updatePublish(),(i=this._room.localStream)===null||i===void 0||(i=i.observer)===null||i===void 0||i.setEnableVideo(!0),s}async getLocalStreamStats(){var t;return await((t=this._room)===null||t===void 0?void 0:t.getLocalStreamStats())}async stopVideoCapture(){var t,e;if(this.logger.info("stopVideoCapture()"),this._trackSourceType.video===Pt.VIDEO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");if(this._localVideoTrack&&!this._localVideoTrack.dummy){const i=this._ctx.extensionManager.getPluginByName(zr.PRE_PROCESSING,"RTCBeautyExtension");i&&i.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy(),this._localImgVideoTrack?this._localVideoTrack.setTrack(this._localImgVideoTrack,{isDummy:!0}):this._localVideoTrack=void 0}this._wtnStreamManager._updatePushTrack(),this._room&&((t=this._room.localStream)!==null&&t!==void 0&&t.pubVideo&&await this._updatePublish(),(e=this._room.localStream)===null||e===void 0||(e=e.observer)===null||e===void 0||e.setEnableVideo(!1))}async startAudioCapture(t){var e,i;if(this.logger.info("startAudioCapture()","deviceId: $o",t),gi(t)||Le(t,"deviceId"),t&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._trackSourceType.audio===Bt.AUDIO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");if(this._localAudioTrack)throw new G(C.REPEAT_CAPTURE,"Has already capture");let s={};const o=await Kh(this._ctx,this._ctx.audioProfileManager.getConstraints());s=o.originTrack.getSettings(),this._initLocalTrackEvents(o),this._localAudioTrack=o,this._localAudioTrack.setVolume(this._localAudioVolume);const{frameSize:r,callback:n}=this._ctx._localAudioTrackDumpConfig[V.STREAM_INDEX_MAIN];r&&n&&this._localAudioTrack.setDataFetcher(r,n);const{position:a,volume:c}=this._ctx.earMonitorSettings[V.STREAM_INDEX_MAIN];if(a!==It.NONE&&(this._localAudioTrack.play(a),this._localAudioTrack.setPlaybackVolume(c)),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),this._ctx.engineDestroyed)return this._destroyLocalTrack(),s;if(this._wtnStreamManager._updatePushTrack(),!this._room)return s;const{isAutoPublish:d}=this._room.config;return((e=this._room.localStream)!==null&&e!==void 0&&e.pubAudio||d)&&this._ctx.visibility&&this._updatePublish(),(i=this._room.localStream)===null||i===void 0||(i=i.observer)===null||i===void 0||i.setEnableAudio(!0),s}async stopAudioCapture(){var t,e,i;if(this.logger.info("stopAudioCapture()"),this._trackSourceType.audio===Bt.AUDIO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.destroy()),this._localAudioTrack=void 0,(t=this._audioMixingManager)===null||t===void 0||t.stopAll(),this._wtnStreamManager._updatePushTrack(),this._room&&((e=this._room.localStream)!==null&&e!==void 0&&e.pubAudio&&await this._updatePublish(),(i=this._room.localStream)===null||i===void 0||(i=i.observer)===null||i===void 0||i.setEnableAudio(!1))}async startAudioAndVideoCapture(t,e){var i,s,o,r;this.logger.print("startAudioAndVideoCapture","optionsOrAudioDeviceId: $o",t,"videoDeviceId: $o",e);const{audioDeviceId:n,videoDeviceId:a}=zw(t,e);if(n&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:n}}),this._trackSourceType.video===Pt.VIDEO_SOURCE_TYPE_EXTERNAL||this._trackSourceType.audio===Bt.AUDIO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,this._trackSourceType.video===Pt.VIDEO_SOURCE_TYPE_EXTERNAL?"setVideoSourceType as internal first":"setAudioSourceType as internal first");if(this._localVideoTrack&&!this._localVideoTrack.dummy)throw new G(C.REPEAT_CAPTURE,"video has already capture");if(this._localAudioTrack)throw new G(C.REPEAT_CAPTURE,"audio has already capture");const c=this._ctx.videoProfile.getCaptureConfig(a);let d={},l={};const{audioTrack:u,videoTrack:p}=await n3(this._ctx,this._ctx.audioProfileManager.getConstraints(),c),h=this._ctx.videoProfile.getContentHint();h&&p.setContentHint(h),a&&this._ctx.videoProfile.setCaptureDeviceId(a),this._initLocalTrackEvents(p),this._localVideoTrack=p,this._localVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((f=>{var g,Z;(g=this._localVideoTrack)===null||g===void 0||g.setPlayer(f,this._mirrorType,(Z=this._config)===null||Z===void 0?void 0:Z.autoPlayPolicy,this._initPlayerEvents.bind(this))})),this._initLocalTrackEvents(u),this._localAudioTrack=u,this._localAudioTrack.setVolume(this._localAudioVolume);const{frameSize:_,callback:y}=this._ctx._localAudioTrackDumpConfig[V.STREAM_INDEX_MAIN];_&&y&&this._localAudioTrack.setDataFetcher(_,y),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack);let b=p.originTrack;d=b.getSettings();const S={width:d.width||0,height:d.height||0};if(this._localVideoTrack.resolution=S,this._ctx.videoProfile.__autoResetVideoEncoderConfig(d),setTimeout((()=>this.safeEmit(Y.onLocalVideoSizeChanged,{streamIndex:V.STREAM_INDEX_MAIN,info:S}))),b=u.originTrack,l=b.getSettings(),this._ctx.engineDestroyed)return this._destroyLocalTrack(),{audioTrackSettings:l,videoTrackSettings:d};if(this._wtnStreamManager._updatePushTrack(),!this._room)return{audioTrackSettings:l,videoTrackSettings:d};const{isAutoPublish:v}=this._room.config;return((i=this._room.localStream)!==null&&i!==void 0&&i.pubVideo||(s=this._room.localStream)!==null&&s!==void 0&&s.pubAudio||v)&&this._ctx.visibility&&this._updatePublish(),(o=this._room.localStream)===null||o===void 0||(o=o.observer)===null||o===void 0||o.setEnableVideo(!0),(r=this._room.localStream)===null||r===void 0||(r=r.observer)===null||r===void 0||r.setEnableAudio(!0),{audioTrackSettings:l,videoTrackSettings:d}}async startVideoAndAudioCapture(t,e){return this.startAudioAndVideoCapture(e,t)}getAudioMixingManager(){return this.logger.info("getAudioMixingManager()","invoke"),this._audioMixingManager||(this._audioMixingManager=new yt({getLocalAudioTrack:()=>this._localAudioTrack,updateLocalAudioTrack:this._updateMixAudioTrack,emitMessage:this._onAudioMixingMessage,onAutoPlayFailed:this._onAudioMixingAutoplayFailed},this.id)),this._audioMixingManager}getWTNStreamManager(){return this._wtnStreamManager}getCallId(){var t;return(t=this._ctx)===null||t===void 0?void 0:t.callId}async startScreenCapture(){var t,e,i;let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.logger.info("startScreenCapture()","config: %o",s),this._trackSourceType.screenVideo===Pt.VIDEO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");if(this._trackSourceType.screenAudio===Bt.AUDIO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");const[o,r]=await a3(this._ctx,s);r?.setVolume(this._localScreenAudioVolume),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy()),(t=this._localScreenAudioTrack)===null||t===void 0||t.destroy(),delete this._localScreenAudioTrack,this._localScreenVideoTrack=o;const{contentHint:n}=this._ctx.videoProfile.getScreenEncodeConfig();n&&o.setContentHint(n);const a=o.originTrack;setTimeout((()=>{const c=a.getSettings(),d={width:c.width,height:c.height};o.resolution=d,this.safeEmit(Y.onLocalVideoSizeChanged,{streamIndex:V.STREAM_INDEX_SCREEN,info:{width:c.width,height:c.height}})}),500),r&&(this._localScreenAudioTrack=r,this._initLocalTrackEvents(r)),this._localVideoPlayerConfig[V.STREAM_INDEX_SCREEN].forEach((c=>{var d,l;(d=this._localScreenVideoTrack)===null||d===void 0||d.setPlayer(c,yi.MIRROR_TYPE_NONE,(l=this._config)===null||l===void 0?void 0:l.autoPlayPolicy,this._initPlayerEvents.bind(this))})),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),((e=this._room)!==null&&e!==void 0&&(e=e.localScreenStream)!==null&&e!==void 0&&e.pubAudio||(i=this._room)!==null&&i!==void 0&&(i=i.localScreenStream)!==null&&i!==void 0&&i.pubVideo)&&await this._updateScreenPublish()}async stopScreenCapture(){var t,e,i,s;this.logger.info("stopScreenCapture()"),(t=this._localScreenVideoTrack)===null||t===void 0||t.stopAll(),this._localScreenVideoTrack&&(this._localScreenVideoTrack.dummy||(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy(),this._localImgScreenTrack&&this._localScreenVideoTrack.setTrack(this._localImgScreenTrack,{isDummy:!0}))),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.destroy()),this._localScreenAudioTrack=void 0,(e=this._localScreenVideoTrack)!==null&&e!==void 0&&e.dummy||(this._localScreenVideoTrack=void 0),((i=this._room)!==null&&i!==void 0&&(i=i.localScreenStream)!==null&&i!==void 0&&i.pubAudio||(s=this._room)!==null&&s!==void 0&&(s=s.localScreenStream)!==null&&s!==void 0&&s.pubVideo)&&await this._updateScreenPublish()}setLocalVideoPlayer(t,e){var i;this.logger.info("setLocalVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]);const s=t===V.STREAM_INDEX_MAIN?this._localVideoTrack:this._localScreenVideoTrack,o=(i=e?.playerId)!==null&&i!==void 0?i:Ft;if(e==null||!e.renderDom){var r,n;(r=this._localVideoPlayerConfig[t].get(o))===null||r===void 0||(r=r.player)===null||r===void 0||r.destroy(),s?.removePlayer(o);const u=(n=this._localVideoPlayerConfig[t].get(o))===null||n===void 0?void 0:n.renderDom;return this._containerCollisionDetector.unregisterContainer(u),void this._localVideoPlayerConfig[t].delete(o)}Gy(e);const a=this._localVideoPlayerConfig[t].get(o);if(!a){var c,d,l;const{renderDom:u}=e;if(!this._containerCollisionDetector.registerContainer(u))return this.monitor.report("rtc_error",{message:"RenderDom is not empty",error_code:At.DUPLICATE_DOM}),void As("renderDom is not empty");const p=new Fs(this._ctx.id,o,I(I({},e),{},{isLocal:!0,isScreen:t===V.STREAM_INDEX_SCREEN,userId:(c=e.userId)!==null&&c!==void 0?c:"_local_"})),h=I(I({},e),{},{player:p});return this._localVideoPlayerConfig[t].set(o,h),s?.setPlayer(h,t===V.STREAM_INDEX_MAIN?this._mirrorType:yi.MIRROR_TYPE_NONE,(d=this._config)===null||d===void 0?void 0:d.autoPlayPolicy,this._initPlayerEvents.bind(this)),(l=h.player)===null||l===void 0?void 0:l.domElement}e.renderMode!==void 0&&(s?.setRenderMode(o,e.renderMode),a.renderMode=e.renderMode)}async startLiveTranscoding(t){var e;this.logger.info("startLiveTranscoding()","transcode: %o",t),Zr.checkStartParams(t),this._liveTranscodeConfig=t;const i=(e=this._room)===null||e===void 0?void 0:e.config;if(i&&i.roomId.length+i.userId.length>126)throw new G(C.INVALID_PARAMS,"The roomId+userId must be within 126 bytes");try{this.safeEmit(Y.onStreamMixingEvent,{event:pi.START,error:0,message:""}),this._room&&this._ctx.signalingManager.isConnected()&&await this._room.liveControlMessage(Zr.getStartParams(this._liveTranscodeConfig))}catch(s){throw s instanceof G?s:new G(C.UNEXPECTED_ERROR,"unexpected error",s)}}async updateLiveTranscoding(t){var e,i;if(this.logger.info("updateLiveTranscoding()","transcode: %o",t),!this._liveTranscodeConfig)return;const s=Zh({},t);delete s.audio,(e=s.video)===null||e===void 0||delete e.codec,(i=s.video)===null||i===void 0||delete i.gop,Zr.checkUpdateParams(s),this._liveTranscodeConfig=Zh(this._liveTranscodeConfig,s);try{var o;this.safeEmit(Y.onStreamMixingEvent,{event:pi.UPDATE,error:0,message:""}),await((o=this._room)===null||o===void 0?void 0:o.liveControlMessage(Zr.getUpdateParams(this._liveTranscodeConfig)))}catch(r){throw r instanceof G?r:new G(C.UNEXPECTED_ERROR,"unexpected error",r)}}async stopLiveTranscoding(){if(this.logger.info("stopLiveTranscoding()"),this._liveTranscodeConfig){delete this._liveTranscodeConfig;try{var t;this.safeEmit(Y.onStreamMixingEvent,{event:pi.STOP,error:0,message:""}),await((t=this._room)===null||t===void 0?void 0:t.liveControlMessage({action:"stopped",type:"transcode"}))}catch(e){throw e instanceof G?e:new G(C.UNEXPECTED_ERROR,"unexpected error",e)}}}async startSubtitle(t){var e;this.logger.info("startSubtitle()","config: %o",t),this._assertNotInRoom(),await((e=this._room)===null||e===void 0?void 0:e.startSubtitle(t))}async updateSubtitleConfig(t){var e;this.logger.info("updateSubtitleConfig()","config: %o",t),this._assertNotInRoom(),await((e=this._room)===null||e===void 0?void 0:e.updateSubtitleConfig(t))}stopSubtitle(){var t;this.logger.info("stopSubtitle()","invoke"),(t=this._room)===null||t===void 0||t.stopSubtitle()}setBusinessId(t){return this.logger.info("setBusinessId()","businessId: %s",t),!Fw(t)&&!this._room&&(this._ctx.businessId=t,!0)}async setUserVisibility(t){var e;if(this.logger.info("setUserVisibility()","enable: %o",t),t=!!t,this._ctx.visibility!==t)if(this._room){var i;if(this._assertNotInRoom(),this._room.localStream&&((i=this._room.localStream.observer)===null||i===void 0||i.setPublisher(t)),!t){const s=await this._pubLock.lock();try{this._room.unpublish(),this._room.unpublishScreen()}finally{s()}}this._ctx.visibility=t;try{await this._room.updateUserAttributes()}catch(s){throw this._ctx.visibility=!t,s}t&&(e=this._room)!==null&&e!==void 0&&e.config.isAutoPublish&&this._updatePublish({mediaType:Q.AUDIO_AND_VIDEO})}else this._ctx.visibility=t}_initPlayerEvents(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:V.STREAM_INDEX_MAIN)===V.STREAM_INDEX_SCREEN;t.on("playback_event",(s=>{switch(s.eventName){case"timeupdate":if(!t.hasStartPlaying&&t instanceof Cc){var o;t.hasStartPlaying=!0;const d=t.userId.replace("_screen",""),l=(o=this._room)===null||o===void 0||(o=o.remoteStreams.get(d))===null||o===void 0?void 0:o.find((u=>u.isScreen===i));setTimeout((()=>{var u;const p={is_screen:i,media_type:"audio",codec:l==null||(u=l.getRemoteStreamStats())===null||u===void 0||(u=u.audioStats)===null||u===void 0?void 0:u.codecType};this.logger.info("remote_audio_playing",JSON.stringify(p)),this.monitor.report("remote_audio_playing",p)}),8e3)}return;case"loadeddata":if(s.type==="audio"){var r;const d=t.userId.replace("_screen",""),l=(r=this._room)===null||r===void 0||(r=r.remoteStreams.get(d))===null||r===void 0?void 0:r.find((p=>p.isScreen===i)),u=()=>{e?this.safeEmit(Y.onFirstPublicStreamAudioFrameDecoded,{publicStreamId:d}):(this.safeEmit(Y.onAudioFirstFrameDecoded,{userId:d,isScreen:i}),this.safeEmit(Y.onRemoteAudioFirstFrame,{userId:d,isScreen:i})),this.monitor.report("first_remote_audio_render",{stream_id:"",stream_user_id:d||""},{isScreen:i})};l==null||!l.observer||l.observer.audioFirstFrameReceived?u():l.observer.once("recvAudioFirstFrame",u)}else{var n,a;const d={userId:t.userId,height:((n=t.domElement)===null||n===void 0?void 0:n.videoHeight)||0,width:((a=t.domElement)===null||a===void 0?void 0:a.videoWidth)||0,isScreen:i,playerId:t.playerId};e?(d.publicStreamId=d.userId,delete d.userId,delete d.isScreen,this.safeEmit(Y.onFirstPublicStreamVideoFrameRendered,d),this.safeEmit(Y.onFirstPublicStreamVideoFrameDecoded,d)):t.isLocal||(this.safeEmit(Y.onVideoFirstFrameRendered,d),this.safeEmit(Y.onVideoFirstFrameDecoded,d),this.safeEmit(Y.onRemoteVideoFirstFrame,d)),this.monitor.report("first_remote_video_render",{stream_id:"",stream_user_id:s.userId||""},{isScreen:i})}break;case"autoplay-error":{e&&(s.publicStreamId=s.userId),ye(this.id,"autoplay-error",t instanceof Fs?"video":"audio",0,s.userId||"");const d={userId:s.userId,kind:t instanceof Fs?"video":"audio",mediaType:t instanceof Fs?Q.VIDEO:Q.AUDIO,streamIndex:t.isScreen?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN};return t instanceof Fs&&(d.playerId=t.playerId===Ft?void 0:t.playerId),void this.safeEmit(Y.onAutoplayFailed,d)}case"playing":{var c;const d=t.userId.replace("_screen",""),l=(c=this._room)===null||c===void 0||(c=c.remoteStreams.get(d))===null||c===void 0?void 0:c.find((u=>u.isScreen===i));s.type==="video"&&setTimeout((()=>{var u,p,h,_,y,b,S,v,f,g;const Z={is_screen:i,media_type:"video",codec:l==null||(u=l.getRemoteStreamStats())===null||u===void 0||(u=u.videoStats)===null||u===void 0?void 0:u.codecType,stats_frame_size_width:l==null||(p=l.getRemoteStreamStats())===null||p===void 0||(p=p.videoStats)===null||p===void 0?void 0:p.frameSizeWidth,stats_frame_size_height:l==null||(h=l.getRemoteStreamStats())===null||h===void 0||(h=h.videoStats)===null||h===void 0?void 0:h.frameSizeHeight,stats_frame_rate_decode:l==null||(_=l.getRemoteStreamStats())===null||_===void 0||(_=_.videoStats)===null||_===void 0?void 0:_.decoderOutputFrameRate,stats_frame_rate_receive:l==null||(y=l.getRemoteStreamStats())===null||y===void 0||(y=y.videoStats)===null||y===void 0?void 0:y.receivedFrameRate,stats_frame_decoder_name:l==null||(b=l.getRemoteStreamStats())===null||b===void 0||(b=b.videoStats)===null||b===void 0?void 0:b.decoderName,stats_gpu_url:de.GPU_URL||((S=Yi())===null||S===void 0?void 0:S.renderer),track_frame_size_width:l==null||(v=l.videoTrack)===null||v===void 0||(v=v.originTrack)===null||v===void 0?void 0:v.getSettings().width,track_frame_size_height:l==null||(f=l.videoTrack)===null||f===void 0||(f=f.originTrack)===null||f===void 0?void 0:f.getSettings().height,track_frame_rate:l==null||(g=l.videoTrack)===null||g===void 0||(g=g.originTrack)===null||g===void 0?void 0:g.getSettings().frameRate};this.logger.info("remote_video_playing",JSON.stringify(Z)),this.monitor.report("remote_video_playing",Z)}),8e3);break}}t instanceof Fs&&(s.playerId=t.playerId===Ft?void 0:t.playerId),this.safeEmit(Y.onPlayerEvent,s)}))}_initLocalTrackEvents(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];["track-ended","track-mute","track-unmute"].forEach((i=>{t.on(i,(async s=>{this.monitor.report("rtc_error",{message:"track-".concat(i," mediaType: ").concat(s.originTrack.kind),error_code:At.TRACK_ERROR,capture_session_id:s.captureSessionId,media_type:i,reason:i});let o=!1;s!==this._localScreenAudioTrack&&s!==this._localScreenVideoTrack||(o=!0);const{kind:r}=s.originTrack;this.safeEmit({"track-ended":Y.onTrackEnded,"track-mute":Y.onTrackMute,"track-unmute":Y.onTrackUnmute}[i],{kind:r,isScreen:o}),(yo||mc)&&(i==="track-mute"&&(is.emit(ki.ON_IOS_LOCAL_TRACK_MUTE,r),r==="audio"&&(await this.stopAudioCapture(),this.startAudioCapture())),i==="track-unmute"&&is.emit(ki.ON_IOS_LOCAL_TRACK_UNMUTE,r))}))})),t.on("resolution-change",(i=>{this._ctx.extensionManager.getPluginsByType(zr.PRE_PROCESSING).forEach((s=>{var o;s==null||(o=s.applyConstraints)===null||o===void 0||o.call(s,e?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN,i)})),this.safeEmit(Y.onLocalVideoSizeChanged,{streamIndex:e?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN,info:i})})),t.on("needReplaceTrack",(()=>{if(t instanceof Uo){var i,s;t.stopDataFetcher();const n=this._ctx._localAudioTrackDumpConfig[(i=t.streamIndex)!==null&&i!==void 0?i:V.STREAM_INDEX_MAIN];n!=null&&n.frameSize&&n!=null&&n.callback&&t.setDataFetcher(n.frameSize,n.callback);const{position:a,volume:c}=this._ctx.earMonitorSettings[(s=t.streamIndex)!==null&&s!==void 0?s:V.STREAM_INDEX_MAIN];if(a!==It.NONE&&(t.play(a),t.setPlaybackVolume(c)),this._room){const{streamIndex:d}=t;var o,r;d===V.STREAM_INDEX_MAIN?(o=this._room.localStream)!==null&&o!==void 0&&o.pubAudio&&this._ctx.visibility&&this._updatePublish():(r=this._room.localStream)!==null&&r!==void 0&&r.pubAudio&&this._ctx.visibility&&this._updateScreenPublish()}}})),t.on("autoplay-error",(i=>{this.safeEmit(Y.onAutoplayFailed,i)}))}_removeLocalTrackEvents(t){t.removeAllListeners("track-ended"),t.removeAllListeners("track-mute"),t.removeAllListeners("track-unmute"),t.removeAllListeners("resolution-change")}setRemoteVideoPlayer(t,e){var i,s,o,r,n,a;this.logger.info("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),Gy(e);const{userId:c}=e,d=t===V.STREAM_INDEX_SCREEN,l=(i=this._room)===null||i===void 0||(i=i.remoteStreams.get(c))===null||i===void 0?void 0:i.find((v=>v.isScreen===d)),u=l?.videoTrack,p=(s=e.playerId)!==null&&s!==void 0?s:Ft;(o=this._getRemoteVideoPlayerConfig(t,c,p))===null||o===void 0||(o=o.player)===null||o===void 0||o.destroy();const h=(r=this._getRemoteVideoPlayerConfig(t,c,p))===null||r===void 0?void 0:r.renderDom;var _;if(this._containerCollisionDetector.unregisterContainer(h),!e.renderDom)return(_=this._remoteVideoPlayerConfig[t].get(c))===null||_===void 0||_.delete(p),void(u==null||u.removePlayer(p));const{renderDom:y}=e;if(!this._containerCollisionDetector.registerContainer(y))return this.monitor.report("rtc_error",{message:"RenderDom is not empty",error_code:At.DUPLICATE_DOM}),void As("renderDom is not empty");const b=new Fs(this.id,p,I(I({},e),{},{isLocal:!1,isScreen:d,userId:c})),S=I(I({},e),{},{player:b});return this._setRemoteVideoPlayerConfig(t,c,p,S),u?.setPlayer(this.id,S,(n=this._config)===null||n===void 0?void 0:n.autoPlayPolicy,this._initPlayerEvents.bind(this)),l&&this._updateVideoPlayerState(l),(a=S.player)===null||a===void 0?void 0:a.domElement}setLocalVideoMirrorType(t){var e;this.logger.info("setLocalVideoMirrorType()","mirrorType: %o",t),_e(t,"mirrorType",[yi.MIRROR_TYPE_NONE,yi.MIRROR_TYPE_RENDER]),this._mirrorType=t,(e=this.localVideoTrack)===null||e===void 0||e.mirror(!!t)}setRemoteVideoMirrorType(t,e,i){var s;this.logger.info("setRemoteVideoMirrorType()","userId: %s, streamIndex: %o, mirrorType: %o",t,e,i),wt(t),_e(e,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),_e(i,"mirrorType",[yi.MIRROR_TYPE_NONE,yi.MIRROR_TYPE_RENDER]),this._ctx.setUserStreamConf(t,e,{mirrorType:i}),(s=this._room)===null||s===void 0||(s=s.remoteStreams.get(t))===null||s===void 0||(s=s.find((o=>o.isScreen===(e===V.STREAM_INDEX_SCREEN))))===null||s===void 0||(s=s.videoTrack)===null||s===void 0||s.mirror(!!i)}async setAudioPlaybackDevice(t){var e;this.logger.info("setAudioPlaybackDevice()","deviceId: %s",t),Le(t,"deviceId");const i=await this._audioDeviceManager.setSinkId(t);(e=this._room)===null||e===void 0||e.remoteStreams.forEach((s=>{s.forEach((o=>{var r;(r=o.audioTrack)===null||r===void 0||r.setPlaybackDevice(t)}))})),this.safeEmit(Y.onAudioPlaybackDeviceChanged,i),this.monitor.report("rtc_audio_device",{audio_event:"playout_device_switch",message:JSON.stringify(i),error_code:0})}async play(t){var e;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Q.AUDIO_AND_VIDEO,s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;this.logger.info("play()","userId: %s, mediaType: %s, streamIndex: %s",t,i,s);const r=o??Ft,n=!t||t===this._getUserId()||t==="local_user",a=s===void 0||s===V.STREAM_INDEX_MAIN,c=s===void 0||s===V.STREAM_INDEX_SCREEN,d=i!==Q.VIDEO,l=i!==Q.AUDIO,u=[];if(n&&l){if(a&&this._localVideoTrack){this._localVideoTrack.mirror(!!this._mirrorType);const y=this._localVideoTrack.play(r);y&&u.push(y)}if(c&&this._localScreenVideoTrack){var p;!((p=this._localScreenVideoTrack)===null||p===void 0)&&p.manuallyPlay(r)&&u.push()}}this._audioMixingManager&&t===this._audioMixingManager.id&&u.push(this._audioMixingManager.resumeLocalPlay());let h=[];var _;return(e=this._room)===null||e===void 0||e.remoteStreams.forEach(((y,b)=>{t&&t!==b||y.forEach((S=>{S.audioTrack&&h.push(S.audioTrack),S.videoTrack&&h.push(S.videoTrack)}))})),this._wtnStreamManager.__getRemoteStreams().forEach(((y,b)=>{t&&t!==b||(y.audioTrack&&h.push(y.audioTrack),y.videoTrack&&h.push(y.videoTrack))})),a||(h=h.filter((y=>!!y.isScreen))),c||(h=h.filter((y=>!y.isScreen))),d||(h=h.filter((y=>y.mediaType!=="audio"))),l||(h=h.filter((y=>y.mediaType!=="video"))),d&&((_=this._room)===null||_===void 0||_.virtualStreams.forEach((y=>{y.audioTrack&&h.push(y.audioTrack)}))),h.forEach((y=>{const b=y.manuallyPlay(r);b&&u.push(b)})),Promise.all(u).then((()=>{}))}async stop(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Q.AUDIO_AND_VIDEO,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.logger.info("stop()","userId: %s, mediaType: %s, streamIndex: %s, playerId: %s",t,e,i,s);const o=s??Ft,r=!t||t===this._getUserId()||t==="local_user",n=i===void 0||i===V.STREAM_INDEX_MAIN,a=i===void 0||i===V.STREAM_INDEX_SCREEN,c=e!==Q.VIDEO,d=e!==Q.AUDIO;if(r&&d&&(n&&this._localVideoTrack&&this._localVideoTrack.pause(o),a&&this._localScreenVideoTrack&&this._localScreenVideoTrack.pause(o)),t){var l;let u=[];(l=this._room)===null||l===void 0||(l=l.remoteStreams.get(t))===null||l===void 0||l.forEach((_=>{_.audioTrack&&u.push(_.audioTrack),_.videoTrack&&u.push(_.videoTrack)}));const p=this._wtnStreamManager.__getPublicStreamTrack(t,"audio"),h=this._wtnStreamManager.__getPublicStreamTrack(t,"video");p&&u.push(p),h&&u.push(h),n||(u=u.filter((_=>!!_.isScreen))),a||(u=u.filter((_=>!_.isScreen))),c||(u=u.filter((_=>_.mediaType!=="audio"))),d||(u=u.filter((_=>_.mediaType!=="video"))),u.forEach((_=>{_.pause(o)}))}}getAudioVolume(t,e){_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]);let i=0;if(e){var s;const o=(s=this._room)===null||s===void 0||(s=s.remoteStreams.get(e))===null||s===void 0||(s=s.find((r=>r.isScreen===(t===V.STREAM_INDEX_SCREEN))))===null||s===void 0?void 0:s.audioTrack;o&&(i=o.getAudioLevel())}else{const o=t===V.STREAM_INDEX_MAIN?this._localAudioTrack:this._localScreenAudioTrack;o&&(i=o.getAudioLevel())}return{linearVolume:i,nonlinearVolume:Mn(i)}}setAudioFrameCallback(t,e,i){var s;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:4096;if(this.logger.info("setAudioFrameCallback()","streamIndex: %s, userId: %s, callback: %s, frameSize: %s",t,e,i?"true":"false",o),_e(o,"frameSize",[256,512,1024,2048,4096,8192,16384]),oi.isWorkletReady===void 0&&oi.getAudioContextInstance(),oi.isWorkletReady===null)throw this.logger.error("setAudioFrameCallback()","Not support AudioWorklet"),new G(C.NOT_SUPPORTED,"Not support AudioWorklet");e?i?this._ctx._remoteAudioTrackDumpConfig[t].set(e,{callback:i,frameSize:o}):this._ctx._remoteAudioTrackDumpConfig[t].delete(e):this._ctx._localAudioTrackDumpConfig[t]={callback:i,frameSize:i?o:void 0};const r=e?(s=this._room)===null||s===void 0||(s=s.remoteStreams.get(e))===null||s===void 0||(s=s.find((n=>n.isScreen===(t===V.STREAM_INDEX_SCREEN))))===null||s===void 0?void 0:s.audioTrack:t===V.STREAM_INDEX_MAIN?this._localAudioTrack:this._localScreenAudioTrack;r?i?r.setDataFetcher(o,i):r.stopDataFetcher():this.logger.warn("setAudioFrameCallback()","track not found")}async pauseAllSubscribedStream(t){return this.logger.info("pauseAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),Be(t)&&(this._pauseAllSubscribeState.audio=!0),Ve(t)&&(this._pauseAllSubscribeState.video=!0),this._room?this._pauseAllRemoteStreams(t):Promise.resolve()}async _pauseAllRemoteStreams(t){if(!this._room)return Promise.resolve();const e=[];return this._room.remoteStreams.forEach((i=>{Array.isArray(i)&&i.forEach((s=>{if(s.hasSubscribed){s.attributes.audiostream&&Be(t)&&(this._pauseAllSubscribeState.resumeAudioStreamIds[s.streamId]=s.streamId),s.attributes.videostream&&Ve(t)&&(this._pauseAllSubscribeState.resumeVideoStreamIds[s.streamId]=s.streamId);const o=this._unsubscribe(s.isScreen,s.userId,t,!0);o&&e.push(o)}}))})),Promise.all(e).then((()=>{}))}async resumeAllSubscribedStream(t){if(this.logger.info("resumeAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),Be(t)&&(this._pauseAllSubscribeState.audio=!1),Ve(t)&&(this._pauseAllSubscribeState.video=!1),!this._room)return Promise.resolve();await this._triedResumeAllRemoteStreams(t,!1)}async _triedResumeAllRemoteStreams(t,e){if(!this._room||this._pauseAllSubscribeState.audio&&t===Q.AUDIO||this._pauseAllSubscribeState.video&&t===Q.VIDEO||this._pauseAllSubscribeState.video&&this._pauseAllSubscribeState.audio&&t===Q.AUDIO_AND_VIDEO)return Promise.resolve();const i=[],s=[...Object.keys(this._pauseAllSubscribeState.resumeAudioStreamIds)],o=[...Object.keys(this._pauseAllSubscribeState.resumeVideoStreamIds)];return this._room.remoteStreams.forEach((r=>{Array.isArray(r)&&r.forEach((n=>{if(e&&n.isScreen)return;const a=this._pauseAllSubscribeState.resumeAudioStreamIds[n.streamId],c=this._pauseAllSubscribeState.resumeVideoStreamIds[n.streamId];if(a&&Be(t)||c&&Ve(t)){const d=this._subscribe(n.isScreen,n.userId,t).then((()=>{a&&Be(t)&&delete this._pauseAllSubscribeState.resumeAudioStreamIds[n.streamId],c&&Ve(t)&&delete this._pauseAllSubscribeState.resumeVideoStreamIds[n.streamId]}));d&&i.push(d)}}))})),Promise.all(i).then((()=>{var r;return(r=this._room)===null||r===void 0||r.remoteStreams.forEach((n=>{Array.isArray(n)&&n.forEach((a=>{this._updateAudioPlayerState(a),this._updateVideoPlayerState(a)}))})),Promise.resolve()})).finally((()=>{var r;return(r=this._room)!==null&&r!==void 0&&r.config.tokenSubscribePrivilegeExpired&&(s.forEach((n=>{this._pauseAllSubscribeState.resumeAudioStreamIds[n]=n})),o.forEach((n=>{this._pauseAllSubscribeState.resumeVideoStreamIds[n]=n}))),Promise.resolve()}))}async sendUserMessage(t,e){var i;wt(t),this._assertNotInRoom();const s=Date.now();return(i=this._room)===null||i===void 0||(i=i.sendUserMessage(t,e))===null||i===void 0?void 0:i.then((o=>(this._messageStatisticsObserver.countP2PMessage(!0,t,!1,s,o),o.id))).catch((o=>{throw this._messageStatisticsObserver.countP2PMessage(!1,t,!1,s,o),o}))}async sendUserBinaryMessage(t,e){var i;wt(t),Su(e,"message"),this._assertNotInRoom();const s=Date.now();return(i=this._room)===null||i===void 0||(i=i.sendUserMessage(t,e))===null||i===void 0?void 0:i.then((o=>(this._messageStatisticsObserver.countP2PMessage(!0,t,!0,s,o),o.id))).catch((o=>{throw this._messageStatisticsObserver.countP2PMessage(!1,t,!0,s,o),o}))}async sendRoomMessage(t){var e,i;this._assertNotInRoom();const s=(e=this._room)===null||e===void 0?void 0:e.config.roomId,o=Date.now();return(i=this._room)===null||i===void 0||(i=i.sendRoomMessage(t))===null||i===void 0?void 0:i.then((r=>(this._messageStatisticsObserver.countRoomMessage(!0,s,!1,o),r))).catch((r=>{throw this._messageStatisticsObserver.countRoomMessage(!1,s,!1,o),r}))}async sendRoomBinaryMessage(t){var e,i;this._assertNotInRoom();const s=(e=this._room)===null||e===void 0?void 0:e.config.roomId,o=Date.now();return(i=this._room)===null||i===void 0||(i=i.sendRoomMessage(t,!0))===null||i===void 0?void 0:i.then((r=>(this._messageStatisticsObserver.countRoomMessage(!0,s,!0,o),r))).catch((r=>{throw this._messageStatisticsObserver.countRoomMessage(!1,s,!0,o),r}))}async setAudioCaptureConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger.info("setAudioCaptureConfig()","config: %o",t),delete t.deviceId,ah(t),await this._shouldUpdateAudioConf("setAudioCaptureConfig")&&this._ctx.audioProfileManager.updateConstraints(t)}async setVideoCaptureConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.logger.info("setVideoCaptureConfig()","config: %o",t),this._setVideoCaptureConfig(t)}async _setVideoCaptureConfig(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};delete e.deviceId,ah(e);const i=I(I({},this._ctx.videoProfile.getCaptureConfig()),e);return this._localVideoTrack&&await this._localVideoTrack.updateVideoCaptureConfig(i),this._ctx.videoProfile.setCaptureConfig(i),((t=this._localVideoTrack)===null||t===void 0?void 0:t.originTrack.getSettings())||{}}enableSimulcastMode(t){this.logger.info("enableSimulcastMode()","enabled: %o",t),this._ctx.videoProfile.checkSimulcastApiVersion("old");try{return this._ctx.videoProfile.setSimulcastMode(t?Qs.VIDEO_ON_DEMAND:Qs.VIDEO_ONLY_ONE,this._room),!0}catch{return!1}}async setLocalSimulcastMode(t,e){var i;this.logger.info("setLocalSimulcastMode()","mode: %o, config: %o",t,e),this._ctx.videoProfile.checkSimulcastApiVersion("new"),await this._ctx.videoProfile.setSimulcastMode(t,this._room),await this._ctx.videoProfile.setSubVideoEncodeConfig(e,this._room,this._localVideoTrack),await((i=this._room)===null||i===void 0?void 0:i.hasPublished())&&this._updatePublish()}async setVideoEncoderConfig(t){var e;if(this.logger.info("setVideoEncoderConfig()","descriptions: %o",t),await this._ctx.videoProfile.setVideoEncodeConfigPolyfill(t),this._localVideoTrack){const i=this._ctx.videoProfile.getContentHint();i&&this._localVideoTrack.setContentHint(i),await this._localVideoTrack.updateVideoCaptureConfig(this._ctx.videoProfile.getCaptureConfig())}this._updateDummyCaptureImage(V.STREAM_INDEX_MAIN),await((e=this._room)===null||e===void 0?void 0:e.hasPublished())&&this._updatePublish()}setVideoEncoderAutoConfigList(t){if(Array.isArray(t))return en(t).call(t,((e,i)=>e.maxKbps-i.maxKbps)),iZ(t)}async setScreenEncoderConfig(t){var e;this.logger.info("setScreenEncoderConfig()","description: %o",t),this._ctx.videoProfile.setScreenEncodeConfig(t),this._localScreenVideoTrack&&(Xo!=="16.1"&&await this._localScreenVideoTrack.updateVideoCaptureConfig(t),t.contentHint&&this._localScreenVideoTrack.setContentHint(t.contentHint)),this._updateDummyCaptureImage(V.STREAM_INDEX_SCREEN),await((e=this._room)===null||e===void 0?void 0:e.hasScreenPublished())&&this._updateScreenPublish()}sendSEIMessage(t,e,i){if(this.logger.info("sendSEIMessage()","streamIdex: %o, message: %o, repeatCount: %o",t,e,i),!cs()&&!Qo())return As("Your browser does not support sending SEI"),!1;_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),ko(i,"repeatCount",0,30);const s=typeof e=="string"?new Uint8Array($e.str2ab(e)):e;if(!e.length)return this.logger.warn("sei message must not be empty"),!1;let o;if(t===V.STREAM_INDEX_MAIN){var r,n;if(!((r=this._room)!==null&&r!==void 0&&(r=r.localStream)!==null&&r!==void 0&&r.pubAudio||(n=this._room)!==null&&n!==void 0&&(n=n.localStream)!==null&&n!==void 0&&n.pubVideo))return;o=this._room.localStream}else{var a,c;if(!((a=this._room)!==null&&a!==void 0&&(a=a.localScreenStream)!==null&&a!==void 0&&a.pubAudio||(c=this._room)!==null&&c!==void 0&&(c=c.localScreenStream)!==null&&c!==void 0&&c.pubVideo))return;o=this._room.localScreenStream}if(s.byteLength>4096)return void this.logger.warn("sei size must not bigger than 4KB");var d;as||(d=this._room)===null||d===void 0||d.maybeFillBackFrame2Stream(o);const l=Ts();return o.sendSEIMessage({content:s,uuid:l,repeatCount:i+1}),setTimeout((async()=>{if(o&&await o.revokeSEIMessage(l)){const u="timeout for sei message(id: ".concat(l,")");console.error("[RTC WebSDK] ".concat(u)),this.monitor.report("rtc_sdk_callback",{sdk_callback_name:"sendSEIMessageTimeout",message:u,error_code:400})}}),ae("SEI_TIME_OUT")),l}setAudioVolumeIndicationInterval(t){this.logger.info("setAudioVolumeIndicationInterval()","interval %o: ",t),(typeof t!="number"||t<200)&&(t=200);let e=[];this._audioVolumeIndicationTimer&&clearInterval(this._audioVolumeIndicationTimer),this._audioVolumeIndicationTimer=setInterval((()=>{var i,s;e=[],(i=this._room)===null||i===void 0||i.remoteStreams.forEach(((r,n)=>{var a;if(r.length===0)return;const c=r.find((l=>!l.isScreen)),d=c==null||(a=c.audioTrack)===null||a===void 0?void 0:a.getAudioLevel();e.push({userId:n,volume:d||0})}));const o=(s=this._localAudioTrack)===null||s===void 0?void 0:s.getAudioLevel();e.push({userId:this._getUserId(),volume:o||0}),this.safeEmit(Y.onAudioVolumeIndication,{speakers:e})}),t)}_sendActiveSpeaker(t,e){if(this._room&&this._room.remoteUsers.size>=1){const i=t[0],s=e.reduce(((r,n)=>r&&r.audioPropertiesInfo.nonlinearVolume>n.audioPropertiesInfo.nonlinearVolume?r:n),void 0);let o;if(o=i?s?i.audioPropertiesInfo.nonlinearVolume>s.audioPropertiesInfo.nonlinearVolume?i:s:i:s,o&&o.audioPropertiesInfo.nonlinearVolume>-35){let r;r=o.streamKey?this._room.remoteUsers.get(o.streamKey.userId):this._room.config.userInfo,r&&this.safeEmit(Y.onActiveSpeaker,{userId:r.userId,extraInfo:r.extraInfo})}}}enableAudioPropertiesReport(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger.info("enableAudioPropertiesReport()","config %o: ",t);const{enableInBackground:e=!0,localMainReportMode:i=Qn.NORMAL,audioReportMode:s=ac.MICROPHONE}=t;let{interval:o=100}=t;this._stopAudioPropertiesReport(),o<=0||(o=Math.max(100,o),this._audioPropertiesReportTimer=self.setInterval((()=>{if(!e&&document.visibilityState==="hidden")return;const r=[],n=this._audioDeviceManager.getRecordTrack()||this._localAudioTrack;if(n){var a;const c=(a=this._room)===null||a===void 0||(a=a.localStream)===null||a===void 0?void 0:a.audioHasPublish,d=!!this._audioDeviceManager.getRecordTrack(),l=n.getAudioLevel(s),u=Mn(l),p={streamIndex:V.STREAM_INDEX_MAIN,audioPropertiesInfo:{linearVolume:l,nonlinearVolume:u}};if(c||d)r.push(p);else switch(i){case Qn.DISCONNECT:break;case Qn.RESET:p.audioPropertiesInfo.linearVolume=0,p.audioPropertiesInfo.nonlinearVolume=-127,r.push(p);break;case Qn.NORMAL:r.push(p);break;default:throw new G(C.INVALID_PARAMS,"invalid localMainReportMode: ".concat(i," in config"))}}if(this._localScreenAudioTrack){const c=this._localScreenAudioTrack.getAudioLevel();r.push({streamIndex:V.STREAM_INDEX_SCREEN,audioPropertiesInfo:{linearVolume:c,nonlinearVolume:Mn(c)}})}if(this.safeEmit(Y.onLocalAudioPropertiesReport,r),this._room){const c=[];this._room.config.isMultiChatMode()?this._room.getActiveSpeakerInMultiChatMode().forEach((d=>{var l,u;const p=255*d.audioLevel;c.push({streamKey:{userId:d.userId,streamIndex:V.STREAM_INDEX_MAIN,roomId:(l=(u=this._room)===null||u===void 0?void 0:u.config.roomId)!==null&&l!==void 0?l:""},audioPropertiesInfo:{linearVolume:p,nonlinearVolume:Mn(p)}})})):this._room.remoteStreams.forEach(((d,l)=>{d.forEach((u=>{if(u.audioTrack){var p,h;const _=u.audioTrack.getAudioLevel();c.push({streamKey:{userId:l,streamIndex:u.isScreen?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN,roomId:(p=(h=this._room)===null||h===void 0?void 0:h.config.roomId)!==null&&p!==void 0?p:""},audioPropertiesInfo:{linearVolume:_,nonlinearVolume:Mn(_)}})}}))})),this.safeEmit(Y.onRemoteAudioPropertiesReport,c),this._sendActiveSpeaker(r,c.filter((d=>d.streamKey.streamIndex!==V.STREAM_INDEX_SCREEN)))}}),o))}async setVideoSourceType(t,e){this.logger.print("setVideoSourceType()","index: %o, videoSourceType: %o",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),_e(e,"VideoSourceType",[Pt.VIDEO_SOURCE_TYPE_EXTERNAL,Pt.VIDEO_SOURCE_TYPE_INTERNAL]);const i=t===V.STREAM_INDEX_MAIN?"video":"screenVideo";if(this._trackSourceType[i]!==e){if(this._trackSourceType[i]=e,this.logger.print("setVideoSourceType","set ".concat(i," source type to ").concat(e)),this._localVideoTrack&&t===V.STREAM_INDEX_MAIN){var s,o,r;let p=!1;if(e===Pt.VIDEO_SOURCE_TYPE_EXTERNAL){p=!0;const _=this._ctx.extensionManager.getPluginByName(zr.PRE_PROCESSING,"RTCBeautyExtension");_&&_.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy()}(s=this._localVideoTrack)===null||s===void 0||s.destroy(),this._localVideoTrack=void 0;const h=(o=this._room)===null||o===void 0?void 0:o.config.isAutoPublish;var n,a;p?(n=this._room)===null||n===void 0||(n=n.localStream)===null||n===void 0||(n=n.observer)===null||n===void 0||n.setEnableVideo(!1):(a=this._room)===null||a===void 0||(a=a.localStream)===null||a===void 0||(a=a.observer)===null||a===void 0||a.setPushVideo(!1),((r=this._room)!==null&&r!==void 0&&(r=r.localStream)!==null&&r!==void 0&&r.pubVideo||h)&&await this._updatePublish()}if(this._localScreenVideoTrack&&t===V.STREAM_INDEX_SCREEN){var c,d;let p=!1;var l,u;e===Pt.VIDEO_SOURCE_TYPE_EXTERNAL&&(p=!0,this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy()),(c=this._localScreenVideoTrack)===null||c===void 0||c.destroy(),this._localScreenVideoTrack=void 0,p?(l=this._room)===null||l===void 0||(l=l.localScreenStream)===null||l===void 0||(l=l.observer)===null||l===void 0||l.setEnableVideo(!1):(u=this._room)===null||u===void 0||(u=u.localScreenStream)===null||u===void 0||(u=u.observer)===null||u===void 0||u.setPushVideo(!1),(d=this._room)!==null&&d!==void 0&&(d=d.localScreenStream)!==null&&d!==void 0&&d.pubVideo&&await this._updateScreenPublish()}}}async setExternalVideoTrack(t,e){if(this.logger.print("setExternalVideoTrack()","index: %o, track: %o",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),Wy(e),t===V.STREAM_INDEX_MAIN){var i,s;if(this._trackSourceType.video!==Pt.VIDEO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");this._localVideoTrack=await c3(this._ctx,e);const n=this._ctx.videoProfile.getContentHint();!e.contentHint&&n&&this._localVideoTrack.setContentHint(n),this._initLocalTrackEvents(this._localVideoTrack),this._localVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((c=>{var d,l;(d=this._localVideoTrack)===null||d===void 0||d.setPlayer(c,this._mirrorType,(l=this._config)===null||l===void 0?void 0:l.autoPlayPolicy,this._initPlayerEvents.bind(this))}));const a=(i=this._room)===null||i===void 0?void 0:i.config.isAutoPublish;((s=this._room)!==null&&s!==void 0&&(s=s.localStream)!==null&&s!==void 0&&s.pubVideo||a)&&await this._updatePublish()}if(t===V.STREAM_INDEX_SCREEN){var o,r;if(this._trackSourceType.screenVideo!==Pt.VIDEO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");this._localScreenVideoTrack=await u3(this._ctx,e),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),this._localVideoPlayerConfig[V.STREAM_INDEX_SCREEN].forEach((n=>{var a,c;(a=this._localScreenVideoTrack)===null||a===void 0||a.setPlayer(n,this._mirrorType,(c=this._config)===null||c===void 0?void 0:c.autoPlayPolicy,this._initPlayerEvents.bind(this))})),(o=this._room)===null||o===void 0||(o=o.localScreenStream)===null||o===void 0||(o=o.observer)===null||o===void 0||o.setPushVideo(!0),(r=this._room)!==null&&r!==void 0&&(r=r.localScreenStream)!==null&&r!==void 0&&r.pubVideo&&await this._updateScreenPublish()}}async setAudioSourceType(t,e){this.logger.print("setAudioSourceType()","index: %o, audioSourceType: %o",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),_e(e,"audioSourceType",[Bt.AUDIO_SOURCE_TYPE_EXTERNAL,Bt.AUDIO_SOURCE_TYPE_INTERNAL]);const i=t===V.STREAM_INDEX_MAIN?"audio":"screenAudio";if(this._trackSourceType[i]!==e){if(this._trackSourceType[i]=e,this.logger.print("setVideoSourceType","set ".concat(i," source type to ").concat(e)),this._localAudioTrack&&t===V.STREAM_INDEX_MAIN){var s,o;let l=!1;this._trackSourceType.audio===Bt.AUDIO_SOURCE_TYPE_EXTERNAL&&(l=!0,this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.destroy()),this._localAudioTrack=void 0;const u=(s=this._room)===null||s===void 0?void 0:s.config.isAutoPublish;var r,n;l?(r=this._room)===null||r===void 0||(r=r.localStream)===null||r===void 0||(r=r.observer)===null||r===void 0||r.setEnableAudio(!1):(n=this._room)===null||n===void 0||(n=n.localStream)===null||n===void 0||(n=n.observer)===null||n===void 0||n.setPushAudio(!1),((o=this._room)!==null&&o!==void 0&&(o=o.localStream)!==null&&o!==void 0&&o.pubAudio||u)&&await this._updatePublish()}if(this._localScreenAudioTrack&&t===V.STREAM_INDEX_SCREEN){var a;let l=!1;var c,d;this._trackSourceType.audio===Bt.AUDIO_SOURCE_TYPE_EXTERNAL&&(l=!0,this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.destroy()),this._localScreenAudioTrack=void 0,l?(c=this._room)===null||c===void 0||(c=c.localScreenStream)===null||c===void 0||(c=c.observer)===null||c===void 0||c.setEnableAudio(!1):(d=this._room)===null||d===void 0||(d=d.localScreenStream)===null||d===void 0||(d=d.observer)===null||d===void 0||d.setPushAudio(!1),(a=this._room)!==null&&a!==void 0&&(a=a.localScreenStream)!==null&&a!==void 0&&a.pubAudio&&await this._updateScreenPublish()}}}async setExternalAudioTrack(t,e){if(this.logger.print("setExternalAudioTrack()","index: %o, track: %o",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),Wy(e),t===V.STREAM_INDEX_MAIN){var i,s,o;if(this._trackSourceType.audio!==Bt.AUDIO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");this._localAudioTrack=await l3(this._ctx,e),this._localAudioTrack.setVolume(this._localAudioVolume),this._initLocalTrackEvents(this._localAudioTrack);const a=this._ctx._localAudioTrackDumpConfig[V.STREAM_INDEX_MAIN];a.frameSize&&a.callback&&this._localAudioTrack.setDataFetcher(a.frameSize,a.callback);const{position:c,volume:d}=this._ctx.earMonitorSettings[V.STREAM_INDEX_MAIN];c!==It.NONE&&(this.setEarMonitorMode(V.STREAM_INDEX_MAIN,c),this.setEarMonitorVolume(V.STREAM_INDEX_MAIN,d));const l=(i=this._room)===null||i===void 0?void 0:i.config.isAutoPublish;(s=this._room)===null||s===void 0||(s=s.localStream)===null||s===void 0||(s=s.observer)===null||s===void 0||s.setPushAudio(!0),((o=this._room)!==null&&o!==void 0&&(o=o.localStream)!==null&&o!==void 0&&o.pubAudio||l)&&await this._updatePublish()}if(t===V.STREAM_INDEX_SCREEN){var r,n;if(this._trackSourceType.screenAudio!==Bt.AUDIO_SOURCE_TYPE_EXTERNAL)throw new G(C.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");this._localScreenAudioTrack=await m3(this._ctx,e),this._localScreenAudioTrack.setVolume(this._localScreenAudioVolume),this._initLocalTrackEvents(this._localScreenAudioTrack);const a=this._ctx._localAudioTrackDumpConfig[V.STREAM_INDEX_SCREEN];a.frameSize&&a.callback&&this._localScreenAudioTrack.setDataFetcher(a.frameSize,a.callback);const{position:c,volume:d}=this._ctx.earMonitorSettings[V.STREAM_INDEX_SCREEN];c!==It.NONE&&(this.setEarMonitorMode(V.STREAM_INDEX_SCREEN,c),this.setEarMonitorVolume(V.STREAM_INDEX_SCREEN,d)),(r=this._room)===null||r===void 0||(r=r.localScreenStream)===null||r===void 0||(r=r.observer)===null||r===void 0||r.setPushAudio(!0),(n=this._room)!==null&&n!==void 0&&(n=n.localScreenStream)!==null&&n!==void 0&&n.pubAudio&&await this._updateScreenPublish()}}async login(t,e){return this.logger.info("login()","token: %o, userInfo: %o",t,e),gi(t)||Le(t,"token"),wt(e),this._rtmClient.login(t,e)}async logout(){return this.logger.info("logout()"),this._rtmClient.logout()}async updateLoginToken(t){return this.logger.info("updateLoginToken()","token: %o",t),gi(t)||Le(t,"token"),this._rtmClient.updateLoginToken(t)}async getPeerOnlineStatus(t){return this.logger.info("getPeerOnlineStatus()","userId: %o",t),wt(t),this._rtmClient.getPeerOnlineStatus(t)}async sendUserMessageOutsideRoom(t,e){wt(t);const i=Date.now();return this._rtmClient.sendUserMessageOutsideRoom(t,e).then((s=>(this._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!1,i,s),s.id))).catch((s=>{throw this._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,i,s),s}))}async sendUserBinaryMessageOutsideRoom(t,e){wt(t),Su(e,"message");const i=Date.now();return this._rtmClient.sendUserMessageOutsideRoom(t,e).then((s=>(this._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!0,i,s),s.id))).catch((s=>{throw this._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,i,s),s}))}async setServerParams(t,e){return this.logger.info("setServerParams()","signature: %o, url: %0",t,e),this._rtmClient.setServerParams(t,e)}async sendServerMessage(t){Le(t,"message");const e=Date.now();return this._rtmClient.sendServerMessage(t).then((i=>{this._messageStatisticsObserver.countServerMessage(!0,!1,e,i)})).catch((i=>{throw this._messageStatisticsObserver.countServerMessage(!1,!1,e,i),i}))}async sendServerBinaryMessage(t){Su(t,"message");const e=Date.now();return this._rtmClient.sendServerMessage(t).then((i=>{this._messageStatisticsObserver.countServerMessage(!0,!0,e,i)})).catch((i=>{throw this._messageStatisticsObserver.countServerMessage(!1,!0,e,i),i}))}startCloudProxy(t){if(this._room)throw new G(C.START_CLOUD_PROXY_AFTER_JOIN,"[startCloudProxy] should be invoke before join room ");if(this.logger.info("startCloudProxy()",t),Le(t.logProxy,"logProxy"),Array.isArray(t.accessProxy))for(const e of t.accessProxy)Le(e,"accessProxy");else Le(t.accessProxy,"accessProxy");Le(t.configProxy,"configProxy"),this._originIceConfigRequestUrls=ae("ICE_CONFIG_REQUEST_URLS"),this._originLogServerUrl=ae("LOG_SERVER_URL"),this._originConfigServerUrls=ae("CONFIG_REQUEST_DOMAINS"),$t("ICE_CONFIG_REQUEST_URLS",t.accessProxy),$t("LOG_SERVER_URL",gK(t.logProxy)),$t("CONFIG_REQUEST_DOMAINS",[t.configProxy]),We.clearAccessNode(this._appId),We.clearAccessUrls(),this._ctx.useCloudProxy=!0}stopCloudProxy(){var t,e,i;if(this._room)throw new G(C.STOP_CLOUD_PROXY_BEFORE_LEAVE,"[stopCloudProxy] should be invoke after leave room ");this.logger.info("stopCloudProxy()");const s=(t=this._originIceConfigRequestUrls)===null||t===void 0?void 0:t.map((o=>o.replace("https://","").replace("/dispatch/v1/AccessInfo?Action=GetAccessInfo","")));$t("ICE_CONFIG_REQUEST_URLS",s??[]),$t("LOG_SERVER_URL",(e=this._originLogServerUrl)!==null&&e!==void 0?e:""),$t("CONFIG_REQUEST_DOMAINS",(i=this._originConfigServerUrls)!==null&&i!==void 0?i:[]),We.clearAccessNode(this._appId),We.clearAccessUrls(),this._ctx.useCloudProxy=!1,this._startCloudProxyTimestamp=void 0}async startPushPublicStream(t,e){var i,s;if(this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,e),ha(t),this._assertNotInRoom(),this._publicStreamIds.get(t))throw new G(C.REPEAT_PUSH,"repeat push public media stream");this._room&&((s=e.layout)===null||s===void 0||(s=s.regions)===null||s===void 0||s.map((r=>{var n;r.roomId=(n=this._room)===null||n===void 0?void 0:n.config.roomId})));const o=Ey(t,"started",e);return(i=this._room)===null||i===void 0||(i=i.publicStreamControlMessage(o))===null||i===void 0?void 0:i.then((()=>{this._publicStreamIds.set(t,t)}))}async updatePublicStreamParam(t,e){var i;this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,e),ha(t),this._assertNotInRoom();const s=Ey(t,"layoutChanged",e);return(i=this._room)===null||i===void 0?void 0:i.publicStreamControlMessage(s)}async stopPushPublicStream(t){var e;return this.logger.print("startPushPublicStream()","publicStreamId: %o",t),ha(t),this._assertNotInRoom(),(e=this._room)===null||e===void 0?void 0:e.publicStreamControlMessage({type:"publicstream",action:"stopped",publicStreamID:t}).then((()=>{this._publicStreamIds.delete(t)}))}async startPlayPublicStream(t){await this._wtnStreamManager.startPlayWTN(null,t,!1,!1)}async stopPlayPublicStream(t){await this._wtnStreamManager.stopPlayWTN(t)}async setAudioProfile(t){this.logger.info("setAudioProfile()","profile: %o",t),await this._shouldUpdateAudioConf("setAudioProfile")&&this._ctx.audioProfileManager.setAudioProfile(t)}async setAudioEncodeMaxBitrate(t){if(this.logger.print("setAudioEncodeMaxBitrate()",t),ko(t,"maxBitrate",6,256),this._ctx.audioProfileManager.setCustomMaxBitrate(t),this._ctx.audioProfileManager.customMaxBitrate){var e,i,s,o;if(Te&&((e=this._room)!==null&&e!==void 0&&(e=e.localStream)!==null&&e!==void 0&&e.pubAudio||(i=this._room)!==null&&i!==void 0&&(i=i.localScreenStream)!==null&&i!==void 0&&i.pubAudio))throw new G(C.NOT_SUPPORTED,"Your browser does not support set audio encode maxBitrate dynamically.");await((s=this._room)===null||s===void 0?void 0:s.setAudioEncodeMaxBitrate(V.STREAM_INDEX_MAIN,t)),await((o=this._room)===null||o===void 0?void 0:o.setAudioEncodeMaxBitrate(V.STREAM_INDEX_SCREEN,t))}}setPublicStreamVideoPlayer(t,e){return this._wtnStreamManager.setWTNRemoteVideoPlayer(t,e)}async setDummyCaptureImagePath(t,e){return new Promise(((i,s)=>{Le(e,"filePath");const o=new Image;o.crossOrigin="anonymous",o.src=e,o.onload=()=>{t===V.STREAM_INDEX_MAIN?this._dummyMainImage=o:this._dummyScreenImage=o;try{this._updateDummyCaptureImage(t),i()}catch(r){s(new G(C.UNEXPECTED_ERROR,r.message))}},o.onerror=()=>{s(new G(C.UNEXPECTED_ERROR,"Load image error"))}}))}_updateDummyCaptureImage(t){let e,i;if(t===V.STREAM_INDEX_MAIN?(e=this._dummyMainImage,i=this._ctx.videoProfile.getVideoEncodeConfig()[0]):(e=this._dummyScreenImage,i=this._ctx.videoProfile.getScreenEncodeConfig()),!e)return;const s=document.createElement("canvas"),o=s.getContext("2d"),r=Ze(i.width),n=Ze(i.height);if(!o)throw new G(C.UNEXPECTED_ERROR,"Not support canvas");let a,c;!r||!n||e.width<=r&&e.height<=n?(a=e.width,c=e.height):(a=Math.min(r,e.width*n/e.height),c=Math.min(n,e.height*r/e.width)),s.width=a,s.height=c,o.drawImage(e,0,0,e.width,e.height,0,0,a,c);const d=window.setInterval((()=>{e&&o.drawImage(e,0,0,e.width,e.height,0,0,a,c)}),200);t===V.STREAM_INDEX_MAIN?(clearInterval(this._dummyMainTimer),this._dummyMainTimer=d):(clearInterval(this._dummyScreenTimer),this._dummyScreenTimer=d);const l=s.captureStream(5).getVideoTracks()[0];var u,p;t===V.STREAM_INDEX_MAIN?(this._localImgVideoTrack=l,(u=this._localVideoTrack)!==null&&u!==void 0&&u.dummy&&this._localVideoTrack.setTrack(this._localImgVideoTrack)):(this._localImgScreenTrack=l,(p=this._localScreenVideoTrack)!==null&&p!==void 0&&p.dummy&&this._localScreenVideoTrack.setTrack(this._localImgScreenTrack))}_addListenExtensionEvent(t){t.on("re-capture-audio",(()=>{this._localAudioTrack&&this.stopAudioCapture().then((()=>{this.startAudioCapture()}))})),t.on("re-capture-video",(()=>{this._localVideoTrack&&!this._localVideoTrack.dummy&&this.stopVideoCapture().then((()=>{this.startVideoCapture()}))})),t.on("reset-video-effect",(async(e,i)=>{if(this._localVideoTrack&&!this._localVideoTrack.dummy){var s;this._localVideoTrack&&this._removeLocalTrackEvents(this._localVideoTrack);try{await this._localVideoTrack.generatePreProcessingTrack()}catch(o){i(o)}this._initLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.stopAll(),this._localVideoTrack.playAll(),this.safeEmit(Y.onLocalStreamTrackChangedByExtension,{streamIndex:V.STREAM_INDEX_MAIN,type:"video"}),e(),(s=this._room)!==null&&s!==void 0&&(s=s.localStream)!==null&&s!==void 0&&s.pubVideo&&await this._updatePublish(),this._wtnStreamManager._updatePushTrack()}e()}))}async registerExtension(t){var e,i,s;t.monitor=this.monitor,t.logger=new ue(t.name,0,this.id);try{if(!await t.isSupported())throw new Error("This extension is not supported.")}catch{throw new Error("This extension is not supported.")}ae("VERSION")!==t.version&&(As("This extension version is ".concat(t.version,", but the sdk version is ").concat(ae("VERSION"),".")),this.monitor.report("rtc_error",{message:"This extension version is ".concat(t.version,", but the sdk version is ").concat(ae("VERSION"),"."),error_code:-1}));let o={};t.name==="RTCAIAnsExtension"&&(o={overloadThreshold:ae("AINR_OVERLOAD_THRESHOLD"),enableCache:ae("AINR_ENABLE_DUMP"),url:ae("AINR_URL"),cacheTime:ae("AINR_CACHE_TIME"),dumpTime:ae("AINR_DUMP_TIME")}),t.name==="RTCBeautyExtension"&&(o={videoCaptureConfig:this._ctx.videoProfile.getCaptureConfig()}),o=lY(o),await t.init(o),this._ctx.extensionManager.register(t),this._addListenExtensionEvent(t),(e=this._localAudioTrack)===null||e===void 0||e.generatePreProcessingTrack(),(i=this._localVideoTrack)===null||i===void 0||i.generatePreProcessingTrack(),(s=this._localScreenAudioTrack)===null||s===void 0||s.generatePreProcessingTrack()}defaultTranscoding(){return JSON.parse(JSON.stringify(Zr.getDefaultValue()))}async _updatePublish(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(this.logger.info("_updatePublish()","config: %o",t),t=I(I({},{mediaType:void 0,invokeByJoinRoom:!1,pubState:Ot.PUB}),t),!this._ctx.visibility)throw new G(C.NO_PUBLISH_PERMISSION,"no publish permission");const i=await this._pubLock.lock();if(this._room&&this._ctx.signalingManager.isConnected())try{await this._room.publish(this._localVideoTrack,this._localAudioTrack,t.mediaType,t.pubState,t.invokeByJoinRoom)}catch(s){throw s instanceof G?(s.code===C.TOKEN_NO_PUBLISH_PERMISSION&&this._room.config.setTokenPublishPrivilegeExpired(!0),s):new G(C.UNEXPECTED_ERROR,"unexpected error",s)}finally{i()}else if(i(),e)throw new G(C.NOT_CONNECTED_YET,"not connected")}async startAudioPlaybackDeviceTest(t,e){return this.logger.print("startAudioPlaybackDeviceTest()","filePath: %o, indicationInterval: %o",t,e),Le(t,"filePath"),ko(e,"indicationInterval"),await this._audioDeviceManager.startAudioPlaybackDeviceTest(t,e)}stopAudioPlaybackDeviceTest(){this.logger.info("stopAudioPlaybackDeviceTest()"),this._audioDeviceManager.stopAudioPlaybackDeviceTest()}async startAudioDeviceRecordTest(t,e){this.logger.print("startAudioDeviceRecordTest()","indicationInterval: %o",t),ko(t,"indicationInterval"),await this._audioDeviceManager.startAudioDeviceRecordTest(t,e,this._localAudioVolume)}stopAudioDeviceRecordAndPlayTest(){this.logger.info("stopAudioDeviceRecordAndPlayTest()"),this._audioDeviceManager.stopAudioDeviceRecordAndPlayTest()}stopAudioDevicePlayTest(){this.logger.info("stopAudioDevicePlayTest()"),this._audioDeviceManager.stopAudioDevicePlayTest()}setRemoteUserPriority(t,e){var i;this.logger.print("setRemoteUserPriority()","userId: %o, priority: %o",t,e);try{wt(t),_e(e,"priority",[Pd.HIGH,Pd.MEDIUM,Pd.LOW])}catch(s){return console.warn(s),!1}return this._ctx.userPriority.set(t,e),(i=this._room)===null||i===void 0||i.updateRemoteUserPriority(t),!0}async takeLocalSnapshot(t){this.logger.print("takeLocalSnapshot()","streamIndex: %o",t),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]);const e=t===V.STREAM_INDEX_MAIN?this.localVideoTrack:this.localScreenVideoTrack;if(!e)throw new G(C.INVOKED_BEFORE_CAPTURE,"capture first");return e.snapshot()}async takeRemoteSnapshot(t,e){var i;this.logger.print("takeRemoteSnapshot()","id: %o, streamIndex: %o",t,e),Le(t,"id"),_e(e,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]);const s=((i=this._room)===null||i===void 0||(i=i.remoteStreams.get(t))===null||i===void 0||(i=i.find((o=>o.isScreen===(e===V.STREAM_INDEX_SCREEN))))===null||i===void 0?void 0:i.videoTrack)||this._wtnStreamManager.__getPublicStreamTrack(t,"video");if(!s)throw new G(C.STREAM_NOT_EXIST,"stream not exist");return s.snapshot()}setSubscribeFallbackOption(t){this.logger.info("setSubscribeFallbackOption()","option: %o",t);try{_e(t,"option",[Ed.DISABLE,Ed.VIDEO_STREAM_LOW,Ed.AUDIO_ONLY])}catch(e){return console.warn(e),!1}return!this._room&&(this._ctx.subscribeFallbackOption=t,!0)}getLocalStreamTrack(t,e){let i,s;if(t===V.STREAM_INDEX_MAIN?(i=e==="video"?this.localVideoTrack:this.localAudioTrack,s=()=>{var n;return(n=this._room)===null||n===void 0?void 0:n.localStream}):(i=e==="video"?this.localScreenVideoTrack:this.localScreenAudioTrack,s=()=>{var n;return(n=this._room)===null||n===void 0?void 0:n.localScreenStream}),!i)return;const o=i instanceof Uo&&i.mixedAudioTrack?i.mixedAudioTrack:i.preprocessingTrack;if(!o)return;const r=s();return this._reportMsTrackEvent(o,r?.stream.id||"local"),o}getRemoteStreamTrack(t,e,i){var s;let o;const r=((s=this._room)===null||s===void 0?void 0:s.remoteStreams.get(t))||[];if(r==null||!r.length)return;let n;var a,c,d,l;if(e===V.STREAM_INDEX_MAIN?(n=r.find((h=>!h.isScreen)),o=i==="video"?(a=n)===null||a===void 0?void 0:a.videoTrack:(c=n)===null||c===void 0?void 0:c.audioTrack):(n=r.find((h=>h.isScreen)),o=i==="video"?(d=n)===null||d===void 0?void 0:d.videoTrack:(l=n)===null||l===void 0?void 0:l.audioTrack),!o)return;const u=o.preprocessingTrack;if(!u||!n)return;const{streamId:p}=n;return this._reportMsTrackEvent(u,p),u}getPublicStreamTrack(t,e){const i=this._wtnStreamManager.__getPublicStreamTrack(t,e),s=i?.preprocessingTrack;if(s)return s?(this._reportMsTrackEvent(s,t),s):void 0}setRemoteStreamRenderSync(t){return!this._room&&(this._ctx.avSync=!!t,!0)}setJoinRoomParams(t){t&&(this._ctx.joinRoomParams=t)}async setAudioSelectionConfig(t){_e(t,"audioSelectionPriority",[Nd.DEFAULT,Nd.HIGH]),this._ctx.mediaParams||(this._ctx.mediaParams={}),this._ctx.mediaParams.audioSelectionConfig={isHighPriority:t===Nd.HIGH},this._room&&await this._room.updateMediaParams(this._ctx.mediaParams)}setCaptureVolume(t,e){_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),e=Fd(e,"volume",0,400);var i,s,o,r,n;t===V.STREAM_INDEX_SCREEN?((i=this._localScreenAudioTrack)===null||i===void 0||i.once("needReplaceTrack",(()=>{var a;(a=this._room)===null||a===void 0||a.updatePubScreenTrack()})),(s=this._localScreenAudioTrack)===null||s===void 0||s.setVolume(e),this._localScreenAudioVolume=e):((o=this._localAudioTrack)===null||o===void 0||o.once("needReplaceTrack",(()=>{var a;(a=this._room)===null||a===void 0||a.updatePubTrack()})),(r=this._localAudioTrack)===null||r===void 0||r.setVolume(e),(n=this._audioDeviceManager.audioTrack)===null||n===void 0||n.setVolume(e),this._localAudioVolume=e)}setPlaybackVolume(t,e,i){var s,o,r;if(wt(t),_e(e,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),i=Fd(i,"volume",0,400),(s=this._room)!==null&&s!==void 0&&s.config.isMultiChatMode())return void As("setPlaybackVolume is not supported in Conference mode");const n=e===V.STREAM_INDEX_SCREEN;n?this._remoteScreenAudioVolume.set(t,i):this._remoteAudioVolume.set(t,i);const a=(o=this._room)===null||o===void 0||(o=o.remoteStreams.get(t))===null||o===void 0?void 0:o.find((c=>c.isScreen===n));a==null||(r=a.audioTrack)===null||r===void 0||r.setVolume(i)}setPublicStreamVolume(t,e){this._wtnStreamManager.setWTNRemoteAudioPlaybackVolume(t,e)}async startForwardStreamToRooms(t){return t.forEach((e=>{ld(e.roomId)})),this._assertNotInRoom(),await this._room.startForwardStream2Rooms(t)}async updateForwardStreamToRooms(t){return t.forEach((e=>{ld(e.roomId)})),this._assertNotInRoom(),await this._room.updateForwardStream2Rooms(t)}async stopForwardStreamToRooms(){return this._assertNotInRoom(),await this._room.stopForwardStream2Rooms()}async pauseForwardStreamToAllRooms(){return this._assertNotInRoom(),await this._room.pauseForwardStream2AllRooms()}async resumeForwardStreamToAllRooms(){return this._assertNotInRoom(),await this._room.resumeForwardStream2AllRooms()}async ambulance(){const t=await _z(this),e=JSON.stringify(t);return this.monitor.reportLongString("ambulance",e),t}async setEarMonitorMode(t,e){this.logger.info("setEarMonitorMode()","streamIndex: %s, position: %s",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),_e(e,"position",[It.NONE,It.AFTER_CAPTURE,It.AFTER_PROCESS]),this._ctx.earMonitorSettings[t].position=e;const i=t===V.STREAM_INDEX_MAIN?this.localAudioTrack:t===V.STREAM_INDEX_SCREEN?this.localScreenAudioTrack:void 0;if(i)return e!==It.NONE?i.play(e):i.stop();this.logger.warn("setEarMonitorMode()","local audio track not exist")}setEarMonitorVolume(t,e){this.logger.info("setEarMonitorVolume()","streamIndex: %s, volume: %s",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]),e=Fd(e,"volume",0,400),this._ctx.earMonitorSettings[t].volume=e;const i=t===V.STREAM_INDEX_MAIN?this.localAudioTrack:t===V.STREAM_INDEX_SCREEN?this.localScreenAudioTrack:void 0;if(i)return i.setPlaybackVolume(e);this.logger.warn("setEarMonitorVolume()","local audio track not exist")}setUserInfo(t,e){ld(t),wt(e),this.monitor.set({room_id:t,user_id:e})}getLocalVideoPlayerVisibility(t,e){var i;this.logger.info("getLocalVideoPlayerVisibility","streamIndex: %s, playerId: %s",t,e),_e(t,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]);const s=e??Ft,o=(i=this._localVideoPlayerConfig[t].get(s))===null||i===void 0?void 0:i.player;if(!o)return void this.logger.error("getLocalVideoPlayerVisibility","no matched player, silent return");const r=o.getPlayerVisibility();return{descriptor:{mediaType:Q.VIDEO,streamIndex:t,playerId:e},status:r}}getRemotePlayerVisibility(t,e,i){var s;this.logger.info("getRemotePlayerVisibility","userId: %s, streamIndex: %s, playerId: %s",t,e,i),_e(e,"streamIndex",[V.STREAM_INDEX_MAIN,V.STREAM_INDEX_SCREEN]);const o=i??Ft,r=(s=this._getRemoteVideoPlayerConfig(e,t,o))===null||s===void 0?void 0:s.player;if(!r)return void this.logger.error("getRemotePlayerVisibility","no matched player, silent return");const n=r.getPlayerVisibility();return{descriptor:{mediaType:Q.VIDEO,streamIndex:e,userId:t,playerId:i},status:n}}_reportMsTrackEvent(t,e){if(!t.hookStop){t.hookStop=!0;const i=t.stop;t.stop=()=>{ye(this.id,"stop",e,0,e),i.call(t)}}}async _updateScreenPublish(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.logger.info("_updateScreenPublish()"),t=I(I({},{mediaType:void 0,pubState:Ot.PUB}),t),!this._ctx.visibility)throw new G(C.NO_PUBLISH_PERMISSION,"no publish permission");const e=await this._pubLock.lock();if(this._room&&this._ctx.signalingManager.isConnected())try{await this._room.publishScreen(this._localScreenVideoTrack,this._localScreenAudioTrack,t.mediaType,t.pubState)}catch(i){throw i instanceof G?i:new G(C.UNEXPECTED_ERROR,"unexpected error",i)}finally{e()}else e()}_updateAudioPlayerState(t){this.logger.info("_updateAudioPlayerState()");const{userId:e,isScreen:i,isPublic:s}=t;if(t.audioTrack&&t.attributes.audiostream&&t.subAudio){var o,r,n;if(!t.audioTrack.havePlayer()){var a,c;const h=new Cc(this.id,e,{muted:((a=this._config)===null||a===void 0?void 0:a.autoPlayPolicy)===oo.VIDEO_ONLY||((c=this._config)===null||c===void 0?void 0:c.autoPlayPolicy)===oo.PLAY_MANUALLY,isScreen:!s&&i});t.audioTrack.setPlayer(h),t.audioTrack.bindPlayerEvent(this._initPlayerEvents.bind(this));const _=this._audioDeviceManager.getSinkId();_&&t.audioTrack.setPlaybackDevice(_)}t.audioTrack.play();const p=s?(o=this._ctx.publicAudioVolume.get(e))!==null&&o!==void 0?o:100:i?(r=this._remoteScreenAudioVolume.get(e))!==null&&r!==void 0?r:100:(n=this._remoteAudioVolume.get(e))!==null&&n!==void 0?n:100;if(t.audioTrack.setVolume(p),Dt&&mc){var d,l;const h=(d=(l=this._room)===null||l===void 0?void 0:l.remoteStreams)!==null&&d!==void 0?d:new Map;A3(h)}}else{var u;(u=t.audioTrack)===null||u===void 0||u.stop()}}_updateVideoPlayerState(t){if(this.logger.info("_updateVideoPlayerState()"),t.videoTrack){const i=t.isPublic?this._wtnStreamManager._publicVideoPlayerConfig:this._remoteVideoPlayerConfig[t.isScreen?V.STREAM_INDEX_SCREEN:V.STREAM_INDEX_MAIN].get(t.userId);if(i)for(const[,s]of i){var e;t.videoTrack.setPlayer(this.id,s,(e=this._config)===null||e===void 0?void 0:e.autoPlayPolicy,this._initPlayerEvents.bind(this))}}}get _localVideoTrack(){return this._ctx.localVideoTrack}set _localVideoTrack(t){this._ctx.localVideoTrack=t}get _localAudioTrack(){return this._ctx.localAudioTrack}set _localAudioTrack(t){this._ctx.localAudioTrack=t}async _onAddStream(t){const e=t.stream,{localaudio:i,audiostream:s,localvideo:o,videostream:r}=e.attributes;let n=ti.NONE;s&&(n|=Q.AUDIO),r&&(n|=Q.VIDEO),n&&(await new Promise((a=>setTimeout(a))),e.isScreen?this.safeEmit(Y.onUserPublishScreen,{userId:e.userId,mediaType:n}):(this.safeEmit(Y.onUserPublishStream,{userId:e.userId,mediaType:n,videoStreamDescriptions:e.attributes.videoDescriptions}),this._handleAutoSubscribe(e,!0)),this.safeEmit("onAddStream",{userId:e.userId,mediaType:n,isScreen:!!e.isScreen}),e.isScreen||(i&&this.safeEmit(Y.onUserStartAudioCapture,{userId:e.userId}),o&&this.safeEmit(Y.onUserStartVideoCapture,{userId:e.userId})))}_handleAutoSubscribe(t,e){var i,s;let o=ti.NONE;if((i=this._room)!==null&&i!==void 0&&i.config.isAutoSubscribeAudio&&(o|=Q.AUDIO),(s=this._room)!==null&&s!==void 0&&s.config.isAutoSubscribeVideo&&(o|=Q.VIDEO),o){var r,n,a;e&&Be(o)&&((n=t.observer)===null||n===void 0||n.setAutoSubscribeAudio(!0)),e&&Ve(o)&&((a=t.observer)===null||a===void 0||a.setAutoSubscribeVideo(!0)),(r=this._room)!==null&&r!==void 0&&r.config.tokenSubscribePrivilegeExpired?(Be(o)&&(this._pauseAllSubscribeState.resumeAudioStreamIds[t.streamId]=t.streamId),Ve(o)&&(this._pauseAllSubscribeState.resumeVideoStreamIds[t.streamId]=t.streamId)):this._subscribe(!1,t.userId,o)}}_onRemoveStream(t){var e;const i=t.stream,s=(e=Zz[t.reason])!==null&&e!==void 0?e:ts.STREAM_REMOVE_REASON_OTHER,o=i.isScreen?Y.onUserUnpublishScreen:Y.onUserUnpublishStream;let r=ti.NONE;i.attributes.audiostream&&(r|=Q.AUDIO),i.attributes.videostream&&(r|=Q.VIDEO),r!==ti.NONE&&(this.safeEmit(o,{userId:i.userId,mediaType:r,reason:s}),this.safeEmit("onRemoveStream",{userId:i.userId,isScreen:i.isScreen})),delete this._pauseAllSubscribeState.resumeAudioStreamIds[i.streamId],delete this._pauseAllSubscribeState.resumeVideoStreamIds[i.streamId]}_onUserConnection(t){setTimeout((()=>this.safeEmit(Y.onUserJoined,t)))}_onUserLeave(t){this.safeEmit(Y.onUserLeave,t)}_onRoomError(t){var e;this.safeEmit(Y.onError,t),(e=this._room)===null||e===void 0||e.destroy(),this._room=void 0}_onNetworkQuality(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.safeEmit(Y.onNetworkQuality,...e)}_onConnectionStateChange(t){if(this._startCloudProxyTimestamp!==void 0&&this._ctx.useCloudProxy&&t.state===fe.CONNECTION_STATE_CONNECTED&&this.safeEmit(Y.onCloudProxyConnected,{interval:Date.now()-this._startCloudProxyTimestamp}),(this._ctx.isPreConnection||t.state!==fe.CONNECTION_STATE_CONNECTED&&t.state!==fe.CONNECTION_STATE_RECONNECTED)&&this.safeEmit(Y.onConnectionStateChanged,t),t.state===fe.CONNECTION_STATE_RECONNECTING)for(const[s,o]of(e=(i=this._room)===null||i===void 0?void 0:i.remoteStreams)!==null&&e!==void 0?e:new Map){var e,i;s.startsWith("mux")&&o.forEach((r=>{var n;return(n=r.audioTrack)===null||n===void 0?void 0:n.stop()}))}else t.state===fe.CONNECTION_STATE_CONNECTED&&this._rtmClient.setRTSMessageLimit(this._ctx.rtsLimiter.conf)}_stopAudioPropertiesReport(){this._audioPropertiesReportTimer!==null&&(clearInterval(this._audioPropertiesReportTimer),this._audioPropertiesReportTimer=null)}_onResubscribe(t){var e,i;t.stream&&((e=t.stream.videoTrack)===null||e===void 0||e.stopAll(),(i=t.stream.audioTrack)===null||i===void 0||i.stop(),this._updateAudioPlayerState(t.stream),this._updateVideoPlayerState(t.stream))}_onSubscribePushTrack(t){t.stream&&this._updateAudioPlayerState(t.stream)}_onRemovePushTrack(t){t.stream&&this._updateAudioPlayerState(t.stream)}_onUserPublishStateChange(t){let{userId:e,isScreen:i,mediaType:s,pubState:o,remoteStream:r}=t;const n={userId:e,mediaType:s};s&Q.AUDIO&&setTimeout((()=>{this._updateAudioPlayerState(r)})),i?o===Ot.PUB?this.safeEmit(Y.onUserPublishScreen,n):this.safeEmit(Y.onUserUnpublishScreen,I(I({},n),{},{reason:ts.STREAM_REMOVE_REASON_UNPUBLISH})):o===Ot.PUB?(n.videoStreamDescriptions=r.attributes.videoDescriptions,this.safeEmit(Y.onUserPublishStream,n),this._handleAutoSubscribe(r,!0)):this.safeEmit(Y.onUserUnpublishStream,I(I({},n),{},{reason:ts.STREAM_REMOVE_REASON_UNPUBLISH}))}_onCustomMessage(t){const{message:e}=t;t.binary?this.safeEmit(Y.onRoomBinaryMessageReceived,{userId:t.clientId,message:e}):this.safeEmit(Y.onRoomMessageReceived,{userId:t.clientId,message:e})}_onUserMessageReceived(t){this._messageStatisticsObserver.recvP2PMessage(t.userId),this.safeEmit(Y.onUserMessageReceived,t)}_onUserBinaryMessageReceived(t){this._messageStatisticsObserver.recvP2PMessage(t.userId),this.safeEmit(Y.onUserBinaryMessageReceived,t)}_onLiveTranscodingResult(t){this.safeEmit(Y.onLiveTranscodingResult,t)}_onStreamMixingEvent(t){this.safeEmit(Y.onStreamMixingEvent,t)}_onUserTokenWillExpire(){this.safeEmit(Y.onTokenWillExpire)}_onUserTokenPublishPrivilegeWillExpire(){this.safeEmit(Y.onTokenPublishPrivilegeWillExpire)}async _onUserTokenPublishPrivilegeDidExpired(){var t,e,i;await((t=this._room)===null||t===void 0?void 0:t.unpublish()),await((e=this._room)===null||e===void 0?void 0:e.unpublishScreen()),(i=this._room)===null||i===void 0||i.config.setTokenPublishPrivilegeExpired(!0),this.safeEmit(Y.onTokenPublishPrivilegeDidExpired,{errorCode:C.TOKEN_NO_PUBLISH_PERMISSION,message:"Token no longer has publish privilege"})}_onUserTokenSubscribePrivilegeWillExpire(){this.safeEmit(Y.onTokenSubscribePrivilegeWillExpire)}async _onUserTokenSubscribePrivilegeDidExpired(){this._handleLoseSubscribePrivilege(),this.safeEmit(Y.onTokenSubscribePrivilegeDidExpired,{errorCode:C.TOKEN_NO_SUBSCRIBE_PERMISSION,message:"Token no longer has subscribe privilege"})}async _unSubscribeAllRemoteStreams(){return this._room?this._pauseAllRemoteStreams(Q.AUDIO_AND_VIDEO):Promise.resolve()}_onPushPublicStreamResult(t){this.safeEmit(Y.onPushPublicStreamResult,t)}_handleRTMClient(t){t.on("onUserMessageReceivedOutsideRoom",(e=>{this._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),this.safeEmit(Y.onUserMessageReceivedOutsideRoom,e)})),t.on("onUserBinaryMessageReceivedOutsideRoom",(e=>{this._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),this.safeEmit(Y.onUserBinaryMessageReceivedOutsideRoom,e)})),t.on("onUserDisconnection",(()=>{this.safeEmit(Y.onError,{errorCode:C.RTM_DUPLICATE_LOGIN})})),t.on("onRTMTokenError",(()=>{this.safeEmit(Y.onError,{errorCode:C.RTM_TOKEN_ERROR})})),t.on("onServerParamsSetResult",(e=>{this.safeEmit(Y.onServerParamsSetResult,e?.code)}))}getSubLock(t,e){const i=t?this._subScreenLocks:this._subLocks;let s=i.get(e);return s||(s=new Ni("sub_".concat(t?1:0,"_").concat(e)),i.set(e,s)),s}get localAudioTrack(){return this._localAudioTrack}get localVideoTrack(){return this._localVideoTrack}get localScreenAudioTrack(){return this._localScreenAudioTrack}get localScreenVideoTrack(){return this._localScreenVideoTrack}get remoteStreams(){var t;const e=[];return(t=this._room)!==null&&t!==void 0&&t.remoteStreams&&this._room.remoteStreams.forEach((i=>{Array.isArray(i)&&i.forEach((s=>{e.push({userId:s.userId,isScreen:s.isScreen,hasVideo:s.hasVideo,hasAudio:s.hasAudio,videoStreamDescriptions:s.attributes.videoDescriptions})}))})),e}get iceState(){var t;return(t=this._ctx.peerConnection)===null||t===void 0?void 0:t.getIceConnectionState()}get remoteUsers(){var t;const e=[];return(t=this._room)!==null&&t!==void 0&&t.remoteUsers&&this._room.remoteUsers.forEach((i=>{e.push({userId:i.userId})})),e}get multiChatMode(){var t;return!((t=this._room)===null||t===void 0||!t.config.isMultiChatMode())}get checkMediaType(){return this._checkMediaType}get assertNotInRoom(){return this._assertNotInRoom}get peerConnection(){var t;return(t=this._ctx.peerConnection)===null||t===void 0?void 0:t.getOriginRTCPeerConnection()}_handleAudioDeviceManager(){this._audioDeviceManager.on("onAudioPlaybackDeviceTestVolume",(t=>{this.safeEmit(Y.onAudioPlaybackDeviceTestVolume,t)}))}_assertNotInRoom(){if(!this._room||!this._ctx.signalingManager.isConnected())throw new G(C.NOT_CONNECTED_YET,"server not connected")}_checkMediaType(t){_e(t,"mediaType",[Q.AUDIO,Q.VIDEO,Q.AUDIO_AND_VIDEO])}_getUserId(){var t;return((t=this._room)===null||t===void 0?void 0:t.config.userInfo.userId)||"local_user"}async _switchTrack(t){var e;this._initLocalTrackEvents(t),this._localVideoTrack=t,this._localVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((i=>{var s;t.setPlayer(i,this._mirrorType,(s=this._config)===null||s===void 0?void 0:s.autoPlayPolicy,this._initPlayerEvents.bind(this))})),(e=this._room)!==null&&e!==void 0&&(e=e.localStream)!==null&&e!==void 0&&e.pubVideo&&await this._updatePublish(),this._wtnStreamManager._updatePushTrack()}async _shouldUpdateAudioConf(t){var e,i;const s=await((e=this._room)===null||e===void 0?void 0:e.hasPublished())||((i=this._room)===null||i===void 0||(i=i.localStream)===null||i===void 0?void 0:i.pubAudio)||this._localAudioTrack&&this._localAudioTrack.sourceType===Ne.INTERNAL;if(s){const o="engine.".concat(t," should be called before publishing or capturing.");console.warn("[RTC WebSDK]: ".concat(o)),ye(this.id,t,o)}return!s}_getRemoteVideoPlayerConfig(t,e,i){var s;return(s=this._remoteVideoPlayerConfig[t].get(e))===null||s===void 0?void 0:s.get(i)}_setRemoteVideoPlayerConfig(t,e,i,s){const o=this._remoteVideoPlayerConfig[t].get(e)||new Map;o.set(i,s),this._remoteVideoPlayerConfig[t].set(e,o)}getRemoteVideoStats(){var t;const e=(t=this._room)===null||t===void 0?void 0:t.remoteStreams;if(!e||e.size===0)return{};const i={};return e.forEach(((s,o)=>{var r,n,a;let c,d;(r=s[0])!==null&&r!==void 0&&r.isScreen?(d=s[0],c=s[1]):(d=s[1],c=s[0]);const l={mainVideoStats:Kt(((n=c)===null||n===void 0?void 0:n.getRemoteStreamStats().videoStats)||{}),screenVideoStats:Kt(((a=d)===null||a===void 0?void 0:a.getRemoteStreamStats().videoStats)||{})};i[o]=l})),i}getRemoteAudioStats(){var t;const e=(t=this._room)===null||t===void 0?void 0:t.remoteStreams;if(!e||e.size===0)return{};const i={};return e.forEach(((s,o)=>{var r,n,a;let c,d;(r=s[0])!==null&&r!==void 0&&r.isScreen?(d=s[0],c=s[1]):(d=s[1],c=s[0]);const l={mainAudioStats:Kt(((n=c)===null||n===void 0?void 0:n.getRemoteStreamStats().audioStats)||{}),screenAudioStats:Kt(((a=d)===null||a===void 0?void 0:a.getRemoteStreamStats().audioStats)||{})};i[o]=l})),i}getLocalVideoStats(){var t,e;return{mainVideoStats:Kt(((t=this._room)===null||t===void 0||(t=t.localStream)===null||t===void 0?void 0:t.getLocalStreamStats().videoStats)||{}),screenVideoStats:Kt(((e=this._room)===null||e===void 0||(e=e.localScreenStream)===null||e===void 0?void 0:e.getLocalStreamStats().videoStats)||{})}}getLocalAudioStats(){var t,e;return{mainAudioStats:Kt(((t=this._room)===null||t===void 0||(t=t.localStream)===null||t===void 0?void 0:t.getLocalStreamStats().audioStats)||{}),screenAudioStats:Kt(((e=this._room)===null||e===void 0||(e=e.localScreenStream)===null||e===void 0?void 0:e.getLocalStreamStats().audioStats)||{})}}getPublicVideoStats(){const t=this._wtnStreamManager.__getRemoteStreams();if(!t||t.size===0)return{};const e={};return t.forEach(((i,s)=>{const o=Kt(i.getRemoteStreamStats().videoStats||{});delete o.isScreen,e[s]=o})),e}getPublicAudioStats(){const t=this._wtnStreamManager.__getRemoteStreams();if(!t||t.size===0)return{};const e={};return t.forEach(((i,s)=>{const o=Kt(i.getRemoteStreamStats().audioStats||{});delete o.isScreen,e[s]=o})),e}_checkPlayerVisibilityInterval(){const t=[];this._localVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach((e=>{const i=e.player.getPlayerVisibility(),s={playerId:e.playerId,mediaType:Q.VIDEO,streamIndex:V.STREAM_INDEX_MAIN};t.push({descriptor:s,status:i})})),this._localVideoPlayerConfig[V.STREAM_INDEX_SCREEN].forEach((e=>{const i=e.player.getPlayerVisibility(),s={playerId:e.playerId,mediaType:Q.VIDEO,streamIndex:V.STREAM_INDEX_SCREEN};t.push({descriptor:s,status:i})})),this._remoteVideoPlayerConfig[V.STREAM_INDEX_MAIN].forEach(((e,i)=>{e.forEach((s=>{const o=s.player.getPlayerVisibility(),r={playerId:s.playerId,mediaType:Q.VIDEO,streamIndex:V.STREAM_INDEX_MAIN,userId:i};t.push({descriptor:r,status:o})}))})),this._remoteVideoPlayerConfig[V.STREAM_INDEX_SCREEN].forEach(((e,i)=>{e.forEach((s=>{const o=s.player.getPlayerVisibility(),r={playerId:s.playerId,mediaType:Q.VIDEO,streamIndex:V.STREAM_INDEX_SCREEN,userId:i};t.push({descriptor:r,status:o})}))})),this._wtnStreamManager._publicVideoPlayerConfig.forEach(((e,i)=>{const s=e.player.getPlayerVisibility(),o={mediaType:Q.VIDEO,streamId:i};t.push({descriptor:o,status:s})})),t.length>0&&this.safeEmit(Y.onPlayerVisibility,t)}_initAutoplayFailedWorkaround(){if(de.AUTOPLAY_WORKAROUND&&(de.ENABLE_PLAY_AFTER_CLICK||Ur)){let t=[];this.on(Y.onAutoplayFailed,(r=>{t.push(r),s()}));const e=()=>{t.length>0&&(ye(this.id,"resumePlay",JSON.stringify(t)),Promise.all(t.map((r=>this.play(r.userId,r.mediaType,r.streamIndex,r.playerId)))).then((()=>{t=[],ye(this.id,"resumePlaySuccess",JSON.stringify(t))})).catch((()=>{ye(this.id,"resumePlayFailed",JSON.stringify(t))})))};let i;de.ENABLE_PLAY_AFTER_CLICK&&(document.addEventListener("click",e),i=()=>{document.removeEventListener("click",e)});const s=()=>{var r,n;window.WeixinJSBridge&&(ye(this.id,"resumePlayInWxBridge",JSON.stringify(t)),(r=(n=window.WeixinJSBridge).invoke)===null||r===void 0||r.call(n,"getNetworkType",{},e))};let o;Ur&&!window.WeixinJSBridge&&(document.addEventListener("WeixinJSBridgeReady",s,!1),o=()=>{document.removeEventListener("WeixinJSBridgeReady",s)}),this._revokeAutoplayFailedWorkaround=()=>{var r,n;(r=i)===null||r===void 0||r(),(n=o)===null||n===void 0||n()}}}},m(Pm,"hasReportNativeDetector",!1),Pm);let H=Hh;F([P()],H.prototype,"updateToken"),F([P(),fo("video")],H.prototype,"setVideoCaptureDevice"),F([P(),fo("audio")],H.prototype,"setAudioCaptureDevice"),F([P()],H.prototype,"connect"),F([dY,P()],H.prototype,"joinRoom"),F([P()],H.prototype,"leaveRoom"),F([P()],H.prototype,"destroy"),F([P(),Ye],H.prototype,"publishStream"),F([P(),Ye],H.prototype,"unpublishStream"),F([P(),Ye],H.prototype,"publishScreen"),F([P(),Ye],H.prototype,"unpublishScreen"),F([P(),Ye],H.prototype,"subscribeStream"),F([cv],H.prototype,"_subscribe"),F([P(),Ye],H.prototype,"unsubscribeStream"),F([P(),Ye],H.prototype,"subscribeScreen"),F([P(),Ye],H.prototype,"unsubscribeScreen"),F([cv],H.prototype,"_unsubscribe"),F([P(),lv],H.prototype,"setRemoteVideoConfig"),F([P()],H.prototype,"setRemoteSimulcastStreamType"),F([P(),fo("video")],H.prototype,"startVideoCapture"),F([P(),fo("video")],H.prototype,"stopVideoCapture"),F([P(),fo("audio")],H.prototype,"startAudioCapture"),F([P(),fo("audio")],H.prototype,"stopAudioCapture"),F([P(),fo("all")],H.prototype,"startAudioAndVideoCapture"),F([P()],H.prototype,"startVideoAndAudioCapture"),F([P()],H.prototype,"getAudioMixingManager"),F([P()],H.prototype,"getWTNStreamManager"),F([P()],H.prototype,"getCallId"),F([P(),uv],H.prototype,"startScreenCapture"),F([P(),uv],H.prototype,"stopScreenCapture"),F([P()],H.prototype,"setLocalVideoPlayer"),F([P(),Ye],H.prototype,"startLiveTranscoding"),F([P(),Ye],H.prototype,"updateLiveTranscoding"),F([P(),Ye],H.prototype,"stopLiveTranscoding"),F([P(),Ye],H.prototype,"startSubtitle"),F([P(),Ye],H.prototype,"updateSubtitleConfig"),F([P(),Ye],H.prototype,"stopSubtitle"),F([P()],H.prototype,"setBusinessId"),F([P(),Ye],H.prototype,"setUserVisibility"),F([P()],H.prototype,"setRemoteVideoPlayer"),F([P()],H.prototype,"setLocalVideoMirrorType"),F([P()],H.prototype,"setRemoteVideoMirrorType"),F([P()],H.prototype,"setAudioPlaybackDevice"),F([P()],H.prototype,"play"),F([P()],H.prototype,"stop"),F([P()],H.prototype,"getAudioVolume"),F([P()],H.prototype,"setAudioFrameCallback"),F([P(),Ye],H.prototype,"pauseAllSubscribedStream"),F([P(),Ye],H.prototype,"resumeAllSubscribedStream"),F([P()],H.prototype,"sendUserMessage"),F([P()],H.prototype,"sendUserBinaryMessage"),F([P()],H.prototype,"sendRoomMessage"),F([P()],H.prototype,"sendRoomBinaryMessage"),F([P()],H.prototype,"setAudioCaptureConfig"),F([jy("4.51"),P()],H.prototype,"setVideoCaptureConfig"),F([P()],H.prototype,"enableSimulcastMode"),F([P()],H.prototype,"setLocalSimulcastMode"),F([P()],H.prototype,"setVideoEncoderConfig"),F([P()],H.prototype,"setScreenEncoderConfig"),F([P(),Ye],H.prototype,"sendSEIMessage"),F([jy("4.42"),P()],H.prototype,"setAudioVolumeIndicationInterval"),F([P()],H.prototype,"enableAudioPropertiesReport"),F([P()],H.prototype,"setVideoSourceType"),F([P()],H.prototype,"setExternalVideoTrack"),F([P()],H.prototype,"setAudioSourceType"),F([P()],H.prototype,"setExternalAudioTrack"),F([P()],H.prototype,"login"),F([P()],H.prototype,"logout"),F([P()],H.prototype,"updateLoginToken"),F([P()],H.prototype,"getPeerOnlineStatus"),F([P()],H.prototype,"sendUserMessageOutsideRoom"),F([P()],H.prototype,"sendUserBinaryMessageOutsideRoom"),F([P()],H.prototype,"setServerParams"),F([P()],H.prototype,"sendServerMessage"),F([P()],H.prototype,"sendServerBinaryMessage"),F([P()],H.prototype,"startCloudProxy"),F([P()],H.prototype,"stopCloudProxy"),F([P()],H.prototype,"startPushPublicStream"),F([P()],H.prototype,"updatePublicStreamParam"),F([P()],H.prototype,"stopPushPublicStream"),F([P(["streamId"])],H.prototype,"startPlayPublicStream"),F([P(["streamId"])],H.prototype,"stopPlayPublicStream"),F([P()],H.prototype,"setAudioProfile"),F([P()],H.prototype,"setAudioEncodeMaxBitrate"),F([P()],H.prototype,"setPublicStreamVideoPlayer"),F([P()],H.prototype,"setDummyCaptureImagePath"),F([P()],H.prototype,"registerExtension"),F([P()],H.prototype,"startAudioPlaybackDeviceTest"),F([P()],H.prototype,"stopAudioPlaybackDeviceTest"),F([P()],H.prototype,"startAudioDeviceRecordTest"),F([P()],H.prototype,"stopAudioDeviceRecordAndPlayTest"),F([P()],H.prototype,"stopAudioDevicePlayTest"),F([P(),lv],H.prototype,"setRemoteUserPriority"),F([P()],H.prototype,"takeLocalSnapshot"),F([P()],H.prototype,"takeRemoteSnapshot"),F([P()],H.prototype,"setSubscribeFallbackOption"),F([P()],H.prototype,"getLocalStreamTrack"),F([P()],H.prototype,"getRemoteStreamTrack"),F([P()],H.prototype,"getPublicStreamTrack"),F([P()],H.prototype,"setRemoteStreamRenderSync"),F([P()],H.prototype,"setJoinRoomParams"),F([P(),Ye],H.prototype,"setAudioSelectionConfig"),F([P(),Ye],H.prototype,"startForwardStreamToRooms"),F([P(),Ye],H.prototype,"updateForwardStreamToRooms"),F([P(),Ye],H.prototype,"stopForwardStreamToRooms"),F([P(),Ye],H.prototype,"pauseForwardStreamToAllRooms"),F([P(),Ye],H.prototype,"resumeForwardStreamToAllRooms"),F([P()],H.prototype,"setEarMonitorMode"),F([P([],{debounce:2e3,debounceTag:function(t){return"".concat(t)}})],H.prototype,"setEarMonitorVolume"),F([P()],H.prototype,"setUserInfo"),F([P()],H.prototype,"getLocalVideoPlayerVisibility"),F([P()],H.prototype,"getRemotePlayerVisibility");const Zz={"client unpublished":ts.STREAM_REMOVE_REASON_UNPUBLISH,"publish failed":ts.STREAM_REMOVE_REASON_PUBLISH_FAILED,"stream removed":ts.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED,"client disconnected":ts.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED,"client republish":ts.STREAM_REMOVE_REASON_REPUBLISH,"token publish privilege expired":ts.STREAM_REMOVE_REASON_TOKEN_PRIVILEGE_EXPIRED};function cv(t,e,i){const s=i.value;return i.value=async function(){for(var o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];const[a,c,d]=r;this.checkMediaType(d),this.assertNotInRoom();const l=await this.getSubLock(a,c).lock();try{return await s.apply(this,r)}finally{l()}},i}function lv(t,e,i){const s=i.value;return i.value=async function(){for(var o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];const[a]=r,c=await this.getSubLock(!1,a).lock();try{return await s.apply(this,r)}finally{c()}},i}function fo(t){return function(e,i,s){const o=s.value;return s.value=async function(){const r=[];t!=="video"&&r.push(this._audioCaptureLock.lock()),t!=="audio"&&r.push(this._videoCaptureLock.lock());const n=await Promise.all(r);try{for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return await o.apply(this,c)}finally{n.forEach((l=>l()))}},s}}function uv(t,e,i){const s=i.value;return i.value=async function(){const o=await this._screenCaptureLock.lock();try{for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return await s.apply(this,n)}finally{o()}},i}var Tz=Object.defineProperty,Iz=Object.getOwnPropertyDescriptor,An=(t,e,i,s)=>{for(var o,r=Iz(e,i),n=t.length-1;n>=0;n--)(o=t[n])&&(r=o(e,i,r)||r);return r&&Tz(e,i,r),r};class Pr extends H{constructor(e,i,s){super(e,i,s),m(this,"singleStreamRenderMode",!1),this.id=i,this.logger=new ue("BLWEngine",0,i),iZ([{width:192,height:108,frameRate:15,maxKbps:100},{width:320,height:180,frameRate:15,maxKbps:140},{width:640,height:360,frameRate:15,maxKbps:400},{width:1280,height:720,frameRate:15,maxKbps:1e3},{width:1920,height:1080,frameRate:15,maxKbps:2e3}]),this._handleEngineEvents()}async subscribeStream(e,i){return this.logger.print("subscribeStream()","userId: %o, mediaType: %o",e,i),this.singleStreamRenderMode&&Ve(i)&&super.subscribeScreen(e,Q.VIDEO).catch((s=>{this.logger.error("singleStreamRenderMode subscribeScreen()",s)})),super.subscribeStream(e,i)}async unsubscribeStream(e,i){return this.logger.print("unsubscribeStream()","userId: %o, mediaType: %o",e,i),this.singleStreamRenderMode&&Ve(i)&&super.unsubscribeScreen(e,Q.VIDEO).catch((s=>{this.logger.error("singleStreamRenderMode unsubscribeScreen()",s)})),super.unsubscribeStream(e,i)}setRemoteScreenVideoStreamIndex(e){return this.logger.print("setRemoteScreenVideoStreamIndex()","streamIndex: %o",e),!this._room&&(this.singleStreamRenderMode=e===V.STREAM_INDEX_MAIN,!0)}setRemoteVideoPlayer(e,i){if(this.logger.print("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,i),i==null||delete i.playerId,!this.singleStreamRenderMode||e!==V.STREAM_INDEX_SCREEN)return super.setRemoteVideoPlayer(e,i)}destroy(){this.singleStreamRenderMode=!1,super.destroy()}_updateVideoPlayerState(e){var i,s,o,r;if(!this.singleStreamRenderMode)return super._updateVideoPlayerState(e);const{userId:n}=e,a=(i=this._room)===null||i===void 0?void 0:i.remoteStreams.get(n);let c,d;Array.isArray(a)&&a.forEach((v=>{v.isScreen?c=v:d=v}));let l=(s=d)===null||s===void 0||(s=s.videoTrack)===null||s===void 0?void 0:s.dangerousGetPlayer(Ft);if(!l){var u;const v=(u=this._remoteVideoPlayerConfig[V.STREAM_INDEX_MAIN].get(n))===null||u===void 0?void 0:u.get(Ft);if(!v)return;var p,h,_;(p=d)===null||p===void 0||(p=p.videoTrack)===null||p===void 0||p.setPlayer(this.id,v,(h=this._config)===null||h===void 0?void 0:h.autoPlayPolicy,this._initPlayerEvents.bind(this)),l=(_=d)===null||_===void 0||(_=_.videoTrack)===null||_===void 0?void 0:_.dangerousGetPlayer(Ft)}var y,b,S;if(!e.isScreen&&(o=c)!==null&&o!==void 0&&o.videoTrack&&c.videoHasPublish)return this.logger.print("_updateVideoPlayerState","prevent play main stream"),void((y=l)===null||y===void 0||y.playVideo(c.videoTrack));e.videoTrack?((b=this._config)===null||b===void 0?void 0:b.autoPlayPolicy)!==oo.PLAY_MANUALLY&&((S=l)===null||S===void 0||S.playVideo(e.videoTrack)):(r=l)!==null&&r!==void 0&&r.played&&l.stop()}_handleEngineEvents(){this.on(Y.onUserPublishScreen,(e=>{if(this.singleStreamRenderMode&&Ve(e.mediaType)){var i,s;const o=(i=this._room)===null||i===void 0?void 0:i.remoteStreams.get(e.userId),r=o?.find((a=>!a.isScreen)),n=o?.find((a=>a.isScreen));n!=null&&n.hasSubscribed?(this.logger.info("onUserPublishScreen","singleStreamRenderMode screen hasSubscribed"),this._updateVideoPlayerState(n)):((s=this._room)!==null&&s!==void 0&&s.config.isAutoSubscribeVideo||r!=null&&r.hasSubscribed&&Ve(r.subMediaType))&&(this.logger.info("onUserPublishScreen","singleStreamRenderMode subscribeScreen"),this.subscribeScreen(e.userId,Q.VIDEO))}})),this.on(Y.onUserUnpublishScreen,(e=>{if(this.singleStreamRenderMode&&Ve(e.mediaType)){var i;const s=(i=this._room)===null||i===void 0?void 0:i.remoteStreams.get(e.userId),o=s?.find((r=>!r.isScreen));o&&setTimeout((()=>{this._updateVideoPlayerState(o)}))}}))}}An([P()],Pr.prototype,"subscribeStream"),An([P()],Pr.prototype,"unsubscribeStream"),An([P()],Pr.prototype,"setRemoteScreenVideoStreamIndex"),An([P()],Pr.prototype,"setRemoteVideoPlayer"),An([P()],Pr.prototype,"destroy");const Jp=new ue("VERTC",0);Br.storeKey="".concat(Date.now(),"-").concat(We.getDeviceId()),ma({rtc_sdk_version:de.VERSION,device_id:We.getDeviceId(),log_cache_key:Br.storeKey}),Ff(de.LOG_SERVER_URL);let kI=1;const Rz=(t,e)=>{Jp.info("createEngine","Invoke VERTC.createEngine"),Le(t,"appId");const i=(kI++).toString();return Of(i,{rtc_app_id:t,auto_play_policy:e?.autoPlayPolicy}),new H(t,i,e)},Xz=(t,e)=>{Jp.print("createBLWEngine","Invoke VERTC.createBLWEngine"),Le(t,"appId");const i=(kI++).toString();return Of(i,{rtc_app_id:t,auto_play_policy:e?.autoPlayPolicy}),new Pr(t,i,e)},Cz=t=>{if(Jp.info("destroyEngine","Invoke VERTC.destroyEngine"),!(t instanceof H))throw new G(C.INVALID_ENGINE,"Invalid engine object");t.destroy(),Sw(t.monitor)},Lz=async()=>_t.enumerateDevices(),Wz=async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{video:!0,audio:!0};const{video:e,audio:i}=t,s={video:!1,audio:!1},o=[];return e&&o.push(_t.getPermissions({video:!0,force:!0}).then((r=>{s.video=r.video,r.video||(s.videoExceptionError=r.reason)}))),i&&o.push(_t.getPermissions({audio:!0,force:!0}).then((r=>{s.audio=r.audio,r.audio||(s.audioExceptionError=r.reason)}))),await Promise.allSettled(o),s},Gz=async()=>_t.enumerateAudioCaptureDevices(),Vz=async()=>_t.enumerateVideoCaptureDevices(),Ez=async()=>_t.enumerateAudioPlaybackDevices(),Pz=()=>de.VERSION,Nz=()=>rK(),kz=()=>nK(),xz=t=>{let{logLevel:e,LogfileSize:i}=t;e&&(Br.logLevel=e),i&&(Br.LogfileSize=i)},Mz=t=>{Br.download(t)};function Nm(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return JSON.stringify(e.map((s=>s instanceof H?"[ENGINE]":s)))}function Et(t,e){return function(){Yd(e,0,Nm(...arguments));const i=t(...arguments);return typeof i?.then=="function"?i.then((s=>(nu(e,0,Nm(s)),s))).catch((s=>{throw nu(e,s.code,s.message),s})):(nu(e,0,Nm(i)),i)}}class wz{constructor(){m(this,"getSdkVersion",Et(Pz,"getSdkVersion")),m(this,"createEngine",Et(Rz,"createEngine")),m(this,"createBLWEngine",Et(Xz,"createBLWEngine")),m(this,"destroyEngine",Et(Cz,"destroyEngine")),m(this,"enumerateDevices",Et(Lz,"enumerateDevices")),m(this,"enableDevices",Et(Wz,"enableDevices")),m(this,"enumerateAudioCaptureDevices",Et(Gz,"enumerateAudioCaptureDevices")),m(this,"enumerateVideoCaptureDevices",Et(Vz,"enumerateVideoCaptureDevices")),m(this,"enumerateAudioPlaybackDevices",Et(Ez,"enumerateAudioPlaybackDevices")),m(this,"getParameter",ae),m(this,"setParameter",$t),m(this,"isSupported",Et(Nz,"isSupported")),m(this,"getSupportedCodecs",Et(kz,"getSupportedCodecs")),m(this,"getElectronScreenSources",Et(gI,"getElectronScreenSources")),m(this,"events",Y),m(this,"ErrorCode",C),m(this,"platform","VolcEngine"),m(this,"commitInfo","HEAD<71208eb*>"),m(this,"downloadLog",Et(Mz,"downloadLog")),m(this,"setLogConfig",Et(xz,"setLogConfig"))}}var Kz=new wz;export{yi as M,To as N,Xt as R,V as S,Zo as V,Q as a,Kz as i};
